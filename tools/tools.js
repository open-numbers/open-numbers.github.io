webpackJsonp([1],Array(28).concat([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(29),r=(i.n(n),i(30)),a=(i.n(r),i(47)),o=i(48);window.d3=window.d3||i(4),window.urlon=window.urlon||i(5),window.Vizabi=window.Vizabi||i(31),window.WsReader=window.WsReader||i(32),window.DDFCsvReader=window.DDFCsvReader||i(33);var s=WsReader.WsReader.getReader();Vizabi.Reader.extend("waffle",s);var l=new DDFCsvReader.getDDFCsvReaderObject;Vizabi.Reader.extend("ddf",l),i(34),i(35),i(36),i(37),i(38),i(39);var c=i(40);c.keys().forEach(c),window.toolsPage={toolset:a.a,datasources:o.a}},function(t,e){},function(t,e,i){t.exports=i.p+"favicon.ico"},function(t,e){!function(i,n){"object"==typeof e&&"object"==typeof t?t.exports=n():"function"==typeof define&&define.amd?define("Vizabi",[],n):"object"==typeof e?e.Vizabi=n():i.Vizabi=n()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=187)}([function(t,e,i){var n=i(3),r=i(25),a=i(15),o=i(16),s=i(22),l=function(t,e,i){var c,u,h,d,f=t&l.F,p=t&l.G,m=t&l.S,g=t&l.P,v=t&l.B,b=p?n:m?n[e]||(n[e]={}):(n[e]||{}).prototype,y=p?r:r[e]||(r[e]={}),_=y.prototype||(y.prototype={});p&&(i=e);for(c in i)u=!f&&b&&void 0!==b[c],h=(u?b:i)[c],d=v&&u?s(h,n):g&&"function"==typeof h?s(Function.call,h):h,b&&o(b,c,h,t&l.U),y[c]!=h&&a(y,c,d),g&&_[c]!=h&&(_[c]=h)};n.core=r,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t){return Boolean(t instanceof Date||t instanceof RegExp)}function a(t){if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function o(t){var e=[];return S(t,function(t,i){"object"===(void 0===t?"undefined":h(t))&&null!==t?p(t)?e[i]=o(t):r(t)?e[i]=a(t):e[i]=M({},t):e[i]=t}),e}function s(t,e){return function(i,n){var r=e.getBoundingClientRect(),a=t.getScreenCTM();return{x:a.a*i+a.c*n+a.e-r.left,y:a.b*i+a.d*n+a.f-r.top}}}function l(){function t(t){return t}function e(t){return"string"==typeof t?t.toLowerCase():t}function i(i,n){if(n="number"==typeof n?{direction:n}:n||{},"function"!=typeof i){var r=i;i=function(t){return t[r]?t[r]:""}}if(1===i.length){var a=i,o=n.ignoreCase?e:t;i=function(t,e){return o(a(t))<o(a(e))?-1:o(a(t))>o(a(e))?1:0}}return-1===n.direction?function(t,e){return-i(t,e)}:i}function n(t,e){var r="function"==typeof this&&this,a=i(t,e),o=r?function(t,e){return r(t,e)||a(t,e)}:a;return o.thenBy=n,o}return n}function c(t){var e=t.transform.baseVal.consolidate().matrix,i=e.a,n=e.b,r=e.c,a=e.d,o=e.e,s=e.f;return function(t,e,i,n,r,a){var o=void 0,s=void 0,l=void 0;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Math.PI/180,skewX:Math.atan(l)*Math.PI/180,scaleX:o,scaleY:s}}(i,n,r,a,o,s)}function u(t,e){for(var i=t[e[0]],n=1,r=e.length;n<r;n++)i=i+","+t[e[n]];return i}Object.defineProperty(e,"__esModule",{value:!0}),e.getOSname=e.getBrowserDetails=e.getSubtitle=e.replaceNumberSpacesToNonBreak=e.px2num=e.getProp=e.isFunction=e.isMobileOrTablet=e.capitalize=e.setIcon=e.pruneTree=e.isTouchDevice=e.debounce=e.memoize=e.post=e.get=e.ajax=e.interpolatePoint=e.interpolateVector=e.nestArrayToValues=e.nestArrayToObjWithFlatKeys=e.nestArrayToObj=e.hashCode=e.clearDelay=e.delay=e.defer=e.diffObject=e.arrayLast=e.arrayMedian=e.arraySum=e.arrayMean=e.arrayMax=e.arrayMin=e.values=e.keys=e.throttle=e.hasClass=e.classed=e.removeClass=e.addClass=e.countDecimals=e.error=e.groupEnd=e.groupCollapsed=e.warn=e.timeStamp=e.areaToRadius=e.cathetus=e.hypotenuse=e.radiusToArea=e.preventAncestorScrolling=e.matchAny=e.filterAny=e.filter=e.find=e.uniqueLast=e.unique=e.without=e.deepClone=e.clone=e.merge=e.deepExtend=e.extend=e.forEach=e.strToFloat=e.roundStep=e.findScrollableAncestor=e.getViewportPosition=e.comparePlainObjects=e.deepArrayEquals=e.arrayEquals=e.isPlainObject=e.isNumber=e.isEmpty=e.isNaN=e.isString=e.isDate=e.isObject=e.isArray=e.isElement=e.uniqueId=e.printAutoconfigResult=e.approxEqual=e.d3text=e.d3json=void 0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.makeAbsoluteContext=s,e.firstBy=l,e.transform=c,e.getKey=u;var d=i(391),f=function(t){return t&&t.__esModule?t:{default:t}}(d),p=(e.d3json=function(t,e){window.fetch&&-1===navigator.userAgent.toLowerCase().indexOf(" electron/")?fetch(t).then(function(t){if(t.ok)return t.json();e(new Error)}).then(function(t){e(null,t)}).catch(function(t){return e(t)}):d3.json(t,e)},e.d3text=function(t,e){window.fetch&&-1===navigator.userAgent.toLowerCase().indexOf(" electron/")?fetch(t).then(function(t){if(t.ok)return t.text();e(new Error)}).then(function(t){e(null,t)}).catch(function(t){return e(t)}):d3.text(t,e)},e.approxEqual=function(t,e,i){return i=i||0,e>0?(1-i)*e<=t&&t<=e*(1+i):e<0?(1+i)*e<=t&&t<=e*(1-i):Math.abs(t)<=i},e.printAutoconfigResult=function(t){console.info("AUTOCONFIG: "+t._name+(t.isHook()?" of "+t._parent._name:"")+" choses "+(t.dim||t.which)+" from "+(t.dataSource?t.dataSource._name:"<DATA SOURCE MISSING!>")+" to be "+("entities"===t._type||"time"===t._type?"DIM":"WHICH"))},e.uniqueId=function(){var t=0;return function(e){return e?e+(t+=1):t+=1}}(),e.isElement=function(t){return!(!t||1!==t.nodeType)},e.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}),m=e.isObject=function(t){return"object"===(void 0===t?"undefined":h(t))&&!!t},g=(e.isDate=function(t){return t instanceof Date},e.isString=function(t){return"string"==typeof t}),v=e.isNaN=function(t){return y(t)&&t!==+t},b=e.isEmpty=function(t){return 0===Object.keys(t).length&&t.constructor===Object},y=e.isNumber=function(t){return"number"==typeof t||!!t&&"object"===(void 0===t?"undefined":h(t))&&"[object Number]"===Object.prototype.toString.call(t)},_=e.isPlainObject=function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},x=(e.arrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},e.deepArrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(_(t[i])&&_(e[i])){if(!w(t[i],e[i]))return!1}else if(t[i]!==e[i])return!1;return!0}),w=e.comparePlainObjects=function(t,e){var i=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e=void 0===t?"undefined":h(t);return"object"===e&&(e=i(t).toLowerCase()),"number"===e?t.toString().indexOf(".")>0?"float":"integer":e},r=function(t,e){if(t===e)return!0;for(var i in t){if(!e.hasOwnProperty(i))return!1;if(!s(t[i],e[i]))return!1}for(var n in e)if(!t.hasOwnProperty(n))return!1;return!0},a=function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!s(t[i],e[i]))return!1;return!0},o={};o.array=a,o.object=r,o.date=function(t,e){return t.getTime()===e.getTime()},o.regexp=function(t,e){return t.toString()===e.toString()};var s=function(t,e){if(t!==e){var i=n(t);return i===n(e)&&(o.hasOwnProperty(i)?o[i](t,e):t==e)}return!0};return r(t,e)},S=(e.getViewportPosition=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:i}},e.findScrollableAncestor=function(t){for(var e=["scroll","auto"];t=t.parentNode;){if(t.scrollHeight>t.clientHeight&&-1!==e.indexOf(d3.select(t).style("overflow")))return t}return null},e.roundStep=function(t,e){return Math.round(t/e)*e},e.strToFloat=function(t){return+t.replace(/[^\d.-]/g,"")},e.forEach=function(t,e,i){if(t){var n=void 0,r=void 0;if(p(t))for(r=t.length,n=0;n<r;n+=1){var a=e.apply(i,[t[n],n]);if(!1===a)break}else{var o=Object.keys(t);for(r=o.length,n=0;n<r;n+=1){if(!1===e.apply(i,[t[o[n]],o[n]]))break}}}}),M=(e.extend=function(t){var e=Array.prototype.slice.call(arguments,1);return S(e,function(e,i){S(e,function(i,n){e.hasOwnProperty(n)&&(t[n]=i)})}),t},e.deepExtend=function t(){if(arguments.length<1||"object"!==h(arguments[0]))return!1;if(arguments.length<2)return arguments[0];var e=arguments[0],i="boolean"==typeof arguments[arguments.length-1],n=i&&arguments[arguments.length-1],s=Array.prototype.slice.call(arguments,1,i?-1:arguments.length),l=void 0,c=void 0;return S(s,function(i){"object"!==(void 0===i?"undefined":h(i))||p(i)||S(Object.keys(i),function(s){c=e[s],(l=i[s])===e||("object"!==(void 0===l?"undefined":h(l))||null===l||l._data?e[s]=l:p(l)?e[s]=o(l):r(l)?e[s]=a(l):"object"!==(void 0===c?"undefined":h(c))||null===c||p(c)?e[s]=t({},l):n&&b(l)?e[s]={}:e[s]=t(c,l,n))})}),e}),k=(e.merge=function(t){var e=Array.prototype.slice.call(arguments,1);return S(e,function(e,i){S(e,function(i,n){e.hasOwnProperty(n)&&(t.hasOwnProperty(n)?(p(t[n])||(t[n]=[t[n]]),t[n].push(i)):t[n]=i)})}),t},e.clone=function(t,e,i){if(p(t))return t.slice(0);var n={};return S(t,function(r,a){e&&-1===e.indexOf(a)||i&&-1!==i.indexOf(a)||t.hasOwnProperty(a)&&(n[a]=r)}),n},e.deepClone=function t(e){var i={};return p(e)&&(i=[]),S(e,function(e,n){m(e)||p(e)?i[n]=t(e):i[n]=e}),i},e.without=function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},e.unique=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},i={};return t.filter(function(t){var n=e(t);return!i.hasOwnProperty(n)&&(i[n]=1,!0)})},e.uniqueLast=function(t,e){var i={},n=[];e||(e=function(t){return t});for(var r=0,a=t.length;r<a;r+=1){var o=e(t[r]);i.hasOwnProperty(o)&&n.splice(i[o],1),n.push(t[r]),i[o]=n.length-1}return n},e.find=function(t,e){var i=void 0;return S(t,function(t){if(e(t))return i=t,!1}),i},e.filter=function(t,e){for(var i=-1,n=t.length,r=-1,a=[],o=Object.keys(e),s=o.length,l=void 0,c=void 0;(i+=1)<n;){var u=t[i],h=!0;for(l=0;l<s;l+=1)if(c=o[l],!u.hasOwnProperty(c)||u[c]!==e[c]){h=!1;break}h&&(a[r+=1]=u)}return a},e.filterAny=function(t,e,i){for(var n=-1,r=t.length,a=-1,o=[],s=Object.keys(e),l=s.length,c=void 0,u=void 0;(n+=1)<r;){var h=t[n],d=!0;for(c=0;c<l;c+=1)if(u=s[c],!h.hasOwnProperty(u)||!k(h[u],e[u],i)){d=!1;break}d&&(o[a+=1]=h)}return o},e.matchAny=function(t,e,i){p(t)||(t=[t]),i||(i="*");for(var n=!1,r=0;r<t.length;r++){var a=t[r];if(!p(e)&&a==e){n=!0;break}if(p(e)){for(var o=-1,s=0;s<e.length;s++){var l=e[s];if(!(p(l)||l!=a&&l!==i)){o=s;break}if(p(l)){var c=l[0],u=l[1]||c;if(a>=c&&a<=u){o=s;break}}}if(-1!==o){n=!0;break}}}return n}),E=(e.preventAncestorScrolling=function(t){var e=!1;t.on("mousewheel",function(i,n){var r=this.scrollTop,a=this.scrollHeight,o=t.node().offsetHeight,s=d3.event.wheelDelta,l=s>0,c=function(t){return function(){var e=this,i=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=i(t)}}};if(l?l&&(s>r&&r>0?(t.transition().delay(0).duration(0).tween("scrolltween",c(0)),e=!0,setTimeout(function(){e=!1},2e3)):a==o+r&&(e=!1)):-s>a-o-r&&a!=o+r?(t.transition().delay(0).duration(0).tween("scrolltween",c(a)),e=!0,setTimeout(function(){e=!1},2e3)):0==r&&(e=!1),e)return function(){return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}()})},e.radiusToArea=function(t){return t*t*Math.PI},e.hypotenuse=function(t,e){return Math.sqrt(t*t+e*e)},e.cathetus=function(t,e){return Math.sqrt(t*t-e*e)},e.areaToRadius=function(t){return Math.sqrt(t/Math.PI)},e.timeStamp=function(t){console&&"function"==typeof console.timeStamp&&console.timeStamp(t)},e.warn=function(t){return t=Array.prototype.slice.call(arguments).map(function(t){return t instanceof Object?JSON.stringify(t,null,4):t}).join(" "),console&&"function"==typeof console.warn&&console.warn(t),!0}),z=(e.groupCollapsed=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(t)},e.groupEnd=function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},e.error=function(t){console&&"function"==typeof console.error&&(t.stack?console.error(t.stack):console.error(t),arguments.length>1&&console.error.apply(this,Array.prototype.slice.call(arguments,1)))},e.countDecimals=function(t){return Math.floor(t.valueOf())===t.valueOf()?0:t.toString().split(".")[1].length||0},e.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e}),O=e.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},T=(e.classed=function(t,e,i){if(!0===i)z(t,e);else{if(!1!==i)return T(t,e);O(t,e)}},e.hasClass=function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}),C=(e.throttle=function(t,e){var i=!1,n=void 0,r=void 0,a=void 0,o=function(){i&&(i=!1,t.apply(r,n))},s=function(){if(a>Date.now())return i=!0,n=arguments,void(r=this);a=Date.now()+e,i=!1,t.apply(this,arguments),setTimeout(function(){o()},e)};return s.recallLast=o,s},e.keys=function(t){return Object.keys(t)},e.values=function(t){for(var e=[],i=Object.keys(t),n=i.length,r=0;r<n;r+=1)e.push(t[i[r]]);return e},e.arrayMin=function(t){return t.reduce(function(t,e){return t<e?t:e})},e.arrayMax=function(t){return t.reduce(function(t,e){return t>e?t:e})},e.arrayMean=function(t){return C(t)/t.length},e.arraySum=function(t){return t.reduce(function(t,e){return t+e})}),P=(e.arrayMedian=function(t){t=t.sort(function(t,e){return t-e});var e=Math.floor((t.length-1)/2);return t.length%2?t[e]:(t[e]+t[e+1])/2},e.arrayLast=function(t){return t.length?t[t.length-1]:null},e.diffObject=function t(e,i){var n={};return S(i,function(i,r){!e.hasOwnProperty(r)&&_(i)&&(n[r]=t({},i))}),S(e,function(e,r){if(i.hasOwnProperty(r)){if(e!==i[r])if(_(e)&&_(i[r]))if(b(e))b(i[r])||(n[r]={});else{var a=t(e,i[r]);Object.keys(a).length>0&&(n[r]=a)}else p(e)&&p(i[r])&&x(e,i[r])||(n[r]=e)}else n[r]=e}),n},e.defer=function(t){setTimeout(t,1)},e.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.clearDelay=function(t){return clearTimeout(t)},e.hashCode=function(t){g(t)||(t=JSON.stringify(t));var e=0,i=t.length,n=void 0;if(0===i)return e;for(var r=0;r<i;r+=1)n=t.charCodeAt(r),e=(e<<5)-e+n,e&=e;return e.toString()},e.nestArrayToObj=function t(e){if(!e||!e.length||!e[0].key)return e;for(var i={},n=0;n<e.length;n++)i[e[n].key]=t(e[n].values);return i},e.nestArrayToObjWithFlatKeys=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e||!e.length||!e[0].key)return n?(n+="]",!i[n]&&(i[n]={}),i[n][r]=e):i[r]=e,e;r&&(n=n?n+","+JSON.stringify(r):"["+JSON.stringify(r));for(var a=0;a<e.length;a++)t(e[a].values||e[a].value,i,n,e[a].key);return i},e.nestArrayToValues=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||!e.length||!e[0].key)return void i.push.apply(i,n(e));for(var r=0;r<e.length;r++)t(e[r].values||e[r].value,i);return i},e.interpolateVector=function(){},e.interpolatePoint=function(t,e,i,n,r,a,o,s){if(!t||0===t.length)return E("interpolatePoint failed because incoming array is empty. It was "+i),null;if("constant"===e)return i;if("property"===e)return t[0][i];if(s){if(a-t[0][r]<=0)return t[0][i];if(a-t[t.length-1][r]>=0)return t[t.length-1][i]}else if(a<t[0][r]||a>t[t.length-1][r])return null;if(n||0===n||(n=d3.bisectLeft(t.map(function(t){return t[r]}),a)),0===n)return t[0][i];if(void 0===t[n]||null===t[n][i]||null===t[n-1][i]||""===t[n][i])return E("interpolatePoint failed because next/previous points are bad in "+i),null;var l=f.default[o||"linear"](t[n-1][r],t[n][r],t[n-1][i],t[n][i],a);return i===r&&(l=new Date(l)),v(l)&&(E("interpolatePoint failed because result is NaN. It was "+i),l=null),l},e.ajax=function(t){var e=new XMLHttpRequest;e.open(t.method,t.url,!0),"POST"!==t.method||t.json?"POST"===t.method&&t.json&&e.setRequestHeader("Content-Type","application/json; charset=UTF-8"):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){var i=t.json?JSON.parse(e.responseText):e.responseText;t.success&&t.success(i)}else t.error&&t.error()},e.onerror=function(){t.error&&t.error()},e.send(t.data)});e.get=function(t,e,i,n,r){e=e||[],S(e,function(t,i){e.push(i+"="+t)}),t=e.length?t+"?"+e.join("&"):t,P({method:"GET",url:t,success:i,error:n,json:r})},e.post=function(t,e,i,n,r){P({method:"POST",url:t,success:i,error:n,json:r,data:e})},e.memoize=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),i="",n=e.length,r=null;n--;)r=e[n],i+=r===Object(r)?JSON.stringify(r):r,t.memoize||(t.memoize={});return i in t.memoize?t.memoize[i]:t.memoize[i]=t.apply(this,e)}},e.debounce=function(t,e,i){var n=void 0;return function(){var r=this,a=arguments,o=function(){n=null,i||t.apply(r,a)},s=i&&!n;clearTimeout(n),n=setTimeout(o,e),s&&t.apply(r,a)}},e.isTouchDevice=function(){return null!=((d3.event||{}).sourceCapabilities||{}).firesTouchEvents?d3.event.sourceCapabilities.firesTouchEvents:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},e.pruneTree=function t(e,i){var n={},r=[];return e.hasOwnProperty("children")&&(r=e.children.map(function(e){return t(e,i)}).filter(function(t){return 0!==Object.keys(t).length})),(0!=r.length||i(e))&&S(e,function(t,e){n[e]=t}),0!=r.length&&(n.children=r),n},e.setIcon=function(t,e){return t.selectAll("*").remove(),t.node().appendChild(t.node().ownerDocument.importNode((new DOMParser).parseFromString(e,"application/xml").documentElement,!0)),t},e.capitalize=function(t){return t.slice(0,1).toUpperCase()+t.slice(1).toLowerCase()},e.isMobileOrTablet=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))},e.isFunction=function(t){return"function"==typeof t},e.getProp=function(t,e,i){for(;e.length;){var n=e.shift();if(!t.hasOwnProperty(n))return i;t=t[n]}return t},e.px2num=function(t){return g(t)&&t.endsWith("px")?parseFloat(t):console.warn("Strange pixels value: "+t)||t},e.replaceNumberSpacesToNonBreak=function(t){return t?t.replace(/\d{1,3}(?: \d{3})+(?=\W)/g,function(t){return t.replace(/ /g,"Â ")}):t},e.getSubtitle=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],i=t.replace(e,"");","===i[0]&&(i=i.slice(1));var n=/^\((.*)\)$|.*/.exec(i.trim());return n[1]||n[0]||""},e.getBrowserDetails=function(){var t=(navigator.appVersion,navigator.userAgent),e=navigator.appName,i=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10),r=void 0,a=void 0,o=void 0,s=navigator.userAgent.toLowerCase().indexOf(" electron/")>-1;return-1!=(a=t.indexOf("Opera"))?(e="Opera",i=t.substring(a+6),-1!=(a=t.indexOf("Version"))&&(i=t.substring(a+8))):-1!=(a=t.indexOf("MSIE"))?(e="Microsoft Internet Explorer",i=t.substring(a+5)):-1!=(a=t.indexOf("Chrome"))?(e="Chrome",i=t.substring(a+7)):-1!=(a=t.indexOf("Safari"))?(e="Safari",i=t.substring(a+7),-1!=(a=t.indexOf("Version"))&&(i=t.substring(a+8))):-1!=(a=t.indexOf("Firefox"))?(e="Firefox",i=t.substring(a+8)):(r=t.lastIndexOf(" ")+1)<(a=t.lastIndexOf("/"))&&(e=t.substring(r,a),i=t.substring(a+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),-1!=(o=i.indexOf(";"))&&(i=i.substring(0,o)),-1!=(o=i.indexOf(" "))&&(i=i.substring(0,o)),n=parseInt(""+i,10),v(n)&&(i=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10)),(s?"Electron ":"")+e+" "+n+" ("+i+")"},e.getOSname=function(){var t="Unknown";return-1!=window.navigator.userAgent.indexOf("Windows NT 10.0")&&(t="Windows 10"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(t="Windows 8"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(t="Windows 7"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(t="Windows Vista"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(t="Windows XP"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(t="Windows 2000"),-1!=window.navigator.userAgent.indexOf("Mac")&&(t="Mac/iOS"),-1!=window.navigator.userAgent.indexOf("X11")&&(t="UNIX"),-1!=window.navigator.userAgent.indexOf("Linux")&&(t="Linux"),t}},function(t,e,i){var n=i(5);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var i=function(e){return t.replace(/<%=([^%]*)%>/g,function(t){var i=t.match(/t\s*\(([^)]+)\)/g);return i.length?i=e.t(i[0].match(/"([^"]+)"/g)[0].split('"').join("")):(i=t.match(/([a-z\-A-Z]+([a-z\-A-Z0-9]?[a-zA-Z0-9]?)?)/g)[0],i=e[i]||i),i})},n=/<[a-z][\s\S]*>/i.test(t)?i:p[t]=p[t]||r(d.default.templates[t]);return e?n(e):n}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(49),l=n(s),c=i(48),u=n(c),h=i(110),d=n(h),f=i(21),p={},m=l.default.extend({init:function(t,e){if(this._id=this._id||o.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||t.name||this._id,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||t.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!o.isElement(this.placeholder))try{this.placeholder=e.placeholder.querySelector(this.placeholder)}catch(t){o.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=e||null,this.root=this.parent?this.parent.root:this,this.components=this.components||[],this._components_config=this.components.map(function(t){return o.clone(t)}),this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.createModel(t.model),this.ui=this.model.ui||this.ui||t.ui,this._super(),this.registerListeners()},createModel:function(t){this.model=this._modelMapping(t)},registerListeners:function(){this.on({readyOnce:this.readyOnce,ready:this.ready,domReady:this.domReady,resize:this.resize})},startPreload:function(){var t=[];return t.push(this.preload()),o.forEach(this.components,function(e){return t.push(e.startPreload())}),Promise.all(t)},preload:function(){return Promise.resolve()},afterPreload:function(){this.model&&this.model.afterPreload(),o.forEach(this.components,function(t){t.afterPreload()})},render:function(){this.prerender(),this.postrender()},prerender:function(){this.loadTemplate(),this.loadSubComponents()},postrender:function(){var t=this;o.forEach(this.components,function(e){e.render(),t.on("resize",function(){e.trigger("resize")})}),this.startLoading()},startLoading:function(){var t=this;this.model.on("ready",function(){t.loadingDone()}),this.model&&this.model.isLoading()||this.loadingDone()},loadingDone:function(){o.removeClass(this.placeholder,"vzb-loading-first"),o.removeClass(this.placeholder,"vzb-loading-data"),this.setReady()},renderError:function(t){var e=this;if(!t)return o.warn("renderError() was called without any specific error. Not rendering anything then.");if(o.hasClass(this.placeholder,"vzb-error"))return o.warn("The app is already showing error dialog. Not rendering again.");o.removeClass(this.placeholder,"vzb-loading-first"),o.removeClass(this.placeholder,"vzb-loading-data"),o.addClass(this.placeholder,"vzb-error");var i=this.model._root.locale.getTFunction(),n="mailto:angie@gapminder.org?subject=Gapminder Vizabi error report&body=Hi Angie! Please have a look at this! %0D%0A %0D%0A %0D%0A\n      These are the steps to reproduce the error: %0D%0A \n      1. Go to "+window.location.origin+" %0D%0A \n      2. %5Bplease write here what you did%5D %0D%0A %0D%0A %0D%0A"+encodeURIComponent(JSON.stringify(t,null,4));this.errorMessageEl.classed("vzb-hidden",!1);var r=this.errorMessageEl.select(".vzb-error-message-technical").html(JSON.stringify(t,null,2));this.errorMessageEl.select(".vzb-error-message-expand").on("click",function(){return r.classed("vzb-hidden",!r.classed("vzb-hidden"))}).html(i("crash/expand")),this.errorMessageEl.select(".vzb-error-message-close").on("click",function(){e.errorMessageEl.classed("vzb-hidden",!0),o.removeClass(e.placeholder,"vzb-error")}),this.errorMessageEl.select(".vzb-error-message-title").select("h1").html(t.icon||"ðŸ™„");var a="crash/intro",s="crash/outro",l={};i(t.name)!==t.name&&(a="reader/error/generic",s=t.name,"reader/error/wrongTimeUnitsOrColumn"===t.name&&(l={expected:this.model._root.state.time.getFormatter()(new Date),found:t.details}),"reader/error/repeatedKeys"===t.name&&(l=t.details),"reader/error/undefinedDelimiter"===t.name&&(l={file:t.endpoint})),this.errorMessageEl.select(".vzb-error-message-intro").html(i(a,l).replace("mailto",n)),this.errorMessageEl.select(".vzb-error-message-outro").html(i(s,l).replace("mailto",n)),o.error(JSON.stringify(t,null,2))},setReady:function(t){this._readyOnce||(this.trigger("readyOnce"),this._readyOnce=!0),this._ready=!0,this.trigger("ready")},loadTemplate:function(){var t=this.template,e=this.template_data,i="";if(this.placeholder){if(e=o.extend(e,{t:this.getTranslationFunction(!0)}),this.template)try{i=r(t,e)}catch(t){var n=new Error;n.name="template",n.message="Templating error for component. Check if template name is unique and correct",n.details=this.name,this.renderError(n)}o.addClass(this.placeholder,"vzb-loading-data"),o.addClass(this.placeholder,"vzb-loading-first"),this.placeholder.innerHTML=i,this.element=this.placeholder.children[0],this.errorMessageEl=d3.select(this.element).append("div").attr("class","vzb-error-message vzb-hidden").html('\n        <div class="vzb-error-message-background"></div>\n        <div class="vzb-error-message-box">\n          <div class="vzb-error-message-close">'+f.close+'</div>\n          <div class="vzb-error-message-title"><h1></h1></div>\n          <div class="vzb-error-message-body">\n            <p class="vzb-error-message-intro"></p>\n            <br>\n            <p class="vzb-error-message-expand"></p>\n            <textarea class="vzb-error-message-technical vzb-hidden"></textarea>\n            <br>\n            <p class="vzb-error-message-outro"></p>\n          </div>\n        </div>\n      '),this.trigger("domReady")}},getActiveProfile:function(t,e){var i=this.getLayoutProfile(),n=this.getPresentationMode(),r=o.deepClone(t[i]);return n&&(e||{})[i]&&o.deepExtend(r,e[i]),r},loadSubComponents:function(){var t=this,e=void 0,i=void 0;this.components=[],o.forEach(this._components_config,function(n){if(n.model=n.model||{},!n.component)return void o.error("Error loading component: name not provided");if(i=o.isString(n.component)?m.get(n.component):n.component){e=o.extend(n,{name:n.component,ui:t._uiMapping(n.placeholder,n.ui)});var r=new i(e,t);t.components.push(r)}})},findChildByName:function(t){return o.find(this.components,function(e){return e.name===t})},getLayoutProfile:function(){return this.model.ui?this.model.ui.currentProfile():this.parent.getLayoutProfile()},getPresentationMode:function(){return this.model.ui?this.model.ui.getPresentationMode():this.parent.getPresentationMode()},_uiMapping:function(t,e){if(e)return new u.default("ui",e);if(t&&this.ui){t=t.replace(".","");var i=this.ui[t];if(i)return i}return this.ui},_modelMapping:function(t){function e(t){for(var e=t.split("."),n=i.parent.model,r="";e.length;)r=e.shift(),n=n[r];return{name:t,model:n,type:n?n.getType():null}}var i=this,n={};if(o.isArray(t)&&o.isArray(this.model_expects)){this.model_expects.length!==t.length&&(o.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),o.warn("Please, configure the 'model_expects' attribute accordingly in '"+this.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+this.name+"'\nNumber of Models Expected: "+this.model_expects.length+"\nNumber of Models Received: "+t.length),o.groupEnd()),o.forEach(t,function(r,a){if(r){var s=e(r),l=void 0;i.model_expects[a]?(l=i.model_expects[a].name,!i.model_expects[a].type||s.type===i.model_expects[a].type||o.isArray(i.model_expects[a].type)&&-1!==i.model_expects[a].type.indexOf(s.type)||(o.groupCollapsed("UNEXPECTED MODEL TYPE: '"+s.type+"' instead of '"+i.model_expects[a].type+"'"),o.warn("Please, configure the 'model_expects' attribute accordingly in '"+i.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+i.name+"'\nExpected Model: '"+i.model_expects[a].type+"'\nReceived Model: '"+s.type+"'\nModel order: "+a),o.groupEnd())):(o.groupCollapsed("UNEXPECTED MODEL: '"+t[a]+"'"),o.warn("Please, configure the 'model_expects' attribute accordingly in '"+i.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+i.name+"'\nNumber of Models Expected: "+i.model_expects.length+"\nNumber of Models Received: "+t.length),o.groupEnd(),l=s.name),n[l]=s.model}});var r=t.length,a=this.model_expects.length;return a>r&&(this.model_expects.splice(0,r),o.forEach(a,function(t){n[t.name]={}})),new u.default(this.name,n,null,this.model_binds)}},getTranslationFunction:function(t){var e=void 0;try{e=this.model.get("locale").getTFunction()}catch(t){this.parent&&this.parent!==this&&(e=this.parent.getTranslationFunction())}return e||(e=function(t){return t}),t?this._translatedStringFunction(e):e},_translatedStringFunction:function(t){return function(e){return'<span data-vzb-translate="'+e+'">'+t(e)+"</span>"}},translateStrings:function(){var t=this.getTranslationFunction(),e=this.placeholder.querySelectorAll("[data-vzb-translate]");0!==e.length&&o.forEach(e,function(e){e&&e.getAttribute&&(e.innerHTML=t(e.getAttribute("data-vzb-translate")))})},readyOnce:function(){},ready:function(){},resize:function(){},domReady:function(){},clear:function(){this.freeze(),this.model&&this.model.freeze(),o.forEach(this.components,function(t){t.clear()})}});m.isComponent=function(t){return t._id&&("t"===t._id[0]||"c"===t._id[0])},e.default=m},function(t,e,i){var n=i(61)("wks"),r=i(38),a=i(3).Symbol,o="function"==typeof a;(t.exports=function(t){return n[t]||(n[t]=o&&a[t]||(o?a:r)("Symbol."+t))}).store=n},function(t,e,i){t.exports=!i(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(2),r=i(113),a=i(26),o=Object.defineProperty;e.f=i(8)?Object.defineProperty:function(t,e,i){if(n(t),e=a(e,!0),n(i),r)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var n=i(28),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(27);t.exports=function(t){return Object(n(t))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i){var n=void 0,r=void 0,a=void 0,s=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,f=void 0,p=void 0,m=void 0,g=void 0,v=void 0;return{move:function(e,i){t.style("right",e+"px"),t.style("top",i+"px")},dragStart:function(b){if(o.isTouchDevice()){var y=d3.touches(e.node());n=y[0][0],r=y[0][1]}else n=b.sourceEvent.clientX,r=b.sourceEvent.clientY;a=parseInt(t.style("top"))||0,s=parseInt(t.style("right"))||0,c=parseInt(t.style("margin-left"))||0,l=parseInt(t.style("margin-right"))||0,h=Math.min(i,c),u=Math.min(i,l),d=parseInt(t.style("width"),10)+c-h||0,f=parseInt(t.style("height"),10)||0,p=parseInt(e.style("width"),10)-l||0,m=parseInt(e.style("height"),10)||0,g=n+s,v=r-a},drag:function(t){if(o.isTouchDevice()){var i=d3.touches(e.node());n=i[0][0],r=i[0][1]}else n=t.sourceEvent.clientX,r=t.sourceEvent.clientY;var a=-n+g,s=r-v;a<-u&&(a=-u),s<0&&(s=0),a+d>p&&(a=p-d),s+f>m&&(s=m-f),this.move(a,s)}}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(6),l=n(s),c=i(21),u=i(106),h=n(u),d=(0,h.default)(i(405)),f=l.default.extend({isDialog:!0,init:function(t,e){this.name=this.name||"",this.model_expects=this.model_expects||[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this.template=d[this.name],this._super(t,e),this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"]},readyOnce:function(){this.element=d3.select(this.element),this.titleEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-title"),this.buttonsEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-buttons"),this.contentEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-content")},ready:function(){var t=this;this.placeholderEl=d3.select(this.placeholder),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.dragHandler=this.placeholderEl.select("[data-click='dragDialog']"),this.dragHandler.html(c.drag),this.pinIcon=this.placeholderEl.select("[data-click='pinDialog']"),this.pinIcon.html(c.pin),this.topPos="";var e=this.getLayoutProfile(),i=r(this.placeholderEl,this.rootEl,10),n=d3.drag().on("start",function(){var e=t.placeholderEl.node().offsetTop;t.placeholderEl.style("top",e+"px"),t.placeholderEl.style("bottom","auto"),t.trigger("dragstart"),i.dragStart(d3.event)}).on("drag",function(){t.trigger("drag"),i.drag(d3.event)}).on("end",function(){t.rightPos=t.placeholderEl.style("right"),t.topPos=t.placeholderEl.style("top"),t.trigger("dragend")});this.dragHandler.call(n),this.dragHandler.classed("vzb-hidden","small"===e),this.pinIcon.classed("vzb-hidden","small"===e),this.resize()},resize:function(){if(this.placeholderEl&&this.rootEl&&this.placeholderEl.classed("vzb-top-dialog")){this.placeholderEl.classed("notransition",!0);var t=this.getLayoutProfile();if("small"!==t){var e=parseInt(this.rootEl.style("width"),10)||0,i=parseInt(this.rootEl.style("height"),10)||0,n=parseInt(this.placeholderEl.style("width"),10)||0,r=parseInt(this.placeholderEl.style("height"),10)||0,a=parseInt(this.rightPos,10),s=parseInt(this.topPos,10),l=parseInt(this.placeholderEl.style("margin-right"),10)||0;o.isNumber(a)&&a>e-n-l&&this.rightPos&&(this.rightPos=e-n-l+"px",this.isOpen&&this.placeholderEl.style("right",this.rightPos)),o.isNumber(s)&&o.isNumber(r)&&s>=0&&s>i-r&&this.topPos&&(this.topPos=(i-r>0?i-r:0)+"px",this.isOpen&&this.placeholderEl.style("top",this.topPos)),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style("bottom","auto"),this.rootEl.classed("vzb-landscape"),this.element.style("max-height","")}else this.rightPos="",this.topPos="",this.placeholderEl.attr("style","");this.dragHandler.classed("vzb-hidden","small"===t),this.pinIcon.classed("vzb-hidden","small"===t),this._setMaxHeight()}},_setMaxHeight:function(){var t=this.root.element.offsetHeight;if("small"!==this.getLayoutProfile())if(!this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=parseInt(this.placeholderEl.style("bottom"),10);t-=e}else{var i=this.topPos?parseInt(this.topPos,10):this.placeholderEl.node().offsetTop;t-=i}else t=this.rootEl.classed("vzb-portrait")?t-50:t-10;this.element.style("max-height",t+"px");var n=t-this.titleEl.node().offsetHeight-this.buttonsEl.node().offsetHeight;this.contentEl.style("max-height",n+"px")},beforeOpen:function(){var t=this;if(this.transitionEvents.forEach(function(e){t.placeholderEl.on(e,t.transitionEnd.bind(t,e))}),this.placeholderEl.classed("notransition",!0),this.placeholderEl.style("top",""),this.placeholderEl.style("bottom",""),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=this.placeholderEl.node().offsetTop;this.placeholderEl.style("top",e+"px"),this.placeholderEl.style("bottom","auto")}else this.getLayoutProfile();this.placeholderEl.node().offsetTop,this.placeholderEl.classed("notransition",!1),"small"===this.getLayoutProfile()?this.placeholderEl.style("top",""):this.rootEl.classed("vzb-landscape")},open:function(){this.isOpen=!0,"small"!==this.getLayoutProfile()&&this.topPos&&(this.placeholderEl.style("top",this.topPos),this.placeholderEl.style("right",this.rightPos))},beforeClose:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()&&this.placeholderEl.style("top","auto"),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.placeholderEl.node().parentNode.offsetHeight-this.placeholderEl.node().offsetHeight+"px":""),this.placeholderEl.classed("notransition",!1),this.placeholderEl.node().offsetHeight},close:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()||(this.placeholderEl.style("top",""),this.placeholderEl.style("right","")),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.placeholderEl.style("top",this.topPos0),this.placeholderEl.style("right","")),this.isOpen=!1,this.trigger("close")},transitionEnd:function(t){var e=this;this.transitionEvents.forEach(function(t){e.placeholderEl.on(t,null)}),this.isOpen&&this.placeholderEl.classed("notransition",!0)}});e.default=f},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){var n=i(9),r=i(37);t.exports=i(8)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var n=i(3),r=i(15),a=i(14),o=i(38)("src"),s=Function.toString,l=(""+s).split("toString");i(25).inspectSource=function(t){return s.call(t)},(t.exports=function(t,e,i,s){var c="function"==typeof i;c&&(a(i,"name")||r(i,"name",e)),t[e]!==i&&(c&&(a(i,o)||r(i,o,t[e]?""+t[e]:l.join(String(e)))),t===n?t[e]=i:s?t[e]?t[e]=i:r(t,e,i):(delete t[e],r(t,e,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||s.call(this)})},function(t,e,i){var n=i(0),r=i(4),a=i(27),o=/"/g,s=function(t,e,i,n){var r=String(a(t)),s="<"+e;return""!==i&&(s+=" "+i+'="'+String(n).replace(o,"&quot;")+'"'),s+">"+r+"</"+e+">"};t.exports=function(t,e){var i={};i[t]=e(s),n(n.P+n.F*r(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",i)}},function(t,e,i){var n=i(56),r=i(27);t.exports=function(t){return n(r(t))}},function(t,e,i){var n=i(57),r=i(37),a=i(18),o=i(26),s=i(14),l=i(113),c=Object.getOwnPropertyDescriptor;e.f=i(8)?c:function(t,e){if(t=a(t),e=o(e,!0),l)try{return c(t,e)}catch(t){}if(s(t,e))return r(!n.f.call(t,e),t[e])}},function(t,e,i){var n=i(14),r=i(11),a=i(81)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.paintbrush='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',e.search='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.circle='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',e.expand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',e.asterisk='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',e.trails='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',e.lock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',e.unlock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',e.unexpand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',e.axes='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',e.gear='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',e.stack='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',e.drag='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',e.warn='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',e.pin='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',e.question='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',e.close='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',e.presentation='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',e.about='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',e.cursorArrow='<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',e.cursorPlus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.cursorMinus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.hundredPercent='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',e.percent='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',e.side='<svg class="vzb-icon" viewBox="-120 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="rotate(-90) scale(1.2)" d="M1024 448q0 -26 -19 -45l-448 -448q-19 -19 -45 -19t-45 19l-448 448q-19 19 -19 45t19 45t45 19h896q26 0 45 -19t19 -45zM1024 832q0 -26 -19 -45t-45 -19h-896q-26 0 -45 19t-19 45t19 45l448 448q19 19 45 19t45 -19l448 -448q19 -19 19 -45z"/></svg>',e.cursorHand='<svg class="vzb-icon" viewBox="0 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="scale(1,-1)" d="M880 1408q-46 0 -79 -33t-33 -79v-656h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528v-256l-154 205q-38 51 -102 51q-53 0 -90.5 -37.5t-37.5 -90.5q0 -43 26 -77l384 -512q38 -51 102 -51h688q34 0 61 22t34 56l76 405q5 32 5 59v498q0 46 -33 79t-79 33t-79 -33t-33 -79v-272h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528h-32v656q0 46 -33 79t-79 33zM880 1536q68 0 125.5 -35.5t88.5 -96.5q19 4 42 4q99 0 169.5 -70.5t70.5 -169.5v-17q105 6 180.5 -64t75.5 -175v-498q0 -40 -8 -83l-76 -404q-14 -79 -76.5 -131t-143.5 -52h-688q-60 0 -114.5 27.5t-90.5 74.5l-384 512q-51 68 -51 154q0 106 75 181t181 75q78 0 128 -34v434q0 99 70.5 169.5t169.5 70.5q23 0 42 -4q31 61 88.5 96.5t125.5 35.5z"/></svg>'},function(t,e,i){var n=i(13);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){"use strict";var n=i(4);t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e){var i=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=i)},function(t,e,i){var n=i(5);t.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:i)(t)}},function(t,e,i){var n=i(0),r=i(25),a=i(4);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],o={};o[t]=e(i),n(n.S+n.F*a(function(){i(1)}),"Object",o)}},function(t,e,i){var n=i(22),r=i(56),a=i(11),o=i(10),s=i(98);t.exports=function(t,e){var i=1==t,l=2==t,c=3==t,u=4==t,h=6==t,d=5==t||h,f=e||s;return function(e,s,p){for(var m,g,v=a(e),b=r(v),y=n(s,p,3),_=o(b.length),x=0,w=i?f(e,_):l?f(e,0):void 0;_>x;x++)if((d||x in b)&&(m=b[x],g=y(m,x,v),t))if(i)w[x]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return x;case 2:w.push(m)}else if(u)return!1;return h?-1:c||u?u:w}}},function(t,e,i){"use strict";function n(t,e){function i(){this.trackInstances&&i.instances.push(this),!a&&this.init&&this.init.apply(this,arguments)}e=1===arguments.length?t:e;var s=this.prototype;a=!0;var l=new this;return a=!1,(0,r.forEach)(e,function(t,i){"function"==typeof e[i]&&"function"==typeof s[i]&&o.test(e[i])?l[i]=function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(i,e[i]):l[i]=t}),i.prototype=l,i.prototype.constructor=i,i.extend=n,i._collection={},i.instances=[],i.register=function(t,e){void 0!==this._collection[t]&&(0,r.warn)('"'+t+'" is already registered. Overwriting...'),this._collection[t]=e},i.unregister=function(t){this._collection[t]=void 0},i.getCollection=function(){return this._collection},i.define=function(t,e){this.prototype[t]=e},i.get=function(t,e){return this._collection.hasOwnProperty(t)?this._collection[t]:(e||(0,r.warn)('"'+t+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(t,i),i}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=!1,o=/xyz/.test(function(){})?/\b_super\b/:/.*/,s=function(){};s.extend=n,e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(55),l=n(s),c=i(49),u=(n(c),l.default.extend({_important:!1,objectLeafs:["autoconfig"],dataConnectedChildren:["use","which"],getClassDefaults:function(){var t={data:"data",which:null};return o.deepExtend(this._super(),t)},buildScale:function(){},setInterModelListeners:function(){var t=this,e=this._parent.getSpace(this);o.forEach(e,function(e){t._space[e]=t.getClosestModel(e),t._space[e].on("dataConnectedChange",t.handleDataConnectedChange.bind(t))}),this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},onSuccessfullLoad:function(){this.validate(),this.buildScale(),this._super()},setWhich:function(t){var e={which:t.concept};t.dataSource&&(e.data=t.dataSource);var i=this.getClosestModel(e.data||this.data),n=i.getConceptprops(t.concept);t.use&&(e.use=t.use),n&&n.scales&&(e.scaleType=n.scales[0]),"axis"!==this.getType()&&"size"!==this.getType()||(e.domainMin=null,e.domainMax=null,e.zoomedMin=null,e.zoomedMax=null),"property"===t.use&&t.key&&1===t.key.length&&(e.spaceRef=o.find(this._space,function(e){return e.dim===t.key[0].concept})._name),"constant"!==t.use&&"indicator"!==t.use||(e.spaceRef=null),this.set(e,void 0,void 0,void 0,this.setWhich)},setScaleType:function(t){this.buildScale(t)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data),this._super()},afterPreload:function(){this.autoconfigureModel(),this.spaceRef||(this.spaceRef=this.updateSpaceReference())},autoconfigureModel:function(t){if(!this.which&&this.autoconfig){if(t||(t=this._parent.getAvailableConcept(this.autoconfig)),t){var e=t.value,i={which:e.concept,use:(t.key.size||t.key.length)>1||"time"===this.autoconfig.type?"indicator":"property",scaleType:e.scales[0]||"linear"};this.set(i)}else{var n={which:"_default",use:"constant",scaleType:"ordinal"};this.set(n)}o.printAutoconfigResult(this)}},updateSpaceReference:function(){if("property"!==this.use)return null;var t="entities"+this._name.replace(this._type,"");return this._space[t]?t:this._parent.getSpace()[0]._name},loadData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.which||"constant"===this.use)return Promise.resolve();this.trigger("hook_change"),this.dataSource=this.getClosestModel(this.data);var e=this.getQuery(t.splashScreen);if(!0===e)return Promise.resolve();this._loadCall=!0,this.setReady(!1),o.timeStamp("Vizabi Model: Loading Data: "+this._id);var i=this._getAllParsers(),n=this.dataSource.load(e,i);return n.then(this.afterLoad.bind(this),function(t){return o.warn("Problem with query: ",t,JSON.stringify(e))}),n},handleDataConnectedChange:function(t){var e=this;o.defer(function(){e.startLoading().catch(o.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},afterLoad:function(t){this._dataId=t,o.timeStamp("Vizabi Model: Data loaded: "+this._id)},getQuery:function(t){var e=void 0;if(Object.keys(this._space).length<1)return o.error("Error:",this._id,"can't find the space"),!0;var i="property"===this.use||"constant"===this.use,n=i?{exceptType:"time"}:{},r=o.unique(this._getAllDimensions(n)),a="property"===this.use&&r.length>1?[-1!==r.indexOf(this.which)?this.which:this.getEntity().dim]:r;if(!a||!a.length)return o.warn("getQuery() produced no query because no keys are available"),!0;var s={key:a,value:-1!=a.indexOf(this.which)||"constant"===this.use?[]:[this.which]},l=this._getFirstDimension({type:"time"}),c=i?"entities":"datapoints";if(e=this._getAllFilters(n,{splash:t,entityTypeRequest:i}),i&&r.length>1){var u={};e[a]&&(u[a]=e[a]),e=u}var h={};if(Object.keys(e).length>0){h.$and=[];for(var d in e){var f={};f[d]=e[d],h.$and.push(f)}}var p=this._getAllJoins(n,{splash:t,entityTypeRequest:i});if(i&&r.length>1){var m={};p["$"+a]&&(m["$"+a]=p["$"+a]),p=m}var g=this._parent._getGrouping();g&&(g=o.clone(g,a),o.isEmpty(g)&&(g=!1));var v={language:this.getClosestModel("locale").id,from:c,animatable:l,select:s,where:h,join:p,order_by:i?["rank"]:[this._space.time.dim]};return g&&(v.grouping=g),v},_getAllDimensions:function(t){return this._parent._getAllDimensions(t)},_getFirstDimension:function(t){return this._parent._getFirstDimension(t)},_getAllFilters:function(t,e){t=t||{};var i={},n=this;return o.forEach(this._space,function(r){if(t.exceptType&&r.getType()===t.exceptType)return!0;if(t.onlyType&&r.getType()!==t.onlyType)return!0;if(o.arrayEquals(n._getAllDimensions(t),[r.getDimension()]))i=o.extend(i,r.getFilter(e));else{var a=r.getFilter(e);if(null!=a&&!o.isEmpty(a)){var s={};s[r.getDimension()]="$"+r.getDimension(),i=o.extend(i,s)}}}),i},_getAllJoins:function(t,e){var i={},n=this;return o.forEach(this._space,function(r){if(t.exceptType&&r.getType()===t.exceptType)return!0;if(t.onlyType&&r.getType()!==t.onlyType)return!0;if(o.arrayEquals(n._getAllDimensions(t),[r.getDimension()]))return!0;var a=r.getFilter(e);null==a||o.isEmpty(a)||(i["$"+r.getDimension()]={key:r.getDimension(),where:r.getFilter(e)})}),i},_getAllParsers:function(){return Object.values(this._space).concat(this).reduce(function(t,e){var i=e.getParser(),n=e.getDimensionOrWhich();return i&&n&&!(n in t)&&(t[n]=i),t},{})},getTickFormatter:function(){var t=this;return function(e,i,n,r,a){if(a=t.getConceptprops().format,"share"===a&&(e*=100),o.isDate(e))return t._space.time.formatDate(e);if("time"===t.scaleType&&!o.isDate(e))return t._space.time.formatDate(new Date(e));if(o.isString(e)||!e&&0!==e)return e;if(Math.abs(e)<1e-14)return"0";var s="";if(r)return d3.format(".3r")(e);switch(Math.floor(Math.log(Math.abs(e))/Math.LN10+1e-14)){case-13:e*=1e12,s="p";break;case-10:e*=1e9,s="n";break;case-7:case-6:case-5:e*=1e6,s="Âµ";break;case-4:case-3:case-2:case-1:case 0:case 1:case 2:case 3:break;case 4:case 5:e/=1e3,s="k";break;case 6:case 7:case 8:e/=1e6,s="M";break;case 9:case 10:case 11:e/=1e9,s="B";break;case 12:case 13:case 14:e/=1e12,s="TR";break;default:return d3.format(".3s")(e).replace("G","B")}var l=d3.format(".3r")(e);return l.indexOf(".")>-1&&(l=l.replace(/0+$/,"").replace(/\.$/,"")),l+s+("percent"===a||"share"===a?"%":"")}},getScale:function(){return null==this.scale&&console.warn("scale is null"),this.scale},getUnique:function(t){if(this.isHook())return t||(t=this._getFirstDimension({type:"time"})),this.dataSource.getData(this._dataId,"unique",t)},getData:function(){return this.dataSource.getData(this._dataId)},getValidItems:function(){return this.dataSource.getData(this._dataId,"valid",this.which)},getNestedItems:function(t){return t?this.dataSource.getData(this._dataId,"nested",t):o.warn("No keys provided to getNestedItems(<keys>)")},getHaveNoDataPointsPerKey:function(){return this.dataSource.getData(this._dataId,"haveNoDataPointsPerKey",this.which)},getLimits:function(t){return this.dataSource.getData(this._dataId,"limits",t)},getFrame:function(t,e,i){return this.dataSource.getFrame(this._dataId,t,e,i)},getFrames:function(t,e){return this.dataSource.getFrames(this._dataId,t,e)},getItems:function(t){var e=this,i=this.spaceRef&&this._space[this.spaceRef]?this._space[this.spaceRef].dim:e._getFirstDimension({exceptType:"time"}),n={},r=this.getValidItems(),a=t?this.getEntity().getFilteredEntities().map(function(t){return t[i]}):[],s=a.length;return o.isArray(r)&&r.forEach(function(t){s&&!a.includes(t[i])||(n[t[i]]=t[e.which])}),n},getLimitsByDimensions:function(t){var e=this.dataSource.getData(this._dataId,"nested",t),i={},n=this.which,r=function(t,e,i){for(var r=t.reduce(function(t,e){var i=o.isDate(e[n])?e[n]:parseFloat(e[n]);return isNaN(i)||t.push(i),t},[]),a=void 0,s=void 0,l={},c=0;c<r.length;c+=1){var u=r[c];(void 0===a||u<a)&&(a=u),(void 0===s||u>s)&&(s=u)}l.min=a||0,l.max=s||100,e[i]=l};return o.forEach(e,function(t,e){var n=i[JSON.parse(e).join(",")]={};o.forEach(t,function(t,e){r(t,n,e)})}),i},getConceptprops:function(){return"constant"!==this.use&&this.dataSource?this.dataSource.getConceptprops(this.which):{}},isDiscrete:function(){return"ordinal"===this.scaleType},validate:function(){var t=this;if(this._super(),this.which){var e=this.scaleType,i=this.getConceptprops()||{},n=i.scales,a=void 0===n?[]:n;this.allow&&this.allow.scales&&this.allow.scales.length>0&&(a=a.filter(function(e){return-1!=t.allow.scales.indexOf(e)}));var o=a.includes(e),s=a.includes("log")&&"genericLog"===e;if(!o&&!s&&a.length>0){var l=a,c=r(l,1),u=c[0];this.set({scaleType:u},null,!1)}}},getEntity:function(){return this._space[this.spaceRef]||this._parent._space[this.spaceRef]||this._parent._space[this._parent.getSpace()[0]]},getDataKeys:function(){return this.spaceRef?[this.getEntity().dim]:this._getAllDimensions({exceptType:"time"})}}));e.default=u},function(t,e,i){"use strict";if(i(8)){var n=i(39),r=i(3),a=i(4),o=i(0),s=i(71),l=i(104),c=i(22),u=i(45),h=i(37),d=i(15),f=i(47),p=i(28),m=i(10),g=i(139),v=i(41),b=i(26),y=i(14),_=i(58),x=i(5),w=i(11),S=i(95),M=i(42),k=i(20),E=i(43).f,z=i(97),O=i(38),T=i(7),C=i(30),P=i(62),D=i(69),A=i(100),I=i(53),L=i(66),j=i(44),R=i(99),F=i(129),N=i(9),B=i(19),H=N.f,q=B.f,K=r.RangeError,V=r.TypeError,Y=r.Uint8Array,W=Array.prototype,X=l.ArrayBuffer,U=l.DataView,G=C(0),Q=C(2),$=C(3),Z=C(4),J=C(5),tt=C(6),et=P(!0),it=P(!1),nt=A.values,rt=A.keys,at=A.entries,ot=W.lastIndexOf,st=W.reduce,lt=W.reduceRight,ct=W.join,ut=W.sort,ht=W.slice,dt=W.toString,ft=W.toLocaleString,pt=T("iterator"),mt=T("toStringTag"),gt=O("typed_constructor"),vt=O("def_constructor"),bt=s.CONSTR,yt=s.TYPED,_t=s.VIEW,xt=C(1,function(t,e){return Et(D(t,t[vt]),e)}),wt=a(function(){return 1===new Y(new Uint16Array([1]).buffer)[0]}),St=!!Y&&!!Y.prototype.set&&a(function(){new Y(1).set({})}),Mt=function(t,e){var i=p(t);if(i<0||i%e)throw K("Wrong offset!");return i},kt=function(t){if(x(t)&&yt in t)return t;throw V(t+" is not a typed array!")},Et=function(t,e){if(!(x(t)&&gt in t))throw V("It is not a typed array constructor!");return new t(e)},zt=function(t,e){return Ot(D(t,t[vt]),e)},Ot=function(t,e){for(var i=0,n=e.length,r=Et(t,n);n>i;)r[i]=e[i++];return r},Tt=function(t,e,i){H(t,e,{get:function(){return this._d[i]}})},Ct=function(t){var e,i,n,r,a,o,s=w(t),l=arguments.length,u=l>1?arguments[1]:void 0,h=void 0!==u,d=z(s);if(void 0!=d&&!S(d)){for(o=d.call(s),n=[],e=0;!(a=o.next()).done;e++)n.push(a.value);s=n}for(h&&l>2&&(u=c(u,arguments[2],2)),e=0,i=m(s.length),r=Et(this,i);i>e;e++)r[e]=h?u(s[e],e):s[e];return r},Pt=function(){for(var t=0,e=arguments.length,i=Et(this,e);e>t;)i[t]=arguments[t++];return i},Dt=!!Y&&a(function(){ft.call(new Y(1))}),At=function(){return ft.apply(Dt?ht.call(kt(this)):kt(this),arguments)},It={copyWithin:function(t,e){return F.call(kt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return Z(kt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return R.apply(kt(this),arguments)},filter:function(t){return zt(this,Q(kt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return J(kt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(kt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){G(kt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return it(kt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return et(kt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ct.apply(kt(this),arguments)},lastIndexOf:function(t){return ot.apply(kt(this),arguments)},map:function(t){return xt(kt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return st.apply(kt(this),arguments)},reduceRight:function(t){return lt.apply(kt(this),arguments)},reverse:function(){for(var t,e=this,i=kt(e).length,n=Math.floor(i/2),r=0;r<n;)t=e[r],e[r++]=e[--i],e[i]=t;return e},some:function(t){return $(kt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ut.call(kt(this),t)},subarray:function(t,e){var i=kt(this),n=i.length,r=v(t,n);return new(D(i,i[vt]))(i.buffer,i.byteOffset+r*i.BYTES_PER_ELEMENT,m((void 0===e?n:v(e,n))-r))}},Lt=function(t,e){return zt(this,ht.call(kt(this),t,e))},jt=function(t){kt(this);var e=Mt(arguments[1],1),i=this.length,n=w(t),r=m(n.length),a=0;if(r+e>i)throw K("Wrong length!");for(;a<r;)this[e+a]=n[a++]},Rt={entries:function(){return at.call(kt(this))},keys:function(){return rt.call(kt(this))},values:function(){return nt.call(kt(this))}},Ft=function(t,e){return x(t)&&t[yt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Nt=function(t,e){return Ft(t,e=b(e,!0))?h(2,t[e]):q(t,e)},Bt=function(t,e,i){return!(Ft(t,e=b(e,!0))&&x(i)&&y(i,"value"))||y(i,"get")||y(i,"set")||i.configurable||y(i,"writable")&&!i.writable||y(i,"enumerable")&&!i.enumerable?H(t,e,i):(t[e]=i.value,t)};bt||(B.f=Nt,N.f=Bt),o(o.S+o.F*!bt,"Object",{getOwnPropertyDescriptor:Nt,defineProperty:Bt}),a(function(){dt.call({})})&&(dt=ft=function(){return ct.call(this)});var Ht=f({},It);f(Ht,Rt),d(Ht,pt,Rt.values),f(Ht,{slice:Lt,set:jt,constructor:function(){},toString:dt,toLocaleString:At}),Tt(Ht,"buffer","b"),Tt(Ht,"byteOffset","o"),Tt(Ht,"byteLength","l"),Tt(Ht,"length","e"),H(Ht,mt,{get:function(){return this[yt]}}),t.exports=function(t,e,i,l){l=!!l;var c=t+(l?"Clamped":"")+"Array",h="get"+t,f="set"+t,p=r[c],v=p||{},b=p&&k(p),y=!p||!s.ABV,w={},S=p&&p.prototype,z=function(t,i){var n=t._d;return n.v[h](i*e+n.o,wt)},O=function(t,i,n){var r=t._d;l&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),r.v[f](i*e+r.o,n,wt)},T=function(t,e){H(t,e,{get:function(){return z(this,e)},set:function(t){return O(this,e,t)},enumerable:!0})};y?(p=i(function(t,i,n,r){u(t,p,c,"_d");var a,o,s,l,h=0,f=0;if(x(i)){if(!(i instanceof X||"ArrayBuffer"==(l=_(i))||"SharedArrayBuffer"==l))return yt in i?Ot(p,i):Ct.call(p,i);a=i,f=Mt(n,e);var v=i.byteLength;if(void 0===r){if(v%e)throw K("Wrong length!");if((o=v-f)<0)throw K("Wrong length!")}else if((o=m(r)*e)+f>v)throw K("Wrong length!");s=o/e}else s=g(i),o=s*e,a=new X(o);for(d(t,"_d",{b:a,o:f,l:o,e:s,v:new U(a)});h<s;)T(t,h++)}),S=p.prototype=M(Ht),d(S,"constructor",p)):a(function(){p(1)})&&a(function(){new p(-1)})&&L(function(t){new p,new p(null),new p(1.5),new p(t)},!0)||(p=i(function(t,i,n,r){u(t,p,c);var a;return x(i)?i instanceof X||"ArrayBuffer"==(a=_(i))||"SharedArrayBuffer"==a?void 0!==r?new v(i,Mt(n,e),r):void 0!==n?new v(i,Mt(n,e)):new v(i):yt in i?Ot(p,i):Ct.call(p,i):new v(g(i))}),G(b!==Function.prototype?E(v).concat(E(b)):E(v),function(t){t in p||d(p,t,v[t])}),p.prototype=S,n||(S.constructor=p));var C=S[pt],P=!!C&&("values"==C.name||void 0==C.name),D=Rt.values;d(p,gt,!0),d(S,yt,c),d(S,_t,!0),d(S,vt,p),(l?new p(1)[mt]==c:mt in S)||H(S,mt,{get:function(){return c}}),w[c]=p,o(o.G+o.W+o.F*(p!=v),w),o(o.S,c,{BYTES_PER_ELEMENT:e}),o(o.S+o.F*a(function(){v.of.call(p,1)}),c,{from:Ct,of:Pt}),"BYTES_PER_ELEMENT"in S||d(S,"BYTES_PER_ELEMENT",e),o(o.P,c,It),j(c),o(o.P+o.F*St,c,{set:jt}),o(o.P+o.F*!P,c,Rt),n||S.toString==dt||(S.toString=dt),o(o.P+o.F*a(function(){new p(1).slice()}),c,{slice:Lt}),o(o.P+o.F*(a(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!a(function(){S.toLocaleString.call([1,2])})),c,{toLocaleString:At}),I[c]=P?C:D,n||P||d(S,pt,D)}}else t.exports=function(){}},function(t,e,i){var n=i(134),r=i(0),a=i(61)("metadata"),o=a.store||(a.store=new(i(137))),s=function(t,e,i){var r=o.get(t);if(!r){if(!i)return;o.set(t,r=new n)}var a=r.get(e);if(!a){if(!i)return;r.set(e,a=new n)}return a},l=function(t,e,i){var n=s(e,i,!1);return void 0!==n&&n.has(t)},c=function(t,e,i){var n=s(e,i,!1);return void 0===n?void 0:n.get(t)},u=function(t,e,i,n){s(i,n,!0).set(t,e)},h=function(t,e){var i=s(t,e,!1),n=[];return i&&i.forEach(function(t,e){n.push(e)}),n},d=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},f=function(t){r(r.S,"Reflect",t)};t.exports={store:o,map:s,has:l,get:c,set:u,keys:h,key:d,exp:f}},function(t,e,i){var n=i(38)("meta"),r=i(5),a=i(14),o=i(9).f,s=0,l=Object.isExtensible||function(){return!0},c=!i(4)(function(){return l(Object.preventExtensions({}))}),u=function(t){o(t,n,{value:{i:"O"+ ++s,w:{}}})},h=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,n)){if(!l(t))return"F";if(!e)return"E";u(t)}return t[n].i},d=function(t,e){if(!a(t,n)){if(!l(t))return!0;if(!e)return!1;u(t)}return t[n].w},f=function(t){return c&&p.NEED&&l(t)&&!a(t,n)&&u(t),t},p=t.exports={KEY:n,NEED:!1,fastKey:h,getWeak:d,onFreeze:f}},function(t,e,i){var n=i(7)("unscopables"),r=Array.prototype;void 0==r[n]&&i(15)(r,n,{}),t.exports=function(t){r[n][t]=!0}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e){t.exports=!1},function(t,e,i){var n=i(115),r=i(82);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var n=i(28),r=Math.max,a=Math.min;t.exports=function(t,e){return t=n(t),t<0?r(t+e,0):a(t,e)}},function(t,e,i){var n=i(2),r=i(116),a=i(82),o=i(81)("IE_PROTO"),s=function(){},l=function(){var t,e=i(79)("iframe"),n=a.length;for(e.style.display="none",i(83).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;n--;)delete l.prototype[a[n]];return l()};t.exports=Object.create||function(t,e){var i;return null!==t?(s.prototype=n(t),i=new s,s.prototype=null,i[o]=t):i=l(),void 0===e?i:r(i,e)}},function(t,e,i){var n=i(115),r=i(82).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,r)}},function(t,e,i){"use strict";var n=i(3),r=i(9),a=i(8),o=i(7)("species");t.exports=function(t){var e=n[t];a&&e&&!e[o]&&r.f(e,o,{configurable:!0,get:function(){return this}})}},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var n=i(22),r=i(127),a=i(95),o=i(2),s=i(10),l=i(97),c={},u={},e=t.exports=function(t,e,i,h,d){var f,p,m,g,v=d?function(){return t}:l(t),b=n(i,h,e?2:1),y=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(a(v)){for(f=s(t.length);f>y;y++)if((g=e?b(o(p=t[y])[0],p[1]):b(t[y]))===c||g===u)return g}else for(m=v.call(t);!(p=m.next()).done;)if((g=r(m,b,p.value,e))===c||g===u)return g};e.BREAK=c,e.RETURN=u},function(t,e,i){var n=i(16);t.exports=function(t,e,i){for(var r in e)n(t,r,e[r],i);return t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){Object.defineProperty(t,e,{configurable:!0,get:function(e){return function(){return t.get(e)}}(e),set:function(e){return function(i){return t.set(e,i)}}(e)})}function a(t,e,n,r){function a(t,e){n._ready&&(e=n._name+"."+e,n.trigger(t,e))}function o(t,e){n.trigger(t,e)}function s(t,e){n.setReady(!1),l.defer(function(){n.setReady()})}var c=void 0;if(!l.isPlainObject(e)||l.isArray(e)||n.isObjectLeaf(t)){c=new f(t,e,n,{change:a},r)}else{var u={change:a,hook_change:o,load_error:function(){return n.trigger.apply(n,arguments)},dataLoaded:function(){return n.trigger.apply(n,arguments)},ready:s};if(p.isModel(e,!0))c=e,c.on(u);else{var h=t.split("_")[0],d=p.get(h,!0);if(!d)try{d=i(393)("./"+h).default}catch(t){d=p}c=new d(t,e,n,u)}}return c}function o(t){return t._intervals||(t._parent?o(t._parent):new d.default)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(s),c=i(49),u=n(c),h=i(392),d=n(h),f=u.default.extend({_name:"",_parent:null,_persistent:!0,init:function(t,e,i,n,r){Object.defineProperty(this,"value",{get:this.get,set:this.set}),Object.defineProperty(this,"persistent",{get:function(){return this._persistent}}),this._super(),this._name=t,this._parent=i,this._root=i._root,this.set(e,!1,r),this.on(n)},get:function(t){return t&&!this._persistent?this._persistentVal:this._val},set:function(t,e,i){return!!this.isSetAllowed(t,e)&&(i=void 0===i||i,i&&(this._persistentVal=t),this._previousVal=l.deepClone(this._val),this._val=t,this._persistent=i,this.trigger(new c.ChangeEvent(this),this._name),!0)},isSetAllowed:function(t,e){return e||this._val!==t&&JSON.stringify(this._val)!==JSON.stringify(t)},setTreeFreezer:function(t){t?this.freeze(["hook_change"]):this.unfreeze()}}),p=u.default.extend({getClassDefaults:function(){return{}},objectLeafs:[],init:function(t,e,i,n){this._type=this._type||"model",this._id=this._id||l.uniqueId("m"),this._data={},this._parent=i,this._root=i?i._root:this,this._name=t,this._inError=!1,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._intervals=o(this),this._space={},this._dataId=!1,this._limits={},this._super();var r=l.deepExtend({},this.getClassDefaults(),e);this.set(r),n&&this.on(n)},get:function(t){if(t){var e=this._data[t];return p.isModel(e)?e:e.value}return this._data},set:function(t,e,i,n,o){var s=this._setting,c=void 0,u=!1;if(l.isPlainObject(t)?(c=t,n=i,i=e):(c={})[t]=e,0!==Object.keys(c).length){this._setting=!0,this._freeze||(u=!0,this.setTreeFreezer(!0));var h=[];for(var d in c){e=c[d];var m=l.isPlainObject(e)&&this._data[d]instanceof p,g=(!l.isPlainObject(e)||this.isObjectLeaf(d))&&this._data[d]instanceof f;if(this._data[d]&&(m||g)){var v=this._data[d].value,b=this._data[d].set(e,i,n);g&&b&&h.push(d);var y="set"+l.capitalize(d[0])+d.slice(1);this.isHook()&&l.isFunction(this[y])&&o!==this[y]&&e!==v&&this[y]("which"===d?{concept:e}:e)}else this._data[d]=a(d,e,this,n),r(this,d)}s||(this.checkDataChanges(h),this.validate&&this.validate()),s&&!i||(this._setting=!1,!u||this.isHook()&&this.isLoading()||this.setTreeFreezer(!1),this.isHook()||this.isLoading()||this.setReady())}},checkDataChanges:function(){},setTreeFreezer:function(t){l.forEach(this._data,function(e){e.setTreeFreezer(t)}),t?this.freeze(["hook_change"]):this.unfreeze()},getType:function(){return this._type},getSubmodels:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},i=t?{}:[];return l.forEach(this._data,function(n,r){n&&void 0!==n._id&&p.isModel(n)&&e(n)&&(t?i[r]=n:i.push(n))}),i},getPlainObject:function(t){var e={},i=this;return l.forEach(this._data,function(n,r){if(n instanceof p)e[r]=n.getPlainObject(t);else if(!t||n.persistent){var a=n.get(t);l.isDate(a)&&(a=i.formatDate(a)),e[r]=a}}),e},formatDate:function(t){return t.toString()},getModelObject:function(t){return t?this._data[t]:this},clear:function(){var t=this.getSubmodels();for(var e in t)t[e].clear();this.setReady(!1),this.off(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},_isLoading:function(){return!1},isLoading:function(){if(this._isLoading())return!0;var t=this.getSubmodels(),e=void 0;for(e=0;e<t.length;e+=1)if(t[e].isLoading())return!0;return!1},setReady:function(t){if(!1===t)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));var e=this._ready;this._ready=!this.isLoading()&&!this._setting,this._ready&&e!==this._ready&&(this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready"))},setInterModelListeners:function(){l.forEach(this.getSubmodels(),function(t){return t.setInterModelListeners()})},startPreload:function(){var t=[];return t.push(this.preloadData()),l.forEach(this.getSubmodels(),function(e){return t.push(e.startPreload())}),Promise.all(t)},preloadData:function(){return Promise.resolve()},startLoading:function(t){var e=this,i=[];return i.push(this.loadData(t)),l.forEach(this.getSubmodels(),function(e){return i.push(e.startLoading(t))}),Promise.all(i).then(this.onSuccessfullLoad.bind(this)).catch(function(t){l.error("error in model "+e._name),e.triggerLoadError(t)})},loadData:function(t){return this.isHook()&&l.warn("Hook "+this._name+" is not loading because it's not extending Hook prototype."),Promise.resolve()},loadSubmodels:function(t){var e=[],i=this.getSubmodels();return l.forEach(i,function(i){e.push(i.startLoading(t))}),e.length>0?Promise.all(e):Promise.resolve()},onSuccessfullLoad:function(){var t=this;this.validate(),l.timeStamp("Vizabi Model: Model loaded: "+this._name+"("+this._id+")"),this._loadedOnce=!0,this._loadCall=!1,this.setTreeFreezer(!1),l.defer(function(){return t.setReady()})},handleLoadError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getDefaultError();this.triggerLoadError(t)},getDefaultError:function(){var t=new Error;return t.message=this.getClosestModel("locale").getTFunction()("connection/error"),t},triggerLoadError:function(t){if(u.default.unfreezeAll(),this._inError)return l.error("Model "+this._name+" already in error");this._inError=!0,this._root.trigger("load_error",t),this._root.trigger("load_error1",t)},afterPreload:function(){var t=this.getSubmodels();l.forEach(t,function(t){t.afterPreload()})},isHook:function(){return Boolean(this.use)},getSubhooks:function(t){return this.getSubmodels(t,function(t){return t.isHook()})},getHookWhich:function(t){var e=[];return this.use&&this.use===t&&e.push(this.which),l.forEach(this.getSubmodels(),function(i){e=l.unique(e.concat(i.getHookWhich(t)))}),e},getIndicators:function(){return this.getHookWhich("indicator")},getProperties:function(){return this.getHookWhich("property")},getDimension:function(){return this.dim||!1},getDimensionOrWhich:function(){return this.dim||"constant"!=this.use&&this.which},getFilter:function(){return{}},mapValue:function(t){return t},getParser:function(){return null},getDefaults:function(){return l.deepExtend({},this.getClassDefaults(),this.getSubmodelDefaults())},getSubmodelDefaults:function(){var t={};return l.forEach(this.getSubmodels(!0),function(e,i){t[i]=e.getDefaults()}),t},isObjectLeaf:function(t){return-1!==this.objectLeafs.indexOf(t)},getClosestModel:function(t){var e=this.findSubmodel(t);return e||(this._parent?this._parent.getClosestModel(t):null)},findSubmodel:function(t){for(var e in this._data)if(e===t&&p.isModel(this._data[e]))return this._data[e];return null},isEntities:function(){return!1}});p.isModel=function(t,e){return t&&(t.hasOwnProperty("_data")||e&&t.hasOwnProperty("_val"))},e.default=p},function(t,e,i){"use strict";function n(t){u=!0,t&&(s.isArray(t)||(t=[t]),s.forEach(t,function(t){d[t]=!0}))}function r(){u=!1,d={};for(var t=Object.keys(h),e=0;e<t.length;e++){var i=h[t[e]];i&&i.unfreeze()}h={}}Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=e.DefaultEvent=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=i(1),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o),l=i(31),c=function(t){return t&&t.__esModule?t:{default:t}}(l),u=!1,h=[],d={},f=e.DefaultEvent=c.default.extend({source:"",type:"default",init:function(t,e){this.source=t,e&&(this.type=e)}}),p=(e.ChangeEvent=f.extend("change",{type:"change",init:function(t){this._super(t)}}),c.default.extend({init:function(){this._id=this._id||s.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(t,e,i){if(!this.splitEventParameters(t,e,i,this.on)){var n=this.traversePath(e);n&&(n._events[t]=n._events[t]||[],"function"==typeof i?n._events[t].push(i):s.warn("Can't bind event '"+t+"'. It must be a function."))}},off:function(t,e,i){if(0==arguments.length)return void(this._events={});if(!this.splitEventParameters(t,e,i,this.off)){var n=this.traversePath(e);if(n&&n._events.hasOwnProperty(t)){if(void 0===i)return void(n._events[t]=[]);var r=n._events[t].indexOf(i);r>-1?n._events[t].splice(r,1):s.warn("Could not unbind function "+i.name+". Function not in bound function list.")}}},splitEventParameters:function(t,e,i,n){var r=void 0;if(s.isArray(t)){for(r=0;r<t.length;r+=1)n.call(this,t[r],i);return!0}if(s.isObject(t)){for(r in t)n.call(this,r,t[r]);return!0}if("function"==typeof e){if(i=e,-1!==t.indexOf(":")){var a=t.split(":");t=a[0],e=a[1]}else e=void 0;return n.call(this,t,e,i),!0}if(s.isArray(e)){for(r=0;r<e.length;r+=1)n.call(this,t,e[r],i);return!0}if(i&&s.isArray(i)){for(r=0;r<i.length;r+=1)n.call(this,t,e,i[r]);return!0}return!1},traversePath:function(t){if(void 0===t||s.isArray(t)&&0==t.length)return this;if("string"==typeof t&&(t=t.split(".")),!s.isArray(t))return s.error("Path is wrong type. Path should be a string or array but is "+(void 0===t?"undefined":a(t))+"."),null;var e=t.shift();if(void 0!==this[e])return this.getModelObject(e).traversePath(t);s.warn("Can't find child \""+e+'" of the model '+this._name+".")},createEventFromType:function(t){if(t instanceof f)return t;var e=f.get(t,!0);return e?new e(this):new f(this,t)},trigger:function(t,e){var i=this,n=void 0,r=void 0;if(s.isArray(t))for(n=0,r=t.length;n<r;n+=1)this.trigger(t[n],e);else{var a=this.createEventFromType(t);if(this._events.hasOwnProperty(a.type)){var o=this;s.forEach(this._events[a.type],function(t){var n=function(){var i="Vizabi Event: "+a.type;s.timeStamp(i),t.apply(o,[a,e])};i.allowExecution(a)?n():(i._freezer.push(n),u&&!h[i._id]&&(i.freeze(),h[i._id]=i))})}}},allowExecution:function(t){return!this._freeze&&!u||u&&d.hasOwnProperty(t.type)||!u&&this._freeze&&this._freezeExceptions.hasOwnProperty(t.type)},freeze:function(t){if(this._freeze=!0,t){s.isArray(t)||(t=[t]);for(var e=0;e<t.length;e+=1)this._freezeExceptions[t[e]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){this._freezer.shift()()}},clearFrozen:function(){this._freeze=!1,this._freezeExceptions={},this._freezer=[]}}));p.freezeAll=n,p.unfreezeAll=r,e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(6),s=n(o),l=i(109),c=n(l),u=i(32),h=n(u),d=i(76),f=n(d),p=i(21),m=s.default.extend({init:function(t,e){this.name="gapminder-indicatorpicker",this.template='<span class="vzb-ip-holder"><span class="vzb-ip-select"></span><span class="vzb-ip-info"></span></span>';var i=this;this.model_expects=[{name:"time",type:"time"},{name:"targetModel"},{name:"locale",type:"locale"}],this.showHoverValues=t.showHoverValues||!1,this.model_binds={"translate:locale":function(t){i.updateView()},ready:function(t){i.updateView()}},this.model_binds["change:targetModel"]=function(t,e){-1!=e.indexOf("."+i.targetProp)&&i.updateView()},this._super(t,e),this.model.targetModel.isHook()&&this.showHoverValues&&this.model.targetModel._parent.on("change:highlight",function(t,e){var n=i.model.targetModel;if(n.isHook()){var r=n._parent;if(i.showHoverValues&&"constant"!=n.use){var o=r.getHighlighted();o.length>1||(o.length?r.getFrame(i.model.time.value,function(t){if(!i._highlighted&&t){var e=r.getHighlighted();if(e.length){var o=n.getDataKeys(),s=t[n._name][a.getKey(e[0],o)];if(s&&"color"===n._type&&n.isDiscrete()){var l=n.getColorlegendMarker();l.label.getItems()[s]&&(s=l.label.getItems()[s])}i._highlightedValue=s,i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==n.use,i.updateView()}}}):(null!==e&&"highlight"!==e?e&&(i._highlightedValue=e[n._name],i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==n.use):i._highlighted=!1,i.updateView()))}}}),this.targetProp=t.targetProp||this.model.targetModel instanceof h.default?"which":this.model.targetModel instanceof c.default?"dim":this.model.targetModel instanceof f.default?"space":null},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.el_select=d3.select(this.element).select(".vzb-ip-select"),this.el_select.on("click",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element instanceof Array?t.root.element:d3.select(t.root.element),n=i.node().getBoundingClientRect(),r=t.root.findChildByName("gapminder-treemenu"),a=r.activeProfile.col_width,o=parseInt(r.wrapper.style("padding-left"),10)||0,s=parseInt(r.wrapper.style("padding-right"),10)||0,l=e.bottom-n.top,c=e.left-n.left-.5*(o+s+a-e.width);r.targetModel(t.model.targetModel).alignX("left").alignY("top").top(l).left(c).updateView().toggle()}),this.infoEl=d3.select(this.element).select(".vzb-ip-info"),t.model.targetModel.isHook()&&(a.setIcon(this.infoEl,p.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.root.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element.getBoundingClientRect(),n=e.bottom-i.top,r=e.left-i.left+e.width;t.root.findChildByName("gapminder-datanotes").setHook(t.model.targetModel._name).show().setPos(r,n)}),this.infoEl.on("mouseout",function(){t.root.findChildByName("gapminder-datanotes").hide()}))},updateView:function(){if(this._readyOnce){var t=this,e=this.model.locale.getTFunction(),i=t.model.targetModel,n=i[t.targetProp],r=i._type,a=void 0,o=void 0;if(i instanceof h.default)if(a=i.getConceptprops(),this.showHoverValues&&this._highlighted){var s=i.getTickFormatter();o=this._highlightedValue||0===this._highlightedValue?s(this._highlightedValue):e("hints/nodata")}else o="_default"===n?e("indicator/_default/"+r):a.name_short;else{var l=i._root.dataManager;o=i.space.map(function(t){return l.getConceptProperty(i._space[t].dim,"name")}).join(", ")}this.el_select.text(o).attr("title",function(t){return this.offsetWidth<this.scrollWidth?o:null});var c=a&&!a.description&&!a.sourceName&&!a.sourceLink;this.infoEl.classed("vzb-invisible",c)}}});e.default=m},function(t,e,i){var n=i(9).f,r=i(14),a=i(7)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,a)&&n(t,a,{configurable:!0,value:e})}},function(t,e,i){var n=i(0),r=i(27),a=i(4),o=i(85),s="["+o+"]",l="â€‹Â…",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),h=function(t,e,i){var r={},s=a(function(){return!!o[t]()||l[t]()!=l}),c=r[t]=s?e(d):o[t];i&&(r[i]=c),n(n.P+n.F*s,"String",r)},d=h.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(u,"")),t};t.exports=h},function(t,e){t.exports={}},function(t,e,i){var n=i(5);t.exports=function(t,e){if(!n(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(48),s=n(o),l=i(49),c=(n(l),s.default.extend({dataConnectedChildren:[],checkDataChanges:function(t){var e=this;if(t&&this.dataConnectedChildren&&(!a.isArray(t)&&a.isObject(t)&&(t=Object.keys(t)),0!=t.length&&0!=this.dataConnectedChildren.length)){t.filter(function(t){return-1!==e.dataConnectedChildren.indexOf(t)}).length>0&&(this.trigger("dataConnectedChange"),this.startLoading())}}}));e.default=c},function(t,e,i){var n=i(23);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){var n=i(23),r=i(7)("toStringTag"),a="Arguments"==n(function(){return arguments}()),o=function(t,e){try{return t[e]}catch(t){}};t.exports=function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=o(e=Object(t),r))?i:a?n(e):"Object"==(s=n(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(77),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s={THUMB_HEIGHT:17,THUMB_STROKE_WIDTH:3},l={small:{},medium:{},large:{}},c=o.default.extend({init:function(t,e){this.name="singlehandleslider";var i=r.extend({},s);this.options=r.extend(i,this.options||{});var n=r.extend({},l);this.profiles=r.extend(n,this.profiles||{}),this.slider_properties=t.properties||{};var a=this.slider_properties.roundDigits;(a||0==a)&&(this.options.ROUND_DIGITS=a),this.slider_properties.domain&&(this.options.EXTENT_MIN=this.slider_properties.domain[0],this.options.EXTENT_MAX=this.slider_properties.domain[1]),this._super(t,e)},readyOnce:function(){this._super();var t=this.options,e=t.BAR_WIDTH,i=t.THUMB_HEIGHT;this.padding.top=.5*(i+t.THUMB_STROKE_WIDTH),this.padding.bottom=.5*(i+t.THUMB_STROKE_WIDTH)-e;var n=this._getComponentWidth();n<0&&(n=0),this.rescaler.domain(this.slider_properties.domain||[this.options.EXTENT_MIN,this.options.EXTENT_MAX]),this.rescaler.range(d3.range(0,n,n/(this.rescaler.domain().length-1)).concat([n])),this.sliderEl.call(this.brush.handleSize(t.THUMB_HEIGHT+t.THUMB_STROKE_WIDTH)),this.sliderEl.selectAll(".w").classed("vzb-hidden",!0),this.sliderEl.select(".selection").classed("vzb-hidden",!0),this.sliderEl.select(".overlay").lower().style("stroke-opacity","0").style("stroke-width",.5*i+"px").attr("rx",.5*e).attr("ry",.5*e),this.sliderEl.selectAll(".vzb-slider-thumb-badge").style("stroke-width",this.options.THUMB_STROKE_WIDTH+"px")},_getBrushEventListeners:function(){var t=this,e=this,i=this._super();return{start:i.start,brush:function(){!e.nonBrushChange&&d3.event.sourceEvent&&(e.slider_properties.suppressInput?e._snap(d3.event.selection):i.brush.apply(i,arguments))},end:function(){!e.nonBrushChange&&d3.event.sourceEvent&&(e.slider_properties.snapValue&&t._snap(d3.event.selection),e._setFromExtent(!0,!0))}}},_snap:function(t){var e=this.rescaler.invert(this._extentToValue(t)),i=this.rescaler.domain(),n=i[i.length-1]>i[0],r=d3.bisector(d3[n?"ascending":"descending"]).left(i,e)||1;e=(n?1:-1)*(e-i[r-1]-(i[r]-e))>0?i[r]:i[r-1],this._moveBrush(this._valueToExtent(e))},_createThumbs:function(t){var e=(this.options.BAR_WIDTH,.5*this.options.THUMB_HEIGHT),i=d3.arc().outerRadius(e).startAngle(0).endAngle(2*Math.PI);t.attr("transform","translate("+(e+.5*this.options.THUMB_STROKE_WIDTH)+","+(e+.5*this.options.THUMB_STROKE_WIDTH)+")").append("path").attr("d",i)},_resize:function(){this._super();var t=this._getComponentWidth();this.rescaler.range(d3.range(0,t||1,t/(this.rescaler.domain().length-1)||1).concat([t]))},_valueToExtent:function(t){return[this.rescaler.domain()[0],t]},_extentToValue:function(t){return t[1]},_setModel:function(t,e,i){if(this.slider_properties.suppressInput){if(this._extentToValue(t).toFixed(this.options.ROUND_DIGITS)==this.model.submodel[this.arg])return}this._super(t,e,i)}});e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(6),r=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=r.default.extend({init:function(t,e){this.template='<span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>';var i=this;this.name="gapminder-simplecheckbox",this.checkbox=t.checkbox,this.submodel=t.submodel,this.model_expects=[{name:"mdl"},{name:"locale",type:"locale"}],this.model_binds={"change:mdl":function(t){i.updateView()},"translate:locale":function(t){i.updateView()}};var n=this.submodel?this.submodel+":":"";this.model_binds["change:mdl."+n+this.checkbox]=function(){i.updateView()},this._super(t,e)},ready:function(){this.parentModel=this.submodel?this.model.mdl[this.submodel]:this.model.mdl,this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element);var e="-check-"+t._id;this.labelEl=this.element.select("label").attr("for",e),this.checkEl=this.element.select("input").attr("id",e).on("change",function(){t._setModel(d3.select(this).property("checked"))})},updateView:function(){this.translator=this.model.locale.getTFunction(),this.labelEl.text(this.translator("check/"+this.checkbox)),this.checkEl.property("checked",!!this.parentModel[this.checkbox])},_setModel:function(t){this.parentModel[this.checkbox]=t}})},function(t,e,i){var n=i(3),r=n["__core-js_shared__"]||(n["__core-js_shared__"]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e,i){var n=i(18),r=i(10),a=i(41);t.exports=function(t){return function(e,i,o){var s,l=n(e),c=r(l.length),u=a(o,c);if(t&&i!=i){for(;c>u;)if((s=l[u++])!=s)return!0}else for(;c>u;u++)if((t||u in l)&&l[u]===i)return t||u||0;return!t&&-1}}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var n=i(23);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,i){var n=i(5),r=i(23),a=i(7)("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[a])?!!e:"RegExp"==r(t))}},function(t,e,i){var n=i(7)("iterator"),r=!1;try{var a=[7][n]();a.return=function(){r=!0},Array.from(a,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:i=!0}},a[n]=function(){return o},t(a)}catch(t){}return i}},function(t,e,i){"use strict";var n=i(2);t.exports=function(){var t=n(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,i){"use strict";var n=i(15),r=i(16),a=i(4),o=i(27),s=i(7);t.exports=function(t,e,i){var l=s(t),c=i(o,l,""[t]),u=c[0],h=c[1];a(function(){var e={};return e[l]=function(){return 7},7!=""[t](e)})&&(r(String.prototype,t,u),n(RegExp.prototype,l,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)}))}},function(t,e,i){var n=i(2),r=i(13),a=i(7)("species");t.exports=function(t,e){var i,o=n(t).constructor;return void 0===o||void 0==(i=n(o)[a])?e:r(i)}},function(t,e,i){"use strict";var n=i(3),r=i(0),a=i(16),o=i(47),s=i(35),l=i(46),c=i(45),u=i(5),h=i(4),d=i(66),f=i(51),p=i(86);t.exports=function(t,e,i,m,g,v){var b=n[t],y=b,_=g?"set":"add",x=y&&y.prototype,w={},S=function(t){var e=x[t];a(x,t,"delete"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!u(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof y&&(v||x.forEach&&!h(function(){(new y).entries().next()}))){var M=new y,k=M[_](v?{}:-0,1)!=M,E=h(function(){M.has(1)}),z=d(function(t){new y(t)}),O=!v&&h(function(){for(var t=new y,e=5;e--;)t[_](e,e);return!t.has(-0)});z||(y=e(function(e,i){c(e,y,t);var n=p(new b,e,y);return void 0!=i&&l(i,g,n[_],n),n}),y.prototype=x,x.constructor=y),(E||O)&&(S("delete"),S("has"),g&&S("get")),(O||k)&&S(_),v&&x.clear&&delete x.clear}else y=m.getConstructor(e,t,g,_),o(y.prototype,i),s.NEED=!0;return f(y,t),w[t]=y,r(r.G+r.W+r.F*(y!=b),w),v||m.setStrong(y,t,g),y}},function(t,e,i){for(var n,r=i(3),a=i(15),o=i(38),s=o("typed_array"),l=o("view"),c=!(!r.ArrayBuffer||!r.DataView),u=c,h=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<9;)(n=r[d[h++]])?(a(n.prototype,s,!0),a(n.prototype,l,!0)):u=!1;t.exports={ABV:c,CONSTR:u,TYPED:s,VIEW:l}},function(t,e,i){"use strict";t.exports=i(39)||!i(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete i(3)[t]})},function(t,e,i){"use strict";var n=i(0);t.exports=function(t){n(n.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(22),o=i(46);t.exports=function(t){n(n.S,t,{from:function(t){var e,i,n,s,l=arguments[1];return r(this),e=void 0!==l,e&&r(l),void 0==t?new this:(i=[],e?(n=0,s=a(l,arguments[2],2),o(t,!1,function(t){i.push(s(t,n++))})):o(t,!1,i.push,i),new this(i))}})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(31),l=function(t){return t&&t.__esModule?t:{default:t}}(s),c=l.default.extend({QUERY_FROM_CONCEPTS:"concepts",QUERY_FROM_DATAPOINTS:"datapoints",QUERY_FROM_ENTITIES:"entities",SCHEMA_QUERY_FROM_CONCEPTS:"concepts.schema",SCHEMA_QUERY_FROM_DATAPOINTS:"datapoints.schema",SCHEMA_QUERY_FROM_ENTITIES:"entities.schema",CONDITION_CALLBACKS:{$gt:function(t,e){return e>t},$gte:function(t,e){return e>=t},$lt:function(t,e){return e<t},$lte:function(t,e){return e<=t},$in:function(t,e){return t.includes(e)}},ERRORS:{GENERIC_ERROR:"reader/error/generic"},_name:"reader",load:function(){return Promise.resolve({rows:[],columns:[]})},read:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;t=this._normalizeQuery(t,i);var r=t,a=r.select,s=r.from;return this.load(i).then(function(n){var r=n.rows,o=n.columns;switch(e._checkTimeParser(o,i),e.ensureDataIsCorrect(n,i),!0){case s===e.SCHEMA_QUERY_FROM_CONCEPTS:return[{key:["concept"],value:"concept_type"}];case s===e.SCHEMA_QUERY_FROM_ENTITIES:return o.slice(0,e.keySize).map(function(t){return{key:[t],value:t}});case s===e.SCHEMA_QUERY_FROM_DATAPOINTS:var l=o.slice(0,e.keySize+1);return o.slice(e.keySize+1).map(function(t){return{key:l,value:t}});case s===e.QUERY_FROM_CONCEPTS:return e._getConcepts(o,e._mapRows(r,t,i));case e._isDataQuery(s)&&a.key.length>0:return e._getData(r,t,i);default:return[]}}).catch(function(t){throw o.find(e.ERRORS,function(e){return e===t.name})||(t=e.error(e.ERRORS.GENERIC_ERROR,t)),t.endpoint||(t.endpoint=e._basepath),t.ddfql||(t.ddfql=n),t.details||(t.details=e._name),t})},ensureDataIsCorrect:function(){},_checkTimeParser:function(t,e){var i=t[this.keySize];e[i]||(e[i]=function(t){return t})},_normalizeQuery:function(t,e){var i=Object.assign({},t),n=i.where,a=void 0===n?{}:n,o=i.join,s=void 0===o?{}:o;return a.$and&&(a.$and=a.$and.reduce(function(t,i){return Object.keys(i).forEach(function(n){var a=i[n];if("string"==typeof a&&a.startsWith("$")){var o=s[a].where;Object.keys(o).forEach(function(i){var n=o[i],a=e[i];t[i]=a?"object"===(void 0===n?"undefined":r(n))?Object.keys(n).reduce(function(t,e){return t[e]=a(n[e]),t},{}):a(n):n})}else{var l=e[n];t[n]=l?l(a):a}}),t},{})),i},_getConcepts:function(t,e){var i=this;return t.map(function(r,a){var s={concept:r};if(a<i.keySize)s.concept_type="entity_domain";else if(a===i.keySize)s.concept_type="time";else{s.concept_type="measure";for(var l=e.length-1;l>-1;--l)if(o.isString(e[l][r])&&""!==e[l][r]){s.concept_type="string";var c=n(t,1);s.domain=c[0];break}}return s})},_getData:function(t,e,i){var r=e.order_by,a=void 0===r?[]:r,o=n(a,1),s=o[0];return this._mapRows(t,e,i).reduce(this._applyQuery(e),[]).sort(function(t,e){return t[s]-e[s]})},_isDataQuery:function(t){return[this.QUERY_FROM_DATAPOINTS,this.QUERY_FROM_ENTITIES].includes(t)},_mapRows:function(t,e,i){return t.map(this._getRowMapper(e,i))},_getRowMapper:function(t,e){var i=this;return function(n){var r=!0,a=Object.keys(n).reduce(function(a,s){if(r){var l=n[s],c=String(l).trim(),u=e[s],h=o.isString(l)?u?u(c):i._parse(c):l;h||0===h?a[s]=h:t.select.key.includes(s)&&(r=!1)}return a},{});return r&&a}},_parse:function(t){return t},_applyQuery:function(t){var e=this,i=t.select,r=t.from,a=n(i.key,1),o=a[0],s=[];return function(n,a){if(a){var l=a[o],c=r!==e.QUERY_FROM_ENTITIES||!s.includes(l);if(e._isSuitableRow(t,a)&&c){r===e.QUERY_FROM_ENTITIES&&s.push(l);var u=Object.keys(a).reduce(function(t,e){return(i.key.includes(e)||i.value.includes(e))&&(t[e]=a[e]),t},{});n.push(u)}}return n}},_isSuitableRow:function(t,e){var i=this,n=t.where;return!n.$and||Object.keys(n.$and).every(function(t){var a=n.$and[t],s=e[t];return void 0===s||("object"!==(void 0===a?"undefined":r(a))?s===a||!0===a&&o.isString(s)&&"true"===s.toLowerCase().trim()||!1===a&&o.isString(s)&&"false"===s.toLowerCase().trim():Object.keys(a).every(function(t){return i.CONDITION_CALLBACKS[t](a[t],s)}))})},error:function(t,e,i,n,r){var a=new Error;return a.name=t,a.message=e,a.details=i,a.ddfql=n,a.endpoint=r,a}});e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(48),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({getClassDefaults:function(){var t={select:[],highlight:[],superHighlight:[],opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:1,limit:1e3,allowSelectMultiple:!0};return r.deepExtend(this._super(),t)},init:function(t,e,i,n,r){this._type="marker",this._visible=[],this._super(t,e,i,n,r),this.on("change","space",this.updateSpaceReferences.bind(this))},setInterModelListeners:function(){this._super(),this.updateSpaceReferences()},updateSpaceReferences:function(){var t=this;r.forEach(this.getSpace(),function(e){t._space[e]=t.getClosestModel(e)})},setSpace:function(t){var e=this,i=Object.keys(this.getSubhooks(!0)),n={},a={};(n.space=this._root.dimensionManager.getDimensionModelsForSpace(this._space,t)).filter(function(t){return!e.space.includes(t)}).forEach(function(t){var r=e.getClosestModel(t),o="label"+t.replace(r._type,""),s={which:r.dim,use:"property"},l=e._root.dataManager.getAvailableDataForKey(r.dim,"name","entities")[0];l&&(s.which=l.value,s.data=l.data),i.includes(o)?(s.spaceRef=t,n[o]=s):(s.key=[{concept:r.dim}],s.dataSource=s.data,s.concept=s.which,a[o]=s,n[o]={})}),this.set(n),r.forEach(a,function(t,i){e[i].setInterModelListeners(),e[i].setWhich(t)}),this._dataCube=this.getSubhooks(!0)},getAvailableSpaces:function(){var t=new Map;return r.forEach(this._root._data,function(e){if("data"===e._type){var i=e.getConceptprops();e.keyAvailability.forEach(function(e,n){e.length>1&&t.set(n,e.map(function(t){return i[t]}))})}}),t},getAvailableData:function(){var t=this,e=[];if(0===d3.keys(this._space).length)return r.warn("getAvailableData() is trying to access missing _space items of marker '"+this._name+"' which likely haven't been resoled in time");var i=r.unique(this.space.map(function(e){return t._space[e].dim}));r.forEach(this._root._data,function(t){if("data"===t._type){var n=t.getConceptprops();t.dataAvailability.datapoints.forEach(function(r){i.length==r.key.size&&i.every(function(t){return r.key.has(t)})&&e.push({key:r.key,value:n[r.value],dataSource:t})});t.dataAvailability.entities.forEach(function(r){null!=r.value&&i.forEach(function(i){r.key.has(i)&&-1===r.value.indexOf("is--")&&e.push({key:Array.from(r.key).map(function(t){return n[t]}),value:n[r.value],dataSource:t})})})}});var n=this._root.dataManager.getDataModels().values().next().value;return i.filter(function(t){return null!=t}).forEach(function(t){return e.push({key:[n.getConceptprops(t)],value:n.getConceptprops(t),dataSource:n})}),e.push({key:[n.getConceptprops("_default")],value:n.getConceptprops("_default"),dataSource:n}),e},getAvailableConcept:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index,i=void 0===e?0:e,n=t.type,r=void 0===n?null:n,a=t.includeOnlyIDs,o=void 0===a?[]:a,s=t.excludeIDs,l=void 0===s?[]:s;if(!r&&0==o.length&&0==l.length)return null;var c=this.getAvailableData().filter(function(t){return!(r&&t.value.concept_type&&t.value.concept_type!==r||0!=o.length&&-1===o.indexOf(t.value.concept)||0!=l.length&&-1!=l.indexOf(t.value.concept))});return c[i]||c[c.length-1]},setDataSourceForAllSubhooks:function(t){var e={};this.getSubhooks().forEach(function(i){e[i._name]={data:t}}),this.set(e,null,!1)},validate:function(){var t=this.getDimension(),e=this._visible.map(function(e){return e[t]});e.length&&(this.select=this.select.filter(function(i){return-1!==e.indexOf(i[t])}),this.setHighlight(this.highlight.filter(function(i){return-1!==e.indexOf(i[t])})))},setVisible:function(t){this._visible=t},getVisible:function(t){return this._visible},getSelected:function(t){return t?this.select.map(function(e){return e[t]}):this.select},selectMarker:function(t){var e=this,i=this._createValue(t);this.isSelected(t)?this.select=this.select.filter(function(t){return JSON.stringify(e._createValue(t))!==JSON.stringify(i)}):this.select=this.allowSelectMultiple?this.select.concat(i):[i]},selectAll:function(t,e){if(this.allowSelectMultiple){var i=void 0,n=r.unique(this._getAllDimensions({exceptType:"time"}));this.select=this._visible.map(function(t){return i={},n.forEach(function(e){return i[e]=t[e]}),i})}},isSelected:function(t){var e=this,i=JSON.stringify(this._createValue(t));return-1!==this.select.map(function(t){return JSON.stringify(e._createValue(t))===i}).indexOf(!0)},_createValue:function(t){return this._getAllDimensions({exceptType:"time"}).reduce(function(e,i){return e[i]=t[i],e},{})},getHighlighted:function(t){return t?this.highlight.map(function(e){return e[t]}):this.highlight},setHighlight:function(t){if(!r.isArray(t))return void this.setHighlight([].concat(t));this.getModelObject("highlight").set(t,!1,!1)},setSuperHighlight:function(t){this.getModelObject("superHighlight").set(r.isArray(t)?t:[t],!1,!1)},clearSuperHighlighted:function(){this.setSuperHighlight([])},isSuperHighlighted:function(t){var e=JSON.stringify(this._createValue(t));return~this.superHighlight.findIndex(function(t){return JSON.stringify(t)===e})},setSelect:function(t){if(!r.isArray(t))return void this.setSelect([].concat(t));this.getModelObject("select").set(t)},highlightMarker:function(t){var e=this._createValue(t);this.isHighlighted(t)||this.setHighlight(this.highlight.concat(e))},unhighlightEntity:function(t){var e=this._createValue(t);this.isHighlighted(t)&&this.setHighlight(this.highlight.filter(function(t){return t[dimension]!==e}))},isHighlighted:function(t){var e=this,i=JSON.stringify(this._createValue(t));return-1!==this.highlight.map(function(t){return JSON.stringify(e._createValue(t))===i}).indexOf(!0)},clearHighlighted:function(){this.setHighlight([])},clearSelected:function(){this.select=[]},setLabelOffset:function(t,e){if(0!==e[0]||1!==e[1]){var i=r.unique(this._getAllDimensions({exceptType:"time"})),n=i.join(",");this.select.find(function(e){return r.getKey(e,i)==t[n]}).labelOffset=[Math.round(1e3*e[0])/1e3,Math.round(1e3*e[1])/1e3],this.set("select",this.select,!0)}},getTimeLimits:function(){var t=this,e=this._parent.time,i=[],n=[],a=void 0,o=void 0,s={};this.cachedTimeLimits||(this.cachedTimeLimits={}),r.forEach(this.getSubhooks(),function(l){if("indicator"===l.use&&l.which!=e.dim&&l._important&&l._dataId){var c=t.cachedTimeLimits[l._dataId+l.which];c?(a=c.min,o=c.max):(s=l.getValidItems().map(function(t){return t[e.getDimension()]}),0==s.length&&r.warn("getTimeLimits() was unable to work with an empty array of valid datapoints"),a=d3.min(s),o=d3.max(s)),t.cachedTimeLimits[l._dataId+l.which]={min:a,max:o},i.push(a),n.push(o)}});var l=d3.max(i),c=d3.min(n);return l>c&&(r.warn("getTimeLimits(): Availability of the indicator's data has no intersection. I give up and just return some valid time range where you'll find no data points. Enjoy!"),l=d3.min(i),c=d3.max(n)),!(!a&&!o)&&{min:l,max:c}},getImportantHooks:function(){var t=[];return r.forEach(this._dataCube||this.getSubhooks(!0),function(e,i){e._important&&t.push(i)}),t},getLabelHookNames:function(){var t=this;return r.unique(this._getAllDimensions({exceptType:"time"})).reduce(function(e,i){var n={};r.forEach(t._dataCube||t.getSubhooks(!0),function(t,e){if("property"===t.use)return"label"===t._type&&t.getEntity().dim===i&&(n.label=e),"label"!==t._type&&t.getEntity().dim===i&&(n.key=e),!n.label||!n.key});var a=n.label||n.key;return a&&(e[i]=a),e},{})},getDataKeysPerHook:function(){var t={};return r.forEach(this._dataCube||this.getSubhooks(!0),function(e,i){t[i]=e.getDataKeys()}),t},getKeys:function(t){var e=this,i=void 0;t=t||r.unique(this._getAllDimensions({exceptType:"time"})),t=Array.isArray(t)?t:[t];var n=this._getFirstDimension({type:"time"}),a=this._dataCube||this.getSubhooks(!0),o=t.map(function(t){return[]}),s=t.map(function(t){return[]});return r.forEach(a,function(e,i){if("property"===e.use){var n=t.indexOf(e.getEntity().dim);-1===n||s[n].includes(e.dataSource)||(o[n].push(e),s[n].push(e.dataSource))}}),r.forEach(a,function(e,i){"indicator"===e.use&&e.getDataKeys().forEach(function(i){var n=t.indexOf(i);-1===n||s[n].includes(e.dataSource)||o[n].push(e)})}),o.forEach(function(e,a){var o=[];e.forEach(function(e){var i=e.getDataKeys(),r=i.indexOf(t[a]);o=o.concat(Object.keys(e.getNestedItems(i.concat(n))).map(function(t){return[JSON.parse(t)[r]]}))}),o=r.unique(o),i=i?d3.cross(i,o,function(t,e){return t.concat(e)}):o}),r.forEach(a,function(e,r){if(e._important&&"constant"!==e.use){var a=e.getDataKeys(),o=a.map(function(e){return t.indexOf(e)}).reduce(function(t,e,i){return-1!==e&&(t[i]=e),t},[]);if(o.length){var s=e.getNestedItems(a.concat(n)),l=e.getHaveNoDataPointsPerKey(),c=Object.keys(s),u=Object.keys(l||[]),h=(t.every(function(t,e){return t===a[e]}),c.reduce(function(t,e){return-1==u.indexOf(e)&&(t[JSON.stringify(o.map(function(t,i){return JSON.parse(e)[i]}))]=!0),t},{})),d=i.map(function(t){return JSON.stringify(o.map(function(e){return t[e]}))});i=i.filter(function(t,e){return h[d[e]]})}}}),i.length>e.limit&&(r.warn("MARKER getKeys(): only showing the first "+e.limit+" markerElements of "+e._name+". The rest are not displayed because chart may become slow and crash. Set a higher number in marker.limit or apply entity filters"),i=i.slice(0,e.limit)),i.map(function(e){var i={};return t.map(function(t,n){return i[t]=e[n]}),i})},_getCachePath:function(t){var e=this._parent.time.getAllSteps(),i=this.getClosestModel("locale").id+" - "+e[0]+" - "+e[e.length-1]+" - step:"+this._parent.time.step;this._dataCube=this._dataCube||this.getSubhooks(!0);var n=!1;return r.forEach(this._dataCube,function(t,e){t._loadCall&&(n=!0),i=i+"_"+t._dataId+t.which}),n?null:(t&&(i=i+"_"+t.join(",")),i)},_getGrouping:function(){var t=this._dataCube||this.getSubhooks(!0),e=t[Object.keys(t)[0]]._space,i={};return r.forEach(e,function(t){t.grouping&&(i[t.dim]={grouping:t.grouping})}),!r.isEmpty(i)&&i},_getAllDimensions:function(t){var e=[],i=this;r.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=[],a=void 0;return r.forEach(e,function(e){return!(!t.exceptType||e.getType()!==t.exceptType)||(!(!t.onlyType||e.getType()===t.onlyType)||void((a=e.getDimension())&&n.push(a)))}),n},_getFirstDimension:function(t){var e=[],i=this;r.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=!1;return r.forEach(e,function(e){return t.exceptType&&e.getType()!==t.exceptType?(n=e.getDimension(),!1):t.type&&e.getType()===t.type?(n=e.getDimension(),!1):t.exceptType||t.type?void 0:(n=e.getDimension(),!1)}),n},framesAreReady:function(){var t=this._getCachePath();return!!this.cachedFrames&&Object.keys(this.cachedFrames[t]).length==this._parent.time.getAllSteps().length},getFrame:function(t,e,i){var n=this;this.cachedFrames||(this.cachedFrames={});var a=this._parent.time.getAllSteps(),o=this._getCachePath();if(!o)return e(null,t);if(t&&n.cachedFrames[o]&&n.cachedFrames[o][t])return e(n.cachedFrames[o][t],t);if(!(o=this._getCachePath(i)))return e(null,t);if(t&&n.cachedFrames[o]&&n.cachedFrames[o][t])return e(n.cachedFrames[o][t],t);if(t&&a.length>1){var s=d3.bisectLeft(a,t);if(!a[s])return r.warn("The requested frame is out of range: "+t),e(null,t),null;if(a[s].toString()!=t.toString())return this._interpolateBetweenFrames(t,s,a,function(i){e(i,t)},i),null}n.getFrames(t,i).then(function(){return!t&&n.cachedFrames[o]?e(n.cachedFrames[o],t):n.cachedFrames[o]&&n.cachedFrames[o][t]?e(n.cachedFrames[o][t],t):(r.warn("marker.js getFrame: Data is not available for frame: "+t),e(null,t))})},_interpolateBetweenFrames:function(t,e,i,n,a){var o=this;if(0==e)this.getFrame(i[e],function(t){return n(t)},a);else{var s=i[e-1],l=i[e];this.getFrame(s,function(e){o.getFrame(l,function(i){var a=(t-s)/(l-s),o={};r.forEach(e,function(e,n){o[n]={},r.forEach(e,function(e,s){var l=i[n][s];r.isDate(e)?o[n][s]=t:r.isNumber(e)?o[n][s]=null==e||null==l?null:e+(l-e)*a:o[n][s]=e})}),n(o)},a)},a)}},getFrames:function(t,e){function i(){if(n.partialResult[l].timeOrConstantHooks){var t=n.partialResult[l].timeOrConstantHooks,e=n.getKeys();t.forEach(function(t){var i=t.which,c=t.name,u=i===o;s.forEach(function(t){n.partialResult[l][t][c]={},e.forEach(function(e){n.partialResult[l][t][c][r.getKey(e,a)]=u?new Date(t):i})})}),delete n.partialResult[l].timeOrConstantHooks}}var n=this;this.cachedFrames||(this.cachedFrames={});var a=r.unique(this._getAllDimensions({exceptType:"time"})),o=this._getFirstDimension({type:"time"});this.frameQueues||(this.frameQueues={}),this.partialResult||(this.partialResult={});var s=this._parent.time.getAllSteps(),l=this._getCachePath(e);return l?(this.frameQueues[l]&&this.frameQueues[l]instanceof Promise||(this.frameQueues[l]=new Promise(function(t,c){n.partialResult[l]={},n.partialResult[l].timeOrConstantHooks=[],s.forEach(function(t){n.partialResult[l][t]={}});var u=[];if(r.forEach(n._dataCube,function(t,e){if("constant"===t.use||t.which===o)n.partialResult[l].timeOrConstantHooks.push({name:e,which:t.which});else if(a.includes(t.which)){var i=t.getValidItems();s.forEach(function(r){n.partialResult[l][r][e]={},i.forEach(function(i){n.partialResult[l][r][e][i[t.which]]=i[t.which]})})}else u.push(t)}),u.length>0){var h=[];r.forEach(u,function(t){h.push(new Promise(function(i,a){var o={name:t._name,which:t.which};t.getFrames(s,e).then(function(t){r.forEach(t,function(t,e){n.partialResult[l][e][o.name]=t[o.which]}),i()})}))}),Promise.all(h).then(function(){i(),n.cachedFrames[l]=n.partialResult[l],t()})}else i(),n.cachedFrames[l]=n.partialResult[l],t()})),new Promise(function(c,u){if(s.length<2||!t)n.frameQueues[l].then(function(){c()});else{var h=[];r.forEach(n._dataCube,function(i,r){"constant"===i.use||a.includes(i.which)||i.which===o||function(i,r){h.push(new Promise(function(a,o){i.getFrame(s,t,e).then(function(e){n.partialResult[l][t][r]=e[t][i.which],a()})}))}(i,r)}),h.length>0?Promise.all(h).then(function(){i(),n.cachedFrames[l]||(n.cachedFrames[l]={}),n.cachedFrames[l][t]=n.partialResult[l][t],c()}):c()}})):new Promise(function(t,e){t()})},listenFramesQueue:function(t,e){var i=this,n=r.unique(this._getAllDimensions({exceptType:"time"})),a=this._getFirstDimension({type:"time"}),o=this._parent.time.getAllSteps(),s={};this.getFrames();var l=[],c=o.length,u=!1;r.forEach(i._dataCube,function(r,h){"constant"===r.use||n.includes(r.which)||r.which===a||l.includes(r._dataId)||(l.push(r._dataId),r.dataSource.listenFrame(r._dataId,o,t,function(t,n){var r=n.toString();void 0===s[r]&&(s[r]=[]),s[r].includes(t)||s[r].push(t),s[r].length===l.length&&(u||c!==Object.keys(s).length||(u=!0,i.trigger("dataLoaded")),e(n))}))})},getEntityLimits:function(t){var e=this,i=this._parent.time.getAllSteps(),n=[],a=[];r.forEach(e.getSubhooks(),function(t){"constant"!=t.use&&t._important&&a.push(t._name)});var o=function(e){if(!e)return!1;for(var i=0,n=a.length;i<n;i++)if(!e[a[i]][t]&&0!==e[a[i]][t])return!1;return!0},s=function t(n,r){var a=n();null!=a&&e.getFrame(i[a],function(e){o(e)?r(a):t(n,r)})},l=[];return l.push(new Promise(function(t,e){s(function(){var t=i.length,e=0;return function(){return e<t?e++:null}}(),function(e){n[0]=i[e],t()})})),l.push(new Promise(function(t,e){s(function(){var t=i.length-1;return function(){return t>=0?t--:null}}(),function(e){n[1]=i[e],t()})})),Promise.all(l).then(function(){return{min:n[0],max:n[1]}})},getCompoundLabelText:function(t,e){var i=this._root.dataManager,n=r.unique(this._getAllDimensions({exceptType:"time"})),a=this.getLabelHookNames(),o=n.filter(function(e){return t[e]!==i.getConceptProperty(e,"totals_among_entities")}).map(function(i){return e[a[i]]?e[a[i]][t[i]]:t[i]}).join(", ");return""===o&&(o=this._root.locale.getTFunction()("hints/grandtotal")),o},getSpace:function(){if(r.isArray(this.space))return this.space;r.error('ERROR: space not found.\n You must specify the objects this hook will use under the "space" attribute in the state.\n Example:\n space: ["entities", "time"]')}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(6),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s={EXTENT_MIN:0,EXTENT_MAX:1,BAR_WIDTH:6,THUMB_HEIGHT:20,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,ROUND_DIGITS:2},l={small:{},medium:{},large:{}},c=o.default.extend({init:function(t,e){this.name=this.name||"brushslider";var n=r.extend({},s);this.options=r.extend(n,this.options||{});var a=r.extend({},l);this.profiles=r.extend(a,this.profiles||{}),this.template=this.template||i(402),this.arg=t.arg||"extent",this.model_expects=this.model_expects||[{name:"submodel"},{name:"locale",type:"locale"}],this.model_binds=this.model_binds||{},this.model_binds.ready||(this.model_binds.ready=this.readyHandler.bind(this)),this.model_binds["change:submodel."+this.arg]||(this.model_binds["change:submodel."+this.arg]=this.changeHandler.bind(this)),this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var i=this._valueToExtent(this.model.submodel[this.arg])||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(i)},readyHandler:function(t){},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-slider-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-slider").classed("vzb-slider-"+this.name,!0);var e=this.options,i=e.BAR_WIDTH,n=.5*e.THUMB_HEIGHT,r=(this.padding={top:.5*i,left:n,right:n,bottom:n+e.THUMB_STROKE_WIDTH},this._getComponentWidth()||0);r<0&&(r=0),this.rescaler=d3.scaleLinear().domain([e.EXTENT_MIN,e.EXTENT_MAX]).range([0,r]).clamp(!0),this.brushEventListeners=this._getBrushEventListeners(),this.brush=d3.brushX().handleSize(2*n+2*i).on("start",this.brushEventListeners.start).on("brush",this.brushEventListeners.brush).on("end",this.brushEventListeners.end),this.sliderThumbs=this.sliderEl.selectAll(".handle").data([{type:"w"},{type:"e"}],function(t){return t.type}).enter().append("svg").attr("class",function(t){return"handle handle--"+t.type+" "+t.type}).classed("vzb-slider-thumb",!0),this._createThumbs(this.sliderThumbs.append("g").attr("class","vzb-slider-thumb-badge")),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".selection,.overlay").attr("height",i).attr("rx",.25*i).attr("ry",.25*i).attr("transform","translate(0,"+.5*-i+")"),this.on("resize",function(){t._resize(),t._updateView()})},ready:function(){this.isRTL=this.model.locale.isRTL(),this._resize(),this._updateView()},_getBrushEventListeners:function(){var t=this;return{start:function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1]){t.sliderEl.node().__brush.selection[1][0]+=.01}t._setFromExtent(!1,!1,!1)}},brush:function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1]){t.sliderEl.node().__brush.selection[1][0]+=.01}t._setFromExtent(!0,!1,!1)}},end:function(){!t.nonBrushChange&&d3.event.sourceEvent&&t._setFromExtent(!0,!0)}}},_createThumbs:function(t){var e=this.options.BAR_WIDTH,i=.5*this.options.THUMB_HEIGHT;t.append("path").attr("d","M"+(i+e)+" "+(i+1.5*e)+"l"+-i+" "+1.5*i+"h"+2*i+"Z")},_updateThumbs:function(t){},_updateSize:function(){var t=this._getComponentWidth()+this.padding.left+this.padding.right;this.sliderSvg.attr("height",this._getComponentHeight()+this.padding.top+this.padding.bottom).attr("width",t),this.sliderWrap.attr("transform",this.isRTL?"translate("+(t-this.padding.right)+","+this.padding.top+") scale(-1,1)":"translate("+this.padding.left+","+this.padding.top+")")},_resize:function(){this._updateSize();var t=this._getComponentWidth();this.rescaler.range([0,t])},_getComponentWidth:function(){var t=this.element.node().offsetWidth-this.padding.left-this.padding.right;return t<0?0:t},_getComponentHeight:function(){return this.options.BAR_WIDTH},_updateView:function(){this.sliderEl.call(this.brush.extent([[0,0],[this._getComponentWidth(),this._getComponentHeight()]]));var t=this._valueToExtent(this.model.submodel[this.arg])||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(t)},_moveBrush:function(t){var e=t.map(this.rescaler);this.nonBrushChange=!0,this.sliderEl.call(this.brush.move,[e[0],e[1]+.01]),this.nonBrushChange=!1,this._setFromExtent(!1,!1,!1)},_valueToExtent:function(t){return t},_extentToValue:function(t){return t},_setFromExtent:function(t,e,i){var n=d3.brushSelection(this.sliderEl.node());n&&(n=[this.rescaler.invert(n[0]),this.rescaler.invert(+n[1].toFixed(1))],this._updateThumbs(n),t&&this._setModel(n,e,i))},_setModel:function(t,e,i){var n=this.options.ROUND_DIGITS;t=[+t[0].toFixed(n),+t[1].toFixed(n)];var r={};r[this.arg]=this._extentToValue(t),this.model.submodel.set(r,e,i)}});e.default=c},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n=i(5),r=i(3).document,a=n(r)&&n(r.createElement);t.exports=function(t){return a?r.createElement(t):{}}},function(t,e,i){var n=i(3),r=i(25),a=i(39),o=i(114),s=i(9).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=a?{}:n.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:o.f(t)})}},function(t,e,i){var n=i(61)("keys"),r=i(38);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var n=i(3).document;t.exports=n&&n.documentElement},function(t,e,i){var n=i(5),r=i(2),a=function(t,e){if(r(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{n=i(22)(Function.call,i(19).f(Object.prototype,"__proto__").set,2),n(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return a(t,i),e?t.__proto__=i:n(t,i),t}}({},!1):void 0),check:a}},function(t,e){t.exports="\t\n\v\f\r Â áš€á Žâ€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff"},function(t,e,i){var n=i(5),r=i(84).set;t.exports=function(t,e,i){var a,o=e.constructor;return o!==i&&"function"==typeof o&&(a=o.prototype)!==i.prototype&&n(a)&&r&&r(t,a),t}},function(t,e,i){"use strict";var n=i(28),r=i(27);t.exports=function(t){var e=String(r(this)),i="",a=n(t);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(i+=e);return i}},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e){var i=Math.expm1;t.exports=!i||i(10)>22025.465794806718||i(10)<22025.465794806718||-2e-17!=i(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:i},function(t,e,i){var n=i(28),r=i(27);t.exports=function(t){return function(e,i){var a,o,s=String(r(e)),l=n(i),c=s.length;return l<0||l>=c?t?"":void 0:(a=s.charCodeAt(l),a<55296||a>56319||l+1===c||(o=s.charCodeAt(l+1))<56320||o>57343?t?s.charAt(l):a:t?s.slice(l,l+2):o-56320+(a-55296<<10)+65536)}}},function(t,e,i){"use strict";var n=i(39),r=i(0),a=i(16),o=i(15),s=i(14),l=i(53),c=i(92),u=i(51),h=i(20),d=i(7)("iterator"),f=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,i,m,g,v,b){c(i,e,m);var y,_,x,w=function(t){if(!f&&t in E)return E[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},S=e+" Iterator",M="values"==g,k=!1,E=t.prototype,z=E[d]||E["@@iterator"]||g&&E[g],O=!f&&z||w(g),T=g?M?w("entries"):O:void 0,C="Array"==e?E.entries||z:z;if(C&&(x=h(C.call(new t)))!==Object.prototype&&x.next&&(u(x,S,!0),n||s(x,d)||o(x,d,p)),M&&z&&"values"!==z.name&&(k=!0,O=function(){return z.call(this)}),n&&!b||!f&&!k&&E[d]||o(E,d,O),l[e]=O,l[S]=p,g)if(y={values:M?O:w("values"),keys:v?O:w("keys"),entries:T},b)for(_ in y)_ in E||a(E,_,y[_]);else r(r.P+r.F*(f||k),e,y);return y}},function(t,e,i){"use strict";var n=i(42),r=i(37),a=i(51),o={};i(15)(o,i(7)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(o,{next:r(1,i)}),a(t,e+" Iterator")}},function(t,e,i){var n=i(65),r=i(27);t.exports=function(t,e,i){if(n(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(r(t))}},function(t,e,i){var n=i(7)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[n]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,i){var n=i(53),r=i(7)("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||a[r]===t)}},function(t,e,i){"use strict";var n=i(9),r=i(37);t.exports=function(t,e,i){e in t?n.f(t,e,r(0,i)):t[e]=i}},function(t,e,i){var n=i(58),r=i(7)("iterator"),a=i(53);t.exports=i(25).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||a[n(t)]}},function(t,e,i){var n=i(280);t.exports=function(t,e){return new(n(t))(e)}},function(t,e,i){"use strict";var n=i(11),r=i(41),a=i(10);t.exports=function(t){for(var e=n(this),i=a(e.length),o=arguments.length,s=r(o>1?arguments[1]:void 0,i),l=o>2?arguments[2]:void 0,c=void 0===l?i:r(l,i);c>s;)e[s++]=t;return e}},function(t,e,i){"use strict";var n=i(36),r=i(130),a=i(53),o=i(18);t.exports=i(91)(Array,"Array",function(t,e){this._t=o(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):"keys"==e?r(0,i):"values"==e?r(0,t[i]):r(0,[i,t[i]])},"values"),a.Arguments=a.Array,n("keys"),n("values"),n("entries")},function(t,e,i){var n,r,a,o=i(22),s=i(120),l=i(83),c=i(79),u=i(3),h=u.process,d=u.setImmediate,f=u.clearImmediate,p=u.MessageChannel,m=u.Dispatch,g=0,v={},b=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},y=function(t){b.call(t.data)};d&&f||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return v[++g]=function(){s("function"==typeof t?t:Function(t),e)},n(g),g},f=function(t){delete v[t]},"process"==i(23)(h)?n=function(t){h.nextTick(o(b,t,1))}:m&&m.now?n=function(t){m.now(o(b,t,1))}:p?(r=new p,a=r.port2,r.port1.onmessage=y,n=o(a.postMessage,a,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(n=function(t){u.postMessage(t+"","*")},u.addEventListener("message",y,!1)):n="onreadystatechange"in c("script")?function(t){l.appendChild(c("script")).onreadystatechange=function(){l.removeChild(this),b.call(t)}}:function(t){setTimeout(o(b,t,1),0)}),t.exports={set:d,clear:f}},function(t,e,i){var n=i(3),r=i(101).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,l="process"==i(23)(o);t.exports=function(){var t,e,i,c=function(){var n,r;for(l&&(n=o.domain)&&n.exit();t;){r=t.fn,t=t.next;try{r()}catch(n){throw t?i():e=void 0,n}}e=void 0,n&&n.enter()};if(l)i=function(){o.nextTick(c)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var u=s.resolve();i=function(){u.then(c)}}else i=function(){r.call(n,c)};else{var h=!0,d=document.createTextNode("");new a(c).observe(d,{characterData:!0}),i=function(){d.data=h=!h}}return function(n){var r={fn:n,next:void 0};e&&(e.next=r),t||(t=r,i()),e=r}}},function(t,e,i){"use strict";function n(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=n}),this.resolve=r(e),this.reject=r(i)}var r=i(13);t.exports.f=function(t){return new n(t)}},function(t,e,i){"use strict";function n(t,e,i){var n,r,a,o=new Array(i),s=8*i-e-1,l=(1<<s)-1,c=l>>1,u=23===e?F(2,-24)-F(2,-77):0,h=0,d=t<0||0===t&&1/t<0?1:0;for(t=R(t),t!=t||t===L?(r=t!=t?1:0,n=l):(n=N(B(t)/H),t*(a=F(2,-n))<1&&(n--,a*=2),t+=n+c>=1?u/a:u*F(2,1-c),t*a>=2&&(n++,a/=2),n+c>=l?(r=0,n=l):n+c>=1?(r=(t*a-1)*F(2,e),n+=c):(r=t*F(2,c-1)*F(2,e),n=0));e>=8;o[h++]=255&r,r/=256,e-=8);for(n=n<<e|r,s+=e;s>0;o[h++]=255&n,n/=256,s-=8);return o[--h]|=128*d,o}function r(t,e,i){var n,r=8*i-e-1,a=(1<<r)-1,o=a>>1,s=r-7,l=i-1,c=t[l--],u=127&c;for(c>>=7;s>0;u=256*u+t[l],l--,s-=8);for(n=u&(1<<-s)-1,u>>=-s,s+=e;s>0;n=256*n+t[l],l--,s-=8);if(0===u)u=1-o;else{if(u===a)return n?NaN:c?-L:L;n+=F(2,e),u-=o}return(c?-1:1)*n*F(2,u-e)}function a(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function o(t){return[255&t]}function s(t){return[255&t,t>>8&255]}function l(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function c(t){return n(t,52,8)}function u(t){return n(t,23,4)}function h(t,e,i){E(t[T],e,{get:function(){return this[i]}})}function d(t,e,i,n){var r=+i,a=M(r);if(a+e>t[K])throw I(C);var o=t[q]._b,s=a+t[V],l=o.slice(s,s+e);return n?l:l.reverse()}function f(t,e,i,n,r,a){var o=+i,s=M(o);if(s+e>t[K])throw I(C);for(var l=t[q]._b,c=s+t[V],u=n(+r),h=0;h<e;h++)l[c+h]=u[a?h:e-h-1]}var p=i(3),m=i(8),g=i(39),v=i(71),b=i(15),y=i(47),_=i(4),x=i(45),w=i(28),S=i(10),M=i(139),k=i(43).f,E=i(9).f,z=i(99),O=i(51),T="prototype",C="Wrong index!",P=p.ArrayBuffer,D=p.DataView,A=p.Math,I=p.RangeError,L=p.Infinity,j=P,R=A.abs,F=A.pow,N=A.floor,B=A.log,H=A.LN2,q=m?"_b":"buffer",K=m?"_l":"byteLength",V=m?"_o":"byteOffset";if(v.ABV){if(!_(function(){P(1)})||!_(function(){new P(-1)})||_(function(){return new P,new P(1.5),new P(NaN),"ArrayBuffer"!=P.name})){P=function(t){return x(this,P),new j(M(t))};for(var Y,W=P[T]=j[T],X=k(j),U=0;X.length>U;)(Y=X[U++])in P||b(P,Y,j[Y]);g||(W.constructor=P)}var G=new D(new P(2)),Q=D[T].setInt8;G.setInt8(0,2147483648),G.setInt8(1,2147483649),!G.getInt8(0)&&G.getInt8(1)||y(D[T],{setInt8:function(t,e){Q.call(this,t,e<<24>>24)},setUint8:function(t,e){Q.call(this,t,e<<24>>24)}},!0)}else P=function(t){x(this,P,"ArrayBuffer");var e=M(t);this._b=z.call(new Array(e),0),this[K]=e},D=function(t,e,i){x(this,D,"DataView"),x(t,P,"DataView");var n=t[K],r=w(e);if(r<0||r>n)throw I("Wrong offset!");if(i=void 0===i?n-r:S(i),r+i>n)throw I("Wrong length!");this[q]=t,this[V]=r,this[K]=i},m&&(h(P,"byteLength","_l"),h(D,"buffer","_b"),h(D,"byteLength","_l"),h(D,"byteOffset","_o")),y(D[T],{getInt8:function(t){return d(this,1,t)[0]<<24>>24},getUint8:function(t){return d(this,1,t)[0]},getInt16:function(t){var e=d(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=d(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return a(d(this,4,t,arguments[1]))},getUint32:function(t){return a(d(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return r(d(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return r(d(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){f(this,1,t,o,e)},setUint8:function(t,e){f(this,1,t,o,e)},setInt16:function(t,e){f(this,2,t,s,e,arguments[2])},setUint16:function(t,e){f(this,2,t,s,e,arguments[2])},setInt32:function(t,e){f(this,4,t,l,e,arguments[2])},setUint32:function(t,e){f(this,4,t,l,e,arguments[2])},setFloat32:function(t,e){f(this,4,t,u,e,arguments[2])},setFloat64:function(t,e){f(this,8,t,c,e,arguments[2])}});O(P,"ArrayBuffer"),O(D,"DataView"),b(D[T],v.VIEW,!0),e.ArrayBuffer=P,e.DataView=D},function(t,e,i){var n=i(3),r=n.navigator;t.exports=r&&r.userAgent||""},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t.match(/\//g).length},r=function(t,e){var i=t.keys();return e&&(i=i.filter("function"==typeof e?function(t){return e(n(t))}:function(t){return n(t)===e+1})),i.reduce(function(e,i){var n=/([^\/]+)\..+$/.exec(i)[1];try{var r=t(i);e[n]=r.default||r}catch(t){console.warn("Import error",i,t)}return e},{})};e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(32),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({_important:!0,getClassDefaults:function(){var t={use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,fixBaseline:null,scaleType:"linear",allow:{scales:["linear","log","genericLog","time","pow"]}};return r.deepExtend(this._super(),t)},autoconfigureModel:function(t){!this.which&&this.autoconfig&&"axis"===this._type&&(t=this._parent.getAvailableConcept(this.autoconfig)||this._parent.getAvailableConcept({type:"time"})),this._super(t)},_type:"axis",validate:function(){if(this._super(),this.scale&&"time"==this.scaleType){var t={};null==this.zoomedMin||r.isDate(this.zoomedMin)||(t.zoomedMin=this._space.time.parse(this.zoomedMin.toString())),null==this.zoomedMax||r.isDate(this.zoomedMax)||(t.zoomedMax=this._space.time.parse(this.zoomedMax.toString())),this.set(t)}},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=void 0;if("time"==t){var i=this._space.time,n=i.splash?{min:i.parse(i.startOrigin),max:i.parse(i.endOrigin)}:{min:i.start,max:i.end};e=[n.min,n.max],this.scale=d3.scaleUtc().domain(e)}else{if(this.isDiscrete())e="constant"===this.use?[this.which]:this.getUnique(this.which);else{var a=this.getLimits(this.which);e=[a.min,a.max],e[0]=(this.fixBaseline||0===this.fixBaseline)&&a.min>0?+this.fixBaseline:e[0],e[0]=null!=this.domainMin?+this.domainMin:e[0],e[1]=null!=this.domainMax?+this.domainMax:e[1]}t=d3.min(e)<=0&&d3.max(e)>=0&&"log"===t?"genericLog":t;var o=("ordinal"===t?"point":t)||"linear";this.scale=d3["scale"+r.capitalize(o)]().domain(e)}this.scaleType=t},formatDate:function(t){return this._space.time.formatDate(t)},_getZoomed:function(t){var e=this["zoomed"+t];return null!==e?e:d3[t.toLowerCase()](this.getScale().domain())},getZoomedMin:function(){return this._getZoomed("Min")},getZoomedMax:function(){return this._getZoomed("Max")}});e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(48),s=n(o),l=i(75),c=n(l),u=i(49),h=n(u),d=i(394),f=s.default.extend({getClassDefaults:function(){var t={reader:"csv"};return a.deepExtend(this._super(),t)},trackInstances:!0,init:function(t,e,i,n){this._type="data",this.queryQueue={},this._collection={},this._collectionPromises={},this._super(t,e,i,n),this.readerObject=this.getReader()},preloadData:function(){return this.loadDataAvailability().then(this.loadConceptProps.bind(this))},load:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];this.dataset&&(t.dataset=this.dataset),this.version&&(t.version=this.version);var r=d.DataStorage.getDataId(t,this.readerObject,i);return r?t.grouping?d.DataStorage.aggregateData(r,t,this.readerObject,this.getConceptprops()):Promise.resolve(r):(a.timeStamp("Vizabi Data: Loading Data"),n||h.default.freezeAll(["hook_change","resize"]),d.DataStorage.loadFromReader(t,i,this.readerObject).then(function(i){return t.grouping?d.DataStorage.aggregateData(i,t,e.readerObject,e.getConceptprops()):i}).then(function(t){return n||h.default.unfreezeAll(),t}).catch(function(t){n||h.default.unfreezeAll(),e.handleLoadError(t)}))},getAsset:function(t,e){var i=this;return this.readerObject.getAsset(t).then(function(t){return e(t)}).catch(function(t){return i.handleLoadError(t)})},getReader:function(){var t=c.default.get(this.reader);if(!t)throw new Error("Unknown reader: "+this.reader);return new t(this.getPlainObject())},getData:function(t,e,i,n){return t?d.DataStorage.getData(t,e,i,n):a.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)},loadDataAvailability:function(){var t=this,e={select:{key:["key","value"],value:[]},from:"concepts.schema"},i=a.extend({},e,{from:"entities.schema"}),n=a.extend({},e,{from:"datapoints.schema"});return Promise.all([this.load(e),this.load(i),this.load(n)]).then(this.handleDataAvailabilityResponse.bind(this)).catch(function(e){return t.handleLoadError(e)})},handleDataAvailabilityResponse:function(t){var e=this;this.keyAvailability=new Map,this.dataAvailability=[],t.forEach(function(t){var i=e.getData(t,"query").from.split(".")[0];e.dataAvailability[i]=[],e.getData(t).forEach(function(t){var n=("string"==typeof t.key?JSON.parse(t.key):t.key).sort();e.dataAvailability[i].push({key:new Set(n),value:t.value}),e.keyAvailability.set(n.join(","),n)})})},loadConceptProps:function(){var t=this;return this.loadDataAvailability().then(function(){var e=["concept_type","domain","totals_among_entities","indicator_url","color","scales","interpolation","tags","name","name_short","name_catalog","description","format"],i=t.dataAvailability.concepts.map(function(t){return t.value}),n=e.filter(function(t){return i.includes(t)}),r={select:{key:["concept"],value:n},from:"concepts",where:{},language:t.getClosestModel("locale").id};return t.load(r).then(t.handleConceptPropsResponse.bind(t)).catch(function(e){return t.handleLoadError(e)})})},handleConceptPropsResponse:function(t){var e=this;this.conceptDictionary={_default:{concept:"_default",concept_type:"string",use:"constant",scales:["ordinal"],tags:"_root"}},this.conceptArray=[],this.getData(t).forEach(function(t){var i={};i.concept=t.concept,i.concept_type=t.concept_type,i.sourceLink=t.indicator_url;try{i.color=t.color&&""!==t.color?"string"==typeof t.color?JSON.parse(t.color):t.color:null}catch(t){i.color=null}try{i.scales=t.scales&&""!==t.color?"string"==typeof t.scales?JSON.parse(t.scales):t.scales:null}catch(t){i.scales=null}if(!i.scales)switch(t.concept_type){case"measure":i.scales=["linear","log"];break;case"string":case"entity_domain":case"entity_set":case"boolean":i.scales=["ordinal"];break;case"time":i.scales=["time"];break;default:i.scales=["linear","log"]}t.interpolation?i.interpolation=t.interpolation:"measure"==t.concept_type?i.interpolation=i.scales&&"log"==i.scales[0]?"exp":"linear":"time"==t.concept_type?i.interpolation="linear":i.interpolation="stepMiddle",i.domain=t.domain,i.totals_among_entities=t.totals_among_entities,i.tags=t.tags,i.format=t.format,i.name=t.name||t.concept||"",i.name_catalog=t.name_catalog||"",i.name_short=t.name_short||t.name||t.concept||"",i.description=t.description,e.conceptDictionary[t.concept]=i,e.conceptArray.push(i)})},getConceptprops:function(t){return void 0!==t?this.conceptDictionary[t]?this.conceptDictionary[t]:(a.warn("The concept "+t+" is not found in the dictionary"),null):this.conceptDictionary},getConcept:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index,i=void 0===e?0:e,n=t.type,r=void 0===n?null:n,a=t.includeOnlyIDs,o=void 0===a?[]:a,s=t.excludeIDs,l=void 0===s?[]:s;if(!r&&0==o.length&&0==l.length)return null;var c=this.conceptArray.filter(function(t){return!(r&&t.concept_type&&t.concept_type!==r||0!=o.length&&-1===o.indexOf(t.concept)||0!=l.length&&-1!=l.indexOf(t.concept))});return c[i]||c[c.length-1]},getDatasetName:function(){if(this.readerObject.getDatasetInfo){var t=this.readerObject.getDatasetInfo();return t.name+(t.version?" "+t.version:"")}return this._name},setGrouping:function(t,e){d.DataStorage.setGrouping(t,e)},getFrames:function(t,e,i){return d.DataStorage.getFrames(t,e,i,this.getConceptprops())},getFrame:function(t,e,i,n){return d.DataStorage.getFrame(t,e,i,n)},listenFrame:function(t,e,i,n){d.DataStorage.listenFrame(t,e,i,n)},handleLoadError:function(t){t.browserDetails=a.getBrowserDetails(),t.osName=a.getOSname(),t.homepoint=window.location.href,t.time=(new Date).toString(),this._super(t)}});e.default=f},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(55),s=function(t){return t&&t.__esModule?t:{default:t}}(o),l=s.default.extend({getClassDefaults:function(){var t={show:{},filter:{},dim:null,skipFilter:!1};return a.deepExtend(this._super(),t)},objectLeafs:["show","filter","autoconfig"],dataConnectedChildren:["show","dim","grouping"],init:function(t,e,i,n){this._type="entities",this._super(t,e,i,n)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data||"data"),this._super()},afterPreload:function(){this.autoconfigureModel()},autoconfigureModel:function(){if(!this.dim&&this.autoconfig){var t=this.dataSource.getConcept(this.autoconfig);t&&(this.dim=t.concept),a.printAutoconfigResult(this)}},setInterModelListeners:function(){this.getClosestModel("locale").on("dataConnectedChange",this.loadData.bind(this))},getDimension:function(){return this.dim},setDimension:function(t){if(this.dim!==t){var e={};e.show={},e.dim=t,this.set(e)}},getFilter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.entityTypeRequest,i=a.deepClone(this.filter[this.dim]||{});if(e||this.skipFilter)return i;var n=a.deepClone(this.show);n[this.dim]&&a.isEmpty(n[this.dim])&&delete n[this.dim];var r=[];return a.isEmpty(i)||r.push(i),a.isEmpty(n)||r.push(n),r.length>1?{$and:r}:r[0]||{}},loadData:function(){var t=this,e=this;if(!this.dim)return this._entitySets={},this._entitySetsData={},this._entitySetsValues={},Promise.resolve();var i=this.dim;if(this._entitySets=n({},i,this._root.dataManager.getAvailableDataForKey(i,null,"entities").filter(function(e){return e.value!==i&&["entity_set","entity_domain"].includes(t._root.dataManager.getConceptProperty(e.value,"concept_type"))}).map(function(t){return t.value})),!this._entitySets[i].length)return this._entitySetsValues=n({},i,[]),this._entitySetsData=n({},i,{}),Promise.resolve();var r={language:this.getClosestModel("locale").id},a=[this._root.dataManager.getDimensionValues(i,this._entitySets[i],r)].concat(this._entitySets[i].map(function(e){return t._root.dataManager.getDimensionValues(e,["name"],r)}));return Promise.all(a).then(function(t){e._entitySetsValues=n({},i,t[0]),e._entitySetsData=n({},i,{}),e._entitySets[i].forEach(function(n,r){e._entitySetsData[i][n]=t[r+1]})})},getEntitySets:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this["_entitySets"+a.capitalize(t)][this.dim]},showEntity:function(t){var e=this,i=a.deepClone(this.show),r=this.getDimension(),o=void 0;o=a.isArray(t)?t:[t];var s=i[r]||(i.$and||[]).filter(function(t){return t[r]})[0]||{$in:[]};a.forEach(o,function(t){var i=t[r];e.isShown(t)?s.$in=s.$in.filter(function(t){return t!==i}):s.$in=s.$in.concat(i)}),0===s.$in.length?i.$and?i.$and=i.$and.filter(function(t){return!t[r]}):delete i[r]:i.$and?i.$and.push(n({},r,s)):i[r]=s,this.show=i},isShown:function(t){var e=this.getDimension(),i=this.show[e]||(this.show.$and||[]).filter(function(t){return t[e]})[0]||{},n=i.$in;return(void 0===n?[]:n).includes(t[e])},isInShowFilter:function(t,e){var i=this.getDimension(),n=(t[i],(this.show.$and||[this.show]).filter(function(t){return t[e]})[0]||{});return a.getProp(n,[e,"$in"],[]).includes(t[e])},clearShow:function(){var t=this.getDimension(),e=a.deepClone(this.show);delete e[t],this.show=e},getFilteredEntities:function(){var t=this.getDimension(),e=this.show[t]||{},i=e.$in;return(void 0===i?[]:i).map(function(e){return n({},t,e)})},isEntities:function(){return!0}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={build:1522445132733,version:"0.31.0"}},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t){return function e(i){function r(t,e,i){return i.indexOf(t)===e}function a(t){var e=a.scale().domain(),n=a.scale().range();if(!e[0]&&0!==e[0]||!e[1]&&0!==e[1]||!n[0]&&0!==n[0]||!n[1]&&0!==n[1])return o.warn("d3.axisSmart() skips action because of invalid domain "+JSON.stringify(e)+" or range "+JSON.stringify(n)+" of the attached scale");if(null!=v)return void a.highlightValueRun(t);var r=t.append("g").attr("class","tick widthSampling"),s=r.append("text").text("0");S.cssMargin||(S.cssMargin={}),S.cssMargin.top=s.style("margin-top"),S.cssMargin.bottom=s.style("margin-bottom"),S.cssMargin.left=s.style("margin-left"),S.cssMargin.right=s.style("margin-right"),S.widthOfOneDigit=s.node().getBBox().width,S.heightOfOneDigit=s.node().getBBox().height,r.remove(),a.labelFactory(S);var l=null;i(S.transitionDuration>0?l=t.transition().duration(S.transitionDuration):t),t.attr("fill",null),t.attr("font-size",null),t.attr("font-family",null),t.attr("text-anchor",null);var c="top"==a.orient()||"bottom"==a.orient()?h:u,p=c==h&&a.pivot()||c==u&&!a.pivot()?f:d;t.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text");var m=a.tickPadding();if(t.selectAll("text").each(function(t,e){if(null!=a.pivot()){var i=d3.select(this);i.attr("transform","rotate("+(a.pivot()?-90:0)+")"),i.style("text-anchor",p==d?"middle":"end"),i.attr("x",p==d?c==u?-m:0:-m),i.attr("y",p==d?c==u?0:m:0),i.attr("dx",p==d&&c==u?m:0),i.attr("dy",p==d?c==u?-m:".72em":".32em")}}),null!=a.repositionLabels()){var g=function(){t.selectAll(".tick").each(function(t){var e=d3.select(this).select("text"),i=a.repositionLabels()[t]||{x:0,y:0};e.attr("x",+e.attr("x")+i.x),e.attr("y",+e.attr("y")+i.y)})};l?l.on("end",function(){return g()}):g()}var b=a.scale();S.viewportLength&&t.selectAll(".tick").classed("vzb-hidden",function(t){return b(t)<0||b(t)>S.viewportLength}),null==a.tickValuesMinor()&&a.tickValuesMinor([]);var y=t.selectAll(".tick-minor").data(x);y.exit().remove(),y=y.enter().append("line").attr("class","tick-minor").merge(y);var _=a.tickSizeMinor().outbound,w=a.tickSizeMinor().inbound;y.classed("vzb-hidden",function(t){return b(t)<0||b(t)>S.viewportLength}).attr("y1",c==h?("top"==a.orient()?1:-1)*w:b).attr("y2",c==h?("top"==a.orient()?-1:1)*_:b).attr("x1",c==u?("right"==a.orient()?-1:1)*w:b).attr("x2",c==u?("right"==a.orient()?1:-1)*_:b),t.selectAll("path").remove();var M=t.selectAll(".vzb-axis-line").data([0]);M.exit().remove(),M=M.enter().append("line").attr("class","vzb-axis-line").merge(M),S.viewportLength?M.attr("x1",c==u?0:-1).attr("x2",c==u?0:S.viewportLength).attr("y1",0).attr("y2",c==h?0:S.viewportLength):M.attr("x1",c==u?0:d3.min(b.range())-(S.bump||0)-1).attr("x2",c==u?0:d3.max(b.range())+(S.bump||0)).attr("y1",c==h?0:d3.min(b.range())-(S.bump||0)).attr("y2",c==h?0:d3.max(b.range())+(S.bump||0))}function s(t,e){null==e&&(e=!0);var i=[],n=[];-1!=t.indexOf(0)&&(i.push([0]),n.push(t.indexOf(0)));for(var r=t.length;r>=1;r=r<4?r-1:r/2)!function(r){i.push(t.filter(function(t,i){return!(i%Math.floor(r)!=0||-1!=n.indexOf(i)&&e)&&(n.push(i),!0)}))}(r);return i}function l(t,e,i,n,r){if(!t)return null;var a={},o=i==u?{head:e.toolMargin.top,tail:e.toolMargin.bottom}:{head:e.toolMargin.right,tail:e.toolMargin.left},s=n.range(),l=e.bump;return e.viewportLength&&(t=t.filter(function(t){return n(t)>=0&&n(t)<=e.viewportLength}),s=[0,e.viewportLength],l=0),t.forEach(function(c,d){if(0==d||d==t.length-1){var f=Math.min(o.head,.5*e.widthOfOneDigit)+l+(i==h?1:0)*d3.max(s)-(i==h?0:1)*d3.min(s)+(i==h?-1:1)*n(c)-("x"==r)*e.formatter(c).length*e.widthOfOneDigit/2-("y"==r)*e.heightOfOneDigit/2-("x"==r)*parseInt(e.cssMargin.right)-("y"==r)*parseInt(e.cssMargin.top),p=Math.min(o.tail,.5*e.widthOfOneDigit)+l+(i==u?1:0)*d3.max(s)-(i==u?0:1)*d3.min(s)+(i==u?-1:1)*n(c)-("x"==r)*e.formatter(c).length*e.widthOfOneDigit/2-("y"==r)*e.heightOfOneDigit/2-("x"==r)*parseInt(e.cssMargin.left)-("y"==r)*parseInt(e.cssMargin.bottom);f>0&&(f=0),p>0&&(p=0),a[c]={x:0,y:0},a[c][r]=("y"==r&&i==u?-1:1)*(f-p)}}),t.forEach(function(o,s){if(0!=s&&s!=t.length-1){var l=Math.abs(n(o)-n(t[t.length-1]))-("y"==r)*(i==h?-1:1)*a[t[t.length-1]][r]-("x"==r)*(i==h?1:-1)*a[t[t.length-1]][r]-("x"==r)*e.widthOfOneDigit/2*e.formatter(o).length-("x"==r)*e.widthOfOneDigit/2*e.formatter(t[t.length-1]).length-("y"==r)*e.heightOfOneDigit*.7-("x"==r)*parseInt(e.cssMargin.left)-("y"==r)*parseInt(e.cssMargin.bottom),c=Math.abs(n(o)-n(t[0]))-("y"==r)*(i==u?-1:1)*a[t[0]][r]-("x"==r)*(i==u?1:-1)*a[t[0]][r]-("x"==r)*e.widthOfOneDigit/2*e.formatter(o).length-("x"==r)*e.widthOfOneDigit/2*e.formatter(t[0]).length-("y"==r)*e.heightOfOneDigit*.7-("x"==r)*parseInt(e.cssMargin.left)-("y"==r)*parseInt(e.cssMargin.bottom);l>0&&(l=0),c>0&&(c=0),a[o]={x:0,y:0},a[o][r]=("y"==r&&i==u?-1:1)*(l-c)}}),a}function c(){var t;a.labelerOptions().isDevMode&&(t=console).log.apply(t,arguments)}var u="vertical axis",h="horizontal axis",d="labels stack side by side",f="labels stack top to bottom",p="optimistic approximation: labels have different lengths",m="pessimistic approximation: all labels have the largest length";a.highlightValueRun=function(t){S.viewportLength&&"none"!=v&&(a.scale()(v)>S.viewportLength||a.scale()(v)<0)&&(v="none");var e="top"==a.orient()||"bottom"==a.orient()?h:u,i=e==h&&a.pivot()||e==u&&!a.pivot()?"y":"x",n=a.pivot()?-1:1;t.select(".vzb-axis-value").classed("vzb-hidden","none"==v);var r=void 0,o={};"none"!=v&&(r=t.select(".vzb-axis-value").node().getBBox(),o.bump=S.bump,o.formatter=S.formatter,o.viewportLength=S.viewportLength,o.toolMargin=S.toolMargin,o.cssMargin=S.cssMargin,o.widthOfOneDigit=r[a.pivot()?"height":"width"]/S.formatter(v).length,o.heightOfOneDigit=r[a.pivot()?"width":"height"]);var s=("none"==v?{x:0,y:0}:l([v],o,e,a.scale(),i)[v])[i],c=function(t){return"none"==v?"translate(0,0)":"translate("+(e==h?a.scale()(v)+s*n:0)+","+(e==u?a.scale()(v)+s*n:0)+")"},d=function(t,o,l){if("none"==v)return 1;var c=e==h?"width":"height",u=((a.repositionLabels()||{})[t]||{x:0,y:0})[i];return a.hlOpacityScale()(Math.abs(a.scale()(t)+u*n-a.scale()(v)-s*n)-l.getBBox()[c]/2-r[c]/2)};b?(t.select(".vzb-axis-value").transition().duration(b).ease(d3.easeLinear).attr("transform",c),t.select(".vzb-axis-value").select("text").transition("text").delay(b).text("none"==v?"":S.formatter(v)),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").transition().duration(b).ease(d3.easeLinear).style("opacity",d(t,0,this))})):(t.select(".vzb-axis-value").interrupt().attr("transform",c).transition(),t.select(".vzb-axis-value").select("text").interrupt().text("none"==v?"":S.formatter(v)).transition(),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").interrupt().style("opacity",d(t,0,this)).transition()})),v=null};var g=d3.scaleLinear().domain([0,5]).range([0,1]).clamp(!0);a.hlOpacityScale=function(t){return arguments.length?(g=t,a):g};var v=null;a.highlightValue=function(t){return arguments.length?(v=t,a):v};var b=0;a.highlightTransDuration=function(t){return arguments.length?(b=t,a):b};var y=null;a.repositionLabels=function(t){return arguments.length?(y=t,a):y};var _=!1;a.pivot=function(t){return arguments.length?(_=!!t,a):_};var x=[];a.tickValuesMinor=function(t){return arguments.length?(x=t,a):x};var w={outbound:0,inbound:0};a.tickSizeMinor=function(t,e){return arguments.length?(w={outbound:t,inbound:e||0},c("setting",w),a):w};var S={};return a.labelerOptions=function(t){return arguments.length?(S=t,a):S},a.METHOD_REPEATING="repeating specified powers",a.METHOD_DOUBLING="doubling the value",a.labelFactory=function(t){function e(e,i){return 0==e||0==i?0:(null==i&&(i=t.logBase),Math.log(e)/Math.log(i))}if(null==t&&(t={}),"linear"!=t.scaleType&&"time"!=t.scaleType&&"genericLog"!=t.scaleType&&"log"!=t.scaleType&&"ordinal"!=t.scaleType)return a.ticks(t.limitMaxTickNumber).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==t.scaleType)return a;null==t.logBase&&(t.logBase=10),null==t.stops&&(t.stops=[1,2,5,3,7,4,6,8,9]),null==t.removeAllLabels&&(t.removeAllLabels=!1),null==t.formatter&&(t.formatter=a.tickFormat()?a.tickFormat():function(t){return t+""}),t.cssLabelMarginLimit=5,null==t.cssMargin&&(t.cssMargin={}),(null==t.cssMargin.left||parseInt(t.cssMargin.left)<t.cssLabelMarginLimit)&&(t.cssMargin.left=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.right||parseInt(t.cssMargin.right)<t.cssLabelMarginLimit)&&(t.cssMargin.right=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.top||parseInt(t.cssMargin.top)<t.cssLabelMarginLimit)&&(t.cssMargin.top=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.bottom||parseInt(t.cssMargin.bottom)<t.cssLabelMarginLimit)&&(t.cssMargin.bottom=t.cssLabelMarginLimit+"px"),null==t.toolMargin&&(t.toolMargin={left:30,bottom:30,right:30,top:30}),null==t.bump&&(t.bump=0),null==t.viewportLength&&(t.viewportLength=0),null==t.pivotingLimit&&(t.pivotingLimit=t.toolMargin[this.orient()]),null==t.showOuter&&(t.showOuter=!1),null==t.limitMaxTickNumber&&(t.limitMaxTickNumber=0);var i="top"==this.orient()||"bottom"==this.orient()?h:u;null==t.isPivotAuto&&(t.isPivotAuto=i==u),null==t.cssFontSize&&(t.cssFontSize="13px"),null==t.widthToFontsizeRatio&&(t.widthToFontsizeRatio=.75),null==t.heightToFontsizeRatio&&(t.heightToFontsizeRatio=1.2),null==t.widthOfOneDigit&&(t.widthOfOneDigit=parseInt(t.cssFontSize)*t.widthToFontsizeRatio),null==t.heightOfOneDigit&&(t.heightOfOneDigit=parseInt(t.cssFontSize)*t.heightToFontsizeRatio),null!=t.fitIntoScale&&"pessimistic"!=t.fitIntoScale||(t.fitIntoScale=m),"optimistic"==t.fitIntoScale&&(t.fitIntoScale=p),c("********** "+i+" **********");var o=a.scale().domain(),d=a.scale().range(),f=(Math.abs(o[o.length-1]-o[0]),Math.abs(d[d.length-1]-d[0])),g=d3.min([o[0],o[o.length-1]]),v=d3.max([o[0],o[o.length-1]]),b=("linear"==t.scaleType?g<0:g<=0)&&v>=0&&"time"!=t.scaleType,y=t.showOuter?[g,v]:[],_=[],x=5,w=d3.max(d3.range(g,v,(v-g)/17).concat(v).map(function(e){return t.formatter(e).replace(".","").length}))*t.widthOfOneDigit+parseInt(t.cssMargin.left),S=t.isPivotAuto&&(w>t.pivotingLimit&&i==u||!(w>t.pivotingLimit)&&!(i==u)),M=i==h&&S||i==u&&!S,k=!M&&t.heightOfOneDigit>t.pivotingLimit;if(t.removeAllLabels)return a.tickValues([]);if(g==v)return a.tickValues([g]).ticks(1).tickFormat(t.formatter);var E=function(e,i,n,r){if(null==e||e.length<=1)return!0;if(null==n&&(n=m),null==r&&(scaleType="none"),M)return i>e.length*(t.heightOfOneDigit+parseInt(t.cssMargin.top)+parseInt(t.cssMargin.bottom));var o=parseInt(t.cssMargin.left)+parseInt(t.cssMargin.right),s=d3.max(e.map(function(e){return t.formatter(e).length}));return"log"==r?(i=Math.abs(a.scale()(d3.max(e))-a.scale()(d3.min(e))))>d3.sum(e.map(function(e){return(t.widthOfOneDigit*(n==m?s:t.formatter(e).length)+o)*(1+Math.log(e.toString().replace(/([0.])/g,"")[0])/Math.LN10)})):i>e.length*o+(n==m?t.widthOfOneDigit*e.length*s:0)+(n==p?t.widthOfOneDigit*e.map(function(e){return t.formatter(e)}).join("").length:0)},z=function(e,i){if(null==i||0==i.length)return!1;i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++)if(e!=i[n]&&0!=e&&Math.abs(a.scale()(e)-a.scale()(i[n]))<(M?t.heightOfOneDigit:(t.formatter(e).length+t.formatter(i[n]).length)*t.widthOfOneDigit/2))return!0;return!1};if("genericLog"==t.scaleType||"log"==t.scaleType){var O=a.scale().eps?a.scale().eps():0,T=b?[0]:[],C=v<O?[]:d3.range(Math.floor(e(Math.max(O,g))),Math.ceil(e(v)),1).concat(Math.ceil(e(v))).map(function(e){return Math.pow(t.logBase,e)}),P=g>-O?[]:d3.range(Math.floor(e(Math.max(O,-v))),Math.ceil(e(-g)),1).concat(Math.ceil(e(-g))).map(function(e){return-Math.pow(t.logBase,e)});if(null==t.method){var D=b?Math.max(Math.abs(v),Math.abs(g))/O:Math.max(Math.abs(v),Math.abs(g))/Math.min(Math.abs(v),Math.abs(g));t.method=10<=D&&D<=1024?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(t.method==this.METHOD_DOUBLING&&function(){var t=[];b&&y.push(0);var e=[].concat(y),i=v<O?null:4*C[Math.floor(C.length/2)-1],n=g>-O?null:4*P[Math.floor(P.length/2)-1];if(i)for(var a=i;a<=v;a*=2)t.push(a);if(i)for(var o=i/2;o>=Math.max(g,O);o/=2)t.push(o);if(n)for(var l=n;l>=g;l*=2)t.push(l);if(n)for(var c=n/2;c<=Math.min(v,-O);c/=2)t.push(c);t=t.sort(d3.ascending).filter(function(t){return g<=t&&t<=v}),_=_.concat(t),t=s(t,!1);for(var u=y,h=0;h<t.length;h++){var d=u.concat(t[h]).filter(function(t){return!z(t,e)}).filter(r);if(!E(d,f,m,"none"))break;y=d}}(),t.method==this.METHOD_REPEATING){var A=T.concat(C).concat(P).sort(d3.ascending);t.stops.forEach(function(t,e){_=_.concat(A.map(function(e){return e*t}))}),A=s(A);var I=T.concat(y),L=!1;t.stops.forEach(function(e,i){if(0==i){for(var a,o=0;o<A.length;o++){var s=y.concat(A[o].map(function(t){return t*e})).filter(function(t){return!z(t,I)}).filter(function(t){return g<=t&&t<=v}).filter(r);if(!E(s,f,m,"none"))break;y=s}A=(a=[]).concat.apply(a,n(A))}else{if(L)return;var l=y.concat(A.map(function(t){return t*e})).filter(function(t){return g<=t&&t<=v}).filter(r);if(!E(l,f,m,"log"))return void(L=!0);if(y.length>t.limitMaxTickNumber&&0!=t.limitMaxTickNumber)return void(L=!0);y=l}})}}return"linear"!=t.scaleType&&"time"!=t.scaleType||function(){b&&y.push(0);var e=[].concat(y);x=M?Math.max(Math.floor(f/(t.heightOfOneDigit+parseInt(t.cssMargin.top))),2):Math.max(Math.floor(f/w),2),0!=t.limitMaxTickNumber&&x>t.limitMaxTickNumber&&(x=t.limitMaxTickNumber);var i=a.scale().ticks(x).sort(d3.ascending).filter(function(t){return g<=t&&t<=v});_=_.concat(i),i=s(i,!1);for(var n=y,o=0;o<i.length;o++){var l=n.concat(i[o]).filter(function(t){return!z(t,e)}).filter(r);if(!E(l,f,t.fitIntoScale,"none"))break;y=l}y=y.filter(function(t){return!z(t,e)}).filter(r)}(),null!=y&&y.length<=2&&!b&&(y=Math.abs(a.scale()(g)-a.scale()(v))<(M?t.heightOfOneDigit:(t.formatter(g).length+t.formatter(v).length)*t.widthOfOneDigit)?[v]:[g,v],1!=y.length||"linear"!=t.scaleType&&"time"!=t.scaleType||(_=[])),null!=y&&y.length<=3&&b&&(y=z(0,[g,v])?[g,v]:[g,0,v]),null!=y&&y.sort(function(t,e){return(i==h?-1:1)*(a.scale()(e)-a.scale()(t))}),k&&(y=[]),_=_.filter(function(t){return-1==y.indexOf(t)&&g<=t&&t<=v}),c("final result",y),a.ticks(x).tickFormat(t.formatter).tickValues(y).tickValuesMinor(_).pivot(S).repositionLabels(l(y,t,i,a.scale(),M?"y":"x"))},a.copy=function(){return e(d3["axis"+o.capitalize(t)]())},a.orient=function(){return arguments.length?a:t},d3.rebind(a,i,"scale","ticks","tickArguments","tickValues","tickFormat","tickSize","tickSizeInner","tickSizeOuter","tickPadding")}(d3["axis"+o.capitalize(t)]())}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a)},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(6),l=function(t){return t&&t.__esModule?t:{default:t}}(s),c=l.default.extend({init:function(t,e){this.name="show";this.template=this.template||i(166),this.model_expects=this.model_expects||[{name:"state"},{name:"locale",type:"locale"}],this._super(t,e)},readyOnce:function(){var t=this;this._super(),this.KEYS=o.unique(this.model.state.marker._getAllDimensions({exceptType:"time"})),this.resetFilter={};var e=this.model.state.marker._space;this.KEYS.forEach(function(i){t.resetFilter[i]=o.find(e,function(t){return t.dim===i}).show}),this.parentElement=d3.select(this.parent.element),this.contentEl=this.element=d3.select(this.element.parentNode),this.list=this.element.select(".vzb-show-list"),this.input_search=this.parentElement.select(".vzb-find-search"),this.deselect_all=this.parentElement.select(".vzb-show-deselect"),this.apply=this.parentElement.select(".vzb-show-apply");var i=this;this.deselect_all.on("click",function(){i.resetShow()}),this.apply.on("click",function(){i.applyShowChanges()}),this.root.on("ready",function(){i.ready()})},ready:function(){var t=this;this._super(),this.KEYS=o.unique(this.model.state.marker._getAllDimensions({exceptType:"time"})),this.labelNames=this.model.state.marker.getLabelHookNames();var e=this.model.state.marker.getSubhooks(!0);this.previewShow={},this.checkedDifference={},o.forEach(this.labelNames,function(i){var n=e[i].getEntity(),r=t.previewShow[n._name]={};o.forEach(n.show.$and||[n.show],function(t){o.forEach(t,function(t,e){r[e]=(t.$in||[]).slice(0)})})}),this.redraw(),this.showHideButtons(),o.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},redraw:function(){var t=this,e=this;this.translator=this.model.locale.getTFunction(),this.model.state.marker.getFrame(this.model.state.time.value,function(i){if(i){var n=t.model.state.marker.getSubhooks(!0);e.list.html("");var a=[];o.forEach(t.labelNames,function(e,i){var o=n[e].getEntity(),s=o._name;a.push({dim:i,entities:s,labelName:e,key:i,category:t.root.model.dataManager.getConceptProperty(i,"name")});var l=o.getEntitySets().map(function(e){return{entities:s,key:e,dim:i,isSet:!0,category:t.root.model.dataManager.getConceptProperty(e,"name")}});a.push.apply(a,r(l))}),o.forEach(a,function(n){var r=(n.dim,n.key),a=n.category,s=n.labelName,l=n.entities,c=n.isSet,u=c?t.model.state[l].getEntitySets("data")[r][0].map(function(t){var i={entities:l,category:r};return i[r]=t[r],i.label=t.name,i.isShown=e.model.state[l].isInShowFilter(t,r),i}):o.keys(i[s]).map(function(t){var n={entities:l,category:r};return n[r]=t,n.label=i[s][t],n.isShown=e.model.state[l].isInShowFilter(n,r),n});u.sort(function(t,e){return t.label<e.label?-1:1});var h=e.list.append("div").attr("class","vzb-accordion-section").datum({key:r,isSet:c});h.append("div").attr("class","vzb-accordion-section-title").on("click",function(t){var e=d3.select(this.parentNode);e.classed("vzb-fullexpand",!1).classed("vzb-accordion-active",!e.classed("vzb-accordion-active"))}).call(function(t){return t.append("span").attr("class","vzb-show-category").classed("vzb-show-category-set",function(t){return t.isSet}).text(a).attr("title",function(t){return this.offsetWidth<this.scrollWidth?a:null})}).call(function(t){return t.append("span").attr("class","vzb-show-clear-cross").text("âœ–").on("click",function(){d3.event.stopPropagation(),h.selectAll(".vzb-checked input").property("checked",!1).dispatch("change")})}).call(function(t){return t.append("span").attr("class","vzb-show-more vzb-dialog-button").text(e.translator("buttons/moreellipsis")).on("click",function(){d3.event.stopPropagation(),h.classed("vzb-fullexpand",!0)})});var d=h.append("div").attr("class","vzb-show-category-list"),f=d.selectAll(".vzb-show-item").data(u).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox").classed("vzb-checked",function(t){return t.isShown});f.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",function(t){return"-show-"+t.category+"-"+t[r]+"-"+e._id}).property("checked",function(t){return t.isShown}).on("change",function(e,i,n){if(e.isShown!==n[i].checked?t.checkedDifference[e.category+e[r]]=!0:delete t.checkedDifference[e.category+e[r]],t.apply.classed("vzb-disabled",!Object.keys(t.checkedDifference).length),!t.previewShow[e.entities][e.category]){var a=t.model.state[e.entities].show;t.previewShow[e.entities][e.category]=((a[e.category]||(a.$and||{})[e.category]||{}).$in||[]).slice(0)}var o=t.previewShow[e.entities][e.category].indexOf(e[e.category]);-1===o?t.previewShow[e.entities][e.category].push(e[e.category]):t.previewShow[e.entities][e.category].splice(o,1)}),f.append("label").attr("for",function(t){return"-show-"+t.category+"-"+t[r]+"-"+e._id}).text(function(t){return t.label}).attr("title",function(t){return this.offsetWidth<this.scrollWidth?t.label:null});var p=d.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];if(p&&p.nextSibling){var m=(d3.select(p).classed("vzb-separator",!!p.nextSibling),p.parentNode.offsetTop+p.offsetTop);d3.select(p.parentNode.parentNode).style("max-height",m+p.offsetHeight+25+"px").select(".vzb-show-more").style("transform","translate(0, "+m+"px)")}else h.select(".vzb-show-more").classed("vzb-hidden",!0);h.classed("vzb-filtered",!!p)}),e.contentEl.node().scrollTop=0,e.input_search.attr("placeholder",e.translator("placeholder/search")+"...")}})},applyShowChanges:function(){var t=this;this.model.state.marker.clearSelected();var e={};o.forEach(this.previewShow,function(i,r){var a=[],s=[];o.forEach(i,function(t,e){s.push(e),t.length&&a.push(n({},e,{$in:t.slice(0)}))}),o.forEach(t.model.state[r].show.$and||[t.model.state[r].show],function(t){o.forEach(t,function(t,e){s.includes(e)||a.push(o.deepClone(t))})}),e[r]={show:a.length>1?{$and:a}:a[0]||{}}}),this.model.state.set(e)},showHideSearch:function(){if("show"===this.parent.getPanelMode()){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-show-item").classed("vzb-hidden",function(e){return-1===(e.label||"").toString().toLowerCase().indexOf(t)}),""!==t&&this.list.selectAll(".vzb-accordion-section").classed("vzb-accordion-active",!0)}},showHideButtons:function(){"show"===this.parent.getPanelMode()&&(this.deselect_all.classed("vzb-hidden",this.hideResetButton()),this.apply.classed("vzb-hidden",!1).classed("vzb-disabled",!0))},hideResetButton:function(){var t=this,e=!0,i=this.model.state.marker._space;return o.forEach(this.KEYS,function(n){return e=o.comparePlainObjects(t.resetFilter[n]||{},o.find(i,function(t){return t.dim===n}).show)}),e},resetShow:function(){var t=this,e={},i=this.model.state.marker._space;this.KEYS.forEach(function(n){var r=o.find(i,function(t){return t.dim===n})._name;e[r]={show:t.resetFilter[n]||{}}}),this.model.state.set(e)},closeClick:function(){this.applyShowChanges()}});e.default=c},function(t,e,i){t.exports=!i(8)&&!i(4)(function(){return 7!=Object.defineProperty(i(79)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){e.f=i(7)},function(t,e,i){var n=i(14),r=i(18),a=i(62)(!1),o=i(81)("IE_PROTO");t.exports=function(t,e){var i,s=r(t),l=0,c=[];for(i in s)i!=o&&n(s,i)&&c.push(i);for(;e.length>l;)n(s,i=e[l++])&&(~a(c,i)||c.push(i));return c}},function(t,e,i){var n=i(9),r=i(2),a=i(40);t.exports=i(8)?Object.defineProperties:function(t,e){r(t);for(var i,o=a(e),s=o.length,l=0;s>l;)n.f(t,i=o[l++],e[i]);return t}},function(t,e,i){var n=i(18),r=i(43).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(t){try{return r(t)}catch(t){return o.slice()}};t.exports.f=function(t){return o&&"[object Window]"==a.call(t)?s(t):r(n(t))}},function(t,e,i){"use strict";var n=i(40),r=i(63),a=i(57),o=i(11),s=i(56),l=Object.assign;t.exports=!l||i(4)(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=l({},t)[i]||Object.keys(l({},e)).join("")!=n})?function(t,e){for(var i=o(t),l=arguments.length,c=1,u=r.f,h=a.f;l>c;)for(var d,f=s(arguments[c++]),p=u?n(f).concat(u(f)):n(f),m=p.length,g=0;m>g;)h.call(f,d=p[g++])&&(i[d]=f[d]);return i}:l},function(t,e,i){"use strict";var n=i(13),r=i(5),a=i(120),o=[].slice,s={},l=function(t,e,i){if(!(e in s)){for(var n=[],r=0;r<e;r++)n[r]="a["+r+"]";s[e]=Function("F,a","return new F("+n.join(",")+")")}return s[e](t,i)};t.exports=Function.bind||function(t){var e=n(this),i=o.call(arguments,1),s=function(){var n=i.concat(o.call(arguments));return this instanceof s?l(e,n.length,n):a(e,n,t)};return r(e.prototype)&&(s.prototype=e.prototype),s}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var n=i(3).parseInt,r=i(52).trim,a=i(85),o=/^[-+]?0[xX]/;t.exports=8!==n(a+"08")||22!==n(a+"0x16")?function(t,e){var i=r(String(t),3);return n(i,e>>>0||(o.test(i)?16:10))}:n},function(t,e,i){var n=i(3).parseFloat,r=i(52).trim;t.exports=1/n(i(85)+"-0")!=-1/0?function(t){var e=r(String(t),3),i=n(e);return 0===i&&"-"==e.charAt(0)?-0:i}:n},function(t,e,i){var n=i(23);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=n(t))throw TypeError(e);return+t}},function(t,e,i){var n=i(5),r=Math.floor;t.exports=function(t){return!n(t)&&isFinite(t)&&r(t)===t}},function(t,e){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,i){var n=i(88),r=Math.pow,a=r(2,-52),o=r(2,-23),s=r(2,127)*(2-o),l=r(2,-126),c=function(t){return t+1/a-1/a};t.exports=Math.fround||function(t){var e,i,r=Math.abs(t),u=n(t);return r<l?u*c(r/l/o)*l*o:(e=(1+o/a)*r,i=e-(e-r),i>s||i!=i?u*(1/0):u*i)}},function(t,e,i){var n=i(2);t.exports=function(t,e,i,r){try{return r?e(n(i)[0],i[1]):e(i)}catch(e){var a=t.return;throw void 0!==a&&n(a.call(t)),e}}},function(t,e,i){var n=i(13),r=i(11),a=i(56),o=i(10);t.exports=function(t,e,i,s,l){n(e);var c=r(t),u=a(c),h=o(c.length),d=l?h-1:0,f=l?-1:1;if(i<2)for(;;){if(d in u){s=u[d],d+=f;break}if(d+=f,l?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;l?d>=0:h>d;d+=f)d in u&&(s=e(s,u[d],d,c));return s}},function(t,e,i){"use strict";var n=i(11),r=i(41),a=i(10);t.exports=[].copyWithin||function(t,e){var i=n(this),o=a(i.length),s=r(t,o),l=r(e,o),c=arguments.length>2?arguments[2]:void 0,u=Math.min((void 0===c?o:r(c,o))-l,o-s),h=1;for(l<s&&s<l+u&&(h=-1,l+=u-1,s+=u-1);u-- >0;)l in i?i[s]=i[l]:delete i[s],s+=h,l+=h;return i}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){i(8)&&"g"!=/./g.flags&&i(9).f(RegExp.prototype,"flags",{configurable:!0,get:i(67)})},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,i){var n=i(2),r=i(5),a=i(103);t.exports=function(t,e){if(n(t),r(e)&&e.constructor===t)return e;var i=a.f(t);return(0,i.resolve)(e),i.promise}},function(t,e,i){"use strict";var n=i(135),r=i(54);t.exports=i(70)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=n.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return n.def(r(this,"Map"),0===t?0:t,e)}},n,!0)},function(t,e,i){"use strict";var n=i(9).f,r=i(42),a=i(47),o=i(22),s=i(45),l=i(46),c=i(91),u=i(130),h=i(44),d=i(8),f=i(35).fastKey,p=i(54),m=d?"_s":"size",g=function(t,e){var i,n=f(e);if("F"!==n)return t._i[n];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,c){var u=t(function(t,n){s(t,u,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=n&&l(n,i,t[c],t)});return a(u.prototype,{clear:function(){for(var t=p(this,e),i=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete i[n.i];t._f=t._l=void 0,t[m]=0},delete:function(t){var i=p(this,e),n=g(i,t);if(n){var r=n.n,a=n.p;delete i._i[n.i],n.r=!0,a&&(a.n=r),r&&(r.p=a),i._f==n&&(i._f=r),i._l==n&&(i._l=a),i[m]--}return!!n},forEach:function(t){p(this,e);for(var i,n=o(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(n(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!g(p(this,e),t)}}),d&&n(u.prototype,"size",{get:function(){return p(this,e)[m]}}),u},def:function(t,e,i){var n,r,a=g(t,e);return a?a.v=i:(t._l=a={i:r=f(e,!0),k:e,v:i,p:n=t._l,n:void 0,r:!1},t._f||(t._f=a),n&&(n.n=a),t[m]++,"F"!==r&&(t._i[r]=a)),t},getEntry:g,setStrong:function(t,e,i){c(t,e,function(t,i){this._t=p(t,e),this._k=i,this._l=void 0},function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?"keys"==e?u(0,i.k):"values"==e?u(0,i.v):u(0,[i.k,i.v]):(t._t=void 0,u(1))},i?"entries":"values",!i,!0),h(e)}}},function(t,e,i){"use strict";var n=i(135),r=i(54);t.exports=i(70)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(r(this,"Set"),t=0===t?0:t,t)}},n)},function(t,e,i){"use strict";var n,r=i(30)(0),a=i(16),o=i(35),s=i(118),l=i(138),c=i(5),u=i(4),h=i(54),d=o.getWeak,f=Object.isExtensible,p=l.ufstore,m={},g=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},v={get:function(t){if(c(t)){var e=d(t);return!0===e?p(h(this,"WeakMap")).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(h(this,"WeakMap"),t,e)}},b=t.exports=i(70)("WeakMap",g,v,l,!0,!0);u(function(){return 7!=(new b).set((Object.freeze||Object)(m),7).get(m)})&&(n=l.getConstructor(g,"WeakMap"),s(n.prototype,v),o.NEED=!0,r(["delete","has","get","set"],function(t){var e=b.prototype,i=e[t];a(e,t,function(e,r){if(c(e)&&!f(e)){this._f||(this._f=new n);var a=this._f[t](e,r);return"set"==t?this:a}return i.call(this,e,r)})}))},function(t,e,i){"use strict";var n=i(47),r=i(35).getWeak,a=i(2),o=i(5),s=i(45),l=i(46),c=i(30),u=i(14),h=i(54),d=c(5),f=c(6),p=0,m=function(t){return t._l||(t._l=new g)},g=function(){this.a=[]},v=function(t,e){return d(t.a,function(t){return t[0]===e})};g.prototype={get:function(t){var e=v(this,t);if(e)return e[1]},has:function(t){return!!v(this,t)},set:function(t,e){var i=v(this,t);i?i[1]=e:this.a.push([t,e])},delete:function(t){var e=f(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,i,a){var c=t(function(t,n){s(t,c,e,"_i"),t._t=e,t._i=p++,t._l=void 0,void 0!=n&&l(n,i,t[a],t)});return n(c.prototype,{delete:function(t){if(!o(t))return!1;var i=r(t);return!0===i?m(h(this,e)).delete(t):i&&u(i,this._i)&&delete i[this._i]},has:function(t){if(!o(t))return!1;var i=r(t);return!0===i?m(h(this,e)).has(t):i&&u(i,this._i)}}),c},def:function(t,e,i){var n=r(a(e),!0);return!0===n?m(t).set(e,i):n[t._i]=i,t},ufstore:m}},function(t,e,i){var n=i(28),r=i(10);t.exports=function(t){if(void 0===t)return 0;var e=n(t),i=r(e);if(e!==i)throw RangeError("Wrong length!");return i}},function(t,e,i){var n=i(43),r=i(63),a=i(2),o=i(3).Reflect;t.exports=o&&o.ownKeys||function(t){var e=n.f(a(t)),i=r.f;return i?e.concat(i(t)):e}},function(t,e,i){"use strict";function n(t,e,i,c,u,h,d,f){for(var p,m,g=u,v=0,b=!!d&&s(d,f,3);v<c;){if(v in i){if(p=b?b(i[v],v,e):i[v],m=!1,a(p)&&(m=p[l],m=void 0!==m?!!m:r(p)),m&&h>0)g=n(t,e,p,o(p.length),g,h-1)-1;else{if(g>=9007199254740991)throw TypeError();t[g]=p}g++}v++}return g}var r=i(64),a=i(5),o=i(10),s=i(22),l=i(7)("isConcatSpreadable");t.exports=n},function(t,e,i){var n=i(10),r=i(87),a=i(27);t.exports=function(t,e,i,o){var s=String(a(t)),l=s.length,c=void 0===i?" ":String(i),u=n(e);if(u<=l||""==c)return s;var h=u-l,d=r.call(c,Math.ceil(h/c.length));return d.length>h&&(d=d.slice(0,h)),o?d+s:s+d}},function(t,e,i){var n=i(40),r=i(18),a=i(57).f;t.exports=function(t){return function(e){for(var i,o=r(e),s=n(o),l=s.length,c=0,u=[];l>c;)a.call(o,i=s[c++])&&u.push(t?[i,o[i]]:o[i]);return u}}},function(t,e,i){var n=i(58),r=i(145);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){var n=i(46);t.exports=function(t,e){var i=[];return n(t,!1,i.push,i,e),i}},function(t,e){t.exports=Math.scale||function(t,e,i,n,r){return 0===arguments.length||t!=t||e!=e||i!=i||n!=n||r!=r?NaN:t===1/0||t===-1/0?t:(t-e)*(r-n)/(i-e)+n}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(48),l=n(s),c=i(6),u=n(c),h=i(49),d=(n(h),i(395)),f=n(d),p=i(396),m=n(p),g=l.default.extend({init:function(t,e){this._id=o.uniqueId("tm"),this._type="tool",this._component=t,this.dimensionManager=(0,f.default)(this),this.dataManager=(0,m.default)(this),this.getClassDefaults=function(){return t.default_model};var i=o.extend(t.getToolListeners(),e.bind);delete e.bind,this._super(t.name,e,null,i)},getDefaults:function(){return o.deepExtend({},this.getSubmodelDefaults(),this.getClassDefaults())},validate:function(){function t(n){var r=JSON.stringify(i.getPlainObject());i._component.validate(i);var a=JSON.stringify(i.getPlainObject());n>=e?o.error("Max validation loop."):r!==a&&t(n++)}var e=10,i=this;t(0)},setReady:function(t){!1!==t&&this.checkTimeLimits(),this._super(t)},checkTimeLimits:function(){var t=this.state.time,e=this.state.getSubmodels(!1,function(t){return"marker"==t._type&&t.space.includes("time")});if(t&&e.length){var i={};if(e.forEach(function(t){var e=t.getTimeLimits();i.min=d3.max([i.min,e.min]),i.max=d3.min([i.max,e.max])}),!o.isDate(i.min)||!o.isDate(i.max))return o.warn("checkTimeLimits(): min-max look wrong: "+i.min+" "+i.max+". Expecting Date objects. Ensure that time is properly parsed in the data from reader");var n={};t.start-i.min==0&&(t.start||t.startOrigin)||(n.start=d3.max([i.min,t.parse(t.startOrigin)])),t.end-i.max==0&&(t.end||t.endOrigin)||(n.end=d3.min([i.max,t.parse(t.endOrigin)])),t.setTreeFreezer(!0),t.set(n,!1,!1),(n.start||n.end)&&e.forEach(function(e){o.forEach(e.getSubhooks(),function(e){e.which==t.dim&&e.buildScale()})}),t.setTreeFreezer(!1)}}}),v=u.default.extend({init:function(t,e){this._id=o.uniqueId("t"),this.template=this.getToolTemplate(),this._super({placeholder:t,model:e}),this.prerender(),this.setCSSClasses(),this.setResizeHandler(),this.postrender()},createModel:function(t){t=t||{},t.bind=t.bind||{},this.model=new g(this,t),this.model.setInterModelListeners()},getToolTemplate:function(){return this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>'},getToolListeners:function(){var t=this,e=this;return o.extend(this.model_binds,{readyOnce:function(){return t.setResizeHandler()},change:function(t,i){e._ready&&(e.model.validate(),t.source.persistent&&e.model.trigger(new h.DefaultEvent(t.source,"persistentChange")))},hook_change:function(){e.model.state.time.splash||e.beforeLoading()},"resize:ui":function(){e._ready&&e.triggerResize()},"translate:locale":function(){e.translateStrings(),e.model.ui.setRTL(e.model.locale.isRTL())},load_error1:function(e,i){t.renderError(i)}})},setResizeHandler:function(){this.model.ui.setContainer(this.element)},getVizWidthHeight:function(){var t=0,e=0;return this.element?(t=d3.select(this.element).select(".vzb-tool-viz").node().clientWidth,e=d3.select(this.element).select(".vzb-tool-viz").node().clientHeight):o.warn("Tool getVizWidthHeight(): missing this.element"),{width:t,height:e}},triggerResize:o.throttle(function(){this.trigger("resize")},100),startLoading:function(){var t=this;this._super(),Promise.all([this.model.startPreload(),this.startPreload()]).then(this.afterPreload.bind(this)).then(this.loadSplashScreen.bind(this)).then(function(){return o.delay(300)}).then(this.model.startLoading.bind(this.model)).then(this.finishLoading.bind(this)).catch(function(e){o.error("error in tool promise chain"),t.triggerLoadError(e)})},loadSplashScreen:function(){return this.model.ui.splash?(this.model.state.time.splash=!0,this.model.startLoading({splashScreen:!0})):Promise.resolve()},finishLoading:function(){this.model.state.time.splash=!1},getPersistentModel:function(){function t(e){for(var i in e)"function"==typeof e[i]?(delete e[i],o.warn("minModel validation. Function found in enumerable properties of "+i+". This key is deleted from minModel")):"object"===r(e[i])&&t(e[i])}var e=this.model.getPlainObject(!0);return t(e),e},getPersistentMinimalModel:function(t){var e=this.model.getDefaults(),i=this.getPersistentModel(),n=o.deepExtend(e,t);return o.diffObject(i,n)},clear:function(){this.model.ui.clear(),this.setModel=this.getModel=function(){},this._super()},setModel:function(t,e){e?this.model.reset(t):this.model.set(t),this.setCSSClasses()},getModel:function(){return this.model.getPlainObject()||{}},beforeLoading:function(){o.addClass(this.placeholder,"vzb-loading-data")},validate:function(t){if(!(t=this.model||t)||!t.state)return o.warn("tool validation aborted: model.state looks wrong: "+t)},setCSSClasses:function(){o.addClass(this.placeholder,"vzb-placeholder"),this.model.ui&&this.model.ui.buttons&&this.model.ui.buttons.length?o.removeClass(this.element,"vzb-buttonlist-off"):o.addClass(this.element,"vzb-buttonlist-off")}});e.default=v},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(32),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s={_continuous:{_default:"#ffb600",0:"hsl(270, 80%, 55%)",25:"hsl(202.5, 80%, 55%)",50:"hsl(135, 80%, 55%)",75:"hsl(48, 70%, 62%)",100:"hsl(0, 80%, 55%)"},_discrete:{_default:"#ffb600",0:"#4cd843",1:"#e83739",2:"#ff7f00",3:"#c027d4",4:"#d66425",5:"#0ab8d8",6:"#bcfa83",7:"#ff8684",8:"#ffb04b",9:"#f599f5",10:"#f4f459",11:"#7fb5ed"},_default:{_default:"#ffb600"}},l=o.default.extend({getClassDefaults:function(){var t={use:null,which:null,scaleType:null,syncModels:[],palette:{},paletteLabels:null,allow:{scales:["linear","log","genericLog","time","pow","ordinal"]}};return r.deepExtend(this._super(),t)},init:function(t,e,i,n){var r=this;this._type="color",this._super(t,e,i,n),this._syncModelReferences={},this._hasDefaultColor=!1,this.on("hook_change",function(){if(!r._readyOnce&&!r._loadCall&&(r._setSyncModels(),r.palette&&0!==Object.keys(r.palette._data).length)){var t=r.getDefaultPalette(),e=r.getPalette(),i={};Object.keys(t).forEach(function(n){e[n]&&t[n]!=e[n]||(i[n]=t[n])}),r.set("palette",i,!1,!1)}})},setInterModelListeners:function(){this._super(),this._setSyncModels()},getColorShade:function(t){var e=this.getPalette();if(!t)return r.warn("getColorShade() is missing arguments");if(!r.isArray(e[t.colorID]))return"shade"==t.shadeID?d3.rgb(e[t.colorID]||this.scale(t.colorID)).darker(.5).toString():e[t.colorID];var i=this.getConceptprops().color,n=t.shadeID&&i&&i.shades&&i.shades[t.shadeID]?i.shades[t.shadeID]:0;return e[t.colorID][n]},isUserSelectable:function(){var t=this.getConceptprops().color;return null==t||null==t.selectable||t.selectable},setWhich:function(t){this.palette&&(this.palette._data={}),this._super(t),this._setSyncModels()},_setSyncModels:function(){var t=this;this.syncModels.forEach(function(e){var i=t.getClosestModel(e),n=i.isHook()?i._parent:i,r=n.getClosestModel(n.space[0]);t._syncModelReferences[e]={model:i,marker:n,entities:r},t.isDiscrete()&&"constant"!==t.use&&t._setSyncModel(i,n,r)})},_setSyncModel:function(t,e,i){if(t==e){var n={dim:this.which,show:{}};e.setDataSourceForAllSubhooks(this.data),i.set(n,!1,!1)}else t.isDiscrete()&&t.set({which:this.which,data:this.data,spaceRef:this.spaceRef},!1,!1)},getColorlegendMarker:function(){return(this._syncModelReferences.marker_colorlegend||{}).marker},getColorlegendEntities:function(){return(this._syncModelReferences.marker_colorlegend||{}).entities},setColor:function(t,e,i){var n=void 0,a=this.getPalette();this.isDiscrete()?(n=this.scale.range(),n[this.scale.domain().indexOf(e)]=t):(a[e]=t,n=r.values(a)),this.scale.range(n),this.palette.set(e,t,i,i)},mapValue:function(t){return null!=this.scale&&this.isDiscrete()&&this._hasDefaultColor&&-1==this.scale.domain().indexOf(t)&&(t="_default"),this._super(t)},getDefaultPalette:function(){var t=this.getConceptprops().color,e=void 0;return this.discreteDefaultPalette=!1,t&&t.palette?e=r.clone(t.palette):s[this.which]?e=r.clone(s[this.which]):"constant"===this.use?e=/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.which)?{_default:this.which}:r.clone(s._default):(e=r.clone(s[this.isDiscrete()?"_discrete":"_continuous"]),this.discreteDefaultPalette=!0),e},_getPaletteLabels:function(){var t=this.getConceptprops().color,e=null;return t&&t.paletteLabels&&(e=r.clone(t.paletteLabels)),e},getPaletteLabels:function(){return this.paletteLabels.getPlainObject()},getPalette:function(){if(!this.palette||0===Object.keys(this.palette._data).length){var t=this.getDefaultPalette();this.set("palette",t,!1,!1);var e=this._getPaletteLabels();this.set("paletteLabels",e,!1,!1)}var i=this.palette.getPlainObject();return"ordinal"!==this.scaleType&&delete i._default,i},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=this,i=e.getPalette(),n=Object.keys(i),a=r.values(i);if(this._hasDefaultColor=n.indexOf("_default")>-1,"time"==t){var o=this._space.time,l=o.splash?{min:o.parse(o.startOrigin),max:o.parse(o.endOrigin)}:{min:o.start,max:o.end},c=l.max-l.min==0;n=n.sort(function(t,e){return t-e}),a=n.map(function(t){return c?i[n[0]]:i[t]}),n=n.map(function(t){return l.min.valueOf()+t/100*(l.max.valueOf()-l.min.valueOf())}),this.scale=d3.scaleUtc().domain(n).range(a).interpolate(d3.interpolateCubehelix)}else if(this.isDiscrete()){if(a=a.map(function(t){return r.isArray(t)?t[0]:t}),t="ordinal",this.discreteDefaultPalette){var u=r.extend({},s._discrete);delete u._default;var h=Object.keys(u);n=[].concat(this.getUnique(this.which)),a=n.map(function(t,e){return i[t]||u[h[e%h.length]]}),n.push("_default"),a.push(i._default)}this.scale=d3["scale"+r.capitalize(t)]().domain(n).range(a)}else{var d=this.getLimits(this.which);d=[d.min,d.max];var f=d[1]-d[0]==0;if(n=n.sort(function(t,e){return t-e}),a=n.map(function(t){return f?i[n[0]]:i[t]}),n=n.map(function(t){return d[0]+t/100*(d[1]-d[0])}),d3.min(n)<=0&&d3.max(n)>=0&&"log"===t&&(t="genericLog"),"log"===t||"genericLog"===t){var p=d3.scaleGenericlog().domain(d).range(d);n=n.map(function(t){return p.invert(t)})}this.scale=d3["scale"+r.capitalize(t)]().domain(n).range(a).interpolate(d3.interpolateCubehelix)}this.scaleType=t}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(32),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({getClassDefaults:function(){var t={use:null,which:null,merge:!1,manualSorting:null,spaceRef:null,scaleType:"ordinal"};return r.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"property"!=this.use&&"constant"!=this.use&&(r.warn("group model: use must be 'property' or 'constant'. Resetting to property..."),this.use="property")}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(32),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({getClassDefaults:function(){var t={use:null,which:null};return r.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="label",this._super(t,e,i,n)},autoconfigureModel:function(t){!this.which&&this.autoconfig&&(t=this._parent.getAvailableConcept(this.autoconfig)||this._parent.getAvailableConcept({type:"entity_domain"})),this._super(t)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(55),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=["ar","ar-SA"],l=o.default.extend({getClassDefaults:function(){var t={id:"en",filePath:"assets/translation/"};return r.deepExtend(this._super(),t)},dataConnectedChildren:["id"],strings:{},init:function(t,e,i,n){this._type="locale",this._super(t,e,i,n)},_isLoading:function(){return!this._loadedOnce||this._loadCall},preloadData:function(){return this.loadData()},loadData:function(){var t=this;this.setReady(!1),this._loadCall=!0;var e=[];return r.forEach(this._root._data,function(t){"data"===t._type&&e.push(t.loadConceptProps())}),this.strings[this.id]||e.push(new Promise(function(e,i){r.d3json(t.filePath+t.id+".json",function(n,r){if(n)return i(n);t._handleNewStrings(r),e()})})),Promise.all(e).then(function(){return t.trigger("translate")}).catch(function(e){return t.handleLoadError(e)})},_handleNewStrings:function(t){this.strings[this.id]=this.strings[this.id]?r.extend(this.strings[this.id],t):t},getUIString:function(t){return this.strings&&this.strings[this.id]&&(this.strings[this.id][t]||""===this.strings[this.id][t])?this.strings[this.id][t]:(this.strings&&this.strings[this.id]||r.warn("Strings are not loaded for the "+this.id+" locale. Check if translation JSON is valid"),t)},getTFunction:function(){var t=this;return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(i).reduce(function(t,e){var n=new RegExp("{{"+e+"}}","g");return t.replace(n,i[e])},t.getUIString(e))}},isRTL:function(){return-1!==s.indexOf(this.id)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(32),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({getClassDefaults:function(){var t={use:null,which:null};return r.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="side",n.readyOnce=this.readyOnce,this.state={left:{},right:{}},this._super(t,e,i,n)},readyOnce:function(){if(this.spaceRef){var t=this._space[this.spaceRef].dataConnectedChildren.slice(0);t.splice(t.indexOf("show"),1),this._space[this.spaceRef].dataConnectedChildren=t}},switchSideState:function(){var t=this.state.left;this.state.left=this.state.right,this.state.right=t},clearSideState:function(){this.state={left:{},right:{}}}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(107),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=r.default.extend({getClassDefaults:function(){var t={use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,fixBaseline:0,extent:[0,.85],scaleType:null,allow:{scales:["ordinal","linear","log","genericLog","pow"]}};return o.deepExtend(this._super(),t)},_type:"size",buildScale:function(){this._super(),"ordinal"!==this.scaleType&&this.scale.clamp(!0)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(32),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s={ALL:"all",_default:"none"},l=o.default.extend({getClassDefaults:function(){var t={use:null,which:null,merge:!1,spaceRef:null};return r.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"indicator"===this.use&&(r.warn("stack model: use must not be 'indicator'. Resetting use to 'constant' and which to '"+s._default),this.use="constant",this.which=s._default),"constant"===this.use&&-1==r.values(s).indexOf(this.which)&&(r.warn("stack model: the requested value '"+this.which+"' is not allowed. resetting to '"+s._default),this.which=s._default,this.spaceRef=null)},getPalettes:function(){return s},buildScale:function(){}});e.default=l},function(t,e,i){"use strict";function n(){var t=function(t){return e(t)+"w"+i(t)};t.parse=function(t){var e=t.match(/^(\d{4})w(\d{2})$/);return e?n(e[1],e[2]):null};var e=function(t){return t instanceof Date||(t=new Date(+t)),new Date(+t+864e5*(4-(t.getUTCDay()||7))).getUTCFullYear()},i=function(t){t instanceof Date||(t=new Date(+t));var e=new Date(+t+864e5*(4-(t.getUTCDay()||7))),i=Math.ceil(((e.getTime()-e.setUTCMonth(0,1))/864e5+1)/7);return i<10?"0"+i:i},n=function(t,e){var i=parseInt(e),n=t,r=new Date;r.setUTCFullYear(n),r.setUTCMonth(0),r.setUTCDate(4);var a=r.getUTCDay()||7,o=7*i+1-(a+4),s=c.year.data.parse(n);return s=new Date(s.getTime()+24*o*60*60*1e3)};return t}function r(){var t=function(t){return c.year.data(t)+"q"+e(t)};t.parse=function(t){var e=t.match(/^(\d{4})q(\d)$/);return e?i(e[1],e[2]):null};var e=function(t){return t instanceof Date||(t=new Date(+t)),1+(t.getUTCMonth()/3|0)},i=function(t,e){var i=parseInt(e),n=3*i-2,r=t;return c.month.data.parse([r,(n<9?"0":"")+n].join("-"))};return t}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(55),l=function(t){return t&&t.__esModule?t:{default:t}}(s);Date.prototype.utc=Date.prototype.toUTCString;var c={year:{data:d3.time.format.utc("%Y"),ui:d3.time.format.utc("%Y")},month:{data:d3.time.format.utc("%Y-%m"),ui:d3.time.format.utc("%b %Y")},day:{data:d3.time.format.utc("%Y%m%d"),ui:d3.time.format.utc("%c")},hour:{data:d3.time.format.utc("%Y%m%dT%H"),ui:d3.time.format.utc("%b %d %Y, %H")},minute:{data:d3.time.format.utc("%Y%m%dT%H%M"),ui:d3.time.format.utc("%b %d %Y, %H:%M")},second:{data:d3.time.format.utc("%Y%m%dT%H%M%S"),ui:d3.time.format.utc("%b %d %Y, %H:%M:%S")},week:{data:n(),ui:n()},quarter:{data:r(),ui:r()}},u=l.default.extend({getClassDefaults:function(){var t={dim:null,value:null,start:null,end:null,startOrigin:null,endOrigin:null,startSelected:null,endSelected:null,playable:!0,playing:!1,loop:!1,round:"round",delay:150,delayThresholdX2:90,delayThresholdX4:45,unit:"year",format:{data:null,ui:null},step:1,immediatePlay:!0,record:!1,offset:0};return o.deepExtend(this._super(),t)},objectLeafs:["autoconfig"],dataConnectedChildren:["startOrigin","endOrigin","dim"],init:function(t,e,i,n){this._type="time",this._super(t,e,i,n);var r=this;this.initFormatters(),this.dragging=!1,this.postponePause=!1,this.allSteps={},this.delayAnimations=this.delay,this.on({"change:playing":function(){!0===r.playing?r._startPlaying():r._stopPlaying()},"change:format":function(){r.initFormatters()}})},initFormatters:function(){c[this.unit]&&(this.formatters=c[this.unit]),"string"==typeof this.format?this.formatters.data=this.formatters.ui=d3.time.format.utc(this.format):(this.format.data&&(this.formatters.data=d3.time.format.utc(this.format.data)),this.format.ui&&(this.formatters.ui=d3.time.format.utc(this.format.ui))),this.validateFormatting()},preloadData:function(){return this.dataSource=this.getClosestModel(this.data||"data"),this._super()},afterPreload:function(){this.autoconfigureModel()},autoconfigureModel:function(){if(!this.dim&&this.autoconfig){var t=this.dataSource.getConcept(this.autoconfig);t&&(this.dim=t.concept),o.printAutoconfigResult(this)}},_formatToDates:function(){for(var t=["value"],e=["value","start","end","startSelected","endSelected"],i=0;i<e.length;i++){var n=e[i];if(!o.isDate(this[n])){var r=this.parse(this[n]);this.set(n,r,null,-1!==t.indexOf(n))}}},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return-1===["data","ui"].indexOf(e)&&(o.warn("Time.formatDate type parameter ("+e+') invalid. Using "data".'),e=data),null==t?null:this.formatters[e](t)},parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return null==t?null:this.formatters[e].parse(t.toString())},findFormat:function(t){for(var e=Object.keys(c),i=0;i<e.length;i++){var n=c[e[i]].data.parse(t);if(n)return{unit:e[i],time:n,type:"data"};if(n=c[e[i]].ui.parse(t))return{unit:e[i],time:n,type:"ui"}}return null},validate:function(){null==this.start&&this.startOrigin&&this.set("start",this.startOrigin,null,!1),null==this.end&&this.endOrigin&&this.set("end",this.endOrigin,null,!1),this.formatters&&this.validateFormatting(),c[this.unit]||(o.warn(this.unit+' is not a valid time unit, using "year" instead.'),this.unit="year"),this.step<1&&(this.step=1),this.end<this.start&&null!=this.start&&this.set("end",new Date(this.start),null,!1),this.value<this.startSelected&&null!=this.startSelected&&(this.value=new Date(this.startSelected)),this.value>this.endSelected&&null!=this.endSelected&&(this.value=new Date(this.endSelected)),!1===this.splash&&((!this.startSelected||this.startSelected<this.start)&&null!=this.start&&this.set({startSelected:new Date(this.start)},null,!1),(!this.endSelected||this.endSelected>this.end)&&null!=this.end&&this.set({endSelected:new Date(this.end)},null,!1)),this.value<this.start&&null!=this.start?this.value=new Date(this.start):this.value>this.end&&null!=this.end&&(this.value=new Date(this.end)),!1===this.playable&&!0===this.playing&&this.set("playing",!1,null,!1)},validateFormatting:function(){null==this.value&&this.set("value",this.parse(this.formatDate(new Date)),null,!1),o.isDate(this.start)&&o.isDate(this.end)&&o.isDate(this.value)&&o.isDate(this.startSelected)&&o.isDate(this.endSelected)||this._formatToDates()},play:function(){this._startPlaying()},pause:function(t){t?this.postponePause=!0:this.playing&&(this.set("playing",!1,null,!1),this.set("value",this.value,!0,!0))},dragStart:function(){this.dragging=!0},dragStop:function(){this.dragging=!1},getRange:function(){var t=this.getIntervalAndStep();return d3["utc"+t.interval].range(this.start,this.end,t.step)},getIntervalAndStep:function(){var t=void 0,e=void 0;switch(this.unit){case"week":t="monday",e=this.step;break;case"quarter":t="month",e=3*this.step;break;default:t=this.unit,e=this.step}return{interval:o.capitalize(t),step:e}},getFilter:function(t){var e=t.splash,i=this.parse(this.startOrigin),n=this.parse(this.endOrigin),r=this.getDimension(),a=null;if(e)null!=this.value&&(a={},a[r]=this.formatters.data(this.value));else{var o=void 0,s=void 0;null!=i&&(o=this.formatters.data(i)),null!=n&&(s=this.formatters.data(n)),(o||s)&&(a={},a[r]={},o&&(a[r].$gte=o),s&&(a[r].$lte=s))}return a},getParser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t].parse},getFormatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t]},getAllSteps:function(){if(!this.start||!this.end)return o.warn("getAllSteps(): invalid start/end time is detected: "+this.start+", "+this.end),[];var t=""+this.offset+this.start+this.end+this.step;if(this.allSteps[t])return this.allSteps[t];this.allSteps[t]=[];for(var e=this.getIntervalAndStep(),i=d3["utc"+e.interval].count(this.start,this.end)<this.offset?new Date(this.start):d3["utc"+e.interval].offset(this.start,this.offset);+i<=+this.end;){var n=this.getIntervalAndStep();this.allSteps[t].push(i),i=d3["utc"+n.interval].offset(i,n.step)}return this.allSteps[t]},snap:function(t){if(this.round){null==t&&(t="value");var e="round";"ceil"===this.round&&(e="ceil"),"floor"===this.round&&(e="floor");var i=this.getIntervalAndStep(),n=d3["utc"+i.interval][e](this[t]);this.value-n==0&&this.value-this.start!=0&&this.value-this.end!=0||this.set(t,n,!0)}},_startPlaying:function(){if(this.playable){var t=this;this.value>=this.endSelected&&t.getModelObject("value").set(t.startSelected,null,!1),this.set("playing",!0,null,!1),this.playInterval(this.immediatePlay),this.trigger("play")}},playInterval:function(t){if(this.playing){var e=this;this.delayAnimations=this.delay,this.delay<this.delayThresholdX2&&(this.delayAnimations*=2),this.delay<this.delayThresholdX4&&(this.delayAnimations*=2);var i=t?1:this.delayAnimations;this._intervals.setInterval("playInterval_"+this._id,function(){if(e.value>=e.endSelected)e.loop?e.getModelObject("value").set(e.startSelected,null,!1):e.set("playing",!1,null,!1);else if(e._intervals.clearInterval("playInterval_"+e._id),e.postponePause||!e.playing)e.set("playing",!1,null,!1),e.postponePause=!1,e.getModelObject("value").set(e.value,!0,!0);else{var t=e.getIntervalAndStep();e.delay<e.delayThresholdX2&&(t.step*=2),e.delay<e.delayThresholdX4&&(t.step*=2);var i=d3["utc"+t.interval].offset(e.value,t.step);i>=e.endSelected?e.getModelObject("value").set(e.endSelected,null,!0):e.getModelObject("value").set(i,null,!1),e.playInterval()}},i)}},incrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,e.step)},decrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,-e.step)},_stopPlaying:function(){this._intervals.clearInterval("playInterval_"+this._id),this.trigger("pause")}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(48),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({screen_profiles:{small:{min_width:0,min_height:0},medium:{min_width:600,min_height:400},large:{min_width:900,min_height:520}},getClassDefaults:function(){var t={presentation:!1,buttons:[],dialogs:{popup:[],sidebar:[],moreoptions:[]},splash:!1};return r.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="ui",this._container=null,this._curr_profile="small",this._prev_size={},this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),n["change:presentation"]=this.updatePresentation.bind(this),this._super(t,e,i,n);(function(){var t=/(?:iPad|iPhone|iPod).+OS\s+(\d+)_(\d+)/.exec(navigator.userAgent);return t&&+t[1]>=10&&+t[2]>2&&!window.MSStream})()&&(this.setSize=r.debounce(this.setSize,500))},resizeHandler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._container&&this.setSize(t.force||!1)},setSize:function(t){var e=this,i=this._container.clientWidth,n=this._container.clientHeight;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this._container.style.top=0,this._container.clientWidth>this._container.clientHeight&&this._container.clientWidth<700)){var a=this._container.clientHeight,o=window.innerHeight;2<a-o&&a-o<=45&&(this._container.style.top="44px",document.body.scrollTop=44)}(t||!this._prev_size||this._prev_size.width!==i||this._prev_size.height!==n)&&i&&n&&(r.forEach(this.screen_profiles,function(t,a){r.removeClass(e._container,"vzb-"+a),i>=t.min_width&&n>=t.min_height&&(e._curr_profile=a)}),r.addClass(this._container,"vzb-"+this._curr_profile),r.classed(this._container,"vzb-portrait",i<n),r.classed(this._container,"vzb-landscape",!(i<n)),this._prev_size.width=i,this._prev_size.height=n,this.trigger("resize"))},setContainer:function(t){t.clientWidth&&t.clientHeight||r.warn("Vizabi is being initialised with a container of incorrect width or height. While this may be handled without a crash, it's not considered a healthy behavior. You should call Vizabi(placeholder,...) function when placeholder is not display:none and has some >0 !=auto width and height"),this._container=t,this.setSize(),this.updatePresentation()},updatePresentation:function(){r.classed(this._container,"vzb-presentation",this.presentation),this.trigger("resize")},getPresentationMode:function(){return this.presentation},setRTL:function(t){r.classed(this._container,"vzb-rtl",t)},currentProfile:function(){return this._curr_profile},clear:function(){window.removeEventListener("resize",this.resizeHandler)}});e.default=s},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(){return function t(e){function i(t){var e=b(t);return u?u(e.scale(t*e.sign)):e.scale(t*e.sign)}var r=[],a=[],o=.1,s=5,l=e.domain(),c=e.range(),u=null,h=void 0,d=void 0,f=function(t){return t instanceof Array?t.map(function(t){return Math.abs(t)}):Math.abs(t)},p=function(t,e){return{domain:t,sign:1,range:e,scale:d3.scaleLinear().domain(t).range(e)}},m=function(t,e,i){var n=t;return i&&(n=f(t)),{domain:t,sign:i?-1:1,range:e,scale:d3.scaleLog().domain(n).range(e)}},g=function(){h=c[0]<c[c.length-1];var t=h?1:-1;if(r=[],1==a.length)r=a[0][0]<=0&&a[0][1]>=0?[p(a[0],c)]:[m(a[0],c,a[0][0]<=0)];else{var i=d3.max(f(l)),n=f(d3.max(c)-d3.min(c)),u=1,g=0,v=0,b=0,y=0;e.domain([o,i]).range([0,n]);var _=s;0!=l[0]&&f(l[0])>o&&(g=e(f(l[0]))),0!=l[l.length-1]&&f(l.length-1)>o&&(v=e(f(l[l.length-1]))),f(l[0])>o&&(b=_),f(l[l.length-1])>o&&(y=_),n=n-b-y,0!=v&&(u=f(g/v));var x=void 0,w=void 0;2==a.length?0==l[0]||f(l[0])<=o?(x=c[0]+g*u*t+y*t,r=[p(a[0],[c[0],x]),m(a[1],[x,c[c.length-1]],!d)]):(0==l[l.length-1]||f(l[l.length-1])<=o)&&(x=c[c.length-1]-(b+y)*u*t,r=[m(a[0],[c[0],x],d),p(a[1],[x,c[c.length-1]])]):(x=c[0]+n/(1/u+1)*t,w=c[0]+(n/(1/u+1)+b+y)*t,r=[m(a[0],[c[0],x],d),p(a[1],[x,w]),m(a[2],[w,c[c.length-1]],!d)])}},v=function(){if(d=l[0]<l[l.length-1],a=[],d3.min(l)>0&&d3.max(l)>0||d3.min(l)<0&&d3.max(l)<0)a=[l];else{var t=void 0,e=void 0;d?(t=l[0],e=l[l.length-1]):(t=l[l.length-1],e=l[0]);for(var i=function(t,e){d?a.push([t,e]):a.unshift([e,t])};t!=e;)e<=-o||t>=-o&&e<=o||t>=o?(i(t,e),t=e):t<-o&&e>=-o?(i(t,-o),t=-o):t>=-o&&e>=o?(i(t,o),t=o):(console.warn("Something wrong while build subdomains: "+t+" "+e),t=e)}g()},b=function(t){if(d){if(t<l[0])return r[0];if(t>l[l.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(t>=r[e].domain[0]&&t<=r[e].domain[r[e].domain.length-1])return r[e]}else{if(t>l[0])return r[0];if(t<l[l.length-1])return r[r.length-1];for(var i=0;i<r.length;i++)if(t<=r[i].domain[0]&&t>=r[i].domain[r[i].domain.length-1])return r[i]}},y=function(t){if(h){if(t<c[0])return r[0];if(t>c[c.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(t>=r[e].range[0]&&t<=r[e].range[r[e].range.length-1])return r[e]}else{if(t>c[0])return r[0];if(t<c[c.length-1])return r[r.length-1];for(var i=0;i<r.length;i++)if(t<=r[i].range[0]&&t>=r[i].range[1])return r[i]}};return Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},i.eps=function(t){return arguments.length?(o=t,i.domain(l),i):o},i.delta=function(t){return arguments.length?(s=t,i.range(c),i):s},i.domain=function(t){if(!arguments.length)return l;switch(t.length){case 0:t=l;break;case 1:t=[t[0]/2,2*t[0]]}t[0]==t[t.length-1]&&(t[0]/=2,t[t.length-1]=2*t[t.length-1]),l=t;var e=d3.min(f(l).filter(function(t){return!!t}));return e&&(o=Math.min(o,e/100)),v(),i},i.range=function(t,e){if(!arguments.length)return u?u.range():c;switch(t.length){case 0:t=c;break;case 1:t=[t[0]-100,t[0]+100]}if(u&&!e)u.range(t);else{c=t;var n=d3.min(f(c).filter(function(t){return!!t}));n&&(s=Math.min(s,n/100)),g()}return i},i.interpolate=function(t){var e=l;if(a.length>1){var n=l,r=c,o=[l[0],l[l.length-1]];i.domain(o).range(o),e=n.map(function(t){return i(t)}),i.domain(n).range(r)}return u=d3.scaleLinear().domain(e).range(c).interpolate(t),i.range(u.domain(),!0),i},i.invert=function(t){var e=y(t);return e.scale.invert(t)*e.sign},i.ticks=function(t){for(var e=void 0,i=[],a=0;a<r.length;a++)e=-1==r[a].sign?r[a].scale.ticks().reverse().map(function(t){return-1*t}):r[a].scale.ticks(),i.length>0&&e.length>0&&i[i.length-1]==e[0]&&e.splice(0,1),i.push.apply(i,n(e));return i},i.copy=function(){return t(e).domain(l).range(c).delta(s).eps(o)},d3.rebind(i,e,"base","rangeRound","clamp","nice","tickFormat")}(d3.scaleLog().domain([.1,200]).range([0,1e3]))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r},function(t,e,i){"use strict";function n(t,e,i){var n,r,a,o=e?".onTap":".onLongTap";d3.select(t).on("touchstart"+o,function(t,e){n=d3.event.timeStamp,r=d3.event.changedTouches[0].screenX,a=d3.event.changedTouches[0].screenY}).on("touchend"+o,function(t,o){return r=Math.abs(r-d3.event.changedTouches[0].screenX),a=Math.abs(a-d3.event.changedTouches[0].screenY),r<5&&a<5?d3.event.timeStamp-n<500?e?e(t,o):void 0:i?i(t,o):void 0:void 0})}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return this.each(function(){n(this,t)})},a=function(t){return this.each(function(){n(this,null,t)})};e.default={onTap:r,onLongTap:a},e.onTap=r,e.onLongTap=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(399),s=n(o),l=i(75),c=n(l),u=i(1),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(u),d={},f=c.default.extend({_name:"csv",init:function(t){var e=this;this._data=[],this._lastModified=t.lastModified||"",this._basepath=t.path,this.delimiter=t.delimiter,this.keySize=t.keySize||1,this.assetsPath=t.assetsPath||"",this._parseStrategies=[].concat(r([",.",".,"].map(function(t){return e._createParseStrategy(t)})),[function(t){return t}]),Object.assign(this.ERRORS,{WRONG_TIME_COLUMN_OR_UNITS:"reader/error/wrongTimeUnitsOrColumn",NOT_ENOUGH_ROWS_IN_FILE:"reader/error/notEnoughRows",UNDEFINED_DELIMITER:"reader/error/undefinedDelimiter",EMPTY_HEADERS:"reader/error/emptyHeaders",DIFFERENT_SEPARATORS:"reader/error/differentSeparators",FILE_NOT_FOUND:"reader/error/fileNotFoundOrPermissionsOrEmpty"})},ensureDataIsCorrect:function(t,e){var i=t.columns,n=t.rows,r=i[this.keySize],o=a(n,1),s=o[0],l=e[r],c=s[r].trim();if(l&&!l(c))throw this.error(this.ERRORS.WRONG_TIME_COLUMN_OR_UNITS,void 0,c);if(!i.filter(Boolean).length)throw this.error(this.ERRORS.EMPTY_HEADERS)},getDatasetInfo:function(){return{name:this._basepath.split("/").pop()}},load:function(){var t=this,e=this._basepath,i=this._lastModified;return new Promise(function(n,r){var a=d[e+i];a?n(a):h.d3text(e,function(a,o){if(a)return a.name=t.ERRORS.FILE_NOT_FOUND,a.message="No permissions, missing or empty file: "+e,a.endpoint=e,r(a);try{var s=t.delimiter,l=void 0===s?t._guessDelimiter(o):s,c=d3.dsvFormat(l),u=c.parse(o,function(t){return Object.keys(t).every(function(e){return!t[e]})?null:t}),h=u.columns,f={columns:h,rows:u};d[e+i]=f,n(f)}catch(t){return r(t)}})})},getAsset:function(t){var e=this,i=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.assetsPath+t);return new Promise(function(t,n){h.d3json(i,function(r,a){if(r)return r.name=e.ERRORS.FILE_NOT_FOUND,r.message="No permissions, missing or empty file: "+i,r.endpoint=i,n(r);t(a)})})},_guessDelimiter:function(t){var e=this._getRows(t.replace(/"[^\r]*?"/g,""),2);if(2!==e.length)throw this.error(this.ERRORS.NOT_ENOUGH_ROWS_IN_FILE);var i=a(e,2),n=i[0],r=i[1],o=this._countCharsInLine(n,","),s=this._countCharsInLine(n,";"),l=this._countCharsInLine(r,","),c=this._countCharsInLine(r,";");if(this._checkDelimiters(o,l,s,c))return",";if(this._checkDelimiters(s,c,o,l))return";";throw this.error(this.ERRORS.UNDEFINED_DELIMITER)},_checkDelimiters:function(t,e,i,n){return t===e&&t>1&&(i!==n||!i&&!n||t>i&&e>n)},_getRows:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=/([^\r\n]+)/g,n=[],r=0,a=!0;a&&r!==e;)(a=i.exec(t))&&a.length>1&&(++r,n.push(a[1]));return n},_countCharsInLine:function(t,e){var i=new RegExp(e,"g"),n=t.match(i);return n?n.length:0},_createParseStrategy:function(t){var e=this;return function(i){if(!new RegExp("[^-\\d"+t+"]").test(i)&&i){var n=(0,s.default)(i,t);return isFinite(n)&&!isNaN(n)||(e._isParseSuccessful=!1),n}return i}},_mapRows:function(t,e,i){var n=this._getRowMapper(e,i);this._failedParseStrategies=0;var r=!0,a=!1,o=void 0;try{for(var s,l=this._parseStrategies[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;this._parse=c,this._isParseSuccessful=!0;var u=[],h=!0,d=!1,f=void 0;try{for(var p,m=t[Symbol.iterator]();!(h=(p=m.next()).done);h=!0){var g=p.value,v=n(g);if(!this._isParseSuccessful){this._failedParseStrategies++;break}u.push(v)}}catch(t){d=!0,f=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw f}}if(this._isParseSuccessful){if(this._failedParseStrategies===this._parseStrategies.length-1)throw this.error(this.ERRORS.DIFFERENT_SEPARATORS);return u}}}catch(t){a=!0,o=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}},versionInfo:{version:"0.31.0",build:1522445132733}});e.default=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(77),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s={TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},THUMB_STROKE_WIDTH:4},l={small:{minRadiusPx:.5,maxRadiusEm:.05},medium:{minRadiusPx:1,maxRadiusEm:.05},large:{minRadiusPx:1,maxRadiusEm:.05}},c=o.default.extend({init:function(t,e){this.name="bubblesize";var i=r.extend({},s);this.options=r.extend(i,this.options||{});var n=r.extend({},l);this.profiles=r.extend(n,this.profiles||{}),this.model_expects=[{name:"submodel",type:"size"},{name:"locale",type:"locale"}];this.changeHandler=this.changeHandler.bind(this),this.readyHandler=this.readyHandler.bind(this),this.model_binds={"change:submodel.domainMin":this.changeHandler,"change:submodel.domainMax":this.changeHandler},this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var i=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._updateLabels(i),this._super(t,e)},readyHandler:function(t){this._super(t),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this._setLabelsText()},readyOnce:function(){var t=this;this._super(),this.showArcs=!1!==t.model.submodel.showArcs,this.padding.bottom=this.options.BAR_WIDTH+this.options.TEXT_PARAMS.MAX_HEIGHT,t.showArcs&&this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc").data([0,0]).enter().append("path").attr("class","vzb-bs-slider-thumb-arc"),this.sliderArcsEl=this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc"),this.sliderLabelsWrapperEl=this.sliderEl.append("g"),this.sliderLabelsWrapperEl.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("text-anchor",function(t,e){return e?"start":"end"}).attr("dy",function(t,e){return e?"-0.7em":"1.4em"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-bs-slider-thumb-label"),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText()},ready:function(){this._super(),this._updateLabels()},getMinMaxBubbleRadius:function(){var t=this.root.getVizWidthHeight(),e=r.hypotenuse(t.width,t.height),i=this.profiles[this.getLayoutProfile()].minRadiusPx,n=this.profiles[this.getLayoutProfile()].maxRadiusEm*e;return i>n&&(n=i),{min:i,max:n}},_updateSize:function(){var t=this;this._super(),this.sliderLabelsWrapperEl.attr("transform",this.isRTL?"scale(-1,1)":null),this.sliderLabelsEl.attr("text-anchor",function(e,i){return(t.isRTL?!i:i)?"start":"end"})},_resize:function(){var t=this.getMinMaxBubbleRadius(),e=this.element.node().offsetWidth-2*t.max;this.padding.top=t.max+this.options.BAR_WIDTH,this.padding.left=.5*e,this.padding.right=.5*e,this.rescaler.range([2*t.min,2*t.max]),this._super()},_getComponentWidth:function(){return 2*this.getMinMaxBubbleRadius().max},_updateThumbs:function(t){this._updateArcs(t),this._updateLabels(t)},_updateArcs:function(t){if(this.showArcs){var e=this,i=d3.arc().outerRadius(function(t){return.5*e.rescaler(t)}).innerRadius(function(t){return.5*e.rescaler(t)}).startAngle(.5*-Math.PI).endAngle(.5*Math.PI);this.sliderArcsEl.data(t).attr("d",i).attr("transform",function(t){return"translate("+.5*e.rescaler(t)+",0)"})}},_updateLabels:function(t){var e=this,i=this;t&&this.sliderLabelsEl.data(t),this.sliderLabelsEl.attr("transform",function(t,n){var r={v:e.options.TEXT_PARAMS.TOP,h:e.options.TEXT_PARAMS.LEFT},a=r.h*(n?.5:-1)+i.rescaler(t);return"translate("+(i.isRTL?-1:1)*a+",0)"})},_setLabelsText:function(){var t=this,e=[t.model.submodel.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.submodel.getTickFormatter()(t.sizeScaleMinMax[1])];t.sliderLabelsEl.text(function(t,i){return e[i]})}});e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(77),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s={},l={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}},c=o.default.extend({init:function(t,e){this.name="sizeslider";var i=r.extend({},s);this.options=r.extend(i,this.options||{});var n=r.extend({},l);this.profiles=r.extend(n,this.profiles||{}),this.propertyName=t.propertyname,this.model_expects=[{name:"submodel",type:"size"},{name:"locale",type:"locale"}];this.changeHandler=this.changeHandler.bind(this),this.readyHandler=this.readyHandler.bind(this),this.model_binds={"change:submodel.domainMin":this.changeHandler,"change:submodel.domainMax":this.changeHandler},this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var i=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._updateLabels(i),this._super(t,e)},readyHandler:function(t){this.modelUse=this.model.submodel.use;var e=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];if("constant"!=this.modelUse)this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sliderEl.selectAll(".w").classed("vzb-hidden",!1),this.sliderEl.select(".selection").classed("vzb-hidden",!1),this.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!1),this._setLabelsText();else if(this.sliderEl.selectAll(".w").classed("vzb-hidden",!0),this.sliderEl.select(".selection").classed("vzb-hidden",!0),this.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!0),!this.model.submodel.which){var i=this.propertyActiveProfile;e[1]=(i.default-i.min)/(i.max-i.min),this.model.submodel.which="_default"}this._moveBrush(e)},readyOnce:function(){this._super();var t=this.options,e=t.BAR_WIDTH;this.propertyActiveProfile=this.getPropertyActiveProfile(),this.propertyScale=d3.scaleLinear().domain([t.EXTENT_MIN,t.EXTENT_MAX]).range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]).clamp(!0),this.padding.top=this.propertyActiveProfile.max+1.25*e,this.translator=this.model.locale.getTFunction(),this.sliderLabelsWrapperEl=this.sliderEl.append("g"),this.sliderLabelsWrapperEl.selectAll("text").data([0,0]).enter().append("text").attr("class",function(t,e){return"vzb-szs-slider-thumb-label "+(e?"e":"w")}).attr("dy",1.25*-e+"px"),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-szs-slider-thumb-label"),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText(),this.model._ready&&this.readyHandler()},ready:function(){this._super(),this._updateLabels()},getPropertyActiveProfile:function(){var t=this.profiles[this.getLayoutProfile()];return{min:t["min"+this.propertyName],max:t["max"+this.propertyName],default:t["default"+this.propertyName]}},_updateSize:function(){var t=this;this._super(),this.sliderLabelsWrapperEl.attr("transform",this.isRTL?"scale(-1,1)":null),this.sliderLabelsEl.attr("text-anchor",function(e,i){return(t.isRTL?i:!i)?"start":"end"})},_resize:function(){this.propertyActiveProfile=this.getPropertyActiveProfile(),this.propertyScale.range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]),this.padding.top=this.propertyActiveProfile.max+1.25*this.options.BAR_WIDTH,this._super()},_updateThumbs:function(t){this._updateLabels(t)},_updateLabels:function(t){var e=this;t&&this.sliderLabelsEl.data(t),this.sliderLabelsEl.attr("transform",function(t,i){var n=e.rescaler(i);return"translate("+(e.isRTL?-1:1)*n+",0)"}).attr("font-size",function(t,i){return e.propertyScale(t)}),"constant"===e.model.submodel.use&&this.sliderLabelsEl.text(function(t){return~~e.propertyScale(t)+(e.translator(e.ui.constantUnit)||"")})},_setLabelsText:function(){var t=this,e=[t.model.submodel.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.submodel.getTickFormatter()(t.sizeScaleMinMax[1])];t.sliderLabelsEl.text(function(t,i){return e[i]})}});e.default=c},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(){return!!window&&(void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement&&window.document.msFullscreenElement)}function a(t){r()||(s.call(this),this.resizeInExitHandler?this.root.ui.resizeHandler():t())}function o(t){if(window){var e=window.document;this.exitFullscreenHandler=a.bind(this,t),e.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}}function s(){var t=window.document;t.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("fullscreenchange",this.exitFullscreenHandler),t.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function l(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&u()&&t.webkitRequestFullscreen()}function c(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&u()?document.webkitExitFullscreen():(s.call(this),this.resizeInExitHandler=!1)}function u(){return!(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"))}Object.defineProperty(e,"__esModule",{value:!0});var h=i(1),d=n(h),f=i(6),p=function(t){return t&&t.__esModule?t:{default:t}}(f),m=i(21),g=n(m),v=p.default.extend({init:function(t,e){var i=this;this.name=this.name||"gapminder-buttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},mapcolors:{title:"buttons/mapcolors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},zoom:{title:"buttons/zoom",icon:"cursorPlus",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"ui.chart.trails",statebindfunc:this.setBubbleTrails.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},about:{title:"buttons/about",icon:"about",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},side:{title:"buttons/side",icon:"side",required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.model_binds={"change:state.marker.select":function(t){i._readyOnce&&(i.setBubbleTrails(),i.setBubbleLock(),i._toggleButtons())},"change:ui.chart":function(t,e){i._readyOnce&&(e.indexOf("lockActive")>-1||e.indexOf("lockUnavailable")>-1)&&i.setBubbleLock()}},t.ui.buttons.forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(n){i._readyOnce&&e.statebindfunc(t,n.source.value)})}),this._super(t,e),this.validatePopupButtons(this.model.ui.buttons,this.model.ui.dialogs)},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.root.findChildByName("gapminder-dialogs").on("close",function(e,i){t.setButtonActive(i.id,!1)});var e=(this.model.ui.dialogs||{}).sidebar||[],i=[].concat(this.model.ui.buttons);this.model.ui.buttons=i,this._addButtons(i,e),this._prev_body_overflow=document.body.style.overflow,this.setBubbleTrails(),this.setBubbleLock(),this.setInpercent(),this.setPresentationMode(),this._toggleButtons()},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=i.attr("class"),r=e._available_buttons[t];if(r&&r.func)r.func(t);else{var a=-1===n.indexOf("vzb-active");i.classed("vzb-active",a);var o={};o.id=t,o.active=a,e.trigger("click",o)}},validatePopupButtons:function(t,e){for(var i=this,n=e.popup,r=t.filter(function(t){return i._available_buttons[t]&&!i._available_buttons[t].func}),a=0,o=r.length;a<o;a++)if(-1==n.indexOf(r[a]))return d.error('Buttonlist: bad buttons config: "'+r[a]+'" is missing in popups list');return!1},_showAllButtons:function(){this.element.selectAll(".vzb-buttonlist-btn").each(function(t,e){d3.select(this).style("display","")})},_toggleButtons:function(){var t=this,e=this.parent.element.node?this.parent.element:d3.select(this.parent.element),i=(this.model.ui.dialogs||{}).sidebar||[];t._showAllButtons();var n=this.element.selectAll(".vzb-buttonlist-btn"),r=(this.element.node().getBoundingClientRect(),[]),a=[],o=80,s=80,l=this.element.node().getBoundingClientRect().width,c=this.element.node().getBoundingClientRect().height,u=0,h=0;n.each(function(e,n){var l=e,c=d3.select(this),d=-1!==i.indexOf(l.id),f={top:parseInt(c.style("margin-top")),right:parseInt(c.style("margin-right")),left:parseInt(c.style("margin-left")),bottom:parseInt(c.style("margin-bottom"))};o=c.node().getBoundingClientRect().width+f.right+f.left,s=c.node().getBoundingClientRect().height+f.top+f.bottom,c.classed("vzb-hidden")||(d&&"large"===t.getLayoutProfile()?c.style("display","none"):(u+=o,h+=s,l.required?a.push(c):r.push(c)))});var d=u-l,f=h-c,p=1;e.classed("vzb-large")&&e.classed("vzb-dialog-expand-true")||e.classed("vzb-small")&&e.classed("vzb-portrait")?(d>0&&d<=10&&(l+=d),(p=Math.floor(l/o)-a.length)<0&&(p=0)):(f>0&&f<=10&&(c+=f),(p=Math.floor(c/s)-a.length)<0&&(p=0)),r.reverse();for(var m=[],g=0,v=r.length-p;g<v;g++)r[g].style("display","none"),m.push(r[g].attr("data-btn"));var b={};b.hiddenButtons=m,t.trigger("toggle",b)},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var r=0;r<t.length;r++){var a=t[r],o=this._available_buttons[a],s=o?a:"_default",l=d.clone(this._available_buttons[s]);"_default"==s&&(l.title="buttons/"+a),l.id=a,l.icon=g[l.icon],n.push(l)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"});this.element.selectAll(".vzb-buttonlist-btn").on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},scrollToEnd:function(){var t=0,e=d3.select(".vzb-tool");e.classed("vzb-portrait")&&e.classed("vzb-small")?(this.model.state.marker.select.length>0&&(t=this.element.node().scrollWidth),this.element.node().scrollLeft=t):(this.model.state.marker.select.length>0&&(t=this.element.node().scrollHeight),this.element.node().scrollTop=t)},resize:function(){if(!this.element.selectAll)return d.warn("buttonlist resize() aborted because element is not yet defined");"small"===this.getLayoutProfile()&&this.model.ui.presentation&&this.togglePresentationMode(),this._toggleButtons()},setButtonActive:function(t,e){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").classed("vzb-active",e)},toggleBubbleTrails:function(){this.model.ui.chart.trails=!this.model.ui.chart.trails,this.setBubbleTrails()},setBubbleTrails:function(){var t=(this.model.ui.chart||{}).trails;if(t||!1===t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='trails']");if(!e.node())return d.warn("setBubbleTrails: no button 'trails' found in DOM. doing nothing");e.classed("vzb-active-locked",t),e.classed("vzb-hidden",0==this.model.state.marker.select.length)}},toggleBubbleLock:function(t){var e=(this.model.ui.chart||{}).lockActive;if(0!=this.model.state.marker.select.length||e){var i=this.model.ui.chart.lockNonSelected,n=this.model.state.time;i=i?0:n.formatDate(n.value),this.model.ui.chart.lockNonSelected=i,this.setBubbleLock()}},setBubbleLock:function(){var t=(this.model.ui.chart||{}).lockNonSelected,e=(this.model.ui.chart||{}).lockActive,i=(this.model.ui.chart||{}).lockUnavailable||!1;if(t||0===t){0===t||0!==this.model.state.marker.select.length||e||(t=this.model.ui.chart.lockNonSelected=0);var n=this.element.selectAll(".vzb-buttonlist-btn[data-btn='lock']");if(!n.node())return d.warn("setBubbleLock: no button 'lock' found in DOM. doing nothing");var r=this.model.locale.getTFunction();n.classed("vzb-unavailable",i),void 0===e?n.classed("vzb-hidden",0==this.model.state.marker.select.length):n.classed("vzb-hidden",!e),n.classed("vzb-active-locked",t),n.select(".vzb-buttonlist-btn-icon").html(g[t?"lock":"unlock"]),n.select(".vzb-buttonlist-btn-title>span").text(t||r("buttons/lock")).attr("data-vzb-translate",t?null:"buttons/lock")}},toggleInpercent:function(){this.model.ui.chart.inpercent=!this.model.ui.chart.inpercent,this.setInpercent()},setInpercent:function(){if(void 0!==(this.model.ui.chart||{}).inpercent){this.model.locale.getTFunction();this.element.selectAll(".vzb-buttonlist-btn[data-btn='inpercent']").classed("vzb-active-locked",this.model.ui.chart.inpercent)}},togglePresentationMode:function(){this.model.ui.presentation=!this.model.ui.presentation,this.setPresentationMode()},setPresentationMode:function(){this.model.locale.getTFunction();this.element.selectAll(".vzb-buttonlist-btn[data-btn='presentation']").classed("vzb-active-locked",this.model.ui.presentation)},toggleFullScreen:function(t,e){if(window){for(var i=this,n=i.placeholder,r=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),a=!this.model.ui.fullscreen,s=a?"hidden":this._prev_body_overflow;!d.hasClass(n,"vzb-placeholder");)i=i.parent,n=i.placeholder;a?(this.resizeInExitHandler=!1,l(n),o.call(this,this.toggleFullScreen.bind(this,t,!0))):(this.resizeInExitHandler=!e,c.call(this)),d.classed(n,"vzb-force-fullscreen",a),"undefined"!=typeof container&&d.classed(container,"vzb-container-fullscreen",a),this.model.ui.fullscreen=a;var u=this.model.locale.getTFunction();r.classed("vzb-active-locked",a),r.select(".vzb-buttonlist-btn-icon").html(g[a?"unexpand":"expand"]),r.select(".vzb-buttonlist-btn-title>span").text(u("buttons/"+(a?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(a?"unexpand":"expand")),document.body.style.overflow=s,this.resizeInExitHandler||this.root.ui.resizeHandler()}}});e.default=v},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(n(r),i(162)),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=i(21),l=(n(s),o.default.extend({init:function(t,e){this.name="gapminder-optionsbuttonlist",this._super(t,e)},readyOnce:function(){var t=this;Object.keys(this._available_buttons).forEach(function(e){var i=t._available_buttons[e];i.required=!i.required}),this.buttonListComp=this.root.findChildByName("gapminder-buttonlist"),this.buttonListComp.on("click",function(e,i){t.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i.id+"']").classed("vzb-active",i.active)}),this.buttonListComp.on("toggle",function(e,i){var n=0;t.element.selectAll(".vzb-buttonlist-btn").each(function(t){var e=d3.select(this),r=-1==i.hiddenButtons.indexOf(t.id);e.style("display",r?"none":""),r||n++})}),this._super()},proceedClick:function(t){var e=this;this.buttonListComp.proceedClick(t),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").datum().func&&setTimeout(function(){e.root.findChildByName("gapminder-dialogs").closeAllDialogs()},200)},_toggleButtons:function(){}}));e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(1),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o),l=i(6),c=n(l),u=i(165),h=n(u),d=i(111),f=n(d),p=i(21),m=c.default.extend({init:function(t,e){var i=this;this.template='<div class="vzb-cl-outer"></div>',this.name="colorlegend",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"marker"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:color.scaleType":function(t,e){i._readyOnce&&!i.colorModel.isDiscrete()&&i.updateView()},"change:color.palette":function(t,e){!i._readyOnce||i.colorModel.isDiscrete()&&!i.frame||i.updateView()},"change:marker.highlight":function(t,e){i.colorModel.isDiscrete()&&i.model.marker.getFrame(i.model.time.value,function(t){if(t){var e=i.model.marker.getHighlighted(i.KEY);i.updateGroupsOpacity(e.map(function(e){return t[i.colorModel._name][e]}))}else i.updateGroupsOpacity()})},"change:time.start":function(t,e){i._readyOnce&&!i.model.time.splash&&i.colorModel.which==i.model.time.dim&&i.ready()},"change:time.end":function(t,e){i._readyOnce&&!i.model.time.splash&&i.colorModel.which==i.model.time.dim&&i.ready()},"translate:locale":function(){i._translateSelectDialog(i.model.locale.getTFunction()),i.colorPicker.translate(i.model.locale.getTFunction())}},this._super(t,e)},readyOnce:function(){var t=this;this.element=d3.select(this.element),d3.select(this.placeholder.parentNode).classed("vzb-dialog-scrollable",!0),this.colorModel=this.model.color,this.colorlegendMarker=this.colorModel.getColorlegendMarker(),this.colorlegendMarker&&this.colorlegendMarker.on("ready",function(){t.ready()}),this.listColorsEl=this.element.append("div").attr("class","vzb-cl-holder").append("div").attr("class","vzb-cl-colorlist"),this.rainbowEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow"),this.rainbowCanvasEl=this.rainbowEl.append("canvas"),this.minimapEl=this.listColorsEl.append("div").attr("class","vzb-cl-minimap"),this.rainbowLegendEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow-legend"),this.rainbowLegendSVG=this.rainbowLegendEl.append("svg"),this.rainbowLegendG=this.rainbowLegendSVG.append("g"),this.rainbowLegend=null,this.labelScaleEl=this.listColorsEl.append("div").attr("class","vzb-cl-labelscale"),this.labelScaleSVG=this.labelScaleEl.append("svg"),this.labelScaleG=this.labelScaleSVG.append("g"),this.subtitleDiv=this.listColorsEl.append("div").attr("class","vzb-cl-subtitle"),this.subtitleText=this.subtitleDiv.append("span").attr("class","vzb-cl-subtitle-text"),this.minimapSVG=this.minimapEl.append("svg"),this.minimapG=this.minimapSVG.append("g"),this.colorPicker=new h.default(s.isArray(this.root.element)?this.root.element:d3.select(this.root.element)),this.colorPicker.translate(this.model.locale.getTFunction()),this._initSelectDialog()},_initSelectDialog:function(){this.moreOptionsHint=this.listColorsEl.append("span").classed("vzb-cl-more-hint vzb-hidden",!0),this.selectDialog=this.listColorsEl.append("div").classed("vzb-cl-select-dialog vzb-hidden",!0),this._initSelectDialogItems(),this._translateSelectDialog(this.model.locale.getTFunction())},_initSelectDialogItems:function(){var t=this;this.selectDialogTitle=this.selectDialog.append("div").classed("vzb-cl-select-dialog-title",!0),this.selectDialog.append("div").classed("vzb-cl-select-dialog-close",!0).html(p.close).on("click",function(){return t._closeSelectDialog()}),this.selectAllButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item",!0),this.removeElseButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item",!0),this.editColorButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item vzb-cl-select-dialog-item-moreoptions",!0),this.editColorButtonTooltip=this.editColorButton.append("div").classed("vzb-cl-select-dialog-item-tooltip",!0)},_translateSelectDialog:function(t){this.moreOptionsHint.text(t("hints/color/more")),this.selectAllButton.text("âœ… "+t("dialogs/color/select-all")),this.removeElseButton.text("ðŸ—‘ï¸ "+t("dialogs/color/remove-else")),this.editColorButton.text("ðŸŽ¨ "+t("dialogs/color/edit-color")),this.editColorButtonTooltip.text("Dataset author doesn't want you to change this")},_closeSelectDialog:function(){this.selectDialog.classed("vzb-hidden",!0)},_bindSelectDialogItems:function(){for(var t=this,e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];var o=a(i,3),s=o[1],l=o[2];this.selectDialogTitle.text(l[s].textContent),this.selectAllButton.on("click",function(){var e;(e=t._interact()).clickToSelect.apply(e,r(i)),t._closeSelectDialog()}),this.removeElseButton.on("click",function(){var e;(e=t._interact()).clickToShow.apply(e,r(i)),t._closeSelectDialog()}),this.editColorButton.on("click",function(){var e;(e=t._interact()).clickToChangeColor.apply(e,r(i)),t._closeSelectDialog()})},ready:function(){var t=this;if(this.KEYS=s.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.colorlegendDim=this.KEY,this.canShowMap=!1,this.colorModel.isDiscrete()&&"constant"!==this.colorModel.use&&this.colorlegendMarker){if(!this.colorlegendMarker._ready)return;return this.markerKeys=t.model.marker.getKeys(),this.KEY=t.colorModel.getDataKeys()[0],this.colorlegendDim=this.colorModel.getColorlegendEntities().getDimension(),void this.colorlegendMarker.getFrame(this.model.time.value,function(e){if(!e)return s.warn("colorlegend received empty frame in ready()");t.frame=e,t.canShowMap=s.keys((t.frame||{}).hook_geoshape||{}).length,t.colorlegendKeys=t.colorlegendMarker.getKeys(t.colorlegendDim),t.colorlegendKeys.forEach(function(e){((t.frame||{}).hook_geoshape||{})[e[t.colorlegendDim]]||(t.canShowMap=!1)}),t.updateView(),t.updateGroupsOpacity()})}t.updateView(),t.updateGroupsOpacity()},updateView:function(){var t=this;if(!this.element.selectAll)return s.warn("colorlegend resize() aborted because element is not yet defined");var e=this,i=this.KEY,n=this.colorModel.getPalette(),r=this.canShowMap,a=this.colorlegendKeys||[],o=this.listColorsEl.selectAll(".vzb-cl-option"),l=r||"_default"==this.colorModel.which||this.colorlegendMarker&&this.colorlegendDim==this.KEY&&a.length>10&&s.comparePlainObjects(this.colorModel.getColorlegendEntities().getFilter(),this.model.entities.getFilter());o.classed("vzb-hidden",l),this._updateSelectDialog(),this.rainbowEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.labelScaleEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.rainbowLegendEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.minimapEl.classed("vzb-hidden",!r||!this.colorModel.isDiscrete()),this.subtitleDiv.classed("vzb-hidden",!0);var c=this.colorModel.getScale();if(this.colorModel.isDiscrete())if(r){var u=this.minimapEl.append("div").attr("class","vzb-temp");this.minimapSVG.attr("viewBox",null),this.minimapSVG.selectAll("g").remove(),this.minimapG=this.minimapSVG.append("g"),this.minimapG.selectAll("path").data(a,function(t){return t[e.colorlegendDim]}).enter().append("path").on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}).each(function(t){var i=e.frame.hook_geoshape[t[e.colorlegendDim]].trim();"<svg"==i.slice(0,4)&&(u.html(i),i=u.select("svg").select("path").attr("d")),d3.select(this).attr("d",i).style("fill",c(t[e.colorlegendDim])).append("title").text(e.frame.label[t[e.colorlegendDim]]),u.html("")});var h=this.minimapG.node().getBBox();this.minimapSVG.attr("viewBox","0 0 "+1.05*h.width+" "+1.05*h.height),u.remove()}else o="_default"==this.colorModel.which?o.data([]):o.data(l?[]:a.length?e.colorlegendDim==i?s.unique(e.markerKeys,function(t){return t[i]}):a:Object.keys(this.colorModel.getPalette()).map(function(t){var i={};return i[e.colorlegendDim]=t,i}),function(t){return t[e.colorlegendDim]}),o.exit().remove(),o=o.enter().append("div").attr("class","vzb-cl-option").each(function(){var t=this;d3.select(this).append("div").attr("class","vzb-cl-color-sample").on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}),d3.select(this).append("div").attr("class","vzb-cl-color-legend")}).on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}).merge(o),o.each(function(t,i){d3.select(this).select(".vzb-cl-color-sample").style("background-color",c(t[e.colorlegendDim])).style("border","1px solid "+c(t[e.colorlegendDim]));var n=e.colorlegendMarker?e.frame.label[t[e.colorlegendDim]]:null;n||0===n||(n=t[e.colorlegendDim]),d3.select(this).select(".vzb-cl-color-legend").text(n)});else{var d=this.rainbowEl.node().getBoundingClientRect().width,p=Object.keys(n).map(parseFloat),m=void 0,g=void 0,v=this.colorModel.getTickFormatter(),b=null,y=this.colorModel.paletteLabels;if(y){b="optimistic",m=y.map(function(t){return parseFloat(t)});var _=d3.max(m);g=m.map(function(t){return t/_*d})}else{m=c.domain();var x=d3.max(p);g=p.map(function(t){return t/x*d})}var w=d3.min(m)<=0&&d3.max(m)>=0&&"log"===this.colorModel.scaleType?"genericLog":this.colorModel.scaleType,S=d3["scale"+s.capitalize("time"===w?"linear":w)]().domain(m).range(g),M=parseInt(this.rainbowEl.style("left"),10)||0,k=parseInt(this.rainbowEl.style("right"),10)||M;this.labelScaleSVG.style("width",M+d+k+"px"),this.labelScaleG.attr("transform","translate("+M+",0)"),this.rainbowLegendSVG.style("width",M+d+k+"px"),this.rainbowLegendG.attr("transform","translate("+M+", 7)");var E=(0,f.default)("bottom");E.scale(S).tickSizeOuter(0).tickPadding(6).tickSizeMinor(3,0).labelerOptions({scaleType:this.colorModel.scaleType,toolMargin:{right:k,left:M},showOuter:!0,formatter:v,bump:M,cssFontSize:"11px",fitIntoScale:b}),this.labelScaleG.call(E);var z=c.range(),O=g.map(function(t,e){return{val:t,color:z[e],paletteKey:p[e]}});this.rainbowLegend=this.rainbowLegendG.selectAll("circle").data(O),this.rainbowLegend.exit().remove(),this.rainbowLegend=this.rainbowLegend.enter().append("circle").attr("r","6px").attr("stroke","#000").on("click",e._interact().clickToChangeColor).merge(this.rainbowLegend),this.rainbowLegend.each(function(t,e){d3.select(this).attr("fill",t.color),d3.select(this).attr("cx",t.val)}),this.rainbowCanvasEl.attr("width",d).attr("height",1).style("width",d+"px").style("height","100%");for(var T,C=this.rainbowCanvasEl.node().getContext("2d"),P=C.createImageData(d,1),D=0,A=-1;D<d;++D)T=d3.rgb(c(S.invert(D))),P.data[++A]=T.r,P.data[++A]=T.g,P.data[++A]=T.b,P.data[++A]=255;C.putImageData(P,0,0);var I=this.colorModel.getConceptprops(),L=s.getSubtitle(I.name,I.name_short);this.subtitleDiv.classed("vzb-hidden",""==L),this.subtitleText.text(L),o.classed("vzb-hidden",!0)}},_updateSelectDialog:function(){var t=this.colorModel.isUserSelectable();this.editColorButtonTooltip.classed("vzb-hidden",t),this.editColorButton.classed("vzb-cl-select-dialog-item-disabled",!t),this.selectDialog.classed("vzb-hidden",!0)},_highlight:function(t){s.getProp(this,["model","ui","chart","superhighlightOnMinimapHover"])?this.model.marker.setSuperHighlight(t):this.model.marker.setHighlight(t)},_unhighlight:function(){s.getProp(this,["model","ui","chart","superhighlightOnMinimapHover"])?this.model.marker.clearSuperHighlighted():this.model.marker.clearHighlighted()},_interact:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.colorlegendDim;return{mouseover:function(e,r){if(t.moreOptionsHint.classed("vzb-hidden",!1),t.colorModel.isDiscrete()){var a=(d3.select(this),e[n]),o=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==a}).reduce(function(t,e){return t[e[i]]=!0,t},{});t._highlight(t.markerKeys.filter(function(t){return o[t[i]]}))}},mouseout:function(e,i){t.moreOptionsHint.classed("vzb-hidden",!0),t.colorModel.isDiscrete()&&t._unhighlight()},clickToChangeColor:function(e,i){if(t.colorModel.isUserSelectable()){var r=t.colorModel.getPalette(),a=t.colorModel.getDefaultPalette(),o=(d3.select(this),t.colorModel.isDiscrete()?e[n]:e.paletteKey);t.colorPicker.colorOld(r[o]).colorDef(a[o]).callback(function(e,i){return t.colorModel.setColor(e,o,i)}).fitToScreen([d3.event.pageX,d3.event.pageY]).show(!0)}},clickToShow:function(e,i){if(t.colorModel.isDiscrete()){var r=(d3.select(this),e[n],t.model.entities.show[n]&&t.model.entities.show[n].$in?s.clone(t.model.entities.show[n].$in):[]),a=r.indexOf(e[n]);-1!==a?r.splice(a,1):r.push(e[n]);var o={};r.length>0&&(o[n]={$in:r}),t.model.entities.set({show:o})}},clickToSelect:function(r,a){if(t.colorModel.isDiscrete()){var o=(d3.select(this),r[n]),l=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==o}).reduce(function(t,e){return t[e[i]]=!0,t},{}),c=t.markerKeys.filter(function(t){return l[t[i]]}).map(function(t){return s.clone(t,e)});c.filter(function(e){return t.model.marker.isSelected(e)}).length==c.length?t.model.marker.clearSelected():t.model.marker.setSelect(c)}}}},resize:function(){this.frame&&this.updateView(),this.colorPicker.resize(d3.select(".vzb-colorpicker-svg"))},updateGroupsOpacity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this,i=this.colorModel.getColorlegendMarker()||{},n=i.opacityRegular||.8,r=i.opacityHighlightDim||.5,a=e.canShowMap?".vzb-cl-minimap path":".vzb-cl-option .vzb-cl-color-sample";this.listColorsEl.selectAll(a).style("opacity",function(i){return t.length?t.indexOf(i[e.colorlegendDim])>-1?1:r:n})}});e.default=m},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),o={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorpicker-pointer",COLOR_BUTTON:"vzb-colorpicker-cell",COLOR_DEFAULT:"vzb-colorpicker-default",COLOR_SAMPLE:"vzb-colorpicker-sample",COLOR_PICKER:"vzb-colorpicker-svg",COLOR_CIRCLE:"vzb-colorpicker-circle",COLOR_CIRCLES:"vzb-colorpicker-circles",COLOR_SEGMENT:"vzb-colorpicker-segment",COLOR_BACKGR:"vzb-colorpicker-background"},s=function(){function t(e){n(this,t),this._container=e,this._wrapper=this._container.select("."+o.COLOR_PICKER),this._init()}return r(t,[{key:"_init",value:function(){this._initVariables(),this._initCircles(),this._style(),this.resize(this._svg)}},{key:"_initVariables",value:function(){this._maxWidth=280,this._maxHeight=323,this._colorOld="#000",this._colorDef="#000",this._colorWhite="#f8f8f8",this._margin={top:.1,bottom:.1,left:.1,right:.1},this._initSvg();var t=getComputedStyle(this._svg.node()),e=t.width,i=t.height;this._width=this.constructor.px2num(e),this._height=this.constructor.px2num(i),this._maxRadius=this._width/2*(1-this._margin.left-this._margin.right),this._nCellsH=15,this._minH=0,this._nCellsL=4,this._minL=.5,this._satConstant=.7,this._outerL_display=.4,this._outerL_meaning=.3,this._firstAngleSat=0,this._minRadius=15,this._arc=d3.arc(),this._pie=d3.pie().sort(null).value(function(t){return 1}),this._colorPointer=null,this._showColorPicker=!1,this._sampleRect=null,this._sampleText=null,this._callback=function(t){return console.info("Color picker callback example. Setting color to "+t)},this._colorData=this._generateColorData()}},{key:"_generateColorData",value:function(){for(var t=this._minL,e=this._minH,i=this._nCellsL,n=this._nCellsH,r=this._firstAngleSat,a=this._satConstant,o=this._outerL_display,s=this._outerL_meaning,l=[],c=0;c<i;c++){var u=t+(1-t)/i*c;l.push([]);for(var h=0;h<=n;h++){var d=e+(1-e)/n*h;l[c].push({display:this.constructor.hsl2rgb(d,0===h?r:a,0===c?o:u),meaning:this.constructor.hsl2rgb(d,0===h?r:a,0===c?s:u)})}}return l}},{key:"_initSvg",value:function(){var t=this;this._wrapper=this._container.append("div").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("max-width",this._maxWidth+"px").style("height","100%").style("max-height",this._maxHeight+"px").style("z-index",9999).attr("class",o.COLOR_PICKER+" vzb-dialog-shadow").classed(o.INVISIBLE,!this._showColorPicker).on("mouseout",function(){return t._cellHover(t._colorOld)}),this._svg=this._wrapper.append("svg").style("width","100%").style("height","100%")}},{key:"_initCircles",value:function(){var t=this,e=this._svg,i=this._maxHeight,n=this._width,r=this._height,a=this._margin,s=this._colorData,l=this._nCellsL,c=this._minRadius,u=this._maxRadius,h=this._colorWhite;e.append("rect").attr("width",n).attr("height",i).attr("class",o.COLOR_BACKGR).on("mouseover",function(){return t._cellHover(t._colorOld)}).on("click",function(){d3.event.stopPropagation(),t._changeColor(t._colorOld),t.show(!1)});var d=u+n*a.left,f=u+r*a.top,p=e.append("g").attr("class",o.COLOR_CIRCLES).attr("transform","translate("+d+", "+f+")");e.append("rect").attr("class",o.COLOR_SAMPLE).attr("width",n/2).attr("height",r*a.top/2),this._sampleRect=e.append("rect").attr("class",o.COLOR_SAMPLE).attr("width",n/2).attr("x",n/2).attr("height",r*a.top/2),e.append("text").attr("x",n*a.left).attr("y",r*a.top/2).attr("dy","1.3em").attr("class",o.COLOR_SAMPLE).style("text-anchor","start"),this._sampleText=e.append("text").attr("x",n*(1-a.right)).attr("y",r*a.top/2).attr("dy","1.3em").attr("class",o.COLOR_SAMPLE).style("text-anchor","end"),e.append("text").attr("x",.1*n).attr("y",r*(1-a.bottom)).attr("dy","1.2em").attr("class","vzb-default-label").style("text-anchor","start").text("default"),e.append("circle").attr("class",o.COLOR_DEFAULT+" "+o.COLOR_BUTTON).attr("r",n*a.left/2).attr("cx",n*a.left*1.5).attr("cy",r*(1-1.5*a.bottom)).on("mouseover",function(){d3.select(this).style("stroke","#444"),m._cellHover(m._colorDef)}).on("mouseout",function(){d3.select(this).style("stroke","none")});var m=this;p.selectAll("."+o.COLOR_CIRCLE).data(s).enter().append("g").attr("class",o.COLOR_CIRCLE).each(function(t,e){m._arc.outerRadius(c+(u-c)/l*(l-e)).innerRadius(c+(u-c)/l*(l-e-1)),d3.select(this).selectAll("."+o.COLOR_SEGMENT).data(m._pie(t)).enter().append("g").attr("class",o.COLOR_SEGMENT).append("path").attr("class",o.COLOR_BUTTON).attr("d",m._arc).style("fill",function(t){return t.data.display}).style("stroke",function(t){return t.data.display}).on("mouseover",function(t){m._cellHover(t.data.meaning,this)}).on("mouseout",function(){return m._cellUnhover()})}),p.append("circle").attr("r",c).attr("fill",h).attr("class",o.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke","#555"),m._cellHover(h)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),this._colorPointer=p.append("path").attr("class",o.COLOR_POINTER+" "+o.INVISIBLE),e.selectAll("."+o.COLOR_BUTTON).on("click",function(e){d3.event.stopPropagation(),t._changeColor(e?e.data.meaning:t._colorDef,!0),t.show(!1)})}},{key:"_style",value:function(){var t=this._svg,e=this._colorWhite;t.select("."+o.COLOR_BACKGR).style("fill","white"),t.select("."+o.COLOR_POINTER).style("stroke-width",2).style("stroke",e).style("pointer-events","none").style("fill","none"),t.selectAll("."+o.COLOR_BUTTON).style("cursor","pointer"),t.selectAll("text").style("pointer-events","none").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),t.selectAll("circle."+o.COLOR_BUTTON).style("stroke-width",2),t.selectAll("rect."+o.COLOR_SAMPLE).style("pointer-events","none")}},{key:"_cellHover",value:function(t,e){null!=e&&this._colorPointer.classed(o.INVISIBLE,!1).attr("d",d3.select(e).attr("d")),this._sampleRect.style("fill",t),this._sampleText.text(t);var i=(0,a.isTouchDevice)();this._changeColor(t,i),i&&this.show(!1)}},{key:"_changeColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._callback(t,e)}},{key:"_cellUnhover",value:function(){this._colorPointer.classed(o.INVISIBLE,!0)}},{key:"resize",value:function(t){if(arguments.length){if(void 0!==t){var e=this._margin,i=t,n=getComputedStyle(i.node()),r=n.width,a=n.height,s=this.constructor.px2num(r),l=this.constructor.px2num(a),c=s/2*(1-e.left-e.right),u=i.select("."+o.COLOR_DEFAULT),h=i.select(".vzb-default-label"),d=i.select("."+o.COLOR_CIRCLES),f=c+l*e.top,p=(1+.5*e.top)*l*.5,m=c+s*e.left,g=f>p?p:f;d.attr("transform","translate("+m+", "+g+")"),u.attr("cx",s*e.left*1.5).attr("cy",l*(1-1.5*e.bottom)),h.attr("x",.1*s).attr("y",l*(1-e.bottom))}return this.fitToScreen()}}},{key:"fitToScreen",value:function(t){var e=this._container.node().getBoundingClientRect(),i=void 0,n=void 0,r=getComputedStyle(this._wrapper.node()),a=r.width,o=r.height,s=r.right,l=r.top,c=this.constructor.px2num(a),u=this.constructor.px2num(o);t?(i=t[0]-e.left,n=t[1]-e.top):(i=e.width-this.constructor.px2num(s)-c,n=this.constructor.px2num(l));var h={left:""};return.8*e.width<=c?h.right=.5*(e.width-c)+"px":i+c>e.width?h.right=Math.min(.1*e.width,20)+"px":h.right=e.width-i-c+"px",h.right&&this._wrapper.style("right",h.right),.8*e.height<=u?h.top=.5*(e.height-u)+"px":n+1.2*u>e.height?h.top=.9*e.height-u+"px":h.top=n+"px",h.top&&this._wrapper.style("top",h.top),this._wrapper.style("left",h.left),this}},{key:"show",value:function(t){if(!arguments.length)return this._showColorPicker;null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._showColorPicker="toggle"==t?!this._showColorPicker:t,this._showColorPicker||(this._callback=function(){}),this._wrapper.classed(o.INVISIBLE,!this._showColorPicker)}},{key:"_getOrSet",value:function(t,e){return t="_"+t,arguments.length>1?(this[t]=e,this):this[t]}},{key:"nCellsH",value:function(){return this._getOrSet.apply(this,["nCellsH"].concat(Array.prototype.slice.call(arguments)))}},{key:"minH",value:function(){return this._getOrSet.apply(this,["minH"].concat(Array.prototype.slice.call(arguments)))}},{key:"nCellsL",value:function(){return this._getOrSet.apply(this,["nCellsL"].concat(Array.prototype.slice.call(arguments)))}},{key:"minL",value:function(){return this._getOrSet.apply(this,["minL"].concat(Array.prototype.slice.call(arguments)))}},{key:"outerL_display",value:function(){return this._getOrSet.apply(this,["outerL_display"].concat(Array.prototype.slice.call(arguments)))}},{key:"outerL_meaning",value:function(){return this._getOrSet.apply(this,["outerL_meaning"].concat(Array.prototype.slice.call(arguments)))}},{key:"satConstant",value:function(){return this._getOrSet.apply(this,["satConstant"].concat(Array.prototype.slice.call(arguments)))}},{key:"firstAngleSat",value:function(){return this._getOrSet.apply(this,["firstAngleSat"].concat(Array.prototype.slice.call(arguments)))}},{key:"minRadius",value:function(){return this._getOrSet.apply(this,["minRadius"].concat(Array.prototype.slice.call(arguments)))}},{key:"margin",value:function(){return this._getOrSet.apply(this,["margin"].concat(Array.prototype.slice.call(arguments)))}},{key:"callback",value:function(){return this._getOrSet.apply(this,["callback"].concat(Array.prototype.slice.call(arguments)))}},{key:"colorDef",value:function(t){return arguments.length?(void 0!==t&&(this._colorDef=t),null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._svg.select("."+o.COLOR_DEFAULT).style("fill",this._colorDef),this):this._colorDef}},{key:"translate",value:function(t){return"function"==typeof t&&this._svg.select(".vzb-default-label").text(t("colorpicker/default")),this}},{key:"colorOld",value:function(t){return arguments.length?(this._colorOld=t,null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._svg.select("rect."+o.COLOR_SAMPLE).style("fill",this._colorOld),this._svg.select("text."+o.COLOR_SAMPLE).text(this._colorOld),this):this._colorOld}}],[{key:"hsl2rgb",value:function(t,e,i){var n=void 0,r=void 0,a=void 0;if(0==e)n=r=a=i;else{var o=i<.5?i*(1+e):i+e-i*e,s=2*i-o;n=this.hue2rgb(s,o,t+1/3),r=this.hue2rgb(s,o,t),a=this.hue2rgb(s,o,t-1/3)}return"#"+Math.round(255*n).toString(16)+Math.round(255*r).toString(16)+Math.round(255*a).toString(16)}},{key:"hue2rgb",value:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}},{key:"px2num",value:function(t){return parseFloat(t)||0}}]),t}();e.default=s},function(t,e){t.exports='<div class="vzb-show-list vzb-accordion">\n  \x3c!-- list will be placed here --\x3e\n</div>\n'},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(12)),o=n(a),s=i(110),l=n(s),c=i(147),u=(n(c),i(108)),h=n(u),d=o.default.extend("about",{init:function(t,e){this.name="about",this._super(t,e)},readyOnce:function(){var t=l.default.version,e=new Date(parseInt(l.default.build));this.element=d3.select(this.element),this.element.select(".vzb-about-text0").html("This chart is made with Vizabi,"),this.element.select(".vzb-about-text1").html("a project by <a href='http://gapminder.org' target='_blank'>Gapminder Foundation</a>"),this.element.select(".vzb-about-version").html("<a href='https://github.com/Gapminder/vizabi/releases/tag/v"+t+"' target='_blank'>Version: "+t+"</a>"),this.element.select(".vzb-about-updated").html("Build: "+d3.time.format("%Y-%m-%d at %H:%M")(e)),this.element.select(".vzb-about-report").html("<a href='https://getsatisfaction.com/gapminder/' target='_blank'>Report a problem</a>"),this.element.select(".vzb-about-credits").html("<a href='https://github.com/Gapminder/vizabi/graphs/contributors' target='_blank'>Contributors</a>");var i=h.default,n={},r=this.root.versionInfo;n.version=r?r.version:"N/A",n.build=r?d3.time.format("%Y-%m-%d at %H:%M")(new Date(parseInt(r.build))):"N/A",n.name=this.root.name;var a=this.element.select(".vzb-about-tool");a.html(""),a.append("p").text("Tool: "+n.name),a.append("p").text("-version: "+n.version),a.append("p").text("-build: "+n.build);var o=i.instances.map(function(t){var e={},i=t.readerObject.versionInfo;return e.version=i?i.version:"N/A",e.build=i?d3.time.format("%Y-%m-%d at %H:%M")(new Date(parseInt(i.build))):"N/A",e.name=t.readerObject._name,e}),s=this.element.select(".vzb-about-readers").selectAll(".vzb-about-reader").data(o);s.exit().remove(),s=s.enter().append("p").attr("class","vzb-about-reader"),s.append("p").text(function(t){return t.name}),s.append("p").text(function(t){return"-version: "+t.version}),s.append("p").text(function(t){return"-build: "+t.build});var c=i.instances.map(function(t){return t.getDatasetName()}),u=this.element.select(".vzb-about-datasets").selectAll(".vzb-about-dataset").data(c);u.exit().remove(),u=u.enter().append("p").attr("class","vzb-about-dataset"),u.append("p").text(function(t){return t})}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(50),c=n(l),u=i(169),h=n(u),d=s.default.extend("axes",{init:function(t,e){this.name="axes";this.components=[{component:c.default,placeholder:".vzb-xaxis-selector",model:["state.time","state.marker.axis_x","locale"]},{component:h.default,placeholder:".vzb-xaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}},{component:c.default,placeholder:".vzb-yaxis-selector",model:["state.time","state.marker.axis_y","locale"]},{component:h.default,placeholder:".vzb-yaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_y",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)}});e.default=d},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(6),s=function(t){return t&&t.__esModule?t:{default:t}}(o),l=s.default.extend({init:function(t,e){var r,o=this;this.name="gapminder-minmaxinputs",this.template=i(421),this.model_expects=[{name:"marker",type:"marker"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.markerID=t.markerID,t.markerID||a.warn("minmaxinputs.js complains on 'markerID' property: "+t.markerID),this.model_binds=(r={"translate:locale":function(){o.updateView()}},n(r,"change:marker."+this.markerID,function(){o.updateView()}),n(r,"ready",function(){o.updateView()}),r),this._super(t,e),this.ui=a.extend({selectDomainMinMax:!1,selectZoomedMinMax:!1},this.ui.getPlainObject())},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.el_domain_labelMin=this.element.select(".vzb-mmi-domainmin-label"),this.el_domain_labelMax=this.element.select(".vzb-mmi-domainmax-label"),this.el_domain_fieldMin=this.element.select(".vzb-mmi-domainmin"),this.el_domain_fieldMax=this.element.select(".vzb-mmi-domainmax"),this.el_break=this.element.select(".vzb-mmi-break"),this.el_zoomed_labelMin=this.element.select(".vzb-mmi-zoomedmin-label"),this.el_zoomed_labelMax=this.element.select(".vzb-mmi-zoomedmax-label"),this.el_zoomed_fieldMin=this.element.select(".vzb-mmi-zoomedmin"),this.el_zoomed_fieldMax=this.element.select(".vzb-mmi-zoomedmax"),t.el_domain_fieldMin.on("change",function(){t._setModel("domainMin",this.value)}),t.el_domain_fieldMax.on("change",function(){t._setModel("domainMax",this.value)}),t.el_zoomed_fieldMin.on("change",function(){t._setModel("zoomedMin",this.value)}),t.el_zoomed_fieldMax.on("change",function(){t._setModel("zoomedMax",this.value)}),this.element.selectAll("input").on("keypress",function(){13==d3.event.which&&document.activeElement.blur()})},updateView:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.el_domain_labelMin.text(this.translator("hints/min")+":"),this.el_domain_labelMax.text(this.translator("hints/max")+":"),this.el_zoomed_labelMin.text(this.translator("hints/min")+":"),this.el_zoomed_labelMax.text(this.translator("hints/max")+":"),this.el_domain_labelMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_labelMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_break.classed("vzb-hidden",!(this.ui.selectDomainMinMax&&this.ui.selectZoomedMinMax)),this.el_zoomed_labelMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_labelMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax);var e=function(e){return e||0===e?a.isDate(e)?t.model.time.formatDate(e):d3.format(".2r")(e):e},i=this.model.marker[this.markerID],n=i.getScale().domain();this.el_domain_fieldMin.property("value",e(d3.min(n))),this.el_domain_fieldMax.property("value",e(d3.max(n))),this.el_zoomed_fieldMin.property("value",e(i.getZoomedMin())),this.el_zoomed_fieldMax.property("value",e(i.getZoomedMax()))},_setModel:function(t,e){this.model.marker[this.markerID][t]=a.strToFloat(e)}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(164),c=n(l),u=i(50),h=n(u),d=s.default.extend("colors",{init:function(t,e){this.name="colors",this.components=[{component:h.default,placeholder:".vzb-caxis-selector",model:["state.time","state.marker.color","locale"],showHoverValues:!0},{component:c.default,placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","state.marker.color","locale","ui"]}],this._super(t,e)}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),a=n(r),o=i(1),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o),l=i(6),c=n(l),u=c.default.extend({init:function(t,e){this.name="gapminder-dialogs",this._curr_dialog_index=20,this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}];var i=a.default.getCollection();this._available_dialogs=Object.keys(i).reduce(function(t,e){var n=i[e];return n.prototype.isDialog&&!e.startsWith("_")&&(t[e]={dialog:n}),t},{}),this._super(t,e)},domReady:function(){var t=(this.model.ui.dialogs||{}).popup||[],e=(this.model.ui.dialogs||{}).sidebar||[];this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),!0===e&&(e=t,(this.model.ui.dialogs||{}).sidebar=e),0!==e.length&&this.rootEl.classed("vzb-dialog-expand-true",!0),this.dialog_popup=t,this.dialog_sidebar=e},readyOnce:function(){var t=this;if(this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),s.isTouchDevice()&&this.element.classed("vzb-no-hover",!0),this._addDialogs(this.dialog_popup,this.dialog_sidebar),s.defer(function(){t.trigger("resize")}),0!==this.dialog_popup.length){this.root.findChildByName("gapminder-buttonlist").on("click",function(e,i){t._available_dialogs[i.id]&&(i.active?t.openDialog(i.id):t.closeDialog(i.id))});var e=this.element.selectAll(".vzb-top-dialog").filter(function(e){return t.dialog_popup.indexOf(e.id)>-1});e.select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']").on("click",function(e,i){t.closeDialog(e.id)});e.select(".vzb-top-dialog>.vzb-dialog-modal>[data-click='pinDialog']").on("click",function(e,i){t.pinDialog(e.id)}),this.rootEl.node().addEventListener("click",function(){t.closeAllDialogs()}),this.rootEl.on("mousedown",function(e){if(this._active_comp){for(var i=d3.event.target,n=!0;i;){if(i.classList.contains("vzb-dialog-modal")){n=!1;break}i=i.parentElement}n&&t.closeAllDialogs()}})}this.element.on("click",function(){d3.event.stopPropagation()})},resize:function(){if(!this.element.selectAll)return s.warn("dialogs resize() aborted because element is not yet defined");var t=this,e=this.getLayoutProfile();this.element.selectAll(".vzb-top-dialog").each(function(i){var n=d3.select(this),r=n.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"large"===e&&t.dialog_sidebar.indexOf(i.id)>-1?r+=" vzb-sidebar":t.dialog_popup.indexOf(i.id)>-1&&(r+=" vzb-popup"),n.attr("class",r)})},_addDialogs:function(t,e){var i=(this.getLayoutProfile(),[]);i=t?i.concat(t):i,i=e?i.concat(e):i,i=s.unique(i),this._components_config=[];var n=[];if(i.length){for(var r=0;r<i.length;r++){var a=i[r],o=this._available_dialogs[a];if(o&&o.dialog){var l=this._components_config;l.push({component:o.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+a+'"]',model:["state","ui","locale"]}),o.component=l.length-1}o.id=a,n.push(o)}this.element.selectAll("div").data(n).enter().append("div").attr("data-dlg",function(t){return t.id}).attr("class","vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"),this.loadSubComponents();var c=this;s.forEach(this.components,function(t){t.render(),c.on("resize",function(){t.trigger("resize")}),t.on("dragstart",function(){c.bringForward(t.name)}),t.on("close",function(){this.placeholderEl.each(function(t){var e={};e.id=t.id,c.trigger("close",e)})})})}},bringForward:function(t){this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']").style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10},openDialog:function(t){var e="small"===this.getLayoutProfile();this.closeAllDialogs(e);var i=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp.beforeOpen(),i.classed("vzb-active",!0),this.bringForward(t),this._active_comp.open()},pinDialog:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._available_dialogs[t].ispin?(e.classed("pinned",!1),this._available_dialogs[t].ispin=!1):(e.classed("pinned",!0),this._available_dialogs[t].ispin=!0)},closeDialog:function(t){var e=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp&&!this._active_comp.isOpen||(this._available_dialogs[t].ispin&&this.pinDialog(t),this._active_comp&&this._active_comp.beforeClose(),e.classed("vzb-active",!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)},closeAllDialogs:function(t){var e=this,i=t?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)";this.element.selectAll(i).each(function(t){e.closeDialog(t.id)})}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(12),s=n(o),l=i(112),c=n(l),u=i(59),h=n(u),d=i(50),f=n(d),p=s.default.extend("find",{init:function(t,e){this.name="find";var i=this;this.components=[{component:c.default,placeholder:".vzb-dialog-panel-show",model:["state","locale"]},{component:h.default,placeholder:".vzb-dialog-bubbleopacity",model:["state.marker","locale"],arg:"opacitySelectDim"}],this.panelMode=((t.ui.dialogs.dialog||{}).find||{}).panelMode||"find",this.enablePicker=((t.ui.dialogs.dialog||{}).find||{}).enablePicker,this.enablePicker&&this.components.push({component:f.default,placeholder:".vzb-find-filter-selector",model:["state.time","state.marker","locale"]}),this.model_binds={"change:state.marker.select":function(t){i.items.order(),i.selectDataPoints(),i.showHideButtons()},"change:state.time.playing":function(t){i.model.state.time.playing||(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t,e){!t||i.time-e||i.redrawDataPoints(t)}))},"change:state.time.value":function(t){(i.placeholderEl.classed("vzb-active")||i.placeholderEl.classed("vzb-sidebar"))&&(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t){t&&i.redrawDataPoints(t)}))},"translate:locale":function(){i._readyOnce&&i.input_search.attr("placeholder",i.translator("placeholder/search")+"...")}},this._super(t,e)},readyOnce:function(){this._super(),this.panelComps={find:this,show:this.findChildByName("show")},this.titleSwitch=this.element.select(".vzb-dialog-title-switch input"),this.panelsEl=this.contentEl.selectAll(".vzb-dialog-content"),this.list=this.element.select(".vzb-find-list"),this.input_search=this.element.select(".vzb-find-search"),this.deselect_all=this.element.select(".vzb-find-deselect"),this.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.element.select(".vzb-find-filter-selector").classed("vzb-hidden",!this.enablePicker),this.element.select(".vzb-dialog-title").classed("vzb-title-two-rows",this.enablePicker),this.KEY=this.model.state.entities.getDimension();var t=this;this.titleSwitch.on("change",function(){t.panelMode=t.titleSwitch.property("checked")?"show":"find",t.panelsEl.classed("vzb-active",!1),t.contentEl.select(".vzb-dialog-panel-"+t.panelMode).classed("vzb-active",!0),t.panelComps[t.panelMode].showHideSearch(),t._buttonAdjust(),t.panelComps[t.panelMode].showHideButtons()}),this.titleSwitch.property("checked","find"!==this.panelMode),this.titleSwitch.dispatch("change"),this.input_search.on("keyup",function(){13==d3.event.keyCode&&"select all"==t.input_search.node().value&&(t.input_search.node().value="",a.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectAll())}),this.input_search.on("input",function(){t.panelComps[t.panelMode].showHideSearch()}),d3.select(this.input_search.node().parentNode).on("reset",function(){a.defer(function(){return t.panelComps[t.panelMode].showHideSearch()})}),this.deselect_all.on("click",function(){t.deselectMarkers()}),this.buttonsEl.select(".vzb-dialog-button[data-click='closeDialog']").on("click.panel",function(){return t.panelComps[t.panelMode].closeClick()}),this.translator=this.model.locale.getTFunction(),this.input_search.attr("placeholder",this.translator("placeholder/search")+"..."),this.root.on("ready",function(){t.ready()})},getPanelMode:function(){return this.panelMode},_buttonAdjust:function(){this.buttonsEl.selectAll(".vzb-dialog-buttons > :not([data-dialogtype])").classed("vzb-hidden",!0),this.buttonsEl.selectAll("[data-panel="+this.panelMode+"]").classed("vzb-hidden",!1)},open:function(){var t=this;this._super(),this.input_search.node().value="",this.showHideSearch(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){e&&t.redrawDataPoints(e)})},ready:function(){this._super();var t=this;this.KEYS=a.unique(this.model.state.marker._getAllDimensions({exceptType:"time"}));this.importantHooks=t.model.state.marker.getImportantHooks(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){if(e){var i=t.model.state.marker.getKeys().map(function(i){return i.brokenData=!1,i.name=t.model.state.marker.getCompoundLabelText(i,e),i});i.sort(function(t,e){return t.name<e.name?-1:1}),t.list.html(""),t.items=t.list.selectAll(".vzb-find-item").data(i).enter().append("div").attr("class","vzb-find-item vzb-dialog-checkbox"),t.items.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",function(e,i){return"-find-"+i+"-"+t._id}).on("change",function(e){a.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectMarker(e),a.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}),t.items.append("label").attr("for",function(e,i){return"-find-"+i+"-"+t._id}).text(function(t){return t.name}).attr("title",function(t){return this.offsetWidth<this.scrollWidth?t.name:null}).on("mouseover",function(e){a.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}).on("mouseout",function(e){a.isTouchDevice()||t.model.state.marker.clearHighlighted()}),a.preventAncestorScrolling(t.element.select(".vzb-dialog-scrollable")),t.redrawDataPoints(e),t.selectDataPoints(),t.showHideSearch(),t.showHideButtons()}})},redrawDataPoints:function(t){var e=this,i=this.KEYS;e.items.each(function(n){var r=d3.select(this).select("label");n.brokenData=!1,a.forEach(e.importantHooks,function(r){if("constant"!=e.model.state.marker[r].use){var o=t[r];if(o){var s=o[a.getKey(n,i)];return s||0===s?void 0:(n.brokenData=!0,!1)}}});var o=this.offsetWidth<this.scrollWidth?n.name:"";r.classed("vzb-find-item-brokendata",n.brokenData).attr("title",o+(n.brokenData?(o?" | ":"")+e.model.state.time.formatDate(e.time)+": "+e.translator("hints/nodata"):""))})},selectDataPoints:function(){var t=(this.KEY,this.model.state.marker);this.items.selectAll("input").property("checked",function(e){var i=t.isSelected(e);return d3.select(this.parentNode).classed("vzb-checked",i),i});var e=this.list.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];d3.select(e).classed("vzb-separator",!0),this.contentEl.node().scrollTop=0},showHideSearch:function(){if("find"===this.getPanelMode()){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-find-item").classed("vzb-hidden",function(e){return-1===(e.name||"").toString().toLowerCase().indexOf(t)})}},showHideButtons:function(){if("find"===this.getPanelMode()){var t=!!this.model.state.marker.select.length;this.deselect_all.classed("vzb-hidden",!t),this.opacity_nonselected.classed("vzb-hidden",!t),t&&this.findChildByName("singlehandleslider").trigger("resize")}},deselectMarkers:function(){this.model.state.marker.clearSelected()},transitionEnd:function(t){this._super(t),a.isTouchDevice()||this.input_search.node().focus()},closeClick:function(){}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(59),c=n(l),u=s.default.extend("grouping",{init:function(t,e){this.name="grouping",this.groupStops=[1,5,10,15],this.components=[{component:c.default,placeholder:".vzb-dialog-placeholder",model:["state.entities_age","locale"],arg:"grouping",properties:{snapValue:!0,suppressInput:!0,domain:this.groupStops}}],this._super(t,e)},readyOnce:function(){this._super(),this.element.select(".vzb-dialog-groups").selectAll(".vzb-dialog-groups-title").data(this.groupStops).enter().append("span").attr("class",".vzb-dialog-groups-title").text(function(t){return t})}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(161),c=n(l),u=i(50),h=n(u),d=i(60),f=n(d),p=s.default.extend("label",{init:function(t,e){this.name="label",this.components=[{component:c.default,placeholder:".vzb-dialog-sizeslider",model:["state.marker.size_label","locale"],propertyname:"LabelTextSize",ui:{constantUnit:"unit/pixels"}},{component:h.default,placeholder:".vzb-saxis-selector",model:["state.time","state.marker.size_label","locale"],showHoverValues:!0},{component:f.default,placeholder:".vzb-removelabelbox-switch",model:["ui.chart","locale"],checkbox:"removeLabelBox",submodel:"labels"}],this._super(t,e)}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(6),s=(n(o),i(12)),l=n(s),c=i(163),u=n(c),h=l.default.extend("moreoptions",{init:function(t,e){this.name="moreoptions",this.components=[{component:u.default,placeholder:".vzb-dialog-options-buttonlist",model:["state","ui","locale"]}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.accordionEl=this.contentEl.select(".vzb-accordion"),this.on("dragend",function(){t._setMaxHeight()});var e=(this.model.ui.dialogs||{}).popup||[],i=(this.model.ui.dialogs||{}).moreoptions||[];if(!0===i&&(i=e,(this.model.ui.dialogs||{}).moreoptions=i),this._addDialogs(i),this.accordionEl){this.accordionEl.selectAll(".vzb-accordion-section").select(".vzb-dialog-title>span:first-child").on("click",function(e){var i=(t.components[e.component].element,t.components[e.component].placeholderEl),n=t.accordionEl.select(".vzb-accordion-active");n&&n.classed("vzb-accordion-active",!1),i.node()!==n.node()&&(i.classed("vzb-accordion-active",!0),t.transitionEvents.forEach(function(n){i.on(n,function(){t.transitionEvents.forEach(function(t){i.on(t,null)}),t.components[e.component].trigger("resize")})}))})}},_addDialogs:function(t){this._components_config=[];var e=[];if(t.length){for(var i=0;i<t.length;i++)if("moreoptions"!==t[i]){var n=t[i],r=a.deepClone(this.parent._available_dialogs[n]);if(r&&r.dialog){var o=this._components_config;o.push({component:r.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+n+'"]',model:["state","ui","locale"]}),r.component=o.length-1,r.id=n,e.push(r)}}this.accordionEl.selectAll("div").data(e).enter().append("div").attr("class",function(t){return"vzb-dialogs-dialog vzb-moreoptions vzb-accordion-section"}).attr("data-dlg",function(t){return t.id}),this.loadSubComponents();var s=this;a.forEach(this.components,function(t){t.render(),s.on("resize",function(){t.trigger("resize")})})}}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(59),c=n(l),u=s.default.extend("opacity",{init:function(t,e){this.name="opacity",this.components=[{component:c.default,placeholder:".vzb-dialog-bubbleopacity-regular",model:["state.marker","locale"],arg:"opacityRegular"},{component:c.default,placeholder:".vzb-dialog-bubbleopacity-selectdim",model:["state.marker","locale"],arg:"opacitySelectDim"}],this._super(t,e)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(60),c=n(l),u=s.default.extend("presentation",{init:function(t,e){this.name="presentation",this.components=[{component:c.default,placeholder:".vzb-presentationmode-switch",model:["ui","locale"],checkbox:"presentation"}],this._super(t,e)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s=i(6),l=(n(s),i(12)),c=n(l),u=i(50),h=n(u),d=i(60),f=(n(d),c.default.extend("side",{init:function(t,e){this.name="side";var i=this;this.model_binds={"change:ui.chart.flipSides":function(t){i._readyOnce&&(i.updateState(),i.redraw())}},this.components=[{component:h.default,placeholder:".vzb-side-selector",model:["state.time","state.marker.side","locale"],showHoverValues:!1}],this._super(t,e)},readyOnce:function(){this._super(),this.listLeft=this.element.select(".vzb-side-list-left"),this.listRight=this.element.select(".vzb-side-list-right"),this.switchSides=this.element.select(".vzb-side-switch-sides"),this.TIMEDIM=this.model.state.time.getDimension(),this.state={};var t=this;this.switchSides.on("click",function(){t.model.ui.chart.flipSides=!t.model.ui.chart.flipSides}),this.model.state.marker.side.getEntity().on("change:show",function(){t.updateState(),t.redraw()}),this.root.on("ready",function(){t.redraw()})},ready:function(){this._super();var t=this.model.state.marker.side.getEntity();if(this.KEY=t.getDimension(),this.labelNames=this.model.state.marker.getLabelHookNames(),"constant"!==this.model.state.marker.side.use&&!(t.show[this.KEY]||{}).$in){var e=this.model.state.marker.side.getUnique(this.model.state.marker.side.which).filter(function(t){return null!==t}),i=e.sort(d3.ascending).slice(0,2);if(i.length>0){var n=Object.assign({},t.show);n[this.KEY]={$in:i},t.set("show",n)}}this.updateState(),this.redraw(),o.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},updateState:function(){var t=this,e=this.model.state.marker.side.getEntity().getDimension(),i=this.model.state.marker.side;if(this.state.right={},this.state.left={},i.state.left[e]&&i.state.right[e])this.state.left[e]=i.state.left[e],this.state.right[e]=i.state.right[e];else{var n=this.model.state.marker.getKeys(e),r=[],a=!!this.model.state.marker.side.getEntity().show[e];if(r=n.filter(function(e){return!a||t.model.state.marker.side.getEntity().isShown(e)}).map(function(t){return t[e]}),r.length>2&&(r.length=2),r.length>1){var o=this.ui.chart.flipSides?d3.ascending:d3.descending;r.sort(o)}this.state.right={},this.state.right[e]=r[0],this.state.left={},this.state.left[e]=r[1]?r[1]:r[0]}var s="constant"==this.model.state.marker.side.use;this.listLeft.classed("vzb-hidden",s),this.listRight.classed("vzb-hidden",s),this.switchSides.classed("vzb-hidden",s||this.state.left[e]==this.state.right[e])},redraw:function(){var t=this,e=this.labelNames,i=this.KEY;this.translator=this.model.locale.getTFunction(),t.model.state.marker.side.getEntity().dim&&this.model.state.marker.getFrame(this.model.state.time.value,function(n){if(n){var a=[],s=t.model.state.marker.side.getConceptprops();"entity_set"==s.concept_type?a.push.apply(a,r(t.model.state.marker.side.getEntity().getEntitySets("data")[s.concept][0].map(function(t){var e={};return e[i]=t[s.concept],e.label=t.name,e}))):o.forEach(n[e[i]],function(t,e){var n={};n[i]=e,n.label=t,a.push(n)}),a.sort(function(t,e){return t.label<e.label?-1:1}),t.listLeft.html(""),t.listRight.html(""),t.createList(t.listLeft,"left",a),t.createList(t.listRight,"right",a)}})},createList:function(t,e,i){var n=this,r=this.model.state.marker.side.getEntity().getDimension(),a=t.selectAll(".vzb-side-item").data(i).enter().append("div").attr("class","vzb-side-item vzb-dialog-radio");a.append("input").attr("type","radio").attr("name",e+"-"+n._id).attr("class","vzb-side-item").attr("id",function(t){return"-side-"+e+"-"+t[r]+"-"+n._id}).property("checked",function(t){return n.state[e][r]===t[r]}).on("change",function(t,i){var r=n.model.state.marker.side.getEntity(),a=r.getDimension(),o="left"==e?"right":"left",s=n.model.state.marker.side;s.state[e][a]=t[a],s.state[o][a]=n.state[o][a];var l=[];if(r.isShown(t)||l.push(t),t[a]===n.state[o][a]||r.isShown(n.state[o])||l.push(n.state[o]),n.state[e][a]!==n.state[o][a]&&r.isShown(n.state[e])&&l.push(n.state[e]),t[a]!==n.state[o][a]){var c=[t[a],n.state[o][a]],u=n.ui.chart.flipSides?d3.ascending:d3.descending;c.sort(u),c["left"==e?0:1]==t[a]&&(n.model.state.marker.side.switchSideState(),n.ui.chart.flipSides=!n.ui.chart.flipSides)}l.length&&r.showEntity(l)}),a.append("label").attr("for",function(t){return"-side-"+e+"-"+t[n.KEY]+"-"+n._id}).text(function(t){return t.label})}}));e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(6),s=(n(o),i(12)),l=n(s),c=i(160),u=n(c),h=i(50),d=n(h),f=l.default.extend("size",{init:function(t,e){this.name="size";var i=this;this.model_binds={"change:state.marker.size.which":function(t){i._readyOnce&&i.updateSubtitle()},"translate:locale":function(){i._readyOnce&&i.updateSubtitle()}},this.components=[{component:d.default,placeholder:".vzb-saxis-selector",model:["state.time","state.marker.size","locale"],showHoverValues:!0}],t.ui.chart&&0===t.ui.chart.sizeSelectorActive||this.components.push({component:u.default,placeholder:".vzb-dialog-bubblesize",model:["state.marker.size","locale"],ui:{show_button:!1}}),this._super(t,e)},readyOnce:function(){this._super(),this.updateSubtitle()},updateSubtitle:function(){var t=this.model.state.marker.size.getConceptprops(),e=a.getSubtitle(t.name,t.name_short);this.element.select(".vzb-dialog-subtitle").text(e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(59),c=n(l),u=s.default.extend("speed",{init:function(t,e){this.name="speed",this.components=[{component:c.default,placeholder:".vzb-dialog-placeholder",model:["state.time","locale"],arg:"delay",properties:{domain:[1200,900,450,200,150,100],roundDigits:0}}],this._super(t,e)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(182),c=n(l),u=s.default.extend("stack",{init:function(t,e){this.name="stack";var i=this;this.components=[{component:c.default,placeholder:".vzb-dialog-draggablelist",model:["state.marker.group","state.marker.color","locale","ui.chart"],groupID:"manualSorting",isEnabled:"manualSortingEnabled",dataArrFn:i.manualSorting.bind(i),lang:""}],this.model_binds={"change:state.marker.group":function(t){i._ready&&i.updateView()}},this._super(t,e)},readyOnce:function(){this._super();var t=this;this.group=this.model.state.marker.group,this.stack=this.model.state.marker.stack,this.howToStackEl=this.element.select(".vzb-howtostack").selectAll("input").on("change",function(){t.setModel("stack",d3.select(this).node().value)}),this.howToMergeEl=this.element.select(".vzb-howtomerge").selectAll("input").on("change",function(){t.setModel("merge",d3.select(this).node().value)}),this.updateView()},ready:function(){if(this._super(),!this.model.state.marker.color.isDiscrete()){if("property"==this.stack.use)return void this.setModel("stack","none");if(this.group.merge)return void this.setModel("merge","none")}this.updateView()},updateView:function(){var t=this;this.howToStackEl.property("checked",function(){return"none"===d3.select(this).node().value?"none"===t.stack.which:"bycolor"===d3.select(this).node().value?t.stack.which===t.model.state.marker.color.which:"all"===d3.select(this).node().value?"all"===t.stack.which:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"all"===d3.select(this).node().value?null:"bycolor"===d3.select(this).node().value?"property"!==t.model.state.marker.color.use||null:void 0}),t.model.ui.chart.manualSortingEnabled="all"==t.stack.which,this.howToMergeEl.property("checked",function(){return"none"===d3.select(this).node().value?!t.group.merge&&!t.stack.merge:"grouped"===d3.select(this).node().value?t.group.merge:"stacked"===d3.select(this).node().value?t.stack.merge:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"grouped"===d3.select(this).node().value?"none"===t.stack.which||"property"!==t.model.state.marker.color.use||null:"stacked"===d3.select(this).node().value?"all"!==t.stack.which||null:void 0})},manualSorting:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===arguments.length)return this.model.state.marker.group.manualSorting;this.model.state.marker.group.set({manualSorting:t},!1,e)},setModel:function(t,e){var i={stack:{},group:{}};if("merge"===t)switch(e){case"none":i.group.merge=!1,i.stack.merge=!1;break;case"grouped":i.group.merge=!0,i.stack.merge=!1;break;case"stacked":i.group.merge=!1,i.stack.merge=!0}if("stack"===t){switch(e){case"all":i.stack.use="constant",i.stack.which="all";break;case"none":i.stack.use="constant",i.stack.which="none";break;case"bycolor":i.stack.use="property",i.stack.which=this.model.state.marker.color.which,i.stack.spaceRef=this.model.state.marker.color.spaceRef}"none"===e&&this.group.merge&&(i.group.merge=!1),"all"!==e&&this.stack.merge&&(i.stack.merge=!1)}this.model.state.marker.set(i)}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(6),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=o.default.extend({init:function(t,e){this.template='<span class="vzb-dl-holder"><ul class="vzb-draggable list vzb-dialog-scrollable"></ul></span>';var i=this;this.name="draggableList",this.dataArrFn=t.dataArrFn,this.lang=t.lang,this.model_expects=[{name:"group",type:"model"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"chart",type:"model"}],this.groupID=t.groupID,this.isEnabled=t.isEnabled,this.draggable=!0,t.groupID||r.warn("draggablelist.js complains on 'groupID' property: "+t.groupID),this.model_binds={"translate:locale":function(t){i.updateView()},"change:group.which":function(t){i.updateView()}},this.model_binds["change:group."+this.groupID]=function(t){i.updateView()},this.model_binds["change:chart."+this.isEnabled]=function(t){i.draggable=i.model.chart[i.isEnabled],i.updateView()},this._super(t,e),this.updateData=r.debounce(this.updateData,1e3),this.itemDragger=d3.drag().on("start",function(t,e){!i.dataUpdateFlag&&i.draggable&&(d3.event.sourceEvent.stopPropagation(),i.parentBoundRect=i.element.node().getBoundingClientRect(),i.element.selectAll("div").each(function(e,n){var r=this.getBoundingClientRect();e._y=r.top,e._top=0,t.data===e.data&&(e._height=r.height,i.selectedNode=this)}),d3.select(i.selectedNode).classed("dragged",!0))}).on("drag",function(t,e){if(!i.dataUpdateFlag&&i.draggable){t._top+=d3.event.dy;var n=t._y+t._top;n>i.parentBoundRect.top&&n+t._height<i.parentBoundRect.top+i.parentBoundRect.height&&i.itemsEl.style("top",function(i,r){var a=0;return r<e&&i._y+.5*t._height>n?a=t._height:r>e&&i._y-.5*t._height<n&&(a=-t._height),r!=e&&(i._top=a),i._top+"px"})}}).on("end",function(t,e){!i.dataUpdateFlag&&i.draggable&&i.getData()})},ready:function(){var t=this;this.updateView(),this.itemsEl=this.element.selectAll("div"),this.itemsEl.call(t.itemDragger);this.itemsEl.select("li").on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1)}).on("touchstart",function(){d3.event.preventDefault()})},updateView:function(){var t=this,e=t.model.color.getColorlegendMarker().label.getItems(),i=r.keys(e),n=i.slice().sort(),a=(this.dataArrFn()||[]).slice().sort();!1===r.arrayEquals(n,a)&&this.dataArrFn(i),this.items=this.element.selectAll("div").data(function(){return(t.dataArrFn()||[]).map(function(t){return{data:t}})}),this.items.exit().remove(),this.items=this.items.enter().append("div").each(function(){var t=d3.select(this).append("li");t.append("span").classed("label-circle",!0),t.append("span").classed("label-text",!0)}).merge(this.items);var o=this.model.color.getScale();this.items.select("li").each(function(t){var i=t.data,n=d3.select(this);n.classed("hover",!1).attr("data",i),n.select(".label-circle").style("background",o(i)),n.select(".label-text").text(e[i])});var s=!!t.draggable||null;this.element.selectAll("div").style("top","").attr("draggable",s).classed("dragged",!1),this.dataUpdateFlag=!1},getData:function(){var t=[];t=this.element.selectAll("div").data().sort(function(t,e){return t._y+t._top-(e._y+e._top)}).map(function(t){return t.data}),r.arrayEquals(this.dataArrFn(),t)?this.updateView():(this.dataUpdateFlag=!0,this.updateData(t,!0))},updateData:function(t,e){this.dataArrFn(t,e)},readyOnce:function(){this.element=d3.select(this.element).select(".list")}});e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),a=n(r),o=i(184),s=n(o),l=a.default.extend("timedisplay",{init:function(t,e){var i=this;this.name="timedisplay",this.model_binds={"change:state.time.value":function(){i.updateTime()}},this._super(t,e)},ready:function(){this.updateTime()},readyOnce:function(){this._super(),this.timeLabel=new s.default(this.element.select(".vzb-timedisplay")),this.timeLabel.setConditions({widthRatio:1,heightRatio:1}),this.resize()},resize:function(){this.timeLabel&&this.timeLabel.resize(this.contentEl.style("width"),this.contentEl.style("height"))},updateTime:function(){var t=this.model.state.time;this.time_1=null==this.time?t.value:this.time,this.time=t.value;var e=t.playing&&this.time-this.time_1>0?t.delayAnimations:0;this.timeLabel.setText(t.formatDate(this.time,"ui"),e)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(31),r=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=r.default.extend({init:function(t,e){this.context=t,this.context.classed("vzb-dynamic-background",!0),this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.textWidth=0,this.textHeight=0,this.widthRatio=.9,this.heightRatio=.9,this.xAlign="center",this.yAlign="center",this.element=this.context.append("text").style("font-size","20px"),this._sample=this.context.append("text").style("font-size","20px").style("opacity",0),e&&this.setConditions(e)},setConditions:function(t){return!isNaN(parseFloat(t.rightOffset))&&isFinite(t.rightOffset)&&(this.rightOffset=t.rightOffset),!isNaN(parseFloat(t.leftOffset))&&isFinite(t.leftOffset)&&(this.leftOffset=t.leftOffset),!isNaN(parseFloat(t.topOffset))&&isFinite(t.topOffset)&&(this.topOffset=t.topOffset),!isNaN(parseFloat(t.bottomOffset))&&isFinite(t.bottomOffset)&&(this.bottomOffset=t.bottomOffset),t.xAlign&&(this.xAlign=t.xAlign),t.yAlign&&(this.yAlign=t.yAlign),!isNaN(parseFloat(t.widthRatio))&&t.widthRatio>0&&t.widthRatio<=1&&(this.widthRatio=t.widthRatio),!isNaN(parseFloat(t.heightRatio))&&t.heightRatio>0&&t.heightRatio<=1&&(this.heightRatio=t.heightRatio),this},resize:function(t,e,i,n){this.width=parseInt(t,10)||0,this.height=parseInt(e,10)||0,i&&(this.topOffset=i),n&&(this.leftOffset=n),this._resizeText()},setText:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=function(){e._sample.text(t),e._resizeText(),e.element.text(t)},r=function(){clearTimeout(e._text.timeout),delete e._text};return i?(this._text&&(this._text.callback(),r()),this._text={callback:n,timeout:setTimeout(function(){n(),r()},i)}):(this._text&&r(),n()),this},_resizeText:function(){var t=this._sample.node().getBBox();if(!(t.width&&t.height&&this.width&&this.height))return this;var e=this.width*this.widthRatio/t.width,i=this.height*this.heightRatio/t.height;switch(this.scalar=Math.min(e,i),this.element.attr("transform","scale("+this.scalar+")"),this.textHeight=t.height*this.scalar,this.textWidth=t.width*this.scalar,this.yAlign){case"bottom":case"center":this.context.select("text").attr("dy",".325em");break;case"top":this.context.select("text").attr("dy","0")}return this.context.attr("transform","translate("+this._getLeftOffset()+","+this._getTopOffset()+")"),this},_getLeftOffset:function(){switch(this.xAlign){case"right":return this.width-this.textWidth/2-this.rightOffset;case"left":return this.textWidth/2+this.leftOffset;default:return this.width/2}},_getTopOffset:function(){switch(this.yAlign){case"top":return this.textHeight/2+this.topOffset;case"bottom":return this.height-this.textHeight/2-this.bottomOffset;default:return this.height/2}}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(r),i(6)),o=(n(a),i(12)),s=n(o),l=i(186),c=n(l),u=i(60),h=n(u),d=s.default.extend("zoom",{init:function(t,e){this.name="zoom",this.components=[{component:c.default,placeholder:".vzb-dialog-zoom-buttonlist",model:["state","ui","locale"]},{component:h.default,placeholder:".vzb-panwitharrow-switch",model:["ui","locale"],checkbox:"panWithArrow"},{component:h.default,placeholder:".vzb-zoomonscrolling-switch",model:["ui","locale"],checkbox:"zoomOnScrolling"},{component:h.default,placeholder:".vzb-adaptminmaxzoom-switch",model:["ui","locale"],checkbox:"adaptMinMaxZoom"}],this._super(t,e)}});e.default=d},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=n(r),o=i(6),s=function(t){return t&&t.__esModule?t:{default:t}}(o),l=i(21),c=n(l),u=s.default.extend({init:function(t,e){var i=this;this.name="gapminder-zoombuttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hand:{title:"buttons/cursorhand",icon:"cursorHand",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}},this.model_binds={},Object.keys(this._available_buttons).forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e)},readyOnce:function(){this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addButtons(Object.keys(this._available_buttons),[]),this.setCursorMode("arrow")},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var r=0;r<t.length;r++){var o=t[r],s=this._available_buttons[o],l=s?o:"_default",u=a.clone(this._available_buttons[l]);u.id=o,u.icon=c[u.icon],n.push(u)}var h=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+h(t.title)+"</span>"});this.element.selectAll(".vzb-buttonlist-btn").on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=i.attr("class"),r=e._available_buttons[t];if(r&&r.func)r.func(t);else{var a=-1===n.indexOf("vzb-active");i.classed("vzb-active",a);var o={};o.id=t,o.active=a,e.trigger("click",o)}},setButtonActive:function(t,e){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").classed("vzb-active",e)},toggleCursorMode:function(t){var e=t;this.model.ui.set("cursorMode",e,!1,!1)},setCursorMode:function(t){var e=this.model.ui.cursorMode?this.model.ui.cursorMode:"arrow";this.element.selectAll(".vzb-buttonlist-btn").classed("vzb-active",function(t){return t.id==e})},toggleHundredPercent:function(t){this.root.trigger("resetZoom")}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(188);var n=i(390),r=function(t){return t&&t.__esModule?t:{default:t}}(n);i(436),e.default=r.default,t.exports=r.default},function(t,e,i){"use strict";(function(t){function e(t,e,i){t[e]||Object[n](t,e,{writable:!0,configurable:!0,value:i})}if(i(189),i(386),i(387),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var n="defineProperty";e(String.prototype,"padLeft","".padStart),e(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&e(Array,t,Function.call.bind([][t]))})}).call(e,i(78))},function(t,e,i){i(190),i(192),i(193),i(194),i(195),i(196),i(197),i(198),i(199),i(200),i(201),i(202),i(203),i(204),i(205),i(206),i(208),i(209),i(210),i(211),i(212),i(213),i(214),i(215),i(216),i(217),i(218),i(219),i(220),i(221),i(222),i(223),i(224),i(225),i(226),i(227),i(228),i(229),i(230),i(231),i(232),i(233),i(234),i(235),i(236),i(237),i(238),i(239),i(240),i(241),i(242),i(243),i(244),i(245),i(246),i(247),i(248),i(249),i(250),i(251),i(252),i(253),i(254),i(255),i(256),i(257),i(258),i(259),i(260),i(261),i(262),i(263),i(264),i(265),i(266),i(267),i(268),i(270),i(271),i(273),i(274),i(275),i(276),i(277),i(278),i(279),i(281),i(282),i(283),i(284),i(285),i(286),i(287),i(288),i(289),i(290),i(291),i(292),i(293),i(100),i(294),i(295),i(131),i(296),i(297),i(298),i(299),i(300),i(134),i(136),i(137),i(301),i(302),i(303),i(304),i(305),i(306),i(307),i(308),i(309),i(310),i(311),i(312),i(313),i(314),i(315),i(316),i(317),i(318),i(319),i(320),i(321),i(322),i(323),i(324),i(325),i(326),i(327),i(328),i(329),i(330),i(331),i(332),i(333),i(334),i(335),i(336),i(337),i(338),i(339),i(340),i(341),i(342),i(343),i(344),i(345),i(346),i(347),i(348),i(349),i(350),i(351),i(352),i(353),i(354),i(355),i(356),i(357),i(358),i(359),i(360),i(361),i(362),i(363),i(364),i(365),i(366),i(367),i(368),i(369),i(370),i(371),i(372),i(373),i(374),i(375),i(376),i(377),i(378),i(379),i(380),i(381),i(382),i(383),i(384),i(385),t.exports=i(25)},function(t,e,i){"use strict";var n=i(3),r=i(14),a=i(8),o=i(0),s=i(16),l=i(35).KEY,c=i(4),u=i(61),h=i(51),d=i(38),f=i(7),p=i(114),m=i(80),g=i(191),v=i(64),b=i(2),y=i(5),_=i(18),x=i(26),w=i(37),S=i(42),M=i(117),k=i(19),E=i(9),z=i(40),O=k.f,T=E.f,C=M.f,P=n.Symbol,D=n.JSON,A=D&&D.stringify,I=f("_hidden"),L=f("toPrimitive"),j={}.propertyIsEnumerable,R=u("symbol-registry"),F=u("symbols"),N=u("op-symbols"),B=Object.prototype,H="function"==typeof P,q=n.QObject,K=!q||!q.prototype||!q.prototype.findChild,V=a&&c(function(){return 7!=S(T({},"a",{get:function(){return T(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=O(B,e);n&&delete B[e],T(t,e,i),n&&t!==B&&T(B,e,n)}:T,Y=function(t){var e=F[t]=S(P.prototype);return e._k=t,e},W=H&&"symbol"==typeof P.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof P},X=function(t,e,i){return t===B&&X(N,e,i),b(t),e=x(e,!0),b(i),r(F,e)?(i.enumerable?(r(t,I)&&t[I][e]&&(t[I][e]=!1),i=S(i,{enumerable:w(0,!1)})):(r(t,I)||T(t,I,w(1,{})),t[I][e]=!0),V(t,e,i)):T(t,e,i)},U=function(t,e){b(t);for(var i,n=g(e=_(e)),r=0,a=n.length;a>r;)X(t,i=n[r++],e[i]);return t},G=function(t,e){return void 0===e?S(t):U(S(t),e)},Q=function(t){var e=j.call(this,t=x(t,!0));return!(this===B&&r(F,t)&&!r(N,t))&&(!(e||!r(this,t)||!r(F,t)||r(this,I)&&this[I][t])||e)},$=function(t,e){if(t=_(t),e=x(e,!0),t!==B||!r(F,e)||r(N,e)){var i=O(t,e);return!i||!r(F,e)||r(t,I)&&t[I][e]||(i.enumerable=!0),i}},Z=function(t){for(var e,i=C(_(t)),n=[],a=0;i.length>a;)r(F,e=i[a++])||e==I||e==l||n.push(e);return n},J=function(t){for(var e,i=t===B,n=C(i?N:_(t)),a=[],o=0;n.length>o;)!r(F,e=n[o++])||i&&!r(B,e)||a.push(F[e]);return a};H||(P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),e=function(i){this===B&&e.call(N,i),r(this,I)&&r(this[I],t)&&(this[I][t]=!1),V(this,t,w(1,i))};return a&&K&&V(B,t,{configurable:!0,set:e}),Y(t)},s(P.prototype,"toString",function(){return this._k}),k.f=$,E.f=X,i(43).f=M.f=Z,i(57).f=Q,i(63).f=J,a&&!i(39)&&s(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return Y(f(t))}),o(o.G+o.W+o.F*!H,{Symbol:P});for(var tt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;tt.length>et;)f(tt[et++]);for(var it=z(f.store),nt=0;it.length>nt;)m(it[nt++]);o(o.S+o.F*!H,"Symbol",{for:function(t){return r(R,t+="")?R[t]:R[t]=P(t)},keyFor:function(t){if(!W(t))throw TypeError(t+" is not a symbol!");for(var e in R)if(R[e]===t)return e},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!H,"Object",{create:G,defineProperty:X,defineProperties:U,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:J}),D&&o(o.S+o.F*(!H||c(function(){var t=P();return"[null]"!=A([t])||"{}"!=A({a:t})||"{}"!=A(Object(t))})),"JSON",{stringify:function(t){for(var e,i,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);if(i=e=n[1],(y(e)||void 0!==t)&&!W(t))return v(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!W(e))return e}),n[1]=e,A.apply(D,n)}}),P.prototype[L]||i(15)(P.prototype,L,P.prototype.valueOf),h(P,"Symbol"),h(Math,"Math",!0),h(n.JSON,"JSON",!0)},function(t,e,i){var n=i(40),r=i(63),a=i(57);t.exports=function(t){var e=n(t),i=r.f;if(i)for(var o,s=i(t),l=a.f,c=0;s.length>c;)l.call(t,o=s[c++])&&e.push(o);return e}},function(t,e,i){var n=i(0);n(n.S,"Object",{create:i(42)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperty:i(9).f})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperties:i(116)})},function(t,e,i){var n=i(18),r=i(19).f;i(29)("getOwnPropertyDescriptor",function(){return function(t,e){return r(n(t),e)}})},function(t,e,i){var n=i(11),r=i(20);i(29)("getPrototypeOf",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(11),r=i(40);i(29)("keys",function(){return function(t){return r(n(t))}})},function(t,e,i){i(29)("getOwnPropertyNames",function(){return i(117).f})},function(t,e,i){var n=i(5),r=i(35).onFreeze;i(29)("freeze",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(5),r=i(35).onFreeze;i(29)("seal",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(5),r=i(35).onFreeze;i(29)("preventExtensions",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(5);i(29)("isFrozen",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(5);i(29)("isSealed",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(5);i(29)("isExtensible",function(t){return function(e){return!!n(e)&&(!t||t(e))}})},function(t,e,i){var n=i(0);n(n.S+n.F,"Object",{assign:i(118)})},function(t,e,i){var n=i(0);n(n.S,"Object",{is:i(207)})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,i){var n=i(0);n(n.S,"Object",{setPrototypeOf:i(84).set})},function(t,e,i){"use strict";var n=i(58),r={};r[i(7)("toStringTag")]="z",r+""!="[object z]"&&i(16)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(t,e,i){var n=i(0);n(n.P,"Function",{bind:i(119)})},function(t,e,i){var n=i(9).f,r=Function.prototype,a=/^\s*function ([^ (]*)/;"name"in r||i(8)&&n(r,"name",{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(t){return""}}})},function(t,e,i){"use strict";var n=i(5),r=i(20),a=i(7)("hasInstance"),o=Function.prototype;a in o||i(9).f(o,a,{value:function(t){if("function"!=typeof this||!n(t))return!1;if(!n(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,i){var n=i(0),r=i(121);n(n.G+n.F*(parseInt!=r),{parseInt:r})},function(t,e,i){var n=i(0),r=i(122);n(n.G+n.F*(parseFloat!=r),{parseFloat:r})},function(t,e,i){"use strict";var n=i(3),r=i(14),a=i(23),o=i(86),s=i(26),l=i(4),c=i(43).f,u=i(19).f,h=i(9).f,d=i(52).trim,f=n.Number,p=f,m=f.prototype,g="Number"==a(i(42)(m)),v="trim"in String.prototype,b=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){e=v?e.trim():d(e,3);var i,n,r,a=e.charCodeAt(0);if(43===a||45===a){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===a){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var o,l=e.slice(2),c=0,u=l.length;c<u;c++)if((o=l.charCodeAt(c))<48||o>r)return NaN;return parseInt(l,n)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof f&&(g?l(function(){m.valueOf.call(i)}):"Number"!=a(i))?o(new p(b(e)),i,f):b(e)};for(var y,_=i(8)?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;_.length>x;x++)r(p,y=_[x])&&!r(f,y)&&h(f,y,u(p,y));f.prototype=m,m.constructor=f,i(16)(n,"Number",f)}},function(t,e,i){"use strict";var n=i(0),r=i(28),a=i(123),o=i(87),s=1..toFixed,l=Math.floor,c=[0,0,0,0,0,0],u="Number.toFixed: incorrect invocation!",h=function(t,e){for(var i=-1,n=e;++i<6;)n+=t*c[i],c[i]=n%1e7,n=l(n/1e7)},d=function(t){for(var e=6,i=0;--e>=0;)i+=c[e],c[e]=l(i/t),i=i%t*1e7},f=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==c[t]){var i=String(c[t]);e=""===e?i:e+o.call("0",7-i.length)+i}return e},p=function(t,e,i){return 0===e?i:e%2==1?p(t,e-1,i*t):p(t*t,e/2,i)},m=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e};n(n.P+n.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(4)(function(){s.call({})})),"Number",{toFixed:function(t){var e,i,n,s,l=a(this,u),c=r(t),g="",v="0";if(c<0||c>20)throw RangeError(u);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(g="-",l=-l),l>1e-21)if(e=m(l*p(2,69,1))-69,i=e<0?l*p(2,-e,1):l/p(2,e,1),i*=4503599627370496,(e=52-e)>0){for(h(0,i),n=c;n>=7;)h(1e7,0),n-=7;for(h(p(10,n,1),0),n=e-1;n>=23;)d(1<<23),n-=23;d(1<<n),h(1,1),d(2),v=f()}else h(0,i),h(1<<-e,0),v=f()+o.call("0",c);return c>0?(s=v.length,v=g+(s<=c?"0."+o.call("0",c-s)+v:v.slice(0,s-c)+"."+v.slice(s-c))):v=g+v,v}})},function(t,e,i){"use strict";var n=i(0),r=i(4),a=i(123),o=1..toPrecision;n(n.P+n.F*(r(function(){return"1"!==o.call(1,void 0)})||!r(function(){o.call({})})),"Number",{toPrecision:function(t){var e=a(this,"Number#toPrecision: incorrect invocation!");return void 0===t?o.call(e):o.call(e,t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,i){var n=i(0),r=i(3).isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{isInteger:i(124)})},function(t,e,i){var n=i(0);n(n.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,i){var n=i(0),r=i(124),a=Math.abs;n(n.S,"Number",{isSafeInteger:function(t){return r(t)&&a(t)<=9007199254740991}})},function(t,e,i){var n=i(0);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,i){var n=i(0);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,i){var n=i(0),r=i(122);n(n.S+n.F*(Number.parseFloat!=r),"Number",{parseFloat:r})},function(t,e,i){var n=i(0),r=i(121);n(n.S+n.F*(Number.parseInt!=r),"Number",{parseInt:r})},function(t,e,i){var n=i(0),r=i(125),a=Math.sqrt,o=Math.acosh;n(n.S+n.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:r(t-1+a(t-1)*a(t+1))}})},function(t,e,i){function n(t){return isFinite(t=+t)&&0!=t?t<0?-n(-t):Math.log(t+Math.sqrt(t*t+1)):t}var r=i(0),a=Math.asinh;r(r.S+r.F*!(a&&1/a(0)>0),"Math",{asinh:n})},function(t,e,i){var n=i(0),r=Math.atanh;n(n.S+n.F*!(r&&1/r(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,i){var n=i(0),r=i(88);n(n.S,"Math",{cbrt:function(t){return r(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,i){var n=i(0),r=Math.exp;n(n.S,"Math",{cosh:function(t){return(r(t=+t)+r(-t))/2}})},function(t,e,i){var n=i(0),r=i(89);n(n.S+n.F*(r!=Math.expm1),"Math",{expm1:r})},function(t,e,i){var n=i(0);n(n.S,"Math",{fround:i(126)})},function(t,e,i){var n=i(0),r=Math.abs;n(n.S,"Math",{hypot:function(t,e){for(var i,n,a=0,o=0,s=arguments.length,l=0;o<s;)i=r(arguments[o++]),l<i?(n=l/i,a=a*n*n+1,l=i):i>0?(n=i/l,a+=n*n):a+=i;return l===1/0?1/0:l*Math.sqrt(a)}})},function(t,e,i){var n=i(0),r=Math.imul;n(n.S+n.F*i(4)(function(){return-5!=r(4294967295,5)||2!=r.length}),"Math",{imul:function(t,e){var i=+t,n=+e,r=65535&i,a=65535&n;return 0|r*a+((65535&i>>>16)*a+r*(65535&n>>>16)<<16>>>0)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log1p:i(125)})},function(t,e,i){var n=i(0);n(n.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,i){var n=i(0);n(n.S,"Math",{sign:i(88)})},function(t,e,i){var n=i(0),r=i(89),a=Math.exp;n(n.S+n.F*i(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(r(t)-r(-t))/2:(a(t-1)-a(-t-1))*(Math.E/2)}})},function(t,e,i){var n=i(0),r=i(89),a=Math.exp;n(n.S,"Math",{tanh:function(t){var e=r(t=+t),i=r(-t);return e==1/0?1:i==1/0?-1:(e-i)/(a(t)+a(-t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,e,i){var n=i(0),r=i(41),a=String.fromCharCode,o=String.fromCodePoint;n(n.S+n.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(t){for(var e,i=[],n=arguments.length,o=0;n>o;){if(e=+arguments[o++],r(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?a(e):a(55296+((e-=65536)>>10),e%1024+56320))}return i.join("")}})},function(t,e,i){var n=i(0),r=i(18),a=i(10);n(n.S,"String",{raw:function(t){for(var e=r(t.raw),i=a(e.length),n=arguments.length,o=[],s=0;i>s;)o.push(String(e[s++])),s<n&&o.push(String(arguments[s]));return o.join("")}})},function(t,e,i){"use strict";i(52)("trim",function(t){return function(){return t(this,3)}})},function(t,e,i){"use strict";var n=i(90)(!0);i(91)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){"use strict";var n=i(0),r=i(90)(!1);n(n.P,"String",{codePointAt:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(10),a=i(93),o="".endsWith;n(n.P+n.F*i(94)("endsWith"),"String",{endsWith:function(t){var e=a(this,t,"endsWith"),i=arguments.length>1?arguments[1]:void 0,n=r(e.length),s=void 0===i?n:Math.min(r(i),n),l=String(t);return o?o.call(e,l,s):e.slice(s-l.length,s)===l}})},function(t,e,i){"use strict";var n=i(0),r=i(93);n(n.P+n.F*i(94)("includes"),"String",{includes:function(t){return!!~r(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){var n=i(0);n(n.P,"String",{repeat:i(87)})},function(t,e,i){"use strict";var n=i(0),r=i(10),a=i(93),o="".startsWith;n(n.P+n.F*i(94)("startsWith"),"String",{startsWith:function(t){var e=a(this,t,"startsWith"),i=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),n=String(t);return o?o.call(e,n,i):e.slice(i,i+n.length)===n}})},function(t,e,i){"use strict";i(17)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},function(t,e,i){"use strict";i(17)("big",function(t){return function(){return t(this,"big","","")}})},function(t,e,i){"use strict";i(17)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,e,i){"use strict";i(17)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,e,i){"use strict";i(17)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,e,i){"use strict";i(17)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},function(t,e,i){"use strict";i(17)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},function(t,e,i){"use strict";i(17)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,e,i){"use strict";i(17)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(t,e,i){"use strict";i(17)("small",function(t){return function(){return t(this,"small","","")}})},function(t,e,i){"use strict";i(17)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,e,i){"use strict";i(17)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,e,i){"use strict";i(17)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,e,i){var n=i(0);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,i){"use strict";var n=i(0),r=i(11),a=i(26);n(n.P+n.F*i(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=r(this),i=a(e);return"number"!=typeof i||isFinite(i)?e.toISOString():null}})},function(t,e,i){var n=i(0),r=i(269);n(n.P+n.F*(Date.prototype.toISOString!==r),"Date",{toISOString:r})},function(t,e,i){"use strict";var n=i(4),r=Date.prototype.getTime,a=Date.prototype.toISOString,o=function(t){return t>9?t:"0"+t};t.exports=n(function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-5e13-1))})||!n(function(){a.call(new Date(NaN))})?function(){if(!isFinite(r.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+("00000"+Math.abs(e)).slice(n?-6:-4)+"-"+o(t.getUTCMonth()+1)+"-"+o(t.getUTCDate())+"T"+o(t.getUTCHours())+":"+o(t.getUTCMinutes())+":"+o(t.getUTCSeconds())+"."+(i>99?i:"0"+o(i))+"Z"}:a},function(t,e,i){var n=Date.prototype,r=n.toString,a=n.getTime;new Date(NaN)+""!="Invalid Date"&&i(16)(n,"toString",function(){var t=a.call(this);return t===t?r.call(this):"Invalid Date"})},function(t,e,i){var n=i(7)("toPrimitive"),r=Date.prototype;n in r||i(15)(r,n,i(272))},function(t,e,i){"use strict";var n=i(2),r=i(26);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return r(n(this),"number"!=t)}},function(t,e,i){var n=i(0);n(n.S,"Array",{isArray:i(64)})},function(t,e,i){"use strict";var n=i(22),r=i(0),a=i(11),o=i(127),s=i(95),l=i(10),c=i(96),u=i(97);r(r.S+r.F*!i(66)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,r,h,d=a(t),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,g=void 0!==m,v=0,b=u(d);if(g&&(m=n(m,p>2?arguments[2]:void 0,2)),void 0==b||f==Array&&s(b))for(e=l(d.length),i=new f(e);e>v;v++)c(i,v,g?m(d[v],v):d[v]);else for(h=b.call(d),i=new f;!(r=h.next()).done;v++)c(i,v,g?o(h,m,[r.value,v],!0):r.value);return i.length=v,i}})},function(t,e,i){"use strict";var n=i(0),r=i(96);n(n.S+n.F*i(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)r(i,t,arguments[t++]);return i.length=e,i}})},function(t,e,i){"use strict";var n=i(0),r=i(18),a=[].join;n(n.P+n.F*(i(56)!=Object||!i(24)(a)),"Array",{join:function(t){return a.call(r(this),void 0===t?",":t)}})},function(t,e,i){"use strict";var n=i(0),r=i(83),a=i(23),o=i(41),s=i(10),l=[].slice;n(n.P+n.F*i(4)(function(){r&&l.call(r)}),"Array",{slice:function(t,e){var i=s(this.length),n=a(this);if(e=void 0===e?i:e,"Array"==n)return l.call(this,t,e);for(var r=o(t,i),c=o(e,i),u=s(c-r),h=new Array(u),d=0;d<u;d++)h[d]="String"==n?this.charAt(r+d):this[r+d];return h}})},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(11),o=i(4),s=[].sort,l=[1,2,3];n(n.P+n.F*(o(function(){l.sort(void 0)})||!o(function(){l.sort(null)})||!i(24)(s)),"Array",{sort:function(t){return void 0===t?s.call(a(this)):s.call(a(this),r(t))}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(0),a=i(24)([].forEach,!0);n(n.P+n.F*!a,"Array",{forEach:function(t){return r(this,t,arguments[1])}})},function(t,e,i){var n=i(5),r=i(64),a=i(7)("species");t.exports=function(t){var e;return r(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!r(e.prototype)||(e=void 0),n(e)&&null===(e=e[a])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){"use strict";var n=i(0),r=i(30)(1);n(n.P+n.F*!i(24)([].map,!0),"Array",{map:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(2);n(n.P+n.F*!i(24)([].filter,!0),"Array",{filter:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(3);n(n.P+n.F*!i(24)([].some,!0),"Array",{some:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(4);n(n.P+n.F*!i(24)([].every,!0),"Array",{every:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(128);n(n.P+n.F*!i(24)([].reduce,!0),"Array",{reduce:function(t){return r(this,t,arguments.length,arguments[1],!1)}})},function(t,e,i){"use strict";var n=i(0),r=i(128);n(n.P+n.F*!i(24)([].reduceRight,!0),"Array",{reduceRight:function(t){return r(this,t,arguments.length,arguments[1],!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(62)(!1),a=[].indexOf,o=!!a&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(o||!i(24)(a)),"Array",{indexOf:function(t){return o?a.apply(this,arguments)||0:r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(18),a=i(28),o=i(10),s=[].lastIndexOf,l=!!s&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(l||!i(24)(s)),"Array",{lastIndexOf:function(t){if(l)return s.apply(this,arguments)||0;var e=r(this),i=o(e.length),n=i-1;for(arguments.length>1&&(n=Math.min(n,a(arguments[1]))),n<0&&(n=i+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}})},function(t,e,i){var n=i(0);n(n.P,"Array",{copyWithin:i(129)}),i(36)("copyWithin")},function(t,e,i){var n=i(0);n(n.P,"Array",{fill:i(99)}),i(36)("fill")},function(t,e,i){"use strict";var n=i(0),r=i(30)(5),a=!0;"find"in[]&&Array(1).find(function(){a=!1}),n(n.P+n.F*a,"Array",{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(36)("find")},function(t,e,i){"use strict";var n=i(0),r=i(30)(6),a="findIndex",o=!0;a in[]&&Array(1)[a](function(){o=!1}),n(n.P+n.F*o,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(36)(a)},function(t,e,i){i(44)("Array")},function(t,e,i){var n=i(3),r=i(86),a=i(9).f,o=i(43).f,s=i(65),l=i(67),c=n.RegExp,u=c,h=c.prototype,d=/a/g,f=/a/g,p=new c(d)!==d;if(i(8)&&(!p||i(4)(function(){return f[i(7)("match")]=!1,c(d)!=d||c(f)==f||"/a/i"!=c(d,"i")}))){c=function(t,e){var i=this instanceof c,n=s(t),a=void 0===e;return!i&&n&&t.constructor===c&&a?t:r(p?new u(n&&!a?t.source:t,e):u((n=t instanceof c)?t.source:t,n&&a?l.call(t):e),i?this:h,c)};for(var m=o(u),g=0;m.length>g;)!function(t){t in c||a(c,t,{configurable:!0,get:function(){return u[t]},set:function(e){u[t]=e}})}(m[g++]);h.constructor=c,c.prototype=h,i(16)(n,"RegExp",c)}i(44)("RegExp")},function(t,e,i){"use strict";i(131);var n=i(2),r=i(67),a=i(8),o=/./.toString,s=function(t){i(16)(RegExp.prototype,"toString",t,!0)};i(4)(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?s(function(){var t=n(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?r.call(t):void 0)}):"toString"!=o.name&&s(function(){return o.call(this)})},function(t,e,i){i(68)("match",1,function(t,e,i){return[function(i){"use strict";var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(68)("replace",2,function(t,e,i){return[function(n,r){"use strict";var a=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,a,r):i.call(String(a),n,r)},i]})},function(t,e,i){i(68)("search",1,function(t,e,i){return[function(i){"use strict";var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(68)("split",2,function(t,e,n){"use strict";var r=i(65),a=n,o=[].push,s="length";if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[s]||2!="ab".split(/(?:ab)*/)[s]||4!=".".split(/(.?)(.?)/)[s]||".".split(/()()/)[s]>1||"".split(/.?/)[s]){var l=void 0===/()??/.exec("")[1];n=function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!r(t))return a.call(i,t,e);var n,c,u,h,d,f=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),m=0,g=void 0===e?4294967295:e>>>0,v=new RegExp(t.source,p+"g");for(l||(n=new RegExp("^"+v.source+"$(?!\\s)",p));(c=v.exec(i))&&!((u=c.index+c[0][s])>m&&(f.push(i.slice(m,c.index)),!l&&c[s]>1&&c[0].replace(n,function(){for(d=1;d<arguments[s]-2;d++)void 0===arguments[d]&&(c[d]=void 0)}),c[s]>1&&c.index<i[s]&&o.apply(f,c.slice(1)),h=c[0][s],m=u,f[s]>=g));)v.lastIndex===c.index&&v.lastIndex++;return m===i[s]?!h&&v.test("")||f.push(""):f.push(i.slice(m)),f[s]>g?f.slice(0,g):f}}else"0".split(void 0,0)[s]&&(n=function(t,e){return void 0===t&&0===e?[]:a.call(this,t,e)});return[function(i,r){var a=t(this),o=void 0==i?void 0:i[e];return void 0!==o?o.call(i,a,r):n.call(String(a),i,r)},n]})},function(t,e,i){"use strict";var n,r,a,o,s=i(39),l=i(3),c=i(22),u=i(58),h=i(0),d=i(5),f=i(13),p=i(45),m=i(46),g=i(69),v=i(101).set,b=i(102)(),y=i(103),_=i(132),x=i(133),w=l.TypeError,S=l.process,M=l.Promise,k="process"==u(S),E=function(){},z=r=y.f,O=!!function(){try{var t=M.resolve(1),e=(t.constructor={})[i(7)("species")]=function(t){t(E,E)};return(k||"function"==typeof PromiseRejectionEvent)&&t.then(E)instanceof e}catch(t){}}(),T=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},C=function(t,e){if(!t._n){t._n=!0;var i=t._c;b(function(){for(var n=t._v,r=1==t._s,a=0;i.length>a;)!function(e){var i,a,o=r?e.ok:e.fail,s=e.resolve,l=e.reject,c=e.domain;try{o?(r||(2==t._h&&A(t),t._h=1),!0===o?i=n:(c&&c.enter(),i=o(n),c&&c.exit()),i===e.promise?l(w("Promise-chain cycle")):(a=T(i))?a.call(i,s,l):s(i)):l(n)}catch(t){l(t)}}(i[a++]);t._c=[],t._n=!1,e&&!t._h&&P(t)})}},P=function(t){v.call(l,function(){var e,i,n,r=t._v,a=D(t);if(a&&(e=_(function(){k?S.emit("unhandledRejection",r,t):(i=l.onunhandledrejection)?i({promise:t,reason:r}):(n=l.console)&&n.error&&n.error("Unhandled promise rejection",r)}),t._h=k||D(t)?2:1),t._a=void 0,a&&e.e)throw e.v})},D=function(t){return 1!==t._h&&0===(t._a||t._c).length},A=function(t){v.call(l,function(){var e;k?S.emit("rejectionHandled",t):(e=l.onrejectionhandled)&&e({promise:t,reason:t._v})})},I=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),C(e,!0))},L=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw w("Promise can't be resolved itself");(e=T(t))?b(function(){var n={_w:i,_d:!1};try{e.call(t,c(L,n,1),c(I,n,1))}catch(t){I.call(n,t)}}):(i._v=t,i._s=1,C(i,!1))}catch(t){I.call({_w:i,_d:!1},t)}}};O||(M=function(t){p(this,M,"Promise","_h"),f(t),n.call(this);try{t(c(L,this,1),c(I,this,1))}catch(t){I.call(this,t)}},n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=i(47)(M.prototype,{then:function(t,e){var i=z(g(this,M));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=k?S.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&C(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),a=function(){var t=new n;this.promise=t,this.resolve=c(L,t,1),this.reject=c(I,t,1)},y.f=z=function(t){return t===M||t===o?new a(t):r(t)}),h(h.G+h.W+h.F*!O,{Promise:M}),i(51)(M,"Promise"),i(44)("Promise"),o=i(25).Promise,h(h.S+h.F*!O,"Promise",{reject:function(t){var e=z(this);return(0,e.reject)(t),e.promise}}),h(h.S+h.F*(s||!O),"Promise",{resolve:function(t){return x(s&&this===o?M:this,t)}}),h(h.S+h.F*!(O&&i(66)(function(t){M.all(t).catch(E)})),"Promise",{all:function(t){var e=this,i=z(e),n=i.resolve,r=i.reject,a=_(function(){var i=[],a=0,o=1;m(t,!1,function(t){var s=a++,l=!1;i.push(void 0),o++,e.resolve(t).then(function(t){l||(l=!0,i[s]=t,--o||n(i))},r)}),--o||n(i)});return a.e&&r(a.v),i.promise},race:function(t){var e=this,i=z(e),n=i.reject,r=_(function(){m(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r.e&&n(r.v),i.promise}})},function(t,e,i){"use strict";var n=i(138),r=i(54);i(70)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(r(this,"WeakSet"),t,!0)}},n,!1,!0)},function(t,e,i){"use strict";var n=i(0),r=i(71),a=i(104),o=i(2),s=i(41),l=i(10),c=i(5),u=i(3).ArrayBuffer,h=i(69),d=a.ArrayBuffer,f=a.DataView,p=r.ABV&&u.isView,m=d.prototype.slice,g=r.VIEW;n(n.G+n.W+n.F*(u!==d),{ArrayBuffer:d}),n(n.S+n.F*!r.CONSTR,"ArrayBuffer",{isView:function(t){return p&&p(t)||c(t)&&g in t}}),n(n.P+n.U+n.F*i(4)(function(){return!new d(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(t,e){if(void 0!==m&&void 0===e)return m.call(o(this),t);for(var i=o(this).byteLength,n=s(t,i),r=s(void 0===e?i:e,i),a=new(h(this,d))(l(r-n)),c=new f(this),u=new f(a),p=0;n<r;)u.setUint8(p++,c.getUint8(n++));return a}}),i(44)("ArrayBuffer")},function(t,e,i){var n=i(0);n(n.G+n.W+n.F*!i(71).ABV,{DataView:i(104).DataView})},function(t,e,i){i(33)("Int8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}},!0)},function(t,e,i){i(33)("Int16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Int32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Float32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Float64",8,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){var n=i(0),r=i(13),a=i(2),o=(i(3).Reflect||{}).apply,s=Function.apply;n(n.S+n.F*!i(4)(function(){o(function(){})}),"Reflect",{apply:function(t,e,i){var n=r(t),l=a(i);return o?o(n,e,l):s.call(n,e,l)}})},function(t,e,i){var n=i(0),r=i(42),a=i(13),o=i(2),s=i(5),l=i(4),c=i(119),u=(i(3).Reflect||{}).construct,h=l(function(){function t(){}return!(u(function(){},[],t)instanceof t)}),d=!l(function(){u(function(){})});n(n.S+n.F*(h||d),"Reflect",{construct:function(t,e){a(t),o(e);var i=arguments.length<3?t:a(arguments[2]);if(d&&!h)return u(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var n=[null];return n.push.apply(n,e),new(c.apply(t,n))}var l=i.prototype,f=r(s(l)?l:Object.prototype),p=Function.apply.call(t,f,e);return s(p)?p:f}})},function(t,e,i){var n=i(9),r=i(0),a=i(2),o=i(26);r(r.S+r.F*i(4)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,i){a(t),e=o(e,!0),a(i);try{return n.f(t,e,i),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),r=i(19).f,a=i(2);n(n.S,"Reflect",{deleteProperty:function(t,e){var i=r(a(t),e);return!(i&&!i.configurable)&&delete t[e]}})},function(t,e,i){"use strict";var n=i(0),r=i(2),a=function(t){this._t=r(t),this._i=0;var e,i=this._k=[];for(e in t)i.push(e)};i(92)(a,"Object",function(){var t,e=this,i=e._k;do{if(e._i>=i.length)return{value:void 0,done:!0}}while(!((t=i[e._i++])in e._t));return{value:t,done:!1}}),n(n.S,"Reflect",{enumerate:function(t){return new a(t)}})},function(t,e,i){function n(t,e){var i,s,u=arguments.length<3?t:arguments[2];return c(t)===u?t[e]:(i=r.f(t,e))?o(i,"value")?i.value:void 0!==i.get?i.get.call(u):void 0:l(s=a(t))?n(s,e,u):void 0}var r=i(19),a=i(20),o=i(14),s=i(0),l=i(5),c=i(2);s(s.S,"Reflect",{get:n})},function(t,e,i){var n=i(19),r=i(0),a=i(2);r(r.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return n.f(a(t),e)}})},function(t,e,i){var n=i(0),r=i(20),a=i(2);n(n.S,"Reflect",{getPrototypeOf:function(t){return r(a(t))}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,i){var n=i(0),r=i(2),a=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(t){return r(t),!a||a(t)}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{ownKeys:i(140)})},function(t,e,i){var n=i(0),r=i(2),a=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(t){r(t);try{return a&&a(t),!0}catch(t){return!1}}})},function(t,e,i){function n(t,e,i){var l,d,f=arguments.length<4?t:arguments[3],p=a.f(u(t),e);if(!p){if(h(d=o(t)))return n(d,e,i,f);p=c(0)}return s(p,"value")?!(!1===p.writable||!h(f))&&(l=a.f(f,e)||c(0),l.value=i,r.f(f,e,l),!0):void 0!==p.set&&(p.set.call(f,i),!0)}var r=i(9),a=i(19),o=i(20),s=i(14),l=i(0),c=i(37),u=i(2),h=i(5);l(l.S,"Reflect",{set:n})},function(t,e,i){var n=i(0),r=i(84);r&&n(n.S,"Reflect",{setPrototypeOf:function(t,e){r.check(t,e);try{return r.set(t,e),!0}catch(t){return!1}}})},function(t,e,i){"use strict";var n=i(0),r=i(62)(!0);n(n.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(36)("includes")},function(t,e,i){"use strict";var n=i(0),r=i(141),a=i(11),o=i(10),s=i(13),l=i(98);n(n.P,"Array",{flatMap:function(t){var e,i,n=a(this);return s(t),e=o(n.length),i=l(n,0),r(i,n,n,e,0,1,t,arguments[1]),i}}),i(36)("flatMap")},function(t,e,i){"use strict";var n=i(0),r=i(141),a=i(11),o=i(10),s=i(28),l=i(98);n(n.P,"Array",{flatten:function(){var t=arguments[0],e=a(this),i=o(e.length),n=l(e,0);return r(n,e,e,i,0,void 0===t?1:s(t)),n}}),i(36)("flatten")},function(t,e,i){"use strict";var n=i(0),r=i(90)(!0);n(n.P,"String",{at:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(142),a=i(105);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padStart:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(142),a=i(105);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padEnd:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,e,i){"use strict";i(52)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,e,i){"use strict";i(52)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,e,i){"use strict";var n=i(0),r=i(27),a=i(10),o=i(65),s=i(67),l=RegExp.prototype,c=function(t,e){this._r=t,this._s=e};i(92)(c,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),n(n.P,"String",{matchAll:function(t){if(r(this),!o(t))throw TypeError(t+" is not a regexp!");var e=String(this),i="flags"in l?String(t.flags):s.call(t),n=new RegExp(t.source,~i.indexOf("g")?i:"g"+i);return n.lastIndex=a(t.lastIndex),new c(n,e)}})},function(t,e,i){i(80)("asyncIterator")},function(t,e,i){i(80)("observable")},function(t,e,i){var n=i(0),r=i(140),a=i(18),o=i(19),s=i(96);n(n.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,i,n=a(t),l=o.f,c=r(n),u={},h=0;c.length>h;)void 0!==(i=l(n,e=c[h++]))&&s(u,e,i);return u}})},function(t,e,i){var n=i(0),r=i(143)(!1);n(n.S,"Object",{values:function(t){return r(t)}})},function(t,e,i){var n=i(0),r=i(143)(!0);n(n.S,"Object",{entries:function(t){return r(t)}})},function(t,e,i){"use strict";var n=i(0),r=i(11),a=i(13),o=i(9);i(8)&&n(n.P+i(72),"Object",{__defineGetter__:function(t,e){o.f(r(this),t,{get:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(11),a=i(13),o=i(9);i(8)&&n(n.P+i(72),"Object",{__defineSetter__:function(t,e){o.f(r(this),t,{set:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(11),a=i(26),o=i(20),s=i(19).f;i(8)&&n(n.P+i(72),"Object",{__lookupGetter__:function(t){var e,i=r(this),n=a(t,!0);do{if(e=s(i,n))return e.get}while(i=o(i))}})},function(t,e,i){"use strict";var n=i(0),r=i(11),a=i(26),o=i(20),s=i(19).f;i(8)&&n(n.P+i(72),"Object",{__lookupSetter__:function(t){var e,i=r(this),n=a(t,!0);do{if(e=s(i,n))return e.set}while(i=o(i))}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Map",{toJSON:i(144)("Map")})},function(t,e,i){var n=i(0);n(n.P+n.R,"Set",{toJSON:i(144)("Set")})},function(t,e,i){i(73)("Map")},function(t,e,i){i(73)("Set")},function(t,e,i){i(73)("WeakMap")},function(t,e,i){i(73)("WeakSet")},function(t,e,i){i(74)("Map")},function(t,e,i){i(74)("Set")},function(t,e,i){i(74)("WeakMap")},function(t,e,i){i(74)("WeakSet")},function(t,e,i){var n=i(0);n(n.G,{global:i(3)})},function(t,e,i){var n=i(0);n(n.S,"System",{global:i(3)})},function(t,e,i){var n=i(0),r=i(23);n(n.S,"Error",{isError:function(t){return"Error"===r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clamp:function(t,e,i){return Math.min(i,Math.max(e,t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,e,i){var n=i(0),r=180/Math.PI;n(n.S,"Math",{degrees:function(t){return t*r}})},function(t,e,i){var n=i(0),r=i(146),a=i(126);n(n.S,"Math",{fscale:function(t,e,i,n,o){return a(r(t,e,i,n,o))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{iaddh:function(t,e,i,n){var r=t>>>0,a=e>>>0,o=i>>>0;return a+(n>>>0)+((r&o|(r|o)&~(r+o>>>0))>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{isubh:function(t,e,i,n){var r=t>>>0,a=e>>>0,o=i>>>0;return a-(n>>>0)-((~r&o|~(r^o)&r-o>>>0)>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{imulh:function(t,e){var i=+t,n=+e,r=65535&i,a=65535&n,o=i>>16,s=n>>16,l=(o*a>>>0)+(r*a>>>16);return o*s+(l>>16)+((r*s>>>0)+(65535&l)>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,e,i){var n=i(0),r=Math.PI/180;n(n.S,"Math",{radians:function(t){return t*r}})},function(t,e,i){var n=i(0);n(n.S,"Math",{scale:i(146)})},function(t,e,i){var n=i(0);n(n.S,"Math",{umulh:function(t,e){var i=+t,n=+e,r=65535&i,a=65535&n,o=i>>>16,s=n>>>16,l=(o*a>>>0)+(r*a>>>16);return o*s+(l>>>16)+((r*s>>>0)+(65535&l)>>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:t>0}})},function(t,e,i){"use strict";var n=i(0),r=i(25),a=i(3),o=i(69),s=i(133);n(n.P+n.R,"Promise",{finally:function(t){var e=o(this,r.Promise||a.Promise),i="function"==typeof t;return this.then(i?function(i){return s(e,t()).then(function(){return i})}:t,i?function(i){return s(e,t()).then(function(){throw i})}:t)}})},function(t,e,i){"use strict";var n=i(0),r=i(103),a=i(132);n(n.S,"Promise",{try:function(t){var e=r.f(this),i=a(t);return(i.e?e.reject:e.resolve)(i.v),e.promise}})},function(t,e,i){var n=i(34),r=i(2),a=n.key,o=n.set;n.exp({defineMetadata:function(t,e,i,n){o(t,e,r(i),a(n))}})},function(t,e,i){var n=i(34),r=i(2),a=n.key,o=n.map,s=n.store;n.exp({deleteMetadata:function(t,e){var i=arguments.length<3?void 0:a(arguments[2]),n=o(r(e),i,!1);if(void 0===n||!n.delete(t))return!1;if(n.size)return!0;var l=s.get(e);return l.delete(i),!!l.size||s.delete(e)}})},function(t,e,i){var n=i(34),r=i(2),a=i(20),o=n.has,s=n.get,l=n.key,c=function(t,e,i){if(o(t,e,i))return s(t,e,i);var n=a(e);return null!==n?c(t,n,i):void 0};n.exp({getMetadata:function(t,e){return c(t,r(e),arguments.length<3?void 0:l(arguments[2]))}})},function(t,e,i){var n=i(136),r=i(145),a=i(34),o=i(2),s=i(20),l=a.keys,c=a.key,u=function(t,e){var i=l(t,e),a=s(t);if(null===a)return i;var o=u(a,e);return o.length?i.length?r(new n(i.concat(o))):o:i};a.exp({getMetadataKeys:function(t){return u(o(t),arguments.length<2?void 0:c(arguments[1]))}})},function(t,e,i){var n=i(34),r=i(2),a=n.get,o=n.key;n.exp({getOwnMetadata:function(t,e){return a(t,r(e),arguments.length<3?void 0:o(arguments[2]))}})},function(t,e,i){var n=i(34),r=i(2),a=n.keys,o=n.key;n.exp({getOwnMetadataKeys:function(t){return a(r(t),arguments.length<2?void 0:o(arguments[1]))}})},function(t,e,i){var n=i(34),r=i(2),a=i(20),o=n.has,s=n.key,l=function(t,e,i){if(o(t,e,i))return!0;var n=a(e);return null!==n&&l(t,n,i)};n.exp({hasMetadata:function(t,e){return l(t,r(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(34),r=i(2),a=n.has,o=n.key;n.exp({hasOwnMetadata:function(t,e){return a(t,r(e),arguments.length<3?void 0:o(arguments[2]))}})},function(t,e,i){var n=i(34),r=i(2),a=i(13),o=n.key,s=n.set;n.exp({metadata:function(t,e){return function(i,n){s(t,e,(void 0!==n?r:a)(i),o(n))}}})},function(t,e,i){var n=i(0),r=i(102)(),a=i(3).process,o="process"==i(23)(a);n(n.G,{asap:function(t){var e=o&&a.domain;r(e?e.bind(t):t)}})},function(t,e,i){"use strict";var n=i(0),r=i(3),a=i(25),o=i(102)(),s=i(7)("observable"),l=i(13),c=i(2),u=i(45),h=i(47),d=i(15),f=i(46),p=f.RETURN,m=function(t){return null==t?void 0:l(t)},g=function(t){var e=t._c;e&&(t._c=void 0,e())},v=function(t){return void 0===t._o},b=function(t){v(t)||(t._o=void 0,g(t))},y=function(t,e){c(t),this._c=void 0,this._o=t,t=new _(this);try{var i=e(t),n=i;null!=i&&("function"==typeof i.unsubscribe?i=function(){n.unsubscribe()}:l(i),this._c=i)}catch(e){return void t.error(e)}v(this)&&g(this)};y.prototype=h({},{unsubscribe:function(){b(this)}});var _=function(t){this._s=t};_.prototype=h({},{next:function(t){var e=this._s;if(!v(e)){var i=e._o;try{var n=m(i.next);if(n)return n.call(i,t)}catch(t){try{b(e)}finally{throw t}}}},error:function(t){var e=this._s;if(v(e))throw t;var i=e._o;e._o=void 0;try{var n=m(i.error);if(!n)throw t;t=n.call(i,t)}catch(t){try{g(e)}finally{throw t}}return g(e),t},complete:function(t){var e=this._s;if(!v(e)){var i=e._o;e._o=void 0;try{var n=m(i.complete);t=n?n.call(i,t):void 0}catch(t){try{g(e)}finally{throw t}}return g(e),t}}});var x=function(t){u(this,x,"Observable","_f")._f=l(t)};h(x.prototype,{subscribe:function(t){return new y(t,this._f)},forEach:function(t){var e=this;return new(a.Promise||r.Promise)(function(i,n){l(t);var r=e.subscribe({next:function(e){try{return t(e)}catch(t){n(t),r.unsubscribe()}},error:n,complete:i})})}}),h(x,{from:function(t){var e="function"==typeof this?this:x,i=m(c(t)[s]);if(i){var n=c(i.call(t));return n.constructor===e?n:new e(function(t){return n.subscribe(t)})}return new e(function(e){var i=!1;return o(function(){if(!i){try{if(f(t,!1,function(t){if(e.next(t),i)return p})===p)return}catch(t){if(i)throw t;return void e.error(t)}e.complete()}}),function(){i=!0}})},of:function(){for(var t=0,e=arguments.length,i=new Array(e);t<e;)i[t]=arguments[t++];return new("function"==typeof this?this:x)(function(t){var e=!1;return o(function(){if(!e){for(var n=0;n<i.length;++n)if(t.next(i[n]),e)return;t.complete()}}),function(){e=!0}})}}),d(x.prototype,s,function(){return this}),n(n.G,{Observable:x}),i(44)("Observable")},function(t,e,i){var n=i(3),r=i(0),a=i(105),o=[].slice,s=/MSIE .\./.test(a),l=function(t){return function(e,i){var n=arguments.length>2,r=!!n&&o.call(arguments,2);return t(n?function(){("function"==typeof e?e:Function(e)).apply(this,r)}:e,i)}};r(r.G+r.B+r.F*s,{setTimeout:l(n.setTimeout),setInterval:l(n.setInterval)})},function(t,e,i){var n=i(0),r=i(101);n(n.G+n.B,{setImmediate:r.set,clearImmediate:r.clear})},function(t,e,i){for(var n=i(100),r=i(40),a=i(16),o=i(3),s=i(15),l=i(53),c=i(7),u=c("iterator"),h=c("toStringTag"),d=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),m=0;m<p.length;m++){var g,v=p[m],b=f[v],y=o[v],_=y&&y.prototype;if(_&&(_[u]||s(_,u,d),_[h]||s(_,h,v),l[v]=d,b))for(g in n)_[g]||a(_,g,n[g],!0)}},function(t,e,i){(function(e){!function(e){"use strict";function i(t,e,i,n){var a=e&&e.prototype instanceof r?e:r,o=Object.create(a.prototype),s=new f(n||[]);return o._invoke=c(t,i,s),o}function n(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function r(){}function a(){}function o(){}function s(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function l(t){function i(e,r,a,o){var s=n(t[e],t,r);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&b.call(c,"__await")?Promise.resolve(c.__await).then(function(t){i("next",t,a,o)},function(t){i("throw",t,a,o)}):Promise.resolve(c).then(function(t){l.value=t,a(l)},o)}o(s.arg)}function r(t,e){function n(){return new Promise(function(n,r){i(t,e,n,r)})}return a=a?a.then(n,n):n()}"object"==typeof e.process&&e.process.domain&&(i=e.process.domain.bind(i));var a;this._invoke=r}function c(t,e,i){var r=k;return function(a,o){if(r===z)throw new Error("Generator is already running");if(r===O){if("throw"===a)throw o;return m()}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var l=u(s,i);if(l){if(l===T)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===k)throw r=O,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=z;var c=n(t,e,i);if("normal"===c.type){if(r=i.done?O:E,c.arg===T)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=O,i.method="throw",i.arg=c.arg)}}}function u(t,e){var i=t.iterator[e.method];if(i===g){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=g,u(t,e),"throw"===e.method))return T;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var r=n(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,T;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=g),e.delegate=null,T):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,T)}function h(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function d(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function f(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function p(t){if(t){var e=t[_];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(b.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=g,e.done=!0,e};return n.next=n}}return{next:m}}function m(){return{value:g,done:!0}}var g,v=Object.prototype,b=v.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},_=y.iterator||"@@iterator",x=y.asyncIterator||"@@asyncIterator",w=y.toStringTag||"@@toStringTag",S="object"==typeof t,M=e.regeneratorRuntime;if(M)return void(S&&(t.exports=M));M=e.regeneratorRuntime=S?t.exports:{},M.wrap=i;var k="suspendedStart",E="suspendedYield",z="executing",O="completed",T={},C={};C[_]=function(){return this};var P=Object.getPrototypeOf,D=P&&P(P(p([])));D&&D!==v&&b.call(D,_)&&(C=D);var A=o.prototype=r.prototype=Object.create(C);a.prototype=A.constructor=o,o.constructor=a,o[w]=a.displayName="GeneratorFunction",M.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===a||"GeneratorFunction"===(e.displayName||e.name))},M.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,w in t||(t[w]="GeneratorFunction")),t.prototype=Object.create(A),t},M.awrap=function(t){return{__await:t}},s(l.prototype),l.prototype[x]=function(){return this},M.AsyncIterator=l,M.async=function(t,e,n,r){var a=new l(i(t,e,n,r));return M.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},s(A),A[w]="Generator",A[_]=function(){return this},A.toString=function(){return"[object Generator]"},M.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},M.values=p,f.prototype={constructor:f,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(d),!t)for(var e in this)"t"===e.charAt(0)&&b.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,n){return a.type="throw",a.arg=t,i.next=e,n&&(i.method="next",i.arg=g),!!n}if(this.done)throw t;for(var i=this,n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],a=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var o=b.call(r,"catchLoc"),s=b.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&b.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,T):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),T},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),d(i),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;d(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:p(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=g),T}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,i(78))},function(t,e,i){i(388),t.exports=i(25).RegExp.escape},function(t,e,i){var n=i(0),r=i(389)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(t){return r(t)}})},function(t,e){t.exports=function(t,e){var i=e===Object(e)?function(t){return e[t]}:e;return function(e){return String(e).replace(t,i)}}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e,i){return function(){var n=i.apply(e,arguments);return n===e?t:n}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(106),s=r(o),l=i(1),c=n(l),u=i(147),h=r(u),d=i(31),f=r(d),p=i(6),m=r(p),g=i(48),v=r(g),b=i(75),y=r(b),_=i(49),x=r(_),w=i(110),S=r(w),M=i(21),k=n(M),E=i(157),z=r(E),O=i(158),T=function t(e,i,n){var r=h.default.get(e);if(r){var a=new r(i,n);return t._instances[a._id]=a,a}c.error('Tool "'+e+'" was not found.')};T._instances={},T._globals=S.default,T.clearInstances=function(t){if(t)T._instances[t]=void 0;else{for(var e in T._instances)T._instances[e].clear();T._instances={}}};var C=(0,s.default)(i(397));c.forEach(C,function(t,e){y.default.register(e,t)});var P=(0,s.default)(i(401),1);c.forEach(P,function(t,e){m.default.register(e,t)}),(0,s.default)(i(427)),T.helpers=(0,s.default)(i(428)),T.iconset=k,d3.rebind=function(t,e){for(var i=1,n=void 0,r=arguments.length;++i<r;)t[n=arguments[i]]=a(t,e,e[n]);return t},d3.time={},d3.time.scale=d3.scaleTime,d3.time.scale.utc=d3.scaleUtc,d3.time.format=function(t){var e=d3.timeFormat(t);return e.parse=d3.timeParse(t),e},d3.time.format.utc=function(t){var e=d3.utcFormat(t);return e.parse=d3.utcParse(t),e},d3.time.format.iso=function(t){var e=d3.isoFormat(t);return e.parse=d3.isoParse(t),e},d3.scaleGenericlog=z.default,d3.selection.prototype.onTap=O.onTap,d3.selection.prototype.onLongTap=O.onLongTap,T.Class=f.default,T.Tool=h.default,T.Component=m.default,T.Model=v.default,T.Reader=y.default,T.Events=x.default,T.utils=c,e.default=T},function(t,e){t.exports={linear:function(t,e,i,n,r){return+i+(r-t)/(e-t)*(n-i)},exp:function(t,e,i,n,r){return Math.exp((Math.log(i)*(e-r)-Math.log(n)*(t-r))/(e-t))},stepBefore:function(t,e,i,n,r){return n},stepAfter:function(t,e,i,n,r){return i},stepMiddle:function(t,e,i,n,r){return r<(t+e)/2?i:n}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(31),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a=r.default.extend({init:function(){this.intervals={}},setInterval:function(t){function e(e,i,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e,i){this.clearInterval(t),this.intervals[t]=setInterval(e,i)}),clearInterval:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){t?this.intervals[t]&&(clearInterval(this.intervals[t]),delete this.intervals[t]):this.clearAllIntervals()}),clearAllIntervals:function(){for(var t in this.intervals)this.clearInterval(t)}});e.default=a},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./axis":107,"./axis.js":107,"./color":148,"./color.js":148,"./data":108,"./data.js":108,"./dataconnected":55,"./dataconnected.js":55,"./entities":109,"./entities.js":109,"./group":149,"./group.js":149,"./hook":32,"./hook.js":32,"./label":150,"./label.js":150,"./locale":151,"./locale.js":151,"./marker":76,"./marker.js":76,"./side":152,"./side.js":152,"./size":153,"./size.js":153,"./stack":154,"./stack.js":154,"./time":155,"./time.js":155,"./ui":156,"./ui.js":156};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=393},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e,i,n){return c.hashCode([t.select.key,t.where,t.from,t.join,t.dataset,t.version,t.language,e,i,n])}function a(t,e,i){var n=e[0]+" - "+e[e.length-1]+" ("+e.length+")";return i&&(n=n+"_"+i.join()),n}Object.defineProperty(e,"__esModule",{value:!0}),e.DataStorage=e.Storage=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(1),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(l),u=i(31),h=(function(t){t&&t.__esModule}(u),e.Storage=function(){function t(){n(this,t),this.queryIds={},this.queries={},this._collection={},this._collectionPromises={}}return s(t,[{key:"loadFromReader",value:function(t,e,i){var n=r(t,i._basepath,i._lastModified,i._name);return this.queries[n]||(this.queries[n]=this.queryQueue(i,n)),this.queries[n].getPromise(t,e)}},{key:"getDataId",value:function(t,e,i){var n=r(t,e._basepath,e._lastModified,e._name);return!!this.queries[n]&&this.queries[n].getDataId(t,i)}},{key:"queryQueue",value:function(t,e){var i=this,n=function(t,e){return 0==Object.keys(e).filter(function(i){return e[i]!==t[i]}).length&&(0==Object.keys(t).length||0!=Object.keys(e).length)};return new function(){this.readerObject=t,this.queries=[],this.query=null,this.parsers=null,this.defer={},this.getPromise=function(t,e){var i=this,r=!0,a=!1,s=void 0;try{for(var l,u=this.queries[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var h=l.value,d=function(i){if(0==t.select.value.filter(function(t){return-1==i.query.select.value.indexOf(t)}).length&&n(i.parsers,e))return{v:i.defer.promise}}(h);if("object"===(void 0===d?"undefined":o(d)))return d.v}}catch(t){a=!0,s=t}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}return this.query?(this.query.select.value=this.query.select.value?c.unique(this.query.select.value.concat(t.select.value)):[],c.extend(this.parsers,e)):(this.query=t,this.parsers=e),c.debounce(function(){i.runQuery()},10)(),this.defer.promise&&this.defer.promise instanceof Promise||(this.defer.promise=new Promise(function(t,e){i.defer.resolve=t,i.defer.reject=e})),this.defer.promise},this.runQuery=function(){this.query&&(this.queries.push(this.reader(this.query,this.parsers,this.defer)),this.query=null,this.parsers=null,this.defer={})},this.getDataId=function(t,e){var i=!0,r=!1,a=void 0;try{for(var s,l=this.queries[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,u=function(i){if((!t.select.value||0==t.select.value.filter(function(t){return-1==i.query.select.value.indexOf(t)}).length)&&n(i.parsers,e)&&i.dataId)return{v:i.dataId}}(c);if("object"===(void 0===u?"undefined":o(u)))return u.v}}catch(t){r=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw a}}return!1},this.reader=function(t,e,n){var r=this,a=t.grouping?c.clone(t,null,["grouping"]):t;return new function(){var o=this;this.defer=n,this.query=t,this.parsers=e,this.dataId=null,r.readerObject.read(a,this.parsers).then(function(e){o.checkQueryResponse(t,e),o.dataId=c.hashCode([a,r.readerObject._basepath]),i._collection[o.dataId]={},i._collectionPromises[o.dataId]={};var n=i._collection[o.dataId];n.data=e,n.valid={},n.nested={},n.unique={},n.limits={},n.frames={},n.haveNoDataPointsPerKey={},n.query=t,o.defer.resolve(o.dataId)}).catch(function(t){o.defer.reject(t)}),this.checkQueryResponse=function(t,e){var i=this;if(0==e.length&&c.warn("Reader for data source '"+this._name+"' returned empty array for query:",JSON.stringify(t,null,2)),e.length>0){for(var n=(t.select.key||[]).concat(t.select.value||[]),r=e.length-1;r>=0;r--){for(var a=n.length-1;a>=0;a--)(e[r][n[a]]||0===e[r][n[a]])&&n.splice(a,1);if(!n.length)break}n.forEach(function(n){if(-1==t.select.key.indexOf(n))c.warn("Reader result: Column '"+n+"' is missing from '"+t.from+"' data, but it might be ok");else{c.error("Reader result: Key column '"+n+"' is missing from '"+t.from+"' response",JSON.stringify(t));var r=new Error;r.name="reader/error/keyColumnMissingInReaderResult",r.message="Reader result: Key column '"+n+"' is missing from '"+t.from+"' response",r.details=n,r.ddfql=t,i.defer.reject(r),console.log(e)}})}}}}}}},{key:"aggregateData",value:function(t,e,i,n){if(Object.keys(e.grouping).every(function(t){return 1===e.grouping[t].grouping}))return Promise.resolve(t);var a=r(e,i._basepath,i._lastModified,i._name),o=c.hashCode([e,i._basepath]);if(!this._collection[o]||this._collection[o]._queryMergeId!==a){for(var s=e.grouping=e.grouping,l=e.select.key,u=e.select.value.filter(function(t){return"measure"===n[t].concept_type}),h="datapoints"===e.from?l.concat(e.animatable):l.slice(0),d=Object.keys(s||{}).filter(function(t){return-1!==h.indexOf(t)&&-1!==l.indexOf(t)&&s[t].grouping>1}),f=d.reduce(function(t,e){return function(i){return t[e]=function(t){return~~(+t/i)*i},t}(s[e].grouping)},{}),p=d3.nest(),m=0;m<h.length;m++)p=p.key(function(t,e){return e?function(i){return e(i[t])}:function(e){return e[t]}}(h[m],f[h[m]]));d.length&&(p=p.rollup(function(t){var e=Object.assign({},t[0]);return d.forEach(function(t){return e[t]=f[t](e[t])}),u.forEach(function(i){return e[i]=d3.sum(t,function(t){return+t[i]})}),[e]})),this._collection[o]={},this._collectionPromises[o]={};var g=this._collection[o];g.data=c.nestArrayToValues(p.entries(this._collection[t].data)),g.valid={},g.nested={},g.unique={},g.limits={},g.frames={},g.haveNoDataPointsPerKey={},g.query=e,g._queryMergeId=a}return Promise.resolve(o)}},{key:"getData",value:function(t,e,i,n){if(!e||"data"==e)return this._collection[t].data;if("query"==e)return this._collection[t].query;if(!i)return this._collection[t][e];var r="string"==typeof i?i:JSON.stringify(i);if(this._collection[t][e][r])return this._collection[t][e][r];switch(e){case"unique":this._collection[t][e][r]=this._getUnique(t,i);break;case"valid":this._collection[t][e][r]=this._getValid(t,i);break;case"limits":this._collection[t][e][r]=this._getLimits(t,i);break;case"nested":this._collection[t][e][r]=this._getNested(t,i)}return this._collection[t][e][r]}},{key:"_getValid",value:function(t,e){return this._collection[t].data.filter(function(t){return t[e]||0===t[e]})}},{key:"_getLimits",value:function(t,e){for(var i=this._collection[t].data,n=i.reduce(function(t,i){var n=c.isDate(i[e])?i[e]:parseFloat(i[e]);return isNaN(n)||t.push(n),t},[]),r=void 0,a=void 0,o={},s=0;s<n.length;s+=1){var l=n[s];(void 0===r||l<r)&&(r=l),(void 0===a||l>a)&&(a=l)}return o.min=r||0,o.max=a||100,o}},{key:"_getUnique",value:function(t,e){var i=void 0,n=this._collection[t].data;if(c.isArray(e)){var r=n.map(function(t){return c.clone(t,e)});i=c.unique(r,function(t){return JSON.stringify(t)})}else{var a=n.map(function(t){return t[e]});i=c.unique(a)}return i}},{key:"_getNested",value:function(t,e){for(var i=d3.nest(),n=0;n<e.length;n++)i=i.key(function(t){return function(e){return e[t]}}(e[n]));return c.nestArrayToObjWithFlatKeys(i.entries(this._collection[t].data))}},{key:"getFrames",value:function(t,e,i,n){var r=this,o=a(t,e,i);return this._collectionPromises[t][o]||(this._collectionPromises[t][o]={queue:this.framesQueue(e,o),promise:null}),this._collectionPromises[t][o]&&this._collectionPromises[t][o].promise instanceof Promise?this._collectionPromises[t][o].promise:(this._collectionPromises[t][o].promise=new Promise(function(a,s){t||s(c.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)),r._getFrames(t,o,e,i,n).then(function(e){r._collection[t].frames[o]=e,a(r._collection[t].frames[o])})}),this._collectionPromises[t][o].promise)}},{key:"getFrame",value:function(t,e,i,n){var r=this,o=a(t,e,n);return new Promise(function(e,n){r._collection[t].frames[o]&&r._collection[t].frames[o][i]?e(r._collection[t].frames[o]):r._collectionPromises[t][o].queue.forceFrame(i,function(){e(r._collection[t].frames[o])})})}},{key:"listenFrame",value:function(t,e,i,n){var r=a(t,e,i);this._collectionPromises[t][r].queue.defaultCallbacks.push(function(e){n(t,e)}),this._collection[t].frames[r]&&c.forEach(this._collection[t].frames[r],function(e,i){n(t,new Date(i))})}},{key:"_muteAllQueues",value:function(t){c.forEach(this._collectionPromises,function(e,i){c.forEach(e,function(e,i){1==e.queue.isActive&&e.queue.whatId!=t&&e.queue.mute()})})}},{key:"_checkForcedQueuesExists",value:function(){c.forEach(this._collectionPromises,function(t,e){c.forEach(t,function(t,e){t.queue.forcedQueue.length>0&&t.queue.unMute()})})}},{key:"_unmuteQueue",value:function(){c.forEach(this._collectionPromises,function(t,e){c.forEach(t,function(t,e){0==t.queue.isActive&&t.queue.unMute()})})}},{key:"framesQueue",value:function(t,e){var i=this;return new function(){this.defaultCallbacks=[],this.callbacks={},this.forcedQueue=[],this.isActive=!0,this.delayedAction=null,this.whatId=e,this.queue=t.slice(0);var n=this;this.queue.splice(0,0,this.queue.splice(this.queue.length-1,1)[0]),this.key=0,this.mute=function(){this.isActive=!1,this.delayedAction=Promise.resolve.bind(Promise)},this.unMute=function(){this.isActive=!0,"function"==typeof this.delayedAction&&this.delayedAction(),this.delayedAction=null,0==this.forcedQueue.length&&0==this.queue.length&&i._unmuteQueue()},this.frameComplete=function(t){var e=void 0;if(n.defaultCallbacks.length>0)for(e=0;e<n.defaultCallbacks.length;e++)n.defaultCallbacks[e](t);if(n.callbacks[t]&&n.callbacks[t].length>0)for(e=0;e<n.callbacks[t].length;e++)n.callbacks[t][e]()},this._waitingForActivation=function(){var t=this;return new Promise(function(e,i){if(t.isActive)return e();t.delayedAction=e})},this._getNextFrameName=function(){var t=null;return this.forcedQueue.length>0||this.queue.length>0?this.forcedQueue.length>0?t=this.forcedQueue.shift():(0==this.forcedQueue.length&&this.key>=this.queue.length-1&&(this.key=0),t=this.queue.splice(this.key,1).pop()):i._unmuteQueue(),t},this.checkForcedFrames=function(){this.forcedQueue.length>0||i._checkForcedQueuesExists()},this.getNext=function(){var t=this;return new Promise(function(e,i){t.checkForcedFrames(),t.isActive?e(t._getNextFrameName()):t._waitingForActivation().then(function(){e(t._getNextFrameName())})})},this.forceFrame=function(t,e){if(this.callbacks[t])this.callbacks[t].push(e);else{var n=function(t,e){for(var i=e.toString(),n=-1,r=0,a=t.length;r<a;r++)if(t[r].toString()==i){n=r;break}return n}(this.queue,t);-1!==n?(this.forcedQueue.unshift(this.queue.splice(n,1).pop()),i._muteAllQueues(this.whatId),this.unMute(),"function"==typeof e&&("object"!==o(this.callbacks[t])&&(this.callbacks[t]=[]),this.callbacks[t].push(e)),this.key=n):"object"===o(this.callbacks[t])?this.callbacks[t].push(e):this.callbacks[t]=[e]}}}}},{key:"_getFrames",value:function(t,e,i,n,r){var a=this;return a._collection[t].frames[e]||(a._collection[t].frames[e]={}),new Promise(function(o,s){r||c.warn("_getFrames in data.js is missing indicatorsDB, it's needed for gap filling"),i||c.warn("_getFrames in data.js is missing framesArray, it's needed so much");var l=a._collection[t].query.animatable,u=a._collection[t].query.select.key.slice(0);l&&-1!=u.indexOf(l)&&u.splice(u.indexOf(l),1);var h={},d=void 0,f=void 0,p=void 0,m=void 0,g=void 0,v=a.getData(t,"nested",u.concat([l]),r),b=Object.keys(v);n=n||b.map(function(t){return JSON.parse(t).join(",")});var y=a._collection[t].query,_=y.select.value.filter(function(t){return"_default"!==t}),x=_.length,w=void 0,S=void 0,M=void 0,k=void 0,E=void 0;for(M=0;M<n.length;M++)for(h[n[M]]={},E=0;E<x;E++)h[n[M]][_[E]]=null;for(E=0;E<x;E++)a._collection[t].haveNoDataPointsPerKey[_[E]]={};var z=function t(i,n,s,z){var O={};if("datapoints"!==y.from){var T=a._collection[s].data;for(E=0;E<x;E++)O[_[E]]={};for(var C=0;C<T.length;C++){var P=T[C];for(E=0;E<x;E++)O[_[E]][P[u[0]]]=P[_[E]],null==P[_[E]]&&(a._collection[s].haveNoDataPointsPerKey[_[E]][JSON.stringify([P[u[0]]])]=T.length)}}else{for(E=0;E<x;E++)O[_[E]]={};for(M=0;M<n.length;M++)for(w=n[M],S=b[M],E=0;E<x;E++)if(k=_[E],m=r[k]?r[k].interpolation:null,v[S]&&v[S][i]&&(v[S][i][0][k]||0===v[S][i][0][k]))O[k][w]=v[S][i][0][k];else if("none"===m)O[k][w]=null;else{if(null===(d=h[w][k])){var D=Object.keys(v[S]);d=new Array(D.length),f=0;for(var A=0,I=D.length;A<I;A++)p=v[S][D[A]],(p[0][k]||0===p[0][k])&&(d[f++]=p[0]);d.length=f,h[w][k]=0===f?[]:d,0==d.length&&(a._collection[s].haveNoDataPointsPerKey[k][S]=d.length)}d&&d.length>0&&(g=null,O[k][w]=c.interpolatePoint(d,void 0,k,g,l,i,m))}}a._collection[s].frames[e][i]=O,"function"==typeof z&&z(i),a._collectionPromises[s][e].queue.getNext().then(function(i){i?c.defer(function(){t(i,n,s,a._collectionPromises[s][e].queue.frameComplete)}):o(a._collection[s].frames[e])})};a._collectionPromises[t][e].queue.getNext().then(function(i){i&&z(i,n,t,a._collectionPromises[t][e].queue.frameComplete)})})}}]),t}());e.DataStorage=new h},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t){var e=Object.create(s);return e.model=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=(function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}}(),i(1)),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s={model:null,dimensionModels:new Map,updateDimensionModels:function(){var t=this;this.dimensionModels.clear(),o.forEach(this.model.state._data,function(e,i){void 0!==e.dim&&t.dimensionModels.set(i,e)})},getDimensionModelsForSpace:function(t,e){var i=this;this.updateDimensionModels();var r=[],a=Object.keys(t).reduce(function(i,n){return"entities"==t[n]._type&&(e.includes(t[n].dim)?i[t[n].dim]=n:r.push(n)),i},{});return e.map(function(e,o){var s=void 0;if(i.model.dataManager.isConceptType(e,"time"))s="time",t[s].dim=e;else{if(a[e])return a[e];if(void 0!==(s=r.shift()))t[s].setDimension(e);else{s="entities_"+e;var l=n({},s,{dim:e});i.model.state.set(l)}}return s})}};e.default=r},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t){var e=Object.create(s);return e.model=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),s={model:null,dataModels:new Map,getDataModels:function(){return this.updateDataModels(),this.dataModels},updateDataModels:function(){var t=this;this.dataModels.clear(),o.forEach(this.model._data,function(e,i){"data"==e._type&&t.dataModels.set(i,e)})},isConceptType:function(t,e){this.updateDataModels();var i=!0,n=!1,r=void 0;try{for(var a,o=this.dataModels.values()[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value;if(s.conceptDictionary[t]&&s.conceptDictionary[t].concept_type==e)return!0}}catch(t){n=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw r}}return!1},getConceptProperty:function(t,e){this.updateDataModels();var i=!0,n=!1,r=void 0;try{for(var a,o=this.dataModels.values()[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value,l=s.getConceptprops(t);if(l&&l[e])return l[e]}}catch(t){n=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw r}}return"Concept not found"},getAvailableDataForKey:function(t,e,i){this.updateDataModels();var n=[],r=!0,a=!1,o=void 0;try{for(var s,l=this.dataModels.values()[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value,u=!0,h=!1,d=void 0;try{for(var f,p=((c.dataAvailability||{})[i]||[])[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var m=f.value,g=m.key,v=m.value;!g.has(t)||e&&v!==e||n.push({data:c._name,key:t,value:v})}}catch(t){h=!0,d=t}finally{try{!u&&p.return&&p.return()}finally{if(h)throw d}}}}catch(t){a=!0,o=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}return n},getDimensionValues:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({select:{key:[t],value:e},from:"entities"},i);return Promise.all([].concat(n(this.getDataModels().values())).map(function(t){return t.load(r,void 0,!0).then(function(e){return t.getData(e)})}))}};e.default=r},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./csv-time_in_columns/csv-time_in_columns.js":398,"./csv/csv.js":159,"./inline/inline.js":400};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=397},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(159),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=i(1),l=o.default.extend({MISSED_INDICATOR_NAME:"indicator",_name:"csv-time_in_columns",init:function(t){this._super(t),this.timeKey="time",Object.assign(this.ERRORS,{REPEATED_KEYS:"reader/error/repeatedKeys"})},load:function(t){var e=this;return this._super().then(function(i){var a=i.rows,o=i.columns,l=t[e.timeKey]&&!!t[e.timeKey](o[e.keySize]);l&&(0,s.warn)("Indicator column is missed.");var c=l?e.MISSED_INDICATOR_NAME:o[e.keySize],u=o.slice(0,e.keySize).concat(l?(0,s.capitalize)(e.MISSED_INDICATOR_NAME):a.reduce(function(t,e){var i=e[c];return!t.includes(i)&&i&&t.push(i),t},[]));u.splice(e.keySize,0,e.timeKey);var h=u.slice(e.keySize+1),d=r(u,1),f=d[0];return{columns:u,rows:a.reduce(function(t,i){var r=t.filter(function(t){return t[f]===i[f]});if(r.length){if(null!==r[0][i[c]])throw e.error(e.ERRORS.REPEATED_KEYS,void 0,{indicator:i[c],key:i[f]});r.forEach(function(t){t[i[c]]=i[t[e.timeKey]]})}else Object.keys(i).forEach(function(r){if(![f,c].includes(r)){var a,o=(a={},n(a,f,i[f]),n(a,e.timeKey,r),a),s=h.reduce(function(t,e){return t[e]=l||i[c]===e?i[r]:null,t},{});t.push(Object.assign(o,s))}});return t},[])}})},versionInfo:{version:"0.31.0",build:1522445132733}});e.default=l},function(t,e){(function(){var e,i,n;n=[],e={},t.exports=i=function(t,i,r){var a,o,s,l,c,u,h,d;if(null==r&&(r=!0),"string"==typeof i){if(2!==i.length)throw{name:"ArgumentException",message:"The format for string options is '<thousands><decimal>' (exactly two characters)"};d=i[0],a=i[1]}else if(Array.isArray(i)){if(2!==i.length)throw{name:"ArgumentException",message:"The format for array options is ['<thousands>','[<decimal>'] (exactly two elements)"};d=i[0],a=i[1]}else d=(null!=i?i.thousands:void 0)||(null!=i?i.group:void 0)||e.thousands,a=(null!=i?i.decimal:void 0)||e.decimal;return u=""+d+a+r,c=n[u],null==c&&(s=r?3:1,c=n[u]=new RegExp("^\\s*([+-]?(?:(?:\\d{1,3}(?:\\"+d+"\\d{"+s+",3})+)|\\d*))(?:\\"+a+"(\\d*))?\\s*$")),null==(h=t.match(c))||3!==h.length?NaN:(l=h[1].replace(new RegExp("\\"+d,"g"),""),o=h[2],parseFloat(l+"."+o))},t.exports.setOptions=function(t){var i,n;for(i in t)n=t[i],e[i]=n},t.exports.factoryReset=function(){e={thousands:",",decimal:"."}},t.exports.withOptions=function(t,e){return null==e&&(e=!0),function(n){return i(n,t,e)}},t.exports.factoryReset()}).call(this)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(75),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a=r.default.extend({_name:"inline",init:function(t){this._data=t.data||[{}]},load:function(){return Promise.resolve({columns:Object.keys(this._data[0]),rows:this._data})},versionInfo:{version:"0.31.0",build:1522445132733}});e.default=a},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./brushslider/brushslider.js":77,"./brushslider/bubblesize/bubblesize.js":160,"./brushslider/singlehandleslider/singlehandleslider.js":59,"./brushslider/sizeslider/sizeslider.js":161,"./buttonlist/buttonlist.js":162,"./buttonlist/optionsbuttonlist/optionsbuttonlist.js":163,"./colorlegend/colorlegend.js":164,"./datanotes/datanotes.js":403,"./datawarning/datawarning.js":404,"./dialogs/_dialog.js":12,"./dialogs/about/about.js":167,"./dialogs/axes/axes.js":168,"./dialogs/colors/colors.js":170,"./dialogs/dialogs.js":171,"./dialogs/find/find.js":172,"./dialogs/find/show.js":112,"./dialogs/grouping/grouping.js":173,"./dialogs/label/label.js":174,"./dialogs/moreoptions/moreoptions.js":175,"./dialogs/opacity/opacity.js":176,"./dialogs/presentation/presentation.js":177,"./dialogs/side/side.js":178,"./dialogs/size/size.js":179,"./dialogs/speed/speed.js":180,"./dialogs/stack/stack.js":181,"./dialogs/timedisplay/timedisplay.js":183,"./dialogs/zoom/zoom.js":185,"./draggablelist/draggablelist.js":182,"./indicatorpicker/indicatorpicker.js":50,"./minmaxinputs/minmaxinputs.js":169,"./simplecheckbox/simplecheckbox.js":60,"./steppedspeedslider/steppedspeedslider.js":422,"./timeslider/timeslider.js":424,"./treemenu/treemenu.js":426,"./zoombuttonlist/zoombuttonlist.js":186};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=401},function(t,e){t.exports='<div class="vzb-slider-holder">\n\t<svg class="vzb-slider-svg">\n\t\t<g class="vzb-slider-wrap">\n\t\t\t<g class="vzb-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),a=i(6),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=i(21),l=o.default.extend({init:function(t,e){var i=this;this.name="gapminder-datanotes",this.model_expects=[{name:"marker",type:"marker"},{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i._readyOnce&&i.ready()}},this._super(t,e),this.close=this.close.bind(this),this.hidden=!0,this.showNotes=!1,this.pinned=!1,this.left=0,this.top=0,this.hookName=null,this.newHookName=null},ready:function(){this.setValues()},readyOnce:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.element=d3.select(this.placeholder),this.element.selectAll("div").remove();var e=this.element;e.append("div").html(s.close).on("click",function(){d3.event.stopPropagation(),t.close()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),e.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),e.append("div").attr("class","vzb-data-notes-link")},resize:function(){this.close()},close:function(){this.hidden||this.pin(!1).hide()},setHook:function(t){return this._readyOnce?this.pinned?(this.newHookName=t,this):(this.hookName&&this.model.marker[this.hookName].off("change:which",this.close),this.hookName=this.newHookName=t,this.model.marker[this.hookName].on("change:which",this.close),this.setValues(),this):this},setValues:function(){if(this.hookName){var t=this.model.marker[this.hookName],e=t.getConceptprops();if(this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!e.description).text(r.replaceNumberSpacesToNonBreak(e.description)||""),this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!e.sourceLink),e.sourceLink){var i=this.translator("hints/source"),n=e.sourceName||"";this.element.select(".vzb-data-notes-link").html("<span>"+(n?i+":":"")+'<a href="'+e.sourceLink+'" target="_blank">'+(n||i)+"</a></span>")}this.showNotes=e.sourceLink||e.description}},setPos:function(t,e,i){if(this.left=t,this.top=e,this.pinned&&!i)return this;var n=this.parent.element.offsetHeight,r=this.element.node().offsetWidth,a=this.element.node().offsetHeight,o=void 0,s=void 0,l=this.left-r,c=this.top;return l<10&&(l=10,o=!0),c+a+10>n&&(c=n-a-10,s=!0),o&&s&&(c=this.top-a-30),this.element.style("top",c+"px"),this.element.style("left",l+"px"),this},pin:function(t){return this.hidden?this:(this.pinned=!this.pinned,null!=t&&(this.pinned=t),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!this.pinned),this.element.classed("vzb-data-notes-pinned",this.pinned),this.hookName!=this.newHookName&&this.setHook(this.newHookName),this.element.select(".vzb-data-notes-body").node().scrollTop=0,this.showNotes?this.setPos(this.left,this.top,!0):this.hide())},toggle:function(t){return this.pinned||!this.hookName?this:(null==t&&(t=!this.hidden),this.hidden=t,this.element.classed("vzb-hidden",this.hidden||!this.showNotes),this)},show:function(){return this.toggle(!1)},hide:function(){return this.toggle(!0)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(n),i(6)),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=i(21),s=!0,l=a.default.extend({init:function(t,e){var i=this;this.name="gapminder-datawarning",this.model_expects=[{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i.redraw()}},this._super(t,e)},ready:function(){this.redraw()},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.element.append("div").attr("class","vzb-data-warning-background").on("click",function(){t.toggle(!0)}),this.container=this.element.append("div").attr("class","vzb-data-warning-box"),this.container.append("div").html(o.close).on("click",function(){t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close"),this.container.append("div").attr("class","vzb-data-warning-link").html(o.warn).append("div"),this.container.append("div").attr("class","vzb-data-warning-title"),this.container.append("div").attr("class","vzb-data-warning-body vzb-dialog-scrollable")},redraw:function(){this.translator=this.model.locale.getTFunction(),this.container.select(".vzb-data-warning-link div").text(this.translator("hints/dataWarning"));var t=this.translator("datawarning/title/"+this.parent.name);this.container.select(".vzb-data-warning-title").html(t).classed("vzb-hidden",!t||t=="datawarning/title/"+this.parent.name),this.container.select(".vzb-data-warning-body").html(this.translator("datawarning/body/"+this.parent.name))},toggle:function(t){null==t&&(t=!s),s=t,this.element.classed("vzb-hidden",s);var e=this;this.parent.components.forEach(function(t){t.element.classed("vzb-blur",t!=e&&!s)})}});e.default=l},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./about/about.html":406,"./axes/axes.html":407,"./colors/colors.html":408,"./find/find.html":409,"./find/show.html":166,"./grouping/grouping.html":410,"./label/label.html":411,"./moreoptions/moreoptions.html":412,"./opacity/opacity.html":413,"./presentation/presentation.html":414,"./side/side.html":415,"./size/size.html":416,"./speed/speed.html":417,"./stack/stack.html":418,"./timedisplay/timedisplay.html":419,"./zoom/zoom.html":420};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=405},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/about") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-about-text0"></p>\n      <p class="vzb-about-text1"></p>\n      <br/>\n      <p class="vzb-about-version"></p>\n      <p class="vzb-about-updated"></p>\n      <br/>\n      <p class="vzb-about-report"></p>\n      <br/>\n      <p class="vzb-about-credits"></p>\n      <br/>\n      <p class="vzb-about-tool"></p>\n      <br/>\n      <p class="vzb-about-datasets"><span>Datasets:</span></p>\n      <br/>\n      <p class="vzb-about-readers"><span>Readers:</span></p>\n  </div>\n      \n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n      \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/axes") %></div>\n    <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_x") %> <span class="vzb-xaxis-selector"></span> </p>\n      <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div>\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_y") %> <span class="vzb-yaxis-selector"></span> </p>\n      <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div>\n    </div>\n    <div class="vzb-dialog-buttons">\n      <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ( "buttons/ok") %></div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n  \n  <div class="vzb-dialog-title">\n      <%=t ("buttons/colors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n  \n  \n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <label class="vzb-dialog-title-switch">\n      <input type="checkbox">\n      <span class="vzb-switch-slider round"></span>\n      <span class="vzb-switch-off"><%=t ("dialogs/find") %></span>\n      <span class="vzb-switch-on"><%=t ("buttons/show") %></span>\n    </label>\n    <span class="vzb-dialog-content vzb-find-filter">\n      <form>\n        <input class="vzb-find-search" type="search" required/>\n        <button class="vzb-cancel-button" type="reset"></button>\n      </form>\n    </span>\n    <span class="vzb-find-filter-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n      <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-find vzb-active">\n        <div class="vzb-find-list">\n          \x3c!-- list will be placed here --\x3e\n        </div>\n      </div>\n\n      <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-show">\n      </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-bubbleopacity vzb-dialog-control" data-panel="find"></div>\n    <div class="vzb-dialog-button vzb-find-deselect" data-panel="find">\n      <%=t ("buttons/deselect") %>\n    </div>\n    <div class="vzb-dialog-button vzb-show-deselect" data-panel="show">\n      <%=t ("buttons/reset") %>\n    </div>\n    <div class="vzb-dialog-button vzb-show-apply" data-panel="show">\n      <%=t ("buttons/apply") %>\n    </div>\n      \n    <div data-dialogtype="find" data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>  \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/grouping") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-groups"></div>\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/label") %>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <span class="vzb-saxis-selector"></span>\n    <div class="vzb-dialog-sizeslider"></div>\n    <div class="vzb-removelabelbox-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span>\n\n\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/more_options") %>\n  </div>\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class=\'vzb-dialog-options-buttonlist\'>\n    </div>\n    <div class="vzb-accordion">\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/opacity") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityRegular") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-regular"></div>\n\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityNonselect") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-selectdim"></div>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("dialogs/presentation") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <div class="vzb-presentationmode-switch"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="side" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="side" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/side") %>\n    <span class="vzb-side-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-side-list vzb-side-list-left">\n      \x3c!-- list will be placed here --\x3e\n    </div>\n    <div class="vzb-side-list vzb-side-list-right">\n      \x3c!-- list will be placed here --\x3e\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-label-primary vzb-side-switch-sides">\n      <%=t ("buttons/leftright") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/size") %>\n      <span class="vzb-saxis-selector"></span>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-bubblesize"></div>\n    <span class="vzb-dialog-subtitle">teststs</span>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/speed") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="stack" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="stack" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/stack") %></div>\n        \n    <div class="vzb-dialog-content vzb-dialog-scrollable">\n        \n        \x3c!--p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/howtostack") %></p--\x3e\n        <form class="vzb-howtostack vzb-dialog-paragraph">\n            <label> <input type="radio" name="stack" value="none"> <%=t ("mount/stacking/none") %> </label>\n            <label> <input type="radio" name="stack" value="bycolor"> <%=t ("mount/stacking/color") %> </label>\n            <label> <input type="radio" name="stack" value="all"> <%=t ("mount/stacking/world") %> </label>\n        </form>\n        \n        <form class="vzb-howtomerge vzb-dialog-paragraph">\n            <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/howtomerge") %> </p>\n            <label> <input type="radio" name="merge" value="none"> <%=t ("mount/merging/none") %> </label>\n            <label> <input type="radio" name="merge" value="grouped"> <%=t ("mount/merging/color") %> </label>\n            <label> <input type="radio" name="merge" value="stacked"> <%=t ("mount/merging/world") %> </label>\n        </form>\n        \n        <form class="vzb-manual-sorting">\n            <p class="vzb-dialog-sublabel"> <%=t ("mount/manualSorting") %> </p>\n            <div class="vzb-dialog-draggablelist vzb-dialog-control"></div>\n        </form>\n                \n    </div>\n\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ("buttons/ok") %></div>\n    </div>\n\n</div>'},function(t,e){t.exports='<div class="vzb-dialog-modal">\n  <div class="vzb-dialog-content vzb-dialog-content-fixed">\n    <svg>\n      <g class="vzb-timedisplay"></g>\n    </svg>\n  </div>\n  <div class="vzb-dialog-buttons"></div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n    <%=t ("buttons/zoom") %>\n    <div class="vzb-dialog-zoom-buttonlist"></div>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-panwitharrow-switch"></div>\n    <div class="vzb-zoomonscrolling-switch"></div>\n    <div class="vzb-adaptminmaxzoom-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class="vzb-mmi-holder">\n\n    <span class="vzb-mmi-domainmin-label"></span>\n    <input type="text" class="vzb-mmi-domainmin" name="min">\n    <span class="vzb-mmi-domainmax-label"></span>\n    <input type="text" class="vzb-mmi-domainmax" name="max">\n\n    <br class="vzb-mmi-break"/>\n\n    <span class="vzb-mmi-zoomedmin-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmin" name="min">\n    <span class="vzb-mmi-zoomedmax-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmax" name="max">\n    \n</div>'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(6),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a=i(1),o=r.default.extend({init:function(t,e){var n=this;this.name="steppedSpeedSlider",this.template=i(423),this.config=Object.assign({triangleWidth:10,triangleHeight:10,height:31,lineWidth:10,domain:[1,2,3,4,5,6],range:[1200,900,450,200,150,100]},t),this.config.height-=this.config.triangleHeight/2,this.model_expects=[{name:"time",type:"time"},{name:"locale",type:"locale"}],this.model_binds={"change:time.delay":function(){n.redraw()}},this.setDelay=(0,a.throttle)(this.setDelay,50),this._super(t,e)},readyOnce:function(){var t=this.config,e=t.domain,i=t.range,n=t.height;this.element=d3.select(this.element),this.svg=this.element.select("svg"),this.axisScale=d3.scaleLog().domain(d3.extent(e)).range([n,0]),this.delayScale=d3.scaleLinear().domain(e).range(i),this.initTriangle(),this.initAxis(),this.redraw()},initAxis:function(){var t=this,e=this.config,i=e.lineWidth,n=e.triangleWidth,r=e.triangleHeight,o=e.height,s=d3.axisLeft().scale(this.axisScale).tickFormat(function(){return""}).tickSizeInner(i).tickSizeOuter(0),l=n+i/2,c=r/2;this.svg.on("mousedown",function(){var e=d3.event.offsetY,i=Math.max(0,Math.min(e-c,o));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(i))),!0,!0)}).select(".vzb-stepped-speed-slider-axis").attr("transform","translate("+l+", "+c+")").call(s),this.drag=d3.drag().on("drag",function(){var e=d3.event.dy,i=(0,a.transform)(t.slide.node()),n=i.translateY,r=Math.max(0,Math.min(e+n,o));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(r)))),t.redraw(r)}).on("end",function(){t.setDelay(t.model.time.delay,!0,!0)}),this.svg.call(this.drag)},initTriangle:function(){var t=this.config;t.triangleWidth,t.triangleHeight,t.lineWidth;this.slide=this.svg.select(".vzb-stepped-speed-slider-triangle"),this.slide.append("g").append("path").attr("d",this.getTrianglePath())},getTrianglePath:function(){var t=this.config,e=t.triangleHeight;return"M "+t.triangleWidth+","+e/2+" 0,"+e+" 0,0 z"},setDelay:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.model.time.set("delay",t,e,i)},redraw:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.axisScale(this.delayScale.invert(this.model.time.delay));this.slide.attr("transform","translate(0, "+t+")")}});e.default=o},function(t,e){t.exports='<div class="vzb-stepped-speed-slider">\n  <svg>\n    <g class="vzb-stepped-speed-slider-triangle"></g>\n    <g class="vzb-stepped-speed-slider-axis"></g>\n  </svg>\n</div>\n'},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(6),s=n(o),l=i(111),c=n(l),u={small:{margin:{top:7,right:15,bottom:10,left:60},radius:8,label_spacing:5},medium:{margin:{top:0,right:15,bottom:10,left:50},radius:9,label_spacing:5},large:{margin:{top:-5,right:15,bottom:10,left:75},radius:11,label_spacing:8}},h={medium:{margin:{top:9}},large:{margin:{}}},d=s.default.extend({init:function(t,e){this.name="gapminder-timeslider",this.template=this.template||i(425),this.prevPosition=null,this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time":function(t,e){if(n.slide){if(-1!==["time.start","time.end"].indexOf(e)){if(!n.xScale)return;n.changeLimits()}n._optionClasses(),n.model.time.dragging||n._setHandle(n.model.time.playing)}},"change:time.start":function(t,e){n.slide&&(n.model.time.dragging||n._setHandle(n.model.time.playing),n.ready())},"change:time.end":function(t,e){n.slide&&(n.model.time.dragging||n._setHandle(n.model.time.playing),n.ready())},"change:time.offset":function(t,e){n.slide&&(n._updateProgressBar(),n.model.marker.listenFramesQueue(null,function(t){n._updateProgressBar(t)}))},"change:time.startSelected":function(t,e){n.slide&&n.updateSelectedStartLimiter()},"change:time.endSelected":function(t,e){n.slide&&n.updateSelectedEndLimiter()},"change:marker.select":function(t,e){n.setSelectedLimits()},"dataLoaded:marker":function(){n.availableTimeFrames=[[n.model.time.startSelected||n.model.time.start,n.model.time.endSelected||n.model.time.end]],n._updateProgressBar(!0)}},this._super(t,e),this.profiles=a.deepClone(u),this.presentationProfileChanges=a.deepClone(h),(this.model.ui.chart||{}).margin&&this.model.on("change:ui.chart.margin",function(t,e){var i=n.getLayoutProfile();if("small"!==i){n.profiles[i].margin.left=n.model.ui.chart.margin.left}n.slide&&n.updateSize()}),this.ui=a.extend({show_ticks:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,axis_aligned:!1},t.ui.getPlainObject(),this.ui),this.width=0,this.height=0,this.availableTimeFrames=[],this.completedTimeFrames=[],this.getValueWidth=a.memoize(this.getValueWidth),this._setTime=a.throttle(this._setTime,50)},readyOnce:function(){var t=this;this.element=a.isArray(this.element)?this.element:d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.select=this.element.select(".vzb-ts-slider-select"),this.progressBar=this.element.select(".vzb-ts-slider-progress"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.element.select(".vzb-ts-slider-handle"),this.valueText=this.element.select(".vzb-ts-slider-value"),this.playButtons=this.element.select(".vzb-ts-btns"),this.element.select(".vzb-ts-btn-play").on("click",function(){t.model.time.play()}),this.element.select(".vzb-ts-btn-pause").on("click",function(){t.model.time.pause("soft")}),this.xScale=d3.scaleUtc().clamp(!0),this.xAxis=(0,c.default)("bottom"),this.valueText.classed("stroke",!0),this.slider.style("paint-order").length||(this.slider.insert("text",".vzb-ts-slider-value").attr("class","vzb-ts-slider-value stroke"),this.valueText.classed("stroke",!1)),this.valueText=this.element.selectAll(".vzb-ts-slider-value"),this.valueText.attr("text-anchor","middle").attr("dy","-0.7em");var e=t._getBrushed(),i=t._getBrushedEnd();this.brush=d3.drag().on("start drag",function(){e.call(this)}).on("end",function(){i.call(this)}),this.slide.call(this.brush),this.slider_outer.on("mousewheel",function(){if(t.model.time.dragging)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}),this._setSelectedLimitsId=0,this.model.time.startSelected>this.model.time.start&&t.updateSelectedStartLimiter(),this.model.time.endSelected<this.model.time.end&&t.updateSelectedEndLimiter(),this.parent.on("myEvent",function(e,i){var n=t.getLayoutProfile(),r=t.profiles[n];i.profile&&i.profile.margin&&(r.margin=i.profile.margin),t.element.select(".vzb-ts-slider-wrapper").style("right",i.mRight-r.margin.right+"px"),t.updateSize([0,i.rangeMax])}),this.on("resize",function(){t.updateSize()})},ready:function(){if(!this.model.time.splash){var t=this;this.element.classed("vzb-ts-loading",!1),this.changeLimits(),this.changeTime(),this.updateSize(),t._updateProgressBar(),t.model.marker.listenFramesQueue(null,function(e){t._updateProgressBar(e)}),t.setSelectedLimits(!0)}},changeLimits:function(){var t=this.model.time.start,e=this.model.time.end;this.xScale.domain([t,e]),this.xAxis.tickValues([t,e]).tickFormat(this.model.time.getFormatter())},changeTime:function(){this.model.time.value;this._optionClasses()},updateSize:function(t){if(!this.model.time.splash){this.model.time.pause(),this.profile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=parseInt(this.slider_outer.style("width"),10)||0,i=parseInt(this.slider_outer.style("height"),10)||0;if(!i||!e)return a.warn("time slider resize() aborted because element is too small or has display:none");this.width=e-this.profile.margin.left-this.profile.margin.right,this.height=i-this.profile.margin.bottom-this.profile.margin.top;var n=this;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),this.xScale.range(t||[0,this.width]),this.slide.attr("transform","translate(0,"+this.height/2+")").attr("x1",this.xScale.range()[0]).attr("x2",this.xScale.range()[1]).style("stroke-width",2*this.profile.radius+"px"),this.xAxis=this.xAxis.scale(this.xScale).tickSizeInner(0).tickSizeOuter(0).tickPadding(this.profile.label_spacing).tickSizeMinor(0,0),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.select.attr("transform","translate(0,"+this.height/2+")"),this.progressBar.attr("transform","translate(0,"+this.height/2+")"),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius),this.sliderWidth=n.slider.node().getBoundingClientRect().width,this.resizeSelectedLimiters(),this._resizeProgressBar(),this._setHandle(),this.playButtons.style("width",this.profile.margin.left+"px")}},setSelectedLimits:function(t){var e=this;this._setSelectedLimitsId++;var i=this._setSelectedLimitsId,n=e.model.marker.select;if(0==n.length)return void e.model.time.set({startSelected:new Date(e.model.time.start),endSelected:new Date(e.model.time.end)},null,!1);var r=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),o=[];a.forEach(n,function(t){o.push(e.model.marker.getEntityLimits(a.getKey(t,r)))}),Promise.all(o).then(function(n){if(i==e._setSelectedLimitsId){var r=n.shift(),o=r.min,s=r.max;a.forEach(n,function(t){o-t.min>0&&(o=t.min),s-t.max<0&&(s=t.max)}),e.model.time.set({startSelected:d3.max([o,new Date(e.model.time.start)]),endSelected:d3.min([s,new Date(e.model.time.end)])},t,!1)}})},updateSelectedStartLimiter:function(){var t=this;this.select.select("#clip-start-"+t._id).remove(),this.select.select(".selected-start").remove(),this.model.time.startSelected&&this.model.time.startSelected>this.model.time.start&&(this.select.append("clipPath").attr("id","clip-start-"+t._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-start-"+t._id+")").classed("selected-start",!0),this.resizeSelectedLimiters())},updateSelectedEndLimiter:function(){var t=this;this.select.select("#clip-end-"+t._id).remove(),this.select.select(".selected-end").remove(),this.model.time.endSelected&&this.model.time.endSelected<this.model.time.end&&(this.select.append("clipPath").attr("id","clip-end-"+t._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-end-"+t._id+")").classed("selected-end",!0),this.resizeSelectedLimiters())},resizeSelectedLimiters:function(){var t=this;this.select.select(".selected-start").attr("d","M0,0H"+this.xScale(this.model.time.startSelected)),this.select.select("#clip-start-"+t._id).select("rect").attr("x",-this.height/2).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.startSelected)+this.height/2),this.select.select(".selected-end").attr("d","M"+this.xScale(this.model.time.endSelected)+",0H"+this.xScale(this.model.time.end)),this.select.select("#clip-end-"+t._id).select("rect").attr("x",this.xScale(this.model.time.endSelected)).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.end)-this.xScale(this.model.time.endSelected)+this.height/2)},_resizeProgressBar:function(){var t=this;this.progressBar.selectAll("path").each(function(e){d3.select(this).attr("d","M"+t.xScale(e[0])+",0H"+t.xScale(e[1]))})},_updateProgressBar:function(t){var e=this;if(t){if(-1!=e.completedTimeFrames.indexOf(t))return;e.completedTimeFrames.push(t);var i=e.model.time.incrementTime(t),n=e.model.time.decrementTime(t);if(i>e.model.time.end){if(t-e.model.time.end!=0)return;i=t,t=n}if(0==e.availableTimeFrames.length||e.availableTimeFrames[e.availableTimeFrames.length-1][1]<t)e.availableTimeFrames.push([t,i]);else if(i<e.availableTimeFrames[0][0])e.availableTimeFrames.unshift([t,i]);else for(var r=0;r<e.availableTimeFrames.length;r++){if(t-e.availableTimeFrames[r][1]==0){r+1<e.availableTimeFrames.length&&i-e.availableTimeFrames[r+1][0]==0?(e.availableTimeFrames[r][1]=e.availableTimeFrames[r+1][1],e.availableTimeFrames.splice(r+1,1)):e.availableTimeFrames[r][1]=i;break}if(i-e.availableTimeFrames[r][0]==0){e.availableTimeFrames[r][0]=t;break}if(t-e.availableTimeFrames[r][1]>0&&i-e.availableTimeFrames[r+1][0]<0){e.availableTimeFrames.splice(r+1,0,[t,i]);break}}}else e.availableTimeFrames=[],e.completedTimeFrames=[];var a=this.progressBar.selectAll("path").data(e.availableTimeFrames);a.exit().remove(),a.enter().append("path").attr("class","domain").merge(a).each(function(t){d3.select(this).attr("d","M"+e.xScale(t[0])+",0H"+e.xScale(t[1])).classed("rounded",1==e.availableTimeFrames.length)})},getValueWidth:function(t,e){return this.valueText.node().getBoundingClientRect().width},_getBrushed:function(){var t=this;return function(){t.model.time.playing&&t.model.time.set("playing",!1,null,!1),t._optionClasses(),t.element.classed("vzb-ts-dragging",!0);var e=void 0;if(d3.event.sourceEvent){d3.event.sourceEvent.preventDefault(),t.model.time.dragStart();var i=a.roundStep(Math.round(d3.mouse(this)[0]),1);e=t.xScale.invert(i);var n=t.width;i>n?i=n:i<0&&(i=0),t.handle.attr("cx",i),t.valueText.attr("transform","translate("+i+","+t.height/2+")"),t.valueText.text(t.model.time.formatDate(e,"ui"))}e-t.model.time.value!=0&&t._setTime(e)}},_getBrushedEnd:function(){var t=this;return function(){t._setTime.recallLast(),t.element.classed("vzb-ts-dragging",!1),t.model.time.dragStop(),t.model.time.snap()}},_setHandle:function(t){var e=this,i=this.model.time.value,n=this.xScale(i);this.element.classed("vzb-ts-disabled",this.model.time.end<=this.model.time.start),null==e.prevPosition&&(e.prevPosition=n);var r=n>e.prevPosition?this.model.time.delayAnimations:0;t?(this.handle.attr("cx",e.prevPosition).transition().duration(r).ease(d3.easeLinear).attr("cx",n),this.valueText.attr("transform","translate("+e.prevPosition+","+this.height/2+")").transition("text").delay(r).text(this.model.time.formatDate(i,"ui")),this.valueText.transition().duration(r).ease(d3.easeLinear).attr("transform","translate("+n+","+this.height/2+")")):(this.handle.interrupt().attr("cx",n),this.valueText.interrupt().interrupt("text").transition("text"),this.valueText.attr("transform","translate("+n+","+this.height/2+")").text(this.model.time.formatDate(i,"ui"))),e.prevPosition=n},_setTime:function(t){var e=this,i=!this.model.time.dragging&&!this.model.time.playing;e.model.time.getModelObject("value").set(t,!1,i)},_optionClasses:function(){var t=this.ui.show_ticks,e=this.ui.show_value,i=this.ui.show_value_when_drag_play,n=this.ui.axis_aligned,r=this.ui.show_button&&this.model.time.playable;this.xAxis.labelerOptions({scaleType:"time",removeAllLabels:!t,limitMaxTickNumber:3,showOuter:!1,toolMargin:{left:10,right:10,top:0,bottom:30},fitIntoScale:"optimistic"}),this.element.classed("vzb-ts-hide-play-button",!r),this.element.classed("vzb-playing",this.model.time.playing),this.element.classed("vzb-ts-show-value",e),this.element.classed("vzb-ts-show-value-when-drag-play",i),this.element.classed("vzb-ts-axis-aligned",n)}});e.default=d},function(t,e){t.exports='<div class="vzb-timeslider vzb-ts-loading">\n  <div class="vzb-ts-slider-wrapper">\n    <svg class="vzb-ts-slider">\n      <g>\n        <g class="vzb-ts-slider-axis"></g>\n        <g class="vzb-ts-slider-progress"></g>\n        <g class="vzb-ts-slider-select"></g>\n        <circle class="vzb-ts-slider-handle"></circle>\n        <text class="vzb-ts-slider-value"></text>\n        <line class="vzb-ts-slider-slide"></line>\n      </g>\n      </svg>\n  </div>\n\n  \x3c!-- SVG VIZABI ICONS\n       source: https://github.com/encharm/Font-Awesome-SVG-PNG/ --\x3e\n  <div class="vzb-ts-btns">\n    <button class="vzb-ts-btn-loading vzb-ts-btn">\n      <div class=\'vzb-loader\'></div>\n    </button>\n    <button class="vzb-ts-btn-play vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/>\n      </svg>\n    </button>\n    <button class="vzb-ts-btn-pause vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/>\n      </svg>\n    </button>\n  </div>\n</div>\n'},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(6),s=n(o),l=i(31),c=n(l),u=i(32),h=(n(u),i(76)),d=n(h),f=i(21),p={wrapper:"vzb-treemenu-wrap",wrapper_outer:"vzb-treemenu-wrap-outer",background:"vzb-treemenu-background",close:"vzb-treemenu-close",search:"vzb-treemenu-search",list:"vzb-treemenu-list",list_outer:"vzb-treemenu-list-outer",list_item:"vzb-treemenu-list-item",list_item_leaf:"vzb-treemenu-list-item-leaf",leaf:"vzb-treemenu-leaf",leaf_content:"vzb-treemenu-leaf-content",leaf_content_item:"vzb-treemenu-leaf-content-item",leaf_content_item_title:"vzb-treemenu-leaf-content-item-title",leaf_content_item_descr:"vzb-treemenu-leaf-content-item-descr",hasChild:"vzb-treemenu-list-item-children",list_item_label:"vzb-treemenu-list-item-label",list_top_level:"vzb-treemenu-list-top",search_wrap:"vzb-treemenu-search-wrap",isSpecial:"vzb-treemenu-list-item-special",hidden:"vzb-hidden",title:"vzb-treemenu-title",scaletypes:"vzb-treemenu-scaletypes",scaletypesDisabled:"vzb-treemenu-scaletypes-disabled",scaletypesActive:"vzb-treemenu-scaletypes-active",alignYt:"vzb-align-y-top",alignYb:"vzb-align-y-bottom",alignXl:"vzb-align-x-left",alignXr:"vzb-align-x-right",alignXc:"vzb-align-x-center",menuHorizontal:"vzb-treemenu-horizontal",menuVertical:"vzb-treemenu-vertical",absPosVert:"vzb-treemenu-abs-pos-vert",absPosHoriz:"vzb-treemenu-abs-pos-horiz",menuOpenLeftSide:"vzb-treemenu-open-left-side",noTransition:"notransition"},m={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:1,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1},g=c.default.extend({init:function(t,e,i){var n=this;this.parent=t,this.entity=e,this.OPTIONS=i,this.width=this.OPTIONS.MIN_COL_WIDTH,this.direction=this.OPTIONS.MENU_DIRECTION,this._setDirectionClass(),this.menuItems=[];var r=void 0;return this.entity.empty()?this:(this.entity.each(function(){r=d3.selectAll(this.childNodes).filter(function(){return d3.select(this).classed(p.list)})}),r.empty()&&(r=this.entity),e.selectAll("."+p.list_item).filter(function(){return this.parentNode==r.node()}).each(function(){n.addSubmenu(d3.select(this))}),!this.menuItems.length&&this.isActive()&&this.buildLeaf(),this)},setWidth:function(t,e,i){if(this.width!=t&&this.entity.node()){if(this.width=t,(this.entity.classed(p.list_top_level)||this.entity.classed("active"))&&1==this.direction&&(i?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(p.list_top_level)&&this.entity.selectAll("."+p.leaf).style("width",this.width-1+"px"),e)for(var n=0;n<this.menuItems.length;n++)this.menuItems[n].setWidth(this.width,e,i);return this}},setDirection:function(t,e){if(this.direction=t,this.entity.style("width","").style("height",""),e)for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].setDirection(this.direction,e);return this._setDirectionClass(),this},_setDirectionClass:function(){1==this.direction?(this.entity.classed(p.menuVertical,!1),this.entity.classed(p.menuHorizontal,!0)):(this.entity.classed(p.menuHorizontal,!1),this.entity.classed(p.menuVertical,!0))},addSubmenu:function(t){this.menuItems.push(new v(this,t,this.OPTIONS))},open:function(){var t=this,e=this;return this.isActive()||(e.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors(function(){1==e.direction?(t.menuItems.length||e.buildLeaf(),e._openHorizontal(),e.calculateMissingWidth(0)):e._openVertical()}),e.parent.parentMenu.openSubmenuNow=!1),this},calculateMissingWidth:function(t,e){var i=this;this.entity.classed(p.list_top_level)?t>this.OPTIONS.MAX_MENU_WIDTH&&"function"==typeof e&&e(t-this.OPTIONS.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(t+this.width,function(t){t>0?i.reduceWidth(t,function(t){"function"==typeof e&&e(t)}):"function"==typeof e&&e(t)})},restoreWidth:function(t,e,i){var n=this;if(e)this.parent.parentMenu.restoreWidth(t,!1,i);else if(t<=0)"function"==typeof i&&i();else if(this.entity.classed(p.list_top_level))"function"==typeof i&&i();else{var r=this.entity.node().offsetWidth,a=Math.min(t,n.width);if(r<a){var o=r/a*250;this.entity.transition().delay(0).duration(o).style("width",a+"px").on("end",function(){}),n.parent.parentMenu.restoreWidth(t-a,!1,i)}else this.parent.parentMenu.restoreWidth(t,!1,i)}},reduceWidth:function(t,e){var i=this,n=this.entity.node().offsetWidth;if(n<=this.OPTIONS.MIN_COL_WIDTH)e(t-i.width+n);else{var r=Math.max(this.OPTIONS.MIN_COL_WIDTH,i.width-t),a=250/(i.width/r);this.entity.transition().delay(0).duration(a).style("width",r+"px").on("end",function(){e(t-i.width+r)})}},_openHorizontal:function(){var t=this;t.entity.classed("active",!0).transition().delay(0).duration(250).style("width",t.width+"px").on("end",function(){t.marqueeToggle(!0)})},_openVertical:function(){var t=this;t.entity.style("height","0px"),t.entity.transition().delay(0).duration(250).style("height",36*t.menuItems.length+"px").on("end",function(){t.entity.style("height","auto"),t.marqueeToggle(!0),t.scrollToFitView()}),t.entity.classed("active",!0)},closeAllChildren:function(t){for(var e=0,i=0;i<this.menuItems.length;i++)this.menuItems[i].isActive()&&(++e,this.menuItems[i].submenu.close(function(){0==--e&&"function"==typeof t&&t()}));0==e&&"function"==typeof t&&t()},closeNeighbors:function(t){this.parent?this.parent.closeNeighbors(t):t()},close:function(t){var e=this;this.closeAllChildren(function(){1==e.direction?e._closeHorizontal(t):e._closeVertical(t)})},_closeHorizontal:function(t){var e=(this.entity.node().offsetWidth,this),i=e.parent.parentMenu.openSubmenuNow;e.entity.transition().delay(0).duration(20).style("width","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),i?"function"==typeof t&&t():e.restoreWidth(e.OPTIONS.MAX_MENU_WIDTH,!0,function(){"function"==typeof t&&t()})})},_closeVertical:function(t){var e=this;e.entity.transition().delay(0).duration(100).style("height","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),"function"==typeof t&&t()})},isActive:function(){return this.entity.classed("active")},hasActiveParentNeighbour:function(){return this.menuItems.filter(function(t){return t.isActive()}).some(function(t){return!!d3.select(t.entity).node().classed(p.hasChild)})},marqueeToggle:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggle(t)},marqueeToggleAll:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggleAll(t)},findItemById:function(t){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].entity.data().id==t)return this.menuItems[e];if(this.menuItems[e].submenu){var i=this.menuItems[e].submenu.findItemById(t);if(i)return i}}return null},getTopMenu:function(){return this.parent?this.parent.parentMenu.getTopMenu():this},scrollToFitView:function(){var t=this.getTopMenu().entity.node().parentNode,e=this.entity.node().parentNode,i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),r=n.top-i.top;if(r+n.height>i.height){var a=n.height>i.height?i.height-10:n.height+10,o=t.scrollTop+a-i.height+r;d3.select(t).transition().duration(100).tween("scrolltoptween",function(e){return function(){var i=d3.interpolateNumber(this.scrollTop,e);return function(e){t.scrollTop=i(e)}}}(o))}},buildLeaf:function(){var t=this.entity.datum();this.entity.selectAll("div").data([t]).enter().append("div").classed(p.leaf+" "+p.leaf_content+" vzb-dialog-scrollable",!0).style("width",this.width+"px").each(function(t){var e=d3.select(this);e.append("span").classed(p.leaf_content_item+" "+p.leaf_content_item_title,!0).text(a.replaceNumberSpacesToNonBreak(t.name)||""),e.append("span").classed(p.leaf_content_item+" "+p.leaf_content_item_descr,!0).text(a.replaceNumberSpacesToNonBreak(t.description)||"")})}}),v=c.default.extend({init:function(t,e,i){var n=this;this.parentMenu=t,this.entity=e;var r=e.select("."+p.list_outer);return r.node()&&(this.submenu=new g(this,r,i)),this.entity.select("."+p.list_item_label).on("mouseenter",function(){a.isTouchDevice()||(1!=n.parentMenu.direction||d3.select(this).attr("children")?n.parentMenu.hasActiveParentNeighbour()||n.closeNeighbors():n.openSubmenu(),n.marqueeToggle(!0))}).on("click.item",function(){if(!a.isTouchDevice())if(d3.event.stopPropagation(),1==n.parentMenu.direction)n.openSubmenu();else{var t=d3.select(this);if(!t.attr("children"))return;n.toggleSubmenu()}}).onTap(function(t){if(d3.event.stopPropagation(),2==n.parentMenu.direction){if(!n.entity.select("."+p.list_item_label).attr("children"))return}n.toggleSubmenu()}),this},setWidth:function(t,e,i){return this.submenu&&e&&this.submenu.setWidth(t,e,i),this},setDirection:function(t,e){return this.submenu&&e&&this.submenu.setDirection(t,e),this},toggleSubmenu:function(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())},openSubmenu:function(){this.submenu?this.submenu.open():this.closeNeighbors()},closeNeighbors:function(t){this.parentMenu.closeAllChildren(t)},isActive:function(){return this.submenu&&this.submenu.isActive()},marqueeToggleAll:function(t){this.entity.selectAll("."+p.list_item_label).each(function(){var e=d3.select(this).select("span"),i=d3.select(this.parentNode);if(i.classed("marquee",!1),e.style("width",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var n=30+e.node().scrollWidth;e.style("width",n+"px"),i.classed("marquee",!0)}})},marqueeToggle:function(t){var e=this.entity.select("."+p.list_item_label).select("span");if(this.entity.classed("marquee",!1),e.style("width",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var i=30+e.node().scrollWidth;e.style("width",i+"px"),this.entity.classed("marquee",!0)}}}),b=s.default.extend({tree:function(t){return arguments.length?(this._tree=t,this):this._tree},callback:function(t){return arguments.length?(this._callback=t,this):this._callback},markerID:function(t){return arguments.length?(this._markerID=t,this.targetModel(this.model.marker[this._markerID]),this):this._markerID},targetModel:function(t){return arguments.length?(this._targetModel&&this._targetModel.off("change",this.change),this._targetModel=t,this._targetModel.on("change",this.change),this._targetModel.isHook()&&(this._targetProp="which"),this._targetModel instanceof d.default&&(this._targetProp="space"),this):this._targetModel},targetProp:function(t){return arguments.length?(this._targetProp=t,this):this._targetProp},alignX:function(t){return arguments.length?(this._alignX=t,this):this._alignX},alignY:function(t){return arguments.length?(this._alignY=t,this):this._alignY},top:function(t){return arguments.length?(this._top=t,this):this._top},left:function(t){return arguments.length?(this._left=t,this):this._left},init:function(t,e){this.name="gapminder-treemenu",this.model_expects=[{name:"marker",type:"marker"},{name:"marker_tags",type:"marker"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.context=e,this.menuEntity=null,this._super(t,e),this._callback=function(t){console.log("Indicator selector: stub callback fired. New indicator is ",t)},this._alignX="center",this._alignY="center",this.OPTIONS=a.deepClone(m),this.change=this.change.bind(this)},change:function(t,e){(-1!=e.indexOf("."+this._targetProp)||this._targetModel.isHook()&&-1!=e.indexOf(".scaleType"))&&this.updateView()},ready:function(){this.updateView();var t=void 0;this.model.marker_tags&&(t=this.model.marker_tags.label.getData()),this._buildIndicatorsTree(t)},readyOnce:function(){this.element=d3.select(this.placeholder);var t=this;this.element.selectAll("div").remove(),this.element.append("div").attr("class",p.background).on("click",function(){d3.event.stopPropagation(),t.toggle()}),this.wrapperOuter=this.element.append("div").classed(p.wrapper_outer,!0).classed(p.noTransition,!0),this.wrapper=this.wrapperOuter.append("div").classed(p.wrapper,!0).classed(p.noTransition,!0).classed("vzb-dialog-scrollable",!0),this.wrapper.on("click",function(){d3.event.stopPropagation()}),this.wrapper.append("div").attr("class",p.close).html(f.close).on("click",function(){d3.event.stopPropagation(),t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class",p.close+"-icon"),this.wrapper.append("div").classed(p.scaletypes,!0).append("span"),this.wrapper.append("div").classed(p.title,!0).append("span"),this.wrapper.append("div").classed(p.search_wrap,!0).append("input").classed(p.search,!0).attr("type","search").attr("id",p.search),d3.select("body").on("mousemove",t._mousemoveDocument),this.wrapper.on("mouseleave",function(){}),this.translator=this.model.locale.getTFunction(),t._enableSearch(),t.resize()},_buildIndicatorsTree:function(t){!0!==t&&t||(t=[]);var e=this,i="_root",n=e.model.marker._root.dataManager.getDataModels(),r={};r[i]={id:i,children:[]},n.size>1&&n.forEach(function(t){var e=t.getDatasetName();r[e]={id:e,type:"dataset",children:[]},r[i].children.push(r[e])}),t.forEach(function(t){r[t.tag]={id:t.tag,name:t.name,type:"folder",children:[]}});var o=r[i];t.forEach(function(t){t.parent&&r[t.parent]?r[t.parent].children.push(r[t.tag]):o.children.push(r[t.tag])});var s=this.model.marker.space.length>1;this.model.marker.getAvailableData().forEach(function(t){var n=t.value;if(n&&"_none"!=n.tags){n.tags||(n.tags=t.dataSource.getDatasetName()||i);var o="_default"==n.concept?"constant":t.key.size>1?"indicator":"property",l={id:n.concept,key:t.key,name:n.name,name_catalog:n.name_catalog,description:n.description,dataSource:t.dataSource._name,use:o};if(s&&1==t.key.length&&"_default"!=n.concept&&"time"!=n.concept_type){var c=t.key[0].concept+"_properties";if(!r[c]){var u=t.key[0];r[c]={id:c,name:u.name+" properties",type:"folder",children:[]},r[i].children.push(r[c])}r[c].children.push(l)}else n.tags.split(",").forEach(function(t){t=t.trim(),r[t]?r[t].children.push(l):(e.consoleGroupOpen||(console.groupCollapsed("Some tags were not found, so indicators went under menu root"),e.consoleGroupOpen=!0),a.warn("tag '"+t+"' for indicator '"+l.id+"'"),r[i].children.push(l))})}}),this.model.marker.getAvailableSpaces().forEach(function(t,e){o.children.push({id:e,name:t.map(function(t){return t.name}).join(", "),name_catalog:t.map(function(t){return t.name}).join(", "),description:"no description",dataSource:"All data sources",type:"space"})}),e.consoleGroupOpen&&(console.groupEnd(),delete e.consoleGroupOpen),this._sortChildren(o),this.indicatorsTree=o},_sortChildren:function(t,e){var i=this;t.children&&(t.children.sort(a.firstBy()(function(t,e){return t="dataset"===t.type?1:0,(e="dataset"===e.type?1:0)-t}).thenBy(function(t,e){return t=t.children?1:0,e=e.children?1:0,t-e}).thenBy(function(t,i){if(!e){if("time"==t.id)return-1;if("time"==i.id)return 1;if("advanced"==t.id)return 1;if("advanced"==i.id)return-1;if("_default"==t.id)return 1;if("_default"==i.id)return-1}return(t.name_catalog||t.name)>(i.name_catalog||i.name)?1:-1})),t.children.forEach(function(t){i._sortChildren(t,!0)}))},resize:function(){var t=this;this.profiles={small:{col_width:200},medium:{col_width:200},large:{col_width:200}};var e=this._top,i=this._left;if(!this.wrapper)return a.warn("treemenu resize() abort because container is undefined");this.wrapper.classed(p.noTransition,!0),this.wrapper.node().scrollTop=0,this.activeProfile=this.profiles[this.getLayoutProfile()],this.OPTIONS.IS_MOBILE="small"===this.getLayoutProfile(),this.menuEntity&&(this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.OPTIONS.IS_MOBILE?2!=this.menuEntity.direction&&(this.menuEntity.setDirection(2,!0),this.OPTIONS.MENU_DIRECTION=2):1!=this.menuEntity.direction&&(this.menuEntity.setDirection(1,!0),this.OPTIONS.MENU_DIRECTION=1)),this.width=t.element.node().offsetWidth,this.height=t.element.node().offsetHeight;var n=this.wrapperOuter.node().getBoundingClientRect(),r=n.width,o=n.height;if(r)if(this.OPTIONS.IS_MOBILE)this.clearPos();else{(e||i)&&(this.wrapperOuter.node().offsetTop<10&&this.wrapperOuter.style("top","10px"),this.height-t.wrapperOuter.node().offsetTop-o<0&&(o>this.height&&(o=this.height-20),this.wrapperOuter.style("top",this.height-o-10+"px"),this.wrapperOuter.style("bottom","auto")),e&&(e=t.wrapperOuter.node().offsetTop));var s=void 0;s=this.wrapperOuter.classed(p.alignYb)?this.wrapperOuter.node().offsetTop+this.wrapperOuter.node().offsetHeight:this.height-this.wrapperOuter.node().offsetTop,this.wrapper.style("max-height",s-10+"px"),this.wrapperOuter.classed(p.alignXc,"center"===this._alignX),this.wrapperOuter.style("margin-left","center"===this._alignX?"-"+r/2+"px":null),"center"===this._alignX?this.OPTIONS.MAX_MENU_WIDTH=this.width/2-.5*r-10:this.OPTIONS.MAX_MENU_WIDTH=this.width-this.wrapperOuter.node().offsetLeft-r-10;var l=this.activeProfile.col_width+2*this.OPTIONS.MIN_COL_WIDTH,c=this.wrapperOuter.node().offsetLeft;this.OPTIONS.MENU_OPEN_LEFTSIDE=this.OPTIONS.MAX_MENU_WIDTH<l&&c>this.OPTIONS.MAX_MENU_WIDTH+10,this.OPTIONS.MENU_OPEN_LEFTSIDE?(c<l+10&&(c=l+10),this.OPTIONS.MAX_MENU_WIDTH=c-10):this.OPTIONS.MAX_MENU_WIDTH<l&&(c-=l-this.OPTIONS.MAX_MENU_WIDTH,this.OPTIONS.MAX_MENU_WIDTH=l),i?i=c:c!=this.wrapperOuter.node().offsetLeft&&(this.wrapperOuter.style("left","auto"),this.wrapperOuter.style("right",this.width-c-n.width+"px")),this._top=e,this._left=i,(i||e)&&this.setPos(),this.wrapperOuter.classed("vzb-treemenu-open-left-side",!this.OPTIONS.IS_MOBILE&&this.OPTIONS.MENU_OPEN_LEFTSIDE)}return this.wrapper.node().offsetHeight,this.wrapper.classed(p.noTransition,!1),this.setHorizontalMenuHeight(),this},toggle:function(){var t=this,e=!this.element.classed(p.hidden);this.element.classed(p.hidden,e),e?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):(this.setPos(),!a.isTouchDevice()&&this.focusSearch(),this.resize(),this.scrollToSelected()),this.wrapper.classed(p.noTransition,e),this.parent.components.forEach(function(i){"gapminder-dialogs"==i.name?d3.select(i.placeholder.parentNode).classed("vzb-blur",!e):i.element.classed?i.element.classed("vzb-blur",i!=t&&!e):d3.select(i.element).classed("vzb-blur",i!=t&&!e)}),this.width=t.element.node().offsetWidth},scrollToSelected:function(){if(this.selectedNode){var t=this,e=function(t,e){t.scrollTop=0;var i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),r=n.bottom-i.top-t.offsetHeight+10;t.scrollTop=r};if(2==this.menuEntity.direction)e(this.wrapper.node(),this.selectedNode),t.menuEntity.marqueeToggleAll(!0);else{this.menuEntity.findItemById(d3.select(this.selectedNode).data().id).submenu.calculateMissingWidth(0,function(){t.menuEntity.marqueeToggleAll(!0)});for(var i=this.selectedNode,n=void 0;!a.hasClass(i,p.list_top_level);)"LI"==i.tagName&&(n=a.hasClass(i.parentNode,p.list_top_level)?i.parentNode.parentNode:i.parentNode,e(n,i)),i=i.parentNode}}},setPos:function(){var t=this._top,e=this._left,i=this.wrapperOuter.node().getBoundingClientRect();if(t&&(this.wrapperOuter.style("top",t+"px"),this.wrapperOuter.style("bottom","auto"),this.wrapperOuter.classed(p.absPosVert,t)),e){var n=this.element.node().offsetWidth-e-i.width;n=n<10?10:n,this.wrapperOuter.style("right",n+"px"),this.wrapperOuter.style("left","auto"),this.wrapperOuter.classed(p.absPosHoriz,n)}},clearPos:function(){this._top="",this._left="",this.wrapperOuter.attr("style",""),this.wrapperOuter.classed(p.absPosVert,""),this.wrapperOuter.classed(p.absPosHoriz,""),this.wrapperOuter.classed(p.menuOpenLeftSide,""),this.wrapper.style("max-height","")},setHorizontalMenuHeight:function(){var t=null;if(this.menuEntity&&1==this.OPTIONS.MENU_DIRECTION&&this.menuEntity.menuItems.length){var e=parseInt(this.menuEntity.menuItems[0].entity.style("height"),10)||0,i=e*this._maxChildCount,n=Math.max(this.menuEntity.menuItems.length,3)*e+this.menuEntity.entity.node().offsetTop+parseInt(this.wrapper.style("padding-bottom"),10);t=Math.max(i,n)+"px"}this.wrapper.classed(p.noTransition,!0),this.wrapper.node().offsetHeight,this.wrapper.style("height",t),this.wrapper.node().offsetHeight,this.wrapper.classed(p.noTransition,!1)},_enableSearch:function(){var t=this,e=this.wrapper.select("."+p.search),i=function(e){var i={_id:"root",children:[]},n=function(e,i,n){var r=i[n].name;if(!r&&t.translator){r=t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY]+"/"+t._targetModel._type)||t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY])}return r&&r.toLowerCase().indexOf(e.toLowerCase())>=0};return function r(a){for(var o=t.OPTIONS.SUBMENUS,s=0;s<a.length;s++){var l=!1;l=n(e,a,s),l&&i.children.push(a[s]),!l&&a[s][o]&&r(a[s][o])}}(t.dataFiltered.children),i.children=a.unique(i.children,function(t){return t.id}),i},n=!1,r=a.debounce(function(){var r=e.node().value;(n||""!=r)&&(n=""!=r,r.length>=t.OPTIONS.SEARCH_MIN_STR?t.redraw(i(r),!0):t.redraw())},250);e.on("input",r)},_selectIndicator:function(t){this._callback(this._targetProp,t),this.toggle()},redraw:function(t,e){function i(t,e,r){if(e.children){n._maxChildCount=Math.max(n._maxChildCount,e.children.length);var o=r?t:t.append("div").classed(p.list_outer,!0),s=o.append("ul").classed(p.list,!r).classed(p.list_top_level,r).classed("vzb-dialog-scrollable",!0).selectAll("li").data(e.children,function(t){return t.id}).enter().append("li");s.append("span").classed(p.list_item_label,!0).attr("children",function(t){return t.children?"true":null}).attr("type",function(t){return t.type?t.type:null}).on("click",function(t){d3.select(this).attr("children")||(d3.event.stopPropagation(),n._selectIndicator({concept:t.id,key:t.key,dataSource:t.dataSource,use:t.use}))}).append("span").text(function(t){var e="_default"===t.id?n.translator("indicator/_default/"+c):t.name_catalog||t.name||t.id;return e||""===e||a.warn("translation missing: NAME of "+t.id),e||""}),s.classed(p.list_item,!0).classed(p.hasChild,function(t){return t.children}).classed(p.isSpecial,function(t){return t.special}).each(function(t){var e=d3.select(this);if(!t.children){"_default"===t.id&&(t.name=n.translator("indicator/_default/"+c),t.description=n.translator("description/_default/"+c)),t.description||(t.description=u);e.append("div").attr("class",p.menuHorizontal+" "+p.list_outer+" "+p.list_item_leaf).on("click",function(t){n._selectIndicator({concept:t.id,key:t.key,dataSource:t.dataSource,use:t.use})})}if(t.id==n._targetModel[n._targetProp]){var o=void 0;if(n.selectedNode&&r)for(o=n.selectedNode.parentNode,d3.select(n.selectedNode).select("."+p.list_item_leaf).classed("active",!1);!a.hasClass(o,p.list_top_level);)"UL"==o.tagName&&d3.select(o.parentNode).classed("active",!1),o=o.parentNode;if(!n.selectedNode||r){for(o=this.parentNode,d3.select(this).classed("item-active",!0).select("."+p.list_item_leaf).classed("active",!0);!a.hasClass(o,p.list_top_level);)"UL"==o.tagName&&d3.select(o.parentNode).classed("active",!0),"LI"==o.tagName&&d3.select(o).classed("item-active",!0),o=o.parentNode;n.selectedNode=this}}i(e,t)})}}var n=this,r=n._targetModel.isHook(),o=void 0,s=void 0,l={};a.forEach(this.model.marker._root._data,function(t){"data"===t._type&&a.deepExtend(l,t.getConceptprops())});var c=n._targetModel._type;e?o=t:(null==t&&(t=this._tree),r?(s=a.keys(l).filter(function(t){if(n._targetModel.allow&&n._targetModel.allow.names){if(-1!=n._targetModel.allow.names.indexOf("!"+t))return!1;if(-1!=n._targetModel.allow.names.indexOf(t))return!0;if(n._targetModel.allow.namesOnlyThese)return!1}if(!n._targetModel.allow||!n._targetModel.allow.scales)return!0;if("*"==n._targetModel.allow.scales[0])return!0;if(!l[t].scales)return!0;for(var e=l[t].scales.length-1;e>=0;e--)if(n._targetModel.allow.scales.indexOf(l[t].scales[e])>-1)return!0;return!1}),o=a.pruneTree(t,function(t){return s.indexOf(t.id)>-1})):n._targetModel instanceof d.default?(s=t.children.map(function(t){return t.id}),o=a.pruneTree(t,function(t){return"space"==t.type})):(s=a.keys(l),o=a.pruneTree(t,function(t){return s.indexOf(t.id)>-1})),this.dataFiltered=o),this.wrapper.select("ul").remove(),this.element.select("."+p.title).select("span").text(this.translator(n._targetModel instanceof d.default?n._targetModel._root._name+"/"+n._targetModel._name:"buttons/"+(r?n._targetModel._name:c+"/"+n._targetProp))),this.element.select("."+p.search).attr("placeholder",this.translator("placeholder/search")+"..."),this._maxChildCount=0;var u=n.translator("hints/nodescr");if(this.OPTIONS.IS_MOBILE?this.OPTIONS.MENU_DIRECTION=2:this.OPTIONS.MENU_DIRECTION=1,this.selectedNode=null,i(this.wrapper,o,!0),this.menuEntity=new g(null,this.wrapper.selectAll("."+p.list_top_level),this.OPTIONS),this.menuEntity&&this.menuEntity.setDirection(this.OPTIONS.MENU_DIRECTION),this.menuEntity&&this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.setHorizontalMenuHeight(),!e){var h="_default";if(s.indexOf(this._targetModel[n._targetProp])>-1&&(h=this._targetModel[n._targetProp]),l[h]||a.error("Concept properties of "+h+" are missing from the set, or the set is empty. Put a breakpoint here and check what you have in indicatorsDB"),!l[h].scales)return this.element.select("."+p.scaletypes).classed(p.hidden,!0),!0;var f=r?l[h].scales.filter(function(t){return!n._targetModel.allow||!n._targetModel.allow.scales||("*"==n._targetModel.allow.scales[0]||n._targetModel.allow.scales.indexOf(t)>-1)}):[];if(0==f.length)this.element.select("."+p.scaletypes).classed(p.hidden,!0);else{var m=this.element.select("."+p.scaletypes).classed(p.hidden,!1).selectAll("span").data(f,function(t){return t});m.exit().remove(),m=m.enter().append("span").on("click",function(t){d3.event.stopPropagation(),n._setModel("scaleType",t)}).merge(m);var v=n._targetModel.scaleType;m.classed(p.scaletypesDisabled,f.length<2).classed(p.scaletypesActive,function(t){return(t==v||"log"===t&&"genericLog"===v)&&f.length>1}).text(function(t){return n.translator("scaletype/"+t)})}}return this},updateView:function(){if(this._targetModel){this.wrapperOuter.classed(p.absPosVert,this._top),this.wrapperOuter.classed(p.alignYt,"top"===this._alignY),this.wrapperOuter.classed(p.alignYb,"bottom"===this._alignY),this.wrapperOuter.classed(p.absPosHoriz,this._left),this.wrapperOuter.classed(p.alignXl,"left"===this._alignX),this.wrapperOuter.classed(p.alignXr,"right"===this._alignX);var t=this._setModel.bind(this);return this.callback(t).tree(this.indicatorsTree).redraw(),this.wrapper.select("."+p.search).node().value="",this}},focusSearch:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.wrapper.select("."+p.search).node();t?e.focus():e.blur()},_setModel:function(t,e){var i=this._targetModel;"which"==t&&i.setWhich(e),"scaleType"==t&&i.setScaleType(e),"space"==t&&i.setSpace(e.concept.split(","))}});e.default=b},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./_dialog.js":12,"./about/about.js":167,"./axes/axes.js":168,"./colors/colors.js":170,"./dialogs.js":171,"./find/find.js":172,"./find/show.js":112,"./grouping/grouping.js":173,"./label/label.js":174,"./moreoptions/moreoptions.js":175,"./opacity/opacity.js":176,"./presentation/presentation.js":177,"./side/side.js":178,"./size/size.js":179,"./speed/speed.js":180,"./stack/stack.js":181,"./timedisplay/timedisplay.js":183,"./zoom/zoom.js":185};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=427},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./d3.axisWithLabelPicker.js":111,"./d3.collisionResolver.js":429,"./d3.colorPicker.js":165,"./d3.dynamicBackground.js":184,"./d3.genericLogScale.js":157,"./d3.geoProjection.js":430,"./d3.touchEvents.js":158,"./labels.js":431,"./requireAll.js":106,"./svgexport.js":433,"./textEllipsis.js":434,"./topojson.js":435};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=428},function(t,e,i){"use strict";function n(){return function(){function t(t){if(null==n)return void console.warn("D3 collision resolver stopped: missing a CSS slector");if(null==r)return void console.warn("D3 collision resolver stopped: missing height of the canvas");if(null==o)return void console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' ");if(null==h)return void console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' ");i=.8*t.node().getBBox().height;for(var a=t.filter(function(t){return l(t,s)}).sort(function(t,e){return d3.ascending(t.valueY,e.valueY)}).data(),c={},u=0;u<a.length-1;u++){var d=a[u],f=a[u+1];if(d.shiftY||(d.shiftY=0),f.shiftY=0,!(f.valueY-d.valueY-d.shiftY>=i)){var p=0;d.valueY>i&&(0==u?p=Math.min(i,d.valueY):d.valueY-a[u-1].valueY+a[u-1].shiftY>i&&(p=Math.min(i,d.valueY-a[u-1].valueY+a[u-1].shiftY))),d.upperAvailable=p;var m=0;f.valueY<r&&(u==a.length-2?m=Math.min(i,r-f.valueY):a[u+2].valueY-f.valueY>i&&(m=Math.min(i,a[u+2].valueY-f.valueY))),f.underAvailable=m;var g=i-(f.valueY-d.valueY-d.shiftY);c[d[h]]={},c[f[h]]={},p>=g/2&&m>=g/2?(d.shiftY=-g/2,f.shiftY=g/2):p>=g/2?(f.shiftY=m,d.shiftY=-Math.min(p,g-m)):m>=g/2?(d.shiftY-=p,f.shiftY=Math.min(m,g-p)):(d.shiftY=-p,f.shiftY=m),c[d[h]].valueY=d.valueY+d.shiftY,c[f[h]].valueY=f.valueY+f.shiftY}}t.each(function(t,i){c[t[h]]&&c[t[h]].valueY&&d3.select(this).selectAll(n).transition().duration(e).attr("transform","translate(0,"+c[t[h]].valueY+")")})}var e=300,i=0,n=null;t.selector=function(e){return arguments.length?(n=e,t):n};var r=null;t.height=function(e){return arguments.length?(r=e,t):r};var a=d3.scaleLinear().domain([0,1]).range([0,1]);t.scale=function(e){return arguments.length?(a=e,t):a};var o=null;t.value=function(e){return arguments.length?(o=e,t):o};var s=null;t.time=function(e){return arguments.length?(s=e,t):s};var l=function(){return!0};t.filter=function(e){return arguments.length?(l=e,t):l};var c=null;t.fixed=function(e){return arguments.length?(c=e,t):c};var u=null;t.handleResult=function(e){return arguments.length?(u=e,t):u};var h=null;return t.KEY=function(e){return arguments.length?(h=e,t):h},t}()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,i){return{type:"Feature",id:t.id,properties:t.properties,geometry:e(t.geometry,i)}}function e(t,i){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return e(t,i)})};if(!fe.hasOwnProperty(t.type))return null;var n=fe[t.type];return d3.geoUstream(t,i(n)),n.result()}function i(){}function n(t){if((e=t.length)<4)return!1;for(var e,i=0,n=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];++i<e;)n+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return n<=0}function r(t,e){for(var i=e[0],n=e[1],r=!1,a=0,o=t.length,s=o-1;a<o;s=a++){var l=t[a],c=l[0],u=l[1],h=t[s],d=h[0],f=h[1];u>n^f>n&&i<(d-c)*(n-u)/(f-u)+c&&(r=!r)}return r}function a(t){return t?t/Math.sin(t):1}function o(t){return t>0?1:t<0?-1:0}function s(t){return t>1?ve:t<-1?-ve:Math.asin(t)}function l(t){return t>1?0:t<-1?ge:Math.acos(t)}function c(t){return t>0?Math.sqrt(t):0}function u(t){function e(t,e){var i=Math.cos(t),r=Math.cos(e),a=Math.sin(e),o=r*i,s=-((1-o?Math.log(.5*(1+o))/(1-o):-.5)+n/(1+o));return[s*r*Math.sin(t),s*a]}var i=Math.tan(.5*t),n=2*Math.log(Math.cos(.5*t))/(i*i);return e.invert=function(e,i){var r,a=Math.sqrt(e*e+i*i),o=-.5*t,l=50;if(!a)return[0,0];do{var c=.5*o,u=Math.cos(c),h=Math.sin(c),d=Math.tan(c),f=Math.log(1/u);o-=r=(2/d*f-n*d-a)/(-f/(h*h)+1-n/(2*u*u))}while(Math.abs(r)>pe&&--l>0);var p=Math.sin(o);return[Math.atan2(e*p,a*Math.cos(o)),s(i*p/a)]},e}function h(){var t=ve,e=we(u),i=e(t);return i.radius=function(i){return arguments.length?e(t=i*ge/180):t/ge*180},i}function d(t,e){var i=Math.cos(e),n=a(l(i*Math.cos(t/=2)));return[2*i*Math.sin(t)*n,Math.sin(e)*n]}function f(t){function e(t,e){var s=Math.cos(e),l=Math.cos(t/=2);return[(1+s)*Math.sin(t),(r*e>-Math.atan2(l,a)-.001?0:10*-r)+o+Math.sin(e)*n-(1+s)*i*l]}var i=Math.sin(t),n=Math.cos(t),r=t>0?1:-1,a=Math.tan(r*t),o=(1+i-n)/2;return e.invert=function(t,e){var s=0,l=0,c=50;do{var u=Math.cos(s),h=Math.sin(s),d=Math.cos(l),f=Math.sin(l),p=1+d,m=p*h-t,g=o+f*n-p*i*u-e,v=.5*p*u,b=-h*f,y=.5*i*p*h,_=n*d+i*u*f,x=b*y-_*v,w=.5*(g*b-m*_)/x,S=(m*y-g*v)/x;s-=w,l-=S}while((Math.abs(w)>pe||Math.abs(S)>pe)&&--c>0);return r*l>-Math.atan2(Math.cos(s),a)-.001?[2*s,l]:null},e}function p(){var t=ge/9,e=t>0?1:-1,i=Math.tan(e*t),n=we(f),r=n(t),a=r.stream;return r.parallel=function(r){return arguments.length?(i=Math.tan((e=(t=r*ge/180)>0?1:-1)*t),n(t)):t/ge*180},r.stream=function(n){var o=r.rotate(),s=a(n),l=(r.rotate([0,0]),a(n));return r.rotate(o),s.sphere=function(){l.polygonStart(),l.lineStart();for(var n=-180*e;e*n<180;n+=90*e)l.point(n,90*e);for(;e*(n-=t)>=-180;)l.point(n,e*-Math.atan2(Math.cos(n*ye/2),i)*_e);l.lineEnd(),l.polygonEnd()},s},r}function m(t){return((t=Math.exp(2*t))-1)/(t+1)}function g(t){return.5*(Math.exp(t)-Math.exp(-t))}function v(t){return.5*(Math.exp(t)+Math.exp(-t))}function b(t){return Math.log(t+c(t*t+1))}function y(t){return Math.log(t+c(t*t-1))}function _(t,e){var i=Math.tan(e/2),n=c(1-i*i),r=1+n*Math.cos(t/=2),a=Math.sin(t)*n/r,o=i/r,s=a*a,l=o*o;return[4/3*a*(3+s-3*l),4/3*o*(3+3*s-l)]}function x(t,e){var i=Math.abs(e);return i<ge/4?[t,Math.log(Math.tan(ge/4+e/2))]:[t*Math.cos(i)*(2*Math.SQRT2-1/Math.sin(i)),o(e)*(2*Math.SQRT2*(i-ge/4)-Math.log(Math.tan(i/2)))]}function w(t){function e(t,e){var n=Me(t,e);if(Math.abs(t)>ve){var r=Math.atan2(n[1],n[0]),a=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=i*Math.round((r-ve)/i)+ve,l=Math.atan2(Math.sin(r-=o),2-Math.cos(r));r=o+s(ge/a*Math.sin(l))-l,n[0]=a*Math.cos(r),n[1]=a*Math.sin(r)}return n}var i=2*ge/t;return e.invert=function(t,e){var n=Math.sqrt(t*t+e*e);if(n>ve){var r=Math.atan2(e,t),a=i*Math.round((r-ve)/i)+ve,o=r>a?-1:1,s=n*Math.cos(a-r),l=1/Math.tan(o*Math.acos((s-ge)/Math.sqrt(ge*(ge-2*s)+n*n)));r=a+2*Math.atan((l+o*Math.sqrt(l*l-3))/3),t=n*Math.cos(r),e=n*Math.sin(r)}return Me.invert(t,e)},e}function S(){var t=5,e=we(w),i=e(t),n=i.stream,r=.01,a=-Math.cos(r*ye),o=Math.sin(r*ye);return i.lobes=function(i){return arguments.length?e(t=+i):t},i.stream=function(e){var l=i.rotate(),c=n(e),u=(i.rotate([0,0]),n(e));return i.rotate(l),c.sphere=function(){u.polygonStart(),u.lineStart();for(var e=0,i=360/t,n=2*ge/t,l=90-180/t,c=ve;e<t;++e,l-=i,c-=n)u.point(Math.atan2(o*Math.cos(c),a)*_e,s(o*Math.sin(c))*_e),l<-90?(u.point(-90,-180-l-r),u.point(-90,-180-l+r)):(u.point(90,l+r),u.point(90,l-r));u.lineEnd(),u.polygonEnd()},c},i}function M(t){return function(e){var i,n=t*Math.sin(e),r=30;do{e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e))}while(Math.abs(i)>pe&&--r>0);return e/2}}function k(t,e,i){function n(i,n){return[t*i*Math.cos(n=r(n)),e*Math.sin(n)]}var r=M(i);return n.invert=function(n,r){var a=s(r/e);return[n/(t*Math.cos(a)),s((2*a+Math.sin(2*a))/i)]},n}function E(t,e){var i=2.00276,n=ke(e);return[i*t/(1/Math.cos(e)+1.11072/Math.cos(n)),(e+Math.SQRT2*Math.sin(n))/i]}function z(t){var e=0,i=we(t),n=i(e);return n.parallel=function(t){return arguments.length?i(e=t*ge/180):e/ge*180},n}function O(t,e){return[t*Math.cos(e),e]}function T(t){function e(e,n){var r=i+t-n,a=r?e*Math.cos(n)/r:r;return[r*Math.sin(a),i-r*Math.cos(a)]}if(!t)return O;var i=1/Math.tan(t);return e.invert=function(e,n){var r=Math.sqrt(e*e+(n=i-n)*n),a=i+t-r;return[r/Math.cos(a)*Math.atan2(e,n),a]},e}function C(t){function e(e,i){for(var n=Math.sin(i),r=Math.cos(i),a=new Array(3),c=0;c<3;++c){var u=t[c];if(a[c]=D(i-u[1],u[3],u[2],r,n,e-u[0]),!a[c][0])return u.point;a[c][1]=I(a[c][1]-u.v[1])}for(var h=l.slice(),c=0;c<3;++c){var d=2==c?0:c+1,f=A(t[c].v[0],a[c][0],a[d][0]);a[c][1]<0&&(f=-f),c?1==c?(f=o-f,h[0]-=a[c][0]*Math.cos(f),h[1]-=a[c][0]*Math.sin(f)):(f=s-f,h[0]+=a[c][0]*Math.cos(f),h[1]+=a[c][0]*Math.sin(f)):(h[0]+=a[c][0]*Math.cos(f),h[1]-=a[c][0]*Math.sin(f))}return h[0]/=3,h[1]/=3,h}t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]});for(var i,n=t[2],r=0;r<3;++r,n=i)i=t[r],n.v=D(i[1]-n[1],n[3],n[2],i[3],i[2],i[0]-n[0]),n.point=[0,0];var a=A(t[0].v[0],t[2].v[0],t[1].v[0]),o=A(t[0].v[0],t[1].v[0],t[2].v[0]),s=ge-a;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var l=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(a),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(a))];return e}function P(){var t=[[0,0],[0,0],[0,0]],e=we(C),i=e(t),n=i.rotate;return delete i.rotate,i.points=function(r){if(!arguments.length)return t;t=r;var a=d3.geoCentroid({type:"MultiPoint",coordinates:t}),o=[-a[0],-a[1]];return n.call(i,o),e(t.map(d3.geoRotation(o)).map(L))},i.points([[-150,55],[-35,55],[-92.5,10]])}function D(t,e,i,n,r,a){var o,c=Math.cos(a);if(Math.abs(t)>1||Math.abs(a)>1)o=l(i*r+e*n*c);else{var u=Math.sin(.5*t),h=Math.sin(.5*a);o=2*s(Math.sqrt(u*u+e*n*h*h))}return Math.abs(o)>pe?[o,Math.atan2(n*Math.sin(a),e*r-i*n*c)]:[0,0]}function A(t,e,i){return l(.5*(t*t+e*e-i*i)/(t*e))}function I(t){return t-2*ge*Math.floor((t+ge)/(2*ge))}function L(t){return[t[0]*ye,t[1]*ye]}function j(t,e){var i=c(1-Math.sin(e));return[2/be*t*i,be*(1-i)]}function R(t){function e(t,e){return[t,(t?t/Math.sin(t):1)*(Math.sin(e)*Math.cos(t)-i*Math.cos(e))]}var i=Math.tan(t);return e.invert=i?function(t,e){t&&(e*=Math.sin(t)/t);var n=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(n*n+i*i-e*e)-n,i-e)]}:function(t,e){return[t,s(t?e*Math.tan(t)/t:e)]},e}function F(t,e){var i=Math.sqrt(3);return[i*t*(2*Math.cos(2*e/3)-1)/be,i*be*Math.sin(e/3)]}function N(t){function e(t,e){return[t*i,Math.sin(e)/i]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,s(e*i)]},e}function B(t){function e(t,e){return[t*i,(1+i)*Math.tan(.5*e)]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,2*Math.atan(e/(1+i))]},e}function H(t,e){var i=Math.sqrt(8/(3*ge));return[i*t*(1-Math.abs(e)/ge),i*e]}function q(t,e){var i=Math.sqrt(4-3*Math.sin(Math.abs(e)));return[2/Math.sqrt(6*ge)*t*i,o(e)*Math.sqrt(2*ge/3)*(2-i)]}function K(t,e){var i=Math.sqrt(ge*(4+ge));return[2/i*t*(1+Math.sqrt(1-4*e*e/(ge*ge))),4/i*e]}function V(t,e){var i=(2+ve)*Math.sin(e);e/=2;for(var n=0,r=1/0;n<10&&Math.abs(r)>pe;n++){var a=Math.cos(e);e-=r=(e+Math.sin(e)*(a+2)-i)/(2*a*(1+a))}return[2/Math.sqrt(ge*(4+ge))*t*(1+Math.cos(e)),2*Math.sqrt(ge/(4+ge))*Math.sin(e)]}function Y(t,e){return[t*(1+Math.cos(e))/Math.sqrt(2+ge),2*e/Math.sqrt(2+ge)]}function W(t,e){for(var i=(1+ve)*Math.sin(e),n=0,r=1/0;n<10&&Math.abs(r)>pe;n++)e-=r=(e+Math.sin(e)-i)/(1+Math.cos(e));return i=Math.sqrt(2+ge),[t*(1+Math.cos(e))/i,2*e/i]}function X(t,e){var i=Math.sin(t/=2),n=Math.cos(t),r=Math.sqrt(Math.cos(e)),a=Math.cos(e/=2),o=Math.sin(e)/(a+Math.SQRT2*n*r),s=Math.sqrt(2/(1+o*o)),l=Math.sqrt((Math.SQRT2*a+(n+i)*r)/(Math.SQRT2*a+(n-i)*r));return[Oe*(s*(l-1/l)-2*Math.log(l)),Oe*(s*o*(l+1/l)-2*Math.atan(o))]}function U(t,e){var i=Math.tan(e/2);return[t*Te*c(1-i*i),(1+Te)*i]}function G(t,e){var i=e/2,n=Math.cos(i);return[2*t/be*Math.cos(e)*n*n,be*Math.tan(i)]}function Q(t,e){function i(e,i){var a=Ce(e,i),o=a[0],s=a[1],l=o*o+s*s;if(l>r){var c=Math.sqrt(l),u=Math.atan2(s,o),h=n*Math.round(u/n),d=u-h,f=t*Math.cos(d),p=(t*Math.sin(d)-d*Math.sin(f))/(ve-f),m=$(d,p),g=(ge-t)/J(m,f,ge);o=c;var v,b=50;do{o-=v=(t+J(m,f,o)*g-c)/(m(o)*g)}while(Math.abs(v)>pe&&--b>0);s=d*Math.sin(o),o<ve&&(s-=p*(o-ve));var y=Math.sin(h),_=Math.cos(h);a[0]=o*_-s*y,a[1]=o*y+s*_}return a}var n=2*ge/e,r=t*t;return i.invert=function(e,i){var a=e*e+i*i;if(a>r){var o=Math.sqrt(a),s=Math.atan2(i,e),l=n*Math.round(s/n),c=s-l,e=o*Math.cos(c);i=o*Math.sin(c);for(var u=e-ve,h=Math.sin(e),d=i/h,f=e<ve?1/0:0,p=10;;){var m=t*Math.sin(d),g=t*Math.cos(d),v=Math.sin(g),b=ve-g,y=(m-d*v)/b,_=$(d,y);if(Math.abs(f)<me||!--p)break;d-=f=(d*h-y*u-i)/(h-2*u*(b*(g+d*m*Math.cos(g)-v)-m*(m-d*v))/(b*b))}o=t+J(_,g,e)*(ge-t)/J(_,g,ge),s=l+d,e=o*Math.cos(s),i=o*Math.sin(s)}return Ce.invert(e,i)},i}function $(t,e){return function(i){var n=t*Math.cos(i);return i<ve&&(n-=e),Math.sqrt(1+n*n)}}function Z(){var t=6,e=30*ye,i=Math.cos(e),n=Math.sin(e),r=we(Q),a=r(e,t),o=a.stream,s=-Math.cos(.01*ye),l=Math.sin(.01*ye);return a.radius=function(a){return arguments.length?(i=Math.cos(e=a*ye),n=Math.sin(e),r(e,t)):e*_e},a.lobes=function(i){return arguments.length?r(e,t=+i):t},a.stream=function(e){var r=a.rotate(),c=o(e),u=(a.rotate([0,0]),o(e));return a.rotate(r),c.sphere=function(){u.polygonStart(),u.lineStart();for(var e=0,r=2*ge/t,a=0;e<t;++e,a-=r)u.point(Math.atan2(l*Math.cos(a),s)*_e,Math.asin(l*Math.sin(a))*_e),u.point(Math.atan2(n*Math.cos(a-r/2),i)*_e,Math.asin(n*Math.sin(a-r/2))*_e);u.lineEnd(),u.polygonEnd()},c},a}function J(t,e,i){for(var n=(i-e)/50,r=t(e)+t(i),a=1,o=e;a<50;++a)r+=2*t(o+=n);return.5*r*n}function tt(t,e,i,n,r,a,o,s){function l(l,c){if(!c)return[t*l/ge,0];var u=c*c,h=t+u*(e+u*(i+u*n)),d=c*(r-1+u*(a-s+u*o)),f=(h*h+d*d)/(2*d),p=l*Math.asin(h/f)/ge;return[f*Math.sin(p),c*(1+u*s)+f*(1-Math.cos(p))]}return arguments.length<8&&(s=0),l.invert=function(l,u){var h,d,f=ge*l/t,p=u,m=50;do{var g=p*p,v=t+g*(e+g*(i+g*n)),b=p*(r-1+g*(a-s+g*o)),y=v*v+b*b,_=2*b,x=y/_,w=x*x,S=Math.asin(v/x)/ge,M=f*S;if(xB2=v*v,dxBdÏ†=(2*e+g*(4*i+6*g*n))*p,dyBdÏ†=r+g*(3*a+5*g*o),dpdÏ†=2*(v*dxBdÏ†+b*(dyBdÏ†-1)),dqdÏ†=2*(dyBdÏ†-1),dmdÏ†=(dpdÏ†*_-y*dqdÏ†)/(_*_),cosÎ±=Math.cos(M),sinÎ±=Math.sin(M),mcosÎ±=x*cosÎ±,msinÎ±=x*sinÎ±,dÎ±dÏ†=f/ge*(1/c(1-xB2/w))*(dxBdÏ†*x-v*dmdÏ†)/w,fx=msinÎ±-l,fy=p*(1+g*s)+x-mcosÎ±-u,Î´xÎ´Ï†=dmdÏ†*sinÎ±+mcosÎ±*dÎ±dÏ†,Î´xÎ´Î»=mcosÎ±*S,Î´yÎ´Ï†=1+dmdÏ†-(dmdÏ†*cosÎ±-msinÎ±*dÎ±dÏ†),Î´yÎ´Î»=msinÎ±*S,denominator=Î´xÎ´Ï†*Î´yÎ´Î»-Î´yÎ´Ï†*Î´xÎ´Î»,!denominator)break;f-=h=(fy*Î´xÎ´Ï†-fx*Î´yÎ´Ï†)/denominator,p-=d=(fx*Î´yÎ´Î»-fy*Î´xÎ´Î»)/denominator}while((Math.abs(h)>pe||Math.abs(d)>pe)&&--m>0);return[f,p]},l}function et(t,e){var i=t*t,n=e*e;return[t*(1-.162388*n)*(.87-952426e-9*i*i),e*(1+n/12)]}function it(t){function e(){var t=!1,e=we(i),n=e(t);return n.quincuncial=function(i){return arguments.length?e(t=!!i):t},n}function i(e){var i=e?function(e,i){var r=Math.abs(e)<ve,a=t(r?e:e>0?e-ge:e+ge,i),s=(a[0]-a[1])*Math.SQRT1_2,l=(a[0]+a[1])*Math.SQRT1_2;if(r)return[s,l];var c=n*Math.SQRT1_2,u=s>0^l>0?-1:1;return[u*s-o(l)*c,u*l-o(s)*c]}:function(e,i){var r=e>0?-.5:.5,a=t(e+r*ge,i);return a[0]-=r*n,a};return t.invert&&(i.invert=e?function(e,i){var r=(e+i)*Math.SQRT1_2,a=(i-e)*Math.SQRT1_2,o=Math.abs(r)<.5*n&&Math.abs(a)<.5*n;if(!o){var s=n*Math.SQRT1_2,l=r>0^a>0?-1:1,c=-l*(e+(a>0?1:-1)*s),u=-l*(i+(r>0?1:-1)*s);r=(-c-u)*Math.SQRT1_2,a=(c-u)*Math.SQRT1_2}var h=t.invert(r,a);return o||(h[0]+=r>0?ge:-ge),h}:function(e,i){var r=e>0?-.5:.5,a=t.invert(e+r*n,i),o=a[0]-r*ge;return o<-ge?o+=2*ge:o>ge&&(o-=2*ge),a[0]=o,a}),i}var n=t(ve,0)[0]-t(-ve,0)[0];return e.raw=i,e}function nt(t,e){var i=o(t),n=o(e),r=Math.cos(e),a=Math.cos(t)*r,l=Math.sin(t)*r,c=Math.sin(n*e);t=Math.abs(Math.atan2(l,c)),e=s(a),Math.abs(t-ve)>pe&&(t%=ve);var u=rt(t>ge/4?ve-t:t,e);return t>ge/4&&(c=u[0],u[0]=-u[1],u[1]=-c),u[0]*=i,u[1]*=-n,u}function rt(t,e){if(e===ve)return[0,0];var i=Math.sin(e),n=i*i,r=n*n,a=1+r,o=1+3*r,l=1-r,u=s(1/Math.sqrt(a)),h=l+n*a*u,d=(1-i)/h,f=Math.sqrt(d),p=d*a,m=Math.sqrt(p),g=f*l;if(0===t)return[0,-(g+n*m)];var v=Math.cos(e),b=1/v,y=2*i*v,_=(-3*n+u*o)*y,x=(-h*v-(1-i)*_)/(h*h),w=.5*x/f,S=l*w-2*n*f*y,M=n*a*x+d*o*y,k=-b*y,E=-b*M,z=-2*b*S,O=4*t/ge;if(t>.222*ge||e<ge/4&&t>.175*ge){var T=(g+n*c(p*(1+r)-g*g))/(1+r);if(t>ge/4)return[T,T];var C=T,P=.5*T,D=50;T=.5*(P+C);do{var A=Math.sqrt(p-T*T),I=T*(z+k*A)+E*s(T/m)-O;if(!I)break;I<0?P=T:C=T,T=.5*(P+C)}while(Math.abs(C-P)>pe&&--D>0)}else{var L,T=pe,D=25;do{var j=T*T,A=c(p-j),R=z+k*A,I=T*R+E*s(T/m)-O,F=R+(E-k*j)/A;T-=L=A?I/F:0}while(Math.abs(L)>pe&&--D>0)}return[T,-g-n*c(p-T*T)]}function at(t,e){for(var i=0,n=1,r=.5,a=50;;){var o=r*r,s=Math.sqrt(r),l=Math.asin(1/Math.sqrt(1+o)),c=1-o+r*(1+o)*l,u=(1-s)/c,h=Math.sqrt(u),d=u*(1+o),f=h*(1-o),p=d-t*t,m=Math.sqrt(p),g=e+f+r*m;if(Math.abs(n-i)<me||0==--a||0===g)break;g>0?i=r:n=r,r=.5*(i+n)}if(!a)return null;var v=Math.asin(s),b=Math.cos(v),y=1/b,_=2*s*b,x=(-3*r+l*(1+3*o))*_,w=(-c*b-(1-s)*x)/(c*c);return[ge/4*(t*(-2*y*(.5*w/h*(1-o)-2*r*h*_)+-y*_*m)+-y*(r*(1+o)*w+u*(1+3*o)*_)*Math.asin(t/Math.sqrt(d))),v]}function ot(t,e,i){if(!t){var n=st(e,1-i);return[[0,n[0]/n[1]],[1/n[1],0],[n[2]/n[1],0]]}var r=st(t,i);if(!e)return[[r[0],0],[r[1],0],[r[2],0]];var n=st(e,1-i),a=n[1]*n[1]+i*r[0]*r[0]*n[0]*n[0];return[[r[0]*n[2]/a,r[1]*r[2]*n[0]*n[1]/a],[r[1]*n[1]/a,-r[0]*r[2]*n[0]*n[2]/a],[r[2]*n[1]*n[2]/a,-i*r[0]*r[1]*n[0]/a]]}function st(t,e){var i,n,r,a,o;if(e<pe)return a=Math.sin(t),n=Math.cos(t),i=.25*e*(t-a*n),[a-i*n,n+i*a,1-.5*e*a*a,t-i];if(e>=1-pe)return i=.25*(1-e),n=v(t),a=m(t),r=1/n,o=n*g(t),[a+i*(o-t)/(n*n),r-i*a*r*(o-t),r+i*a*r*(o+t),2*Math.atan(Math.exp(t))-ve+i*(o-t)/n];var l=[1,0,0,0,0,0,0,0,0],u=[Math.sqrt(e),0,0,0,0,0,0,0,0],h=0;for(n=Math.sqrt(1-e),o=1;Math.abs(u[h]/l[h])>pe&&h<8;)i=l[h++],u[h]=.5*(i-n),l[h]=.5*(i+n),n=c(i*n),o*=2;r=o*l[h]*t;do{a=u[h]*Math.sin(n=r)/l[h],r=.5*(s(a)+r)}while(--h);return[Math.sin(r),a=Math.cos(r),a/Math.cos(r-n),r]}function lt(t,e,i){var n=Math.abs(t),r=Math.abs(e),a=g(r);if(n){var s=1/Math.sin(n),l=1/(Math.tan(n)*Math.tan(n)),u=-(l+i*a*a*s*s-1+i),h=(i-1)*l,d=.5*(-u+Math.sqrt(u*u-4*h));return[ct(Math.atan(1/Math.sqrt(d)),i)*o(t),ct(Math.atan(c((d/l-1)/i)),1-i)*o(e)]}return[0,ct(Math.atan(a),1-i)*o(e)]}function ct(t,e){if(!e)return t;if(1===e)return Math.log(Math.tan(t/2+ge/4));for(var i=1,n=Math.sqrt(1-e),r=Math.sqrt(e),a=0;Math.abs(r)>pe;a++){if(t%ge){var o=Math.atan(n*Math.tan(t)/i);o<0&&(o+=ge),t+=o+~~(t/ge)*ge}else t+=t;r=(i+n)/2,n=Math.sqrt(i*n),r=((i=r)-n)/2}return t/(Math.pow(2,a)*i)}function ut(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),r=ct(ve,n*n),a=Math.log(Math.tan(ge/4+Math.abs(e)/2)),o=Math.exp(-1*a)/Math.sqrt(i),s=ht(o*Math.cos(-1*t),o*Math.sin(-1*t)),l=lt(s[0],s[1],n*n);return[-l[1],(e>=0?1:-1)*(.5*r-l[0])]}function ht(t,e){var i=t*t,n=e+1,r=1-i-e*e;return[.5*((t>=0?ve:-ve)-Math.atan2(r,2*t)),-.25*Math.log(r*r+4*i)+.5*Math.log(n*n+i)]}function dt(t,e){var i=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/i,(t[1]*e[0]-t[0]*e[1])/i]}function ft(t){function e(t,e){var a=r(t,e);t=a[0],e=a[1];var o=Math.sin(e),s=Math.cos(e),c=Math.cos(t),u=l(i*o+n*s*c),h=Math.sin(u),d=Math.abs(h)>pe?u/h:1;return[d*n*Math.sin(t),(Math.abs(t)>ve?d:-d)*(i*s-n*o*c)]}var i=Math.sin(t),n=Math.cos(t),r=pt(t);return r.invert=pt(-t),e.invert=function(t,e){var n=Math.sqrt(t*t+e*e),a=-Math.sin(n),o=Math.cos(n),s=n*o,l=-e*a,u=n*i,h=c(s*s+l*l-u*u),d=Math.atan2(s*u+l*h,l*u-s*h),f=(n>ve?-1:1)*Math.atan2(t*a,n*Math.cos(d)*o+e*Math.sin(d)*a);return r.invert(f,d)},e}function pt(t){var e=Math.sin(t),i=Math.cos(t);return function(t,n){var r=Math.cos(n),a=Math.cos(t)*r,o=Math.sin(t)*r,l=Math.sin(n);return[Math.atan2(o,a*i-l*e),s(l*i+a*e)]}}function mt(){var t=0,e=we(ft),i=e(t),n=i.rotate,r=i.stream,a=d3.geoCircle();return i.parallel=function(n){if(!arguments.length)return t/ge*180;var r=i.rotate();return e(t=n*ge/180).rotate(r)},i.rotate=function(e){return arguments.length?(n.call(i,[e[0],e[1]-t/ge*180]),a.center([-e[0],-e[1]]),i):(e=n.call(i),e[1]+=t/ge*180,e)},i.stream=function(t){return t=r(t),t.sphere=function(){t.polygonStart();var e,i=a.radius(89.99)().coordinates[0],n=i.length-1,r=-1;for(t.lineStart();++r<n;)t.point((e=i[r])[0],e[1]);for(t.lineEnd(),i=a.radius(90.01)().coordinates[0],n=i.length-1,t.lineStart();--r>=0;)t.point((e=i[r])[0],e[1]);t.lineEnd(),t.polygonEnd()},t},i}function gt(t,e){function i(i,n){var r=Le(i/e,n);return r[0]*=t,r}return arguments.length<2&&(e=t),1===e?Le:e===1/0?bt:(i.invert=function(i,n){var r=Le.invert(i/t,n);return r[0]*=e,r},i)}function vt(){var t=2,e=we(gt),i=e(t);return i.coefficient=function(i){return arguments.length?e(t=+i):t},i}function bt(t,e){return[t*Math.cos(e)/Math.cos(e/=2),2*Math.sin(e)]}function yt(t,e){for(var i,n=Math.sin(e)*(e<0?2.43763:2.67595),r=0;r<20&&(e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e)),!(Math.abs(i)<pe));r++);return[.85*t*Math.cos(e*=.5),Math.sin(e)*(e<0?1.93052:1.75859)]}function _t(t){function e(e,u){var h,d=Math.abs(u);if(d>n){var f=Math.min(t-1,Math.max(0,Math.floor((e+ge)/c)));e+=ge*(t-1)/t-f*c,h=d3.geoCollignon.raw(e,d),h[0]=h[0]*r/a-r*(t-1)/(2*t)+f*r/t,h[1]=o+4*(h[1]-s)*l/r,u<0&&(h[1]=-h[1])}else h=i(e,u);return h[0]/=2,h}var i=d3.geoCylindricalEqualArea.raw(0),n=je*ge/180,r=2*ge,a=d3.geoCollignon.raw(ge,n)[0]-d3.geoCollignon.raw(-ge,n)[0],o=i(0,n)[1],s=d3.geoCollignon.raw(0,n)[1],l=d3.geoCollignon.raw(0,ve)[1]-s,c=2*ge/t;return e.invert=function(e,n){e*=2;var u=Math.abs(n);if(u>o){var h=Math.min(t-1,Math.max(0,Math.floor((e+ge)/c)));e=(e+ge*(t-1)/t-h*c)*a/r;var d=d3.geoCollignon.raw.invert(e,.25*(u-o)*r/l+s);return d[0]-=ge*(t-1)/t-h*c,n<0&&(d[1]=-d[1]),d}return i.invert(e,n)},e}function xt(){function t(){var t=180/e;return{type:"Polygon",coordinates:[d3.range(-180,180+t/2,t).map(function(t,e){return[t,1&e?90-1e-6:je]}).concat(d3.range(180,-180-t/2,-t).map(function(t,e){return[t,1&e?1e-6-90:-je]}))]}}var e=2,i=we(_t),n=i(e),r=n.stream;return n.lobes=function(t){return arguments.length?i(e=+t):e},n.stream=function(e){var i=n.rotate(),a=r(e),o=(n.rotate([0,0]),r(e));return n.rotate(i),a.sphere=function(){d3.geoStream(t(),o)},a},n}function wt(t){function e(e,r){var s,l,d=1-Math.sin(r);if(d&&d<2){var f,p=ve-r,m=25;do{var g=Math.sin(p),v=Math.cos(p),b=a+Math.atan2(g,n-v),y=1+h-2*n*v;p-=f=(p-u*a-n*g+y*b-.5*d*i)/(2*n*g*b)}while(Math.abs(f)>me&&--m>0);s=o*Math.sqrt(y),l=e*b/ge}else s=o*(t+d),l=e*a/ge;return[s*Math.sin(l),c-s*Math.cos(l)]}var i,n=1+t,r=Math.sin(1/n),a=s(r),o=2*Math.sqrt(ge/(i=ge+4*a*n)),c=.5*o*(n+Math.sqrt(t*(2+t))),u=t*t,h=n*n;return e.invert=function(t,e){var r=t*t+(e-=c)*e,d=(1+h-r/(o*o))/(2*n),f=l(d),p=Math.sin(f),m=a+Math.atan2(p,n-d);return[s(t/Math.sqrt(r))*ge/m,s(1-2*(f-u*a-n*p+(1+h-2*n*d)*m)/i)]},e}function St(){var t=1,e=we(wt),i=e(t);return i.ratio=function(i){return arguments.length?e(t=+i):t},i}function Mt(t,e){return e>-Re?(t=Ee(t,e),t[1]+=Fe,t):O(t,e)}function kt(t,e){return Math.abs(e)>Re?(t=Ee(t,e),t[1]-=e>0?Fe:-Fe,t):O(t,e)}function Et(t,e){return[3*t/(2*ge)*Math.sqrt(ge*ge/3-e*e),e]}function zt(t){function e(e,i){if(Math.abs(Math.abs(i)-ve)<pe)return[0,i<0?-2:2];var n=Math.sin(i),r=Math.pow((1+n)/(1-n),t/2),a=.5*(r+1/r)+Math.cos(e*=t);return[2*Math.sin(e)/a,(r-1/r)/a]}return e.invert=function(e,i){var n=Math.abs(i);if(Math.abs(n-2)<pe)return e?null:[0,o(i)*ve];if(n>2)return null;e/=2,i/=2;var r=e*e,a=i*i,l=2*i/(1+r+a);return l=Math.pow((1+l)/(1-l),1/t),[Math.atan2(2*e,1-r-a)/t,s((l-1)/(l+1))]},e}function Ot(){var t=.5,e=we(zt),i=e(t);return i.spacing=function(i){return arguments.length?e(t=+i):t},i}function Tt(t,e){return[t*(1+Math.sqrt(Math.cos(e)))/2,e/(Math.cos(e/2)*Math.cos(t/6))]}function Ct(t,e){var i=t*t,n=e*e;return[t*(.975534+n*(-.0143059*i-.119161+-.0547009*n)),e*(1.00384+i*(.0802894+-.02855*n+199025e-9*i)+n*(.0998909+-.0491032*n))]}function Pt(t,e){return[Math.sin(t)/Math.cos(e),Math.tan(e)*Math.cos(t)]}function Dt(t){function e(e,r){var a=r-t,o=Math.abs(a)<pe?e*i:Math.abs(o=ge/4+r/2)<pe||Math.abs(Math.abs(o)-ve)<pe?0:e*a/Math.log(Math.tan(o)/n);return[o,a]}var i=Math.cos(t),n=Math.tan(ge/4+t/2);return e.invert=function(e,r){var a,o=r+t;return[Math.abs(r)<pe?e/i:Math.abs(a=ge/4+o/2)<pe||Math.abs(Math.abs(a)-ve)<pe?0:e*Math.log(Math.tan(a)/n)/r,o]},e}function At(t,e){return[t,1.25*Math.log(Math.tan(ge/4+.4*e))]}function It(t){function e(e,n){for(var r,a=Math.cos(n),o=2/(1+a*Math.cos(e)),s=o*a*Math.sin(e),l=o*Math.sin(n),c=i,u=t[c],h=u[0],d=u[1];--c>=0;)u=t[c],h=u[0]+s*(r=h)-l*d,d=u[1]+s*d+l*r;return h=s*(r=h)-l*d,d=s*d+l*r,[h,d]}var i=t.length-1;return e.invert=function(e,n){var r=20,a=e,o=n;do{for(var l,c=i,u=t[c],h=u[0],d=u[1],f=0,p=0;--c>=0;)u=t[c],f=h+a*(l=f)-o*p,p=d+a*p+o*l,h=u[0]+a*(l=h)-o*d,d=u[1]+a*d+o*l;f=h+a*(l=f)-o*p,p=d+a*p+o*l,h=a*(l=h)-o*d-e,d=a*d+o*l-n;var m,g,v=f*f+p*p;a-=m=(h*f+d*p)/v,o-=g=(d*f-h*p)/v}while(Math.abs(m)+Math.abs(g)>pe*pe&&--r>0);if(r){var b=Math.sqrt(a*a+o*o),y=2*Math.atan(.5*b),_=Math.sin(y);return[Math.atan2(a*_,b*Math.cos(y)),b?s(o*_/b):0]}},e}function Lt(){var t=Ne.miller,e=we(It),i=e(t);return i.coefficients=function(i){return arguments.length?e(t="string"==typeof i?Ne[i]:i):t},i}function jt(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),r=Math.asin(7*Math.sin(e)/(3*i));return[i*t*(2*Math.cos(2*r/3)-1)/n,9*Math.sin(r/3)/n]}function Rt(t,e){for(var i,n=(1+Math.SQRT1_2)*Math.sin(e),r=e,a=0;a<25&&(r-=i=(Math.sin(r/2)+Math.sin(r)-n)/(.5*Math.cos(r/2)+Math.cos(r)),!(Math.abs(i)<pe));a++);return[t*(1+2*Math.cos(r)/Math.cos(r/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(r/2)/Math.sqrt(2+Math.SQRT2)]}function Ft(t,e){for(var i,n=Math.sqrt(6/(4+ge)),r=(1+ge/4)*Math.sin(e),a=e/2,o=0;o<25&&(a-=i=(a/2+Math.sin(a)-r)/(.5+Math.cos(a)),!(Math.abs(i)<pe));o++);return[n*(.5+Math.cos(a))*t/1.5,n*a]}function Nt(t,e){var i=e*e,n=i*i;return[t*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791)),e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))]}function Bt(t,e){return[t*(1+Math.cos(e))/2,2*(e-Math.tan(e/2))]}function Ht(t,e){var i=e*e;return[t,e*(Be+i*i*(He+i*(qe+Ke*i)))]}function qt(t,e){if(Math.abs(e)<pe)return[t,0];var i=Math.tan(e),n=t*Math.sin(e);return[Math.sin(n)/i,e+(1-Math.cos(n))/i]}function Kt(t){function e(e,n){var r=i?Math.tan(e*i/2)/i:e/2;if(!n)return[2*r,-t];var a=2*Math.atan(r*Math.sin(n)),o=1/Math.tan(n);return[Math.sin(a)*o,n+(1-Math.cos(a))*o-t]}var i=Math.sin(t);return e.invert=function(e,n){if(Math.abs(n+=t)<pe)return[i?2*Math.atan(i*e/2)/i:e,0];var r,a=e*e+n*n,o=0,c=10;do{var u=Math.tan(o),h=1/Math.cos(o),d=a-2*n*o+o*o;o-=r=(u*d+2*(o-n))/(2+d*h*h+2*(o-n)*u)}while(Math.abs(r)>pe&&--c>0);var f=e*(u=Math.tan(o)),p=Math.tan(Math.abs(n)<Math.abs(o+1/u)?.5*s(f):.5*l(f)+ge/4)/Math.sin(o);return[i?2*Math.atan(i*p)/i:2*p,o]},e}function Vt(t,e){var i,n=Math.min(18,36*Math.abs(e)/ge),r=Math.floor(n),a=n-r,o=(i=Ge[r])[0],s=i[1],l=(i=Ge[++r])[0],c=i[1],u=(i=Ge[Math.min(19,++r)])[0],h=i[1];return[t*(l+a*(u-o)/2+a*a*(u-2*l+o)/2),(e>0?ve:-ve)*(c+a*(h-s)/2+a*a*(h-2*c+s)/2)]}function Yt(t){function e(e,i){var n=Math.cos(i),r=(t-1)/(t-n*Math.cos(e));return[r*n*Math.sin(e),r*Math.sin(i)]}return e.invert=function(e,i){var n=e*e+i*i,r=Math.sqrt(n),a=(t-Math.sqrt(1-n*(t+1)/(t-1)))/((t-1)/r+r/(t-1));return[Math.atan2(e*a,r*Math.sqrt(1-a*a)),r?s(i*a/r):0]},e}function Wt(t,e){function i(e,i){var o=n(e,i),s=o[1],l=s*a/(t-1)+r;return[o[0]*r/l,s/l]}var n=Yt(t);if(!e)return n;var r=Math.cos(e),a=Math.sin(e);return i.invert=function(e,i){var o=(t-1)/(t-1-i*a);return n.invert(o*e,o*i*r)},i}function Xt(){var t=1.4,e=0,i=we(Wt),n=i(t,e);return n.distance=function(n){return arguments.length?i(t=+n,e):t},n.tilt=function(n){return arguments.length?i(t,e=n*ge/180):180*e/ge},n}function Ut(t,e){var i=Math.tan(e/2),n=Math.sin(ge/4*i);return[t*(.74482-.34588*n*n),1.70711*i]}function Gt(t){function e(e,a){var o=l(Math.cos(a)*Math.cos(e-i)),s=l(Math.cos(a)*Math.cos(e-n)),u=a<0?-1:1;return o*=o,s*=s,[(o-s)/(2*t),u*c(4*r*s-(r-o+s)*(r-o+s))/(2*t)]}if(!t)return d3.geoAzimuthalEquidistant.raw;var i=-t/2,n=-i,r=t*t,a=Math.tan(n),o=.5/Math.sin(n);return e.invert=function(t,e){var r,s,c=e*e,u=Math.cos(Math.sqrt(c+(r=t+i)*r)),h=Math.cos(Math.sqrt(c+(r=t+n)*r));return[Math.atan2(s=u-h,r=(u+h)*a),(e<0?-1:1)*l(Math.sqrt(r*r+s*s)*o)]},e}function Qt(){var t=[[0,0],[0,0]],e=we(Gt),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var r=d3.geoInterpolate(i[0],i[1]),a=r(.5),o=d3.geoRotation([-a[0],-a[1]])(i[0]),l=.5*r.distance,c=-s(Math.sin(o[1]*ye)/Math.sin(l));return o[0]>0&&(c=ge-c),n.call(o,[-a[0],-a[1],-c*_e]),e(2*l)},i}function $t(t){function e(t,e){var n=d3.geoGnomonic.raw(t,e);return n[0]*=i,n}var i=Math.cos(t);return e.invert=function(t,e){return d3.geoGnomonic.raw.invert(t/i,e)},e}function Zt(){var t=[[0,0],[0,0]],e=we($t),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var r=d3.geoInterpolate(i[0],i[1]),a=r(.5),o=d3.geoRotation([-a[0],-a[1]])(i[0]),l=.5*r.distance,c=-s(Math.sin(o[1]*ye)/Math.sin(l));return o[0]>0&&(c=ge-c),n.call(o,[-a[0],-a[1],-c*_e]),e(l)},i}function Jt(t,e){if(Math.abs(e)<pe)return[t,0];var i=Math.abs(e/ve),n=s(i);if(Math.abs(t)<pe||Math.abs(Math.abs(e)-ve)<pe)return[0,o(e)*ge*Math.tan(n/2)];var r=Math.cos(n),a=Math.abs(ge/t-t/ge)/2,l=a*a,c=r/(i+r-1),u=c*(2/i-1),h=u*u,d=h+l,f=c-h,p=l+c;return[o(t)*ge*(a*f+Math.sqrt(l*f*f-d*(c*c-h)))/d,o(e)*ge*(u*p-a*Math.sqrt((l+1)*d-p*p))/d]}function te(t,e){if(Math.abs(e)<pe)return[t,0];var i=Math.abs(e/ve),n=s(i);if(Math.abs(t)<pe||Math.abs(Math.abs(e)-ve)<pe)return[0,o(e)*ge*Math.tan(n/2)];var r=Math.cos(n),a=Math.abs(ge/t-t/ge)/2,l=a*a,u=r*(Math.sqrt(1+l)-a*r)/(1+l*i*i);return[o(t)*ge*u,o(e)*ge*c(1-u*(2*a+u))]}function ee(t,e){if(Math.abs(e)<pe)return[t,0];var i=e/ve,n=s(i);if(Math.abs(t)<pe||Math.abs(Math.abs(e)-ve)<pe)return[0,ge*Math.tan(n/2)];var r=(ge/t-t/ge)/2,a=i/(1+Math.cos(n));return[ge*(o(t)*c(r*r+1-a*a)-r),ge*a]}function ie(t,e){if(!e)return[t,0];var i=Math.abs(e);if(!t||i===ve)return[0,e];var n=i/ve,r=n*n,a=(8*n-r*(r+2)-5)/(2*r*(n-1)),s=a*a,l=n*a,u=r+s+2*l,h=n+3*a,d=t/ve,f=d+1/d,p=o(Math.abs(t)-ve)*Math.sqrt(f*f-4),m=p*p,g=u*(r+s*m-1)+(1-r)*(r*(h*h+4*s)+12*l*s+4*s*s),v=(p*(u+s-1)+2*c(g))/(4*u+m);return[o(t)*ve*v,o(e)*ve*c(1+p*Math.abs(v)-v*v)]}function ne(t,e){return[t*Math.sqrt(1-3*e*e/(ge*ge)),e]}function re(t,e){var i=.90631*Math.sin(e),n=Math.sqrt(1-i*i),r=Math.sqrt(2/(1+n*Math.cos(t/=3)));return[2.66723*n*r*Math.sin(t),1.24104*i*r]}function ae(t,e){var i=Math.cos(e),n=Math.cos(t)*i,r=1-n,a=Math.cos(t=Math.atan2(Math.sin(t)*i,-Math.sin(e))),o=Math.sin(t);return i=c(1-n*n),[o*i-a*r,-a*i-o*r]}function oe(t,e){var i=d(t,e);return[(i[0]+t/ve)/2,(i[1]+e)/2]}d3.geoProject=function(t,i){var n=i.stream;if(!n)throw new Error("not yet supported");return(t&&se.hasOwnProperty(t.type)?se[t.type]:e)(t,n)};var se={Feature:t,FeatureCollection:function(e,i){return{type:"FeatureCollection",features:e.features.map(function(e){return t(e,i)})}}},le=[],ce=[],ue={point:function(t,e){le.push([t,e])},result:function(){var t=le.length?le.length<2?{type:"Point",coordinates:le[0]}:{type:"MultiPoint",coordinates:le}:null;return le=[],t}},he={lineStart:i,point:function(t,e){le.push([t,e])},lineEnd:function(){le.length&&(ce.push(le),le=[])},result:function(){var t=ce.length?ce.length<2?{type:"LineString",coordinates:ce[0]}:{type:"MultiLineString",coordinates:ce}:null;return ce=[],t}},de={polygonStart:i,lineStart:i,point:function(t,e){le.push([t,e])},lineEnd:function(){var t=le.length;if(t){do{le.push(le[0].slice())}while(++t<4);ce.push(le),le=[]}},polygonEnd:i,result:function(){if(!ce.length)return null;var t=[],e=[];return ce.forEach(function(i){n(i)?t.push([i]):e.push(i)}),e.forEach(function(e){var i=e[0];t.some(function(t){return!!r(t[0],i)&&(t.push(e),!0)})||t.push([e])}),ce=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},fe={Point:ue,MultiPoint:ue,LineString:he,MultiLineString:he,Polygon:de,MultiPolygon:de,Sphere:de},pe=1e-6,me=pe*pe,ge=Math.PI,ve=ge/2,be=Math.sqrt(ge),ye=ge/180,_e=180/ge,xe=d3.geoProjection,we=d3.geoProjectionMutator;d3.geoInterrupt=function(t){function e(e,i){for(var n=i<0?-1:1,r=s[+(i<0)],a=0,o=r.length-1;a<o&&e>r[a][2][0];++a);var l=t(e-r[a][1][0],i);return l[0]+=t(r[a][1][0],n*i>n*r[a][0][1]?r[a][0][1]:i)[0],l}function i(){o=s.map(function(e){return e.map(function(e){var i,n=t(e[0][0],e[0][1])[0],r=t(e[2][0],e[2][1])[0],a=t(e[1][0],e[0][1])[1],o=t(e[1][0],e[1][1])[1];return a>o&&(i=a,a=o,o=i),[[n,a],[r,o]]})})}function n(){for(var t=1e-6,e=[],i=0,n=s[0].length;i<n;++i){var a=s[0][i],o=180*a[0][0]/ge,l=180*a[0][1]/ge,c=180*a[1][1]/ge,u=180*a[2][0]/ge,h=180*a[2][1]/ge;e.push(r([[o+t,l+t],[o+t,c-t],[u-t,c-t],[u-t,h+t]],30))}for(var i=s[1].length-1;i>=0;--i){var a=s[1][i],o=180*a[0][0]/ge,l=180*a[0][1]/ge,c=180*a[1][1]/ge,u=180*a[2][0]/ge,h=180*a[2][1]/ge;e.push(r([[u-t,h-t],[u-t,c+t],[o+t,c+t],[o+t,l-t]],30))}return{type:"Polygon",coordinates:[d3.merge(e)]}}function r(t,e){for(var i,n,r,a=-1,o=t.length,s=t[0],l=[];++a<o;){i=t[a],n=(i[0]-s[0])/e,r=(i[1]-s[1])/e;for(var c=0;c<e;++c)l.push([s[0]+c*n,s[1]+c*r]);s=i}return l.push(i),l}function a(t,e){return Math.abs(t[0]-e[0])<pe&&Math.abs(t[1]-e[1])<pe}var o,s=[[[[-ge,0],[0,ve],[ge,0]]],[[[-ge,0],[0,-ve],[ge,0]]]];t.invert&&(e.invert=function(i,n){for(var r=o[+(n<0)],l=s[+(n<0)],c=0,u=r.length;c<u;++c){var h=r[c];if(h[0][0]<=i&&i<h[1][0]&&h[0][1]<=n&&n<h[1][1]){var d=t.invert(i-t(l[c][1][0],0)[0],n);return d[0]+=l[c][1][0],a(e(d[0],d[1]),[i,n])?d:null}}});var l=d3.geoProjection(e),c=l.stream;return l.stream=function(t){var e=l.rotate(),i=c(t),r=(l.rotate([0,0]),c(t));return l.rotate(e),i.sphere=function(){d3.geoStream(n(),r)},i},l.lobes=function(t){return arguments.length?(s=t.map(function(t){return t.map(function(t){return[[t[0][0]*ge/180,t[0][1]*ge/180],[t[1][0]*ge/180,t[1][1]*ge/180],[t[2][0]*ge/180,t[2][1]*ge/180]]})}),i(),l):s.map(function(t){return t.map(function(t){return[[180*t[0][0]/ge,180*t[0][1]/ge],[180*t[1][0]/ge,180*t[1][1]/ge],[180*t[2][0]/ge,180*t[2][1]/ge]]})})},l},(d3.geoAiry=h).raw=u,d.invert=function(t,e){if(!(t*t+4*e*e>ge*ge+pe)){var i=t,n=e,r=25;do{var a,o=Math.sin(i),s=Math.sin(i/2),c=Math.cos(i/2),u=Math.sin(n),h=Math.cos(n),d=Math.sin(2*n),f=u*u,p=h*h,m=s*s,g=1-p*c*c,v=g?l(h*c)*Math.sqrt(a=1/g):a=0,b=2*v*h*s-t,y=v*u-e,_=a*(p*m+v*h*c*f),x=a*(.5*o*d-2*v*u*s),w=.25*a*(d*s-v*u*p*o),S=a*(f*c+v*m*h),M=x*w-S*_;if(!M)break;var k=(y*x-b*S)/M,E=(b*w-y*_)/M;i-=k,n-=E}while((Math.abs(k)>pe||Math.abs(E)>pe)&&--r>0);return[i,n]}},(d3.geoAitoff=function(){return xe(d)}).raw=d,(d3.geoArmadillo=p).raw=f,_.invert=function(t,e){if(t*=3/8,e*=3/8,!t&&Math.abs(e)>1)return null;var i=t*t,n=e*e,r=1+i+n,a=Math.sqrt(.5*(r-Math.sqrt(r*r-4*e*e))),l=s(a)/3,c=a?y(Math.abs(e/a))/3:b(Math.abs(t))/3,u=Math.cos(l),h=v(c),d=h*h-u*u;return[2*o(t)*Math.atan2(g(c)*u,.25-d),2*o(e)*Math.atan2(h*Math.sin(l),.25+d)]},(d3.geoAugust=function(){return xe(_)}).raw=_;var Se=Math.log(1+Math.SQRT2);x.invert=function(t,e){if((n=Math.abs(e))<Se)return[t,2*Math.atan(Math.exp(e))-ve];var i,n,r=Math.sqrt(8),a=ge/4,s=25;do{var l=Math.cos(a/2),c=Math.tan(a/2);a-=i=(r*(a-ge/4)-Math.log(c)-n)/(r-.5*l*l/c)}while(Math.abs(i)>me&&--s>0);return[t/(Math.cos(a)*(r-1/Math.sin(a))),o(e)*a]},(d3.geoBaker=function(){return xe(x)}).raw=x;var Me=d3.geoAzimuthalEquidistant.raw;(d3.geoBerghaus=S).raw=w;var ke=M(ge),Ee=k(Math.SQRT2/ve,Math.SQRT2,ge);(d3.geoMollweide=function(){return xe(Ee)}).raw=Ee,E.invert=function(t,e){var i,n,r=2.00276,a=r*e,o=e<0?-ge/4:ge/4,s=25;do{n=a-Math.SQRT2*Math.sin(o),o-=i=(Math.sin(2*o)+2*o-ge*Math.sin(n))/(2*Math.cos(2*o)+2+ge*Math.cos(n)*Math.SQRT2*Math.cos(o))}while(Math.abs(i)>pe&&--s>0);return n=a-Math.SQRT2*Math.sin(o),[t*(1/Math.cos(n)+1.11072/Math.cos(o))/r,n]},(d3.geoBoggs=function(){return xe(E)}).raw=E,O.invert=function(t,e){return[t/Math.cos(e),e]},(d3.geoSinusoidal=function(){return xe(O)}).raw=O,(d3.geoBonne=function(){return z(T).parallel(45)}).raw=T;var ze=k(1,4/ge,ge);(d3.geoBromley=function(){return xe(ze)}).raw=ze,(d3.geoChamberlin=P).raw=C,j.invert=function(t,e){var i=(i=e/be-1)*i;return[i>0?t*Math.sqrt(ge/i)/2:0,s(1-i)]},(d3.geoCollignon=function(){return xe(j)}).raw=j,(d3.geoCraig=function(){return z(R)}).raw=R,F.invert=function(t,e){var i=Math.sqrt(3),n=3*s(e/(i*be));return[be*t/(i*(2*Math.cos(2*n/3)-1)),n]},(d3.geoCraster=function(){return xe(F)}).raw=F,(d3.geoCylindricalEqualArea=function(){return z(N)}).raw=N,(d3.geoCylindricalStereographic=function(){return z(B)}).raw=B,H.invert=function(t,e){var i=Math.sqrt(8/(3*ge)),n=e/i;return[t/(i*(1-Math.abs(n)/ge)),n]},(d3.geoEckert1=function(){return xe(H)}).raw=H,q.invert=function(t,e){var i=2-Math.abs(e)/Math.sqrt(2*ge/3);return[t*Math.sqrt(6*ge)/(2*i),o(e)*s((4-i*i)/3)]},(d3.geoEckert2=function(){return xe(q)}).raw=q,K.invert=function(t,e){var i=Math.sqrt(ge*(4+ge))/2;return[t*i/(1+c(1-e*e*(4+ge)/(4*ge))),e*i/2]},(d3.geoEckert3=function(){return xe(K)}).raw=K,V.invert=function(t,e){var i=.5*e*Math.sqrt((4+ge)/ge),n=s(i),r=Math.cos(n);return[t/(2/Math.sqrt(ge*(4+ge))*(1+r)),s((n+i*(r+2))/(2+ve))]},(d3.geoEckert4=function(){return xe(V)}).raw=V,Y.invert=function(t,e){var i=Math.sqrt(2+ge),n=e*i/2;return[i*t/(1+Math.cos(n)),n]},(d3.geoEckert5=function(){return xe(Y)}).raw=Y,W.invert=function(t,e){var i=1+ve,n=Math.sqrt(i/2);return[2*t*n/(1+Math.cos(e*=n)),s((e+Math.sin(e))/i)]},(d3.geoEckert6=function(){return xe(W)}).raw=W,X.invert=function(t,e){var i=d3.geoAugust.raw.invert(t/1.2,1.065*e);if(!i)return null;var n=i[0],r=i[1],a=20;t/=Oe,e/=Oe;do{var o=n/2,s=r/2,l=Math.sin(o),c=Math.cos(o),u=Math.sin(s),h=Math.cos(s),d=Math.cos(r),f=Math.sqrt(d),p=u/(h+Math.SQRT2*c*f),m=p*p,g=Math.sqrt(2/(1+m)),v=Math.SQRT2*h+(c+l)*f,b=Math.SQRT2*h+(c-l)*f,y=v/b,_=Math.sqrt(y),x=_-1/_,w=_+1/_,S=g*x-2*Math.log(_)-t,M=g*p*w-2*Math.atan(p)-e,k=u&&Math.SQRT1_2*f*l*m/u,E=(Math.SQRT2*c*h+f)/(2*(h+Math.SQRT2*c*f)*(h+Math.SQRT2*c*f)*f),z=-.5*p*g*g*g,O=z*k,T=z*E,C=(C=2*h+Math.SQRT2*f*(c-l))*C*_,P=(Math.SQRT2*c*h*f+d)/C,D=-Math.SQRT2*l*u/(f*C),A=x*O-2*P/_+g*(P+P/y),I=x*T-2*D/_+g*(D+D/y),L=p*w*O-2*k/(1+m)+g*w*k+g*p*(P-P/y),j=p*w*T-2*E/(1+m)+g*w*E+g*p*(D-D/y),R=I*L-j*A;if(!R)break;var F=(M*I-S*j)/R,N=(S*L-M*A)/R;n-=F,r=Math.max(-ve,Math.min(ve,r-N))}while((Math.abs(F)>pe||Math.abs(N)>pe)&&--a>0);return Math.abs(Math.abs(r)-ve)<pe?[0,r]:a&&[n,r]};var Oe=3+2*Math.SQRT2;(d3.geoEisenlohr=function(){return xe(X)}).raw=X,U.invert=function(t,e){var i=e/(1+Te);return[t?t/(Te*c(1-i*i)):0,2*Math.atan(i)]};var Te=Math.cos(35*ye);(d3.geoFahey=function(){return xe(U)}).raw=U,G.invert=function(t,e){var i=Math.atan(e/be),n=Math.cos(i),r=2*i;return[t*be*.5/(Math.cos(r)*n*n),r]},(d3.geoFoucaut=function(){return xe(G)}).raw=G,d3.geoGilbert=function(t){function e(e){return t([.5*e[0],s(Math.tan(.5*e[1]*ye))*_e])}var i=d3.geoEquirectangular().scale(_e).translate([0,0]);return t.invert&&(e.invert=function(e){return e=t.invert(e),e[0]*=2,e[1]=2*Math.atan(Math.sin(e[1]*ye))*_e,e}),e.stream=function(e){e=t.stream(e);var n=i.stream({point:function(t,i){e.point(.5*t,s(Math.tan(.5*-i*ye))*_e)},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}});return n.sphere=function(){e.sphere()},n.valid=!1,n},e};var Ce=d3.geoAzimuthalEquidistant.raw;(d3.geoGingery=Z).raw=Q;var Pe=tt(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geoGinzburg4=function(){return xe(Pe)}).raw=Pe;var De=tt(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geoGinzburg5=function(){return xe(De)}).raw=De;var Ae=tt(5/6*ge,-.62636,-.0344,0,1.3493,-.05524,0,.045);(d3.geoGinzburg6=function(){return xe(Ae)}).raw=Ae,et.invert=function(t,e){var i,n=t,r=e,a=50;do{var o=r*r;r-=i=(r*(1+o/12)-e)/(1+o/4)}while(Math.abs(i)>pe&&--a>0);a=50,t/=1-.162388*o;do{var s=(s=n*n)*s;n-=i=(n*(.87-952426e-9*s)-t)/(.87-.00476213*s)}while(Math.abs(i)>pe&&--a>0);return[n,r]},(d3.geoGinzburg8=function(){return xe(et)}).raw=et;var Ie=tt(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);(d3.geoGinzburg9=function(){return xe(Ie)}).raw=Ie,nt.invert=function(t,e){var i=o(t),n=o(e),r=-i*t,a=-n*e,l=a/r<1,c=at(l?a:r,l?r:a),u=c[0],h=c[1];l&&(u=-ve-u);var d=Math.cos(h),t=Math.cos(u)*d,e=Math.sin(u)*d,f=Math.sin(h);return[i*(Math.atan2(e,-f)+ge),n*s(t)]},d3.geoGringorten=it(nt),ut.invert=function(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),r=ct(ve,n*n),a=ot(.5*r-e,-t,n*n),o=dt(a[0],a[1]);return[Math.atan2(o[1],o[0])/-1,2*Math.atan(Math.exp(-.5*Math.log(i*o[0]*o[0]+i*o[1]*o[1])))-ve]},d3.geoGuyou=it(ut),(d3.geoHammerRetroazimuthal=mt).raw=ft;var Le=d3.geoAzimuthalEqualArea.raw;bt.invert=function(t,e){var i=2*s(e/2);return[t*Math.cos(i/2)/Math.cos(i),i]},(d3.geoHammer=vt).raw=gt,yt.invert=function(t,e){var i=Math.abs(i=e*(e<0?.5179951515653813:.5686373742600607))>1-pe?i>0?ve:-ve:s(i);return[1.1764705882352942*t/Math.cos(i),Math.abs(i=((i+=i)+Math.sin(i))*(e<0?.4102345310814193:.3736990601468637))>1-pe?i>0?ve:-ve:s(i)]},(d3.geoHatano=function(){return xe(yt)}).raw=yt;var je=41+48/36+37/3600;(d3.geoHealpix=xt).raw=_t,(d3.geoHill=St).raw=wt;var Re=.7109889596207567,Fe=.0528035274542;Mt.invert=function(t,e){return e>-Re?Ee.invert(t,e-Fe):O.invert(t,e)},(d3.geoSinuMollweide=function(){return xe(Mt).rotate([-20,-55])}).raw=Mt,kt.invert=function(t,e){return Math.abs(e)>Re?Ee.invert(t,e+(e>0?Fe:-Fe)):O.invert(t,e)},(d3.geoHomolosine=function(){return xe(kt)}).raw=kt,Et.invert=function(t,e){return[2/3*ge*t/Math.sqrt(ge*ge/3-e*e),e]},(d3.geoKavrayskiy7=function(){return xe(Et)}).raw=Et,(d3.geoLagrange=Ot).raw=zt,Tt.invert=function(t,e){var i=Math.abs(t),n=Math.abs(e),r=ge/Math.SQRT2,a=pe,o=ve;n<r?o*=n/r:a+=6*l(r/n);for(var s=0;s<25;s++){var u=Math.sin(o),h=c(Math.cos(o)),d=Math.sin(o/2),f=Math.cos(o/2),p=Math.sin(a/6),m=Math.cos(a/6),g=.5*a*(1+h)-i,v=o/(f*m)-n,b=h?-.25*a*u/h:0,y=.5*(1+h),_=(1+.5*o*d/f)/(f*m),x=o/f*(p/6)/(m*m),w=b*x-_*y,S=(g*x-v*y)/w,M=(v*b-g*_)/w;if(o-=S,a-=M,Math.abs(S)<pe&&Math.abs(M)<pe)break}return[t<0?-a:a,e<0?-o:o]},(d3.geoLarrivee=function(){return xe(Tt)}).raw=Tt,Ct.invert=function(t,e){var i=o(t)*ge,n=e/2,r=50;do{var a=i*i,s=n*n,l=i*n,c=i*(.975534+s*(-.0143059*a-.119161+-.0547009*s))-t,u=n*(1.00384+a*(.0802894+-.02855*s+199025e-9*a)+s*(.0998909+-.0491032*s))-e,h=.975534-s*(.119161+3*a*.0143059+.0547009*s),d=-l*(.238322+.2188036*s+.0286118*a),f=l*(.1605788+7961e-7*a+-.0571*s),p=1.00384+a*(.0802894+199025e-9*a)+s*(3*(.0998909-.02855*a)-.245516*s),m=d*f-p*h,g=(u*d-c*p)/m,v=(c*f-u*h)/m;i-=g,n-=v}while((Math.abs(g)>pe||Math.abs(v)>pe)&&--r>0);return r&&[i,n]},(d3.geoLaskowski=function(){return xe(Ct)}).raw=Ct,Pt.invert=function(t,e){var i=t*t,n=e*e,r=n+1,a=t?Math.SQRT1_2*Math.sqrt((r-Math.sqrt(i*i+2*i*(n-1)+r*r))/i+1):1/Math.sqrt(r);return[s(t*a),o(e)*l(a)]},(d3.geoLittrow=function(){return xe(Pt)}).raw=Pt,(d3.geoLoximuthal=function(){return z(Dt).parallel(40)}).raw=Dt,At.invert=function(t,e){return[t,2.5*Math.atan(Math.exp(.8*e))-.625*ge]},(d3.geoMiller=function(){return xe(At)}).raw=At;var Ne={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};(d3.geoModifiedStereographic=Lt).raw=It,jt.invert=function(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),r=3*s(e*n/9);return[t*n/(i*(2*Math.cos(2*r/3)-1)),s(3*Math.sin(r)*i/7)]},(d3.geoMtFlatPolarParabolic=function(){return xe(jt)}).raw=jt,Rt.invert=function(t,e){var i=e*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),n=2*s(i);return[3*Math.SQRT2*t/(1+2*Math.cos(n)/Math.cos(n/2)),s((i+Math.sin(n))/(1+Math.SQRT1_2))]},(d3.geoMtFlatPolarQuartic=function(){return xe(Rt)}).raw=Rt,Ft.invert=function(t,e){var i=Math.sqrt(6/(4+ge)),n=e/i;return Math.abs(Math.abs(n)-ve)<pe&&(n=n<0?-ve:ve),[1.5*t/(i*(.5+Math.cos(n))),s((n/2+Math.sin(n))/(1+ge/4))]},(d3.geoMtFlatPolarSinusoidal=function(){return xe(Ft)}).raw=Ft,Nt.invert=function(t,e){var i,n=e,r=25;do{var a=n*n,o=a*a;n-=i=(n*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-e)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(Math.abs(i)>pe&&--r>0);return[t/(.8707+(a=n*n)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),n]},(d3.geoNaturalEarth=function(){return xe(Nt)}).raw=Nt,Bt.invert=function(t,e){for(var i=e/2,n=0,r=1/0;n<10&&Math.abs(r)>pe;n++){var a=Math.cos(e/2);e-=r=(e-Math.tan(e/2)-i)/(1-.5/(a*a))}return[2*t/(1+Math.cos(e)),e]},(d3.geoNellHammer=function(){return xe(Bt)}).raw=Bt;var Be=1.0148,He=.23185,qe=-.14499,Ke=.02406,Ve=Be,Ye=5*He,We=7*qe,Xe=9*Ke;Ht.invert=function(t,e){e>1.790857183?e=1.790857183:e<-1.790857183&&(e=-1.790857183);var i,n=e;do{var r=n*n;n-=i=(n*(Be+r*r*(He+r*(qe+Ke*r)))-e)/(Ve+r*r*(Ye+r*(We+Xe*r)))}while(Math.abs(i)>pe);return[t,n]},(d3.geoPatterson=function(){return xe(Ht)}).raw=Ht;var Ue=it(ut);(d3.geoPeirceQuincuncial=function(){return Ue().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=Ue.raw,qt.invert=function(t,e){if(Math.abs(e)<pe)return[t,0];var i,n=t*t+e*e,r=.5*e,a=10;do{var c=Math.tan(r),u=1/Math.cos(r),h=n-2*e*r+r*r;r-=i=(c*h+2*(r-e))/(2+h*u*u+2*(r-e)*c)}while(Math.abs(i)>pe&&--a>0);return c=Math.tan(r),[(Math.abs(e)<Math.abs(r+1/c)?s(t*c):o(t)*(l(Math.abs(t*c))+ve))/Math.sin(r),r]},(d3.geoPolyconic=function(){return xe(qt)}).raw=qt,(d3.geoRectangularPolyconic=function(){return z(Kt)}).raw=Kt;var Ge=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];Ge.forEach(function(t){t[1]*=1.0144}),Vt.invert=function(t,e){var i=e/ve,n=90*i,r=Math.min(18,Math.abs(n/5)),a=Math.max(0,Math.floor(r));do{var o=Ge[a][1],s=Ge[a+1][1],l=Ge[Math.min(19,a+2)][1],c=l-o,u=l-2*s+o,h=2*(Math.abs(i)-s)/c,d=u/c,f=h*(1-d*h*(1-2*d*h));if(f>=0||1===a){n=(e>=0?5:-5)*(f+r);var p,m=50;do{r=Math.min(18,Math.abs(n)/5),a=Math.floor(r),f=r-a,o=Ge[a][1],s=Ge[a+1][1],l=Ge[Math.min(19,a+2)][1],n-=(p=(e>=0?ve:-ve)*(s+f*(l-o)/2+f*f*(l-2*s+o)/2)-e)*_e}while(Math.abs(p)>me&&--m>0);break}}while(--a>=0);var g=Ge[a][0],v=Ge[a+1][0],b=Ge[Math.min(19,a+2)][0];return[t/(v+f*(b-g)/2+f*f*(b-2*v+g)/2),n*ye]},(d3.geoRobinson=function(){return xe(Vt)}).raw=Vt,(d3.geoSatellite=Xt).raw=Wt,Ut.invert=function(t,e){var i=e/1.70711,n=Math.sin(ge/4*i);return[t/(.74482-.34588*n*n),2*Math.atan(i)]},(d3.geoTimes=function(){return xe(Ut)}).raw=Ut,(d3.geoTwoPointEquidistant=Qt).raw=Gt,(d3.geoTwoPointAzimuthal=Zt).raw=$t,Jt.invert=function(t,e){if(Math.abs(e)<pe)return[t,0];if(Math.abs(t)<pe)return[0,ve*Math.sin(2*Math.atan(e/ge))];var i=(t/=ge)*t,n=(e/=ge)*e,r=i+n,a=r*r,s=-Math.abs(e)*(1+r),c=s-2*n+i,u=-2*s+1+2*n+a,h=n/u+(2*c*c*c/(u*u*u)-9*s*c/(u*u))/27,d=(s-c*c/(3*u))/u,f=2*Math.sqrt(-d/3),p=l(3*h/(d*f))/3;return[ge*(r-1+Math.sqrt(1+2*(i-n)+a))/(2*t),o(e)*ge*(-f*Math.cos(p+ge/3)-c/(3*u))]},(d3.geoVanDerGrinten=function(){return xe(Jt)}).raw=Jt,te.invert=function(t,e){if(!t)return[0,ve*Math.sin(2*Math.atan(e/ge))];var i=Math.abs(t/ge),n=(1-i*i-(e/=ge)*e)/(2*i),r=n*n,a=Math.sqrt(r+1);return[o(t)*ge*(a-n),o(e)*ve*Math.sin(2*Math.atan2(Math.sqrt((1-2*n*i)*(n+a)-i),Math.sqrt(a+n+i)))]},(d3.geoVanDerGrinten2=function(){return xe(te)}).raw=te,ee.invert=function(t,e){if(!e)return[t,0];var i=e/ge,n=(ge*ge*(1-i*i)-t*t)/(2*ge*t);return[t?ge*(o(t)*Math.sqrt(n*n+1)-n):0,ve*Math.sin(2*Math.atan(i))]},(d3.geoVanDerGrinten3=function(){return xe(ee)}).raw=ee,ie.invert=function(t,e){if(!t||!e)return[t,e];e/=ge;var i=o(t)*t/ve,n=(i*i-1+4*e*e)/Math.abs(i),r=n*n,a=2*e,s=50;do{var l=a*a,c=(8*a-l*(l+2)-5)/(2*l*(a-1)),u=(3*a-l*a-10)/(2*l*a),h=c*c,d=a*c,f=a+c,p=f*f,m=a+3*c,g=p*(l+h*r-1)+(1-l)*(l*(m*m+4*h)+h*(12*d+4*h)),v=-2*f*(4*d*h+(1-4*l+3*l*l)*(1+u)+h*(14*l-6-r+(8*l-8-2*r)*u)+d*(12*l-8+(10*l-10-r)*u)),b=Math.sqrt(g),y=n*(p+h-1)+2*b-i*(4*p+r),_=n*(2*c*u+2*f*(1+u))+v/b-8*f*(n*(-1+h+p)+2*b)*(1+u)/(r+4*p);a-=Î´=y/_}while(Î´>pe&&--s>0);return[o(t)*(Math.sqrt(n*n+4)+n)*ge/4,ve*a]},(d3.geoVanDerGrinten4=function(){return xe(ie)}).raw=ie;var Qe=function(){var t=4*ge+3*Math.sqrt(3),e=2*Math.sqrt(2*ge*Math.sqrt(3)/t);return k(e*Math.sqrt(3)/ge,e,t/6)}();(d3.geoWagner4=function(){return xe(Qe)}).raw=Qe,ne.invert=function(t,e){return[t/Math.sqrt(1-3*e*e/(ge*ge)),e]},(d3.geoWagner6=function(){return xe(ne)}).raw=ne,re.invert=function(t,e){var i=t/2.66723,n=e/1.24104,r=Math.sqrt(i*i+n*n),a=2*s(r/2);return[3*Math.atan2(t*Math.tan(a),2.66723*r),r&&s(e*Math.sin(a)/(1.24104*.90631*r))]},(d3.geoWagner7=function(){return xe(re)}).raw=re,ae.invert=function(t,e){var i=-.5*(t*t+e*e),n=Math.sqrt(-i*(2+i)),r=e*i+t*n,a=t*i-e*n,o=Math.sqrt(a*a+r*r);return[Math.atan2(n*r,o*(1+i)),o?-s(n*a/o):0]},(d3.geoWiechel=function(){return xe(ae)}).raw=ae,oe.invert=function(t,e){var i=t,n=e,r=25;do{var a,o=Math.cos(n),s=Math.sin(n),c=Math.sin(2*n),u=s*s,h=o*o,d=Math.sin(i),f=Math.cos(i/2),p=Math.sin(i/2),m=p*p,g=1-h*f*f,v=g?l(o*f)*Math.sqrt(a=1/g):a=0,b=.5*(2*v*o*p+i/ve)-t,y=.5*(v*s+n)-e,_=.5*a*(h*m+v*o*f*u)+.5/ve,x=a*(d*c/4-v*s*p),w=.125*a*(c*p-v*s*h*d),S=.5*a*(u*f+v*m*o)+.5,M=x*w-S*_,k=(y*x-b*S)/M,E=(b*w-y*_)/M;i-=k,n-=E}while((Math.abs(k)>pe||Math.abs(E)>pe)&&--r>0);return[i,n]},(d3.geoWinkel3=function(){return xe(oe)}).raw=oe}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),o=i(31),s=n(o),l=i(432),c=n(l),u=i(21),h=function(t){return function(){function e(t,i){return t.each(function(t,e){var n=d3.select(this);n.append("rect").attr("class","vzb-label-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),n.append("rect").attr("class","vzb-label-fill vzb-tooltip-border");var s=n.append("text").attr("class",o+"-label-content stroke");if(n.style("paint-order").length||(n.insert("text","."+o+"-label-content").attr("class",o+"-label-content "+o+"-label-shadow vzb-noexport"),s.classed("stroke",!1)),!i){var l=n.append("g").attr("class",o+"-label-x vzb-transparent");a.setIcon(l,u.close),l.insert("circle","svg"),l.select("svg").attr("class",o+"-label-x-icon").attr("width","0px").attr("height","0px"),l.on("click",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),r.model.marker.clearHighlighted(),r.model.marker.selectMarker(t))})}}),i||t.call(s).on("mouseover",function(t){if(!a.isTouchDevice()){r.model.marker.highlightMarker(t);var e=r.KEY||r.context.KEY;r.entityLabels.sort(function(i,n){return i[e]!=t[e]?-1:1}),d3.select(this).selectAll("."+o+"-label-x").classed("vzb-transparent",!1)}}).on("mouseout",function(t){a.isTouchDevice()||(r.model.marker.clearHighlighted(),d3.select(this).selectAll("."+o+"-label-x").classed("vzb-transparent",!0))}).on("click",function(t){if(a.isTouchDevice()){var e=d3.select(this).selectAll("."+o+"-label-x"),i=r.KEY||r.context.KEY,n=e.classed("vzb-transparent");n&&(r.entityLabels.sort(function(e,n){return e[i]!=t[i]?-1:1}),r.showCloseCross(null,!1)),e.classed("vzb-transparent",!n),r.options.SUPPRESS_HIGHLIGHT_DURING_PLAY&&r.model.time.playing||(n?r.model.marker.setHighlight(t):r.model.marker.clearHighlighted())}}),e}function i(t,e,i,a,o,s,l,c,u,h,d){var f=i||r.cached[t[r.KEY]],p=d3.select(a),m=!o&&0!==o||!s&&0!==s||!l&&0!==l||!c&&0!==c;if(m)return p.classed("vzb-invisible",m),void d.classed("vzb-invisible",m);var g=r.context.width,v=r.context.height,b=f.rectBBox,y=b.height,_=f.rectOffsetX,x=f.rectOffsetY;o+b.x<=0?(o=-b.x,f.labelX_=(o-r.xScale(f.labelX0))/g):o+_>g&&(o=g-_,f.labelX_=(o-r.xScale(f.labelX0))/g),s+b.y<=0?(s=-b.y,f.labelY_=(s-r.yScale(f.labelY0))/v):s+x>v&&(s=v-x,f.labelY_=(s-r.yScale(f.labelY0))/v),null==u&&(u=r.context.duration),f._new&&(u=0,delete f._new),u?h&&!t.hidden?(p.classed("vzb-invisible",t.hidden),p.attr("transform","translate("+o+","+s+")").style("opacity",0).transition().duration(u).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){p.style("opacity",1)}),d.classed("vzb-invisible",t.hidden),d.attr("transform","translate("+o+","+s+")").style("opacity",0).transition().duration(u).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){d.style("opacity",1)})):h&&t.hidden?(p.style("opacity",1).transition().duration(u).ease(d3.easeExp).style("opacity",0).on("end",function(){p.style("opacity",1).classed("vzb-invisible",t.hidden)}),d.style("opacity",1).transition().duration(u).ease(d3.easeExp).style("opacity",0).on("end",function(){d.style("opacity",1).classed("vzb-invisible",t.hidden)})):(p.transition().duration(u).ease(d3.easeLinear).attr("transform","translate("+o+","+s+")"),d.transition().duration(u).ease(d3.easeLinear).attr("transform","translate("+o+","+s+")")):(p.interrupt().attr("transform","translate("+o+","+s+")").transition(),d.interrupt().attr("transform","translate("+o+","+s+")").transition(),h&&p.classed("vzb-invisible",t.hidden),h&&d.classed("vzb-invisible",t.hidden));var w=l-o,S=c-s,M=p.select("text").node().getBBox(),k=.5*-M.width,E=.2*-y,z=r.model.ui.chart.labels,O=z.removeLabelBox?M:b,T=r.activeProfile.labelLeashCoeff||0,C=n({x:w,y:S,r:f.scaledS0},{x:k,y:E,width:2*O.height*T+O.width,height:O.height*(2*T+1)});if(d.select("line").classed("vzb-invisible",C),!C){if(z.removeLabelBox){var P=180*Math.atan2(w-k,S-E)/Math.PI,D=P>=0&&P<=180?.5*O.width:.5*-O.width,A=Math.abs(P)<=90?.55*O.height:.45*-O.height;k+=Math.abs(w-k)>.5*M.width?D:0,E+=Math.abs(S-E)>.5*M.height?A:.05*M.height}var I=Math.abs(w)>Math.abs(S)?Math.abs(w):Math.abs(S);d.select("line").style("stroke-dasharray","0 "+f.scaledS0+" "+2*~~I),d.selectAll("line").attr("x1",w).attr("y1",S).attr("x2",k).attr("y2",E)}}function n(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),r=.5*e.width,a=.5*e.height;return!(i>r+t.r)&&(!(n>a+t.r)&&(i<=r||(n<=a||Math.pow(i-r,2)+Math.pow(n-a,2)<=Math.pow(t.r,2))))}var r=t,o=void 0;e.setCssPrefix=function(t){return o=t,e};var s=d3.drag().on("start",function(t,e){d3.event.sourceEvent.stopPropagation();r.KEY}).on("drag",function(t,i){var n=r.KEY;if(r.model.ui.chart.labels.dragging){this.druging||(r.druging=t[n]);var a=r.cached[t[n]];a.labelFixed=!0;var o=r.context.width,s=r.context.height;a.labelX_+=d3.event.dx/o,a.labelY_+=d3.event.dy/s;var l=r.xScale(a.labelX0)+a.labelX_*o,c=r.yScale(a.labelY0)+a.labelY_*s,u=r.xScale(a.labelX0),h=r.yScale(a.labelY0),d=r.entityLines.filter(function(e){return e[n]==t[n]});e._repositionLabels(t,i,null,this,l,c,u,h,0,null,d)}}).on("end",function(t,e){var i=r.KEY;if(r.druging){var n=r.cached[t[i]];r.druging=null,n.labelOffset[0]=n.labelX_,n.labelOffset[1]=n.labelY_,r.model.marker.setLabelOffset(t,[n.labelX_,n.labelY_])}});return e.line=function(t){t.append("line").attr("class",o+"-label-line")},e._repositionLabels=i,e}()},d={LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",LINES_CONTAINER_SELECTOR:"",CSS_PREFIX:"",SUPPRESS_HIGHLIGHT_DURING_PLAY:!0},f=s.default.extend({init:function(t,e){this.context=t,this.options=a.extend({},d),this.label=h(this),this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null},ready:function(){this.KEYS=this.context.KEYS,this.KEY=this.context.KEY,this.updateIndicators(),this.updateLabelSizeLimits()},readyOnce:function(){var t=this;this.model=this.context.model,this.model.on("change:marker.select",function(){t.context._readyOnce&&t.selectDataPoints()}),this.model.marker.size_label&&this.model.on("change:marker.size_label.extent",function(e,i){t.context._readyOnce&&(t.updateLabelSizeLimits(),t.model.time.splash||t.updateLabelsOnlyTextSize())}),this.model.ui.chart.labels.hasOwnProperty("removeLabelBox")&&this.model.on("change:ui.chart.labels.removeLabelBox",function(e,i){t.context._readyOnce&&t.updateLabelsOnlyTextSize()}),this.KEYS=this.context.KEYS,this.KEY=this.context.KEY,this.cached={},this.label.setCssPrefix(this.options.CSS_PREFIX),this.rootEl=this.context.root.element instanceof Array?this.context.root.element:d3.select(this.context.root.element),this.labelsContainer=this.rootEl.select("."+this.options.LABELS_CONTAINER_CLASS),this.linesContainer=this.rootEl.select("."+this.options.LINES_CONTAINER_CLASS),this.updateIndicators(),this.updateSize(),this.selectDataPoints(),this._initLabelTooltip()},config:function(t){a.extend(this.options,t)},updateLabelSizeLimits:function(){var t=this;if(this.model.marker.size_label){var e=this.model.marker.size_label.extent||[0,1],i=this.activeProfile.minLabelTextSize,n=this.activeProfile.maxLabelTextSize,r=n-i;this.minLabelTextSize=Math.max(i+r*e[0],i),this.maxLabelTextSize=Math.max(i+r*e[1],i),"constant"==this.model.marker.size_label.use&&(this.minLabelTextSize=this.maxLabelTextSize),"ordinal"!==this.model.marker.size_label.scaleType||"constant"==this.model.marker.size_label.use?this.labelSizeTextScale.range([t.minLabelTextSize,t.maxLabelTextSize]):this.labelSizeTextScale.rangePoints([t.minLabelTextSize,t.maxLabelTextSize],0).range()}},updateIndicators:function(){this.model.marker.size_label&&(this.labelSizeTextScale=this.model.marker.size_label.getScale())},setScales:function(t,e){this._xScale=t,this._yScale=e},setCloseCrossHeight:function(t){this._closeCrossHeight!=t&&(this._closeCrossHeight=t,this.updateLabelCloseGroupSize(this.entityLabels.selectAll("."+this.options.CSS_PREFIX+"-label-x"),this._closeCrossHeight))},xScale:function(t){return this._xScale?this._xScale(t):t*this.context.width},yScale:function(t){return this._yScale?this._yScale(t):t*this.context.height},selectDataPoints:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.options.CSS_PREFIX,r=t.model.marker.select.map(function(t){var n=a.clone(t,e);return n[i]=a.getKey(t,e),n});this.entityLabels=this.labelsContainer.selectAll("."+n+"-entity").data(r,function(t){return t[i]}),this.entityLines=this.linesContainer.selectAll("g.entity-line."+n+"-entity").data(r,function(t){return t[i]}),this.entityLabels.exit().each(function(e){null!=t.cached[e[i]]&&(t.cached[e[i]]=void 0)}).remove(),this.entityLines.exit().remove(),this.entityLines=this.entityLines.enter().insert("g",function(e){return this.querySelector("."+t.options.LINES_CONTAINER_SELECTOR_PREFIX+(0,c.default)(e[i]))}).attr("class",function(t,e){return n+"-entity entity-line line-"+t[i]}).each(function(e,i){t.label.line(d3.select(this))}).merge(this.entityLines),this.entityLabels=this.entityLabels.enter().append("g").attr("class",function(t,e){return n+"-entity label-"+t[i]}).each(function(e,n){t.cached[e[i]]={_new:!0},t.label(d3.select(this))}).merge(this.entityLabels)},showCloseCross:function(t,e){var i=this.KEY;this.entityLabels.filter(function(e){return!t||e[i]==t[i]}).select("."+this.options.CSS_PREFIX+"-label-x").classed("vzb-transparent",!e)},highlight:function(t,e){var i=this.KEY,n=this.entityLabels;t&&(n=n.filter(function(e){return!t||e[i]==t[i]})),n.classed("vzb-highlighted",e)},updateLabel:function(t,e,i,n,r,o,s,l,c,u,h){var d=this,f=this.KEYS,p=this.KEY;if(t[p]!=d.druging){var m=this.options.CSS_PREFIX;if(d.model.marker.isSelected(t)&&null!=d.entityLabels){null==d.cached[t[p]]&&this.selectDataPoints();var g=d.cached[t[p]];if(i&&a.extend(g,i),null!=g.scaledS0&&null!=g.labelX0&&null!=g.labelY0||this._initNewCache(g,n,r,o,s,c),null==g.labelX_||null==g.labelY_){var v=a.find(d.model.marker.select,function(e){return a.getKey(e,f)==t[p]});g.labelOffset=v.labelOffset||[0,0]}var b=!g.labelX0&&0!==g.labelX0||!g.labelY0&&0!==g.labelY0||!g.scaledS0&&0!==g.scaledS0,y=d.entityLines.filter(function(e){return e[p]==t[p]});d.entityLabels.filter(function(e){return e[p]==t[p]}).each(function(i){var n=d3.select(this);if(b)return n.classed("vzb-invisible",b),void y.classed("vzb-invisible",b);var r=n.selectAll("."+m+"-label-content").text(l);d._updateLabelSize(t,e,null,n,c,r),d.positionLabel(t,e,null,this,u,h,y)})}}},_initNewCache:function(t,e,i,n,r,o){(n||0===n)&&(t.scaledS0=a.areaToRadius(this.context.sScale(n))),t.labelX0=e,t.labelY0=i,t.valueLST=o,t.scaledC0=null!=r?this.context.cScale(r):this.context.COLOR_WHITEISH},_initLabelTooltip:function(){this.tooltipEl=this.labelsContainer.append("g").attr("class",this.options.CSS_PREFIX+"-tooltip")},setTooltip:function(t,e,i,n){if(e){var r=0,a=this.options.CSS_PREFIX;if(this.tooltipEl.raise().text(null),this.label(this.tooltipEl,!0),t){var o={};this._initNewCache(o,n.valueX,n.valueY,n.valueS,n.valueC,n.valueLST),this.tooltipEl.classed(this.options.CSS_PREFIX+"-tooltip",!1).classed(this.options.CSS_PREFIX+"-entity",!0).selectAll("."+a+"-label-content").text(n.labelText),this._updateLabelSize(t,null,o,this.tooltipEl,n.valueLST),r=this.positionLabel(t,null,o,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"))}this.tooltipEl.classed(this.options.CSS_PREFIX+"-entity",!1).classed(this.options.CSS_PREFIX+"-tooltip",!0).selectAll("."+a+"-label-content").text(e),this._updateLabelSize(t,null,i,this.tooltipEl,null),this.positionLabel(t,null,i,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"),r)}else this.tooltipEl.text(null)},setTooltipFontSize:function(t){this.tooltipEl.style("font-size",t)},_updateLabelSize:function(t,e,i,n,r,a){var o=this,s=this.KEY,l=i||o.cached[t[s]],c=this.options.CSS_PREFIX,u=o.model.ui.chart.labels||{};n.classed("vzb-label-boxremoved",u.removeLabelBox);var h=a||n.selectAll("."+c+"-label-content");if(o.labelSizeTextScale)if(null!=r){var d=o.labelSizeTextScale.range(),f=d[0]+Math.sqrt((o.labelSizeTextScale(r)-d[0])*(d[1]-d[0]));h.attr("font-size",f+"px")}else h.attr("font-size","");var p=h.node().getBBox(),m=n.selectAll("rect");if(!l.textWidth||l.textWidth!=p.width){l.textWidth=p.width;var g=o._closeCrossHeight||p.height,v=o.model.locale.isRTL(),b=n.select("."+c+"-label-x").attr("transform","translate("+(v?-p.width-4:4)+","+.85*-p.height+")");this.updateLabelCloseGroupSize(b,g),m.attr("width",p.width+8).attr("height",1.2*p.height).attr("x",-p.width-4).attr("y",.85*-p.height).attr("rx",.2*p.height).attr("ry",.2*p.height),l.rectBBox=m.node().getBBox(),l.rectOffsetX=l.rectBBox.width+l.rectBBox.x,l.rectOffsetY=l.rectBBox.height+l.rectBBox.y}var y=n.select(".vzb-label-glow");y.attr("stroke")!==l.scaledC0&&y.attr("stroke",l.scaledC0)},updateLabelCloseGroupSize:function(t,e){t.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*e),t.select("svg").attr("x",.5*-e).attr("y",-.5*e).attr("width",e).attr("height",e)},updateLabelsOnlyTextSize:function(){var t=this,e=this.KEYS,i=this.KEY;this.entityLabels.each(function(n,r){t.cached[n[i]];t._updateLabelSize(n,r,null,d3.select(this),t.context.frame.size_label[a.getKey(n,e)]);var o=t.entityLines.filter(function(t){return t[i]==n[i]});t.positionLabel(n,r,null,this,0,null,o)})},updateLabelOnlyPosition:function(t,e,i){var n=this,r=this.KEY,o=this.cached[t[r]];i&&a.extend(o,i);var s=n.entityLines.filter(function(e){return e[r]==t[r]});this.entityLabels.filter(function(e){return e[r]==t[r]}).each(function(i){n.positionLabel(t,e,null,this,0,null,s)})},updateLabelOnlyColor:function(t,e,i){var n=this,r=this.KEY,o=this.cached[t[r]];i&&a.extend(o,i);var s=n.entityLabels.filter(function(e){return e[r]==t[r]});n._updateLabelSize(t,e,null,s,null)},positionLabel:function(t,e,i,n,r,o,s,l){var c=this.KEY,u=i||this.cached[t[c]],h=l||0===l,d=1&(l||0),f=(2&(l||0))>>1,p=0,m=0,g=this.context.width,v=this.context.height,b=this.xScale(u.labelX0),y=this.yScale(u.labelY0),_=u.rectOffsetX,x=u.rectOffsetY;u.labelOffset||(u.labelOffset=[0,0]),u.labelX_=u.labelOffset[0]||(.75*-u.scaledS0-_)/g,u.labelY_=u.labelOffset[1]||(.75*-u.scaledS0-x)/v;var w=b+u.labelX_*g,S=y+u.labelY_*v;if(u.labelOffset[0]+u.labelOffset[1]==0&&((!h&&S-u.rectBBox.height+x<=0||f)&&(m=1,u.labelY_=(.75*u.scaledS0+u.rectBBox.height-x)/v,S=y+u.labelY_*v),(!h&&w-u.rectBBox.width+_<=0||d)&&(p=1,u.labelX_=(.75*u.scaledS0+u.rectBBox.width-_)/g,(w=b+u.labelX_*g)>g&&(p=0,m=0==m&&y-.5*x-u.scaledS0<u.rectBBox.height?1:m,u.labelY_=m?.5*-x+u.rectBBox.height+u.scaledS0:1.5*-x-u.scaledS0,u.labelY_/=v,S=y+u.labelY_*v,u.labelX_=(u.rectBBox.width-_-b)/g,w=b+u.labelX_*g))),h){var M=!1;if(w-u.rectBBox.width+_<=0){var k=b-u.rectBBox.width,E=k>0?a.cathetus(u.scaledS0,k):u.scaledS0;S=m?y+u.rectBBox.height-.5*x+E:y-1.5*x-E,S-u.rectBBox.height<0&&(M=!0)}if(S-u.rectBBox.height+x<=0){var z=y-u.rectBBox.height,O=z>0?a.cathetus(u.scaledS0,z):u.scaledS0;w=p?b+u.rectBBox.width+O:b-2*_-O,(w-u.rectBBox.width<0||w>g)&&(M=!0)}if(M){m++;var T=b-u.rectBBox.width;S=y+u.rectBBox.height-.5*x+(T>0?a.cathetus(u.scaledS0,T):u.scaledS0)}}return this.label._repositionLabels(t,e,i,n,w,S,b,y,r,o,s),2*m+p},updateSize:function(){var t={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,labelLeashCoeff:.4},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,labelLeashCoeff:.2}},e={medium:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,labelLeashCoeff:.2}};this.activeProfile=this.context.getActiveProfile(t,e),this.updateLabelSizeLimits()}});e.default=f},function(t,e,i){(function(e){!function(e,i){t.exports=i(e)}(void 0!==e?e:this,function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,i=String(t),n=i.length,r=-1,a="",o=i.charCodeAt(0);++r<n;)e=i.charCodeAt(r),a+=0!=e?e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==o?"\\"+e.toString(16)+" ":(0!=r||1!=n||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?i.charAt(r):"\\"+i.charAt(r):"ï¿½";return a};return t.CSS||(t.CSS={}),t.CSS.escape=e,e})}).call(e,i(78))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(31),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a="",o=[];e.default=r.default.extend({init:function(t){this.context=t,this.shapes=[],this.groups=[],this.counter=0,this.name="",this.label=""},reset:function(){this.container.remove(),this.context.element.selectAll(".vzb-export-redball").remove(),this.context.element.selectAll(".vzb-export-counter").remove(),this.counter=0},prefix:function(t){return arguments.length?(a=t,this):a},deleteClasses:function(t){return arguments.length?(o=t,this):o},open:function(t,e){var i=this;this.svg&&this.reset(),t||(t=this.context.element),e||(e=this.context.name),this.name=e;var n=parseInt(t.style("width"),10)||0,r=parseInt(t.style("height"),10)||0;this.container=t.append("div").attr("class","vzb-svg-export"),this.svg=this.container.node().appendChild(t.select("svg").node().cloneNode(!0)),this.svg=d3.select(this.svg),this.svg.attr("viewBox","0 0 "+n+" "+r).attr("version","1.1").attr("param1","http://www.w3.org/2000/svg").attr("param2","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("style","enable-background:new 0 0 "+n+" "+r).attr("xml:space","preserve"),this.redBall=t.append("div").attr("class","vzb-export-redball").style("position","absolute").style("top","20px").style("right","20px").style("width","20px").style("height","20px").style("background","red").style("color","white").style("text-align","center").style("border-radius","10px").style("font-size","14px").style("line-height","20px").style("opacity",.8).style("cursor","pointer").on("mouseover",function(){d3.select(this).style("opacity",1).text("â–¼"),i.counterEl.text("Download")}).on("mouseout",function(){d3.select(this).style("opacity",.8).text(""),i.counterEl.text(i.label)}).on("click",function(){i.close()}),this.counterEl=t.append("div").attr("class","vzb-export-counter").style("position","absolute").style("top","20px").style("right","45px").style("color","red").style("opacity",.8).style("line-height","20px").style("font-size","14px").style("text-align","center"),this.root=this.svg.select("."+a+"graph"),this.root.selectAll("g, text, svg, line, rect").filter(function(){var t=d3.select(this),e=!1;return o.forEach(function(i){e=e||t.classed(i)}),e}).remove(),this.svg.selectAll(".tick line").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+a+"axis-x path").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+a+"axis-y path").attr("fill","none").attr("stroke","#999")},write:function(t){if(this.root||this.open(),!(this.shapes.indexOf(t.id+"_"+t.time)>-1)){this.shapes.push(t.id+"_"+t.time),-1==this.groups.indexOf(t.time)&&(this.root.append("g").attr("id","g_"+t.time),this.groups.push(t.time)),null==t.opacity&&(t.opacity=.5),null==t.fill&&(t.fill="#ff80dd");var e=this.root.select("#g_"+t.time).append(t.type).attr("id",t.id+"_"+t.time).style("fill",t.fill).style("opacity",t.opacity);switch(t.type){case"path":e.attr("d",t.d);break;case"circle":e.attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}this.counter++,this.redBall.style("opacity",this.counter%10/12+.2),this.label=t.type+" shapes: "+this.counter,this.counterEl.text(this.label)}},close:function(){var t='<?xml version="1.0" encoding="utf-8"?> '+this.container.node().innerHTML.replace("param1","xmlns").replace("param2","xmlns:xlink").replace(/\d+(\.\d+)/g,function(t){return Math.round(100*+t)/100+""});if(t.length/1024/1024>2)alert("The file size is "+Math.round(t.length/1024)+"kB, which is too large to download. Will try to print it in the console instead..."),console.log(t);else{var e=document.createElement("a");e.download=this.name+" "+this.counter+" shapes.svg",e.href="data:,"+t,e.click()}}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(31),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a=r.default.extend({init:function(t){this.context=t,this.interact=this._createInteract()},setTooltip:function(t){this.tooltip=t},_createInteract:function(){var t=this;return{mouseOver:function(){var e=d3.event,i=d3.mouse(t.context.element.node());t._setTooltip(d3.select(e.target).attr("data-text"),i[0],i[1])},mouseOut:function(){t._setTooltip()},tap:function(){}}},_setTooltip:function(t,e,i){if(t){this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(t);var n=this.tooltip.select("text").node().getBBox();e-n.width<0?e+=n.width+5:e-=5,i-n.height<0?i+=n.height:i-=11,this.tooltip.attr("transform","translate("+e+","+i+")"),this.tooltip.selectAll("rect").attr("width",n.width+8).attr("height",1.2*n.height).attr("x",-n.width-4).attr("y",.85*-n.height).attr("rx",.2*n.height).attr("ry",.2*n.height)}else this.tooltip.classed("vzb-hidden",!0)},clear:function(t){t.attr("data-text",null)},wrap:function(t,e){var i=d3.select(t),n=Math.abs,r=i.attr("data-text");r||(r=i.text(),i.attr("data-text",r)),i.text(r);for(var a=r,o=a.length,s=i.node().getComputedTextLength();e-s<=0&&""!==a;)a=s>=e?a.slice(0,-n(.5*o)):r.slice(0,n(.5*o)),i.text(a+"â€¦"),s=i.node().getComputedTextLength(),o=a.length;a!==r?(""===a&&i.text(r[0]),i.on("mouseover.tooltip",this.interact.mouseOver).on("mouseout.tooltip",this.interact.mouseOut).style("pointer-events","all")):i.on("mouseover.tooltip",null).on("mouseout.tooltip",null).style("pointer-events",null)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,e){function i(e){var i,n=t.arcs[e<0?~e:e],r=n[0];return t.transform?(i=[0,0],n.forEach(function(t){i[0]+=t[0],i[1]+=t[1]})):i=n[n.length-1],e<0?[i,r]:[r,i]}function n(t,e){for(var i in t){var n=t[i];delete e[n.start],delete n.start,delete n.end,n.forEach(function(t){r[t<0?~t:t]=1}),s.push(n)}}var r={},a={},o={},s=[],l=-1;return e.forEach(function(i,n){var r,a=t.arcs[i<0?~i:i];a.length<3&&!a[1][0]&&!a[1][1]&&(r=e[++l],e[l]=i,e[n]=r)}),e.forEach(function(t){var e,n,r=i(t),s=r[0],l=r[1];if(e=o[s])if(delete o[e.end],e.push(t),e.end=l,n=a[l]){delete a[n.start];var c=n===e?e:e.concat(n);a[c.start=e.start]=o[c.end=n.end]=c}else a[e.start]=o[e.end]=e;else if(e=a[l])if(delete a[e.start],e.unshift(t),e.start=s,n=o[s]){delete o[n.end];var u=n===e?e:n.concat(e);a[u.start=n.start]=o[u.end=e.end]=u}else a[e.start]=o[e.end]=e;else e=[t],a[e.start=s]=o[e.end=l]=e}),n(o,a),n(a,o),e.forEach(function(t){r[t<0?~t:t]||s.push([t])}),s}function e(e,i,n){function r(t){var e=t<0?~t:t;(u[e]||(u[e]=[])).push({i:t,g:c})}function a(t){t.forEach(r)}function o(t){t.forEach(a)}function s(t){"GeometryCollection"===t.type?t.geometries.forEach(s):t.type in h&&(c=t,h[t.type](t.arcs))}var l=[];if(arguments.length>1){var c,u=[],h={LineString:a,MultiLineString:o,Polygon:o,MultiPolygon:function(t){t.forEach(o)}};s(i),u.forEach(arguments.length<3?function(t){l.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&l.push(t[0].i)})}else for(var d=0,f=e.arcs.length;d<f;++d)l.push(d);return{type:"MultiLineString",arcs:t(e,l)}}function i(e,i){function r(t){t.forEach(function(e){e.forEach(function(e){(s[e=e<0?~e:e]||(s[e]=[])).push(t)})}),l.push(t)}function a(t){return h(o(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}var s={},l=[],c=[];return i.forEach(function(t){"Polygon"===t.type?r(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(r)}),l.forEach(function(t){if(!t._){var e=[],i=[t];for(t._=1,c.push(e);t=i.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){s[t<0?~t:t].forEach(function(t){t._||(t._=1,i.push(t))})})})}}),l.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:c.map(function(i){var r=[];if(i.forEach(function(t){t.forEach(function(t){t.forEach(function(t){s[t<0?~t:t].length<2&&r.push(t)})})}),r=t(e,r),(n=r.length)>1)for(var o,l=a(i[0][0]),c=0;c<n;++c)if(l===a(r[c])){o=r[0],r[0]=r[c],r[c]=o;break}return r})}}function r(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return a(t,e)})}:a(t,e)}function a(t,e){var i={type:"Feature",id:e.id,properties:e.properties||{},geometry:o(t,e)};return null==e.id&&delete i.id,i}function o(t,e){function i(t,e){e.length&&e.pop();for(var i,n=u[t<0?~t:t],r=0,a=n.length;r<a;++r)e.push(i=n[r].slice()),c(i,r);t<0&&s(e,a)}function n(t){return t=t.slice(),c(t,0),t}function r(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0].slice()),e}function a(t){for(var e=r(t);e.length<4;)e.push(e[0].slice());return e}function o(t){return t.map(a)}function l(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(l)}:e in h?{type:e,coordinates:h[e](t)}:null}var c=m(t.transform),u=t.arcs,h={Point:function(t){return n(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(n)},LineString:function(t){return r(t.arcs)},MultiLineString:function(t){return t.arcs.map(r)},Polygon:function(t){return o(t.arcs)},MultiPolygon:function(t){return t.arcs.map(o)}};return l(e)}function s(t,e){for(var i,n=t.length,r=n-e;r<--n;)i=t[r],t[r++]=t[n],t[n]=i}function l(t,e){for(var i=0,n=t.length;i<n;){var r=i+n>>>1;t[r]<e?i=r+1:n=r}return i}function c(t){function e(t,e){t.forEach(function(t){t<0&&(t=~t);var i=r[t];i?i.push(e):r[t]=[e]})}function i(t,i){t.forEach(function(t){e(t,i)})}function n(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){n(t,e)}):t.type in o&&o[t.type](t.arcs,e)}var r={},a=t.map(function(){return[]}),o={LineString:e,MultiLineString:i,Polygon:i,MultiPolygon:function(t,e){t.forEach(function(t){i(t,e)})}};t.forEach(n);for(var s in r)for(var c=r[s],u=c.length,h=0;h<u;++h)for(var d=h+1;d<u;++d){var f,p=c[h],m=c[d];(f=a[p])[s=l(f,m)]!==m&&f.splice(s,0,m),(f=a[m])[s=l(f,p)]!==p&&f.splice(s,0,p)}return a}function u(t,e){function i(t){a.remove(t),t[1][2]=e(t),a.push(t)}var n=m(t.transform),r=g(t.transform),a=p();return e||(e=d),t.arcs.forEach(function(t){for(var o,s,l=[],c=0,u=0,h=t.length;u<h;++u)s=t[u],n(t[u]=[s[0],s[1],1/0],u);for(var u=1,h=t.length-1;u<h;++u)o=t.slice(u-1,u+2),o[1][2]=e(o),l.push(o),a.push(o);for(var u=0,h=l.length;u<h;++u)o=l[u],o.previous=l[u-1],o.next=l[u+1];for(;o=a.pop();){var d=o.previous,f=o.next;o[1][2]<c?o[1][2]=c:c=o[1][2],d&&(d.next=f,d[2]=o[2],i(d)),f&&(f.previous=d,f[0]=o[0],i(f))}t.forEach(r)}),t}function h(t){for(var e,i=-1,n=t.length,r=t[n-1],a=0;++i<n;)e=r,r=t[i],a+=e[0]*r[1]-e[1]*r[0];return.5*a}function d(t){var e=t[0],i=t[1],n=t[2];return Math.abs((e[0]-n[0])*(i[1]-e[1])-(e[0]-i[0])*(n[1]-e[1]))}function f(t,e){return t[1][2]-e[1][2]}function p(){function t(t,e){for(;e>0;){var i=(e+1>>1)-1,r=n[i];if(f(t,r)>=0)break;n[r._=e]=r,n[t._=e=i]=t}}function e(t,e){for(;;){var i=e+1<<1,a=i-1,o=e,s=n[o];if(a<r&&f(n[a],s)<0&&(s=n[o=a]),i<r&&f(n[i],s)<0&&(s=n[o=i]),o===e)break;n[s._=e]=s,n[t._=e=o]=t}}var i={},n=[],r=0;return i.push=function(e){return t(n[e._=r]=e,r++),r},i.pop=function(){if(!(r<=0)){var t,i=n[0];return--r>0&&(t=n[r],e(n[t._=0]=t,0)),i}},i.remove=function(i){var a,o=i._;if(n[o]===i)return o!==--r&&(a=n[r],(f(a,i)<0?t:e)(n[a._=o]=a,o)),o},i}function m(t){if(!t)return v;var e,i,n=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=i=0),t[0]=(e+=t[0])*n+a,t[1]=(i+=t[1])*r+o}}function g(t){if(!t)return v;var e,i,n=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=i=0);var l=(t[0]-a)/n|0,c=(t[1]-o)/r|0;t[0]=l-e,t[1]=c-i,e=l,i=c}}function v(){}return{version:"1.6.19",mesh:function(t){return o(t,e.apply(this,arguments))},meshArcs:e,merge:function(t){return o(t,i.apply(this,arguments))},mergeArcs:i,feature:r,neighbors:c,presimplify:u}}()},function(t,e){}])})},function(t,e){var i=function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=45)}([function(t,e,i){"use strict";var n=Array.isArray;t.exports=n},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(29),a="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,o=r||a||Function("return this")();t.exports=o},function(t,e,i){"use strict";function n(t,e){var i=a(t,e);return r(i)?i:void 0}var r=i(61),a=i(67);t.exports=n},function(t,e,i){"use strict";function n(t){return null==t?void 0===t?l:s:c&&c in Object(t)?a(t):o(t)}var r=i(11),a=i(63),o=i(64),s="[object Null]",l="[object Undefined]",c=r?r.toStringTag:void 0;t.exports=n},function(t,e,i){"use strict";function n(t){return null!=t&&"object"==(void 0===t?"undefined":r(t))}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=n},function(t,e,i){"use strict";function n(t){var e=void 0===t?"undefined":r(t);return null!=t&&("object"==e||"function"==e)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=n},function(t,e,i){"use strict";function n(t){return null==t?"":r(t)}var r=i(7);t.exports=n},function(t,e,i){"use strict";function n(t){if("string"==typeof t)return t;if(o(t))return a(t,n)+"";if(s(t))return u?u.call(t):"";var e=t+"";return"0"==e&&1/t==-l?"-0":e}var r=i(11),a=i(26),o=i(0),s=i(15),l=1/0,c=r?r.prototype:void 0,u=c?c.toString:void 0;t.exports=n},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}var r=i(51),a=i(52),o=i(53),s=i(54),l=i(55);n.prototype.clear=r,n.prototype.delete=a,n.prototype.get=o,n.prototype.has=s,n.prototype.set=l,t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=t.length;i--;)if(r(t[i][0],e))return i;return-1}var r=i(10);t.exports=n},function(t,e,i){"use strict";function n(t,e){return t===e||t!==t&&e!==e}t.exports=n},function(t,e,i){"use strict";var n=i(1),r=n.Symbol;t.exports=r},function(t,e,i){"use strict";var n=i(2),r=n(Object,"create");t.exports=r},function(t,e,i){"use strict";function n(t,e){var i=t.__data__;return r(e)?i["string"==typeof e?"string":"hash"]:i.map}var r=i(76);t.exports=n},function(t,e,i){"use strict";function n(t){return null!=t&&a(t.length)&&!r(t)}var r=i(28),a=i(22);t.exports=n},function(t,e,i){"use strict";function n(t){return"symbol"==(void 0===t?"undefined":r(t))||o(t)&&a(t)==s}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(3),o=i(4),s="[object Symbol]";t.exports=n},function(t,e,i){"use strict";function n(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-a?"-0":e}var r=i(15),a=1/0;t.exports=n},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.WS_RESPONSE_ERROR="WS response error",e.NETWORK_ERROR="Network error",e.WS_BAD_RESPONSE="WS bad response",e.WS_ERROR="WS error",e.WS_MESSAGE="WS message",e.WsError=function(t){function e(t,i){n(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.name="WaffleServerError",a.message=t,a.details=i,a.endpoint=null,a.url=null,a.ddfql=null,a}return a(e,t),e}(Error)},function(t,e,i){"use strict";var n=i(2),r=i(1),a=n(r,"Map");t.exports=a},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}var r=i(68),a=i(75),o=i(77),s=i(78),l=i(79);n.prototype.clear=r,n.prototype.delete=a,n.prototype.get=o,n.prototype.has=s,n.prototype.set=l,t.exports=n},function(t,e,i){"use strict";function n(t){return o(t)?r(t):a(t)}var r=i(97),a=i(102),o=i(14);t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=void 0===t?"undefined":r(t);return!!(e=null==e?a:e)&&("number"==i||"symbol"!=i&&o.test(t))&&t>-1&&t%1==0&&t<e}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=n},function(t,e,i){"use strict";function n(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}var r=9007199254740991;t.exports=n},function(t,e,i){"use strict";function n(t,e){if(a(t))return!1;var i=void 0===t?"undefined":r(t);return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!o(t))||l.test(t)||!s.test(t)||null!=e&&t in Object(e)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(0),o=i(15),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,l=/^\w*$/;t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=t.length;return i=void 0===i?n:i,!e&&i>=n?t:r(t,e,i)}var r=i(144);t.exports=n},function(t,e,i){"use strict";function n(t){return a(t)?o(t):r(t)}var r=i(148),a=i(43),o=i(149);t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.__data__=new r(t);this.size=e.size}var r=i(8),a=i(56),o=i(57),s=i(58),l=i(59),c=i(60);n.prototype.clear=a,n.prototype.delete=o,n.prototype.get=s,n.prototype.has=l,n.prototype.set=c,t.exports=n},function(t,e,i){"use strict";function n(t){if(!a(t))return!1;var e=r(t);return e==s||e==l||e==o||e==c}var r=i(3),a=i(5),o="[object AsyncFunction]",s="[object Function]",l="[object GeneratorFunction]",c="[object Proxy]";t.exports=n},function(t,e,i){"use strict";(function(e){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n="object"==(void 0===e?"undefined":i(e))&&e&&e.Object===Object&&e;t.exports=n}).call(e,i(62))},function(t,e,i){"use strict";function n(t){if(null!=t){try{return a.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var r=Function.prototype,a=r.toString;t.exports=n},function(t,e,i){"use strict";function n(t,e,i,o,s){return t===e||(null==t||null==e||!a(t)&&!a(e)?t!==t&&e!==e:r(t,e,i,o,n,s))}var r=i(80),a=i(4);t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n,c,u){var h=i&s,d=t.length,f=e.length;if(d!=f&&!(h&&f>d))return!1;var p=u.get(t);if(p&&u.get(e))return p==e;var m=-1,g=!0,v=i&l?new r:void 0;for(u.set(t,e),u.set(e,t);++m<d;){var b=t[m],y=e[m];if(n)var _=h?n(y,b,m,e,t,u):n(b,y,m,t,e,u);if(void 0!==_){if(_)continue;g=!1;break}if(v){if(!a(e,function(t,e){if(!o(v,e)&&(b===t||c(b,t,i,n,u)))return v.push(e)})){g=!1;break}}else if(b!==y&&!c(b,y,i,n,u)){g=!1;break}}return u.delete(t),u.delete(e),g}var r=i(81),a=i(84),o=i(85),s=1,l=2;t.exports=n},function(t,e,i){"use strict";var n=i(99),r=i(4),a=Object.prototype,o=a.hasOwnProperty,s=a.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(t){return r(t)&&o.call(t,"callee")&&!s.call(t,"callee")};t.exports=l},function(t,e,i){"use strict";(function(t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(1),a=i(100),o="object"==n(e)&&e&&!e.nodeType&&e,s=o&&"object"==n(t)&&t&&!t.nodeType&&t,l=s&&s.exports===o,c=l?r.Buffer:void 0,u=c?c.isBuffer:void 0,h=u||a;t.exports=h}).call(e,i(35)(t))},function(t,e,i){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){"use strict";var n=i(101),r=i(37),a=i(38),o=a&&a.isTypedArray,s=o?r(o):n;t.exports=s},function(t,e,i){"use strict";function n(t){return function(e){return t(e)}}t.exports=n},function(t,e,i){"use strict";(function(t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(29),a="object"==n(e)&&e&&!e.nodeType&&e,o=a&&"object"==n(t)&&t&&!t.nodeType&&t,s=o&&o.exports===a,l=s&&r.process,c=function(){try{return l&&l.binding&&l.binding("util")}catch(t){}}();t.exports=c}).call(e,i(35)(t))},function(t,e,i){"use strict";function n(t){return t===t&&!r(t)}var r=i(5);t.exports=n},function(t,e,i){"use strict";function n(t,e){return function(i){return null!=i&&i[t]===e&&(void 0!==e||t in Object(i))}}t.exports=n},function(t,e,i){"use strict";function n(t,e){e=r(e,t);for(var i=0,n=e.length;null!=t&&i<n;)t=t[a(e[i++])];return i&&i==n?t:void 0}var r=i(42),a=i(16);t.exports=n},function(t,e,i){"use strict";function n(t,e){return r(t)?t:a(t,e)?[t]:o(s(t))}var r=i(0),a=i(23),o=i(114),s=i(6);t.exports=n},function(t,e,i){"use strict";function n(t){return r.test(t)}var r=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=n},function(t,e,i){"use strict";function n(t,e,i){return e===e?o(t,e,i):r(t,a,i)}var r=i(152),a=i(153),o=i(154);t.exports=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WsReader=e.WsError=void 0;var n=i(17);Object.defineProperty(e,"WsError",{enumerable:!0,get:function(){return n.WsError}});var r=i(46),a=i(136),o=i(159),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o);e.WsReader={getReader:function(){for(var t={ajax:s.ajax},e=(0,a.getBaseWsReader)(t),i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];return Object.assign.apply(Object,[e].concat(n)),Object.assign({},e,r.WsJsonReader)}}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.WsJsonReader=void 0;var r=i(47),a=n(r),o=i(130),s=n(o),l=i(135),c=n(l);e.WsJsonReader={_toPojo:function(t){var e=t.rows,i=t.headers;return(0,a.default)(e,function(t){return(0,s.default)(i,(0,a.default)(t,function(t){return(0,c.default)(t)?null:t}))})}}},function(t,e,i){"use strict";function n(t,e){return(s(t)?r:o)(t,a(e,3))}var r=i(26),a=i(48),o=i(124),s=i(0);t.exports=n},function(t,e,i){"use strict";function n(t){return"function"==typeof t?t:null==t?s:"object"==(void 0===t?"undefined":r(t))?l(t)?o(t[0],t[1]):a(t):c(t)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(49),o=i(112),s=i(120),l=i(0),c=i(121);t.exports=n},function(t,e,i){"use strict";function n(t){var e=a(t);return 1==e.length&&e[0][2]?o(e[0][0],e[0][1]):function(i){return i===t||r(i,t,e)}}var r=i(50),a=i(111),o=i(40);t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n){var l=i.length,c=l,u=!n;if(null==t)return!c;for(t=Object(t);l--;){var h=i[l];if(u&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++l<c;){h=i[l];var d=h[0],f=t[d],p=h[1];if(u&&h[2]){if(void 0===f&&!(d in t))return!1}else{var m=new r;if(n)var g=n(f,p,d,t,e,m);if(!(void 0===g?a(p,f,o|s,n,m):g))return!1}}return!0}var r=i(27),a=i(31),o=1,s=2;t.exports=n},function(t,e,i){"use strict";function n(){this.__data__=[],this.size=0}t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.__data__,i=r(e,t);return!(i<0||(i==e.length-1?e.pop():o.call(e,i,1),--this.size,0))}var r=i(9),a=Array.prototype,o=a.splice;t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.__data__,i=r(e,t);return i<0?void 0:e[i][1]}var r=i(9);t.exports=n},function(t,e,i){"use strict";function n(t){return r(this.__data__,t)>-1}var r=i(9);t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=this.__data__,n=r(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this}var r=i(9);t.exports=n},function(t,e,i){"use strict";function n(){this.__data__=new r,this.size=0}var r=i(8);t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}t.exports=n},function(t,e,i){"use strict";function n(t){return this.__data__.get(t)}t.exports=n},function(t,e,i){"use strict";function n(t){return this.__data__.has(t)}t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=this.__data__;if(i instanceof r){var n=i.__data__;if(!a||n.length<s-1)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new o(n)}return i.set(t,e),this.size=i.size,this}var r=i(8),a=i(18),o=i(19),s=200;t.exports=n},function(t,e,i){"use strict";function n(t){return!(!o(t)||a(t))&&(r(t)?p:c).test(s(t))}var r=i(28),a=i(65),o=i(5),s=i(30),l=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,u=Function.prototype,h=Object.prototype,d=u.toString,f=h.hasOwnProperty,p=RegExp("^"+d.call(f).replace(l,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=n},function(t,e,i){"use strict";var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"===("undefined"==typeof window?"undefined":r(window))&&(n=window)}t.exports=n},function(t,e,i){"use strict";function n(t){var e=o.call(t,l),i=t[l];try{t[l]=void 0;var n=!0}catch(t){}var r=s.call(t);return n&&(e?t[l]=i:delete t[l]),r}var r=i(11),a=Object.prototype,o=a.hasOwnProperty,s=a.toString,l=r?r.toStringTag:void 0;t.exports=n},function(t,e,i){"use strict";function n(t){return a.call(t)}var r=Object.prototype,a=r.toString;t.exports=n},function(t,e,i){"use strict";function n(t){return!!a&&a in t}var r=i(66),a=function(){var t=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=n},function(t,e,i){"use strict";var n=i(1),r=n["__core-js_shared__"];t.exports=r},function(t,e,i){"use strict";function n(t,e){return null==t?void 0:t[e]}t.exports=n},function(t,e,i){"use strict";function n(){this.size=0,this.__data__={hash:new r,map:new(o||a),string:new r}}var r=i(69),a=i(8),o=i(18);t.exports=n},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}var r=i(70),a=i(71),o=i(72),s=i(73),l=i(74);n.prototype.clear=r,n.prototype.delete=a,n.prototype.get=o,n.prototype.has=s,n.prototype.set=l,t.exports=n},function(t,e,i){"use strict";function n(){this.__data__=r?r(null):{},this.size=0}var r=i(12);t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.__data__;if(r){var i=e[t];return i===a?void 0:i}return s.call(e,t)?e[t]:void 0}var r=i(12),a="__lodash_hash_undefined__",o=Object.prototype,s=o.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}var r=i(12),a=Object.prototype,o=a.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=r&&void 0===e?a:e,this}var r=i(12),a="__lodash_hash_undefined__";t.exports=n},function(t,e,i){"use strict";function n(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}var r=i(13);t.exports=n},function(t,e,i){"use strict";function n(t){var e=void 0===t?"undefined":r(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=n},function(t,e,i){"use strict";function n(t){return r(this,t).get(t)}var r=i(13);t.exports=n},function(t,e,i){"use strict";function n(t){return r(this,t).has(t)}var r=i(13);t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=r(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this}var r=i(13);t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n,g,b){var y=c(t),_=c(e),x=y?p:l(t),w=_?p:l(e);x=x==f?m:x,w=w==f?m:w;var S=x==m,M=w==m,k=x==w;if(k&&u(t)){if(!u(e))return!1;y=!0,S=!1}if(k&&!S)return b||(b=new r),y||h(t)?a(t,e,i,n,g,b):o(t,e,x,i,n,g,b);if(!(i&d)){var E=S&&v.call(t,"__wrapped__"),z=M&&v.call(e,"__wrapped__");if(E||z){var O=E?t.value():t,T=z?e.value():e;return b||(b=new r),g(O,T,i,n,b)}}return!!k&&(b||(b=new r),s(t,e,i,n,g,b))}var r=i(27),a=i(32),o=i(86),s=i(90),l=i(106),c=i(0),u=i(34),h=i(36),d=1,f="[object Arguments]",p="[object Array]",m="[object Object]",g=Object.prototype,v=g.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new r;++e<i;)this.add(t[e])}var r=i(19),a=i(82),o=i(83);n.prototype.add=n.prototype.push=a,n.prototype.has=o,t.exports=n},function(t,e,i){"use strict";function n(t){return this.__data__.set(t,r),this}var r="__lodash_hash_undefined__";t.exports=n},function(t,e,i){"use strict";function n(t){return this.__data__.has(t)}t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}t.exports=n},function(t,e,i){"use strict";function n(t,e){return t.has(e)}t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n,r,S,k){switch(i){case w:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!S(new a(t),new a(e)));case d:case f:case g:return o(+t,+e);case p:return t.name==e.name&&t.message==e.message;case v:case y:return t==e+"";case m:var E=l;case b:var z=n&u;if(E||(E=c),t.size!=e.size&&!z)return!1;var O=k.get(t);if(O)return O==e;n|=h,k.set(t,e);var T=s(E(t),E(e),n,r,S,k);return k.delete(t),T;case _:if(M)return M.call(t)==M.call(e)}return!1}var r=i(11),a=i(87),o=i(10),s=i(32),l=i(88),c=i(89),u=1,h=2,d="[object Boolean]",f="[object Date]",p="[object Error]",m="[object Map]",g="[object Number]",v="[object RegExp]",b="[object Set]",y="[object String]",_="[object Symbol]",x="[object ArrayBuffer]",w="[object DataView]",S=r?r.prototype:void 0,M=S?S.valueOf:void 0;t.exports=n},function(t,e,i){"use strict";var n=i(1),r=n.Uint8Array;t.exports=r},function(t,e,i){"use strict";function n(t){var e=-1,i=Array(t.size);return t.forEach(function(t,n){i[++e]=[n,t]}),i}t.exports=n},function(t,e,i){"use strict";function n(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n,o,l){var c=i&a,u=r(t),h=u.length;if(h!=r(e).length&&!c)return!1;for(var d=h;d--;){var f=u[d];if(!(c?f in e:s.call(e,f)))return!1}var p=l.get(t);if(p&&l.get(e))return p==e;var m=!0;l.set(t,e),l.set(e,t);for(var g=c;++d<h;){f=u[d];var v=t[f],b=e[f];if(n)var y=c?n(b,v,f,e,t,l):n(v,b,f,t,e,l);if(!(void 0===y?v===b||o(v,b,i,n,l):y)){m=!1;break}g||(g="constructor"==f)}if(m&&!g){var _=t.constructor,x=e.constructor;_!=x&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x)&&(m=!1)}return l.delete(t),l.delete(e),m}var r=i(91),a=1,o=Object.prototype,s=o.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t){return r(t,o,a)}var r=i(92),a=i(94),o=i(20);t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=e(t);return a(t)?n:r(n,i(t))}var r=i(93),a=i(0);t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}t.exports=n},function(t,e,i){"use strict";var n=i(95),r=i(96),a=Object.prototype,o=a.propertyIsEnumerable,s=Object.getOwnPropertySymbols,l=s?function(t){return null==t?[]:(t=Object(t),n(s(t),function(e){return o.call(t,e)}))}:r;t.exports=l},function(t,e,i){"use strict";function n(t,e){for(var i=-1,n=null==t?0:t.length,r=0,a=[];++i<n;){var o=t[i];e(o,i,t)&&(a[r++]=o)}return a}t.exports=n},function(t,e,i){"use strict";function n(){return[]}t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=o(t),n=!i&&a(t),u=!i&&!n&&s(t),d=!i&&!n&&!u&&c(t),f=i||n||u||d,p=f?r(t.length,String):[],m=p.length;for(var g in t)!e&&!h.call(t,g)||f&&("length"==g||u&&("offset"==g||"parent"==g)||d&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||l(g,m))||p.push(g);return p}var r=i(98),a=i(33),o=i(0),s=i(34),l=i(21),c=i(36),u=Object.prototype,h=u.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}t.exports=n},function(t,e,i){"use strict";function n(t){return a(t)&&r(t)==o}var r=i(3),a=i(4),o="[object Arguments]";t.exports=n},function(t,e,i){"use strict";function n(){return!1}t.exports=n},function(t,e,i){"use strict";function n(t){return o(t)&&a(t.length)&&!!s[r(t)]}var r=i(3),a=i(22),o=i(4),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,t.exports=n},function(t,e,i){"use strict";function n(t){if(!r(t))return a(t);var e=[];for(var i in Object(t))s.call(t,i)&&"constructor"!=i&&e.push(i);return e}var r=i(103),a=i(104),o=Object.prototype,s=o.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}var r=Object.prototype;t.exports=n},function(t,e,i){"use strict";var n=i(105),r=n(Object.keys,Object);t.exports=r},function(t,e,i){"use strict";function n(t,e){return function(i){return t(e(i))}}t.exports=n},function(t,e,i){"use strict";var n=i(107),r=i(18),a=i(108),o=i(109),s=i(110),l=i(3),c=i(30),u=c(n),h=c(r),d=c(a),f=c(o),p=c(s),m=l;(n&&"[object DataView]"!=m(new n(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||a&&"[object Promise]"!=m(a.resolve())||o&&"[object Set]"!=m(new o)||s&&"[object WeakMap]"!=m(new s))&&(m=function(t){var e=l(t),i="[object Object]"==e?t.constructor:void 0,n=i?c(i):"";if(n)switch(n){case u:return"[object DataView]";case h:return"[object Map]";case d:return"[object Promise]";case f:return"[object Set]";case p:return"[object WeakMap]"}return e}),t.exports=m},function(t,e,i){"use strict";var n=i(2),r=i(1),a=n(r,"DataView");t.exports=a},function(t,e,i){"use strict";var n=i(2),r=i(1),a=n(r,"Promise");t.exports=a},function(t,e,i){"use strict";var n=i(2),r=i(1),a=n(r,"Set");t.exports=a},function(t,e,i){"use strict";var n=i(2),r=i(1),a=n(r,"WeakMap");t.exports=a},function(t,e,i){"use strict";function n(t){for(var e=a(t),i=e.length;i--;){var n=e[i],o=t[n];e[i]=[n,o,r(o)]}return e}var r=i(39),a=i(20);t.exports=n},function(t,e,i){"use strict";function n(t,e){return s(t)&&l(e)?c(u(t),e):function(i){var n=a(i,t);return void 0===n&&n===e?o(i,t):r(e,n,h|d)}}var r=i(31),a=i(113),o=i(117),s=i(23),l=i(39),c=i(40),u=i(16),h=1,d=2;t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=null==t?void 0:r(t,e);return void 0===n?i:n}var r=i(41);t.exports=n},function(t,e,i){"use strict";var n=i(115),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,o=n(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(r,function(t,i,n,r){e.push(n?r.replace(a,"$1"):i||t)}),e});t.exports=o},function(t,e,i){"use strict";function n(t){var e=r(t,function(t){return i.size===a&&i.clear(),t}),i=e.cache;return e}var r=i(116),a=500;t.exports=n},function(t,e,i){"use strict";function n(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(a);var i=function i(){var n=arguments,r=e?e.apply(this,n):n[0],a=i.cache;if(a.has(r))return a.get(r);var o=t.apply(this,n);return i.cache=a.set(r,o)||a,o};return i.cache=new(n.Cache||r),i}var r=i(19),a="Expected a function";n.Cache=r,t.exports=n},function(t,e,i){"use strict";function n(t,e){return null!=t&&a(t,e,r)}var r=i(118),a=i(119);t.exports=n},function(t,e,i){"use strict";function n(t,e){return null!=t&&e in Object(t)}t.exports=n},function(t,e,i){"use strict";function n(t,e,i){e=r(e,t);for(var n=-1,u=e.length,h=!1;++n<u;){var d=c(e[n]);if(!(h=null!=t&&i(t,d)))break;t=t[d]}return h||++n!=u?h:!!(u=null==t?0:t.length)&&l(u)&&s(d,u)&&(o(t)||a(t))}var r=i(42),a=i(33),o=i(0),s=i(21),l=i(22),c=i(16);t.exports=n},function(t,e,i){"use strict";function n(t){return t}t.exports=n},function(t,e,i){"use strict";function n(t){return o(t)?r(s(t)):a(t)}var r=i(122),a=i(123),o=i(23),s=i(16);t.exports=n},function(t,e,i){"use strict";function n(t){return function(e){return null==e?void 0:e[t]}}t.exports=n},function(t,e,i){"use strict";function n(t){return function(e){return r(e,t)}}var r=i(41);t.exports=n},function(t,e,i){"use strict";function n(t,e){var i=-1,n=a(t)?Array(t.length):[];return r(t,function(t,r,a){n[++i]=e(t,r,a)}),n}var r=i(125),a=i(14);t.exports=n},function(t,e,i){"use strict";var n=i(126),r=i(129),a=r(n);t.exports=a},function(t,e,i){"use strict";function n(t,e){return t&&r(t,e,a)}var r=i(127),a=i(20);t.exports=n},function(t,e,i){"use strict";var n=i(128),r=n();t.exports=r},function(t,e,i){"use strict";function n(t){return function(e,i,n){for(var r=-1,a=Object(e),o=n(e),s=o.length;s--;){var l=o[t?s:++r];if(!1===i(a[l],l,a))break}return e}}t.exports=n},function(t,e,i){"use strict";function n(t,e){return function(i,n){if(null==i)return i;if(!r(i))return t(i,n);for(var a=i.length,o=e?a:-1,s=Object(i);(e?o--:++o<a)&&!1!==n(s[o],o,s););return i}}var r=i(14);t.exports=n},function(t,e,i){"use strict";function n(t,e){return a(t||[],e||[],r)}var r=i(131),a=i(134);t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=t[e];s.call(t,e)&&a(n,i)&&(void 0!==i||e in t)||r(t,e,i)}var r=i(132),a=i(10),o=Object.prototype,s=o.hasOwnProperty;t.exports=n},function(t,e,i){"use strict";function n(t,e,i){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var r=i(133);t.exports=n},function(t,e,i){"use strict";var n=i(2),r=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=r},function(t,e,i){"use strict";function n(t,e,i){for(var n=-1,r=t.length,a=e.length,o={};++n<r;){var s=n<a?e[n]:void 0;i(o,t[n],s)}return o}t.exports=n},function(t,e,i){"use strict";function n(t){return null==t}t.exports=n},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function a(t){return{init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._name="waffle",this._dataset=t.dataset,this._assetsPath=(0,g.default)(t.assetsPath||"/api/ddf/assets","/"),this._basepath=t.path,this._dataset_access_token=t.dataset_access_token,this.versionInfo={version:"2.5.0",build:1522324694627},this._basepath||console.error("There is no base path for waffle reader, please, consider to provide one")},getAsset:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._toDatasetPath(i.dataset||this._dataset),r=(0,b.default)(e,"/"),a=(0,l.default)(r,".json"),o=i.dataset_access_token||this._dataset_access_token?"dataset_access_token="+(i.dataset_access_token||this._dataset_access_token):"",s=this._assetsPath+"/"+n+"/"+r;return t.ajax({url:o?s+"?"+o:s,json:a})},_toDatasetPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if("default"===t)return t;var e=(0,p.default)(t,"#"),i=o(e,2),n=i[0],r=i[1],a=void 0===r?"master":r;return n?n+"/"+a:"default"},read:function(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.dataset||this._dataset,a=(0,d.default)(r)?Object.assign({},e,{dataset:encodeURIComponent(r)}):e;this._dataset_access_token&&(a.dataset_access_token=this._dataset_access_token);var o=this._basepath+"?"+_.stringify(a),s=this._basepath;return t.ajax({url:o,json:!0}).then(function(t){var e=null;if((0,u.default)(t)?t.error?e=new S.WsError(S.WS_ERROR,t.error):t.message&&(e=new S.WsError(S.WS_MESSAGE,t.message)):e=new S.WsError(S.WS_BAD_RESPONSE,t),e){var r=Object.assign(e,{endpoint:s,url:o,ddfql:a});return Promise.reject(r)}return w.mapRows(i._toPojo(t),n)}).catch(function(t){var e=Object.assign(t,{endpoint:s,url:o,ddfql:a});return Promise.reject(e)})}}}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.getBaseWsReader=a;var s=i(137),l=r(s),c=i(5),u=r(c),h=i(142),d=r(h),f=i(143),p=r(f),m=i(150),g=r(m),v=i(155),b=r(v),y=i(157),_=n(y),x=i(158),w=n(x),S=i(17)},function(t,e,i){"use strict";function n(t,e,i){t=s(t),e=a(e);var n=t.length;i=void 0===i?n:r(o(i),0,n);var l=i;return(i-=e.length)>=0&&t.slice(i,l)==e}var r=i(138),a=i(7),o=i(139),s=i(6);t.exports=n},function(t,e,i){"use strict";function n(t,e,i){return t===t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e&&(t=t>=e?t:e)),t}t.exports=n},function(t,e,i){"use strict";function n(t){var e=r(t),i=e%1;return e===e?i?e-i:e:0}var r=i(140);t.exports=n},function(t,e,i){"use strict";function n(t){return t?(t=r(t))===a||t===-a?(t<0?-1:1)*o:t===t?t:0:0===t?t:0}var r=i(141),a=1/0,o=1.7976931348623157e308;t.exports=n},function(t,e,i){"use strict";function n(t){if("number"==typeof t)return t;if(a(t))return o;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(s,"");var i=c.test(t);return i||u.test(t)?h(t.slice(2),i?2:8):l.test(t)?o:+t}var r=i(5),a=i(15),o=NaN,s=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,u=/^0o[0-7]+$/i,h=parseInt;t.exports=n},function(t,e,i){"use strict";function n(t){return"string"==typeof t||!a(t)&&o(t)&&r(t)==s}var r=i(3),a=i(0),o=i(4),s="[object String]";t.exports=n},function(t,e,i){"use strict";function n(t,e,i){return i&&"number"!=typeof i&&s(t,e,i)&&(e=i=void 0),(i=void 0===i?h:i>>>0)?(t=u(t),t&&("string"==typeof e||null!=e&&!l(e))&&!(e=r(e))&&o(t)?a(c(t),0,i):t.split(e,i)):[]}var r=i(7),a=i(24),o=i(43),s=i(145),l=i(146),c=i(25),u=i(6),h=4294967295;t.exports=n},function(t,e,i){"use strict";function n(t,e,i){var n=-1,r=t.length;e<0&&(e=-e>r?0:r+e),i=i>r?r:i,i<0&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0;for(var a=Array(r);++n<r;)a[n]=t[n+e];return a}t.exports=n},function(t,e,i){"use strict";function n(t,e,i){if(!l(i))return!1;var n=void 0===e?"undefined":r(e);return!!("number"==n?o(i)&&s(e,i.length):"string"==n&&e in i)&&a(i[e],t)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=i(10),o=i(14),s=i(21),l=i(5);t.exports=n},function(t,e,i){"use strict";var n=i(147),r=i(37),a=i(38),o=a&&a.isRegExp,s=o?r(o):n;t.exports=s},function(t,e,i){"use strict";function n(t){return a(t)&&r(t)==o}var r=i(3),a=i(4),o="[object RegExp]";t.exports=n},function(t,e,i){"use strict";function n(t){return t.split("")}t.exports=n},function(t,e,i){"use strict";function n(t){return t.match(d)||[]}var r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",a="\\ud83c[\\udffb-\\udfff]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",l="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",c="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",o,s].join("|")+")[\\ufe0e\\ufe0f]?"+l+")*",u="[\\ufe0e\\ufe0f]?"+l+c,h="(?:"+["[^\\ud800-\\udfff]"+r+"?",r,o,s,"[\\ud800-\\udfff]"].join("|")+")",d=RegExp(a+"(?="+a+")|"+h+u,"g");t.exports=n},function(t,e,i){"use strict";function n(t,e,i){if((t=l(t))&&(i||void 0===e))return t.replace(c,"");if(!t||!(e=r(e)))return t;var n=s(t),u=o(n,s(e))+1;return a(n,0,u).join("")}var r=i(7),a=i(24),o=i(151),s=i(25),l=i(6),c=/\s+$/;t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=t.length;i--&&r(e,t[i],0)>-1;);return i}var r=i(44);t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n){for(var r=t.length,a=i+(n?1:-1);n?a--:++a<r;)if(e(t[a],a,t))return a;return-1}t.exports=n},function(t,e,i){"use strict";function n(t){return t!==t}t.exports=n},function(t,e,i){"use strict";function n(t,e,i){for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}t.exports=n},function(t,e,i){"use strict";function n(t,e,i){if((t=l(t))&&(i||void 0===e))return t.replace(c,"");if(!t||!(e=r(e)))return t;var n=s(t),u=o(n,s(e));return a(n,u).join("")}var r=i(7),a=i(24),o=i(156),s=i(25),l=i(6),c=/^\s+/;t.exports=n},function(t,e,i){"use strict";function n(t,e){for(var i=-1,n=t.length;++i<n&&r(e,t[i],0)>-1;);return i}var r=i(44);t.exports=n},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r={stringify:function(t){function e(t){return encodeURI(t.replace(/([=:&@_;\/])/g,"/$1"))}function i(t){if("number"==typeof t||!0===t||!1===t||null===t)return":"+t;if(t instanceof Array){for(var r=[],a=0;a<t.length;++a)r.push(i(t[a]));return"@"+r.join("&")+";"}if("object"===(void 0===t?"undefined":n(t))){var r=[];for(var o in t)r.push(e(o)+i(t[o]));return"_"+r.join("&")+";"}return"="+e((null!==t?void 0!==t?t:"undefined":"null").toString())}return i(t).replace(/;+$/g,"")},parse:function(t){function e(){for(var e="";n!==t.length;++n){if("/"===t.charAt(n)){if((n+=1)===t.length){e+=";";break}}else if(t.charAt(n).match(/[=:&@_;]/))break;e+=t.charAt(n)}return e}function i(){var r=t.charAt(n++);if("="===r)return e();if(":"===r){var a=e();return"true"===a||"false"!==a&&(a=parseFloat(a),isNaN(a)?null:a)}if("@"===r){var o=[];t:if(!(n>=t.length||";"===t.charAt(n)))for(;;){if(o.push(i()),n>=t.length||";"===t.charAt(n))break t;n+=1}return n+=1,o}if("_"===r){var o={};t:if(!(n>=t.length||";"===t.charAt(n)))for(;;){var s=e();if(o[s]=i(),n>=t.length||";"===t.charAt(n))break t;n+=1}return n+=1,o}throw"Unexpected char "+r}var n=0;return t=decodeURI(t),i()}};e.stringify=r.stringify,e.parse=r.parse},function(t,e,i){"use strict";function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.map(function(t){return Object.keys(t).forEach(function(i){t[i]=r(t[i],e[i])}),t})}function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;return(0,s.default)(t)?t.map(function(t){return r(t,e)}):e(t)}function a(t){if(""===t||null===t)return null;if(!t.trim)return t;if(null==t.trim().match(/^[0-9.,]+$/))return t;var e=parseFloat(t);return isNaN(e)||!isFinite(e)?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.mapRows=void 0;var o=i(0),s=function(t){return t&&t.__esModule?t:{default:t}}(o);e.mapRows=n},function(t,e,i){"use strict";function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.url,i=void 0===e?"":e,n=t.json,o=void 0!==n&&n,s={};return o&&(s["Content-Type"]="text/plain; charset=UTF-8"),fetch(i,{method:"GET",headers:s}).then(function(t){if(!t.ok)throw new r.WsError(r.WS_RESPONSE_ERROR,t.error);return t}).then(function(t){return o?t.json():t.text()}).catch(function(t){if("WaffleServerError"===t.name)throw t;var e=t.response?t.response.status:a;throw new r.WsError(r.NETWORK_ERROR+" with status code "+e,t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0,i(160);var r=i(17),a=500;e.ajax=n},function(t,e,i){"use strict";!function(t){function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function i(t){return"string"!=typeof t&&(t=String(t)),t}function n(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return v.iterable&&(e[Symbol.iterator]=function(){return e}),e}function r(t){this.map={},t instanceof r?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function a(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function o(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function s(t){var e=new FileReader,i=o(e);return e.readAsArrayBuffer(t),i}function l(t){var e=new FileReader,i=o(e);return e.readAsText(t),i}function c(t){for(var e=new Uint8Array(t),i=new Array(e.length),n=0;n<e.length;n++)i[n]=String.fromCharCode(e[n]);return i.join("")}function u(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(v.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(v.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(v.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(v.arrayBuffer&&v.blob&&y(t))this._bodyArrayBuffer=u(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!v.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!_(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob&&(this.blob=function(){var t=a(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?a(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var t=a(this);if(t)return t;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(t){var e=t.toUpperCase();return x.indexOf(e)>-1?e:t}function f(t,e){e=e||{};var i=e.body;if(t instanceof f){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new r(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new r(e.headers)),this.method=d(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function m(t){var e=new r;return t.split(/\r?\n/).forEach(function(t){var i=t.split(":"),n=i.shift().trim();if(n){var r=i.join(":").trim();e.append(n,r)}}),e}function g(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new r(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var v={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(v.arrayBuffer)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=function(t){return t&&DataView.prototype.isPrototypeOf(t)},_=ArrayBuffer.isView||function(t){return t&&b.indexOf(Object.prototype.toString.call(t))>-1};r.prototype.append=function(t,n){t=e(t),n=i(n);var r=this.map[t];this.map[t]=r?r+","+n:n},r.prototype.delete=function(t){delete this.map[e(t)]},r.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(t,n){this.map[e(t)]=i(n)},r.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},r.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),n(t)},r.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),n(t)},r.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),n(t)},v.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var x=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},h.call(f.prototype),h.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},g.error=function(){var t=new g(null,{status:0,statusText:""});return t.type="error",t};var w=[301,302,303,307,308];g.redirect=function(t,e){if(-1===w.indexOf(e))throw new RangeError("Invalid status code");return new g(null,{status:e,headers:{location:t}})},t.Headers=r,t.Request=f,t.Response=g,t.fetch=function(t,e){return new Promise(function(i,n){var r=new f(t,e),a=new XMLHttpRequest;a.onload=function(){var t={status:a.status,statusText:a.statusText,headers:m(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;i(new g(e,t))},a.onerror=function(){n(new TypeError("Network request failed"))},a.ontimeout=function(){n(new TypeError("Network request failed"))},a.open(r.method,r.url,!0),"include"===r.credentials&&(a.withCredentials=!0),"responseType"in a&&v.blob&&(a.responseType="blob"),r.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===r._bodyInit?null:r._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0)}]);t.exports=i},function(t,e){var i=function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=i(1);e.FrontendFileReader=r.FrontendFileReader;var a=i(3);e.DdfCsvError=a.DdfCsvError;var o=i(4);e.getDDFCsvReaderObject=o.prepareDDFCsvReaderObject(new n.FrontendFileReader)},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0}),i(2);var a=function(){function t(){n(this,t)}return r(t,[{key:"setRecordTransformer",value:function(t){this.recordTransformer=t}},{key:"readText",value:function(t,e){fetch(t).then(function(t){return t.text()}).then(function(t){e(null,t)}).catch(function(i){e(i||t+" read error")})}}]),t}();e.FrontendFileReader=a},function(t,e){"use strict";!function(){function t(t){if("string"!=typeof t&&(t=t.toString()),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function e(t){return"string"!=typeof t&&(t=t.toString()),t}function i(t){this.map={};var e=this;t instanceof i?t.forEach(function(t,i){i.forEach(function(i){e.append(t,i)})}):t&&Object.getOwnPropertyNames(t).forEach(function(i){e.append(i,t[i])})}function n(t){if(t.bodyUsed)return fetch.Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function r(t){return new fetch.Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function a(t){var e=new FileReader;return e.readAsArrayBuffer(t),r(e)}function o(t){var e=new FileReader;return e.readAsText(t),r(e)}function s(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(p.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(p.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else{if(t)throw new Error("unsupported BodyInit type");this._bodyText=""}},p.blob?(this.blob=function(){var t=n(this);if(t)return t;if(this._bodyBlob)return fetch.Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return fetch.Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var t=n(this);if(t)return t;if(this._bodyBlob)return o(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return fetch.Promise.resolve(this._bodyText)}):this.text=function(){var t=n(this);return t||fetch.Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(u)}),this.json=function(){return this.text().then(function(t){return JSON.parse(t)})},this}function l(t){var e=t.toUpperCase();return m.indexOf(e)>-1?e:t}function c(t,e){if(e=e||{},this.url=t,this.credentials=e.credentials||"omit",this.headers=new i(e.headers),this.method=l(e.method||"GET"),this.mode=e.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&e.body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(e.body)}function u(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function h(t){var e=new i;return t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var i=t.trim().split(":"),n=i.shift().trim(),r=i.join(":").trim();e.append(n,r)}),e}function d(){return g&&!/^(get|post|head|put|delete|options)$/i.test(this.method)?(this.usingActiveXhr=!0,new ActiveXObject("Microsoft.XMLHTTP")):new XMLHttpRequest}function f(t,e){e||(e={}),this._initBody(t),this.type="default",this.url=null,this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof i?e.headers:new i(e.headers),this.url=e.url||""}if(!self.fetch){i.prototype.append=function(i,n){i=t(i),n=e(n);var r=this.map[i];r||(r=[],this.map[i]=r),r.push(n)},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){var i=this.map[t(e)];return i?i[0]:null},i.prototype.getAll=function(e){return this.map[t(e)]||[]},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(i,n){this.map[t(i)]=[e(n)]},i.prototype.forEach=function(t){var e=this;Object.getOwnPropertyNames(this.map).forEach(function(i){t(i,e.map[i])})};var p={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in self},m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],g=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);s.call(c.prototype),s.call(f.prototype),self.Headers=i,self.Request=c,self.Response=f,self.fetch=function(t,e){var i;return i=c.prototype.isPrototypeOf(t)&&!e?t:new c(t,e),new fetch.Promise(function(t,e){function n(){return"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0}function r(){if(4===a.readyState){var i=1223===a.status?204:a.status;if(i<100||i>599)return void e(new TypeError("Network request failed"));var r={status:i,statusText:a.statusText,headers:h(a),url:n()},o="response"in a?a.response:a.responseText;t(new f(o,r))}}var a=d();"cors"===i.credentials&&(a.withCredentials=!0),a.onreadystatechange=r,self.usingActiveXhr||(a.onload=r,a.onerror=function(){e(new TypeError("Network request failed"))}),a.open(i.method,i.url,!0),"responseType"in a&&p.blob&&(a.responseType="blob"),i.headers.forEach(function(t,e){e.forEach(function(e){a.setRequestHeader(t,e)})}),a.send(void 0===i._bodyInit?null:i._bodyInit)})},fetch.Promise=self.Promise,self.fetch.polyfill=!0}}()},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.FILE_READING_ERROR="File reading error",e.JSON_PARSING_ERROR="JSON parsing error",e.CSV_PARSING_ERROR="CSV parsing error",e.DDF_ERROR="DDF error";var a=function(t){function e(t,r,a){i(this,e);var o=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.details=r,o.file=a,o.name="DdfCsvError",o.message=t,o.details=r,o.file=a,o}return r(e,t),e}(Error);e.DdfCsvError=a},function(t,e,i){"use strict";function n(t){return function(e,i){return{init:function(n){this._basepath=n.path,this._lastModified=n._lastModified,this.fileReader=e||t,this.logger=i,this.reader=a.ddfCsvReader(this._basepath+"/datapackage.json",this.fileReader,this.logger)},getAsset:function(t){var e=this,i=".json"===t.slice(-".json".length);return new r(function(n,r){e.fileReader.readText(e._basepath+"/"+t,function(t,e){if(t)return void r(t);if(i)try{n(JSON.parse(e))}catch(e){r(t)}else n(e)})})},read:function(t,e){function n(t){return t.map(function(t){return Object.keys(t).forEach(function(i){e[i]&&(t[i]=e[i](t[i]))}),t})}var a=this;return new r(function(r,o){a.reader.query(t).then(function(o){o=e?n(o):o,a.logger&&a.logger.log&&(i.log(JSON.stringify(t),o.length),i.log(o)),r(o)}).catch(function(t){o(t)})})}}}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),a=i(44);e.prepareDDFCsvReaderObject=n},function(t,e,i){"use strict";function n(){try{Promise===a&&(Promise=r)}catch(t){}return a}var r;"undefined"!=typeof Promise&&(r=Promise);var a=i(6)();a.noConflict=n,t.exports=a},function(t,e,i){(function(e){"use strict";t.exports=function(){function n(){}function r(t,e){if(null==t||t.constructor!==a)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new y("expecting a function but got "+p.classString(e))}function a(t){t!==x&&r(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(t){this.promise._resolveCallback(t)}function s(t){this.promise._rejectCallback(t,!1)}function l(t){var e=new a(x);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var c,u=function(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},h=function(){return new a.PromiseInspection(this._target())},d=function(t){return a.reject(new y(t))},f={},p=i(8);c=p.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},p.notEnumerableProp(a,"_getDomain",c);var m=i(9),g=i(10),v=new g;m.defineProperty(a,"_async",{value:v});var b=i(15),y=a.TypeError=b.TypeError;a.RangeError=b.RangeError;var _=a.CancellationError=b.CancellationError;a.TimeoutError=b.TimeoutError,a.OperationalError=b.OperationalError,a.RejectionError=b.OperationalError,a.AggregateError=b.AggregateError;var x=function(){},w={},S={},M=i(16)(a,x),k=i(17)(a,x,M,d,n),E=i(18)(a),z=E.create,O=i(19)(a,E),T=(O.CapturedTrace,i(20)(a,M,S)),C=i(21)(S),P=i(22),D=p.errorObj,A=p.tryCatch;return a.prototype.toString=function(){return"[object Promise]"},a.prototype.caught=a.prototype.catch=function(t){var e=arguments.length;if(e>1){var i,n=new Array(e-1),r=0;for(i=0;i<e-1;++i){var a=arguments[i];if(!p.isObject(a))return d("Catch statement predicate: expecting an object but got "+p.classString(a));n[r++]=a}return n.length=r,t=arguments[i],this.then(void 0,C(n,t,this))}return this.then(void 0,t)},a.prototype.reflect=function(){return this._then(h,h,void 0,this,void 0)},a.prototype.then=function(t,e){if(O.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var i=".then() only accepts functions but was passed: "+p.classString(t);arguments.length>1&&(i+=", "+p.classString(e)),this._warn(i)}return this._then(t,e,void 0,void 0,void 0)},a.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},a.prototype.spread=function(t){return"function"!=typeof t?d("expecting a function but got "+p.classString(t)):this.all()._then(t,void 0,void 0,w,void 0)},a.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},a.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new k(this).promise()},a.prototype.error=function(t){return this.caught(p.originatesFromRejection,t)},a.getNewLibraryCopy=t.exports,a.is=function(t){return t instanceof a},a.fromNode=a.fromCallback=function(t){var e=new a(x);e._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=A(t)(P(e,i));return n===D&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},a.all=function(t){return new k(t).promise()},a.cast=function(t){var e=M(t);return e instanceof a||(e=new a(x),e._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},a.resolve=a.fulfilled=a.cast,a.reject=a.rejected=function(t){var e=new a(x);return e._captureStackTrace(),e._rejectCallback(t,!0),e},a.setScheduler=function(t){if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t));return v.setScheduler(t)},a.prototype._then=function(t,e,i,n,r){var o=void 0!==r,s=o?r:new a(x),l=this._target(),u=l._bitField;o||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&u)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var h=c();if(0!=(50397184&u)){var d,f,m=l._settlePromiseCtx;0!=(33554432&u)?(f=l._rejectionHandler0,d=t):0!=(16777216&u)?(f=l._fulfillmentHandler0,d=e,l._unsetRejectionIsUnhandled()):(m=l._settlePromiseLateCancellationObserver,f=new _("late cancellation observer"),l._attachExtraTrace(f),d=e),v.invoke(m,l,{handler:null===h?d:"function"==typeof d&&p.domainBind(h,d),promise:s,receiver:n,value:f})}else l._addCallbacks(t,e,s,n,h);return s},a.prototype._length=function(){return 65535&this._bitField},a.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},a.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},a.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},a.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},a.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},a.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},a.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},a.prototype._isFinal=function(){return(4194304&this._bitField)>0},a.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},a.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},a.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},a.prototype._setAsyncGuaranteed=function(){v.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},a.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==f)return void 0===e&&this._isBound()?this._boundValue():e},a.prototype._promiseAt=function(t){return this[4*t-4+2]},a.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},a.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},a.prototype._boundValue=function(){},a.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),i=t._rejectionHandler0,n=t._promise0,r=t._receiverAt(0);void 0===r&&(r=f),this._addCallbacks(e,i,n,r,null)},a.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),r=t._promiseAt(e),a=t._receiverAt(e);void 0===a&&(a=f),this._addCallbacks(i,n,r,a,null)},a.prototype._addCallbacks=function(t,e,i,n,r){var a=this._length();if(a>=65531&&(a=0,this._setLength(0)),0===a)this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===r?t:p.domainBind(r,t)),"function"==typeof e&&(this._rejectionHandler0=null===r?e:p.domainBind(r,e));else{var o=4*a-4;this[o+2]=i,this[o+3]=n,"function"==typeof t&&(this[o+0]=null===r?t:p.domainBind(r,t)),"function"==typeof e&&(this[o+1]=null===r?e:p.domainBind(r,e))}return this._setLength(a+1),a},a.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},a.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(u(),!1);var i=M(t,this);if(!(i instanceof a))return this._fulfill(t);e&&this._propagateFrom(i,2);var n=i._target();if(n===this)return void this._reject(u());var r=n._bitField;if(0==(50397184&r)){var o=this._length();o>0&&n._migrateCallback0(this);for(var s=1;s<o;++s)n._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!=(33554432&r))this._fulfill(n._value());else if(0!=(16777216&r))this._reject(n._reason());else{var l=new _("late cancellation observer");n._attachExtraTrace(l),this._reject(l)}}},a.prototype._rejectCallback=function(t,e,i){var n=p.ensureErrorObject(t),r=n===t;if(!r&&!i&&O.warnings()){var a="a promise was rejected with a non-error: "+p.classString(t);this._warn(a,!0)}this._attachExtraTrace(n,!!e&&r),this._reject(t)},a.prototype._resolveFromExecutor=function(t){if(t!==x){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,i)});i=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)}},a.prototype._settlePromiseFromHandler=function(t,e,i,n){var r=n._bitField;if(0==(65536&r)){n._pushContext();var a;e===w?i&&"number"==typeof i.length?a=A(t).apply(this._boundValue(),i):(a=D,a.e=new y("cannot .spread() a non-array: "+p.classString(i))):a=A(t).call(e,i);var o=n._popContext();r=n._bitField,0==(65536&r)&&(a===S?n._reject(i):a===D?n._rejectCallback(a.e,!1):(O.checkForgottenReturns(a,o,"",n,this),n._resolveCallback(a)))}},a.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},a.prototype._followee=function(){return this._rejectionHandler0},a.prototype._setFollowee=function(t){this._rejectionHandler0=t},a.prototype._settlePromise=function(t,e,i,r){var o=t instanceof a,s=this._bitField,l=0!=(134217728&s);0!=(65536&s)?(o&&t._invokeInternalOnCancel(),i instanceof T&&i.isFinallyHandler()?(i.cancelPromise=t,A(e).call(i,r)===D&&t._reject(D.e)):e===h?t._fulfill(h.call(i)):i instanceof n?i._promiseCancelled(t):o||t instanceof k?t._cancel():i.cancel()):"function"==typeof e?o?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,r,t)):e.call(i,r,t):i instanceof n?i._isResolved()||(0!=(33554432&s)?i._promiseFulfilled(r,t):i._promiseRejected(r,t)):o&&(l&&t._setAsyncGuaranteed(),0!=(33554432&s)?t._fulfill(r):t._reject(r))},a.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,r=t.value;"function"==typeof e?i instanceof a?this._settlePromiseFromHandler(e,n,r,i):e.call(n,r,i):i instanceof a&&i._reject(r)},a.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},a.prototype._settlePromise0=function(t,e,i){var n=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,r,e)},a.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},a.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=u();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():v.settlePromises(this))}},a.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return v.fatalError(t,p.isNode);(65535&e)>0?v.settlePromises(this):this._ensurePossibleRejectionHandled()}},a.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),r=this._promiseAt(i),a=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,a,e)}},a.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),r=this._promiseAt(i),a=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,a,e)}},a.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,t),this._rejectPromises(e,i)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},a.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},a.defer=a.pending=function(){return O.deprecated("Promise.defer","new Promise"),{promise:new a(x),resolve:o,reject:s}},p.notEnumerableProp(a,"_makeSelfResolutionError",u),i(23)(a,x,M,d,O),i(24)(a,x,M,O),i(25)(a,k,d,O),i(26)(a),i(27)(a),i(28)(a,k,M,x,v,c),a.Promise=a,a.version="3.5.0",i(29)(a,k,d,M,x,O),i(30)(a),i(31)(a,d,M,z,x,O),i(32)(a,x,O),i(33)(a,d,x,M,n,O),i(34)(a),i(35)(a,x),i(36)(a,k,M,d),i(37)(a,x,M,d),i(38)(a,k,d,M,x,O),i(39)(a,k,O),i(40)(a,k,d),i(41)(a,x),i(42)(a,x),i(43)(a),p.toFastProperties(a),p.toFastProperties(a.prototype),l({a:1}),l({b:2}),l({c:3}),l(1),l(function(){}),l(void 0),l(!1),l(new a(x)),O.setBounds(g.firstLineError,p.lastLineError),a}}).call(e,i(7))},function(t,e){"use strict";function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(u===setTimeout)return setTimeout(t,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function o(){m&&f&&(m=!1,f.length?p=f.concat(p):g=-1,p.length&&s())}function s(){if(!m){var t=r(o);m=!0;for(var e=p.length;e;){for(f=p,p=[];++g<e;)f&&f[g].run();g=-1,e=p.length}f=null,m=!1,a(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var u,h,d=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(t){u=i}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(t){h=n}}();var f,p=[],m=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new l(t,e)),1!==p.length||m||r(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e,i){(function(e,n){"use strict";function r(){try{var t=P;return P=null,t.apply(this,arguments)}catch(t){return C.e=t,C}}function a(t){return P=t,r}function o(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function s(t){return"function"==typeof t||"object"===(void 0===t?"undefined":z(t))&&null!==t}function l(t){return o(t)?new Error(v(t)):t}function c(t,e){var i,n=t.length,r=new Array(n+1);for(i=0;i<n;++i)r[i]=t[i];return r[i]=e,r}function u(t,e,i){if(!O.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:i:void 0}function h(t,e,i){if(o(t))return t;var n={value:i,configurable:!0,enumerable:!1,writable:!0};return O.defineProperty(t,e,n),t}function d(t){throw t}function f(t){try{if("function"==typeof t){var e=O.names(t.prototype),i=O.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),r=L.test(t+"")&&O.names(t).length>0;if(i||n||r)return!0}return!1}catch(t){return!1}}function p(t){function e(){}e.prototype=t;for(var i=8;i--;)new e;return t}function m(t){return j.test(t)}function g(t,e,i){for(var n=new Array(t),r=0;r<t;++r)n[r]=e+r+i;return n}function v(t){try{return t+""}catch(t){return"[no string representation]"}}function b(t){return null!==t&&"object"===(void 0===t?"undefined":z(t))&&"string"==typeof t.message&&"string"==typeof t.name}function y(t){try{h(t,"isOperational",!0)}catch(t){}}function _(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function x(t){return b(t)&&O.propertyIsWritable(t,"stack")}function w(t){return{}.toString.call(t)}function S(t,e,i){for(var n=O.names(t),r=0;r<n.length;++r){var a=n[r];if(i(a))try{O.defineProperty(e,a,O.getDescriptor(t,a))}catch(t){}}}function M(t){return H?n.env[t]:void 0}function k(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function E(t,e){return t.bind(e)}var z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O=i(9),T="undefined"==typeof navigator,C={e:{}},P,D="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:null,A=function(t,e){function i(){this.constructor=t,this.constructor$=e;for(var i in e.prototype)n.call(e.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=e.prototype[i])}var n={}.hasOwnProperty;return i.prototype=e.prototype,t.prototype=new i,t.prototype},I=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(O.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var n=[],r=Object.create(null);null!=t&&!e(t);){var a;try{a=i(t)}catch(t){return n}for(var o=0;o<a.length;++o){var s=a[o];if(!r[s]){r[s]=!0;var l=Object.getOwnPropertyDescriptor(t,s);null!=l&&null==l.get&&null==l.set&&n.push(s)}}t=O.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(i){if(e(i))return[];var r=[];t:for(var a in i)if(n.call(i,a))r.push(a);else{for(var o=0;o<t.length;++o)if(n.call(t[o],a))continue t;r.push(a)}return r}}(),L=/this\s*\.\s*\S+\s*=/,j=/^[a-z$_][a-z$_0-9]*$/i,R=function(){return"stack"in new Error?function(t){return x(t)?t:new Error(v(t))}:function(t){if(x(t))return t;try{throw new Error(v(t))}catch(t){return t}}}(),F=function(t){return O.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var N="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i};F=function(t){return O.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?N(t):null}}var B=void 0!==n&&"[object process]"===w(n).toLowerCase(),H=void 0!==n&&void 0!==n.env,q={isClass:f,isIdentifier:m,inheritedDataKeys:I,getDataPropertyOrDefault:u,thrower:d,isArray:O.isArray,asArray:F,notEnumerableProp:h,isPrimitive:o,isObject:s,isError:b,canEvaluate:T,errorObj:C,tryCatch:a,inherits:A,withAppended:c,maybeWrapAsError:l,toFastProperties:p,filledRange:g,toString:v,canAttachTrace:x,ensureErrorObject:R,originatesFromRejection:_,markAsOriginatingFromRejection:y,classString:w,copyDescriptors:S,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:B,hasEnvVariables:H,env:M,global:D,getNativePromise:k,domainBind:E};q.isRecentNode=q.isNode&&function(){var t=n.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),q.isNode&&q.toFastProperties(n);try{throw new Error}catch(t){q.lastLineError=t}t.exports=q}).call(e,function(){return this}(),i(7))},function(t,e){"use strict";var i=function(){return void 0===this}();if(i)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var n={}.hasOwnProperty,r={}.toString,a={}.constructor.prototype,o=function(t){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e},s=function(t,e){return{value:t[e]}},l=function(t,e,i){return t[e]=i.value,t},c=function(t){return t},u=function(t){try{return Object(t).constructor.prototype}catch(t){return a}},h=function(t){try{return"[object Array]"===r.call(t)}catch(t){return!1}};t.exports={isArray:h,keys:o,names:o,defineProperty:l,getDescriptor:s,freeze:c,getPrototypeOf:u,isES5:i,propertyIsWritable:function(){return!0}}}},function(t,e,i){(function(e){"use strict";function n(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new c(16),this._normalQueue=new c(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=l}function r(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function a(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function o(t){this._normalQueue._pushOne(t),this._queueTick()}var s;try{throw new Error}catch(t){s=t}var l=i(11),c=i(14),u=i(8);n.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},n.prototype.hasCustomScheduler=function(){return this._customScheduler},n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){u.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(t,i){i?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},n.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},u.hasDevTools?(n.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?r.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},n.prototype.invoke=function(t,e,i){this._trampolineEnabled?a.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},n.prototype.settlePromises=function(t){this._trampolineEnabled?o.call(this,t):this._schedule(function(){t._settlePromises()})}):(n.prototype.invokeLater=r,n.prototype.invoke=a,n.prototype.settlePromises=o),n.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var i=t.shift(),n=t.shift();e.call(i,n)}else e._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},t.exports=n,t.exports.firstLineError=s}).call(e,i(7))},function(t,e,i){(function(e,n,r){"use strict";var a,o=i(8),s=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},l=o.getNativePromise();if(o.isNode&&"undefined"==typeof MutationObserver){var c=e.setImmediate,u=n.nextTick;a=o.isRecentNode?function(t){c.call(e,t)}:function(t){u.call(n,t)}}else if("function"==typeof l&&"function"==typeof l.resolve){var h=l.resolve();a=function(t){h.then(t)}}else a="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==r?function(t){r(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:s:function(){var t=document.createElement("div"),e={attributes:!0},i=!1,n=document.createElement("div");new MutationObserver(function(){t.classList.toggle("foo"),i=!1}).observe(n,e);var r=function(){i||(i=!0,n.classList.toggle("foo"))};return function(i){var n=new MutationObserver(function(){n.disconnect(),i()});n.observe(t,e),r()}}();t.exports=a}).call(e,function(){return this}(),i(7),i(12).setImmediate)},function(t,e,i){"use strict";function n(t,e){this._id=t,this._clearFn=e}var r=Function.prototype.apply;e.setTimeout=function(){return new n(r.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new n(r.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(13),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e,i){(function(t,e){"use strict";!function(t,i){function n(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var n={callback:t,args:e};return c[l]=n,s(l),l++}function r(t){delete c[t]}function a(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}function o(t){if(u)setTimeout(o,0,t);else{var e=c[t];if(e){u=!0;try{a(e)}finally{r(t),u=!1}}}}if(!t.setImmediate){var s,l=1,c={},u=!1,h=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){e.nextTick(function(){o(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?function(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&o(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),s=function(i){t.postMessage(e+i,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){o(t.data)},s=function(e){t.port2.postMessage(e)}}():h&&"onreadystatechange"in h.createElement("script")?function(){var t=h.documentElement;s=function(e){var i=h.createElement("script");i.onreadystatechange=function(){o(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():function(){s=function(t){setTimeout(o,0,t)}}(),d.setImmediate=n,d.clearImmediate=r}}("undefined"==typeof self?void 0===t?void 0:t:self)}).call(e,function(){return this}(),i(7))},function(t,e){"use strict";function i(t,e,i,n,r){for(var a=0;a<r;++a)i[a+n]=t[a+e],t[a+e]=void 0}function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},n.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var r=this._front+n-3;this._checkCapacity(n);var a=this._capacity-1;this[r+0&a]=t,this[r+1&a]=e,this[r+2&a]=i,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,i(this,0,this,e,this._front+this._length&e-1)},t.exports=n},function(t,e,i){"use strict";function n(t,e){function i(n){if(!(this instanceof i))return new i(n);h(this,"message","string"==typeof n?n:e),h(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return u(i,Error),i}function r(t){if(!(this instanceof r))return new r(t);h(this,"name","OperationalError"),h(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(h(this,"message",t.message),h(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var a,o,s=i(9),l=s.freeze,c=i(8),u=c.inherits,h=c.notEnumerableProp,d=n("Warning","warning"),f=n("CancellationError","cancellation error"),p=n("TimeoutError","timeout error"),m=n("AggregateError","aggregate error");try{a=TypeError,o=RangeError}catch(t){a=n("TypeError","type error"),o=n("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<g.length;++v)"function"==typeof Array.prototype[g[v]]&&(m.prototype[g[v]]=Array.prototype[g[v]]);s.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var b=0;m.prototype.toString=function(){var t=Array(4*b+1).join(" "),e="\n"+t+"AggregateError of:\n";b++,t=Array(4*b+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",r=n.split("\n"),a=0;a<r.length;++a)r[a]=t+r[a];n=r.join("\n"),e+=n+"\n"}return b--,e},u(r,Error);var y=Error.__BluebirdErrorTypes__;y||(y=l({CancellationError:f,TimeoutError:p,OperationalError:r,RejectionError:r,AggregateError:m}),s.defineProperty(Error,"__BluebirdErrorTypes__",{value:y,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:a,RangeError:o,CancellationError:y.CancellationError,OperationalError:y.OperationalError,TimeoutError:y.TimeoutError,AggregateError:y.AggregateError,Warning:d}},function(t,e,i){"use strict";t.exports=function(t,e){function n(i,n){if(u(i)){if(i instanceof t)return i;var r=a(i);if(r===c){n&&n._pushContext();var l=t.reject(r.e);return n&&n._popContext(),l}if("function"==typeof r){if(o(i)){var l=new t(e);return i._then(l._fulfill,l._reject,void 0,l,null),l}return s(i,r,n)}}return i}function r(t){return t.then}function a(t){try{return r(t)}catch(t){return c.e=t,c}}function o(t){try{return h.call(t,"_promise0")}catch(t){return!1}}function s(i,n,r){function a(t){s&&(s._resolveCallback(t),s=null)}function o(t){s&&(s._rejectCallback(t,h,!0),s=null)}var s=new t(e),u=s;r&&r._pushContext(),s._captureStackTrace(),r&&r._popContext();var h=!0,d=l.tryCatch(n).call(i,a,o);return h=!1,s&&d===c&&(s._rejectCallback(d.e,!0,!0),s=null),u}var l=i(8),c=l.errorObj,u=l.isObject,h={}.hasOwnProperty;return n}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,a){function o(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}function s(i){var n=this._promise=new t(e);i instanceof t&&n._propagateFrom(i,3),n._setOnCancel(this),this._values=i,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=i(8);l.isArray;return l.inherits(s,a),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(i,a){var s=n(this._values,this._promise);if(s instanceof t){s=s._target();var c=s._bitField;if(this._values=s,0==(50397184&c))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,a);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(s._reason()):this._cancel();s=s._value()}if(null===(s=l.asArray(s))){var u=r("expecting an array or an iterable object but got "+l.classString(s)).reason();return void this._promise._rejectCallback(u,!1)}if(0===s.length)return void(-5===a?this._resolveEmptyArray():this._resolve(o(a)));this._iterate(s)},s.prototype._iterate=function(e){var i=this.getActualLength(e.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var r=this._promise,a=!1,o=null,s=0;s<i;++s){var l=n(e[s],r);l instanceof t?(l=l._target(),o=l._bitField):o=null,a?null!==o&&l.suppressUnhandledRejections():null!==o?0==(50397184&o)?(l._proxy(this,s),this._values[s]=l):a=0!=(33554432&o)?this._promiseFulfilled(l._value(),s):0!=(16777216&o)?this._promiseRejected(l._reason(),s):this._promiseCancelled(s):a=this._promiseFulfilled(l,s)}a||r._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},s.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var i=0;i<e.length;++i)e[i]instanceof t&&e[i].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},function(t,e){"use strict";t.exports=function(t){function e(){this._trace=new e.CapturedTrace(n())}function i(){if(r)return new e}function n(){var t=a.length-1;if(t>=0)return a[t]}var r=!1,a=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,a.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=a.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=i,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var i=t.prototype._pushContext,a=t.prototype._popContext,o=t._peekContext,s=t.prototype._peekContext,l=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=a,t._peekContext=o,t.prototype._peekContext=s,t.prototype._promiseCreated=l,r=!1},r=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=n,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},function(t,e,i){(function(e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t,r){function a(t,e){return{promise:e}}function o(){return!1}function s(t,e,i){var n=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+B.toString(t));n._attachCancellationCallback(t)})}catch(t){return t}}function l(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?B.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function c(){return this._onCancelField}function u(t){this._onCancelField=t}function h(){this._cancellationParent=void 0,this._onCancelField=void 0}function d(t,e){if(0!=(1&e)){this._cancellationParent=t;var i=t._branchesRemainingToCancel;void 0===i&&(i=0),t._branchesRemainingToCancel=i+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function f(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function m(){this._trace=new A(this._peekContext())}function g(t,e){if(H(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=k(t);B.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),B.notEnumerableProp(t,"__stackCleaned__",!0)}}}function v(t,e,i,n,r){if(void 0===t&&null!==e&&$){if(void 0!==r&&r._returnedNonUndefined())return;if(0==(65535&n._bitField))return;i&&(i+=" ");var a="",o="";if(e._trace){for(var s=e._trace.stack.split("\n"),l=S(s),c=l.length-1;c>=0;--c){var u=l[c];if(!K.test(u)){var h=u.match(V);h&&(a="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(l.length>0)for(var d=l[0],c=0;c<s.length;++c)if(s[c]===d){c>0&&(o="\n"+s[c-1]);break}}var f="a promise was created in a "+i+"handler "+a+"but was not returned from it, see http://goo.gl/rRqMUw"+o;n._warn(f,!0,e)}}function b(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),y(i)}function y(e,i,n){if(st.warnings){var r,a=new N(e);if(i)n._attachExtraTrace(a);else if(st.longStackTraces&&(r=t._peekContext()))r.attachExtraTrace(a);else{var o=k(a);a.stack=o.message+"\n"+o.stack.join("\n")}it("warning",a)||E(a,"",!0)}}function _(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}function x(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function w(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],r=e.length-1,a=e[r],o=-1,s=n.length-1;s>=0;--s)if(n[s]===a){o=s;break}for(var s=o;s>=0;--s){var l=n[s];if(e[r]!==l)break;e.pop(),r--}e=n}}function S(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r="    (No stack trace)"===n||Y.test(n),a=r&&rt(n);r&&!a&&(X&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function M(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||Y.test(n))break}return i>0&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}function k(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?M(t):["    (No stack trace)"],{message:i,stack:"SyntaxError"==t.name?e:S(e)}}function E(t,e,i){if("undefined"!=typeof console){var r;if(B.isObject(t)){var a=t.stack;r=e+W(a,t)}else r=e+String(t);"function"==typeof j?j(r,i):"function"!=typeof console.log&&"object"!==n(console.log)||console.log(r)}}function z(t,e,i,n){var r=!1;try{"function"==typeof e&&(r=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){F.throwLater(t)}"unhandledRejection"===t?it(t,i,n)||r||E(i,"Unhandled rejection "):it(t,n)}function O(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():B.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+T(e)+">, no stack trace)"}function T(t){return t.length<41?t:t.substr(0,38)+"..."}function C(){return"function"==typeof ot}function P(t){var e=t.match(at);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function D(t,e){if(C()){for(var i,n,r=t.stack.split("\n"),a=e.stack.split("\n"),o=-1,s=-1,l=0;l<r.length;++l){var c=P(r[l]);if(c){i=c.fileName,o=c.line;break}}for(var l=0;l<a.length;++l){var c=P(a[l]);if(c){n=c.fileName,s=c.line;break}}o<0||s<0||!i||!n||i!==n||o>=s||(rt=function(t){if(q.test(t))return!0;var e=P(t);return!!(e&&e.fileName===i&&o<=e.line&&e.line<=s)})}}function A(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);ot(this,A),e>32&&this.uncycle()}var I,L,j,R=t._getDomain,F=t._async,N=i(15).Warning,B=i(8),H=B.canAttachTrace,q=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,K=/\((?:timers\.js):\d+:\d+\)/,V=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,Y=null,W=null,X=!1,U=!(0==B.env("BLUEBIRD_DEBUG")||!B.env("BLUEBIRD_DEBUG")&&"development"!==B.env("NODE_ENV")),G=!(0==B.env("BLUEBIRD_WARNINGS")||!U&&!B.env("BLUEBIRD_WARNINGS")),Q=!(0==B.env("BLUEBIRD_LONG_STACK_TRACES")||!U&&!B.env("BLUEBIRD_LONG_STACK_TRACES")),$=0!=B.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(G||!!B.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),F.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){z("rejectionHandled",I,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),z("unhandledRejection",L,t,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(t,e,i){return y(t,e,i||this)},t.onPossiblyUnhandledRejection=function(t){var e=R();L="function"==typeof t?null===e?t:B.domainBind(e,t):void 0},t.onUnhandledRejectionHandled=function(t){var e=R();I="function"==typeof t?null===e?t:B.domainBind(e,t):void 0};var Z=function(){};t.longStackTraces=function(){if(F.haveItemsQueued()&&!st.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!st.longStackTraces&&C()){var e=t.prototype._captureStackTrace,i=t.prototype._attachExtraTrace;st.longStackTraces=!0,Z=function(){if(F.haveItemsQueued()&&!st.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=i,r.deactivateLongStackTraces(),F.enableTrampoline(),st.longStackTraces=!1},t.prototype._captureStackTrace=m,t.prototype._attachExtraTrace=g,r.activateLongStackTraces(),F.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return st.longStackTraces&&C()};var J=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return B.global.dispatchEvent(t),function(t,e){var i=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!B.global.dispatchEvent(i)}}if("function"==typeof Event){var t=new Event("CustomEvent");return B.global.dispatchEvent(t),function(t,e){var i=new Event(t.toLowerCase(),{cancelable:!0});return i.detail=e,!B.global.dispatchEvent(i)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),B.global.dispatchEvent(t),function(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t.toLowerCase(),!1,!0,e),!B.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),tt=function(){return B.isNode?function(){return e.emit.apply(e,arguments)}:B.global?function(t){var e="on"+t.toLowerCase(),i=B.global[e];return!!i&&(i.apply(B.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),et={promiseCreated:a,promiseFulfilled:a,promiseRejected:a,promiseResolved:a,promiseCancelled:a,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:a},it=function(t){var e=!1;try{e=tt.apply(null,arguments)}catch(t){F.throwLater(t),e=!0}var i=!1;try{i=J(t,et[t].apply(null,arguments))}catch(t){F.throwLater(t),i=!0}return i||e};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&Z()),"warnings"in e){var i=e.warnings;st.warnings=!!i,$=st.warnings,B.isObject(i)&&"wForgottenReturn"in i&&($=!!i.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!st.cancellation){if(F.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=h,t.prototype._propagateFrom=d,t.prototype._onCancel=c,t.prototype._setOnCancel=u,t.prototype._attachCancellationCallback=l,t.prototype._execute=s,nt=d,st.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!st.monitoring?(st.monitoring=!0,t.prototype._fireEvent=it):!e.monitoring&&st.monitoring&&(st.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(t){},t.prototype._attachCancellationCallback=function(t){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(t,e){};var nt=f,rt=function(){return!1},at=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;B.inherits(A,Error),r.CapturedTrace=A,A.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,r=this;void 0!==r;++n)e.push(r),r=r._parent;t=this._length=n;for(var n=t-1;n>=0;--n){var a=e[n].stack;void 0===i[a]&&(i[a]=n)}for(var n=0;n<t;++n){var o=e[n].stack,s=i[o];if(void 0!==s&&s!==n){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var l=n>0?e[n-1]:this;s<t-1?(l._parent=e[s+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var c=l._length+1,u=n-2;u>=0;--u)e[u]._length=c,c++;return}}}},A.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=k(t),i=e.message,n=[e.stack],r=this;void 0!==r;)n.push(S(r.stack.split("\n"))),r=r._parent;w(n),x(n),B.notEnumerableProp(t,"stack",_(i,n)),B.notEnumerableProp(t,"__stackCleaned__",!0)}};var ot=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():O(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,Y=t,W=e;var i=Error.captureStackTrace;return rt=function(t){return q.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return Y=/@/,W=e,X=!0,function(t){t.stack=(new Error).stack};var a;try{throw new Error}catch(t){a="stack"in t}return"stack"in r||!a||"number"!=typeof Error.stackTraceLimit?(W=function(t,e){return"string"==typeof t?t:"object"!==(void 0===e?"undefined":n(e))&&"function"!=typeof e||void 0===e.name||void 0===e.message?O(e):e.toString()},null):(Y=t,W=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(j=function(t){console.warn(t)},B.isNode&&e.stderr.isTTY?j=function(t,e){var i=e?"[33m":"[31m";console.warn(i+t+"[0m\n")}:B.isNode||"string"!=typeof(new Error).stack||(j=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var st={warnings:G,longStackTraces:!1,cancellation:!1,monitoring:!1};return Q&&t.longStackTraces(),{longStackTraces:function(){return st.longStackTraces},warnings:function(){return st.warnings},cancellation:function(){return st.cancellation},monitoring:function(){return st.monitoring},propagateFromFunction:function(){return nt},boundValueFunction:function(){return p},checkForgottenReturns:v,setBounds:D,warn:y,deprecated:b,CapturedTrace:A,fireDomEvent:J,fireGlobalEvent:tt}}}).call(e,i(7))},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function a(t){this.finallyHandler=t}function o(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function s(){return c.call(this,this.promise._target()._settledValue())}function l(t){if(!o(this,t))return d.e=t,d}function c(i){var r=this.promise,c=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?c.call(r._boundValue()):c.call(r._boundValue(),i);if(u===n)return u;if(void 0!==u){r._setReturnedNonUndefined();var f=e(u,r);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var p=new h("late cancellation observer");return r._attachExtraTrace(p),d.e=p,d}f.isPending()&&f._attachCancellationCallback(new a(this))}return f._then(s,l,void 0,this,void 0)}}}return r.isRejected()?(o(this),d.e=i,d):(o(this),i)}var u=i(8),h=t.CancellationError,d=u.errorObj,f=i(21)(n);return r.prototype.isFinallyHandler=function(){return 0===this.type},a.prototype._resultCancelled=function(){o(this.finallyHandler)},t.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new r(this,e,t),void 0)},t.prototype.lastly=t.prototype.finally=function(t){return this._passThrough(t,0,c,c)},t.prototype.tap=function(t){return this._passThrough(t,1,c)},t.prototype.tapCatch=function(e){var i=arguments.length;if(1===i)return this._passThrough(e,1,void 0,c);var n,r=new Array(i-1),a=0;for(n=0;n<i-1;++n){var o=arguments[n];if(!u.isObject(o))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(o)));r[a++]=o}r.length=a;var s=arguments[n];return this._passThrough(f(r,s,this),1,void 0,c)},r}},function(t,e,i){"use strict";t.exports=function(t){function e(e,i,s){return function(l){var c=s._boundValue();t:for(var u=0;u<e.length;++u){var h=e[u];if(h===Error||null!=h&&h.prototype instanceof Error){if(l instanceof h)return a(i).call(c,l)}else if("function"==typeof h){var d=a(h).call(c,l);if(d===o)return d;if(d)return a(i).call(c,l)}else if(n.isObject(l)){for(var f=r(h),p=0;p<f.length;++p){var m=f[p];if(h[m]!=l[m])continue t}return a(i).call(c,l)}}return t}}var n=i(8),r=i(9).keys,a=n.tryCatch,o=n.errorObj;return e}},function(t,e,i){"use strict";function n(t){return t instanceof Error&&u.getPrototypeOf(t)===Error.prototype}function r(t){var e;if(n(t)){e=new c(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var i=u.keys(t),r=0;r<i.length;++r){var a=i[r];h.test(a)||(e[a]=t[a])}return e}return o.markAsOriginatingFromRejection(t),t}function a(t,e){return function(i,n){if(null!==t){if(i){var a=r(s(i));t._attachExtraTrace(a),t._reject(a)}else if(e){for(var o=arguments.length,l=new Array(Math.max(o-1,0)),c=1;c<o;++c)l[c-1]=arguments[c];t._fulfill(l)}else t._fulfill(n);t=null}}}var o=i(8),s=o.maybeWrapAsError,l=i(15),c=l.OperationalError,u=i(9),h=/^(?:name|message|stack|cause)$/;t.exports=a},function(t,e,i){"use strict";t.exports=function(t,e,n,r,a){var o=i(8),s=o.tryCatch;t.method=function(i){if("function"!=typeof i)throw new t.TypeError("expecting a function but got "+o.classString(i));return function(){var n=new t(e);n._captureStackTrace(),n._pushContext();var r=s(i).apply(this,arguments),o=n._popContext();return a.checkForgottenReturns(r,o,"Promise.method",n),n._resolveFromSyncValue(r),n}},t.attempt=t.try=function(i){if("function"!=typeof i)return r("expecting a function but got "+o.classString(i));var n=new t(e);n._captureStackTrace(),n._pushContext();var l;if(arguments.length>1){a.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],u=arguments[2];l=o.isArray(c)?s(i).apply(u,c):s(i).call(u,c)}else l=s(i)();var h=n._popContext();return a.checkForgottenReturns(l,h,"Promise.try",n),n._resolveFromSyncValue(l),n},t.prototype._resolveFromSyncValue=function(t){t===o.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},function(t,e){"use strict";t.exports=function(t,e,i,n){var r=!1,a=function(t,e){this._reject(e)},o=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(a,a,null,this,t)},s=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(a){r||(r=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var c=i(a),u=new t(e);u._propagateFrom(this,1);var h=this._target();if(u._setBoundTo(c),c instanceof t){var d={promiseRejectionQueued:!1,promise:u,target:h,bindingPromise:c};h._then(e,o,void 0,u,d),c._then(s,l,void 0,u,d),u._setOnCancel(c)}else u._resolveCallback(h);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,i){return t.resolve(i).bind(e)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){var a=i(8),o=a.tryCatch,s=a.errorObj,l=t._async;t.prototype.break=t.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(a.isArray(t))for(var i=0;i<t.length;++i)this._doInvokeOnCancel(t[i],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=o(t).call(this._boundValue());n===s&&(this._attachExtraTrace(n.e),l.throwLater(n.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},function(t,e){"use strict";t.exports=function(t){function e(){return this.value}function i(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(i){return i instanceof t&&i.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:i},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1],n=function(){throw e};return this.caught(t,n)},t.prototype.catchReturn=function(i){if(arguments.length<=1)return i instanceof t&&i.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:i},void 0);var n=arguments[1];n instanceof t&&n.suppressUnhandledRejections();var r=function(){return n};return this.caught(i,r)}}},function(t,e){"use strict";t.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},a=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},o=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return o.call(this._target())},t.prototype.isRejected=function(){return a.call(this._target())},t.prototype.isFulfilled=function(){return r.call(this._target())},t.prototype.isResolved=function(){return s.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,a,o){var s,l=i(8),c=l.canEvaluate,u=l.tryCatch,h=l.errorObj;if(c){for(var d=[],f=[],p=[],m=0;m<8;++m)d.push(function(e){for(var i=new Array(e),n=0;n<i.length;++n)i[n]="this.p"+(n+1);var r=i.join(" = ")+" = null;",o="var promise;\n"+i.map(function(t){return"                                                         \n\t                promise = "+t+";                                      \n\t                if (promise instanceof Promise) {                            \n\t                    promise.cancel();                                        \n\t                }                                                            \n\t            "}).join("\n"),s=i.join(", "),l="Holder$"+e,c="return function(tryCatch, errorObj, Promise, async) {    \n\t            'use strict';                                                    \n\t            function [TheName](fn) {                                         \n\t                [TheProperties]                                              \n\t                this.fn = fn;                                                \n\t                this.asyncNeeded = true;                                     \n\t                this.now = 0;                                                \n\t            }                                                                \n\t                                                                             \n\t            [TheName].prototype._callFunction = function(promise) {          \n\t                promise._pushContext();                                      \n\t                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n\t                promise._popContext();                                       \n\t                if (ret === errorObj) {                                      \n\t                    promise._rejectCallback(ret.e, false);                   \n\t                } else {                                                     \n\t                    promise._resolveCallback(ret);                           \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype.checkFulfillment = function(promise) {       \n\t                var now = ++this.now;                                        \n\t                if (now === [TheTotal]) {                                    \n\t                    if (this.asyncNeeded) {                                  \n\t                        async.invoke(this._callFunction, this, promise);     \n\t                    } else {                                                 \n\t                        this._callFunction(promise);                         \n\t                    }                                                        \n\t                                                                             \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype._resultCancelled = function() {              \n\t                [CancellationCode]                                           \n\t            };                                                               \n\t                                                                             \n\t            return [TheName];                                                \n\t        }(tryCatch, errorObj, Promise, async);                               \n\t        ";return c=c.replace(/\[TheName\]/g,l).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,r).replace(/\[CancellationCode\]/g,o),new Function("tryCatch","errorObj","Promise","async",c)(u,h,t,a)}(m+1)),f.push(function(t){return new Function("value","holder","                             \n\t            'use strict';                                                    \n\t            holder.pIndex = value;                                           \n\t            holder.checkFulfillment(this);                                   \n\t            ".replace(/Index/g,t))}(m+1)),p.push(function(t){return new Function("promise","holder","                           \n\t            'use strict';                                                    \n\t            holder.pIndex = promise;                                         \n\t            ".replace(/Index/g,t))}(m+1));s=function(t){this._reject(t)}}t.join=function(){var i,a=arguments.length-1;if(a>0&&"function"==typeof arguments[a]&&(i=arguments[a],a<=8&&c)){var u=new t(r);u._captureStackTrace();for(var h=d[a-1],m=new h(i),g=f,v=0;v<a;++v){var b=n(arguments[v],u);if(b instanceof t){b=b._target();var y=b._bitField;0==(50397184&y)?(b._then(g[v],s,void 0,u,m),p[v](b,m),m.asyncNeeded=!1):0!=(33554432&y)?g[v].call(u,b._value(),m):0!=(16777216&y)?u._reject(b._reason()):u._cancel()}else g[v].call(u,b,m)}if(!u._isFateSealed()){if(m.asyncNeeded){var _=o();null!==_&&(m.fn=l.domainBind(_,m.fn))}u._setAsyncGuaranteed(),u._setOnCancel(m)}return u}for(var x=arguments.length,w=new Array(x),S=0;S<x;++S)w[S]=arguments[S];i&&w.pop();var u=new e(w).promise();return void 0!==i?u.spread(i):u}}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t,e,r,a,o,s){function l(t,e,i,n){this.constructor$(t),this._promise._captureStackTrace();var r=u();this._callback=null===r?e:h.domainBind(r,e),this._preservedValues=n===o?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=[],p.invoke(this._asyncInit,this,void 0)}function c(e,i,a,o){if("function"!=typeof i)return r("expecting a function but got "+h.classString(i));var s=0;if(void 0!==a){if("object"!==(void 0===a?"undefined":n(a))||null===a)return t.reject(new TypeError("options argument must be an object but it is "+h.classString(a)));if("number"!=typeof a.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+h.classString(a.concurrency)));s=a.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new l(e,i,s,o).promise()}var u=t._getDomain,h=i(8),d=h.tryCatch,f=h.errorObj,p=t._async;h.inherits(l,e),l.prototype._asyncInit=function(){this._init$(void 0,-2)},l.prototype._init=function(){},l.prototype._promiseFulfilled=function(e,i){var n=this._values,r=this.length(),o=this._preservedValues,l=this._limit;if(i<0){if(i=-1*i-1,n[i]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return n[i]=e,this._queue.push(i),!1;null!==o&&(o[i]=e);var c=this._promise,u=this._callback,h=c._boundValue();c._pushContext();var p=d(u).call(h,e,i,r),m=c._popContext();if(s.checkForgottenReturns(p,m,null!==o?"Promise.filter":"Promise.map",c),p===f)return this._reject(p.e),!0;var g=a(p,this._promise);if(g instanceof t){g=g._target();var v=g._bitField;if(0==(50397184&v))return l>=1&&this._inFlight++,n[i]=g,g._proxy(this,-1*(i+1)),!1;if(0==(33554432&v))return 0!=(16777216&v)?(this._reject(g._reason()),!0):(this._cancel(),!0);p=g._value()}n[i]=p}return++this._totalResolved>=r&&(null!==o?this._filter(n,o):this._resolve(n),!0)},l.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},l.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),r=0,a=0;a<i;++a)t[a]&&(n[r++]=e[a]);n.length=r,this._resolve(n)},l.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,e){return c(this,t,e,null)},t.map=function(t,e,i,n){return c(t,e,i,n)}}},function(t,e,i){"use strict";var n=Object.create;if(n){var r=n(null),a=n(null);r[" size"]=a[" size"]=0}t.exports=function(t){function e(e,i){var n;if(null!=e&&(n=e[i]),"function"!=typeof n){var r="Object "+u.classString(e)+" has no method '"+u.toString(i)+"'";throw new t.TypeError(r)}return n}function n(t){return e(t,this.pop()).apply(t,this)}function o(t){return t[this]}function s(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}var l,c,u=i(8),h=u.canEvaluate,d=u.isIdentifier,f=function(t){return new Function("ensureMethod","                                    \n\t        return function(obj) {                                               \n\t            'use strict'                                                     \n\t            var len = this.length;                                           \n\t            ensureMethod(obj, 'methodName');                                 \n\t            switch(len) {                                                    \n\t                case 1: return obj.methodName(this[0]);                      \n\t                case 2: return obj.methodName(this[0], this[1]);             \n\t                case 3: return obj.methodName(this[0], this[1], this[2]);    \n\t                case 0: return obj.methodName();                             \n\t                default:                                                     \n\t                    return obj.methodName.apply(obj, this);                  \n\t            }                                                                \n\t        };                                                                   \n\t        ".replace(/methodName/g,t))(e)},p=function(t){return new Function("obj","                                             \n\t        'use strict';                                                        \n\t        return obj.propertyName;                                             \n\t        ".replace("propertyName",t))},m=function(t,e,i){var n=i[t];if("function"!=typeof n){if(!d(t))return null;if(n=e(t),i[t]=n,++i[" size"]>512){for(var r=Object.keys(i),a=0;a<256;++a)delete i[r[a]];i[" size"]=r.length-256}}return n};l=function(t){return m(t,f,r)},c=function(t){return m(t,p,a)},t.prototype.call=function(t){for(var e=arguments.length,i=new Array(Math.max(e-1,0)),r=1;r<e;++r)i[r-1]=arguments[r];if(h){var a=l(t);if(null!==a)return this._then(a,void 0,void 0,i,void 0)}return i.push(t),this._then(n,void 0,void 0,i,void 0)},t.prototype.get=function(t){var e,i="number"==typeof t;if(i)e=s;else if(h){var n=c(t);e=null!==n?n:o}else e=o;return this._then(e,void 0,void 0,t,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,a,o){function s(t){setTimeout(function(){throw t},0)}function l(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function c(e,i){function r(){if(o>=c)return u._fulfill();var a=l(e[o++]);if(a instanceof t&&a._isDisposable()){try{a=n(a._getDisposer().tryDispose(i),e.promise)}catch(t){return s(t)}if(a instanceof t)return a._then(r,s,null,null,null)}r()}var o=0,c=e.length,u=new t(a);return r(),u}function u(t,e,i){this._data=t,this._promise=e,this._context=i}function h(t,e,i){this.constructor$(t,e,i)}function d(t){return u.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function f(t){this.length=t,this.promise=null,this[t-1]=null}var p=i(8),m=i(15).TypeError,g=i(8).inherits,v=p.errorObj,b=p.tryCatch,y={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():y},u.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var n=e!==y?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,n},u.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},g(h,u),h.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},f.prototype._resultCancelled=function(){for(var e=this.length,i=0;i<e;++i){var n=this[i];n instanceof t&&n.cancel()}},t.using=function(){var i=arguments.length;if(i<2)return e("you must pass at least 2 arguments to Promise.using");var r=arguments[i-1];if("function"!=typeof r)return e("expecting a function but got "+p.classString(r));var a,s=!0;2===i&&Array.isArray(arguments[0])?(a=arguments[0],i=a.length,s=!1):(a=arguments,i--);for(var l=new f(i),h=0;h<i;++h){var m=a[h];if(u.isDisposer(m)){var g=m;m=m.promise(),m._setDisposable(g)}else{var y=n(m);y instanceof t&&(m=y._then(d,null,null,{resources:l,index:h},void 0))}l[h]=m}for(var _=new Array(l.length),h=0;h<_.length;++h)_[h]=t.resolve(l[h]).reflect();var x=t.all(_).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return v.e=i.error(),v;if(!i.isFulfilled())return void x.cancel();t[e]=i.value()}w._pushContext(),r=b(r);var n=s?r.apply(void 0,t):r(t),a=w._popContext();return o.checkForgottenReturns(n,a,"Promise.using",w),n}),w=x.lastly(function(){var e=new t.PromiseInspection(x);return c(l,e)});return l.promise=w,w._setOnCancel(l),w},t.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(t){if("function"==typeof t)return new h(t,this,r());throw new m}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t){this.handle=t}function a(t){return clearTimeout(this.handle),t}function o(t){throw clearTimeout(this.handle),t}var s=i(8),l=t.TimeoutError;r.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(t){return u(+this).thenReturn(t)},u=t.delay=function(i,a){var o,s;return void 0!==a?(o=t.resolve(a)._then(c,null,null,i,void 0),n.cancellation()&&a instanceof t&&o._setOnCancel(a)):(o=new t(e),s=setTimeout(function(){o._fulfill()},+i),n.cancellation()&&o._setOnCancel(new r(s)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};t.prototype.delay=function(t){return u(t,this)};var h=function(t,e,i){var n;n="string"!=typeof e?e instanceof Error?e:new l("operation timed out"):new l(e),s.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=i&&i.cancel()};t.prototype.timeout=function(t,e){t=+t;var i,s,l=new r(setTimeout(function(){i.isPending()&&h(i,e,s)},t));return n.cancellation()?(s=this.then(),i=s._then(a,o,void 0,l,void 0),i._setOnCancel(l)):i=this._then(a,o,void 0,l,void 0),i}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,a,o){function s(e,i,n){for(var a=0;a<i.length;++a){n._pushContext();var o=f(i[a])(e);if(n._popContext(),o===d){n._pushContext();var s=t.reject(d.e);return n._popContext(),s}var l=r(o,n);if(l instanceof t)return l}return null}function l(e,i,r,a){if(o.cancellation()){var s=new t(n),l=this._finallyPromise=new t(n);this._promise=s.lastly(function(){return l}),s._captureStackTrace(),s._setOnCancel(this)}else{(this._promise=new t(n))._captureStackTrace()}this._stack=a,this._generatorFunction=e,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}var c=i(15),u=c.TypeError,h=i(8),d=h.errorObj,f=h.tryCatch,p=[];h.inherits(l,a),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,o.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,i=void 0!==this._generator.return;if(i)this._promise._pushContext(),e=f(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=f(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},l.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=f(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},l.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=f(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(e){var i=this._promise;if(e===d)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var a=r(n,this._promise);if(!(a instanceof t)&&null===(a=s(a,this._yieldHandlers,this._promise)))return void this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));a=a._target();var o=a._bitField;0==(50397184&o)?(this._yieldedPromise=a,a._proxy(this,null)):0!=(33554432&o)?t._async.invoke(this._promiseFulfilled,this,a._value()):0!=(16777216&o)?t._async.invoke(this._promiseRejected,this,a._reason()):this._promiseCancelled()},t.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,n=l,r=(new Error).stack;return function(){var e=t.apply(this,arguments),a=new n(void 0,void 0,i,r),o=a.promise();return a._generator=e,a._promiseFulfilled(void 0),o}},t.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("expecting a function but got "+h.classString(t));p.push(t)},t.spawn=function(i){if(o.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof i)return e("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new l(i,this),r=n.promise();return n._run(t.spawn),r}}},function(t,e,i){"use strict";t.exports=function(t){function e(t,e){var i=this;if(!a.isArray(t))return n.call(i,t,e);var r=s(e).apply(i._boundValue(),[null].concat(t));r===l&&o.throwLater(r.e)}function n(t,e){var i=this,n=i._boundValue(),r=void 0===t?s(e).call(n,null):s(e).call(n,null,t);r===l&&o.throwLater(r.e)}function r(t,e){var i=this;if(!t){var n=new Error(t+"");n.cause=t,t=n}var r=s(e).call(i._boundValue(),t);r===l&&o.throwLater(r.e)}var a=i(8),o=t._async,s=a.tryCatch,l=a.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(t,i){if("function"==typeof t){var a=n;void 0!==i&&Object(i).spread&&(a=e),this._then(a,r,void 0,this,t)}return this}}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t,e){function r(t){return!w.test(t)}function a(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function o(t,e,i){var n=p.getDataPropertyOrDefault(t,e+i,_);return!!n&&a(n)}function s(t,e,i){for(var n=0;n<t.length;n+=2){var r=t[n];if(i.test(r))for(var a=r.replace(i,""),o=0;o<t.length;o+=2)if(t[o]===a)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function l(t,e,i,n){for(var r=p.inheritedDataKeys(t),l=[],c=0;c<r.length;++c){var u=r[c],h=t[u],d=n===S||S(u,h,t);"function"!=typeof h||a(h)||o(t,u,e)||!n(u,h,t,d)||l.push(u,h)}return s(l,e,i),l}function c(i,n,r,a,o,s){function l(){var r=n;n===f&&(r=this);var a=new t(e);a._captureStackTrace();var o="string"==typeof u&&this!==c?this[u]:i,l=m(a,s);try{o.apply(r,g(arguments,l))}catch(t){a._rejectCallback(v(t),!0,!0)}return a._isFateSealed()||a._setAsyncGuaranteed(),a}var c=function(){return this}(),u=i;return"string"==typeof u&&(i=a),p.notEnumerableProp(l,"__isPromisified__",!0),l}function u(t,e,i,n,r){for(var a=new RegExp(M(e)+"$"),o=l(t,e,a,i),s=0,c=o.length;s<c;s+=2){var u=o[s],h=o[s+1],d=u+e;if(n===T)t[d]=T(u,f,u,h,e,r);else{var m=n(h,function(){return T(u,f,u,h,e,r)});p.notEnumerableProp(m,"__isPromisified__",!0),t[d]=m}}return p.toFastProperties(t),t}function h(t,e,i){return T(t,e,void 0,t,null,i)}var d,f={},p=i(8),m=i(22),g=p.withAppended,v=p.maybeWrapAsError,b=p.canEvaluate,y=i(15).TypeError,_={__isPromisified__:!0},x=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],w=new RegExp("^(?:"+x.join("|")+")$"),S=function(t){return p.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},M=function(t){return t.replace(/([$])/,"\\$")},k=function(t){for(var e=[t],i=Math.max(0,t-1-3),n=t-1;n>=i;--n)e.push(n);for(var n=t+1;n<=3;++n)e.push(n);return e},E=function(t){return p.filledRange(t,"_arg","")},z=function(t){return p.filledRange(Math.max(t,3),"_arg","")},O=function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0};d=function(i,n,r,a,o,s){function l(t){var e,i=E(t).join(", "),r=t>0?", ":"";return e=h?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===n?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n",e.replace("{{args}}",i).replace(", ",r)}var c=Math.max(0,O(a)-1),u=k(c),h="string"==typeof i||n===f,d="string"==typeof i?"this != null ? this['"+i+"'] : fn":"fn",b="'use strict';                                                \n\t        var ret = function (Parameters) {                                    \n\t            'use strict';                                                    \n\t            var len = arguments.length;                                      \n\t            var promise = new Promise(INTERNAL);                             \n\t            promise._captureStackTrace();                                    \n\t            var nodeback = nodebackForPromise(promise, "+s+");   \n\t            var ret;                                                         \n\t            var callback = tryCatch([GetFunctionCode]);                      \n\t            switch(len) {                                                    \n\t                [CodeForSwitchCase]                                          \n\t            }                                                                \n\t            if (ret === errorObj) {                                          \n\t                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n\t            }                                                                \n\t            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n\t            return promise;                                                  \n\t        };                                                                   \n\t        notEnumerableProp(ret, '__isPromisified__', true);                   \n\t        return ret;                                                          \n\t    ".replace("[CodeForSwitchCase]",function(){for(var t="",e=0;e<u.length;++e)t+="case "+u[e]+":"+l(u[e]);return t+="                                                             \n\t        default:                                                             \n\t            var args = new Array(len + 1);                                   \n\t            var i = 0;                                                       \n\t            for (var i = 0; i < len; ++i) {                                  \n\t               args[i] = arguments[i];                                       \n\t            }                                                                \n\t            args[i] = nodeback;                                              \n\t            [CodeForCall]                                                    \n\t            break;                                                           \n\t        ".replace("[CodeForCall]",h?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",d);return b=b.replace("Parameters",z(c)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",b)(t,a,n,g,v,m,p.tryCatch,p.errorObj,p.notEnumerableProp,e)};var T=b?d:c;t.promisify=function(t,e){if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t));if(a(t))return t;e=Object(e);var i=void 0===e.context?f:e.context,n=!!e.multiArgs,o=h(t,i,n);return p.copyDescriptors(t,o,r),o},t.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!==(void 0===t?"undefined":n(t)))throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");e=Object(e);var i=!!e.multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var a=e.filter;"function"!=typeof a&&(a=S);var o=e.promisifier;if("function"!=typeof o&&(o=T),!p.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=p.inheritedDataKeys(t),l=0;l<s.length;++l){var c=t[s[l]];"constructor"!==s[l]&&p.isClass(c)&&(u(c.prototype,r,a,o,i),u(c,r,a,o,i))}return u(t,r,a,o,i)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){function a(t){var e,i=!1;if(void 0!==s&&t instanceof s)e=h(t),i=!0;else{var n=u.keys(t),r=n.length;e=new Array(2*r);for(var a=0;a<r;++a){var o=n[a];e[a]=t[o],e[a+r]=o}}this.constructor$(e),this._isMap=i,this._init$(void 0,i?-6:-3)}function o(e){var i,o=n(e);return c(o)?(i=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new a(o).promise(),o instanceof t&&i._propagateFrom(o,2),i):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,l=i(8),c=l.isObject,u=i(9);"function"==typeof Map&&(s=Map);var h=function(){function t(t,n){this[e]=t,this[e+i]=n,e++}var e=0,i=0;return function(n){i=n.size,e=0;var r=new Array(2*n.size);return n.forEach(t,r),r}}(),d=function(t){for(var e=new s,i=t.length/2|0,n=0;n<i;++n){var r=t[i+n],a=t[n];e.set(r,a)}return e};l.inherits(a,e),a.prototype._init=function(){},a.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var i;if(this._isMap)i=d(this._values);else{i={};for(var n=this.length(),r=0,a=this.length();r<a;++r)i[this._values[r+n]]=this._values[r]}return this._resolve(i),!0}return!1},a.prototype.shouldCopyValues=function(){return!1},a.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return o(this)},t.props=function(t){return o(t)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){function a(i,a){var l=n(i);if(l instanceof t)return s(l);if(null===(i=o.asArray(i)))return r("expecting an array or an iterable object but got "+o.classString(i));var c=new t(e);void 0!==a&&c._propagateFrom(a,3);for(var u=c._fulfill,h=c._reject,d=0,f=i.length;d<f;++d){var p=i[d];(void 0!==p||d in i)&&t.cast(p)._then(u,h,void 0,c,null)}return c}var o=i(8),s=function(t){return t.then(function(e){return a(e,t)})};t.race=function(t){return a(t,void 0)},t.prototype.race=function(){return a(this,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,a,o){function s(e,i,n,r){this.constructor$(e);var o=d();this._fn=null===o?i:f.domainBind(o,i),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===a?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function c(t,e,i,r){return"function"!=typeof e?n("expecting a function but got "+f.classString(e)):new s(t,e,i,r).promise()}function u(e){this.accum=e,this.array._gotAccum(e);var i=r(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(h,void 0,void 0,this,void 0)):h.call(this,i)}function h(e){var i=this.array,n=i._promise,r=p(i._fn);n._pushContext();var a;(a=void 0!==i._eachValues?r.call(n._boundValue(),e,this.index,this.length):r.call(n._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(i._currentCancellable=a);var s=n._popContext();return o.checkForgottenReturns(a,s,void 0!==i._eachValues?"Promise.each":"Promise.reduce",n),a}var d=t._getDomain,f=i(8),p=f.tryCatch;f.inherits(s,e),s.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==a&&this._eachValues.push(t)},s.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},s.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},s.prototype._iterate=function(e){this._values=e;var i,n,r=e.length;if(void 0!==this._initialValue?(i=this._initialValue,n=0):(i=t.resolve(e[0]),n=1),this._currentCancellable=i,!i.isRejected())for(;n<r;++n){var a={accum:null,value:e[n],index:n,length:r,array:this};i=i._then(u,void 0,void 0,a,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(l,l,void 0,i,this)},t.prototype.reduce=function(t,e){return c(this,t,e,null)},t.reduce=function(t,e,i,n){return c(t,e,i,n)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t){this.constructor$(t)}var a=t.PromiseInspection;i(8).inherits(r,e),r.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(t,e){var i=new a;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},r.prototype._promiseRejected=function(t,e){var i=new a;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},t.settle=function(t){return n.deprecated(".settle()",".reflect()"),new r(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function a(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new r(t),a=i.promise();return i.setHowMany(e),i.init(),a}var o=i(8),s=i(15).RangeError,l=i(15).AggregateError,c=o.isArray,u={};o.inherits(r,e),r.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=c(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(t){this._howMany=t},r.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},r.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},r.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},r.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new l,e=this.length();e<this._values.length;++e)this._values[e]!==u&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(t){this._values.push(t)},r.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new s(e)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return a(t,e)},t.prototype.some=function(t){return a(this,t)},t._SomePromiseArray=r}},function(t,e){"use strict";t.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,n){return i(this,t,n,e)},t.filter=function(t,n,r){return i(t,n,r,e)}}},function(t,e){"use strict";t.exports=function(t,e){function i(){return a(this)}function n(t,i){return r(t,i,e,e)}var r=t.reduce,a=t.all;t.prototype.each=function(t){return r(this,t,e,0)._then(i,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return r(this,t,e,e)},t.each=function(t,n){return r(t,n,e,0)._then(i,void 0,void 0,t,void 0)},t.mapSeries=n}},function(t,e){"use strict";t.exports=function(t){function e(t){var e=new i(t),n=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),n}var i=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function a(t,e,i){function a(){return p(Y),v({select:{key:["concept"],value:["concept_type","domain"]},from:"concepts"}).then(d).then(f)}function d(t){var e=t.filter(function(t){return"entity_set"===t.concept_type}).map(function(t){return{concept:"is--"+t.concept,concept_type:"boolean",domain:null}});return t=t.concat(e).concat(Y),p(t),J}function f(){var t=new Map([["boolean",function(t){return"true"===t||"TRUE"===t}],["measure",function(t){return parseFloat(t)}]]),e=P(["concept"]),i=[].concat(r(e)).map(function(e){return e.data.then(function(e){var i=Object.keys(e.data[0]),n=new Map;return i.forEach(function(e){var i=J.get(e).concept_type,r=t.get(i);r&&n.set(e,r)}),e.data.forEach(function(t){var e=!0,i=!1,r=void 0;try{for(var a,o=n[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var l=s(a.value,2),c=l[0],u=l[1];t[c]=u(t[c])}}catch(t){i=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw r}}})})});return c.all(i)}function p(t){J.clear(),t.forEach(function(t){return J.set(t.concept,t)})}function m(t){return g(t)?G.then(function(){return x(t)}):Q.then(function(){return v(t)})}function g(t){return"schema"===(t.from||"").split(".")[1]}function v(t){var e=t.select,i=e.key,n=void 0===i?[]:i,a=e.value,o=void 0===a?[]:a,l=(t.from,t.where),u=void 0===l?{}:l,h=t.join,d=void 0===h?{}:h,f=t.order_by,p=void 0===f?[]:f,m=t.language,g={key:n,value:o},v=new Set(g.key.concat(g.value)),x=z(u).filter(function(t){return!v.has(t)}),k=A(g.key,[].concat(r(g.value),r(x)),m),E=M(d),O=C(g.key);return c.all([k,O,E]).then(function(t){var e=s(t,3),i=e[0],n=e[1],a=e[2],o=y(u,a),l=_(n,o),c=i.map(function(t){return D(t,g,x)}),h=j.apply(void 0,[g.key,"overwrite"].concat(r(c))).filter(function(t){return S(t,l)}).map(function(t){return w(t,v)}).map(function(t){return I(t,v)});return b(h,p),h})}function b(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0!==e.length){var i=e.map(function(t){if("string"==typeof t)return{concept:t,direction:1};var e=Object.keys(t)[0];return{concept:e,direction:"asc"===t[e]?1:-1}}),n=i.length;t.sort(function(t,e){for(var r=0;r<n;r++){var a=i[r];if(t[a.concept]<e[a.concept])return-1*a.direction;if(t[a.concept]>e[a.concept])return 1*a.direction}return 0})}}function y(t,e){var i={};for(var n in t){var r=t[n];["$and","$or","$nor"].includes(n)?i[n]=r.map(function(t){return y(t,e)}):"$in"===n||"$nin"===n?i[n]=new Set(r):void 0!==e[r]?Object.assign(i,e[r]):"object"===(void 0===r?"undefined":o(r))?i[n]=y(r,e):i[n]=r}return i}function _(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(function(t,e){return t.$and.push(e),t},{$and:[]})}function x(t){var e=function(t){return tt.ddfSchema[t].map(function(t){return{key:t.primaryKey,value:t.value}})},i=t.from.split(".")[0];return tt.ddfSchema[i]?e(i):"*"===i?Object.keys(tt.ddfSchema).map(e).reduce(function(t,e){return t.concat(e)}):void F(new l.DdfCsvError(l.DDF_ERROR,"No valid collection ("+i+") for schema query"))}function w(t,e){var i=!0,n=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value;void 0===t[s]&&(t[s]=null)}}catch(t){n=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw r}}return t}function S(t,e){return Object.keys(e).every(function(i){var n=W.get(i);return n?n(t,e[i]):"object"!==o(e[i])?W.get("$eq")(t[i],e[i]):S(t[i],e[i])})}function M(t){return c.all(Object.keys(t).map(function(e){return E(e,t[e])})).then(function(t){return t.reduce(k,{})})}function k(t,e){return Object.assign(t,e)}function E(t,e){return"time"===J.get(e.key).concept_type?c.resolve(n({},t,e.where)):m({select:{key:[e.key]},where:e.where}).then(function(i){return n({},t,n({},e.key,{$in:new Set(i.map(function(t){return t[e.key]}))}))})}function z(t){var e=[];for(var i in t)["$and","$or","$not","$nor"].includes(i)?t[i].map(z).forEach(function(t){return e.push.apply(e,r(t))}):e.push(i);return e}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Array.from(J.keys()),i=[],n=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=J.get(l);t.includes(c.concept_type)&&i.push(c)}}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}function T(t,e){var i=new Set(e),n=["entity_set","entity_domain"],a=O(n,t);if(0===a.length)return new Map;var o=O(n);return a.map(function(t){return o.filter(function(e){return"entity_set"===t.concept_type?i.has(e.concept)&&e.concept!==t.concept&&(e.domain===t.domain||e.concept===t.domain):i.has(e.concept)&&e.concept!==t.concept&&e.domain===t.concept}).reduce(function(e,i){return e.set(i.concept,t.concept)},new Map)}).reduce(function(t,e){return new Map([].concat(r(t),r(e)))},new Map)}function C(t){var e=O(["entity_set"],t).map(function(t){return m({select:{key:[t.domain],value:["is--"+t.concept]}}).then(function(e){return n({},t.concept,{$in:new Set(e.filter(function(e){return e["is--"+t.concept]}).map(function(e){return e[t.domain]}))})})});return c.all(e).then(function(t){return t.reduce(function(t,e){return Object.assign(t,e)},{})})}function P(t,e){return e&&0!==e.length?Array.isArray(e)?e.map(function(e){return P(t,e)}).reduce(function(t,e){return new Set([].concat(r(t),r(e)))},new Set):new Set($.get(N(t)).get(e)):new Set([].concat(r($.get(N(t)).values())).reduce(function(t,e){return t.concat(e)}))}function D(t,e,i){var n=t.resource.schema.primaryKey,a=new Set([].concat(r(n),r(e.value),r(i))),o=T(e.key,n);return t.data.map(function(t){return I(t,a)}).map(function(t){return L(t,o)})}function A(t,e,i){var n=P(t,e);return c.all([].concat(r(n)).map(function(t){return B(t,i)}))}function I(t,e){var i={};for(var n in t)e.has(n)&&(i[n]=t[n]);return i}function L(t,e){var i={};for(var n in t)i[e.get(n)||n]=t[n];return i}function j(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),a=2;a<i;a++)n[a-2]=arguments[a];if(1===n.length)return n[0];var o=t.slice(0).sort();return[].concat(r(n.reduce(function(t,i){return i.forEach(function(i){var n=o.map(function(t){return i[t]}).join(",");if(t.has(n)){R(t.get(n),i,e)}else t.set(n,i)}),t},new Map).values()))}function R(t,e,i){switch(i){case"overwrite":Object.assign(t,e);break;case"translation":for(var n in e)""!==e[n]&&(t[n]=e[n]);break;case"overwriteWithError":for(var r in e)if(void 0!==t[r]&&t[r]!==e[r]){var a=JSON.stringify(e),o=JSON.stringify(t),s='JOIN Error: two resources have different data for "'+r+'": '+a+","+o;F(new l.DdfCsvError(l.DDF_ERROR,s))}else t[r]=e[r]}}function F(t){throw(i||console).error(t.message),t}function N(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.slice(0).sort();return e?i.map(function(t){return e[t]}).join(","):i.join(",")}function B(t,e){var i=[];void 0===t.data&&(t.data=q(U+t.path)),i.push(t.data);var n=void 0!==e&&H().includes(e),a=void 0!==t.translations[e];if(n){if(!a){var o=U+"lang/"+e+"/"+t.path;t.translations[e]=q(o)}i.push(t.translations[e])}return c.all(i).then(function(e){var i=e.map(function(t){return t.data}),n=t.schema.primaryKey;return{data:j.apply(void 0,[n,"translation"].concat(r(i))),resource:t}})}function H(){return tt.translations.map(function(t){return t.id})}function q(t){return new c(function(i,n){e.readText(t,function(e,r){if(e)return n(new l.DdfCsvError(l.FILE_READING_ERROR,e,t));u.parse(r,{header:!0,skipEmptyLines:!0,dynamicTyping:function(t){return!J||["boolean","measure"].includes((J.get(t)||{}).concept_type)},complete:function(t){return i(t)},error:function(e){return n(new l.DdfCsvError(l.CSV_PARSING_ERROR,e,t))}})})})}function K(t){return Z.size>0?Z:(t.resources.forEach(function(t){Array.isArray(t.schema.primaryKey)||(t.schema.primaryKey=[t.schema.primaryKey]),t.translations={},Z.set(t.name,t)}),Z)}function V(t){if($.size>0)return $;for(var e in t.ddfSchema)t.ddfSchema[e].map(function(t){var e=N(t.primaryKey),i=t.resources.map(function(t){return Z.get(t)});$.has(e)?$.get(e).set(t.value,i):$.set(e,new Map([[t.value,i]]))});return $}var Y=[{concept:"concept",concept_type:"string",domain:null},{concept:"concept_type",concept_type:"string",domain:null}],W=new Map([["$and",function(t,e){return e.every(function(e){return S(t,e)})}],["$or",function(t,e){return e.some(function(e){return S(t,e)})}],["$not",function(t,e){return!S(t,e)}],["$nor",function(t,e){return!e.some(function(e){return S(t,e)})}],["$eq",function(t,e){return t==e}],["$ne",function(t,e){return t!=e}],["$gt",function(t,e){return h(t)&&t>e}],["$gte",function(t,e){return h(t)&&t>=e}],["$lt",function(t,e){return h(t)&&t<e}],["$lte",function(t,e){return h(t)&&t<=e}],["$in",function(t,e){return e.has(t)}],["$nin",function(t,e){return!e.has(t)}]]),X=function(t){return t.endsWith("datapackage.json")||(t.endsWith("/")||(t+="/"),t+="datapackage.json"),t}(t),U=function(t){var e=t.split("/");return e.pop(),e.join("/")+"/"}(X),G=function(t){return new c(function(i,n){e.readText(t,function(e,r){if(e)return n(new l.DdfCsvError(l.FILE_READING_ERROR,e,t));try{tt=JSON.parse(r)}catch(e){return n(new l.DdfCsvError(l.JSON_PARSING_ERROR,e,t))}K(tt),V(tt),i(tt)})})}(X),Q=G.then(a),$=new Map,Z=new Map,J=new Map,tt=void 0;return{query:m}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(e,"__esModule",{value:!0});var l=i(3),c=i(5),u=i(45),h=function(t){return!("number"!=typeof t&&!t)};e.ddfCsvReader=a},function(t,e,i){var n,r,a,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(i,o){r=[],n=o,void 0!==(a="function"==typeof n?n.apply(e,r):n)&&(t.exports=a)}(0,function(){"use strict";function t(t,e){e=e||{};var i=e.dynamicTyping||!1;if(v(i)&&(e.dynamicTypingFunction=i,i={}),e.dynamicTyping=i,e.worker&&k.WORKERS_SUPPORTED){var o=u();return o.userStep=e.step,o.userChunk=e.chunk,o.userComplete=e.complete,o.userError=e.error,e.step=v(e.step),e.chunk=v(e.chunk),e.complete=v(e.complete),e.error=v(e.error),delete e.worker,void o.postMessage({input:t,config:e,workerId:o.id})}var l=null;return"string"==typeof t?l=e.download?new n(e):new a(e):!0===t.readable&&v(t.read)&&v(t.on)?l=new s(e):(y.File&&t instanceof File||t instanceof Object)&&(l=new r(e)),l.stream(t)}function e(t,e){function i(t){if("object"!==(void 0===t?"undefined":o(t)))return[];var e=[];for(var i in t)e.push(i);return e}function n(t,e){var i="";"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e));var n=t instanceof Array&&t.length>0,a=!(e[0]instanceof Array);if(n&&l){for(var o=0;o<t.length;o++)o>0&&(i+=c),i+=r(t[o],o);e.length>0&&(i+=u)}for(var s=0;s<e.length;s++){for(var h=n?t.length:e[s].length,d=0;d<h;d++){d>0&&(i+=c);var f=n&&a?t[d]:d;i+=r(e[s][f],d)}s<e.length-1&&(i+=u)}return i}function r(t,e){return void 0===t||null===t?"":(t=t.toString().replace(d,h+h),"boolean"==typeof s&&s||s instanceof Array&&s[e]||a(t,k.BAD_DELIMITERS)||t.indexOf(c)>-1||" "===t.charAt(0)||" "===t.charAt(t.length-1)?h+t+h:t)}function a(t,e){for(var i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return!0;return!1}var s=!1,l=!0,c=",",u="\r\n",h='"';!function(){"object"===(void 0===e?"undefined":o(e))&&("string"==typeof e.delimiter&&1===e.delimiter.length&&-1===k.BAD_DELIMITERS.indexOf(e.delimiter)&&(c=e.delimiter),("boolean"==typeof e.quotes||e.quotes instanceof Array)&&(s=e.quotes),"string"==typeof e.newline&&(u=e.newline),"string"==typeof e.quoteChar&&(h=e.quoteChar),"boolean"==typeof e.header&&(l=e.header))}();var d=new RegExp(h,"g");if("string"==typeof t&&(t=JSON.parse(t)),t instanceof Array){if(!t.length||t[0]instanceof Array)return n(null,t);if("object"===o(t[0]))return n(i(t[0]),t)}else if("object"===(void 0===t?"undefined":o(t)))return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),t.data instanceof Array&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=t.data[0]instanceof Array?t.fields:i(t.data[0])),t.data[0]instanceof Array||"object"===o(t.data[0])||(t.data=[t.data])),n(t.fields||[],t.data||[]);throw"exception: Unable to serialize unrecognized input"}function i(t){function e(t){var e=m(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null),this._handle=new l(e),this._handle.streamer=this,this._config=e}this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&v(this._config.beforeFirstChunk)){var e=this._config.beforeFirstChunk(t);void 0!==e&&(t=e)}this.isFirstChunk=!1;var i=this._partialLine+t;this._partialLine="";var n=this._handle.parse(i,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var r=n.meta.cursor;this._finished||(this._partialLine=i.substring(r-this._baseIndex),this._baseIndex=r),n&&n.data&&(this._rowCount+=n.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(x)y.postMessage({results:n,workerId:k.WORKER_ID,finished:a});else if(v(this._config.chunk)){if(this._config.chunk(n,this._handle),this._paused)return;n=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(n.data),this._completeResults.errors=this._completeResults.errors.concat(n.errors),this._completeResults.meta=n.meta),!a||!v(this._config.complete)||n&&n.meta.aborted||this._config.complete(this._completeResults,this._input),a||n&&n.meta.paused||this._nextChunk(),n}},this._sendError=function(t){v(this._config.error)?this._config.error(t):x&&this._config.error&&y.postMessage({workerId:k.WORKER_ID,error:t,finished:!1})}}function n(t){function e(t){var e=t.getResponseHeader("Content-Range");return null===e?-1:parseInt(e.substr(e.lastIndexOf("/")+1))}t=t||{},t.chunkSize||(t.chunkSize=k.RemoteChunkSize),i.call(this,t);var n;this._nextChunk=_?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)return void this._chunkLoaded();if(n=new XMLHttpRequest,this._config.withCredentials&&(n.withCredentials=this._config.withCredentials),_||(n.onload=g(this._chunkLoaded,this),n.onerror=g(this._chunkError,this)),n.open("GET",this._input,!_),this._config.downloadRequestHeaders){var t=this._config.downloadRequestHeaders;for(var e in t)n.setRequestHeader(e,t[e])}if(this._config.chunkSize){var i=this._start+this._config.chunkSize-1;n.setRequestHeader("Range","bytes="+this._start+"-"+i),n.setRequestHeader("If-None-Match","webkit-no-cache")}try{n.send()}catch(t){this._chunkError(t.message)}_&&0===n.status?this._chunkError():this._start+=this._config.chunkSize},this._chunkLoaded=function(){if(4==n.readyState){if(n.status<200||n.status>=400)return void this._chunkError();this._finished=!this._config.chunkSize||this._start>e(n),this.parseChunk(n.responseText)}},this._chunkError=function(t){var e=n.statusText||t;this._sendError(e)}}function r(t){t=t||{},t.chunkSize||(t.chunkSize=k.LocalChunkSize),i.call(this,t);var e,n,r="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,n=t.slice||t.webkitSlice||t.mozSlice,r?(e=new FileReader,e.onload=g(this._chunkLoaded,this),e.onerror=g(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);t=n.call(t,this._start,i)}var a=e.readAsText(t,this._config.encoding);r||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function a(t){t=t||{},i.call(this,t);var e,n;this.stream=function(t){return e=t,n=t,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var t=this._config.chunkSize,e=t?n.substr(0,t):n;return n=t?n.substr(t):"",this._finished=!n,this.parseChunk(e)}}}function s(t){t=t||{},i.call(this,t);var e=[],n=!0;this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._nextChunk=function(){e.length?this.parseChunk(e.shift()):n=!0},this._streamData=g(function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),n&&(n=!1,this.parseChunk(e.shift()))}catch(t){this._streamError(t)}},this),this._streamError=g(function(t){this._streamCleanUp(),this._sendError(t.message)},this),this._streamEnd=g(function(){this._streamCleanUp(),this._finished=!0,this._streamData("")},this),this._streamCleanUp=g(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function l(t){function e(){if(S&&p&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+k.DefaultDelimiter+"'"),p=!1),t.skipEmptyLines)for(var e=0;e<S.data.length;e++)1===S.data[e].length&&""===S.data[e][0]&&S.data.splice(e--,1);return i()&&n(),o()}function i(){return t.header&&0===w.length}function n(){if(S){for(var t=0;i()&&t<S.data.length;t++)for(var e=0;e<S.data[t].length;e++)w.push(S.data[t][e]);S.data.splice(0,1)}}function r(e){return t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),!0===(t.dynamicTyping[e]||t.dynamicTyping)}function a(t,e){return r(t)?"true"===e||"TRUE"===e||"false"!==e&&"FALSE"!==e&&u(e):e}function o(){if(!S||!t.header&&!t.dynamicTyping)return S;for(var e=0;e<S.data.length;e++){for(var i=t.header?{}:[],n=0;n<S.data[e].length;n++){var r=n,o=S.data[e][n];t.header&&(r=n>=w.length?"__parsed_extra":w[n]),o=a(r,o),"__parsed_extra"===r?(i[r]=i[r]||[],i[r].push(o)):i[r]=o}S.data[e]=i,t.header&&(n>w.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+w.length+" fields but parsed "+n,e):n<w.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+w.length+" fields but parsed "+n,e))}return t.header&&S.meta&&(S.meta.fields=w),S}function s(e,i,n){for(var r,a,o,s=[",","\t","|",";",k.RECORD_SEP,k.UNIT_SEP],l=0;l<s.length;l++){var u=s[l],h=0,d=0,f=0;o=void 0;for(var p=new c({delimiter:u,newline:i,preview:10}).parse(e),m=0;m<p.data.length;m++)if(n&&1===p.data[m].length&&0===p.data[m][0].length)f++;else{var g=p.data[m].length;d+=g,void 0!==o?g>1&&(h+=Math.abs(g-o),o=g):o=g}p.data.length>0&&(d/=p.data.length-f),(void 0===a||h<a)&&d>1.99&&(a=h,r=u)}return t.delimiter=r,{successful:!!r,bestDelimiter:r}}function l(t){t=t.substr(0,1048576);var e=t.split("\r"),i=t.split("\n"),n=i.length>1&&i[0].length<e[0].length;if(1===e.length||n)return"\n";for(var r=0,a=0;a<e.length;a++)"\n"===e[a][0]&&r++;return r>=e.length/2?"\r\n":"\r"}function u(t){return g.test(t)?parseFloat(t):t}function h(t,e,i,n){S.errors.push({type:t,code:e,message:i,row:n})}var d,f,p,g=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,b=this,y=0,_=!1,x=!1,w=[],S={data:[],errors:[],meta:{}};if(v(t.step)){var M=t.step;t.step=function(n){if(S=n,i())e();else{if(e(),0===S.data.length)return;y+=n.data.length,t.preview&&y>t.preview?f.abort():M(S,b)}}}this.parse=function(i,n,r){if(t.newline||(t.newline=l(i)),p=!1,t.delimiter)v(t.delimiter)&&(t.delimiter=t.delimiter(i),S.meta.delimiter=t.delimiter);else{var a=s(i,t.newline,t.skipEmptyLines);a.successful?t.delimiter=a.bestDelimiter:(p=!0,t.delimiter=k.DefaultDelimiter),S.meta.delimiter=t.delimiter}var o=m(t);return t.preview&&t.header&&o.preview++,d=i,f=new c(o),S=f.parse(d,n,r),e(),_?{meta:{paused:!0}}:S||{meta:{paused:!1}}},this.paused=function(){return _},this.pause=function(){_=!0,f.abort(),d=d.substr(f.getCharIndex())},this.resume=function(){_=!1,b.streamer.parseChunk(d)},this.aborted=function(){return x},this.abort=function(){x=!0,f.abort(),S.meta.aborted=!0,v(t.complete)&&t.complete(S),d=""}}function c(t){t=t||{};var e=t.delimiter,i=t.newline,n=t.comments,r=t.step,a=t.preview,o=t.fastMode,s=t.quoteChar||'"';if(("string"!=typeof e||k.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw"Comment character same as delimiter";!0===n?n="#":("string"!=typeof n||k.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=i&&"\r"!=i&&"\r\n"!=i&&(i="\n");var l=0,c=!1;this.parse=function(t,u,h){function d(t){S.push(t),E=l}function f(e){return h?m():(void 0===e&&(e=t.substr(l)),k.push(e),l=b,d(k),w&&g(),m())}function p(e){l=e,d(k),k=[],C=t.indexOf(i,l)}function m(t){return{data:S,errors:M,meta:{delimiter:e,linebreak:i,aborted:c,truncated:!!t,cursor:E+(u||0)}}}function g(){r(m()),S=[],M=[]}if("string"!=typeof t)throw"Input must be a string";var b=t.length,y=e.length,_=i.length,x=n.length,w=v(r);l=0;var S=[],M=[],k=[],E=0;if(!t)return m();if(o||!1!==o&&-1===t.indexOf(s)){for(var z=t.split(i),O=0;O<z.length;O++){var k=z[O];if(l+=k.length,O!==z.length-1)l+=i.length;else if(h)return m();if(!n||k.substr(0,x)!==n){if(w){if(S=[],d(k.split(e)),g(),c)return m()}else d(k.split(e));if(a&&O>=a)return S=S.slice(0,a),m(!0)}}return m()}for(var T=t.indexOf(e,l),C=t.indexOf(i,l),P=new RegExp(s+s,"g");;)if(t[l]!==s)if(n&&0===k.length&&t.substr(l,x)===n){if(-1===C)return m();l=C+_,C=t.indexOf(i,l),T=t.indexOf(e,l)}else if(-1!==T&&(T<C||-1===C))k.push(t.substring(l,T)),l=T+y,T=t.indexOf(e,l);else{if(-1===C)break;if(k.push(t.substring(l,C)),p(C+_),w&&(g(),c))return m();if(a&&S.length>=a)return m(!0)}else{var D=l;for(l++;;){var D=t.indexOf(s,D+1);if(-1===D)return h||M.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:S.length,index:l}),f();if(D===b-1){var A=t.substring(l,D).replace(P,s);return f(A)}if(t[D+1]!==s){if(t[D+1]===e){k.push(t.substring(l,D).replace(P,s)),l=D+1+y,T=t.indexOf(e,l),C=t.indexOf(i,l);break}if(t.substr(D+1,_)===i){if(k.push(t.substring(l,D).replace(P,s)),p(D+1+_),T=t.indexOf(e,l),w&&(g(),c))return m();if(a&&S.length>=a)return m(!0);break}M.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:S.length,index:l}),D++}else D++}}return f()},this.abort=function(){c=!0},this.getCharIndex=function(){return l}}function u(){if(!k.WORKERS_SUPPORTED)return!1;if(!w&&null===k.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=k.SCRIPT_PATH||b;t+=(-1!==t.indexOf("?")?"&":"?")+"papaworker";var e=new y.Worker(t);return e.onmessage=h,e.id=M++,S[e.id]=e,e}function h(t){var e=t.data,i=S[e.workerId],n=!1;if(e.error)i.userError(e.error,e.file);else if(e.results&&e.results.data){var r=function(){n=!0,d(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},a={abort:r,pause:f,resume:f};if(v(i.userStep)){for(var o=0;o<e.results.data.length&&(i.userStep({data:[e.results.data[o]],errors:e.results.errors,meta:e.results.meta},a),!n);o++);delete e.results}else v(i.userChunk)&&(i.userChunk(e.results,a,e.file),delete e.results)}e.finished&&!n&&d(e.workerId,e.results)}function d(t,e){var i=S[t];v(i.userComplete)&&i.userComplete(e),i.terminate(),delete S[t]}function f(){throw"Not implemented."}function p(t){var e=t.data;if(void 0===k.WORKER_ID&&e&&(k.WORKER_ID=e.workerId),"string"==typeof e.input)y.postMessage({workerId:k.WORKER_ID,results:k.parse(e.input,e.config),finished:!0});else if(y.File&&e.input instanceof File||e.input instanceof Object){var i=k.parse(e.input,e.config);i&&y.postMessage({workerId:k.WORKER_ID,results:i,finished:!0})}}function m(t){if("object"!==(void 0===t?"undefined":o(t)))return t;var e=t instanceof Array?[]:{};for(var i in t)e[i]=m(t[i]);return e}function g(t,e){return function(){t.apply(e,arguments)}}function v(t){return"function"==typeof t}var b,y=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==y?y:{}}(),_=!y.document&&!!y.postMessage,x=_&&/(\?|&)papaworker(=|&|$)/.test(y.location.search),w=!1,S={},M=0,k={};if(k.parse=t,k.unparse=e,k.RECORD_SEP=String.fromCharCode(30),k.UNIT_SEP=String.fromCharCode(31),k.BYTE_ORDER_MARK="\ufeff",k.BAD_DELIMITERS=["\r","\n",'"',k.BYTE_ORDER_MARK],k.WORKERS_SUPPORTED=!_&&!!y.Worker,k.SCRIPT_PATH=null,k.LocalChunkSize=10485760,k.RemoteChunkSize=5242880,k.DefaultDelimiter=",",k.Parser=c,k.ParserHandle=l,k.NetworkStreamer=n,k.FileStreamer=r,k.StringStreamer=a,k.ReadableStreamStreamer=s,y.jQuery){var E=y.jQuery;E.fn.parse=function(t){function e(){if(0===a.length)return void(v(t.complete)&&t.complete());var e=a[0];if(v(t.before)){var r=t.before(e.file,e.inputElem);if("object"===(void 0===r?"undefined":o(r))){if("abort"===r.action)return void i("AbortError",e.file,e.inputElem,r.reason);if("skip"===r.action)return void n();"object"===o(r.config)&&(e.instanceConfig=E.extend(e.instanceConfig,r.config))}else if("skip"===r)return void n()}var s=e.instanceConfig.complete;e.instanceConfig.complete=function(t){v(s)&&s(t,e.file,e.inputElem),n()},k.parse(e.file,e.instanceConfig)}function i(e,i,n,r){v(t.error)&&t.error({name:e},i,n,r)}function n(){a.splice(0,1),e()}var r=t.config||{},a=[];return this.each(function(t){if("INPUT"!==E(this).prop("tagName").toUpperCase()||"file"!==E(this).attr("type").toLowerCase()||!y.FileReader||!this.files||0===this.files.length)return!0;for(var e=0;e<this.files.length;e++)a.push({file:this.files[e],inputElem:this,instanceConfig:E.extend({},r)})}),e(),this}}return x?y.onmessage=p:k.WORKERS_SUPPORTED&&(b=function(){var t=document.getElementsByTagName("script");return t.length?t[t.length-1].src:""}(),document.body?document.addEventListener("DOMContentLoaded",function(){w=!0},!0):w=!0),n.prototype=Object.create(i.prototype),n.prototype.constructor=n,r.prototype=Object.create(i.prototype),r.prototype.constructor=r,a.prototype=Object.create(a.prototype),a.prototype.constructor=a,s.prototype=Object.create(i.prototype),s.prototype.constructor=s,k})}]);t.exports=i},function(t,e){!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=8)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(5);var n=i(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a={version:"2.0.3-4",build:1518537790319};e.default=Vizabi.Tool.extend("BubbleChart",{init:function(t,e){this.name="bubblechart",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),t.ui.chart.lockNonSelected&&(!t.ui.splash||!1===t.state.time.splash)){var e=t.state.time.parse(""+t.ui.chart.lockNonSelected);e<t.state.time.start&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.start)),e>t.state.time.end&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.end))}},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_tags:{autoconfig:{type:"entity_domain",includeOnlyIDs:["tag"]}},marker_tags:{space:["entities_tags"],label:{use:"property",which:"name"},hook_parent:{}},marker:{limit:5e3,space:["entities","time"],axis_x:{use:"indicator",autoconfig:{index:0,type:"measure"}},axis_y:{use:"indicator",autoconfig:{index:1,type:"measure"}},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:2,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{superhighlightOnMinimapHover:!0,whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},margin:{left:0,top:0},trails:!0,lockNonSelected:0},datawarning:{doubtDomain:[],doubtRange:[]},show_ticks:!0,presentation:!1,panWithArrow:!1,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!1,buttons:["colors","find","zoom","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}},versionInfo:a})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),a=n(r),o=i(2),s=n(o),l=Vizabi,c=l.utils,u=Vizabi.helpers,h=u.svgexport,d=u.labels,f=u["d3.axisWithLabelPicker"],p=u["d3.dynamicBackground"],m=Vizabi.iconset,g=m.warn,v=m.question,b=Vizabi.Component.extend("bubblechart",{init:function(t,e){var n=this,r=this;this.name="bubblechart",this.template=i(6),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.playing":function(t,e){c.isTouchDevice()&&r.model.time.playing&&r.someHighlighted&&r.model.marker.clearHighlighted()},"change:time.start":function(t,e){if(r._readyOnce&&!r.model.time.splash)return["color","axis_x","axis_y"].filter(function(t){return r.model.marker[t].which==r.model.time.dim}).length?void r.ready():void r._trails.create().then(function(){r._trails.run(["findVisible","reveal","opacityHandler"])})},"change:time.end":function(t,e){if(r._readyOnce&&!r.model.time.splash)return["color","axis_x","axis_y"].filter(function(t){return r.model.marker[t].which==r.model.time.dim}).length?void r.ready():void r._trails.create().then(function(){r._trails.run(["findVisible","reveal","opacityHandler"])})},"change:time.record":function(){r.model.time.record?r._export.open(this.element,this.name):r._export.reset()},"change:ui.chart.trails":function(t){r._readyOnce&&(r._trails.toggle(r.model.ui.chart.trails),r.redrawDataPoints())},"change:ui.chart.lockNonSelected":function(t){r._readyOnce&&r.redrawDataPoints(500)},"change:marker":function(t,e){if(r._readyOnce){if(e.indexOf("scaleType")>-1)return void r.ready();if(-1===e.indexOf("marker.color")&&-1===e.indexOf("marker.size")&&-1===e.indexOf("marker.size_label"))if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1){if(!r.yScale||!r.xScale)return;r.updateSize(),r.updateMarkerSizeLimits(),r._trails.run("findVisible"),r.redrawDataPoints(),r._trails.run("resize",null,500)}else if(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(r.draggingNow)return;if(c.approxEqual(r._zoomedXYMinMax.axis_x.zoomedMin,r.model.marker.axis_x.zoomedMin,.01)&&c.approxEqual(r._zoomedXYMinMax.axis_x.zoomedMax,r.model.marker.axis_x.zoomedMax,.01)&&c.approxEqual(r._zoomedXYMinMax.axis_y.zoomedMin,r.model.marker.axis_y.zoomedMin,.01)&&c.approxEqual(r._zoomedXYMinMax.axis_y.zoomedMax,r.model.marker.axis_y.zoomedMax,.01))return;var i=!1;r.model.time.playing&&(i=!0,r.model.time.pause(!0)),r._trails.run("abortAnimation"),r._panZoom.zoomToMaxMin(r.model.marker.axis_x.getZoomedMin(),r.model.marker.axis_x.getZoomedMax(),r.model.marker.axis_y.getZoomedMin(),r.model.marker.axis_y.getZoomedMax(),500,"don't feed these zoom values back to state"),i&&(r.model.time.postponePause=!1)}}},"change:marker.select":function(t,e){r._readyOnce&&r.entityBubbles&&((t.source._val||[]).length-(t.source._previousVal||[]).length>50&&(r.model.ui.chart.trails=!1),r.selectDataPoints(),r.redrawDataPoints(),r._trails.create().then(function(){r._trails.run(["findVisible","reveal","opacityHandler"])}),r.updateBubbleOpacity(),r._updateDoubtOpacity())},"change:marker.superHighlight":function(t,e){n._readyOnce&&n._blinkSuperHighlighted()},"change:marker.highlight":function(t,e){if(r._readyOnce)if("highlight"==e)r.highlightDataPoints();else if(null!==e){var i=r._formatSTitleValues(e.size,e.color);r._updateSTitle(i[0],i[1])}else r._updateSTitle()},"change:time.value":function(){!r.model.time.splash&&r._readyOnce&&r.entityBubbles&&(r.calculationQueue?r.calculationQueue.push(r.model.time.value.toString()):r.calculationQueue=[r.model.time.value.toString()],function(t){r.model.marker.getFrame(t,function(t,e){if(!r._frameIsValid(t))return c.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");var i=r.calculationQueue.indexOf(e.toString());-1!=i&&(r.calculationQueue.splice(0,i+1),r.frameChanged(t,e))})}(r.model.time.value))},"change:ui.adaptMinMaxZoom":function(){r.model.ui.adaptMinMaxZoom?r._panZoom.expandCanvas(500):r._panZoom.reset()},"change:marker.size.extent":function(t,e){r._readyOnce&&(r.updateMarkerSizeLimits(),r.redrawDataPointsOnlySize(),r._trails.run("resize"))},"change:marker.color":function(t,e){r._readyOnce&&(r.redrawDataPointsOnlyColors(),r._trails.run("recolor"))},"change:marker.opacitySelectDim":function(){r.updateBubbleOpacity()},"change:marker.opacityRegular":function(){r.updateBubbleOpacity(),r._trails.run("opacityHandler")},"change:ui.cursorMode":function(){var t=r.chartSvg;"plus"===r.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1)):"minus"===r.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0),t.classed("vzb-panhand",!1)):"hand"===r.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1))},"change:marker.space":function(){r.someHighlighted&&r.model.marker.clearHighlighted(),r.someSelected&&r.model.marker.clearSelected()},ready:function(){}},this._super(t,e),this.xScale=null,this.yScale=null,this.sScale=null,this.cScale=null,this.xAxis=f("bottom"),this.yAxis=f("left"),r.COLOR_BLACKISH="#333",r.COLOR_WHITEISH="#fdfdfd",this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this._trails=new a.default(this),this._panZoom=new s.default(this),this._export=new h(this),this._export.prefix("vzb-bc-").deleteClasses(["vzb-bc-bubbles-crop","vzb-hidden","vzb-bc-year","vzb-bc-zoom-rect","vzb-bc-projection-x","vzb-bc-projection-y","vzb-bc-axis-c-title"]),this._labels=new d(this),this._labels.config({CSS_PREFIX:"vzb-bc",LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-bubbles",LINES_CONTAINER_SELECTOR_PREFIX:"bubble-"})},_rangeBump:function(t,e){var i=this.activeProfile.maxRadiusPx/2;if(e=e?-1:1,c.isArray(t)&&t.length>1){var n=t[0],r=t[t.length-1];return n<r?(n+=i*e,r-=i*e,n>r&&(n=r=(n+r)/2)):n>r&&(n-=i*e,r+=i*e,n<r&&(n=r=(n+r)/2)),[n,r]}c.warn("rangeBump error: input is not an array or empty")},readyOnce:function(){var t=this;this._readyOnce=!1,this.scrollableAncestor=c.findScrollableAncestor(this.element),this.element=d3.select(this.element),this.chartSvg=this.element.select("svg"),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisElContainer=this.graph.select(".vzb-bc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-bc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.ySubTitleEl=this.graph.select(".vzb-bc-axis-y-subtitle"),this.xSubTitleEl=this.graph.select(".vzb-bc-axis-x-subtitle"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.sTitleEl=this.graph.select(".vzb-bc-axis-s-title"),this.cTitleEl=this.graph.select(".vzb-bc-axis-c-title"),this.yearEl=this.graph.select(".vzb-bc-year"),this.year=new p(this.yearEl),this.yInfoEl=this.graph.select(".vzb-bc-axis-y-info"),this.xInfoEl=this.graph.select(".vzb-bc-axis-x-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.projectionX=this.graph.select(".vzb-bc-projection-x"),this.projectionY=this.graph.select(".vzb-bc-projection-y"),this.lineEqualXY=this.graph.select(".vzb-bc-line-equal-xy"),this.trailsContainer=this.graph.select(".vzb-bc-trails"),this.bubbleContainerCrop=this.graph.select(".vzb-bc-bubbles-crop"),this.zoomSelection=this.graph.select(".vzb-zoom-selection"),this.labelsContainerCrop=this.graph.select(".vzb-bc-labels-crop"),this.bubbleContainer=this.graph.select(".vzb-bc-bubbles"),this.labelsContainer=this.graph.select(".vzb-bc-labels"),this.linesContainer=this.graph.select(".vzb-bc-lines"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.eventArea=this.element.select(".vzb-bc-eventarea"),this.entityBubbles=null,this.bubbleCrown=this.element.select(".vzb-bc-bubble-crown"),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltipMobile=this.element.select(".vzb-tooltip-mobile"),this.on("resize",function(){t._trails.run("abortAnimation"),t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),function(e,i,n,r){t._panZoom.zoomer.dontFeedToState=!0,t._panZoom.rerun(),t._panZoom.zoomToMaxMin(e,i,n,r,0,!0)}(t._zoomedXYMinMax.axis_x.zoomedMin,t._zoomedXYMinMax.axis_x.zoomedMax,t._zoomedXYMinMax.axis_y.zoomedMin,t._zoomedXYMinMax.axis_y.zoomedMax))}),d3.select("body").on("keydown",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||(d3.event.metaKey||d3.event.ctrlKey)&&t.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}).on("mouseenter",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}),this.root.on("resetZoom",function(){t._panZoom.reset(null,500)}),this._panZoom.zoomSelection(this.bubbleContainerCrop),this.bubbleContainerCrop.call(this._panZoom.dragRectangle).call(this._panZoom.zoomer).on("dblclick.zoom",null).on("mouseup",function(){t.draggingNow=!1}).on("click",function(){var e=t.model.ui.cursorMode;d3.event.defaultPrevented||"arrow"===e||"hand"===e||t._panZoom.zoomByIncrement(e,500)}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=c.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce(),t._readyOnce=!0},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.size).length)},ready:function(){var t=this;this.KEYS=c.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings();this.model.time.end;this.updateIndicators(),this.updateTime(),t.model.time.splash||t._trails.create(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void c.defer(function(){t.ready()}):t._frameIsValid(e)?(t.frame=e,t.updateSize(),t.updateMarkerSizeLimits(),t.updateEntities(),t._labels.ready(),t.redrawDataPoints(),t.selectDataPoints(),t.updateBubbleOpacity(),t._updateDoubtOpacity(),t.zoomToMarkerMaxMin(),t.model.time.splash||t._trails.run(["findVisible","reveal","opacityHandler"]),void(t.model.ui.adaptMinMaxZoom&&t._panZoom.expandCanvas())):c.warn("ready: empty data received from marker.getFrame(). doing nothing")})},zoomToMarkerMaxMin:function(){this._panZoom.resetZoomState();var t=this.model.marker.axis_x,e=this.model.marker.axis_y,i=(t.getScale().domain(),e.getScale().domain(),t.getZoomedMin()),n=t.getZoomedMax(),r=e.getZoomedMin(),a=e.getZoomedMax();this._panZoom.zoomToMaxMin(i,n,r,a,0,"don't feed these zoom values back to state")},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this._labels.setScales(this.xScale,this.yScale),this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},frameChanged:function(t,e){this.frame=t,this.updateTime(),this._updateDoubtOpacity(),this._trails.run("findVisible"),this.model.ui.adaptMinMaxZoom?this._panZoom.expandCanvas():this.redrawDataPoints(),this._trails.run("reveal",null,this.duration),this.tooltipMobile.classed("vzb-hidden",!0),this._reorderEntities()},_getSubtitle:function(t,e){var i=t.replace(e,"");","===i[0]&&(i=i.slice(1));var n=/^\((.*)\)$|.*/.exec(i.trim());return n[1]||n[0]||""},updateUIStrings:function(){var t=this,e=(this.getLayoutProfile(),t.model.marker.axis_y.getConceptprops()),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.size.getConceptprops(),r=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:i.name,S:n.name,C:r.name},title_short:{Y:e.name_short,X:i.name_short,S:n.name_short,C:r.name_short},subtitle:{Y:this._getSubtitle(e.name,e.name_short),X:this._getSubtitle(i.name,i.name_short),S:n.name_short,C:r.name_short},unit:{Y:e.unit||"",X:i.unit||"",S:n.unit||"",C:r.unit||""}},this.ySubTitleEl.selectAll("text").data([0]).enter().append("text"),this.xSubTitleEl.selectAll("text").data([0]).enter().append("text");var a=this.yTitleEl.selectAll("text").data([0]);a.enter().append("text"),a.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var o=this.xTitleEl.selectAll("text").data([0]);o.enter().append("text"),o.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("bottom").updateView().toggle()});var s=this.sTitleEl.selectAll("text").data([0]);s.enter().append("text"),s.attr("text-anchor","end"),c.setIcon(this.dataWarningEl,g).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),c.setIcon(this.yInfoEl,v).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),c.setIcon(this.xInfoEl,v).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=c.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=c.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+r.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t._updateDoubtOpacity(1)}).on("mouseout",function(){t._updateDoubtOpacity()})},_updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.model.time.formatDate(this.time))),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateEntities:function(){var t=this,e=this.dataKeys=this.model.marker.getDataKeysPerHook(),i=this.KEYS,n=this.KEY,r=this.TIMEDIM,a=function(a){return a=a||"",t.model.marker.getKeys().map(function(s){var l=Object.assign({},s);return l[r]=o,l.sortValue=t.frame.size[c.getKey(s,e.size)]||0,l[n]=a+c.getKey(s,i),l}).sort(function(t,e){return e.sortValue-t.sortValue})},o=this.model.time.end,s=a.call(this);this.model.marker.setVisible(s),this.model.time.splash||this.unselectBubblesWithNoData(s),this.entityBubbles=this.bubbleContainer.selectAll("circle.vzb-bc-entity").data(this.model.marker.getVisible(),function(t){return t[n]}),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class",function(t){return"vzb-bc-entity bubble-"+t[n]}).on("mouseover",function(e,i){c.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseover(e,i)}).on("mouseout",function(e,i){c.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseout(e,i)}).on("click",function(e,i){c.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().click(e,i)}).onTap(function(e,i){d3.event.stopPropagation(),t._bubblesInteract().click(e,i)}).onLongTap(function(t,e){}).merge(this.entityBubbles),this._reorderEntities()},unselectBubblesWithNoData:function(t){var e=this,i=this.KEYS,n=this.KEY;if(this.model.marker.select.length){var r=[],a=t.map(function(t){return t[n]});this.model.marker.select.forEach(function(t){-1!==a.indexOf(c.getKey(t,i))&&r.push(t)}),r.length!==e.model.marker.select.length&&(e.model.marker.select=r)}},_reorderEntities:function(){var t=this,e=this.dataKeys,i=this.KEY;this.bubbleContainer.selectAll(".vzb-bc-entity").sort(function(n,r){var a=t.frame.size[c.getKey(n,e.size)],o=t.frame.size[c.getKey(r,e.size)];return void 0===a&&void 0!==o?-1:void 0!==a&&void 0===o?1:a!=o?d3.descending(a,o):n[i]!=r[i]?d3.ascending(n[i],r[i]):void 0!==n.trailStartTime||void 0!==r.trailStartTime?void 0!==n.trailStartTime?-1:1:void 0!==n.status||void 0!==r.status?void 0!==n.status?-1:1:d3.descending(a,o)})},_bubblesInteract:function(){var t=this;this.KEY,this.TIMEDIM;return{mouseover:function(e,i){t.model.marker.highlightMarker(e),t._labels.showCloseCross(e,!0)},mouseout:function(e,i){t.model.marker.clearHighlighted(),t._labels.showCloseCross(e,!1)},click:function(e,i){if(!t.draggingNow){var n=t.model.marker.isSelected(e);t.model.marker.selectMarker(e),c.isTouchDevice()||(n&&t.model.marker.highlightMarker(e),t.highlightDataPoints())}}}},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time,"ui"),this.duration)},updateSize:function(){var t=this.chartSvg,e=c.px2num(t.style("width")),i=c.px2num(t.style("height")),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+i*e},r=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+e*i},a={small:{margin:{top:30,bottom:35,left:30,right:10},leftMarginRatio:1,padding:2,minRadiusPx:.5,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},medium:{margin:{top:15,bottom:40,left:40,right:15},leftMarginRatio:1.6,padding:2,minRadiusPx:1,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:20,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4},large:{margin:{top:15,bottom:n(30,.03),left:r(31,.015),right:20},leftMarginRatio:1.8,padding:2,minRadiusPx:1,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:22,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:n(0,.01),hideSTitle:!0}},o={medium:{margin:{top:20,bottom:55,left:50,right:20},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4,infoElHeight:26},large:{margin:{top:30,bottom:n(45,.03),left:r(35,.025),right:30},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:n(-10,.01),infoElHeight:32,hideSTitle:!0}},s=this;this.activeProfile=this.getActiveProfile(a,o);var l=this.getLayoutProfile(),u=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*c.hypotenuse(u.width,u.height));var h=this.activeProfile.margin,d=this.activeProfile.infoElHeight;if(s._labels.setCloseCrossHeight(1.2*s.activeProfile.infoElHeight),s._labels.setTooltipFontSize(s.activeProfile.infoElHeight+"px"),this.height=parseInt(this.element.style("height"),10)-h.top-h.bottom||0,this.width=parseInt(this.element.style("width"),10)-h.left*this.activeProfile.leftMarginRatio-h.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,c.warn("Bubble chart updateSize(): vizabi container is too little or has display:none")),this.graph.attr("transform","translate("+h.left*this.activeProfile.leftMarginRatio+","+h.top+")"),this.year.resize(this.width,this.height),this.eventArea.attr("width",this.width).attr("height",Math.max(0,this.height)),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range(this._rangeBump([this.height,0])):this.yScale.rangePoints([this.height,0],s.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range(this._rangeBump([0,this.width])):this.xScale.rangePoints([0,this.width],s.activeProfile.padding).range(),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:h,limitMaxTickNumber:6,bump:this.activeProfile.maxRadiusPx/2,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:h,bump:this.activeProfile.maxRadiusPx/2,viewportLength:this.width,formatter:this.model.marker.axis_x.getTickFormatter()}),this.bubbleContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-1),this.xAxisEl.attr("transform","translate(1,"+(1+this.height)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.projectionX.attr("y1",s.yScale.range()[0]+this.activeProfile.maxRadiusPx/2),this.projectionY.attr("x2",s.xScale.range()[0]-this.activeProfile.maxRadiusPx/2),this._updateSTitle(),this.sTitleEl.attr("transform","translate("+this.width+",20) rotate(-90)"),"small"!==l)this.ySubTitleEl.select("text").attr("dy",.6*d).text(this.strings.subtitle.Y),this.xSubTitleEl.select("text").attr("dy",.3*-d).text(this.strings.subtitle.X),this.yTitleEl.select("text").text(this.strings.title_short.Y+" ").append("tspan").style("font-size",.7*d+"px").text("â–¼"),this.xTitleEl.select("text").text(this.strings.title_short.X+" ").append("tspan").style("font-size",.7*d+"px").text("â–¼");else{this.ySubTitleEl.select("text").text(""),this.xSubTitleEl.select("text").text("");var f=this.yTitleEl.select("text").text(this.strings.title.Y);f.node().getBBox().width>this.width&&f.text(this.strings.title_short.Y);var p=this.xTitleEl.select("text").text(this.strings.title.X);p.node().getBBox().width>this.width-100&&p.text(this.strings.title_short.X)}var m=this.model.locale.isRTL();if(this.ySubTitleEl.style("font-size",.8*d+"px").attr("transform","translate(0,0) rotate(-90)"),this.xSubTitleEl.style("font-size",.8*d+"px").attr("transform","translate("+this.width+","+this.height+")"),this.yTitleEl.style("font-size",d+"px").attr("transform","small"!==l?"translate("+(-h.left-this.activeProfile.yAxisTitleBottomMargin)+","+.5*this.height+") rotate(-90)":"translate("+(m?this.width:10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")"),this.xTitleEl.style("font-size",d+"px").attr("transform","small"!==l?"translate("+.5*this.width+","+(this.height+h.bottom-this.activeProfile.xAxisTitleBottomMargin)+")":"translate("+(m?this.width:0)+","+(this.height+h.bottom-this.activeProfile.xAxisTitleBottomMargin)+")"),this.yInfoEl.select("svg").node()){var g=this.yTitleEl.node().getBBox(),v=c.transform(this.yTitleEl.node()),b=m?g.x+v.translateX-1.4*d:g.x+v.translateX+g.width+.4*d,y=m?v.translateY+1.4*d+.5*g.width:v.translateY-.4*d-.5*g.width;this.yInfoEl.select("svg").attr("width",d+"px").attr("height",d+"px"),this.yInfoEl.attr("transform","small"!==l?"translate("+(v.translateX-.8*d)+","+y+") rotate(-90)":"translate("+b+","+(v.translateY-.8*d)+")")}if(this.xInfoEl.select("svg").node()){var _=this.xTitleEl.node().getBBox(),x=c.transform(this.xTitleEl.node()),w=m?_.x+x.translateX-1.4*d:_.x+x.translateX+_.width+.4*d;this.xInfoEl.select("svg").attr("width",d+"px").attr("height",d+"px"),this.xInfoEl.attr("transform","translate("+w+","+(x.translateY-.8*d)+")")}this._resizeDataWarning(),this.model.ui.chart.margin.set("left",h.left*this.activeProfile.leftMarginRatio,!1,!1)},_updateLineEqualXY:function(t){var e=this.model.marker.axis_x.which==this.model.marker.axis_y.which;if(this.lineEqualXY.classed("vzb-invisible",!e),e){var i=d3.min(this.yScale.domain().concat(this.xScale.domain())),n=d3.max(this.yScale.domain().concat(this.xScale.domain()));this.lineEqualXY.transition().duration(t||0).attr("y1",this.yScale(i)).attr("y2",this.yScale(n)).attr("x1",this.xScale(i)).attr("x2",this.xScale(n))}},_resizeDataWarning:function(){var t=this.dataWarningEl.select("text").style("font-size",null),e=t.node().getBBox().width+3*t.node().getBBox().height,i=this.width-this.xTitleEl.node().getBBox().width-this.activeProfile.infoElHeight,n=parseInt(t.style("font-size"))*i/e;t.style("font-size",e>i?n+"px":null);var r=t.node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+(this.model.locale.isRTL()?r.width+r.height:this.width)+","+(this.height+this.activeProfile.margin.bottom-this.activeProfile.xAxisTitleBottomMargin)+")")},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return c.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,i=this.activeProfile.maxRadiusPx,n=c.radiusToArea(Math.max(i*t[0],e)),r=c.radiusToArea(Math.max(i*t[1],e)),a=n===r?[n,r]:d3.range(n,r,(r-n)/this.sScale.domain().length).concat(r);this.sScale.range(a)},redrawDataPointsOnlyColors:function(){var t=this;if(!this.entityBubbles)return c.warn("redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!");var e=void 0,i=this.dataKeys=this.model.marker.getDataKeysPerHook(),n=this.KEYS,r=this.KEY,a=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(a=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(a,function(a){if(!t._frameIsValid(a))return c.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing");e=t.frame,t.entityBubbles.each(function(o,s){var l=t.model.marker.isSelected(o),u=l?e.color[c.getKey(o,i.color)]:a.color[c.getKey(o,i.color)],h=null!=u?t.cScale(u):t.COLOR_WHITEISH;if(d3.select(this).style("fill",h),l){var d=c.find(t.model.marker.select,function(t){return c.getKey(t,n)==o[r]}),f=t.model.time.parse(""+d.trailStartTime);t.model.marker.getFrame(f,function(e){if(!e)return c.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing");var n={};if(t.model.ui.chart.trails&&f-t.time!=0){var r=e.color[c.getKey(o,i.color)];n.scaledC0=null!=r?t.cScale(r):t.COLOR_WHITEISH}else n.scaledC0=h;t._labels.updateLabelOnlyColor(o,s,n)})}})})},redrawDataPointsOnlySize:function(){var t=this,e=void 0,i=this.dataKeys=this.model.marker.getDataKeysPerHook(),n=this.KEYS,r=this.KEY,a=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(a=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(a,function(a){if(!t._frameIsValid(a))return c.warn("redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing");e=t.frame,t.entityBubbles.each(function(o,s){var l=t.model.marker.isSelected(o),u=l?e.size[c.getKey(o,i.size)]:a.size[c.getKey(o,i.size)];if(null!=u){var h=c.areaToRadius(t.sScale(u));if(d3.select(this).attr("r",h),l){var d=c.find(t.model.marker.select,function(t){return c.getKey(t,n)==o[r]}),f=t.model.time.parse(""+d.trailStartTime);t.model.marker.getFrame(f,function(e){if(!e)return c.warn("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing");var n={};t.model.ui.chart.trails&&f-t.time!=0?n.scaledS0=c.areaToRadius(t.sScale(e.size[c.getKey(o,i.size)])):n.scaledS0=h,t._labels.updateLabelOnlyPosition(o,s,n)})}}})})},redrawDataPoints:function(t){var e=this;this.KEY;if(null==t&&(t=e.duration),this.model.ui.chart.lockNonSelected&&this.someSelected){var i=this.model.time.parse(""+this.model.ui.chart.lockNonSelected);this.model.marker.getFrame(i,function(i){if(!i)return c.warn("redrawDataPoints: empty data received from marker.getFrames(). doing nothing");e.entityBubbles.each(function(n,r){var a=e.model.marker.isSelected(n)?e.frame:i;e._updateBubble(n,a,r,d3.select(this),t)})})}else e.entityBubbles.each(function(i,n){e._updateBubble(i,e.frame,n,d3.select(this),t)});this._updateLineEqualXY(t)},_updateBubble:function(t,e,i,n,r){var a=this,o=this.dataKeys,s=!1,l=e.axis_y[c.getKey(t,o.axis_y)],u=e.axis_x[c.getKey(t,o.axis_x)],h=e.size[c.getKey(t,o.size)],d=e.label[c.getKey(t,o.label)],f=e.color[c.getKey(t,o.color)],p=e.size_label[c.getKey(t,o.size_label)];if(!d&&0!==d||!l&&0!==l||!u&&0!==u||!h&&0!==h){if(t.hidden||(t.hidden=!0,s=!0),s)if(r){var m=n.style("opacity");n.transition().duration(r).ease(d3.easeExp).style("opacity",0).on("end",function(){n.classed("vzb-invisible",t.hidden),n.style("opacity",m)})}else n.classed("vzb-invisible",t.hidden)}else{(t.hidden||n.classed("vzb-invisible"))&&(t.hidden=!1,s=!0);var g=c.areaToRadius(a.sScale(h));if(n.style("fill",null!=f?a.cScale(f):a.COLOR_WHITEISH),r)if(s){var v=n.style("opacity");n.classed("vzb-invisible",t.hidden),n.style("opacity",0).attr("cy",a.yScale(l)).attr("cx",a.xScale(u)).attr("r",g).transition().duration(r).ease(d3.easeExp).style("opacity",v)}else n.transition().duration(r).ease(d3.easeLinear).attr("cy",a.yScale(l)).attr("cx",a.xScale(u)).attr("r",g);else n.interrupt().attr("cy",a.yScale(l)).attr("cx",a.xScale(u)).attr("r",g).transition(),s&&n.classed("vzb-invisible",t.hidden);this.model.time.record&&a._export.write({type:"circle",id:t[KEY],time:this.model.time.value.getUTCFullYear(),fill:null!=f?a.cScale(f):a.COLOR_WHITEISH,cx:a.xScale(u),cy:a.yScale(l),r:g})}a._updateLabel(t,i,e,u,l,h,f,d,p,r,s)},_updateLabel:function(t,e,i,n,r,a,o,s,l,u,h){var d=this,f=this.KEYS,p=this.KEY;if(d.model.marker.isSelected(t)){var m={},g=c.find(d.model.marker.select,function(e){return c.getKey(e,f)==t[p]}),v=d.model.time.formatDate(d.time);this.model.ui.chart.trails&&g.trailStartTime!=v&&null!=g.trailStartTime||(this.model.ui.chart.trails&&null==g.trailStartTime&&(g.trailStartTime=v),m.labelX0=n,m.labelY0=r,m.scaledC0=null!=o?d.cScale(o):d.COLOR_WHITEISH,m.scaledS0=a||0===a?c.areaToRadius(d.sScale(a)):null);var b=d.model.time.parse(""+g.trailStartTime),y=d._getLabelText(i,t,g.trailStartTime);h&&t.hidden&&d.model.ui.chart.trails&&b&&b<d.time&&(h=!1),t.hidden&&!d.model.ui.chart.trails&&(h=!0),this._labels.updateLabel(t,e,m,n,r,a,o,y,l,u,h)}},_getLabelText:function(t,e,i){return this.model.marker.getCompoundLabelText(e,t)+(i&&this.model.time.start-this.model.time.end!=0?" "+i:"")},_setTooltip:function(t,e,i,n,r,a){if(t){var o={};if(a){var s=this.dataKeys,l=this.frame;o.valueY=l.axis_y[c.getKey(a,s.axis_y)],o.valueX=l.axis_x[c.getKey(a,s.axis_x)],o.valueS=l.size[c.getKey(a,s.size)],o.valueC=l.color[c.getKey(a,s.color)],o.valueLST=l.size_label[c.getKey(a,s.size_label)],o.labelText=this._getLabelText(l,a,this.model.time.formatDate(this.time))}var u={};u.labelX0=this.xScale.invert(e),u.labelY0=this.yScale.invert(i),u.scaledS0=n,u.scaledC0=null,this._labels.setTooltip(a,t,u,o)}else this._labels.setTooltip()},_formatSTitleValues:function(t,e){var i=this.strings.unit.S,n=this.strings.unit.C,r=this.model.marker.size.getTickFormatter(),a=this.model.marker.color.getTickFormatter();return this.model.marker.color.isDiscrete()&&"constant"!==this.model.marker.color.use&&e&&this.model.marker.color.getColorlegendMarker()&&(e=this.model.marker.color.getColorlegendMarker().label.getItems()[e]||""),[r(t)+" "+i,e||0===e?a(e)+" "+n:this.translator("hints/nodata")]},_updateSTitle:function(t,e){if(this.activeProfile.hideSTitle&&this.model.ui.dialogs.sidebar.indexOf("colors")>-1&&this.model.ui.dialogs.sidebar.indexOf("size")>-1)return void this.sTitleEl.classed("vzb-invisible",!0);this.sTitleEl.classed("vzb-invisible")&&this.sTitleEl.classed("vzb-invisible",!1);var i="constant"!==this.model.marker.size.use,n="constant"!==this.model.marker.color.use,r=this.sTitleEl.select("text").style("font-size",null).text((i?this.translator("buttons/size")+": "+(t||this.strings.title.S):"")+(i&&n?", ":"")+(n?this.translator("buttons/colors")+": "+(e||this.strings.title.C):"")),a=r.node().getBBox().width,o=this.height-30,s=parseInt(r.style("font-size"))*o/a;r.style("font-size",a>o?s+"px":null)},selectDataPoints:function(){var t=this;this.KEY;c.isTouchDevice()?(t.model.marker.clearHighlighted(),t._labels.showCloseCross(null,!1)):(t._setTooltip(),t._setBubbleCrown()),t.someSelected=t.model.marker.select.length>0,t.nonSelectedOpacityZero=!1},_setBubbleCrown:function(t,e,i,n,r){null!=t?(this.bubbleCrown.classed("vzb-hidden",!1),this.bubbleCrown.select(".vzb-crown").attr("cx",t).attr("cy",e).attr("r",i).attr("fill",r?"none":n),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("cx",t).attr("cy",e).attr("r",i+10).attr("stroke",n)):this.bubbleCrown.classed("vzb-hidden",!0)},_axisProjections:function(t){var e=this,i=this.TIMEDIM,n=this.dataKeys;null!=t?this.model.marker.getFrame(t[i],function(i){var r=i.axis_y[c.getKey(t,n.axis_y)],a=i.axis_x[c.getKey(t,n.axis_x)],o=i.size[c.getKey(t,n.size)],s=c.areaToRadius(e.sScale(o));!r&&0!==r||!a&&0!==a||!o&&0!==o||(e.model.ui.chart.whenHovering.showProjectionLineX&&e.xScale(a)>0&&e.xScale(a)<e.width&&e.yScale(r)+s<e.height&&e.projectionX.style("opacity",1).attr("y2",e.yScale(r)+s).attr("x1",e.xScale(a)).attr("x2",e.xScale(a)),e.model.ui.chart.whenHovering.showProjectionLineY&&e.yScale(r)>0&&e.yScale(r)<e.height&&e.xScale(a)-s>0&&e.projectionY.style("opacity",1).attr("y1",e.yScale(r)).attr("y2",e.yScale(r)).attr("x1",e.xScale(a)-s),e.model.ui.chart.whenHovering.higlightValueX&&e.xAxisEl.call(e.xAxis.highlightValue(a)),e.model.ui.chart.whenHovering.higlightValueY&&e.yAxisEl.call(e.yAxis.highlightValue(r)))}):(this.projectionX.style("opacity",0),this.projectionY.style("opacity",0),this.xAxisEl.call(this.xAxis.highlightValue("none")),this.yAxisEl.call(this.yAxis.highlightValue("none")))},highlightDataPoints:function(){var t=this,e=this.TIMEDIM,i=this.dataKeys,n=this.KEYS,r=this.KEY;if(this.someHighlighted=this.model.marker.highlight.length>0,this.updateBubbleOpacity(),1===this.model.marker.highlight.length){var a=c.clone(this.model.marker.highlight[0]);a[r]=c.getKey(a,n),t.model.ui.chart.lockNonSelected&&t.someSelected&&!t.model.marker.isSelected(a)?a[e]=t.model.time.parse(""+t.model.ui.chart.lockNonSelected):a[e]=t.model.time.parse(""+a.trailStartTime)||t.time,t.model.marker.getFrame(a[e],function(o){if(o){var s=t.xScale(o.axis_x[c.getKey(a,i.axis_x)]),l=t.yScale(o.axis_y[c.getKey(a,i.axis_y)]),u=c.areaToRadius(t.sScale(o.size[c.getKey(a,i.size)])),h=null!=o.color[c.getKey(a,i.color)]?t.cScale(o.color[c.getKey(a,i.color)]):t.COLOR_WHITEISH,d=!1,f=t._formatSTitleValues(o.size[c.getKey(a,i.size)],o.color[c.getKey(a,i.color)]);t._updateSTitle(f[0],f[1]),(s+u<0||s-u>t.width||l+u<0||l-u>t.height)&&(d=!0);var p="",m=!1;if(t.model.marker.isSelected(a)&&t.model.ui.chart.trails){p=t.model.time.formatDate(t.time);var g=c.find(t.model.marker.select,function(t){return c.getKey(t,n)==a[r]});m=p!==g.trailStartTime&&!d3.select(d3.event.target).classed("bubble-"+a[r]),p=p!==g.trailStartTime&&t.time===a[e]?p:""}else p=t.model.marker.isSelected(a)?"":t._getLabelText(o,a);if(t._labels.highlight(null,!1),t._labels.highlight(a,!0),t.model.marker.isSelected(a)){var v=!a.trailStartTime||a.trailStartTime==t.model.time.formatDate(t.time);t._setBubbleCrown(s,l,u,h,v)}d||m||t._axisProjections(a),!p||d||m||t._setTooltip(p,s,l,u+3,h,a);var b=c.find(t.model.marker.select,function(t){return c.getKey(t,n)==a[r]});if(b){var y=c.clone(b);y.opacity=1,t._trails.run(["opacityHandler"],y)}}})}else this._axisProjections(),this._trails.run(["opacityHandler"]),t._updateSTitle(),this._setTooltip(),this._setBubbleCrown(),this._labels.highlight(null,!1)},_blinkSuperHighlighted:function(){var t=this;this.entityBubbles.classed("vzb-super-highlighted",function(e){return t.model.marker.isSuperHighlighted(e)})},updateBubbleOpacity:function(t){var e=this,i=this.model.marker.opacityHighlightDim,n=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?1:e.someSelected?e.model.marker.isSelected(t)?1:r:e.someHighlighted?i:n});var a=e.model.marker.opacitySelectDim<.01;a!=this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(t){return e.someSelected&&a&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=b},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi,r=n.utils,a=Vizabi.Class.extend({init:function(t){this.context=t,this.dragRectangle=d3.drag(),this.zoomer=d3.zoom(),this.dragRectangle.subject(this.dragSubject()).on("start",this.drag().start).on("drag",this.drag().go).on("end",this.drag().stop),this.zoomer.filter(this.zoomFilter()).scaleExtent([.0625,1/0]).on("start",this.zoom().start).on("zoom",this.zoom().go).on("end",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,t._zoomedXYMinMax={axis_x:{zoomedMin:null,zoomedMax:null},axis_y:{zoomedMin:null,zoomedMax:null}}},dragSubject:function(){var t=this.context;return function(e){return!d3.event.sourceEvent.ctrlKey&&!d3.event.sourceEvent.metaKey&&"plus"!==t.ui.cursorMode||"minus"===t.ui.cursorMode||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1)?null:{x:d3.mouse(this)[0],y:d3.mouse(this)[1]}}},drag:function(){var t=this.context,e=this;return{start:function(e,i){this.origin={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},t.zoomRect.classed("vzb-invisible",!1)},go:function(e,i){var n=this.origin,r={x:d3.event.x,y:d3.event.y};t.zoomRect.attr("x",Math.min(r.x,n.x)).attr("y",Math.min(r.y,n.y)).attr("width",Math.abs(r.x-n.x)).attr("height",Math.abs(r.y-n.y))},stop:function(i){if(t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},!(Math.abs(this.origin.x-this.target.x)<10||Math.abs(this.origin.y-this.target.y)<10)){var n=d3.event.sourceEvent.ctrlKey||d3.event.sourceEvent.metaKey||"plus"===t.ui.cursorMode;e._zoomOnRectangle(d3.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,n,500)}}}},zoomFilter:function(){var t=this.context;return function(e){var i=d3.event;return!i.ctrlKey&&!i.metaKey&&(("touchmove"===i.type||"touchstart"===i.type)&&(i.touches.length>1||i.targetTouches.length>1)||(!("wheel"!==i.type&&"mousewheel"!==i.type||!t.ui.zoomOnScrolling)||!("mousedown"!==i.type&&"touchstart"!==i.type||"plus"===t.ui.cursorMode||"minus"===t.ui.cursorMode||!t.ui.panWithArrow&&"hand"!==t.ui.cursorMode)))}},zoom:function(){var t=this.context,e=this.zoomer,i=this;return{start:function(){"plus"!==t.ui.cursorMode&&"minus"!==t.ui.cursorMode&&t.chartSvg.classed("vzb-zooming",!0),t.model._data.marker.clearHighlighted(),t._setTooltip()},go:function(){var n=d3.event.sourceEvent,a=d3.event.transform.k,o=[d3.event.transform.x,d3.event.transform.y],s=e.ratioY,l=e.ratioX;t.draggingNow=!0,(isNaN(a)||null==a)&&(a=e.scale),(isNaN(a)||null==a)&&(a=1),1===a&&null!==n&&(("wheel"===n.type||"mousewheel"===n.type)&&(n.deltaY||-n.wheelDelta)>0||"touchmove"===n.type&&n.touches.length>1)&&(e.ratioX=1,l=1,e.ratioY=1,s=1),(isNaN(o[0])||isNaN(o[1])||null==o[0]||null==o[1])&&(o=[0,0]);var c=e.scaleExtent()[0];a*s<c&&(s=c/a,e.ratioY=s),a*l<c&&(l=c/a,e.ratioX=l);var u=a*l<1,h=a*s<1;u?(o[0]<0&&(o[0]=0),o[0]>(1-a*l)*t.width&&(o[0]=(1-a*l)*t.width)):(o[0]>0&&(o[0]=0),o[0]<(1-a*l)*t.width&&(o[0]=(1-a*l)*t.width)),h?(o[1]<0&&(o[1]=0),o[1]>(1-a*s)*t.height&&(o[1]=(1-a*s)*t.height)):(o[1]>0&&(o[1]=0),o[1]<(1-a*s)*t.height&&(o[1]=(1-a*s)*t.height)),i.zoomSelection.property("__zoom",d3.zoomIdentity.translate(o[0],o[1]).scale(a));var d=t.width*a*l,f=t.height*a*s,p=[0*a*l+o[0],d+o[0]],m=[f+o[1],0*a*s+o[1]],g=t._rangeBump(p),v=t._rangeBump(m),b=(g[0]-p[0])*a*l,y=(g[1]-p[1])*a*l,_=(v[0]-m[0])*a*s,x=(v[1]-m[1])*a*s;p[0]+=b,p[1]+=y,m[0]+=_,m[1]+=x;var w=[0,t.width],S=[t.height,0],M=t._rangeBump(w),k=t._rangeBump(S);u?(p[0]<M[0]&&(o[0]=M[0]-b),p[1]>M[1]&&(o[0]=M[1]-y-d)):(p[0]>M[0]&&(o[0]=M[0]-b),p[1]<M[1]&&(o[0]=M[1]-y-d)),h?(m[0]>k[0]&&(o[1]=k[0]-_-f),m[1]<k[1]&&(o[1]=k[1]-x)):(m[0]<k[0]&&(o[1]=k[0]-_-f),m[1]>k[1]&&(o[1]=k[1]-x)),u?(p[0]<M[0]&&(p[1]+=Math.abs(p[0]-M[0]),p[0]=M[0]),p[1]>M[1]&&(p[0]-=Math.abs(p[1]-M[1]),p[1]=M[1])):(p[0]>M[0]&&(p[1]-=Math.abs(p[0]-M[0]),p[0]=M[0]),p[1]<M[1]&&(p[0]+=Math.abs(p[1]-M[1]),p[1]=M[1])),h?(m[0]>k[0]&&(m[1]-=Math.abs(m[0]-k[0]),m[0]=k[0]),m[1]<k[1]&&(m[0]+=Math.abs(m[1]-k[1]),m[1]=k[1])):(m[0]<k[0]&&(m[1]+=Math.abs(m[0]-k[0]),m[0]=k[0]),m[1]>k[1]&&(m[0]-=Math.abs(m[1]-k[1]),m[1]=k[1])),"ordinal"===t.model.marker.axis_x.scaleType?t.xScale.rangeBands(p):t.xScale.range(p),"ordinal"===t.model.marker.axis_y.scaleType?t.yScale.rangeBands(m):t.yScale.range(m);var E=function(t){return r.isDate(t)?t:+t.toFixed(2)},z=M,O=k;t._zoomedXYMinMax={axis_x:{zoomedMin:E(t.xScale.invert(z[0])),zoomedMax:E(t.xScale.invert(z[1]))},axis_y:{zoomedMin:E(t.yScale.invert(O[0])),zoomedMax:E(t.yScale.invert(O[1]))}},e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,null,!1);var T=t.yAxis.labelerOptions(),C=t.xAxis.labelerOptions();T.limitMaxTickNumber=a*s<1.5?8:a*s*8,C.limitMaxTickNumber=a*l<1.5?8:a*l*8,T.transitionDuration=e.duration,C.transitionDuration=e.duration,t.xAxisEl.call(t.xAxis.labelerOptions(C)),t.yAxisEl.call(t.yAxis.labelerOptions(T)),t.redrawDataPoints(e.duration),t._trails.run("resize",null,e.duration),e.duration=0},stop:function(){t.chartSvg.classed("vzb-zooming",!1),t.draggingNow=!1,e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,!0,!0),e.dontFeedToState=null}}},expandCanvas:function(t){var e=this.context;t||(t=e.duration);var i=d3.extent(r.values(e.frame.axis_x)),n=d3.extent(r.values(e.frame.axis_y));if(!i[0]&&0!==i[0]||!i[1]&&0!==i[1]||!n[0]&&0!==n[0]||!n[1]&&0!==n[1])return r.warn("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");var a={x1:e.xScale(i[0]),y1:e.yScale(n[0]),x2:e.xScale(i[1]),y2:e.yScale(n[1])},o=[0,e.width],s=[e.height,0],l={x1:o[0],x2:o[1],y1:s[0],y2:s[1]};if(!e.isCanvasPreviouslyExpanded||a.x1<1*l.x1||a.x2>1*l.x2||a.y2<1*l.y2||a.y1>1*l.y1){if(e.isCanvasPreviouslyExpanded){var c=e._rangeBump(o),u=e._rangeBump(s);a.x1>c[0]&&(a.x1=c[0]),a.x2<c[1]&&(a.x2=c[1]),a.y1<u[0]&&(a.y1=u[0]),a.y2>u[0]&&(a.y2=u[1])}e.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(e.element,a.x1,a.y1,a.x2,a.y2,!1,t)}else e.redrawDataPoints(t)},zoomToMaxMin:function(t,e,i,n,r,a){var o=this.context,s=t,l=e,c=i,u=n,h=o.xScale.domain(),d=o.yScale.domain();s<h[0]&&l<h[1]&&(s=h[0]),s>h[0]&&l>h[1]&&(l=h[1]),c<d[0]&&u<d[1]&&(c=d[0]),c>d[0]&&u>d[1]&&(u=d[1]);var f=[o.xScale(s),o.xScale(l)],p=[o.yScale(c),o.yScale(u)];this._zoomOnRectangle(o.element,f[0],p[0],f[1],p[1],!1,r,a)},_zoomOnRectangle:function(t,e,i,n,a,o,s,l){var c=this.context,u=this.zoomer,h=d3.zoomTransform(this.zoomSelection.node()),d=e,f=i,p=n,m=a;o&&h.translate(d-p,f-m);var g=[0,c.width],v=[c.height,0],b=c._rangeBump(g),y=c._rangeBump(v),_=u.scaleExtent()[0],x=u.scaleExtent()[1],w=void 0,S=void 0,M=void 0;if(d==p||f==m||b[0]==b[1]||y[0]==y[1])return r.warn("_zoomOnRectangle(): can not proceed because this may result in infinity zooms");Math.abs(d-p)>Math.abs(f-m)?(w=Math.abs(y[0]-y[1])/Math.abs(f-m)*h.k,w<_&&(u.ratioY*=w/h.k,w=_),w>x&&(w=x),S=Math.abs(b[0]-b[1])/Math.abs(d-p)*h.k/w*u.ratioX,M=u.ratioY):(w=Math.abs(b[0]-b[1])/Math.abs(d-p)*h.k,w<_&&(u.ratioX*=w/h.k,w=_),w>x&&(w=x),M=Math.abs(y[0]-y[1])/Math.abs(f-m)*h.k/w*u.ratioY,S=u.ratioX);var k=[(h.x-Math.min(d,p))/h.k/u.ratioX*w*S+(b[0]-g[0]),(h.y-Math.min(f,m))/h.k/u.ratioY*w*M+(y[1]-v[1])];u.dontFeedToState=l,u.ratioY=M||1,u.ratioX=S||1,u.duration=s||0,this.zoomSelection.call(u.transform,d3.zoomIdentity.translate(k[0],k[1]).scale(w))},zoomByIncrement:function(t,e){var i=(this.context,d3.zoomTransform(this.zoomSelection.node())),n=i.k,r=[i.x,i.y],a=d3.mouse(this.zoomSelection.node()),o=Math.log(n)/Math.LN2;"plus"!=t&&t||(o=Math.floor(o)+1),"minus"==t&&(o=Math.ceil(o)-1);var s=[(a[0]-r[0])/n,(a[1]-r[1])/n],l=this.zoomer.scaleExtent();n==l[0]&&(this.zoomer.ratioY=1,this.zoomer.ratioX=1),n=Math.max(l[0],Math.min(l[1],Math.pow(2,o))),s=[s[0]*n+r[0],s[1]*n+r[1]],r[0]+=a[0]-s[0],r[1]+=a[1]-s[1],this.zoomer.duration=e||0,this.zoomSelection.call(this.zoomer.transform,d3.zoomIdentity.translate(r[0],r[1]).scale(n))},resetZoomState:function(t){this.zoomer.ratioY=1,this.zoomer.ratioX=1,(t||this.zoomSelection).property("__zoom",d3.zoomIdentity)},reset:function(t,e){this.context.isCanvasPreviouslyExpanded=!1,this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.duration=e||0,(t||this.zoomSelection).call(this.zoomer.transform,d3.zoomIdentity)},rerun:function(t){this.context;(t||this.zoomSelection).call(this.zoomer.scaleBy,1)},zoomSelection:function(t){this.zoomSelection=t}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(4),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a=Vizabi,o=a.utils,s=Vizabi.Class.extend({init:function(t){this.context=t,this._isCreated=null,this.actionsQueue={},this.entityTrails={},this.trailsData=[],this.trailsInProgress={},this.activePromises={},this.trailTransitions={},this.delayedIterations={},this.drawingQueue={}},toggle:function(t){var e=this.context;t?e._trails.create().then(function(){e._trails.run(["findVisible","reveal","opacityHandler"])}):(e._trails.run("remove"),e.model.marker.select.forEach(function(t){delete t.trailStartTime}))},create:function(t){var e=this.context,i=this,n=e.KEYS,a=e.KEY,s=e.dataKeys,l=e.TIMEDIM;return this._isCreated=new Promise(function(c,u){if(e.model.ui.chart.trails){var h=e.model.time.getAllSteps(),d=[];t=null==t?e.model.marker.select:[t],i._clearActions(t),i.trailsData=e.model.marker.select.map(function(t){var e={status:"created",selectedEntityData:t};return n.forEach(function(i){return e[i]=t[i]}),e[a]=o.getKey(t,n),e}),i.trailTransitions={};var f=e.bubbleContainer.selectAll("g.vzb-bc-entity.entity-trail").data(i.trailsData,function(t){return t[a]});f.exit().remove(),f.enter().insert("g",function(t){return this.querySelector(".bubble-"+(0,r.default)(t[a]))}).attr("class",function(t){return"vzb-bc-entity entity-trail trail-"+t[a]}).merge(f).each(function(t,r){var c=this;d.push(new Promise(function(r,u){var d=h.map(function(e){return{t:e,key:t[a]}}),f=d3.select(c).selectAll("g").data(d).classed("vzb-invisible",!0);f.exit().remove(),i.entityTrails[t[a]]=f.enter().append("g").attr("class","vzb-bc-trailsegment vzb-invisible").on("mouseover",function(i,r){if(!o.isTouchDevice()){var c={};c[a]=i.key,c[l]=i.t,e._axisProjections(c),e._labels.highlight(t,!0);var u=e.model.time.formatDate(i.t),h=o.find(e.model.marker.select,function(e){return o.getKey(e,n)==t[a]});e.model.marker.getFrame(c[l],function(i){var n=e.xScale(i.axis_x[o.getKey(t,s.axis_x)]),r=e.yScale(i.axis_y[o.getKey(t,s.axis_y)]),a=o.areaToRadius(e.sScale(i.size[o.getKey(t,s.size)])),l=null!=i.color[o.getKey(t,s.color)]?e.cScale(i.color[o.getKey(t,s.color)]):e.COLOR_WHITEISH;u!==h.trailStartTime&&e._setTooltip(u,n,r,a+3,l),e._setBubbleCrown(n,r,a,l),e.model.marker.getModelObject("highlight").trigger("change",{size:i.size[o.getKey(t,s.size)],color:i.color[o.getKey(t,s.color)]})}),d3.select(this).style("opacity",1)}}).on("mouseout",function(t,i){o.isTouchDevice()||(e._axisProjections(),e._setTooltip(),e._setBubbleCrown(),e._labels.highlight(null,!1),e.model.marker.getModelObject("highlight").trigger("change",null),d3.select(this).style("opacity",e.model.marker.opacityRegular))}).each(function(t,e){var i=d3.select(this);i.append("circle"),i.append("line")}).merge(f),r()}))}),d.length>0?Promise.all(d).then(function(t){c(!0)}):c(!0)}}),this._isCreated},_addActions:function(t,e){var i=this.context,n=this,r=i.KEYS;t.forEach(function(t){var i=o.getKey(t,r);n.actionsQueue[i]||(n.actionsQueue[i]=[]),n.actionsQueue[i]=[].concat(n.actionsQueue[i].filter(function(t){return-1==e.indexOf(t)}),e)})},_clearActions:function(t){var e=this.context,i=this,n=e.KEYS;t.forEach(function(t){var e=o.getKey(t,n);i.actionsQueue[e]||(i.actionsQueue[e]=[]),i.actionsQueue[e]=[],i.drawingQueue[e]={},i.delayedIterations[e]={},i.activePromises[e]||(i.activePromises[e]=[]),o.forEach(i.activePromises[e],function(t,e){"pending"===t.status&&t.reject()}),i.trailsInProgress[e]=null,i.activePromises[e]=[]})},_getNextAction:function(t){return this.actionsQueue[t].shift()},run:function(t,e,i){var n=this.context,r=this,a=n.KEY;this._isCreated&&!n.model.time.splash&&("string"==typeof t&&(t=[t]),this._isCreated.then(function(){if(n.model.ui.chart.trails&&n.model.marker.select.length||"remove"==t){i||(i=0),e=null==e?n.model.marker.select:[e];for(var o=0;o<t.length;o++)-1!=["resize","recolor","remove"].indexOf(t[o])&&function(){var e=t.splice(o,1).pop();--o,r.trailsData.forEach(function(t){var o=r.entityTrails[t[a]];n._trails["_"+e](o,i,t)})}();0!=t.length&&(r._addActions(e,t),r.trailsData.forEach(function(e){-1!=t.indexOf("findVisible")&&(r.drawingQueue[e[a]]={},r.delayedIterations[e[a]]={});var o=r.entityTrails[e[a]];r.trailsInProgress[e[a]]||function t(s){var l=r._getNextAction(e[a]);if(l){r.trailsInProgress[e[a]]=l;var c=n._trails["_"+l](o,i,e);c&&c instanceof Promise?c.then(function(){r.trailsInProgress[e[a]]=null,t(s+1)},function(){r.trailsInProgress[e[a]]=null}):(r.trailsInProgress[e[a]]=null,t(s+1))}}(0)}))}}))},_remove:function(t,e,i){this.actionsQueue[i[this.context.KEY]]=[],t&&(d3.select(this.entityTrails[i[this.context.KEY]].node().parentNode).remove(),this.entityTrails[i[this.context.KEY]]=null)},_resize:function(t,e,i){var n=this.context;if(!n.model.time.splash){var r=!1;t.each(function(t,a){if(null!=t.valueY&&null!=t.valueX&&null!=t.valueS){var s=d3.select(this);if(e?s.select("circle").transition().duration(e).ease(d3.easeLinear).attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",o.areaToRadius(n.sScale(t.valueS))):s.select("circle").interrupt().attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",o.areaToRadius(n.sScale(t.valueS))).transition(),r||t.transparent||(r=!0,n._labels.updateLabelOnlyPosition(i,null,{scaledS0:o.areaToRadius(n.sScale(t.valueS))})),t.next){var l=t.next;if(null!=l&&null!=l.valueY&&null!=l.valueX){var c=Math.sqrt(Math.pow(n.xScale(t.valueX)-n.xScale(l.valueX),2)+Math.pow(n.yScale(t.valueY)-n.yScale(l.valueY),2));e?s.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).attr("stroke-dasharray",c).attr("stroke-dashoffset",o.areaToRadius(n.sScale(t.valueS))):s.select("line").interrupt().attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).attr("stroke-dasharray",c).attr("stroke-dashoffset",o.areaToRadius(n.sScale(t.valueS))).transition()}}}})}},_recolor:function(t,e,i){var n=this.context;t.each(function(t,e){var i=d3.select(this),r="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:t.valueC,shadeID:"shade"}):null!=t.valueC?n.cScale(t.valueC):n.COLOR_BLACKISH;i.select("circle").style("fill",null!=t.valueC?n.cScale(t.valueC):n.COLOR_WHITEISH),i.select("line").style("stroke",r)})},_opacityHandler:function(t,e,i){var n=this.context;t.each(function(t,e){d3.select(this).style("opacity",i.opacity||n.model.marker.opacityRegular)})},_findVisible:function(t,e,i){var n=this.context,r=this,a=n.KEY,s=n.dataKeys;return new Promise(function(e,l){new Promise(function(t,e){i.limits?t():n.model.marker.getEntityLimits(i[a]).then(function(e){i.limits=e,t()})}).then(function(){i.selectedEntityData.trailStartTime||(i.selectedEntityData.trailStartTime=n.model.time.formatDate(n.time));var l=n.model.time.parse(""+i.selectedEntityData.trailStartTime);if(n.time-l<0||i.limits.min-l>0){n.time-l<0?(i.selectedEntityData.trailStartTime=n.model.time.formatDate(d3.max([n.time,i.limits.min])),l=n.model.time.parse(""+i.selectedEntityData.trailStartTime)):(i.selectedEntityData.trailStartTime=n.model.time.formatDate(i.limits.min),l=n.model.time.parse(""+i.selectedEntityData.trailStartTime));var c=n._labels.cached[i[a]],u=n.frame.size[o.getKey(i,s.size)],h=n.frame.color[o.getKey(i,s.color)];c.labelX0=n.frame.axis_x[o.getKey(i,s.axis_x)],c.labelY0=n.frame.axis_y[o.getKey(i,s.axis_y)],c.scaledS0=u||0===u?o.areaToRadius(n.sScale(u)):null,c.scaledC0=null!=h?n.cScale(h):n.COLOR_WHITEISH,n._updateLabel(i,0,n.frame,c.labelX0,c.labelY0,u,h,n.frame.label[o.getKey(i,s.label)],n.frame.size_label[o.getKey(i,s.size_label)],0,!0)}t.each(function(e,r){var a=e.transparent;e.transparent=null==i.selectedEntityData.trailStartTime||e.t-n.time>0||l-e.t>0||i.selectedEntityData.trailStartTime-n.model.time.formatDate(n.time)>=0,(a!=e.transparent||Math.abs(n.model.time.formatDate(e.t)-n.model.time.formatDate(n.time))<2)&&(e.visibilityChanged=!0),e.transparent&&d3.select(t._groups[0][r]).classed("vzb-invisible",e.transparent)}),r.drawingQueue[i[a]]={},r.delayedIterations[i[a]]={},e()})})},_abortAnimation:function(){var t=this.context,e=this,i=t.KEY;e.trailsData.forEach(function(t){e.trailTransitions[t[i]]&&e.trailTransitions[t[i]].select("line").interrupt().transition()})},_reveal:function(t,e,i){var n=this.context;n.model.time.playing&&(e=n.model.time.delay);var r=this,a=(n.KEYS,n.KEY),s=n.dataKeys;i.status="reveal";var l=n.model.time.parse(""+i.selectedEntityData.trailStartTime),c=function(t,c,u,d){return new Promise(function(d,f){var p=d3.select(t._groups[0][c]),m=p.datum();if(u-c==1){if(m.transparent)return p.classed("vzb-invisible",m.transparent),d();if(!m.visibilityChanged)return d()}n.model.marker.getFrame(m.t,function(f){if("reveal"!=i.status)return d();if(!f)return d();if(m.valueY=f.axis_y[o.getKey(i,s.axis_y)],m.valueX=f.axis_x[o.getKey(i,s.axis_x)],m.valueS=f.size[o.getKey(i,s.size)],m.valueC=f.color[o.getKey(i,s.color)],null==m.valueY||null==m.valueX||null==m.valueS)return d();if(l&&l.toString()==m.t.toString()){var g=n._labels.cached[i[a]];g.labelX0=m.valueX,g.labelY0=m.valueY;var v=m.valueS;g.scaledS0=v||0===v?o.areaToRadius(n.sScale(v)):null,g.scaledC0=null!=m.valueC?n.cScale(m.valueC):n.COLOR_WHITEISH,n._updateLabel(i,c,f,m.valueX,m.valueY,m.valueS,m.valueC,f.label[o.getKey(i,s.label)],f.size_label[o.getKey(i,s.size_label)],0,!0)}if(p.select("circle").attr("cy",n.yScale(m.valueY)).attr("cx",n.xScale(m.valueX)).attr("r",o.areaToRadius(n.sScale(m.valueS))).style("fill",null!=m.valueC?n.cScale(m.valueC):n.COLOR_WHITEISH),p.select("line").attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).attr("x1",n.xScale(m.valueX)).attr("y1",n.yScale(m.valueY)),n.time-m.t>0?(m.visibilityChanged=!1,p.classed("vzb-invisible",m.transparent)):p.classed("vzb-invisible",!0),!t._groups[0][u]||n.time.toString()==m.t.toString())return d();var b=d3.select(t._groups[0][u]),y=b.datum();y.previous=m,m.next=y;var _=y.t;n.time-y.t<0&&(m.visibilityChanged=!0,_=n.time),n.model.marker.getFrame(_,function(t){if("reveal"!=i.status)return d();if(!t||null==m.valueY||null==m.valueX||null==m.valueS)return d();if(null==t.axis_x[o.getKey(i,s.axis_x)]||null==t.axis_y[o.getKey(i,s.axis_y)])return d();y.valueY=t.axis_y[o.getKey(i,s.axis_y)],y.valueX=t.axis_x[o.getKey(i,s.axis_x)],y.valueS=t.size[o.getKey(i,s.size)],y.valueC=t.color[o.getKey(i,s.color)],r.trailTransitions[i[a]]=p;var l="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:m.valueC,shadeID:"shade"}):null!=m.valueC?n.cScale(m.valueC):n.COLOR_BLACKISH,f=Math.sqrt(Math.pow(n.xScale(m.valueX)-n.xScale(y.valueX),2)+Math.pow(n.yScale(m.valueY)-n.yScale(y.valueY),2));return p.select("line").attr("stroke-dasharray",f).attr("stroke-dashoffset",o.areaToRadius(n.sScale(m.valueS))).style("stroke",l).transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(y.valueX)).attr("y1",n.yScale(y.valueY)).attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)),u-c>1?(h(c,u),d()):d()})})})},u=function(r,a,l){return new Promise(function(c,u){var d=d3.select(t._groups[0][r]),f=d3.select(t._groups[0][a]),p=d3.select(t._groups[0][l]),m=d.datum(),g=f.datum(),v=p.datum();if(!m.previous&&!m.next||!g.previous&&!g.next)return c();n.model.marker.getFrame(v.t,function(t){if("reveal"!=i.status)return c();if(!t||void 0===t.axis_x||null==t.axis_x[o.getKey(i,s.axis_x)]||void 0===t.axis_y||null==t.axis_y[o.getKey(i,s.axis_y)])return o.warn("Frame for trail missed: "+v.t),c();if(v.valueY=t.axis_y[o.getKey(i,s.axis_y)],v.valueX=t.axis_x[o.getKey(i,s.axis_x)],v.valueS=t.size[o.getKey(i,s.size)],v.valueC=t.color[o.getKey(i,s.color)],v.previous=m,v.next=g,m.next=v,g.previous=v,null==v.valueY||null==v.valueX||null==v.valueS)return o.warn("Data for trail point missed: "+v.t),c();var u="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:v.valueC,shadeID:"shade"}):null!=v.valueC?n.cScale(v.valueC):n.COLOR_BLACKISH,f=Math.sqrt(Math.pow(n.xScale(m.valueX)-n.xScale(v.valueX),2)+Math.pow(n.yScale(m.valueY)-n.yScale(v.valueX),2));if(d.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(v.valueX)).attr("y1",n.yScale(v.valueY)).attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).attr("stroke-dasharray",f).attr("stroke-dashoffset",o.areaToRadius(n.sScale(m.valueS))).style("stroke",u),p.classed("vzb-invisible",v.transparent),!v.transparent){p.select("circle").attr("cy",n.yScale(v.valueY)).attr("cx",n.xScale(v.valueX)).attr("r",o.areaToRadius(n.sScale(v.valueS))).style("fill",null!=v.valueC?n.cScale(v.valueC):n.COLOR_WHITEISH);var b=Math.sqrt(Math.pow(n.xScale(v.valueX)-n.xScale(g.valueX),2)+Math.pow(n.yScale(v.valueY)-n.yScale(g.valueY),2));p.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(g.valueX)).attr("y1",n.yScale(g.valueY)).attr("x2",n.xScale(v.valueX)).attr("y2",n.yScale(v.valueY)).attr("stroke-dasharray",b).attr("stroke-dashoffset",o.areaToRadius(n.sScale(v.valueS))).style("stroke",u)}h(r,l,a),c()})})},h=function(t,e,n){var o=void 0;e-t>1&&(o=d(t,e),r.delayedIterations[i[a]][t]={first:t,next:e,medium:o}),n&&n-e>1&&(o=d(e,n),r.delayedIterations[i[a]][e]={first:e,next:n,medium:o})},d=function(t,e){return Math.round(t+(e-t)/2)},f=function(t,e,i){var r=[],a=0,s=0,l=d3.min([t.limits.max,n.time]),c=d3.max([t.limits.min,n.model.time.parse(""+t.selectedEntityData.trailStartTime)]);return o.forEach(e._groups[0],function(t,e){var o=t.__data__;o.t-c==0?a=e:o.t-l==0?s=e:o.t>c&&o.t<l&&(n.model.time.formatDate(o.t)%i==0||o.next&&o.previous)&&r.push(e)}),r.unshift(a),s>0&&r.push(s),r},p=function(){return new Promise(function(t,e){Object.keys(r.drawingQueue[i[a]]).length>0?function e(){var n=Object.keys(r.drawingQueue[i[a]])[Math.floor(Math.random()*Object.keys(r.drawingQueue[i[a]]).length)],o=JSON.parse(JSON.stringify(r.drawingQueue[i[a]][n]));delete r.drawingQueue[i[a]][n],u(o.first,o.next,o.medium).then(function(){Object.keys(r.drawingQueue[i[a]]).length>0?e():t()})}(r.drawingQueue[i[a]]):t()})};return new Promise(function(e,o){var s=function t(){p().then(function(){if(0==Object.keys(r.delayedIterations[i[a]]).length)return e();r.drawingQueue[i[a]]=r.delayedIterations[i[a]],r.delayedIterations[i[a]]={},t()},function(){return e()})};if(n.model.marker.framesAreReady())!function t(i,n){if(n<0||n>=i._groups[0].length)return e();c(i,n,n+1).then(function(){t(i,n+1)},function(){return e()})}(t,0);else{r.delayedIterations[i[a]]={},r.drawingQueue[i[a]]={};var l=f(i,t,50),u=[];if(l.length<=1)return e();r.delayedIterations[i[a]]={};for(var h=0;h<l.length-1;h++)u.push(c(t,l[h],l[h+1]));Promise.all(u).then(function(){0==Object.keys(r.delayedIterations[i[a]]).length?e():(r.drawingQueue[i[a]]=r.delayedIterations[i[a]],r.delayedIterations[i[a]]={},s())},function(){e()})}})}});e.default=s},function(t,e,i){(function(e){!function(e,i){t.exports=i(e)}(void 0!==e?e:this,function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,i=String(t),n=i.length,r=-1,a="",o=i.charCodeAt(0);++r<n;)e=i.charCodeAt(r),a+=0!=e?e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==o?"\\"+e.toString(16)+" ":(0!=r||1!=n||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?i.charAt(r):"\\"+i.charAt(r):"ï¿½";return a};return t.CSS||(t.CSS={}),t.CSS.escape=e,e})}).call(e,i(7))},function(t,e){},function(t,e){t.exports='\x3c!-- Bubble Chart Component --\x3e\n<div class="vzb-bubblechart">\n    <svg class="vzb-bubblechart-svg vzb-export">\n        <g class="vzb-bc-graph">\n            <g class="vzb-bc-year"></g>\n\n            <svg class="vzb-bc-axis-x"><g></g></svg>\n            <svg class="vzb-bc-axis-y"><g></g></svg>\n            <line class="vzb-bc-projection-x"></line>\n            <line class="vzb-bc-projection-y"></line>\n\n            <svg class="vzb-bc-bubbles-crop">\n                <g class="vzb-zoom-selection"></g>\n                <line class="vzb-bc-line-equal-xy vzb-invisible"></line>\n                <rect class="vzb-bc-eventarea"></rect>\n                <g class="vzb-bc-trails"></g>\n                <g class="vzb-bc-bubbles"></g>\n                <g class="vzb-bc-lines"></g>\n                <g class="vzb-bc-bubble-crown vzb-hidden">\n                    <circle class="vzb-crown-glow"></circle>\n                    <circle class="vzb-crown"></circle>\n                </g>\n            </svg>\n\n            <g class="vzb-bc-axis-y-subtitle"></g>\n            <g class="vzb-bc-axis-x-subtitle"></g>\n            <g class="vzb-bc-axis-y-title"></g>\n            <g class="vzb-bc-axis-x-title"></g>\n            <g class="vzb-bc-axis-s-title"></g>\n            <g class="vzb-bc-axis-c-title"></g>\n\n            <g class="vzb-bc-axis-y-info vzb-noexport"></g>\n            <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n\n            <svg class="vzb-bc-labels-crop">\n                <g class="vzb-bc-labels"></g>\n            </svg>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <rect class="vzb-bc-zoom-rect"></rect>\n        </g>\n    </svg>\n    <svg>\n        <defs>\n            <filter id="vzb-glow-filter" x="-50%" y="-50%" width="200%" height="200%">\n                <feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur>\n            </filter>\n        </defs>\n    </svg>\n    \x3c!-- This could possibly be another component --\x3e\n    <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div>\n</div>\n'},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){t.exports=i(0)}])},function(t,e){!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=9)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(6);var n=i(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n);i(2);var a={version:"2.0.3-3",build:1518111243853},o=Vizabi.Tool.extend("MountainChart",{init:function(t,e){this.name="mountainchart",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","data","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:.7}},locale:{},ui:{chart:{manualSortingEnabled:!0,yMaxMethod:"latest",showProbeX:!0,probeX:1.85,xLogStops:[1,2,5],xPoints:50,directSigma:!1,directMu:!1,preload:"income_mountains",preloadKey:"world"},buttons:["colors","find","stack","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","stack","moreoptions"],sidebar:["colors","find","stack"],moreoptions:["opacity","speed","stack","axesmc","colors","presentation","about"]},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}},versionInfo:a});e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),o=n(a),s=i(5),l=n(s),c=i(4),u=n(c),h=Vizabi,d=h.utils,f=(h._globals,h.iconset),p=f.warn,m=f.question,g=h.helpers,v=g.svgexport,b=g["d3.axisWithLabelPicker"],y=g["d3.dynamicBackground"],_=Vizabi.Component.extend("mountainchart",{init:function(t,e){var n=this;this.name="mountainchart",this.template=i(8),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"data",type:"data"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(t){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,n.frameChanged.bind(n))},"change:time.playing":function(t){n.model.time.playing||n.redrawDataPoints()},"change:marker.axis_x.xScaleFactor":function(){n.ready()},"change:marker.axis_x.xScaleShift":function(){n.ready()},"change:marker.axis_x.tailFatX":function(){n.ready()},"change:marker.axis_x.tailCutX":function(){n.ready()},"change:marker.axis_x.tailFade":function(){n.ready()},"change:ui.chart.probeX":function(){n.ready()},"change:ui.chart.showProbeX":function(){n.ready()},"change:ui.chart.xPoints":function(){n.ready()},"change:ui.chart.xLogStops":function(){n.updateSize()},"change:ui.chart.yMaxMethod":function(){n._adjustMaxY({force:!0}),n.redrawDataPoints()},"change:time.record":function(t){n.model.time.record?n._export.open(this.element,this.name):n._export.reset()},"change:marker.highlight":function(t){n._readyOnce&&(n.highlightMarkers(),n.updateOpacity())},"change:marker.select":function(t){n._readyOnce&&(n.selectMarkers(),n._selectlist.redraw(),n.updateOpacity(),n.updateDoubtOpacity(),n.redrawDataPoints(),n._probe.redraw())},"change:marker.opacitySelectDim":function(t){n.updateOpacity()},"change:marker.opacityRegular":function(t){n.updateOpacity()},"change:marker":function(t,e){n._readyOnce&&(e.indexOf("scaleType")>-1?n.ready():(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1)&&(n.zoomToMaxMin(),n.redrawDataPoints(),n._probe.redraw()))},"change:marker.group":function(t,e){n._readyOnce&&(e.indexOf("group.merge")>-1||n.ready())},"change:marker.group.merge":function(t){n._readyOnce&&(n.updatePointers(),n.redrawDataPoints())},"change:marker.stack":function(t){n._readyOnce&&n.ready()},"change:marker.stack.which":function(t){n._readyOnce&&n.model.time.playing&&n.model.time.pause()},"change:marker.stack.use":function(t){n._readyOnce&&n.model.time.playing&&n.model.time.pause()},"change:marker.color.palette":function(t){n._readyOnce&&(n.redrawDataPointsOnlyColors(),n._selectlist.redraw())}},this._super(t,e),this._math=new o.default(this),this._export=new v(this),this._export.prefix("vzb-mc-").deleteClasses(["vzb-mc-mountains-mergestacked","vzb-mc-mountains-mergegrouped","vzb-mc-mountains","vzb-mc-year","vzb-mc-mountains-labels","vzb-mc-axis-labels"]),this._probe=new u.default(this),this._selectlist=new l.default(this),this.area=d3.area().curve(d3.curveBasis).x(function(t){return n.xScale(n._math.rescale(t.x))}).y0(function(t){return n.yScale(t.y0)}).y1(function(t){return n.yScale(t.y0+t.y)}),this.stack=d3.stack().order(d3.stackOrderReverse).value(function(t,e){return n.cached[e][t].y}),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=b("bottom"),this.rangeRatio=1,this.rangeShift=0,this.cached={},this.mesh=[],this.yMax=0},domReady:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-mc-graph"),this.xAxisEl=this.graph.select(".vzb-mc-axis-x"),this.xTitleEl=this.graph.select(".vzb-mc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-mc-axis-y-title"),this.infoEl=this.graph.select(".vzb-mc-axis-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yearEl=this.graph.select(".vzb-mc-year"),this.year=new y(this.yearEl),this.mountainMergeStackedContainer=this.graph.select(".vzb-mc-mountains-mergestacked"),this.mountainMergeGroupedContainer=this.graph.select(".vzb-mc-mountains-mergegrouped"),this.mountainAtomicContainer=this.graph.select(".vzb-mc-mountains"),this.mountainLabelContainer=this.graph.select(".vzb-mc-mountains-labels"),this.tooltip=this.element.select(".vzb-mc-tooltip"),this.eventAreaEl=this.element.select(".vzb-mc-eventarea"),this.probeEl=this.element.select(".vzb-mc-probe"),this.probeLineEl=this.probeEl.select("line"),this.probeTextEl=this.probeEl.selectAll("text"),this.element.onTap(function(e,i){t._interact()._mouseout(e,i)})},afterPreload:function(){var t=this;if(this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.precomputedShape&&this.precomputedShape[0]&&this.precomputedShape[0].income_mountains){var e=this.precomputedShape[0].income_mountains["yMax_"+this.model.ui.chart.yMaxMethod],i=this.precomputedShape[0].income_mountains.shape;e&&i&&0!==i.length&&(this.xScale=d3.scaleLog().domain([this.model.marker.axis_x.domainMin,this.model.marker.axis_x.domainMax]),this.yScale=d3.scaleLinear().domain([0,Math.round(e)]),t.updateSize(i.length),t.zoomToMaxMin(),i=i.map(function(e,i){return{x:t.mesh[i],y0:0,y:+e}}),this.mountainAtomicContainer.selectAll(".vzb-mc-prerender").data([0]).enter().append("path").attr("class","vzb-mc-prerender").style("fill","pink").style("opacity",0).attr("d",t.area(i)).transition().duration(1e3).ease(d3.easeLinear).style("opacity",1))}},readyOnce:function(){this.eventAreaEl.on("mousemove",function(){t.model.time.dragging||t.model.ui.chart.showProbeX&&t._probe.redraw({level:t.xScale.invert(d3.mouse(this)[0]),full:!0})}).on("mouseout",function(){t.model.time.dragging||t.model.ui.chart.showProbeX&&t._probe.redraw()});var t=this;this.on("resize",function(){t.updateSize()||(t.updatePointers(),t.redrawDataPoints(),t._selectlist.redraw(),t._probe.redraw())}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=d.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.mountainAtomicContainer.select(".vzb-mc-prerender").remove(),this.year.setText(this.model.time.formatDate(this.model.time.value)),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange)},ready:function(){var t=this;this.KEYS=d.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.updateUIStrings(),this.updateIndicators(),this.model.marker.getFrame(this.model.time.value,function(e){e&&(t.values=e,t.valuesAggregated={color:{},axis_y:{}},t.model.marker.getFrame(t.model.time.end,function(e){t.updateEntities(e),t.updateSize(),t.zoomToMaxMin(),t._spawnMasks(),t.updateTime(),t.updatePointers(),t._adjustMaxY({force:!0}),t.redrawDataPoints(),t.redrawDataPointsOnlyColors(),t.highlightMarkers(),t.selectMarkers(),t._selectlist.redraw(),t.updateOpacity(),t.updateDoubtOpacity(),t._probe.redraw()}))})},frameChanged:function(t,e){if(!t)return d.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");e.toString()==this.model.time.value.toString()&&(this.values=t,this.updateTime(),this.updatePointers(),this.redrawDataPoints(),this._selectlist.redraw(),this._probe.redraw(),this.updateDoubtOpacity())},updateSize:function(t){var e={small:{margin:{top:10,right:10,left:10,bottom:18},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},i={medium:{margin:{top:20,right:20,left:20,bottom:50},infoElHeight:26},large:{margin:{top:30,right:30,left:30,bottom:50},infoElHeight:32}};this.activeProfile=this.getActiveProfile(e,i);var n=this.activeProfile.margin,r=this.activeProfile.infoElHeight;this.height=parseInt(this.element.style("height"),10)-n.top-n.bottom||0,this.width=parseInt(this.element.style("width"),10)-n.left-n.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,d.warn("Mountain chart updateSize(): vizabi container is too little or has display:none")),this.graph.attr("transform","translate("+n.left+","+n.top+")");var a=this.model.locale.isRTL(),o={topOffset:"large"===this.getLayoutProfile()?2*n.top:0,xAlign:"large"===this.getLayoutProfile()?a?"left":"right":"center",yAlign:"large"===this.getLayoutProfile()?"top":"center",widthRatio:"large"===this.getLayoutProfile()?3/8:.8};this.year.setConditions(o).resize(this.width,this.height),this.yScale.range([this.height,0]),this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]);var s=this._readyOnce?this.model.marker.axis_x.scaleType:"log";this.xAxis.scale(this.xScale).tickSizeOuter(0).tickPadding(9).tickSizeMinor(3,0).labelerOptions({scaleType:s,toolMargin:n,pivotingLimit:1.5*n.bottom,method:this.xAxis.METHOD_REPEATING,stops:this._readyOnce?this.model.ui.chart.xLogStops:[1],formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xTitleEl.select("text").attr("transform","translate("+this.width+","+this.height+")").attr("dy","-0.36em"),this.yTitleEl.style("font-size",r+"px").attr("transform","translate("+(a?this.width:0)+","+n.top+")");var l=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",l.height).attr("height",l.height).attr("x",.1*l.height).attr("y",1*-l.height+1),this.dataWarningEl.attr("transform","translate("+(a?this.width-l.width-2*l.height:0)+","+(n.top+1.5*l.height)+")").select("text").attr("dx",1.5*l.height),this.infoEl.select("svg").node()){var c=this.yTitleEl.node().getBBox(),u=d.transform(this.yTitleEl.node()),h=a?c.x+u.translateX-1.4*r:c.x+u.translateX+c.width+.4*r;this.infoEl.select("svg").attr("width",r+"px").attr("height",r+"px"),this.infoEl.attr("transform","translate("+h+","+(u.translateY-.8*r)+")")}this.eventAreaEl.attr("y",this.height).attr("width",this.width).attr("height",n.bottom),t||(t=this.model.ui.chart.xPoints),this.mesh=this._math.generateMesh(t,s,this.xScale.domain())},zoomToMaxMin:function(){var t=this.model.marker.axis_x;if(!(null==t.zoomedMin&&null==t.domainMin||null==t.zoomedMax&&null==t.domainMin)){var e=this.xScale(t.zoomedMin||t.domainMin),i=this.xScale(t.zoomedMax||t.domainMax);isFinite(e)&&isFinite(i)&&e!==i&&(this.rangeRatio=this.width/(i-e)*this.rangeRatio,this.rangeShift=(this.rangeShift-e)/(i-e)*this.width,this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]),this.xAxisEl.call(this.xAxis))}},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();this.model.marker.axis_x.getConceptprops();this.xTitleEl.select("text").text(this.translator("unit/mountainchart_hardcoded_income_per_day")),this.yTitleEl.select("text").text(this.translator("mount/title")),d.setIcon(this.dataWarningEl,p).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),d.setIcon(this.infoEl,m).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=this.getBBox(),i=d.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+r.left-n.left,i.y)}),this.infoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},updateEntities:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.values,e=this,i=this.dataKeys;this.mountainPointers=this.model.marker.getKeys().filter(function(e){return t.axis_x[d.getKey(e,i.axis_x)]&&t.axis_y[d.getKey(e,i.axis_y)]&&t.axis_s[d.getKey(e,i.axis_s)]}).map(function(n){var r={};return r._keys=n,r.KEYS=function(){return this._keys},r._key=d.getKey(n,e.KEYS),r.KEY=function(){return this._key},r.sortValue=[t.axis_y[d.getKey(n,i.axis_y)]||0,0],r.aggrLevel=0,r}),this.groupedPointers=d3.nest().key(function(n){return"property"===e.model.marker.stack.use?t.stack[d.getKey(n.KEYS(),i.stack)]:t.group[d.getKey(n.KEYS(),i.group)]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers);var n=this.model.marker.group.manualSorting,a=d.isArray(n)&&n.length>1;this.groupedPointers.forEach(function(t){var i=a?n.includes(t.key)?n.length-1-n.indexOf(t.key):-1:d3.sum(t.values.map(function(t){return t.sortValue[0]}));t.values.forEach(function(t){t.sortValue[1]=i}),t._keys=r({},e.KEY,t.key),t.KEYS=function(){return this._keys},t.KEY=function(){return this.key},t.aggrLevel=1});var o={};e.groupedPointers.forEach(function(t){o[t.key]=t.values[0].sortValue[1]}),"none"===e.model.marker.stack.which?(this.stackedPointers=[],this.mountainPointers.sort(function(t,e){return e.sortValue[0]-t.sortValue[0]})):(this.stackedPointers=d3.nest().key(function(e){return t.stack[d.getKey(e.KEYS(),i.stack)]}).key(function(e){return t.group[d.getKey(e.KEYS(),i.group)]}).sortKeys(function(t,e){return o[e]-o[t]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers),this.mountainPointers.sort(function(t,e){return e.sortValue[1]-t.sortValue[1]}),this.stackedPointers.forEach(function(t){t._keys=r({},e.KEY,t.key),t.KEYS=function(){return this._keys},t.KEY=function(){return this.key},t.aggrLevel=2})),this.mountainsMergeStacked=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel2").data(this.stackedPointers),this.mountainsMergeGrouped=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel1").data(this.groupedPointers),this.mountainsAtomic=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel0").data(this.mountainPointers),this.mountainsMergeStacked.exit().remove(),this.mountainsMergeGrouped.exit().remove(),this.mountainsAtomic.exit().remove(),this.mountainsMergeStacked=this.mountainsMergeStacked.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel2").merge(this.mountainsMergeStacked),this.mountainsMergeGrouped=this.mountainsMergeGrouped.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel1").merge(this.mountainsMergeGrouped),this.mountainsAtomic=this.mountainsAtomic.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel0").merge(this.mountainsAtomic),this.mountains=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain"),this.mountains.on("mousemove",function(t,i){d.isTouchDevice()||e._interact()._mousemove(t,i)}).on("mouseout",function(t,i){d.isTouchDevice()||e._interact()._mouseout(t,i)}).on("click",function(t,i){d.isTouchDevice()||(e._interact()._click(t,i),e.highlightMarkers())}).onTap(function(t,i){e._interact()._click(t,i),d3.event.stopPropagation()}).onLongTap(function(t,e){})},_getLabelText:function(t,e,i){return this.KEYS.map(function(n){return t[e[n]]?t[e[n]][i[n]]:i[n]}).join(", ")},_interact:function(){var t=this;return{_mousemove:function(e,i){if(!t.model.time.dragging&&!t.model.time.playing){t.model.marker.highlightMarker(e.KEYS());d3.mouse(t.graph.node()).map(function(t){return parseInt(t)});t._setTooltip(e.key?t.model.marker.color.getColorlegendMarker().label.getItems()[e.key]:t._getLabelText(t.values,t.labelNames,e.KEYS())),t._selectlist.showCloseCross(e,!0)}},_mouseout:function(e,i){t.model.time.dragging||t.model.time.playing||(t._setTooltip(""),t.model.marker.clearHighlighted(),t._selectlist.showCloseCross(e,!1))},_click:function(e){(t.model.time.dragging||t.model.time.playing)&&!t.model.marker.isSelected(e.KEYS())||t.model.marker.selectMarker(e.KEYS())}}},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,this.selectList&&this.someSelected&&this.selectList.classed("vzb-highlight",function(e){return t.model.marker.isHighlighted(e)})},selectMarkers:function(){this.someSelected=this.model.marker.select.length>0,this._selectlist.rebuild(),this.nonSelectedOpacityZero=!1},_sumLeafPointersByMarker:function(t,e){var i=this;return t.key?d3.sum(t.values.map(function(t){return i._sumLeafPointersByMarker(t,e)})):i.values[e][d.getKey(t.KEYS(),i.dataKeys[e])]},updateOpacity:function(){var t=this,e=this.model.marker.opacityRegular,i=this.model.marker.opacitySelectDim;this.mountains.style("opacity",function(n){return t.someHighlighted&&t.model.marker.isHighlighted(n.KEYS())?1:t.someSelected?t.model.marker.isSelected(n.KEYS())?1:i:t.someHighlighted?.3:e}),this.mountains.classed("vzb-selected",function(e){return t.model.marker.isSelected(e.KEYS())});var n=t.model.marker.opacitySelectDim<.01;n!==this.nonSelectedOpacityZero&&this.mountainsAtomic.style("pointer-events",function(e){return t.someSelected&&n&&!t.model.marker.isSelected(e.KEYS())?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration)},updatePointers:function(){var t=this;this.yMax=0,this.mountainPointers.forEach(function(e,i){var n=t._spawn(t.values,t.dataKeys,e);t.cached[e.KEY()]=n,e.hidden=0===n.length}),"none"!==t.model.marker.stack.which&&this.stackedPointers.forEach(function(e){var i=[];e.values.forEach(function(t){i=i.concat(t.values.filter(function(t){return!t.hidden}))}),t.stack.keys(i.map(function(t){return t.KEY()}))(d3.range(t.mesh.length)).forEach(function(e,n){var r=i[n].KEY();e.forEach(function(e,i){t.cached[r][i].y0=e[0]})})}),this.mountainPointers.forEach(function(e){e.valuesPointer=t.values,e.yMax=d3.max(t.cached[e.KEY()].map(function(t){return t.y0+t.y})),t.yMax<e.yMax&&(t.yMax=e.yMax)});var e=t.model.marker.group.merge,i=t.model.marker.stack.merge;this.stackedPointers.forEach(function(e){e.valuesPointer=t.valuesAggregated;var i=t._getFirstLastPointersInStack(e);t.cached[e.key]=t._getVerticesOfaMergedShape(i),t.valuesAggregated.color[e.key]="_default",t.valuesAggregated.axis_y[e.key]=t._sumLeafPointersByMarker(e,"axis_y"),e.yMax=i.first.yMax}),this.groupedPointers.forEach(function(e){e.valuesPointer=t.valuesAggregated;var i=t._getFirstLastPointersInStack(e);t.cached[e.key]=t._getVerticesOfaMergedShape(i),t.valuesAggregated.color[e.key]=t.values.color[i.first.KEY()],t.valuesAggregated.axis_y[e.key]=t._sumLeafPointersByMarker(e,"axis_y"),e.yMax=i.first.yMax}),i||e||"property"!==this.model.marker.stack.use||this.groupedPointers.forEach(function(t){var e=t.values.filter(function(t){return!t.hidden});t.yMax=e[0].yMax,t.values.forEach(function(e){e.yMaxGroup=t.yMax})})},_getFirstLastPointersInStack:function(t){var e=void 0,i=void 0,n=void 0,r=void 0;return t.values[0].values?(e=t.values[0].values.filter(function(t){return!t.hidden}),i=t.values[t.values.length-1].values.filter(function(t){return!t.hidden}),n=e[0],r=i[i.length-1]):(e=t.values.filter(function(t){return!t.hidden}),n=e[0],r=e[e.length-1]),(!e.length||i&&!i.length)&&d.warn("mountain chart failed to generate shapes. check the incoming data"),{first:n,last:r}},_getVerticesOfaMergedShape:function(t){var e=this,i=t.first.KEY(),n=t.last.KEY();return e.mesh.map(function(t,r){var a=e.cached[i][r].y0+e.cached[i][r].y-e.cached[n][r].y0;return{x:t,y0:e.cached[n][r].y0,y:a}})},_spawnMasks:function(){var t=this,e=this._math.unscale(this.model.marker.axis_x.tailFatX),i=this._math.unscale(this.model.marker.axis_x.tailCutX),n=this.model.marker.axis_x.tailFade,r=2*Math.PI/(Math.log(e)-Math.log(i)),a=Math.PI-Math.log(e)*r;this.spawnMask=[],this.cosineShape=[],this.cosineArea=0,this.mesh.forEach(function(o,s){t.spawnMask[s]=o<i?1:o>7*n?0:Math.exp((i-o)/n),t.cosineShape[s]=o>i&&o<e?1+Math.cos(Math.log(o)*r+a):0,t.cosineArea+=t.cosineShape[s]})},_spawn:function(t,e,i){var n=this,r=t.axis_y[d.getKey(i.KEYS(),e.axis_y)],a=n.model.ui.chart.directSigma?t.axis_s[d.getKey(i.KEYS(),e.axis_s)]:n._math.giniToSigma(t.axis_s[d.getKey(i.KEYS(),e.axis_s)]),o=n.model.ui.chart.directMu?t.axis_x[d.getKey(i.KEYS(),e.axis_x)]:n._math.gdpToMu(t.axis_x[d.getKey(i.KEYS(),e.axis_x)],a);if(!r||!o||!a)return[];var s=[],l=0;return this.mesh.forEach(function(t,e){s[e]=n._math.pdf.lognormal(t,o,a),l+=n.spawnMask[e]*s[e]}),this.mesh.map(function(t,e){return{x:t,y0:0,y:r*(s[e]*(1-n.spawnMask[e])+n.cosineShape[e]/n.cosineArea*l)}})},_adjustMaxY:function(t){t||(t={});var e=this,i=this.model.ui.chart.yMaxMethod;if("immediate"===i||t.force)if("latest"===i){var n=e.values;e.model.marker.getFrame(e.model.time.end,function(t){t&&(e.values=t,e.updatePointers(),e.values=n,e.yScale.domain([0,Math.round(e.yMax)]),e.updatePointers(),e.redrawDataPoints())})}else e.yMax||d.warn("Setting yMax to "+e.yMax+". You failed again :-/"),e.yScale.domain([0,Math.round(e.yMax)])},redrawDataPoints:function(){var t=this,e=this.model.marker.group.merge,i=this.model.marker.stack.merge,n=this.model.marker.stack.which,r=(this.model.time.dragging||this.model.time.playing)&&"none"!==n;this._adjustMaxY(),this.mountainsMergeStacked.each(function(e){var n=d3.select(this),r=!i;t._renderShape(n,e.KEY(),r)}),this.mountainsMergeGrouped.each(function(n){var a=d3.select(this),o=!e&&!r||i&&!t.model.marker.isSelected(n);t._renderShape(a,n.KEY(),o)}),this.mountainsAtomic.each(function(n,a){var o=d3.select(this),s=n.hidden||(e||i||r)&&!t.model.marker.isSelected(n);t._renderShape(o,n.KEY(),s)}),"none"===n?this.mountainsAtomic.sort(function(t,e){return e.yMax-t.yMax}):"all"===n||e||r||this.mountainsAtomic.sort(function(t,e){return e.yMaxGroup-t.yMaxGroup})},redrawDataPointsOnlyColors:function(){var t=this;if(!this.mountains)return d.warn("redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!");var e="indicator"===this.model.marker.color.use;this.mountains.style("fill",function(i){var n=i.valuesPointer.color[d.getKey(i.KEYS(),t.dataKeys.color)];return n?e&&"_default"==n?t.model.marker.color.palette._default:t.cScale(n):"#d3d3d3"})},_renderShape:function(t,e,i){var n=this.model.marker.stack.which,r=this,a=t.datum().valuesPointer;if(t.classed("vzb-hidden",i),i)return void("none"!==n&&t.style("stroke-opacity",0));var o={};o[this.KEY]=e,this.model.marker.isSelected(o)?t.attr("d",this.area(this.cached[e].filter(function(t){return t.y>.001*a.axis_y[e]}))):t.attr("d",this.area(this.cached[e])),"indicator"===this.model.marker.color.use&&t.style("fill",a.color[e]?"_default"!==a.color[e]?r.cScale(a.color[e]):r.model.marker.color.palette._default:"#d3d3d3"),"none"!==n&&t.transition().duration(900*Math.random()+100).ease(d3.easeCircle).style("stroke-opacity",.5),this.model.time.record&&this._export.write({type:"path",id:e,time:this.model.time.value.getUTCFullYear(),fill:this.cScale(a.color[e]),d:this.area(this.cached[e])})},_setTooltip:function(t){if(t){var e=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)});this.tooltip.classed("vzb-hidden",!1).attr("transform","translate("+e[0]+","+e[1]+")").selectAll("text").attr("text-anchor","middle").attr("alignment-baseline","middle").text(t);var i=this.tooltip.select("text").node().getBBox();this.tooltip.select("rect").attr("width",i.width+8).attr("height",i.height+8).attr("x",-i.width-25).attr("y",-i.height-25).attr("rx",.2*i.height).attr("ry",.2*i.height),this.tooltip.selectAll("text").attr("x",-i.width-25+(i.width+8)/2).attr("y",-i.height-25+(i.height+11)/2);var n=e[0]-i.width-25>0?e[0]:i.width+25,r=e[1]-i.height-25>0?e[1]:i.height+25;this.tooltip.attr("transform","translate("+n+","+r+")")}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var t,e=this,i=this,n=d.getProp(this,["model","ui","chart","preload"]),a=d.getProp(this,["model","ui","chart","preloadKey"]);if(!n)return Promise.resolve();var o=this.model.marker._getFirstDimension({exceptType:"time"}),s=this.model.time.dim,l={language:this.model.locale.id,from:"datapoints",select:{key:[o,s],value:[n]},where:{$and:[r({},o,"$"+o),r({},s,"$"+s)]},join:(t={},r(t,"$"+o,{key:o,where:r({},o,{$in:[a||"world"]})}),r(t,"$"+s,{key:s,where:r({},s,this.model.time.formatDate(this.model.time.value))}),t),order_by:[s]};return new Promise(function(t,a){e.model.data.load(l,r({},n,function(t){return JSON.parse(t)})).then(function(e){i.precomputedShape=i.model.data.getData(e),t()},function(t){return d.warn("Problem with Preload mountainchart query: ",t,JSON.stringify(l))})})}});e.default=_},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi.Component.get("_dialog").extend("axesmc",{init:function(t,e){this.name="axesmc";var n=this;this.model_binds={"change:ui.chart.xLogStops":function(){n.updateView()},"change:ui.chart.yMaxMethod":function(){n.updateView()}},this.components=[{component:Vizabi.Component.get("minmaxinputs"),placeholder:".vzb-xlimits-container",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e),this.template=i(7)},readyOnce:function(){this._super();var t=this;this.yMaxRadio=this.element.select(".vzb-yaxis-container").selectAll("input").on("change",function(){t.setModel("yMaxMethod",d3.select(this).node().value)}),this.xLogStops=this.element.select(".vzb-xaxis-container").selectAll("input").on("change",function(){t.setModel("xLogStops",d3.select(this).node().value)}),this.probeCheck=this.element.select(".vzb-probe-check").on("change",function(){t.setModel("showProbeX",d3.select(this).property("checked"))}),this.probeFieldEl=this.element.select(".vzb-probe-field").on("change",function(){var e=parseFloat(this.value.replace(",","."));if(!e||e<=t.model.state.marker.axis_x.tailCutX)return void(this.value=t.model.ui.chart.probeX);e>t.model.state.marker.axis_x.domainMax&&(e=t.model.state.marker.axis_x.domainMax),this.value=e,t.setModel("probeX",e)}),this.updateView()},updateView:function(){var t=this;this.yMaxRadio.property("checked",function(){return d3.select(this).node().value===t.model.ui.chart.yMaxMethod}),this.xLogStops.property("checked",function(){return-1!==t.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value)}),this.probeCheck.property("checked",this.model.ui.chart.showProbeX),this.probeFieldEl.property("value",this.model.ui.chart.probeX)},setModel:function(t,e){var i=void 0;"yMaxMethod"==t&&(i=e),"xLogStops"==t&&(i=[],this.xLogStops.each(function(){d3.select(this).property("checked")&&i.push(+d3.select(this).node().value)})),"probeX"!=t&&"showProbeX"!=t||(i=e),this.model.ui.chart[t]=i}});e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi,r=(n.utils,Vizabi.Class.extend({init:function(t){this.context=t,this.xScaleFactor=1,this.xScaleShift=0},rescale:function(t){return Math.exp(this.xScaleFactor*Math.log(t)+this.xScaleShift)},unscale:function(t){return Math.exp((Math.log(t)-this.xScaleShift)/this.xScaleFactor)},generateMesh:function(t,e,i){var n="linear"===e?i[0]:Math.log(this.unscale(i[0])),r="linear"===e?i[1]:Math.log(this.unscale(i[1])),a=(r-n)/t,o=d3.range(n,r,a).concat(r);return o="linear"!==e?o.map(function(t){return Math.exp(t)}):o.filter(function(t){return t>0})},gdpToMu:function(t,e,i,n){return Math.log(t/365)-e*e/2},giniToSigma:function(t){return this.normsinv((t/100+1)/2)*Math.pow(2,.5)},pdf:{normal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(t-e,2)/(2*i*i))},lognormal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(Math.log(t)-e,2)/(2*i*i))}},normsinv:function(t){var e=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],i=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],n=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],r=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416];if(t<.02425){var a=Math.sqrt(-2*Math.log(t));return(((((n[0]*a+n[1])*a+n[2])*a+n[3])*a+n[4])*a+n[5])/((((r[0]*a+r[1])*a+r[2])*a+r[3])*a+1)}if(.97575<t){var o=Math.sqrt(-2*Math.log(1-t));return-(((((n[0]*o+n[1])*o+n[2])*o+n[3])*o+n[4])*o+n[5])/((((r[0]*o+r[1])*o+r[2])*o+r[3])*o+1)}var s=t-.5,l=s*s;return(((((e[0]*l+e[1])*l+e[2])*l+e[3])*l+e[4])*l+e[5])*s/(((((i[0]*l+i[1])*l+i[2])*l+i[3])*l+i[4])*l+1)}}));e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi,r=n.utils,a=Vizabi.Class.extend({init:function(t){this.context=t},redraw:function(t){var e=this.context;if(t||(t={}),t.level||(t.level=e.model.ui.chart.probeX),e.probeEl.classed("vzb-hidden",!t.level||!e.model.ui.chart.showProbeX),t.level){e.xAxisEl.call(e.xAxis.highlightValue(t.full?t.level:"none"));var i=0,n=0,a=0,o=function(o){i+=o.valuesPointer.axis_y[r.getKey(o.KEYS(),e.dataKeys.axis_y)],e.cached[o.KEY()].forEach(function(i){n+=i.y,e._math.rescale(i.x)<t.level&&(a+=i.y)})};"all"===e.model.marker.stack.which?e.stackedPointers.forEach(o):"none"===e.model.marker.stack.which?e.mountainPointers.forEach(o):e.groupedPointers.forEach(o);var s=d3.format(".3r"),l=e.model.marker.axis_y.getTickFormatter();e.heightOfLabels=e.heightOfLabels||.66*e.height,e.probeTextEl.each(function(i,n){if(8===n){var r=d3.select(this);t.full||e.model.ui.chart.probeX!=e.model.marker.axis_x.tailFatX?r.classed("vzb-hidden",!0):(r.text(e.translator("mount/extremepoverty")).classed("vzb-hidden",!1).attr("x",-e.height).attr("y",e.xScale(t.level)).attr("dy","-1.15em").attr("dx","0.5em").attr("transform","rotate(-90)"),e.heightOfLabels=e.height-r.node().getBBox().width-1.75*r.node().getBBox().height)}}),e.probeTextEl.each(function(r,o){if(8!==o){var c=d3.select(this),u=void 0;0!==o&&4!==o||(u=s(a/n*100)+"%"),1!==o&&5!==o||(u=s(100-a/n*100)+"%"),2!==o&&6!==o||(u=l(i*a/n)),3!==o&&7!==o||(u=l(i*(1-a/n))+" "+e.translator("mount/people")),c.text(u).classed("vzb-hidden",!t.full&&(e.someSelected||0!==o&&4!==o)).attr("x",e.xScale(t.level)+([0,4,2,6].indexOf(o)>-1?-6:5)).attr("y",e.heightOfLabels).attr("dy",[0,1,4,5].indexOf(o)>-1?0:"1.5em")}}),e.probeLineEl.attr("x1",e.xScale(t.level)).attr("x2",e.xScale(t.level)).attr("y1",e.height+6).attr("y2",0)}}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi,r=n.utils,a=n.iconset.close,o=Vizabi.Class.extend({init:function(t){this.context=t},rebuild:function(t){var e=this.context,i=this,n=e.mountainPointers.concat(e.groupedPointers).concat(e.stackedPointers).filter(function(t){return e.model.marker.isSelected(t.KEYS())}).sort(function(t,e){return t.sortValue&&e.sortValue?t.sortValue[1]===e.sortValue[1]?d3.descending(t.sortValue[0],e.sortValue[0]):d3.descending(t.sortValue[1],e.sortValue[1]):t.aggrLevel!=e.aggrLevel?d3.descending(t.aggrLevel,e.aggrLevel):t.aggrLevel&&e.aggrLevel?d3.descending(t.yMax,e.yMax):0});e.selectList=e.mountainLabelContainer.selectAll("g.vzb-mc-label").data(r.unique(n,function(t){return t.KEY()})),e.selectList.exit().remove(),e.selectList=e.selectList.enter().append("g").attr("class","vzb-mc-label").each(function(t,i){var n=d3.select(this);n.append("circle").attr("class","vzb-mc-label-legend"),n.append("text").attr("class","vzb-mc-label-shadow vzb-mc-label-text"),n.append("text").attr("class","vzb-mc-label-text"),n.append("g").attr("class","vzb-mc-label-x vzb-label-shadow vzb-invisible").on("click",function(t,i){r.isTouchDevice()||(d3.event.stopPropagation(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t.KEYS()),d3.event.stopPropagation())}).onTap(function(t,i){e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t.KEYS())});var o=n.select("g.vzb-mc-label-x");r.isTouchDevice()?(o.append("rect"),o.append("text").attr("class","vzb-mc-label-x-text").text("Deselect")):(r.setIcon(o,a).select("svg").attr("class","vzb-mc-label-x-icon").attr("width","0px").attr("height","0px"),o.insert("circle","svg"))}).on("mousemove",function(t,n){r.isTouchDevice()||(i.showCloseCross(t,!0),e.model.marker.highlightMarker(t.KEYS()))}).on("mouseout",function(t,n){r.isTouchDevice()||(i.showCloseCross(t,!1),e.model.marker.clearHighlighted())}).on("click",function(t,i){r.isTouchDevice()||(e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t.KEYS()))}).merge(e.selectList)},redraw:function(){var t=this.context,e=t.dataKeys;if(t.selectList&&t.someSelected){var i=t.mountainLabelContainer.append("g").attr("class","vzb-mc-label").append("text").text("0"),n=1.2*i.node().getBBox().height,a=parseFloat(i.style("font-size"))/n;d3.select(i.node().parentNode).remove();var o=t.model.marker.axis_y.getTickFormatter(),s=t.yTitleEl.select("text").node().getBBox().height||0,l=(t.height-3*s)/(t.selectList.data().length+2);n>l&&(n=l);var c="null",u=0,h=t.model.marker.color.getColorlegendMarker().label.getItems(),d=t.model.locale.isRTL();t.selectList.attr("transform",function(e,i){e.aggrLevel!=c&&(u+=n);var r=n*i+2*s+u;return c=e.aggrLevel,"translate("+(d?t.width:0)+","+r+")"}).each(function(i,s){var c=d3.select(this).attr("id",i.KEY()+"-label-"+t._id),u="";u=i.key?"all"===i.key?t.translator("mount/merging/world"):h[i.key]:t._getLabelText(t.values,t.labelNames,i.KEYS());var f=i.valuesPointer.axis_y[r.getKey(i.KEYS(),e.axis_y)],p=u+": "+o(f)+(0===s?" "+t.translator("mount/people"):""),m=c.selectAll(".vzb-mc-label-text").attr("x",(d?-1:1)*n).attr("y",n).text(p).style("font-size",n===l?n*a+"px":null),g=m.node().getBBox(),v=c.select(".vzb-mc-label-x");if(r.isTouchDevice()){var b=v.select("text").node().getBBox();v.classed("vzb-revert-color",!0).select(".vzb-mc-label-x-text").classed("vzb-revert-color",!0).attr("x",g.width+1.12*g.height+.5*b.width).attr("y",.55*g.height),v.select("rect").attr("width",b.width+.6*g.height).attr("height",g.height).attr("x",g.width+.9*g.height).attr("y",0).attr("rx",.25*g.height).attr("ry",.25*g.height)}else v.attr("x",g.width+1.1*g.height).attr("y",g.height/3),v.select("circle").attr("r",.4*g.height).attr("cx",(d?-1:1)*(g.width+1.1*g.height)).attr("cy",g.height/3),v.select("svg").attr("x",(d?-1:1)*(g.width+g.height*(1.1-(d?-.4:.4)))).attr("y",g.height*(1/3-.4)).attr("width",.8*g.height).attr("height",.8*g.height);c.select(".vzb-mc-label-legend").attr("r",n/3).attr("cx",(d?-1:1)*n*.4).attr("cy",n/1.5).style("fill",t.cScale(i.valuesPointer.color[r.getKey(i.KEYS(),e.color)])),c.onTap(function(e,i){d3.event.stopPropagation(),t.model.marker.highlightMarker(e.KEYS()),setTimeout(function(){t.model.marker.unhighlightMarker(e.KEYS())},2e3)})})}},showCloseCross:function(t,e){var i=this.context,n=t.KEY();i.selectList.filter(function(t){return t.KEY()==n}).select(".vzb-mc-label-x").classed("vzb-invisible",!e)}});e.default=o},function(t,e){},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axesmc" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axesmc" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/axes") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-yaxis-container">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/mount/maxYvalue") %></p>\n            <form class="vzb-dialog-paragraph">\n                <label><input type="radio" name="ymax" value="immediate"><%=t ("mount/maxYmode/immediate") %></label>\n                <label><input type="radio" name="ymax" value="latest"><%=t ("mount/maxYmode/latest") %></label>\n            </form>\n        </div>\n        <div class="vzb-xaxis-container">\n            <p class="vzb-dialog-sublabel">\n                <%=t ("hints/mount/logXstops") %>\n            </p>\n            <form class="vzb-dialog-paragraph">\n                <input type="checkbox" name="logstops" value="1">1\n                <input type="checkbox" name="logstops" value="2">2\n                <input type="checkbox" name="logstops" value="5">5\n            </form>\n        </div>\n        <p class="vzb-dialog-sublabel">\n            <%=t ("hints/mount/xlimits") %>\n        </p>\n        <div class="vzb-xlimits-container vzb-dialog-paragraph"></div>\n        <div class="vzb-probe-container">\n            <p class="vzb-dialog-sublabel">\n              <input type="checkbox" name="probe" class="vzb-probe-check"> <%=t ("hints/mount/probe") %>\n            </p>\n            <input type="text" class="vzb-probe-field" name="probe">\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'},function(t,e){t.exports='\x3c!-- MountainChart Component --\x3e\n<div class="vzb-mountainchart">\n    <svg class="vzb-mountainchart-svg vzb-export">\n        <g class="vzb-mc-graph">\n            <rect class="vzb-mc-eventarea"></rect>\n            <g class="vzb-mc-year"></g>\n\n            <g class="vzb-mc-mountains-mergestacked"></g>\n            <g class="vzb-mc-mountains-mergegrouped"></g>\n            <g class="vzb-mc-mountains"></g>\n            <g class="vzb-mc-mountains-labels"></g>\n\n\n            <g class="vzb-mc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x"></g>\n\n            <g class="vzb-mc-axis-labels"></g>\n            <g class="vzb-mc-probe">\n                <text class="vzb-shadow vzb-mc-probe-value-ul"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-ur"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dl"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-value-ul"></text>\n                <text class="vzb-mc-probe-value-ur"></text>\n                <text class="vzb-mc-probe-value-dl"></text>\n                <text class="vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-extremepoverty"></text>\n                <line></line>\n            </g>\n\n            <g class="vzb-mc-tooltip vzb-hidden">\n                <rect class="vzb-tooltip-border"></rect>\n                <text class="vzb-tooltip-text"></text>\n            </g>\n        </g>\n    </svg>\n</div>\n'},function(t,e,i){t.exports=i(0)}])},function(t,e){!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(2);var n=i(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a={version:"2.0.1-3",build:1522441514245},o=Vizabi.Tool.extend("BubbleMap",{init:function(t,e){this.name="bubblemap",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_tags:{autoconfig:{type:"entity_domain",includeOnlyIDs:["tag"]}},marker_tags:{space:["entities_tags"],label:{use:"property",which:"name"},hook_parent:{}},marker:{limit:5e3,space:["entities","time"],hook_lat:{use:"property",autoconfig:{index:0,type:"measure"},_important:!0},hook_lng:{use:"property",autoconfig:{index:1,type:"measure"},_important:!0},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:2,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{map:{path:null,colorGeo:!1,preserveAspectRatio:!0,scale:.95,offset:{top:0,right:0,bottom:0,left:0},projection:"robinson",topology:{path:null,objects:{geo:"land",boundaries:"countries"},geoIdProperty:null}},chart:{superhighlightOnMinimapHover:!0,labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","size","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","moreoptions"],sidebar:["colors","find","size"],moreoptions:["opacity","speed","size","colors","presentation","about"]},presentation:!1}},versionInfo:a});e.default=o},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var r=Vizabi,a=(r._globals,r.utils),o=r.Component,s=r.helpers,l=s.labels,c=s.topojson,u=s["d3.geoProjection"],h=s["d3.dynamicBackground"],d=r.iconset,f=d.warn,p=d.question,m=o.extend("bubblemap",{init:function(t,e){var n=this;this.name="bubblemap",this.template=i(3),this.bubblesDrawing=null,this.isMobile=a.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"},{name:"data",type:"data"}];var r=this;this.model_binds={"change:time.value":function(t){r._readyOnce&&r.model.marker.getFrame(r.model.time.value,r.frameChanged.bind(r))},"change:marker.highlight":function(t){r._readyOnce&&(r.highlightMarkers(),r.updateOpacity())},"change:marker":function(t,e){r._readyOnce&&e.indexOf("scaleType")>-1&&r.ready()},"change:marker.size.extent":function(t,e){r._readyOnce&&r.entityBubbles&&(r.updateMarkerSizeLimits(),r.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){r._readyOnce&&r.redrawDataPoints(null,!1)},"change:marker.select":function(t){r._readyOnce&&(r.selectMarkers(),r.redrawDataPoints(null,!1),r.updateOpacity(),r.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){r.updateOpacity()},"change:marker.opacityRegular":function(t){r.updateOpacity()},"change:marker.superHighlight":function(){return n._readyOnce&&n._blinkSuperHighlighted()}},this._super(t,e),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),r.COLOR_WHITEISH="#fdfdfd",u(),this._labels=new l(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.mapSvg=this.element.select(".vzb-bmc-map-background"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new h(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var t=this;this.on("resize",function(){t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),t.redrawDataPoints())}),this.initMap(),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce()},ready:function(){var t=this;this.KEYS=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){if(i.toString()!=t.model.time.value.toString())return void a.defer(function(){t.ready()});e&&(t.values=e,t.updateEntities(),t.updateTime(),t._labels.ready(),t.redrawDataPoints(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity())})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),i=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:i.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),a.setIcon(this.dataWarningEl,f).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x+r.left-n.left,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t=this,e=void 0;if(t.isMobile&&t.model.marker.select&&1===t.model.marker.select.length&&(e=t.model.marker.select[0]),t.hovered||e){var i=t.model.marker.size.getConceptprops(),n=t.model.marker.color.getConceptprops(),r=t.hovered||e,o=t.model.marker.size.getTickFormatter(),s=t.model.marker.color.getTickFormatter(),l=i.unit||"",c=n.unit||"",u=t.values.size[a.getKey(r,this.dataKeys.size)],h=t.values.color[a.getKey(r,this.dataKeys.color)];t.model.marker.color.isDiscrete()&&h&&(h=this.model.marker.color.getColorlegendMarker().label.getItems()[h]||""),t.yTitleEl.select("text").text(t.translator("buttons/size")+": "+o(u)+" "+l),t.cTitleEl.select("text").text(t.translator("buttons/color")+": "+(h||0===h?s(h)+" "+c:t.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this,e=this.model.marker.opacityRegular,i=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(n){return t.someHighlighted&&t.model.marker.isHighlighted(n)?1:t.someSelected?t.model.marker.isSelected(n)?1:i:t.someHighlighted?.3:e}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var n=t.model.marker.opacitySelectDim<.01;n!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(e){return t.someSelected&&n&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.TIMEDIM,r=function(r){return r=r||"",t.model.marker.getKeys().map(function(s){var l=Object.assign({},s);return l[n]=o,l.sortValue=t.values.size[a.getKey(s,t.dataKeys.size)]||0,l[i]=r+a.getKey(s,e),l}).sort(function(t,e){return e.sortValue-t.sortValue})},o=this.model.time.end;this.model.marker.setVisible(r.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.marker.getVisible(),function(t){return t[i]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){a.isTouchDevice()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){a.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){a.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){}).merge(this.entityBubbles)},unselectBubblesWithNoData:function(t){var e=this;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(i){var n=t.size[a.getKey(i,e.dataKeys.size)];n||0===n||e.model.marker.selectMarker(i)})},redrawDataPoints:function(t,e){var i=this;if(t||(t=this.duration),e||(e=!0),!this.entityBubbles)return a.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!");var n=this.dataKeys,r=this.values;this.entityBubbles.each(function(o,s){var l=d3.select(this),c=d3.select("#"+o[i.KEY]),u=r.hook_lng[a.getKey(o,n.hook_lng)],h=r.hook_lat[a.getKey(o,n.hook_lat)],d=r.size[a.getKey(o,n.size)],f=r.color[a.getKey(o,n.color)],p=r.label[a.getKey(o,n.label)];o.hidden_1=o.hidden,o.hidden=!d&&0!==d||null==u||null==h,o.hidden!==o.hidden_1&&(t?l.transition().duration(t).ease(d3.easeLinear).style("opacity",0).on("end",function(){return l.classed("vzb-hidden",o.hidden).style("opacity",i.model.marker.opacityRegular)}):l.classed("vzb-hidden",o.hidden)),o.hidden?i._updateLabel(o,s,0,0,d,f,p,t):(o.r=a.areaToRadius(i.sScale(d||0)),o.label=p,l.classed("vzb-hidden",!1).attr("fill",null!=f?i.cScale(f):i.COLOR_WHITEISH),i.model.ui.map.colorGeo&&c.style("fill",null!=f?i.cScale(f):"#999"),e&&(o.cLoc=i.skew(i.projection([u||0,h||0])),l.attr("cx",o.cLoc[0]).attr("cy",o.cLoc[1])),t?l.transition().duration(t).ease(d3.easeLinear).attr("r",o.r):l.interrupt().attr("r",o.r).transition(),i._updateLabel(o,s,o.cLoc[0],o.cLoc[1],d,f,o.label,t))})},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text");t.style("font-size",null);var e=this.cTitleEl.select("text");e.style("font-size",null);var i=t.node().getBBox(),n=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),r=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",r+"px"),e.style("font-size",r+"px")):(t.style("font-size",null),e.style("font-size",null))},initMap:function(){var t=this;this.topology||a.warn("bubble map afterPreload: missing country shapes "+this.topology),this.projection=d3["geo"+a.capitalize(this.model.ui.map.projection)](),this.mapPath=d3.geoPath().projection(this.projection),this.mapGraph=this.element.select(".vzb-bmc-map-graph"),this.mapGraph.html(""),this.mapFeature=c.feature(this.topology,this.topology.objects[this.model.ui.map.topology.objects.geo]);var e=c.mesh(this.topology,this.topology.objects[this.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e});this.projection.scale(1).translate([0,0]),this.mapBounds=this.mapPath.bounds(this.mapFeature),this.mapFeature.features?this.mapGraph.selectAll(".land").data(this.mapFeature.features).enter().insert("path").attr("d",this.mapPath).attr("id",function(e){return e.properties[t.model.ui.map.topology.geoIdProperty].toLowerCase()}).attr("class","land"):this.mapGraph.insert("path").datum(this.mapFeature).attr("class","land"),this.mapGraph.insert("path").datum(e).attr("class","boundary")},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadiusPx:.5,maxRadiusEm:.05},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadiusPx:1,maxRadiusEm:.05},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadiusPx:1,maxRadiusEm:.05}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*a.hypotenuse(t.width,t.height));var e=this.activeProfile.margin;this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,a.warn("Bubble map chart updateSize(): vizabi container is too little or has display:none")),this.repositionElements(),this.rescaleMap()},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height),this.yTitleEl.style("font-size",e).attr("transform","translate("+(i?this.width:0)+","+t.top+")");var n=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(t.top+n.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var r=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*r.height)+")").select("text"),this.yInfoEl.select("svg").node()){var o=this.yTitleEl.node().getBBox(),s=a.transform(this.yTitleEl.node()),l=i?o.x+s.translateX-1.4*e:o.x+s.translateX+o.width+.4*e;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+l+","+(s.translateY-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var c=this.cTitleEl.node().getBBox(),u=a.transform(this.cTitleEl.node()),h=i?c.x+u.translateX-1.4*e:c.x+u.translateX+c.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+h+","+(u.translateY-.8*e)+")")}},rescaleMap:function(){var t=this.model.ui.map.offset,e=this.activeProfile.margin,i=this.model.ui.map.scale/Math.max((this.mapBounds[1][0]-this.mapBounds[0][0])/this.width,(this.mapBounds[1][1]-this.mapBounds[0][1])/this.height),n=i*(this.mapBounds[1][0]-this.mapBounds[0][0]),r=i*(this.mapBounds[1][1]-this.mapBounds[0][1]),a=r*(1+t.top+t.bottom),o=n*(1+t.left+t.right),s=r*t.top,l=n*t.left,c=[(n-i*(this.mapBounds[1][0]+this.mapBounds[0][0]))/2,(r-i*(this.mapBounds[1][1]+this.mapBounds[0][1]))/2];this.projection.scale(i).translate(c),this.mapGraph.selectAll("path").attr("d",this.mapPath);var u=void 0,h=void 0;if(this.model.ui.map.preserveAspectRatio)u=1,h=1;else{var d=a,f=o;a=this.height*this.model.ui.map.scale,o=this.width*this.model.ui.map.scale,this.mapSvg.attr("preserveAspectRatio","none").attr("viewBox",[0,0,f,d].join(" ")),u=o/(n||1)/(1+t.left+t.right),h=a/(r||1)/(1+t.top+t.bottom)}this.mapGraph.attr("transform","translate("+l+","+s+")"),this.mapSvg.style("transform","translate3d("+(e.left+(this.width-o)/2)+"px,"+(e.top+(this.height-a)/2)+"px,0)").attr("width",o).attr("height",a);var p=this;this.skew=function(){var t=p.width,e=p.height;return function(i){return[i[0]*u+(t-o)/2+l*u,i[1]*h+(e-a)/2+s*h]}}()},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return a.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,i=this.activeProfile.maxRadiusPx,n=a.radiusToArea(Math.max(i*t[0],e)),r=a.radiusToArea(Math.max(i*t[1],e)),o=n===r?[n,r]:d3.range(n,r,(r-n)/this.sScale.domain().length).concat(r);this.sScale.range(o)},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,i){t.model.marker.selectMarker(e)}}},_blinkSuperHighlighted:function(){var t=this;this.entityBubbles.classed("vzb-super-highlighted",function(e){return t.model.marker.isSuperHighlighted(e)})},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,a.isTouchDevice()&&(this.someHighlighted?t.hovered=this.model.marker.highlight[0]:t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles())},_updateLabel:function(t,e,i,n,r,o,s,l){var c=this;if(t[this.KEY]!=c.druging&&(null==l&&(l=c.duration),c.model.marker.isSelected(t))){var u=t.hidden!==t.hidden_1,h={};h.labelX0=i/this.width,h.labelY0=n/this.height,h.scaledS0=r?a.areaToRadius(c.sScale(r)):null,h.scaledC0=null!=o?c.cScale(o):c.COLOR_WHITEISH;var d=this._getLabelText(this.values,this.labelNames,t);this._labels.updateLabel(t,e,h,i/this.width,n/this.height,r,o,d,null,l,u)}},selectMarkers:function(){var t=this;this.KEY;this.someSelected=this.model.marker.select.length>0,a.isTouchDevice()?(t._labels.showCloseCross(null,!1),t.someHighlighted?t.model.marker.clearHighlighted():(t.updateTitleNumbers(),t.fitSizeOfTitles())):t.hovered&&!t.model.marker.isSelected(t.hovered)||t._setTooltip(),this.nonSelectedOpacityZero=!1},_getLabelText:function(t,e,i){return this.KEYS.map(function(n){return t[e[n]]?t[e[n]][i[n]]:i[n]}).join(", ")},_setTooltip:function(t){if(t){var e=(this.KEY,this.values),i={},n={},r=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),o=t.cLoc[0]||r[0],s=t.cLoc[1]||r[1],l=t.r||0;i.valueS=e.size[a.getKey(t,this.dataKeys.size)],i.labelText=this._getLabelText(e,this.labelNames,t),n.labelX0=i.valueX=o/this.width,n.labelY0=i.valueY=s/this.height,n.scaledS0=l,n.scaledC0=null,this._labels.setTooltip(t,i.labelText,n,i)}else this._labels.setTooltip()},preload:function(){var t=this,e=this,i=function(t,i){e.model.data.getAsset(t,function(t){e.topology=t,i()})},r=a.getProp(this,["model","ui","map","topology","path"]),o=a.getProp(this,["model","ui","map","topology","which"]),s=a.getProp(this,["model","ui","map","topology","key"]);return new Promise(function(l,c){if(r)i(r,l);else if(o){var u=t.model.marker._getFirstDimension({exceptType:"time"}),h={language:t.model.locale.id,from:"entities",select:{key:[u],value:[o]},where:{$and:[n({},u,"$"+u)]},join:n({},"$"+u,{key:u,where:n({},u,{$in:[s||"world"]})})},d=t.model.data.load(h,n({},o,function(t){return t}));d.then(function(t){i(e.model.data.getData(t)[0][o],l)},function(t){return a.warn("Problem with Preload query: ",t,JSON.stringify(h))})}else i("assets/world-50m.json",l)})}});e.default=m},function(t,e){},function(t,e){t.exports='\x3c!-- Bubble Map Chart Component --\x3e\n<div class="vzb-bubblemap">\n    <svg class="vzb-bmc-map-background vzb-export">\n        <g class="vzb-bmc-map-graph"></g>\n    </svg>\n    <svg class="vzb-bubblemap-svg vzb-export">\n        <g class="vzb-bmc-graph">\n            <g class="vzb-bmc-year"></g>\n\n            <g class="vzb-bmc-lines"></g>\n            <g class="vzb-bmc-bubbles"></g>\n            <g class="vzb-bmc-bubble-labels"></g>\n\n\n            <g class="vzb-bmc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-c-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-y-info vzb-noexport">\n            </g>\n\n            <g class="vzb-bmc-axis-c-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n            <g class="vzb-bmc-labels"></g>\n        </g>\n    </svg>\n</div>\n'},function(t,e,i){t.exports=i(0)}])},function(t,e){!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(2);var n=i(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a={version:"2.0.5-7",build:1518537799629},o=Vizabi.Tool.extend("LineChart",{init:function(t,e){this.name="linechart",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"],ui:{show_value_when_drag_play:!0,axis_aligned:!1}},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_tags:{autoconfig:{type:"entity_domain",includeOnlyIDs:["tag"]}},marker_tags:{space:["entities_tags"],label:{use:"property"},hook_parent:{}},marker:{limit:5e3,space:["entities","time"],axis_x:{use:"indicator",allow:{scales:["time"]},autoconfig:{index:0,type:"time"}},axis_y:{use:"indicator",allow:{scales:["linear","log"]},autoconfig:{type:"measure"}},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{curve:"curveMonotoneX",labels:{min_number_of_entities_when_values_hide:2},whenHovering:{hideVerticalNow:!1,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1}},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","moreoptions"],sidebar:["colors","find"],moreoptions:["opacity","speed","axes","colors","presentation","about"],dialog:{find:{panelMode:"show"}}},presentation:!1}},versionInfo:a});e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi,r=n.utils,a=n.Component,o=n.helpers,s=o["d3.axisWithLabelPicker"],l=o["d3.collisionResolver"],c=n.iconset,u=c.warn,h=c.question,d=a.extend("linechart",{init:function(t,e){var n=this;this.name="linechart",this.template=i(3),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(){n._readyOnce&&(n.updateTime(),n.redrawDataPoints())},"change:time.playing":function(){n.model.time.playing&&r.isTouchDevice()&&!n.tooltip.classed("vzb-hidden")&&n.tooltip.classed("vzb-hidden",!0)},"change:time.start":function(){n._readyOnce&&n.all_values&&n.values&&(n.updateIndicators(),n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.redrawDataPoints(),n.highlightLines())},"change:time.end":function(){n._readyOnce&&n.all_values&&n.values&&(n.updateIndicators(),n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.redrawDataPoints(),n.highlightLines())},"change:marker":function(t,e){if(n._readyOnce){if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1||e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(!n.yScale||!n.xScale)return;if(e.indexOf("axis_x")>-1){var i=n.model.time.formatDate(n.model.marker.axis_x.getZoomedMin()),r=n.model.time.formatDate(n.model.marker.axis_x.getZoomedMax());return void n.model.time.set({startOrigin:i,endOrigin:r})}if(!n.all_values||!n.values)return;return n.updateIndicators(),n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.updateTime(),n.redrawDataPoints(),void n.highlightLines()}if(e.indexOf("scaleType")>-1){if(!n.all_values||!n.values)return;n.updateIndicators(),n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.redrawDataPoints(),n.highlightLines()}}},"change:marker.highlight":function(){n._readyOnce&&n.highlightLines()},"change:marker.select":function(){n._readyOnce&&(n.updateDoubtOpacity(),n.highlightLines())},"change:marker.opacitySelectDim":function(){n._readyOnce&&n.highlightLines()},"change:marker.opacityRegular":function(){n._readyOnce&&n.highlightLines()},"change:marker.color":function(){n._ready&&n.model.marker.getFrame(n.model.time.value,function(t,e){if(!n._frameIsValid(t))return r.warn("change:marker.color: empty data received from marker.getFrame(). doing nothing");n.values=t,n.updateColors()})}},this._super(t,e),this.xScale=null,this.yScale=null,this.rangeXRatio=1,this.rangeXShift=0,this.rangeYRatio=1,this.rangeYShift=0,this.lineWidthScale=d3.scaleLinear().domain([0,20]).range([7,1]).clamp(!0),this.xAxis=s("bottom"),this.yAxis=s("left"),this.COLOR_BLACKISH="#333",this.COLOR_WHITEISH="#fdfdfd",this.COLOR_WHITEISH_SHADE="#555",this.isDataPreprocessed=!1,this.timeUpdatedOnce=!1,this.sizeUpdatedOnce=!1,this.getNearestKey=r.memoize(this.getNearestKey)},readyOnce:function(){var t=this,e=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-lc-graph"),this.yAxisElContainer=this.graph.select(".vzb-lc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-lc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.xTitleEl=this.graph.select(".vzb-lc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-lc-axis-y-title"),this.yInfoEl=this.graph.select(".vzb-lc-axis-y-info"),this.linesContainerCrop=this.graph.select(".vzb-lc-lines-crop"),this.linesContainer=this.graph.select(".vzb-lc-lines"),this.labelsContainerCrop=this.graph.select(".vzb-lc-labels-crop"),this.labelsContainer=this.graph.select(".vzb-lc-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.verticalNow=this.labelsContainer.select(".vzb-lc-vertical-now"),this.tooltip=this.element.select(".vzb-tooltip"),this.projectionX=this.graph.select(".vzb-lc-projection-x"),this.projectionY=this.graph.select(".vzb-lc-projection-y"),this.entityLabels=this.labelsContainer.selectAll(".vzb-lc-entity"),this.entityLines=this.linesContainer.selectAll(".vzb-lc-entity"),this.totalLength_1={},this.TIMEDIM=this.model.time.getDimension(),this.KEYS=r.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.collisionResolver=l().selector(".vzb-lc-label").value("valueY").filter(function(t,e){return t.valueX-e==0&&!t.hidden});var i=this.model.marker.axis_y.getConceptprops();r.setIcon(this.yInfoEl,h).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.yInfoEl.on("click",function(){e.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var t=this.getBBox(),i=r.makeAbsoluteContext(this,this.farthestViewportElement)(t.x-10,t.y+t.height+10);e.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){e.parent.findChildByName("gapminder-datanotes").hide()}),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.on("resize",function(){e.updateSize()||(e.updateTime(),e.redrawDataPoints())}),this.graph.on("click",function(){1==t.model.marker.highlight.length&&e.model.marker.selectMarker(t.model.marker.highlight[0])})},ready:function(){var t=this;this.KEYS=r.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.all_steps=this.model.time.getAllSteps(),this.all_values=this.values=null,this.updateTime(),this.updateUIStrings(),this.updateIndicators(),this.entityLines.remove(),this.entityLabels.remove(),this.model.marker.getFrame(null,function(e){t.all_values=e,t.model.marker.getFrame(t.model.time.value,function(e){t._frameIsValid(e)&&(t.values=e,t.updateShow(),t.updateSize()||(t.updateDoubtOpacity(),t.zoomToMaxMin(),t.redrawDataPoints(),t.highlightLines(),t.linesContainerCrop.on("mousemove",t.entityMousemove.bind(t,null,null,t)).on("mouseleave",t.entityMouseout.bind(t,null,null,t))))})})},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.color).length)},updateUIStrings:function(){var t=this,e=t.model.marker.axis_y.getConceptprops(),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:i.name,C:n.name},unit:{Y:e.unit||"",X:i.unit||"",C:n.unit||""}},this.strings.unit.Y==="unit/"+this.model.marker.axis_y.which&&(this.strings.unit.Y=""),this.strings.unit.X==="unit/"+this.model.marker.axis_x.which&&(this.strings.unit.X=""),this.strings.unit.C==="unit/"+this.model.marker.color.which&&(this.strings.unit.C=""),this.strings.unit.Y&&(this.strings.unit.Y=", "+this.strings.unit.Y),this.strings.unit.X&&(this.strings.unit.X=", "+this.strings.unit.X),this.strings.unit.C&&(this.strings.unit.C=", "+this.strings.unit.C),r.setIcon(this.dataWarningEl,u).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()});var a=this.xTitleEl.selectAll("text").data([0]);a=a.enter().append("text").merge(a);var o=this.yTitleEl.selectAll("text").data([0]);o=o.enter().append("text").merge(o),o.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateIndicators:function(){var t=this.KEY;if(this.yScale=this.model.marker.axis_y.getScale(),!this.splash){var e=this.model.marker.axis_y.getLimits(this.model.marker.axis_y.which);this.yScale.domain([e.min,e.max])}this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this.collisionResolver.scale(this.yScale).KEY(t)},updateShow:function(){var t=this,e=this,i=this.KEYS,n=this.KEY,a=this.dataKeys;this.cached={},this.dataHash={},this.data=this.model.marker.getKeys().map(function(e){return e[n]=r.getKey(e,i),t.dataHash[e[n]]=e,e}),this.linesContainer.selectAll(".vzb-lc-entity").remove(),this.entityLines=this.linesContainer.selectAll(".vzb-lc-entity").data(this.data),this.lineWidth=this.lineWidthScale(this.data.length),this.lineWidth>=2?this.shadowWidth=1.3*this.lineWidth:this.shadowWidth=null,this.labelsContainer.classed("small",!this.shadowWidth),this.entityLines=this.entityLines.enter().append("g").attr("class",function(t){return"vzb-lc-entity vzb-lc-entity-"+t[n]}).each(function(t,i){var n=d3.select(this);e.shadowWidth&&n.append("path").attr("class","vzb-lc-line-shadow"),n.append("path").attr("class","vzb-lc-line")}).merge(this.entityLines),this.labelsContainer.selectAll(".vzb-lc-entity").remove(),this.entityLabels=this.labelsContainer.selectAll(".vzb-lc-entity").data(this.data),this.entityLabels=this.entityLabels.enter().append("g").attr("class","vzb-lc-entity").on("mouseover",function(t){e.model.marker.highlightMarker(t)}).on("mouseout",function(t){e.model.marker.clearHighlighted()}).each(function(t,e){var i=d3.select(this);i.append("circle").attr("class","vzb-lc-circle").attr("cx",0);var n=i.append("g").attr("class","vzb-lc-label");n.append("text").attr("class","vzb-lc-labelname vzb-lc-labelstroke").attr("dy",".35em"),n.append("text").attr("class","vzb-lc-labelname vzb-lc-labelfill").attr("dy",".35em"),n.append("text").attr("class","vzb-lc-label-value").attr("dy","1.6em")}).merge(this.entityLabels),this.all_values&&this.values&&this.entityLabels.each(function(t,i){var n=d3.select(this),o=e.getColorsByValue(e.values.color[r.getKey(t,a.color)]),s=o.color,l=o.colorShadow,c=e.model.marker.getCompoundLabelText(t,e.values),u=e.yAxis.tickFormat()(e.values.axis_y[r.getKey(t,a.axis_y)]),h=c.length<13?c:c.substring(0,10)+"...",d=e.ui.chart.labels.min_number_of_entities_when_values_hide;n.select("circle").style("fill",s),n.selectAll(".vzb-lc-labelname").text(h+" "+(e.data.length<d?u:"")),n.select(".vzb-lc-labelfill").style("fill",l),n.append("title").text(c+" "+u),n.select(".vzb-lc-label-value").style("fill",l)}),this.line=d3.line().curve(d3[this.ui.chart.curve||"curveMonotoneX"]).x(function(t){return e.xScale(t[0])}).y(function(t){return e.yScale(t[1])})},getColorsByValue:function(t){return{color:null!=t?this.cScale(t):this.COLOR_WHITEISH,colorShadow:null!=t?this.model.marker.color.getColorShade({colorID:t,shadeID:"shade"}):this.COLOR_WHITEISH_SHADE}},updateColors:function(){var t=this,e=this.dataKeys=this.model.marker.getDataKeysPerHook(),i=this.values.color;this.cScale=this.model.marker.color.getScale(),this.entityLabels.each(function(n,a){var o=d3.select(this),s=t.getColorsByValue(i[r.getKey(n,e.color)]),l=s.color,c=s.colorShadow;o.select("circle").style("fill",l),o.select(".vzb-lc-labelfill").style("fill",c),o.select(".vzb-lc-label-value").style("fill",c)}),this.entityLines.each(function(n,a){var o=d3.select(this),s=t.getColorsByValue(i[r.getKey(n,e.color)]),l=s.color,c=s.colorShadow;o.select(".vzb-lc-line").style("stroke",l),o.select(".vzb-lc-line-shadow").style("stroke",c)})},updateTime:function(){var t=this,e=(this.KEY,null===this.time?this.model.time.value:this.time);this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-e>0?this.model.time.delayAnimations:0,{}[this.model.time.getDimension()]=this.time,this.prev_steps=this.all_steps.filter(function(e){return e<t.time}),this.timeUpdatedOnce=!0},profiles:{small:{margin:{top:30,right:20,left:40,bottom:20},infoElHeight:16,yAxisTitleBottomMargin:6,tick_spacing:60,text_padding:12,lollipopRadius:6,limitMaxTickNumberX:5},medium:{margin:{top:40,right:60,left:60,bottom:25},infoElHeight:20,yAxisTitleBottomMargin:6,tick_spacing:80,text_padding:15,lollipopRadius:7,limitMaxTickNumberX:10},large:{margin:{top:50,right:60,left:75,bottom:30},infoElHeight:22,yAxisTitleBottomMargin:6,tick_spacing:100,text_padding:20,lollipopRadius:9,limitMaxTickNumberX:0}},presentationProfileChanges:{medium:{margin:{top:70,bottom:40,left:70},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26,text_padding:30},large:{margin:{top:70,bottom:50,left:70},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,text_padding:36,hideSTitle:!0}},timeSliderProfiles:{small:{margin:{top:7,right:15,bottom:10,left:60}},medium:{margin:{top:10,right:15,bottom:10,left:60}},large:{margin:{top:5,right:15,bottom:10,left:75}}},updateSize:function(){var t=this,e=(this.values,this.KEY,this.model.locale.isRTL());this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges),this.margin=this.activeProfile.margin,this.tick_spacing=this.activeProfile.tick_spacing;var i=this.activeProfile.infoElHeight,n=0;this.entityLabels.selectAll(".vzb-lc-labelname").attr("dx",t.activeProfile.text_padding).each(function(t,e){var i=this.getComputedTextLength();i>n&&(n=i)}),this.entityLabels.selectAll(".vzb-lc-circle").attr("r",this.shadowWidth?t.activeProfile.lollipopRadius:.8*t.activeProfile.lollipopRadius);if(this.margin.right=Math.max(this.margin.right,n+this.activeProfile.text_padding+20),this.height=parseInt(this.element.style("height"),10)-this.margin.top-this.margin.bottom||0,this.width=parseInt(this.element.style("width"),10)-this.margin.left-this.margin.right||0,this.height<=0||this.width<=0)return r.warn("Line chart updateSize() abort: vizabi container is too little or has display:none");this.linesContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width+this.margin.right).attr("height",Math.max(0,this.height)),this.collisionResolver.height(this.height),this.graph.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.yScale.range([this.height-this.activeProfile.lollipopRadius,this.activeProfile.lollipopRadius]),this.xScale.range([this.rangeXShift,this.width*this.rangeXRatio+this.rangeXShift]),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:this.margin,limitMaxTickNumber:6,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSizeInner(-this.height).tickSizeOuter(0).tickSizeMinor(-this.height,0).tickPadding(6).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,limitMaxTickNumber:this.activeProfile.limitMaxTickNumberX,toolMargin:this.margin,bump:2*this.activeProfile.text_padding,formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisElContainer.attr("width",this.width+2*this.activeProfile.text_padding).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-this.activeProfile.text_padding),this.xAxisEl.attr("transform","translate("+(this.activeProfile.text_padding-1)+","+(this.height+1)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.yTitleEl.style("font-size",i+"px").attr("transform","translate("+(10-this.activeProfile.margin.left+(e?1.4*i:0))+", -"+this.activeProfile.yAxisTitleBottomMargin+")");var a=this.yTitleEl.select("text").text(this.strings.title.Y+this.strings.unit.Y);if(a.node().getBBox().width>this.width&&a.text(this.strings.title.Y),this.yInfoEl.select("svg").node()){var o=this.yTitleEl.node().getBBox(),s=r.transform(this.yTitleEl.node());this.yInfoEl.select("svg").attr("width",i+"px").attr("height",i+"px"),this.yInfoEl.attr("transform","translate("+(e?10-this.activeProfile.margin.left:o.x+s.translateX+o.width+.4*i)+","+(s.translateY-.8*i)+")")}var l=this.dataWarningEl.select("text").node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*l.height).attr("height",.75*l.height).attr("x",-l.width-1.2*l.height).attr("y",.65*-l.height),this.dataWarningEl.attr("transform","translate("+(this.width+.85*this.margin.right)+",-"+this.activeProfile.yAxisTitleBottomMargin+")").select("text");var c=this.xTitleEl.select("text").text(this.strings.title.X+this.strings.unit.X);this.xTitleEl.style("font-size",i+"px").attr("transform","translate("+(this.width+this.activeProfile.text_padding+this.activeProfile.yAxisTitleBottomMargin)+","+(this.height+.72*c.node().getBBox().height)+")"),c.node().getBBox().width>this.width-100&&c.text(this.strings.title.X),this.verticalNow.attr("y1",this.yScale.range()[0]).attr("y2",this.yScale.range()[1]).attr("x1",0).attr("x2",0),this.projectionX.attr("y1",t.yScale.range()[0]),this.projectionY.attr("x2",t.xScale.range()[0]),r.isTouchDevice()&&(t.tooltip.classed("vzb-hidden",!0),t.verticalNow.style("opacity",1),t.projectionX.style("opacity",0),t.projectionY.style("opacity",0),t.xAxisEl.call(t.xAxis.highlightValue(t.time)),t.yAxisEl.call(t.yAxis.highlightValue("none")),t.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).classed("vzb-dimmed",!1).classed("vzb-hovered",!1)}),t.hoveringNow=null);var u={rangeMax:this.xScale.range()[1],mRight:n-20,profile:this.timeSliderProfiles[this.getLayoutProfile()]};this.parent.trigger("myEvent",u),this.sizeUpdatedOnce=!0},redrawDataPoints:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.dataKeys=this.model.marker.getDataKeysPerHook();t.all_values&&this.model.marker.getFrame(this.time,function(a,o){if(!t._frameIsValid(a))return r.warn("redrawDataPoints(): empty data received from marker.getFrame(). doing nothing");t.values=a,t.timeUpdatedOnce||t.updateTime(),t.sizeUpdatedOnce||t.updateSize(),t.updateDoubtOpacity(),t.entityLines.each(function(e,o){var s=d3.select(this),l=t.getColorsByValue(a.color[r.getKey(e,n.color)]),c=l.color,u=l.colorShadow,h=t.prev_steps.map(function(i,a){return[i,t.all_values[i]?t.all_values[i].axis_y[r.getKey(e,n.axis_y)]:null]}).filter(function(t){return t[1]||0===t[1]});(a.axis_y[r.getKey(e,n.axis_y)]||0===a.axis_y[r.getKey(e,n.axis_y)])&&h.push([a.axis_x[r.getKey(e,n.axis_x)],a.axis_y[r.getKey(e,n.axis_y)]]),h.length>0?t.cached[e[i]]={valueX:h[h.length-1][0],valueY:h[h.length-1][1]}:delete t.cached[e[i]];var d=s.select(".vzb-lc-line");t.model.time.playing&&null===t.totalLength_1[e[i]]&&(t.totalLength_1[e[i]]=d.node().getTotalLength());var f=t.line(h)||"",p=s.select(".vzb-lc-line-shadow").style("stroke",u).style("stroke-width",t.shadowWidth+"px").attr("transform","translate(0, "+(t.shadowWidth-t.lineWidth)+")").attr("d",f);d.style("stroke",c).style("stroke-width",t.lineWidth+"px").attr("d",f);var m=d.node().getTotalLength();t.model.time.playing?(p.interrupt().attr("stroke-dasharray",m).attr("stroke-dashoffset",m-t.totalLength_1[e[i]]).transition().delay(0).duration(t.duration).ease(d3.easeLinear).attr("stroke-dashoffset",0),d.interrupt().attr("stroke-dasharray",m).attr("stroke-dashoffset",m-t.totalLength_1[e[i]]).transition().delay(0).duration(t.duration).ease(d3.easeLinear).attr("stroke-dashoffset",0),t.totalLength_1[e[i]]=m):(t.totalLength_1[e[i]]=null,p.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"),d.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"))}),t.entityLabels.each(function(n,r){var a=d3.select(this);if(t.cached[n[i]]){if(n.valueX=t.xScale(t.cached[n[i]].valueX),n.valueY=t.yScale(t.cached[n[i]].valueY),a.classed("vzb-hidden",!1).transition().duration(t.duration).ease(d3.easeLinear).attr("transform","translate("+n.valueX+",0)"),a.select(".vzb-lc-circle").transition().duration(t.duration).ease(d3.easeLinear).attr("cy",n.valueY+1),t.data.length<t.ui.chart.labels.min_number_of_entities_when_values_hide*e.length){var o=t.model.marker.getCompoundLabelText(n,t.values),s=t.yAxis.tickFormat()(t.cached[n[i]].valueY),l=o.length<13?o:o.substring(0,12)+"â€¦";a.selectAll(".vzb-lc-labelname").text(l+" "+s)}a.select(".vzb-lc-label").transition().duration(t.duration).ease(d3.easeLinear).attr("transform","translate(0,"+n.valueY+")")}else a.classed("vzb-hidden",!0)}),t.verticalNow.transition().duration(t.duration).ease(d3.easeLinear).attr("transform","translate("+t.xScale(d3.min([t.model.marker.axis_x.getZoomedMax(),t.time]))+",0)"),t.hoveringNow||t.time-t.model.time.start==0?t.verticalNow.style("opacity",0):(t.ui.chart.hideXAxisValue||t.xAxisEl.call(t.xAxis.highlightTransDuration(t.duration).highlightValue(t.time)),t.verticalNow.style("opacity",1)),0==t.duration&&d3.timerFlush(),clearTimeout(t.collisionTimeout),t.collisionTimeout=setTimeout(function(){t.entityLabels.call(t.collisionResolver.time(t.xScale(t.time)))},1.5*t.model.time.delayAnimations)})},entityMousemove:function(t,e,i,n){var a=i,o=(a.KEY,a.values,d3.mouse(a.element.node()).map(function(t){return parseInt(t)})),s=a.xScale.invert(o[0]-a.margin.left);a.time-s<0?s=a.time:s<this.model.time.start&&(s=this.model.time.start);var l=void 0,c=o[1]-a.margin.top;r.isDate(s)||(s=this.model.time.parse(s)),this.model.marker.getFrame(s,function(e){if(a._frameIsValid(e)){var i=a.getNearestKey(c,a.dataHash,e.axis_y,a.yScale.bind(a));if(l=e.axis_y[i],t=a.dataHash[i],a.model.marker.isHighlighted(t)||(a.model.marker.clearHighlighted(),a.model.marker.highlightMarker(t)),a.hoveringNow=t,!r.isNaN(l)){var n=a.xScale(s),o=a.yScale(l);a.ui.chart.whenHovering.showTooltip&&a.tooltip.style("left",n+a.margin.left+"px").style("bottom",a.height-o+a.margin.bottom+"px").text(a.yAxis.tickFormat()(l)).classed("vzb-hidden",!1),a.ui.chart.whenHovering.hideVerticalNow&&a.verticalNow.style("opacity",0),a.ui.chart.whenHovering.showProjectionLineX&&a.projectionX.style("opacity",1).attr("y2",o).attr("x1",n).attr("x2",n),a.ui.chart.whenHovering.showProjectionLineY&&a.projectionY.style("opacity",1).attr("y1",o).attr("y2",o).attr("x1",n),a.ui.chart.whenHovering.higlightValueX&&a.xAxisEl.call(a.xAxis.highlightValue(s).highlightTransDuration(0)),a.ui.chart.whenHovering.higlightValueY&&a.yAxisEl.call(a.yAxis.highlightValue(l).highlightTransDuration(0)),clearTimeout(a.unhoverTimeout)}}})},entityMouseout:function(t,e,i){var n=i;d3.event.relatedTarget&&d3.select(d3.event.relatedTarget).classed("vzb-tooltip")||(n.unhoverTimeout=setTimeout(function(){n.tooltip.classed("vzb-hidden",!0),n.verticalNow.style("opacity",1),n.projectionX.style("opacity",0),n.projectionY.style("opacity",0),n.xAxisEl.call(n.xAxis.highlightValue(n.time)),n.yAxisEl.call(n.yAxis.highlightValue("none")),n.model.marker.clearHighlighted(),n.hoveringNow=null},300))},highlightLines:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.model.marker.opacityRegular,a=this.model.marker.opacitySelectDim,o=this.model.marker.highlight.length>0;this.someSelected=this.model.marker.select.length>0,this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01;var s={};t.model.marker.getSelected().map(function(t){s[r.getKey(t,e)]=!0}),this.entityLines.style("opacity",function(e){return t.model.marker.isHighlighted(e)?1:t.someSelected?s[e[i]]?1:a:o?.3:n}),this.entityLabels.style("opacity",function(e){return t.model.marker.isHighlighted(e)?(e.sortValue=1,1):(e.sortValue=0,t.someSelected?s[e[i]]?1:a:o?.3:n)}).attr("pointer-events",function(e){return t.someSelected&&t.nonSelectedOpacityZero&&!s[e[i]]?(e.hidden=!0,"none"):(e.hidden=!1,"visible")}).sort(function(t,e){return d3.ascending(t.sortValue,e.sortValue)})},zoomToMaxMin:function(){null!=this.model.marker.axis_x.getZoomedMin()&&null!=this.model.marker.axis_x.getZoomedMax()&&(this.xScale.domain([this.model.marker.axis_x.getZoomedMin(),this.model.marker.axis_x.getZoomedMax()]),this.xAxisEl.call(this.xAxis)),null!=this.model.marker.axis_y.getZoomedMin()&&null!=this.model.marker.axis_y.getZoomedMax()&&((this.model.marker.axis_y.getZoomedMin()<=0||this.model.marker.axis_y.getZoomedMax()<=0)&&"log"==this.model.marker.axis_y.scaleType?(this.yScale=d3.scaleGenericlog().domain([this.model.marker.axis_y.getZoomedMin(),this.model.marker.axis_y.getZoomedMax()]).range(this.yScale.range()),this.model.marker.axis_y.scale=d3.scaleGenericlog().domain([this.model.marker.axis_y.getZoomedMin(),this.model.marker.axis_y.getZoomedMax()]).range(this.yScale.range()),this.yScale=this.model.marker.axis_y.scale):this.yScale.domain([this.model.marker.axis_y.getZoomedMin(),this.model.marker.axis_y.getZoomedMax()]),this.yAxisEl.call(this.yAxis))},getNearestKey:function(t,e,i,n){var a=this.KEYS,o=Object.keys(e);this.someSelected&&this.nonSelectedOpacityZero&&(o=this.model.marker.select.map(function(t){return r.getKey(t,a)}));for(var s=o[0],l=1;l<o.length;l++){var c=o[l];Math.abs((n?n(i[c]):i[c])-t)<Math.abs((n?n(i[s]):i[s])-t)&&(s=c)}return s}});e.default=d},function(t,e){},function(t,e){t.exports='\x3c!-- LineChart Component --\x3e\n<div class="vzb-linechart">\n    <svg class="vzb-linechart-svg">\n        <g class="vzb-lc-graph">\n\n            <svg class="vzb-lc-axis-x"><g></g></svg>\n            <svg class="vzb-lc-axis-y"><g></g></svg>\n            <text class="vzb-lc-axis-x-value"></text>\n            <text class="vzb-lc-axis-y-value"></text>\n            <svg class="vzb-lc-lines-crop">\n                <svg class="vzb-lc-lines"></svg>\n                <line class="vzb-lc-projection-x"></line>\n                <line class="vzb-lc-projection-y"></line>\n            </svg>\n            <svg class="vzb-lc-labels-crop">\n                <g class="vzb-lc-labels">\n                    <line class="vzb-lc-vertical-now"></line>\n                </g>\n            </svg>\n\n            <g class="vzb-lc-axis-y-title"></g>\n            <g class="vzb-lc-axis-x-title"></g>\n            <g class="vzb-lc-axis-y-info"></g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n\n            \x3c!--filter id="vzb-lc-filter-dropshadow"> \n              <feOffset result="offOut" in="SourceGraphic" dx="0" dy="2" />\n              <feColorMatrix result = "matrixOut" in = "offOut" type = "matrix"\n                             values = "0.3 .0 .0 .0 .0\n                                       .0 .3 .0 .0 .0\n                                       .0 .0 .3 .0 .0\n                                       1.0 1.0 1.0 1.0 .0"/>\n              <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="0.8" />\n              <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n            </filter--\x3e\n\n        </g>\n    </svg>\n    <div class="vzb-tooltip vzb-hidden"></div>\n</div>\n'},function(t,e,i){t.exports=i(0)}])},function(t,e){!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=6)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(3);var n=i(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a={version:"2.1.0",build:1521130000838};e.default=Vizabi.Tool.extend("BarRankChart",{init:function(t,e){this.name="barrankchart",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_tags:{autoconfig:{type:"entity_domain",includeOnlyIDs:["tag"]}},marker_tags:{space:["entities_tags"],label:{use:"property",which:"name"},hook_parent:{}},marker:{space:["entities","time"],axis_x:{use:"indicator",autoconfig:{type:"measure"},allow:{scales:["linear","log"]}},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","moreoptions","fullscreen","presentation"],dialogs:{popup:["timedisplay","colors","find","moreoptions"],sidebar:["timedisplay","colors","find"],moreoptions:["opacity","speed","colors","presentation","about"]},presentation:!1}},versionInfo:a})},function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(2),s=function(t){return t&&t.__esModule?t:{default:t}}(o),l=Vizabi.utils,c=Vizabi.helpers["d3.axisWithLabelPicker"],u=Vizabi.iconset.question,h=Vizabi.iconset.warn,d=Vizabi.Component.extend("barrankchart",n({init:function(t,e){var n=this;this.name="barrankchart",this.template=i(4),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(){n.model._ready&&n._readyOnce&&n.onTimeChange()},"change:marker.select":function(){n._readyOnce&&(n._selectBars(),n._updateOpacity(),n._updateDoubtOpacity(),n._scroll())},"change:marker.axis_x.scaleType":function(){n._readyOnce&&n.loadData()&&n.draw(!0)},"change:marker.color.palette":function(){n._drawColors()},"change:marker.highlight":function(){n._updateOpacity()},"change:marker.opacitySelectDim":function(){n._updateOpacity()},"change:marker.opacityRegular":function(){n._updateOpacity()}},this._super(t,e),this.xScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),this.xAxis=c("bottom")},onTimeChange:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.values&&t.loadData()&&t.draw()})},readyOnce:function(){this.element=d3.select(this.element),this.header=this.element.select(".vzb-br-header"),this.infoEl=this.element.select(".vzb-br-axis-info"),this.barViewport=this.element.select(".vzb-br-barsviewport"),this.barSvg=this.element.select(".vzb-br-bars-svg"),this.barContainer=this.element.select(".vzb-br-bars"),this.dataWarningEl=this.element.select(".vzb-data-warning"),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this._localeId=this.model.locale.id,this._entityLabels={},this._presentation=!this.model.ui.presentation,this._formatter=this.model.marker.axis_x.getTickFormatter(),this.ready(),this._selectBars()},ready:function(){var t=this;this.TIMEDIM=this.model.time.getDimension(),this.KEYS=l.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.labelNames=this.model.marker.getLabelHookNames(),this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.values&&(t.markerKeys=t.model.marker.getKeys(),t.loadData()&&(t.draw(!0),t._updateOpacity(),t._drawColors()))})},resize:function(){this.draw(!0),this._drawColors()},loadData:function(){var t=this,e=this;this.translator=this.model.locale.getTFunction();var i=this.values.axis_x;if(!Object.keys(i).length)return!1;this.sortedEntities=this._sortByIndicator(i,this.dataKeys.axis_x),this.header.select(".vzb-br-title").select("text").on("click",function(){return t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX("left").alignY("top").updateView().toggle()}),this.xScale=this.model.marker.axis_x.getScale().copy(),this.cScale=this.model.marker.color.getScale(),l.setIcon(this.dataWarningEl,h).select("svg").attr("width",0).attr("height",0),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){return t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){return t._updateDoubtOpacity(1)}).on("mouseout",function(){return t._updateDoubtOpacity()});var n=this.model.marker.axis_x.getConceptprops();return l.setIcon(this.infoEl,u).select("svg").attr("width",0).attr("height",0).style("opacity",Number(Boolean(n.description||n.sourceLink))),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var t=this.getBBox(),i=l.makeAbsoluteContext(this,this.farthestViewportElement),n=i(t.x-10,t.y+t.height+10);e.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(n.x,n.y)}),this.infoEl.on("mouseout",function(){e.parent.findChildByName("gapminder-datanotes").hide()}),!0},draw:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value;var e=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0;this.drawAxes(e,t)||this.drawData(e,t)},drawAxes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e={small:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:18,barMargin:3,barRectMargin:5,barValueMargin:5,scrollMargin:20},medium:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:21,barMargin:3,barRectMargin:5,barValueMargin:5,scrollMargin:25},large:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:28,barMargin:4,barRectMargin:5,barValueMargin:5,scrollMargin:25}},i={medium:{margin:{top:60,right:10,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:25,infoElMargin:10,barHeight:25,barMargin:6},large:{margin:{top:60,right:10,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:10,barHeight:30,barMargin:6}};this.activeProfile=this.getActiveProfile(e,i);var n=this.activeProfile,r=n.margin,a=n.headerMargin,o=n.infoElHeight,s=n.infoElMargin;if(this.height=parseInt(this.element.style("height"),10)||0,this.width=parseInt(this.element.style("width"),10)||0,!this.height||!this.width)return l.warn("Dialog resize() abort: vizabi container is too little or has display:none");this.barViewport.style("height",this.height-r.bottom-r.top+"px"),this.header.attr("height",r.top);var c=this.header.select(".vzb-br-title"),u=this.model.marker.axis_x.getConceptprops(),h=u.name,d=u.unit,f=c.select("text");if(d){f.text(h+", "+d);a.left+c.node().getBBox().width+s+o>this.width-a.right&&f.text(h)}else f.text(h);var p=c.node().getBBox(),m=a.left,g=a.top+p.height;c.attr("transform","translate("+m+", "+g+")");var v=this.infoEl;v.select("svg").attr("width",o+"px").attr("height",o+"px");var b=m+c.node().getBBox().width+s,y=a.top+o/4;v.attr("transform","translate("+b+", "+y+")");var _=this.header.select(".vzb-br-total");t?_.select("text").transition("text").delay(t).text(this.model.time.formatDate(this.time)):_.select("text").interrupt().text(this.model.time.formatDate(this.time)),_.style("opacity",Number("large"!==this.getLayoutProfile()));var x=_.node().getBBox(),w=this.width-a.right-x.width,S=a.top+x.height;_.attr("transform","translate("+w+", "+S+")").classed("vzb-transparent",p.width+x.width+10>this.width),this.element.select(".vzb-data-warning-svg").style("height",r.bottom+"px");var M=this.dataWarningEl.select("text").node().getBBox();this.dataWarningEl.attr("transform","translate("+(this.width-r.right-M.width)+", "+M.height+")").select("text"),this.dataWarningEl.select("svg").attr("width",M.height).attr("height",M.height).attr("x",-M.height-5).attr("y",1-M.height),this._updateDoubtOpacity()},drawData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.KEY;this._createAndDeleteBars(this.barContainer.selectAll(".vzb-br-bar").data(this.sortedEntities,function(t){return t[n]}));var a=this.model.ui.presentation,o=this._presentation!==a;o&&(this._presentation=a);var s=void 0===this._entitiesCount||this._entitiesCount!==this.sortedEntities.length;(o||s)&&s&&(this._entitiesCount=this.sortedEntities.length),this._resizeSvg(),this._scroll(e),this._drawColors();var l=this.activeProfile,c=l.barRectMargin,u=l.barValueMargin,h=l.scrollMargin,d=l.margin,f=this.model.marker.axis_x,p=f.getLimits(f.which),m=Math.abs(p.max)>=Math.abs(p.min),g=m?p.min<0:p.max>0,v=(this.width-d.right-d.left-c-h-(g?0:this._getWidestLabelWidth()))/(g?2:1);this.xScale.range([0,v]),"log"!==this.model.marker.axis_x.scaleType&&this.xScale.domain([0,Math.max.apply(Math,r(this.xScale.domain()))]);var b=g?v:this._getWidestLabelWidth(),y=function(e){return t.xScale(e)},_=function(t){return m?t>=0:t>0},x=function(t){return _(t)?"end":"start"},w=function(t){return _(t)?"start":"end"},S=function(e){return _(e)?d.left+b:t.width-b-h-d.right},M=function(t){return _(t)?S(t)+c:S(t)-c},k=function(t){return _(t)?M(t)+u:M(t)-u},E=this._getWidestLabelWidth(!0)+(m?d.left:d.right)<b;this.sortedEntities.forEach(function(n){var r=n.value;if((i||o||n.isNew||n.changedValue)&&(n.barLabel.attr("x",S(r)).attr("y",t.activeProfile.barHeight/2).attr("text-anchor",x(r)).text(E?n.label:n.labelSmall),n.barRect.attr("rx",t.activeProfile.barHeight/4).attr("ry",t.activeProfile.barHeight/4).attr("height",t.activeProfile.barHeight),n.barValue.attr("x",k(r)).attr("y",t.activeProfile.barHeight/2).attr("text-anchor",w(r))),i||n.changedWidth||o){var a=Math.max(0,r&&y(Math.abs(r)))||0;(i||n.changedWidth||o)&&n.barRect.transition().duration(e).ease(d3.easeLinear).attr("width",a),n.barRect.attr("x",M(r)-(r<0?a:0)),(i||n.changedValue)&&n.barValue.text(t._formatter(r)||t.translator("hints/nodata"))}(i||n.changedIndex||o)&&(!e&&n.self.interrupt(),(e?n.self.transition().duration(e).ease(d3.easeLinear):n.self).attr("transform","translate(0, "+t._getBarPosition(n.index)+")"))})},_resizeSvg:function(){var t=this.activeProfile,e=t.barHeight,i=t.barMargin;this.barSvg.attr("height",(e+i)*this.sortedEntities.length+"px")},_scroll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.barContainer.select(".vzb-selected");if(!e.empty()){var i=e.datum(),n=this._getBarPosition(i.index),r=this.activeProfile.margin,a=this.height-r.top-r.bottom,o=n-(a+this.activeProfile.barHeight)/2;this.barViewport.transition().duration(t).tween("scrollfor"+i.entity,this._scrollTopTween(o))}},_getLabelText:function(t,e,i){return this.KEYS.map(function(n){return t[e[n]]?t[e[n]][i[n]]:i[n]}).join(", ")},_createAndDeleteBars:function(t){var e=this,i=this.KEYS,n=(this.dataKeys,a(this.sortedEntities,1)),r=n[0];this._entityLabels[r.entity]||(this._entityLabels[r.entity]=r.label);var o=this._getLabelText(this.values,this.labelNames,r.entity),s=this._entityLabels[r.entity]!==o&&this.model.locale.id!==this._localeId;s&&(this._localeId=this.model.locale.id,this._entityLabels[r.entity]=o),t.exit().remove(),t=(s?t:t.enter().append("g")).each(function(t){var n=d3.select(this),r=t.label,a=r.length<12?r:r.substring(0,9)+"...",o=n.select(".vzb-br-label"),c=o.size()?o:n.append("text").attr("class","vzb-br-label").attr("dy",".325em"),u=c.text(r).node().getBBox().width,h=c.text(a).node().getBBox().width;if(Object.assign(t,{labelWidth:u,labelSmallWidth:h,labelSmall:a,barLabel:c}),!s){n.attr("class","vzb-br-bar").classed("vzb-selected",e.model.marker.isSelected(t.entity)).attr("id","vzb-br-bar-"+l.getKey(t.entity,i)+"-"+e._id).on("mousemove",function(t){return e.model.marker.highlightMarker(t.entity)}).on("mouseout",function(){return e.model.marker.clearHighlighted()}).on("click",function(t){e.model.marker.selectMarker(t.entity)});var d=n.append("rect").attr("stroke","transparent"),f=n.append("text").attr("class","vzb-br-value").attr("dy",".325em");Object.assign(t,{self:n,isNew:!0,barRect:d,barValue:f})}}).merge(t)},_getWidestLabelWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?"labelWidth":"labelSmallWidth",i=t?"label":"labelSmall",n=this.sortedEntities.reduce(function(t,i){return t[e]<i[e]?i:t}),r=n.barLabel.text(),a=n.barLabel.text(n[i]).node().getBBox().width;return n.barLabel.text(r),a},_drawColors:function(){var t=this,e=this,i=this.dataKeys;this.barContainer.selectAll(".vzb-br-bar>rect").each(function(t){var n=t.entity,r=d3.select(this),a=e.values.color[l.getKey(n,i.color)],o=a||0===a,s=o?String(e._getColor(a)):"rgb(253, 253, 253)",c=o?"transparent":"rgb(51, 51, 51)";r.style("fill")!==s&&r.style("fill",s),r.style("stroke")!==c&&r.style("stroke",c)}),this.barContainer.selectAll(".vzb-br-bar>text").style("fill",function(e){var n=e.entity;return t._getDarkerColor(t.values.color[l.getKey(n,i.color)]||null)})},_getColor:function(t){return d3.rgb(this.cScale(t))},_getDarkerColor:function(t){return this._getColor(t).darker(2)},_scrollTopTween:function(t){return function(){var e=this,i=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=i(t)}}},_getBarPosition:function(t){return(this.activeProfile.barHeight+this.activeProfile.barMargin)*t},_entities:{},_sortByIndicator:function(t,e){var i=this,r=this.KEYS;this.KEY,this.dataKeys;return this.markerKeys.map(function(a){var o,s=l.getKey(a,r),c=i._entities[s],u=t[l.getKey(a,e)],h=i._getLabelText(i.values,i.labelNames,a),d=i._formatter(u);return c?Object.assign(c,{value:u,label:h,formattedValue:d,changedValue:d!==c.formattedValue,changedWidth:u!==c.value,isNew:!1}):i._entities[s]=(o={entity:a,value:u,label:h,formattedValue:d},n(o,i.KEY,s),n(o,"changedValue",!0),n(o,"changedWidth",!0),n(o,"isNew",!0),o)}).sort(function(t,e){var i=t.value;return e.value-i}).map(function(t,e){return Object.assign(t,{index:e,changedIndex:e!==t.index})})},_selectBars:function(){var t=this,e=this.KEYS,i=this.model.marker.select;this.barContainer.classed("vzb-dimmed-selected",!1),this.barContainer.selectAll(".vzb-br-bar.vzb-selected").classed("vzb-selected",!1),i.length&&(this.barContainer.classed("vzb-dimmed-selected",!0),i.forEach(function(i){t.barContainer.select("#vzb-br-bar-"+(0,s.default)(l.getKey(i,e))+"-"+t._id).classed("vzb-selected",!0)}))},_updateOpacity:function(){var t=this.model.marker,e=t.highlight,i=t.select,n=t.opacityHighlightDim,r=t.opacitySelectDim,a=t.opacityRegular,o=e.length>0,s=i.length>0;this.barContainer.selectAll(".vzb-br-bar").style("opacity",function(e){return o&&t.isHighlighted(e.entity)?1:s?t.isSelected(e.entity)?a:r:o?n:a})},_updateDoubtOpacity:function(t){this.dataWarningEl.style("opacity",t||(this.model.marker.select.length?1:this.wScale(+this.model.time.value.getUTCFullYear().toString())))}},"_getLabelText",function(t,e,i){return this.KEYS.map(function(n){return t[e[n]]?t[e[n]][i[n]]:i[n]}).join(", ")}));e.default=d},function(t,e,i){(function(e){!function(e,i){t.exports=i(e)}(void 0!==e?e:this,function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,i=String(t),n=i.length,r=-1,a="",o=i.charCodeAt(0);++r<n;)e=i.charCodeAt(r),a+=0!=e?e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==o?"\\"+e.toString(16)+" ":(0!=r||1!=n||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?i.charAt(r):"\\"+i.charAt(r):"ï¿½";return a};return t.CSS||(t.CSS={}),t.CSS.escape=e,e})}).call(e,i(5))},function(t,e){},function(t,e){t.exports='\x3c!-- Bar Chart Component --\x3e\n<div class="vzb-barrankchart">\n  <svg class="vzb-br-header">\n    <g class="vzb-br-title">\n      <text></text>\n    </g>\n    <g class="vzb-br-total">\n      <text></text>\n    </g>\n    <g class="vzb-br-axis-info vzb-noexport"></g>\n  </svg>\n\n  <div class="vzb-br-barsviewport vzb-dialog-scrollable">\n    <svg class="vzb-br-bars-svg">\n      <g class="vzb-br-bars"></g>\n    </svg>\n  </div>\n\n  <svg class="vzb-data-warning-svg">\n    <g class="vzb-data-warning vzb-noexport">\n      <svg></svg>\n      <text></text>\n    </g>\n  </svg>\n</div>\n'},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){t.exports=i(0)}])},function(t,e){!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(2);var n=i(1),r=function(t){return t&&t.__esModule?t:{default:t}}(n),a={version:"2.0.2-5",build:1520293054124},o=Vizabi.Tool.extend("PopByAge",{init:function(t,e){this.name="popbyage",this.components=[{component:r.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","state.entities","state.entities_side","state.entities_age","state.entities_geodomain","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),!this.model){var e=t.state.entities_geodomain;e.skipFilter=(t.state.entities.dim===e.dim||t.state.entities_side.dim===e.dim)&&(Boolean(t.state.entities.getFilteredEntities().length)||!t.state.entities_side.skipFilter)}},default_model:{state:{marker_tags:{}},ui:{chart:{mode:"smallMultiples",stacked:!0,inpercent:!1,flipSides:!0,lockActive:!0,lockNonSelected:0},buttons:["colors","find","lock","side","inpercent","moreoptions","fullscreen"],dialogs:{popup:["timedisplay","colors","find","side","moreoptions"],sidebar:["timedisplay","colors","find","grouping"],moreoptions:["opacity","speed","grouping","colors","side","presentation","about"],dialog:{find:{panelMode:"show",enablePicker:!1}}},presentation:!1},locale:{}},versionInfo:a});e.default=o},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var a=Vizabi,o=a.utils,s=a.Component,l=a.helpers,c=l["d3.axisWithLabelPicker"],u=l["d3.dynamicBackground"],h=l.textEllipsis,d=a.iconset.question,f=s.extend("popbyage",{init:function(t,e){this.name="popbyage",this.template=i(3),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"entities",type:"entities"},{name:"entities_side",type:"entities"},{name:"entities_age",type:"entities"},{name:"entities_geodomain",type:"entities"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.startSelected":function(t){n._readyOnce&&n.model.time.set({startSelected:new Date(n.timeSteps[0])},!1,!1)},"change:time.endSelected":function(t){n._readyOnce&&n.model.time.set({endSelected:new Date(n.timeSteps[n.timeSteps.length-1])},!1,!1)},"change:time.value":function(t){if(n._readyOnce){if(1!=n.model.time.step&&!n.snapped&&!n.model.time.playing&&!n.model.time.dragging){if(n.snapTime)return void(+n.snapTime-n.model.time.value==0?(n.snapTime=null,n.model.time.snap()):n.model.time.value=new Date(n.snapTime));if(n.updateStartEnd(n.model.time.value,n.groupBy))return void n.ready();var e=d3.bisectLeft(n.timeSteps,n.model.time.value);if(0!=e&&n.timeSteps[e]-n.model.time.value){n.snapped=!0;var i=n.model.time.value,r=n.timeSteps[e-1];e=n.timeSteps[e];var a=i-r<e-i?r:e;n.model.time.value=new Date(a)}}if(!n.snapped)if(n.timeSteps.filter(function(t){return t-n.model.time.value==0}).length)n.model.marker.getFrame(n.model.time.value,function(t){t&&(n.frame=t,n.frameAxisX=t.axis_x,n._updateEntities(),n.updateBarsOpacity())});else if(n.model.time.value<n.model.time.startSelected||n.model.time.value>n.model.time.endSelected)n.snapTime=n.model.time.value;else{n.snapTime=null;var o=d3.bisectLeft(n.timeSteps,n.model.time.value),s=n.timeSteps[o-1],l=n.timeSteps[o],c=(n.model.time.value-s)/(l-s);n.model.marker.getFrame(l,function(t){n.model.marker.getFrame(s,function(e){n.frameAxisX=n.interpolateDiagonal(e.axis_x,t.axis_x,c),n._updateEntities(),n.updateBarsOpacity()})})}n.snapped=!1}},"change:marker.select":function(t){n.someSelected=n.model.marker.select.length>0,n.nonSelectedOpacityZero=!1,n.updateBarsOpacity()},"change:marker.highlight":function(t,e){n._readyOnce&&n._highlightBars()},"change:marker.opacitySelectDim":function(){n.updateBarsOpacity()},"change:marker.opacityRegular":function(){n.updateBarsOpacity()},"change:marker.color.palette":function(t){n._readyOnce&&n._updateEntities(!0)},"change:marker.color.scaleType":function(t){n._readyOnce&&n._updateEntities()},"change:marker.color.which":function(t){if(n._readyOnce){var e=void 0,i={},r={};if("constant"==n.model.marker.color.use)e=null;else{var a=n.model.marker.color.getConceptprops();if("entity_set"==a.concept_type){e=a.domain,i[e]={};var o=n.model.marker.side.getConceptprops();"entity_set"==o.concept_type&&e==o.domain&&n.model.marker.side.which!==n.model.marker.color.which&&n.model.marker.side.setWhich({concept:n.model.marker.color.which})}else e=n.model.marker.color.which}n.STACKDIM!==e&&(r.show=i),r.dim=e;var s=n.SIDEDIM!==n.geoDomainDimension||n.model.marker.color.which===n.model.marker.side.which;if(!s){var l={};l["is--"+n.model.marker.side.which]=!0,n.model.entities_side.set("show",l)}n.model.entities_side.skipFilter=s,n.model.entities.set(r),n.model.entities_geodomain.skipFilter=(e===n.geoDomainDimension||n.SIDEDIM===n.geoDomainDimension)&&(Boolean(n.model.entities.getFilteredEntities().length)||!n.model.entities_side.skipFilter),n.model.entities.set("dim",e),n.model.marker.color.set("which",n.model.marker.color.which)}},"change:marker.side.which":function(t){if(n._readyOnce){var e=void 0,i={},r={};if("constant"==n.model.marker.side.use)e=null;else{var a=n.model.marker.side.getConceptprops();if("entity_set"==a.concept_type){e=a.domain;var o=n.model.marker.color.getConceptprops();"entity_set"==o.concept_type&&e==o.domain&&n.model.marker.color.which!==n.model.marker.side.which&&n.model.marker.color.setWhich({concept:n.model.marker.side.which})}else e=n.model.marker.side.which}n.model.marker.side.clearSideState();var s=e!==n.geoDomainDimension||n.model.marker.color.which===n.model.marker.side.which;s||(i["is--"+n.model.marker.side.which]=!0),n.model.entities_side.skipFilter=s,r.show=i,r.dim=e,n.model.entities_side.set(r),n.model.entities_geodomain.skipFilter=(e===n.geoDomainDimension||n.STACKDIM===n.geoDomainDimension)&&(Boolean(n.model.entities.getFilteredEntities().length)||!n.model.entities_side.skipFilter),n.model.marker.color.which===n.model.marker.side.which&&n.model.entities.clearShow()}},"change:entities.show":function(t){if(n._readyOnce){if(n.model.entities.dim===n.model.entities_side.dim&&!o.isEmpty(n.model.entities_side.show)){var e=n.model.entities_side.getFilteredEntities().filter(function(t){return!n.model.entities.isShown(t)});e.length&&(n.model.marker.side.clearSideState(),n.model.entities_side.showEntity(e))}n.model.entities_geodomain.skipFilter=(n.SIDEDIM===n.geoDomainDimension||n.STACKDIM===n.geoDomainDimension)&&(Boolean(n.model.entities.getFilteredEntities().length)||!n.model.entities_side.skipFilter),n.lockFrame=null}},"change:entities_side.show":function(t){if(n._readyOnce){var e=!1,i=null;if(o.forEach(n.model.marker.side._space,function(t){t.dim===n.model.entities_side.dim&&t._name!==n.model.entities_side._name&&t._name!==n.model.entities_geodomain._name&&(i=t)}),i){var r=n.model.entities_side.getFilteredEntities().filter(function(t){return!i.isShown(t)});r.length&&(i.showEntity(r),e=!0)}n.SIDEDIM!==n.model.entities_side.dim&&(e=!0),e||(n._updateIndicators(),n._updateSideTitles(),n.model._ready&&n.frame&&(n.smallMultiples?o.forEach(n.stackKeys,function(t,e){n._updateLimits(t,e)}):n._updateLimits(),n.resize(),n._updateEntities(!0),n._redrawLocked()))}},"change:entities_age.grouping":function(t){n.groupBy=+n.model.entities_age.grouping||1,n.model.time.step=n.groupBy,n.updateStartEnd(n.model.time.value,n.groupBy),n.model.ui.chart.lockNonSelected=0,n.labels.text(""),n.model.entities_age.clearShow()},"change:ui.chart.inpercent":function(t){n._readyOnce&&(n.smallMultiples?o.forEach(n.stackKeys,function(t,e){n._updateLimits(t,e)}):n._updateLimits(),n.resize(),n._updateEntities(),n._redrawLocked())},"change:ui.chart.flipSides":function(t){n._readyOnce&&(n.model.marker.side.switchSideState(),n._updateIndicators(),n._updateSideTitles(),n.resize(),n._updateEntities(!0),n._redrawLocked())},"change:ui.chart.lockNonSelected":function(t){if(n.lock=n.model.ui.chart.lockNonSelected,n.lock){if(!(n.stackKeys.length<=1||n.stackSkip||n.smallMultiples))return void(n.model.ui.chart.lockNonSelected=0);n.yearLocked.text(" "+n.lock),n.lockFrame={axis_x:n.frameAxisX},n._makeOutlines(n.frameAxisX,n.total)}else n.yearLocked.text(""),n.lockedPaths.text("")}},this._super(t,e),this.textEllipsis=new h(this),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=c("bottom"),this.xAxisLeft=c("bottom"),this.yAxis=c("left"),this.xScales=[],this.SHIFTEDAGEDIM="s_age"},domReady:function(){this._super(),this.graphTemplate=(new XMLSerializer).serializeToString(d3.select(this.element).select(".vzb-bc-graph").node())},updateStartEnd:function(t,e){var i=this.model.time,n=i.formatDate(t),r=+i.formatDate(i.start),a=(+n-r)%e;return a!==i.offset&&(i.set("offset",a),this.timeSteps=i.getAllSteps(),i.set({startSelected:new Date(this.timeSteps[0]),endSelected:new Date(this.timeSteps[this.timeSteps.length-1])},!1,!1),!0)},getTimeOffset:function(t,e){var i=+t.formatDate(t.start);return(+ +t.formatDate(t.value)-i)%e},checkDimensions:function(){var t=this.model.entities.dim,e=this.model.entities_side.dim;this.colorUseConstant="constant"==this.model.marker.color.use,this.stackSkip=this.colorUseConstant||t==e,this.geoLess=t!==this.geoDomainDimension&&e!==this.geoDomainDimension,this.sideSkip="constant"==this.model.marker.side.use},readyOnce:function(){var t=this;this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.textEllipsis.setTooltip(this.element.select(".vzb-bc-tooltip")),this.interaction=this._interaction(),this.geoDomainDimension=this.model.entities_geodomain.getDimension(),this.geoDomainDefaultValue=this.model.entities_geodomain.show[this.geoDomainDimension].$in[0],this.xTitleEl=this.element.select(".vzb-bc-axis-x-title"),this.xInfoEl=this.element.select(".vzb-bc-axis-x-info"),this.yearEl=this.element.select(".vzb-bc-year-now"),this.year=new u(this.yearEl),this.year.setText(this.model.time.formatDate(this.model.time.value)),this.yearLocked=this.element.select(".vzb-bc-year-locked"),this.someSelected=this.model.marker.select.length>0,this.nonSelectedOpacityZero=!1,this.groupBy=+this.model.entities_age.grouping||1,this.on("resize",function(){t._updateEntities(),t._redrawLocked()}),this._attributeUpdaters={_newWidth:function(e,i){var n=void 0;return n=t.geoLess&&t.stackSkip&&t.sideSkip?t.frameAxisX[e[t.AGEDIM]+t.ageShift+","+t.geoDomainDefaultValue]:t.geoLess&&t.stackSkip?t.colorUseConstant||e[t.PREFIXEDSIDEDIM]==e[t.PREFIXEDSTACKDIM]?t.frameAxisX[e[t.PREFIXEDSIDEDIM]+","+(e[t.AGEDIM]+t.ageShift)+","+t.geoDomainDefaultValue]:0:t.geoLess&&t.sideSkip?t.frameAxisX[e[t.PREFIXEDSTACKDIM]+","+(e[t.AGEDIM]+t.ageShift)+","+t.geoDomainDefaultValue]:t.stackSkip?t.colorUseConstant||e[t.PREFIXEDSIDEDIM]==e[t.PREFIXEDSTACKDIM]?t.frameAxisX[e[t.PREFIXEDSIDEDIM]+","+(e[t.AGEDIM]+t.ageShift)]:0:t.sideSkip?t.frameAxisX[e[t.PREFIXEDSTACKDIM]+","+(e[t.AGEDIM]+t.ageShift)]:t.frameAxisX[e[t.PREFIXEDSTACKDIM]+","+e[t.PREFIXEDSIDEDIM]+","+(e[t.AGEDIM]+t.ageShift)],e.width_=n?t.xScale(n):0,t.ui.chart.inpercent&&(e.width_/=t.total[e.i][e[t.PREFIXEDSIDEDIM]]),e.width_},_newX:function(t,e){var i=this.previousSibling;if(i){var n=d3.select(i).datum();t.x_=n.x_+n.width_}return t.x_}}},ready:function(){var t=this;if(this.lock=t.model.ui.chart.lockNonSelected,this.timeSteps=this.model.time.getAllSteps(),1!==this.groupBy&&this.lock&&!this.lockFrame&&!this.model.time.splash){var e=this.model.time.parse(""+this.lock);if(e<this.timeSteps[0]||e>this.timeSteps[this.timeSteps.length-1])return this.timeSaved=this.model.time.value,void this.model.time.set({startSelected:new Date(e),endSelected:new Date(e)},!1,!1)}this.shiftScale=d3.scaleLinear().domain([this.timeSteps[0],this.timeSteps[this.timeSteps.length-1]]).range([0,this.timeSteps.length-1]),this.domains=[],this.SIDEDIM=this.model.entities_side.getDimension(),this.PREFIXEDSIDEDIM="side_"+this.SIDEDIM,this.STACKDIM=this.model.entities.getDimension(),this.PREFIXEDSTACKDIM="stack_"+this.STACKDIM,this.AGEDIM=this.model.entities_age.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.checkDimensions(),this.updateUIStrings(),this._updateIndicators(),this.smallMultiples="smallMultiples"===(this.model.ui.chart||{}).mode&&!this.stackSkip&&this.stackKeys.length>1,this._updateGraphs(this.smallMultiples?this.stackKeys:["undefined"]),this._updateSideTitles(),this.lock&&(this.stackKeys.length<=1||this.stackSkip||this.smallMultiples)?this.yearLocked.text(""+this.lock):t.model.ui.chart.lockNonSelected=0,this.model.ui.chart.set("lockUnavailable",!(this.stackKeys.length<=1||this.stackSkip||this.smallMultiples),!1,!1),this.frame=null,this.model.marker.getFrame(t.model.time.value,function(e,i){t.frame=e,t.frameAxisX=e.axis_x,t.frameColor=e.color;var n={};if(n[i]=e,t.maxLimits={},t.inpercentMaxLimits={},t.totals={},t.smallMultiples?o.forEach(t.stackKeys,function(e,i){t._createLimits(n,e),t._updateLimits(e,i)}):(t._createLimits(n),t._updateLimits()),t.timeSaved){if(t.timeSaved-t.model.time.value!=0){t.lockFrame={axis_x:t.frameAxisX};var r=t.timeSaved;t.timeSaved=null,t.model.time.set({startSelected:new Date(r),endSelected:new Date(r)},!1,!1)}}else t._getLimits(),t.resize(),t._updateEntities(!0),t.updateBarsOpacity()})},_updateGraphs:function(t){var e=this,i=this.element.selectAll(".vzb-bc-graph").data(t);i.exit().remove(),i.enter().append(function(){return this.ownerDocument.importNode((new DOMParser).parseFromString(e.graphTemplate,"application/xml").documentElement,!0)}),this.element.select(".vzb-bc-tooltip").raise(),this.graph=this.element.selectAll(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.xAxisLeftEl=this.graph.select(".vzb-bc-axis-x-left"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.title=this.graph.select(".vzb-bc-title"),this.titleRight=this.graph.select(".vzb-bc-title-right"),this.titleCenter=this.graph.select(".vzb-bc-title-center"),this.barsCrop=this.graph.select(".vzb-bc-bars-crop"),this.lockedCrop=this.graph.select(".vzb-bc-locked-crop"),this.labelsCrop=this.graph.select(".vzb-bc-labels-crop"),this.bars=this.barsCrop.select(".vzb-bc-bars"),this.lockedPaths=this.lockedCrop.select(".vzb-bc-paths"),this.labels=this.labelsCrop.select(".vzb-bc-labels")},_getLimits:function(){var t=this;return function(){var e=t.groupBy;t.model.marker.getFrame(null,function(i){if(i&&e===t.groupBy){var n=1!==t.groupBy&&t.lock&&t.lockFrame?Object.assign(r({},t.model.time.parse(""+t.lock),t.lockFrame),i):i;t.smallMultiples?o.forEach(t.stackKeys,function(e,i){t._createLimits(n,e),t._updateLimits(e,i)}):(t._createLimits(n),t._updateLimits()),t.resize(),t._updateEntities(!0),t.updateBarsOpacity(),t._redrawLocked()}})}()},_redrawLocked:function(){var t=this,e=this;if(this.lock){var i=this.model.time.parse(""+this.lock);if(i<this.timeSteps[0]||i>this.timeSteps[this.timeSteps.length-1]){if(this.lockFrame){var n=void 0;if(this.ui.chart.inpercent&&(n=this._updateTotal(i),!n[0]))return;this._makeOutlines(this.lockFrame.axis_x,n)}}else this.model.marker.getFrame(i,function(n){if(n){e.lockedPaths.text("");var r=void 0;e.ui.chart.inpercent&&(r=t._updateTotal(i),!r[0])||(t.lockFrame={axis_x:n.axis_x},t._makeOutlines(n.axis_x,r))}})}},interpolateDiagonal:function(t,e,i){var n=this,r={},a=void 0,s=void 0,l=void 0,c=void 0,u=void 0,h=this.groupBy,d=this.geoDomainDefaultValue;return this.geoLess&&this.stackSkip&&this.sideSkip?(o.forEach(n.ageKeys,function(n){l=+n+h,u=n+","+d,c=l+","+d,a=t[u],s=e[c]||0,r[c]=null==a||null==s?null:a+(s-a)*i}),c="0,"+d,r[c]=e[c]||0):this.stackSkip&&this.geoLess?o.forEach(n.sideKeys,function(f){o.forEach(n.ageKeys,function(n){l=+n+h,u=f+","+n+","+d,c=f+","+l+","+d,a=t[u],s=e[c]||0,r[c]=null==a||null==s?null:a+(s-a)*i}),c=f+",0,"+d,r[c]=e[c]||0}):this.stackSkip?o.forEach(n.sideKeys,function(d){o.forEach(n.ageKeys,function(n){l=+n+h,u=d+","+n,c=d+","+l,a=t[u],s=e[c]||0,r[c]=null==a||null==s?null:a+(s-a)*i}),c=d+",0",r[c]=e[c]||0}):this.sideSkip&&this.geoLess?o.forEach(n.stackKeys,function(f){o.forEach(n.ageKeys,function(n){l=+n+h,u=f+","+n+","+d,c=f+","+l+","+d,a=t[u],s=e[c]||0,r[c]=null==a||null==s?null:a+(s-a)*i}),c=f+",0,"+d,r[c]=e[c]||0}):this.sideSkip?o.forEach(n.stackKeys,function(d){o.forEach(n.ageKeys,function(n){l=+n+h,u=d+","+n,c=d+","+l,a=t[u],s=e[c]||0,r[c]=null==a||null==s?null:a+(s-a)*i}),c=d+",0",r[c]=e[c]||0}):o.forEach(n.stackKeys,function(d){o.forEach(n.sideKeys,function(f){o.forEach(n.ageKeys,function(n){l=+n+h,u=d+","+f+","+n,c=d+","+f+","+l,a=t[u],s=e[c]||0,r[c]=null==a||null==s?null:a+(s-a)*i}),c=d+","+f+",0",r[c]=e[c]||0})}),r},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=(this.xTitleEl.select("text").text(t.translator("popbyage/title")),this.model.marker.axis_x.getConceptprops());o.setIcon(this.xInfoEl,d).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+r.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()})},_updateIndicators:function(){var t=this,e=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.yAxis.tickFormat(e.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(e.model.marker.axis_x.getTickFormatter()),this.xAxisLeft.tickFormat(e.model.marker.axis_x.getTickFormatter());var i=this.SIDEDIM,n=this.STACKDIM,r=this.AGEDIM,a=this.groupBy,s=this.model.marker.getKeys(r),l=[];l=s.map(function(t){return t[r]}),this.ageKeys=l,this.shiftedAgeKeys=this.timeSteps.map(function(t,e){return-e*a}).slice(1).reverse().concat(l),this.sideItems=this.model.marker.label_side.getItems(!0);var c=[];if(!o.isEmpty(this.sideItems)){var u=!!this.model.marker.side.getEntity().show[i];if(c=this.model.marker.getKeys(i).filter(function(e){return!u||t.model.marker.side.getEntity().isShown(e)}).map(function(t){return t[i]}),c.length>2&&(c.length=2),c.length>1){var h=this.ui.chart.flipSides?d3.ascending:d3.descending;c.sort(h)}}c.length||c.push("undefined"),this.sideKeys=c;var d=this.model.marker.getKeys(n),f=d.map(function(t){return t[n]}),p=o.keys(this.model.marker.color.getPalette()).reduce(function(t,e){return-1!=f.indexOf(e)&&t.push(e),t},[]);p.length!=f.length&&(p=f.reduce(function(t,e){return-1==t.indexOf(e)&&t.push(e),t},p)),this.stackKeys=p,this.stackItems=this.model.marker.label_stack.getItems(),this.stacked=this.ui.chart.stacked&&"constant"!=this.model.marker.color.use&&this.model.entities.getDimension(),this.twoSided=this.sideKeys.length>1,this.twoSided&&(this.xScaleLeft=this.xScale.copy()),this.cScale=this.model.marker.color.getScale(),this.markers=this.model.marker.getKeys(r).sort(function(t,e){return d3.ascending(+t[r],+e[r])})},_updateSideTitles:function(){var t=this,e=this.sideItems;if(this.titleRight.classed("vzb-hidden",!this.twoSided),this.twoSided)this.title.text(e[this.sideKeys[1]]).call(this.textEllipsis.clear),this.titleRight.text(e[this.sideKeys[0]]).call(this.textEllipsis.clear);else{var i=this.sideKeys.length&&e[this.sideKeys[0]]?e[this.sideKeys[0]]:"";this.title.text(i).call(this.textEllipsis.clear)}if(this.smallMultiples)this.titleCenter.call(this.textEllipsis.clear).each(function(e,i){d3.select(this).text(t.stackItems[t.stackKeys[i]])});else{var n=this.stackKeys.length&&this.stackItems[this.stackKeys[0]]&&!this.stackSkip?this.stackItems[this.stackKeys[0]]:"";this.titleCenter.text(n).call(this.textEllipsis.clear)}},_createLimits:function(t,e){var i=this,r=e?[e]:this.stackKeys,a=Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));a.length||a.push("undefined");var s={},l={},c={},u=this.geoLess?","+this.geoDomainDefaultValue:"",h=void 0;a.forEach(function(t){c[t]=[],l[t]=[]}),i.stackSkip&&i.sideSkip?o.forEach(t,function(t,e){var n=t.axis_x;s[e]={};var r=0,d=[];o.forEach(i.ageKeys,function(t){var e=0;h=t+u,n[h]&&(e+=n[h],r+=e),d.push(e)}),s[e][a[0]]=r;var f=Math.max.apply(Math,d);l[a[0]].push(f/r),c[a[0]].push(f)}):i.sideSkip?o.forEach(t,function(t,e){var n=t.axis_x;s[e]={};var d=0,f=[];o.forEach(i.ageKeys,function(t){var e=0;o.forEach(r,function(i){h=i+","+t+u,n[h]&&(e+=n[h],d+=e)}),f.push(e)}),s[e][a[0]]=d;var p=Math.max.apply(Math,f);l[a[0]].push(p/d),c[a[0]].push(p)}):i.stackSkip?o.forEach(t,function(t,e){var n=t.axis_x;s[e]={},o.forEach(a,function(t){var r=0,a=[];o.forEach(i.ageKeys,function(e){var i=0;h=t+","+e+u,n[h]&&(i+=n[h],r+=i),a.push(i)}),s[e][t]=r;var d=Math.max.apply(Math,a);l[t].push(d/r),c[t].push(d)})}):o.forEach(t,function(t,e){var n=t.axis_x;s[e]={},o.forEach(a,function(t){var a=0,d=[];o.forEach(i.ageKeys,function(e){var i=0;o.forEach(r,function(r){h=r+","+t+","+e+u,n[h]&&(i+=n[h],a+=i)}),d.push(i)}),s[e][t]=a;var f=Math.max.apply(Math,d);l[t].push(f/a),c[t].push(f)})}),e?(this.maxLimits[e]={},this.inpercentMaxLimits[e]={},a.forEach(function(t){i.maxLimits[e][t]=Math.max.apply(Math,n(c[t])),i.inpercentMaxLimits[e][t]=Math.max.apply(Math,n(l[t]))}),this.totals[e]=s):(a.forEach(function(t){i.maxLimits[t]=Math.max.apply(Math,n(c[t])),i.inpercentMaxLimits[t]=Math.max.apply(Math,n(l[t]))}),this.totals=s)},_updateLimits:function(t,e){var i=this,r=this.model.marker.axis_x;this.smallMultiples&&t?this.ui.chart.inpercent?this.domains[e]=[0,Math.max.apply(Math,n(this.sideKeys.map(function(e){return i.inpercentMaxLimits[t][e]})))]:this.domains[e]=null!=r.domainMin&&null!=r.domainMax?[+r.domainMin,+r.domainMax]:[0,Math.max.apply(Math,n(this.sideKeys.map(function(e){return i.maxLimits[t][e]})))]:this.ui.chart.inpercent?this.domains[0]=[0,Math.max.apply(Math,n(this.sideKeys.map(function(t){return i.inpercentMaxLimits[t]})))]:this.domains[0]=null!=r.domainMin&&null!=r.domainMax?[+r.domainMin,+r.domainMax]:[0,Math.max.apply(Math,n(this.sideKeys.map(function(t){return i.maxLimits[t]})))],this.xScale.domain(this.domains[0]),this.xScaleLeft&&this.xScaleLeft.domain(this.xScale.domain()),this.domainScalers=this._calcDomainScalers()},_calcDomainScalers:function(){var t=this.domains.map(function(t){return t[1]-t[0]}),e=t.reduce(function(t,e){return t+e});return t.map(function(t){return t/e})},_interpolateBetweenTotals:function(t,e,i){var n=d3.bisectLeft(t,i),r=(i-t[n-1])/(t[n]-t[n-1]),a={};return o.forEach(this.sideKeys,function(i){a[i]=e[t[n]][i]*r+e[t[n-1]][i]*(1-r)}),a},_updateTotal:function(t){var e=this,i={};return this.smallMultiples?o.forEach(this.stackKeys,function(n,r){i[r]=e.totals[n][t]?e.totals[n][t]:e._interpolateBetweenTotals(e.timeSteps,e.totals[n],t)}):i[0]=this.totals[t]?this.totals[t]:this._interpolateBetweenTotals(this.timeSteps,this.totals,t),i},_updateEntities:function(t){var e=this,i=this,n=this.model.time,r=this.SIDEDIM,a=this.PREFIXEDSIDEDIM,o=this.AGEDIM,s=this.STACKDIM,l=this.PREFIXEDSTACKDIM,c=(this.TIMEDIM,n.playing?n.delayAnimations:0),u=this.groupBy;this.ui.chart.inpercent&&(this.total=this._updateTotal(n.value));var h=this.yScale.domain(),d=d3.bisectLeft(this.timeSteps,n.value),f=this.SHIFTEDAGEDIM,p=this.markers.map(function(t){var e={};return e[o]=e[f]=+t[o],e[o]-=d*u,e}),m=p.slice(0),g={};g[f]=p.length*u,g[o]=g[f]-d*u,this.ageShift=d*u,d&&m.push(g);var v=i.stacked?i.stackKeys:[i.geoDomainDefaultValue],b=this.geoDomainDefaultValue,y=this.geoDomainDimension;this.barsData=[];var _=this.bars.selectAll(".vzb-bc-bar").data(function(t,n){return i.barsData[n]=m.map(function(t){var e={};return e[o]=t[o],e[f]=t[f],e.i=n,e}),e.barsData[n]},function(t){return t[o]});_.exit().remove();var x=this.oneBarHeight,w=this.barHeight,S=this.firstBarOffsetY;_=_.enter().append("g").attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[o]}).attr("transform",function(t,e){return"translate(0,"+(S-(t[f]-h[0]-u)*x)+")"}).merge(_);var M=_.selectAll(".vzb-bc-side").data(function(t,e){return t.side=i.sideKeys.map(function(e){var i={};return i[o]=t[o],i[f]=t[f],i[a]=e,i[r]=e,i.i=t.i,i}),t.side},function(t){return t[a]});M.exit().remove(),M=M.enter().append("g").attr("class",function(t,e){return"vzb-bc-side vzb-bc-side-"+(!e!=!i.twoSided?"right":"left")}).attr("transform",function(t,e){return e?"scale(-1,1) translate("+i.activeProfile.centerWidth+",0)":""}).merge(M),t&&M.attr("class",function(t,e){return"vzb-bc-side vzb-bc-side-"+(!e!=!i.twoSided?"right":"left")}).attr("transform",function(t,e){return e?"scale(-1,1) translate("+i.activeProfile.centerWidth+",0)":""});var k=this._attributeUpdaters,E=M.selectAll(".vzb-bc-stack").data(function(t){return t.stack=(i.smallMultiples?[v[t.i]]:v).map(function(e){var i={};return i[y]=b,i[o]=t[o],i[f]=t[f],i[r]=t[r],i[s]=e,i[a]=t[a],i[l]=e,i.x_=0,i.width_=0,i.i=t.i,i}),t.stack},function(t){return t[l]});E.exit().remove(),E=E.enter().append("rect").attr("class",function(t,e){return"vzb-bc-stack vzb-bc-stack-"+e+(i.highlighted?" vzb-dimmed":"")}).attr("y",0).attr("height",w-(u>2?1:0)).attr("fill",function(t){return i.cScale(i.frameColor[t[l]]||t[l])}).attr("x",k._newX).on("mouseover",i.interaction.mouseover).on("mouseout",i.interaction.mouseout).on("click",i.interaction.click).onTap(i.interaction.tap).merge(E),t&&E.attr("class",function(t,e){return"vzb-bc-stack vzb-bc-stack-"+e+(i.highlighted?" vzb-dimmed":"")}).attr("fill",function(t){return i.cScale(i.frameColor[t[l]]||t[l])}).order();var z=m[0][f]-m[0][o]-this.shiftScale(n.value)*u;if(c){var O=d3.transition().duration(c).ease(d3.easeLinear);_.transition(O).attr("transform",function(t,e){return"translate(0,"+(S-(t[f]-h[0]-z)*x)+")"}),E.transition(O).attr("width",k._newWidth).attr("x",k._newX)}else _.interrupt().attr("transform",function(t,e){return"translate(0,"+(S-(t[f]-h[0]-z)*x)+")"}),E.interrupt().attr("width",k._newWidth).attr("x",k._newX);this.ageBars=_,this.sideBars=M,this.stackBars=E,this.entityLabels=this.labels.selectAll(".vzb-bc-label text").data(p),this.entityLabels.exit().remove(),this.entityLabels=this.entityLabels.enter().append("g").attr("class",function(t){return"vzb-bc-label vzb-bc-label-"+t[f]}).append("text").attr("class","vzb-bc-age").merge(this.entityLabels).each(function(t,e){var n=i.translator("popbyage/yearOlds"),r=parseInt(t[f],10);if(u>1){var a=r+u-1;r=r+"-to-"+(a>h[1]?h[1]:a)}t.text=r+n}).attr("y",function(t,e){return S-(t[f]-h[0])*x-10}).attr("dy",function(t,e){return t[f]+u>h[1]?(u-h[1]+t[f])/u*w:0}),this.year.setText(this.model.time.formatDate(n.value),this.duration)},_makeOutlines:function(t,e){var i=this,n=this,r=o.unique(this.model.marker._getAllDimensions({exceptType:"time"}));r.forEach(function(t,e){t===n.AGEDIM&&(r[e]=n.SHIFTEDAGEDIM)});var a=this.groupBy,s=this.barHeight,l=this.firstBarOffsetY+s,c=d3.line().curve(d3.curveStepBefore).x(function(t){return t.x}).y(function(t,e){return l-s*e-(a>2?1:0)}),u=this.barsData.map(function(a,s){var l=[0,0];return i.sideKeys.map(function(i,c){n.stackSkip&&a[0].side[c].stack.forEach(function(t,e){t[n.PREFIXEDSIDEDIM]===t[n.PREFIXEDSTACKDIM]&&(l[c]=e)});var u={};return u.d=a.map(function(i){var a={},u=t[o.getKey(i.side[c].stack[l[c]],r)];return a.x=u?n.xScale(u):0,n.ui.chart.inpercent&&(a.x/=e[s][i.side[c].stack[l[c]][n.PREFIXEDSIDEDIM]]),a}),u})}),h=this.bars.selectAll(".vzb-bc-side-left").selectAll(".vzb-bc-stack-0").data();n.cScale(h[0][this.PREFIXEDSTACKDIM]),this.model.marker.color.getColorShade({colorID:n.frameColor[h[0][this.PREFIXEDSTACKDIM]]||h[0][this.PREFIXEDSTACKDIM],shadeID:"shade"});this.lockedPaths.each(function(t,e){var i=d3.select(this).selectAll("path").data(u[e]);i.exit().remove(),i.enter().append("path").merge(i).attr("d",function(t,e){return c(t.d)}).attr("stroke","#000").attr("transform",function(t,e){return e?"scale(-1,1) translate("+n.activeProfile.centerWidth+",0)":""})})},_setYear:function(t){var e=this.model.time.formatDate(t);return function(){d3.select(this).text(e)}},_interaction:function(){var t=this;return{mouseover:function(e,i){o.isTouchDevice()||(t.model.marker.highlightMarker(e),t._showLabel(e))},mouseout:function(e,i){o.isTouchDevice()||t.model.marker.clearHighlighted()},click:function(e,i){o.isTouchDevice()||t.model.marker.selectMarker(e)},tap:function(e){d3.event.stopPropagation(),t.model.marker.selectMarker(e)}}},_highlightBars:function(t){var e=this;e.someHighlighted=e.model.marker.highlight.length>0,e.updateBarsOpacity(),e.someHighlighted||e.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1)},_showLabel:function(t){var e=this,i=e.ui.chart.inpercent?d3.format(".1%"):e.model.marker.axis_x.getTickFormatter(),n=e.SIDEDIM,r=(e.AGEDIM,e.STACKDIM),a=e.sideKeys.indexOf(t[n])>0,o=7;if(!this.smallMultiples){o+=+d3.select(d3.event.target).attr("x")}var s=e.labels.select(".vzb-bc-label-"+t.s_age).nodes()[t.i],l=d3.select(s);l.selectAll(".vzb-bc-age").text(function(n){var a=e.stackKeys.length>1?e.stackItems[t[r]]:n.text;a=e.twoSided?a:n.text+" "+e.stackItems[t[r]];var o=e.xScale.invert(t.width_);return a+": "+i(o)}).attr("x",a?-this.activeProfile.centerWidth-o:o).attr("dx",0).classed("vzb-text-left",a),l.classed("vzb-prehovered",!0);var c=s.getBBox(),u=e.element.node().getScreenCTM().inverse().multiply(s.getScreenCTM()),h=Math.max(-c.x-u.e,0),d=Math.min(e.fullWidth-c.x-c.width-u.e,0);l.selectAll(".vzb-bc-age").attr("dx",h+d),l.classed("vzb-prehovered",!1),l.classed("vzb-hovered",!0)},getGraphWidth:function(t,e){var i=t||this.width;if(this.smallMultiples){var n=this.graph.data().length;return i-=e*(n-1),this.domainScalers.map(function(t){return i*t})}return[i]},getYAxisVisibility:function(t){return 0==t},presentationProfileChanges:{medium:{margin:{top:120,right:50,left:80,bottom:60,between:30},infoElHeight:32},large:{margin:{top:120,right:70,left:100,bottom:70,between:30},infoElHeight:32}},profiles:{small:{margin:{top:50,right:20,left:40,bottom:20,between:10},infoElHeight:16,centerWidth:2,titlesSpacing:5},medium:{margin:{top:70,right:40,left:60,bottom:20,between:20},infoElHeight:20,centerWidth:2,titlesSpacing:10},large:{margin:{top:80,right:60,left:60,bottom:30,between:20},infoElHeight:22,centerWidth:2,titlesSpacing:20}},resize:function(){var t=this,e=this;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var i=this.activeProfile.margin,n=this.activeProfile.infoElHeight,r=this.sideSkip?.23*i.top:0;if(this.height=parseInt(this.element.style("height"),10)+r-i.top-i.bottom||0,this.width=parseInt(this.element.style("width"),10)-i.left-i.right||0,this.fullWidth=parseInt(this.element.style("width"),10)||0,this.graphWidth=this.getGraphWidth(this.width,i.between),this.height<=0||this.width<=0)return o.warn("Pop by age resize() abort: vizabi container is too little or has display:none");var a=0,s=0,l=this.graphWidth.map(function(t){return s=a,a+=t,s});this.graph.attr("transform",function(t,e){return"translate("+Math.round(i.left+i.between*e+l[e])+","+(i.top-r)+")"}),this.barsCrop.attr("width",function(e,i){return t.graphWidth[i]}).attr("height",Math.max(0,this.height)),this.lockedCrop.attr("width",function(e,i){return t.graphWidth[i]}).attr("height",Math.max(0,this.height)),this.labelsCrop.attr("width",function(e,i){return t.graphWidth[i]}).attr("height",Math.max(0,this.height));var c=this.groupBy,u=this.yScale.domain();this.oneBarHeight=this.height/(u[1]-u[0]);var h=this.barHeight=this.oneBarHeight*c;this.firstBarOffsetY=this.height-this.barHeight,this.stackBars&&this.stackBars.attr("height",h-(c>2?1:0)),this.sideBars&&this.sideBars.attr("transform",function(t,i){return i?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""}),this.yScale.range([this.height,0]);var d=this.yScale.copy();c>2&&(d.ticks=function(){return d3.range(u[0],u[1]+1,c)}),this.yAxisEl.each(function(t,n){e.yAxis.scale(d.range([e.height,0])).tickSizeInner(-e.graphWidth[n]).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-e.graphWidth[n],0).labelerOptions({scaleType:e.model.marker.axis_y.scaleType,toolMargin:i,limitMaxTickNumber:19,fitIntoScale:"optimistic",isPivotAuto:!1}),d3.select(this).attr("transform","translate(0,0)").call(e.yAxis).classed("vzb-bc-axis-text-hidden",!e.getYAxisVisibility(n))}),this.yAxisEl.select(".tick line").classed("vzb-hidden",!0);var f=e.twoSided?.5*(e.graphWidth[0]-e.activeProfile.centerWidth):e.graphWidth[0];this.xScale.range([0,f]);var p=this.ui.chart.inpercent?d3.format(".1%"):this.model.marker.axis_x.getTickFormatter(),m=[];this.xAxisEl.each(function(t,n){var r=e.twoSided?.5*(e.graphWidth[n]-e.activeProfile.centerWidth):e.graphWidth[n];m[n]=e.twoSided?.5*(e.graphWidth[n]+e.activeProfile.centerWidth):0,e.xAxis.scale(e.xScale.copy().domain(e.domains[n]).range([0,r])).tickFormat(p).tickSizeInner(-e.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-e.height,0).labelerOptions({scaleType:e.model.marker.axis_x.scaleType,toolMargin:i,limitMaxTickNumber:6}),d3.select(this).attr("transform","translate("+m[n]+","+e.height+")").call(e.xAxis);var a=d3.select(this).selectAll(".tick text"),o=a.size();if(o>0){var s=a.node().getBBox();o>1&&d3.select(a.node()).attr("dx",(e.twoSided?.5*-e.activeProfile.centerWidth:0)-.5*s.width-s.x),a.classed("vzb-invisible",e.graphWidth[n]+i.between<s.width)}}),this.xAxisEl.select(".tick line").classed("vzb-hidden",!0),this.xAxisLeftEl.classed("vzb-hidden",!this.twoSided),this.twoSided&&(this.xScaleLeft.range([.5*(this.graphWidth[0]-this.activeProfile.centerWidth),0]),this.xAxisLeftEl.each(function(t,n){e.xAxisLeft.scale(e.xScaleLeft.copy().domain(e.domains[n]).range([.5*(e.graphWidth[n]-e.activeProfile.centerWidth),0])).tickFormat(p).tickSizeInner(-e.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-e.height,0).labelerOptions({scaleType:e.model.marker.axis_x.scaleType,toolMargin:i,limitMaxTickNumber:6}),d3.select(this).attr("transform","translate(0,"+e.height+")").call(e.xAxisLeft);var r=d3.select(this).selectAll(".tick").classed("vzb-hidden",!1).nodes();d3.select(r[r.length-1]).classed("vzb-hidden",!0)}));var g=this.model.locale.isRTL();this.bars.attr("transform",function(t,e){return"translate("+m[e]+",0)"}),this.lockedPaths.attr("transform",function(t,e){return"translate("+m[e]+",0)"}),this.labels.attr("transform",function(t,e){return"translate("+m[e]+",0)"});var v=function(i){return m[i]-t.activeProfile.titlesSpacing<0?.5*e.activeProfile.centerWidth:e.activeProfile.titlesSpacing};if(this.title.attr("x",function(i,n){return t.twoSided?m[n]-.5*e.activeProfile.centerWidth-v(n):0}).style("text-anchor",this.twoSided?"end":"").attr("y",.275*-i.top-r).each(function(t,n){e.textEllipsis.wrap(this,e.twoSided?.5*(e.graphWidth[n]+i.between-v(n)):e.graphWidth[n]+i.between)}),this.titleRight.attr("x",function(t,i){return m[i]-.5*e.activeProfile.centerWidth+v(i)}).attr("y",.275*-i.top-r).each(function(t,n){e.textEllipsis.wrap(this,.5*(e.graphWidth[n]+i.between-v(n)))}),this.titleCenter.attr("x",function(i,n){return t.twoSided?m[n]-.5*e.activeProfile.centerWidth:.5*e.graphWidth[n]}).style("text-anchor","middle").attr("y",.035*(-i.top-r)).each(function(t,n){e.textEllipsis.wrap(this,e.graphWidth[n]+i.between)}),this.xTitleEl.style("font-size",n+"px").attr("transform","translate("+(g?i.left+this.width+.6*i.right:.4*i.left)+","+.35*i.top+")"),this.xInfoEl.select("svg").node()){var b=this.xTitleEl.node().getBBox(),y=o.transform(this.xTitleEl.node()),_=g?b.x+y.translateX-1.4*n:b.x+y.translateX+b.width+.4*n;this.xInfoEl.select("svg").attr("width",n+"px").attr("height",n+"px"),this.xInfoEl.attr("transform","translate("+_+","+(y.translateY-.8*n)+")")}var x={topOffset:this.ui.presentation?25:"small"===this.getLayoutProfile()?10:15,leftOffset:"small"===this.getLayoutProfile()?5:10,rightOffset:"small"===this.getLayoutProfile()?5:10,xAlign:g?"left":"right",yAlign:"top",heightRatio:(this.ui.presentation,.5)};this.year.setConditions(x).resize(this.fullWidth,i.top),this.yearLocked.attr("x",this.width+i.left+i.right-10).attr("y",(i.top-r)*(this.getLayoutProfile(),1.27))},updateBarsOpacity:function(t){var e=this,i=this.model.marker.opacityHighlightDim,n=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim,a=e.model.marker.opacitySelectDim<.01,o=a!=this.nonSelectedOpacityZero,s=this.someSelected,l=this.someHighlighted;this.stackBars.each(function(t){var c=!!s&&e.model.marker.isSelected(t),u=!!l&&e.model.marker.isHighlighted(t),h=d3.select(this);h.style("opacity",u?1:s?c?1:r:l?i:n).style("stroke",c?"#333":null).style("y",c?"0.5px":null),o&&h.style("pointer-events",s&&a&&!c?"none":"visible")}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=f},function(t,e){},function(t,e){t.exports='\x3c!-- PopByAge Component --\x3e\n<svg class="vzb-popbyage">\n    <g class="vzb-bc-header">\n        <g class="vzb-bc-axis-x-title">\n            <text></text>\n        </g>\n        <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n        <g class="vzb-bc-year-now"></g>\n        <text class="vzb-bc-year vzb-bc-year-locked"></text>\n    </g>\n    <g class="vzb-bc-graph">\n        <text class="vzb-bc-title"></text>\n        <text class="vzb-bc-title vzb-bc-title-right"></text>\n        <text class="vzb-bc-title vzb-bc-title-center"></text>\n\n        <g class="vzb-bc-axis-y-title"></g>\n\n        <g class="vzb-bc-axis-y"></g>\n\n        <svg class="vzb-bc-bars-crop">\n            <g class="vzb-bc-bars"></g>\n        </svg>\n        \n        <svg class="vzb-bc-locked-crop">\n            <g class="vzb-bc-paths"></g>\n        </svg>\n\n        <g class="vzb-bc-axis-x"></g>\n        <g class="vzb-bc-axis-x vzb-bc-axis-x-left"></g>\n\n        <svg class="vzb-bc-labels-crop">\n            <g class="vzb-bc-labels"></g>\n        </svg>\n\n        <g class="vzb-bc-axis-labels">\n            \x3c!-- <text class="vzb-x_label">Lifespan</text>\n                  <text class="vzb-y_label">Lifespan</text> --\x3e\n        </g>\n    </g>\n    <g class="vzb-bc-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n    </g>\n</svg>\n'},function(t,e,i){t.exports=i(0)}])},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./BarRankChart.json":41,"./BubbleChart.json":42,"./BubbleMap.json":43,"./LineChart.json":44,"./MountainChart.json":45,"./PopByAge.json":46};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=40},function(t,e){t.exports="/tools/assets/js/toolconfigs/BarRankChart.js"},function(t,e){t.exports="/tools/assets/js/toolconfigs/BubbleChart.js"},function(t,e){t.exports="/tools/assets/js/toolconfigs/BubbleMap.js"},function(t,e){t.exports="/tools/assets/js/toolconfigs/LineChart.js"},function(t,e){t.exports="/tools/assets/js/toolconfigs/MountainChart.js"},function(t,e){t.exports="/tools/assets/js/toolconfigs/PopByAge.js"},function(t,e,i){"use strict";e.a=[{id:"bubbles",tool:"BubbleChart",title:"bubbles",image:"/assets/images/chart/bubble-chart.png"},{id:"mountain",tool:"MountainChart",title:"income",image:"/assets/images/chart/income-chart.png"},{id:"map",tool:"BubbleMap",title:"maps",image:"/assets/images/chart/maps-chart.png"},{id:"linechart",tool:"LineChart",title:"trends",image:"/assets/images/chart/trends-chart.png"},{id:"barrank",tool:"BarRankChart",title:"ranks",image:"/assets/images/chart/ranks-chart.png"},{id:"popbyage",tool:"PopByAge",title:"ages",image:"/assets/images/chart/ages-chart.png"},{id:"bubblechart-basic",tool:"BubbleChart",config:"BubbleChart-basic",image:"/assets/images/chart/bubble-chart.png"},{id:"bubblechart-sod",tool:"BubbleChart",config:"BubbleChart-sodertorn",image:"/assets/images/chart/bubble-chart.png"},{id:"dollar-street",url:"http://www.gapminder.org/dollar-street",image:"/assets/images/chart/dollar-street.png",title:"dollar_street"}]},function(t,e,i){"use strict";e.a=[{toolIds:["bubbles","mountain","map","linechart","barrank"],datasource:{reader:"waffle",assetsPath:"https://import-waffle-server-dev.gapminderdev.org/api/ddf/assets/",path:"https://waffle-server-dev.gapminderdev.org/api/ddf/ql"}},{toolIds:["popbyage"],datasource:{reader:"waffle",assetsPath:"https://import-waffle-server-dev.gapminderdev.org/api/ddf/assets/",path:"https://waffle-server-dev.gapminderdev.org/api/ddf/ql",dataset:"open-numbers/ddf--gapminder--population"}},{toolIds:["bubblechart-sod"],datasource:{reader:"waffle",assetsPath:"https://import-waffle-server-stage.gapminder.org/api/ddf/assets/",path:"https://waffle-server-stage.gapminder.org/api/ddf/ql",dataset:"open-numbers/ddf--sodertornsmodellen"}},{toolIds:["bubblechart1","bubblechart-basic"],datasource:{reader:"csv",path:"data/basic.csv"}}]}]),[28]);
//# sourceMappingURL=tools.js.map