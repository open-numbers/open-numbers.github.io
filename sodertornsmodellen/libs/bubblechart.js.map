{"version":3,"sources":["webpack:///webpack/bootstrap d5a674c92a6e7cb53203","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/panzoom.js","webpack:///./src/trail.js","webpack:///./~/css.escape/css.escape.js","webpack:///./src/styles.scss?ccec","webpack:///./src/template.html","webpack:///(webpack)/buildin/global.js"],"names":["VERSION_INFO","version","build","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","validate","ui","chart","lockNonSelected","splash","state","time","parse","start","formatDate","end","default_model","entities","entities_colorlegend","entities_tags","marker_tags","space","label","use","which","hook_parent","marker","axis_x","index","type","axis_y","size","color","syncModels","size_label","scaleType","_important","extent","allow","names","locale","superhighlightOnMinimapHover","whenHovering","showProjectionLineX","showProjectionLineY","higlightValueX","higlightValueY","labels","dragging","removeLabelBox","margin","left","top","trails","datawarning","doubtDomain","doubtRange","show_ticks","presentation","panWithArrow","adaptMinMaxZoom","cursorMode","zoomOnScrolling","buttons","dialogs","popup","sidebar","moreoptions","versionInfo","utils","helpers","Exporter","svgexport","Labels","axisSmart","DynamicBackground","iconset","iconWarn","warn","iconQuestion","question","BubbleChart","config","context","_this","template","require","model_expects","model_binds","evt","original","isTouchDevice","playing","someHighlighted","clearHighlighted","_readyOnce","filter","hook","dim","length","ready","_trails","create","then","run","record","_export","open","element","reset","toggle","redrawDataPoints","path","indexOf","yScale","xScale","updateSize","updateMarkerSizeLimits","draggingNow","approxEqual","_zoomedXYMinMax","zoomedMin","zoomedMax","playAfterZoom","pause","_panZoom","zoomToMaxMin","getZoomedMin","getZoomedMax","postponePause","entityBubbles","source","_val","_previousVal","selectDataPoints","updateBubbleOpacity","_updateDoubtOpacity","_blinkSuperHighlighted","titles","_formatSTitleValues","_updateSTitle","highlightDataPoints","calculationQueue","value","toString","push","getFrame","frame","_frameIsValid","splice","frameChanged","expandCanvas","redrawDataPointsOnlySize","redrawDataPointsOnlyColors","svg","chartSvg","classed","someSelected","clearSelected","sScale","cScale","xAxis","yAxis","COLOR_BLACKISH","COLOR_WHITEISH","isCanvasPreviouslyExpanded","prefix","deleteClasses","_labels","CSS_PREFIX","LABELS_CONTAINER_CLASS","LINES_CONTAINER_CLASS","LINES_CONTAINER_SELECTOR_PREFIX","_rangeBump","arg","undo","bump","activeProfile","maxRadiusPx","isArray","z1","z2","readyOnce","scrollableAncestor","findScrollableAncestor","d3","select","graph","yAxisElContainer","yAxisEl","xAxisElContainer","xAxisEl","ySubTitleEl","xSubTitleEl","yTitleEl","xTitleEl","sTitleEl","cTitleEl","yearEl","year","yInfoEl","xInfoEl","dataWarningEl","projectionX","projectionY","lineEqualXY","trailsContainer","bubbleContainerCrop","zoomSelection","labelsContainerCrop","bubbleContainer","labelsContainer","linesContainer","zoomRect","eventArea","bubbleCrown","selectAll","attr","location","pathname","tooltipMobile","on","xMin","xMax","yMin","yMax","zoomer","dontFeedToState","rerun","event","metaKey","ctrlKey","root","call","dragRectangle","cursor","defaultPrevented","zoomByIncrement","TIMEDIM","getDimension","KEYS","unique","_getAllDimensions","exceptType","KEY","join","dataKeys","getDataKeysPerHook","labelNames","getLabelHookNames","updateUIStrings","wScale","scaleLinear","domain","range","Object","keys","endTime","updateIndicators","updateTime","defer","updateEntities","zoomToMarkerMaxMin","resetZoomState","xDomain","getScale","yDomain","zoomedMinX","zoomedMaxX","zoomedMinY","zoomedMaxY","setScales","tickFormat","getTickFormatter","duration","_reorderEntities","_getSubtitle","title","shortTitle","subtitle","replace","slice","regexpResult","exec","trim","layoutProfile","getLayoutProfile","conceptPropsY","getConceptprops","conceptPropsX","conceptPropsS","conceptPropsC","translator","getTFunction","strings","Y","X","S","C","title_short","name_short","unit","ySubTitle","data","enter","append","xSubTitle","yTitle","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","xTitle","sTitle","setIcon","text","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","getBoundingClientRect","chartRect","node","setHook","show","setPos","hide","opacity","getKeys","map","pointer","assign","d","sortValue","getKey","sort","a","b","markers","setVisible","unselectBubblesWithNoData","getVisible","exit","remove","i","_bubblesInteract","mouseover","mouseout","click","onTap","stopPropagation","onLongTap","merge","_select","forEach","sizeA","sizeB","descending","ascending","trailStartTime","status","highlightMarker","showCloseCross","isSelected","selectMarker","time_1","delayAnimations","setText","svgWidth","px2num","svgHeight","marginScaleH","marginMin","ratio","marginScaleW","profiles","small","bottom","right","leftMarginRatio","padding","minRadiusPx","maxRadiusEm","infoElHeight","yAxisTitleBottomMargin","xAxisTitleBottomMargin","medium","large","hideSTitle","presentationProfileChanges","getActiveProfile","containerWH","getVizWidthHeight","Math","max","hypotenuse","width","setCloseCrossHeight","setTooltipFontSize","parseInt","resize","rangePoints","scale","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","viewportLength","formatter","yTitleText","xTitleText","titleBBox","t","transform","hTranslate","translateX","vTranslate","translateY","_resizeDataWarning","set","_updateLineEqualXY","oneMeasure","min","concat","transition","dataWarningText","dataWarningWidth","remainingWidth","font","warnBB","minRadius","maxRadius","minArea","radiusToArea","maxArea","valuesNow","valuesLocked","each","selected","valueC","scaledC","find","f","valuesTrailStart","cache","scaledC0","updateLabelOnlyColor","valueS","scaledS","areaToRadius","scaledS0","updateLabelOnlyPosition","lockedFrame","_updateBubble","values","view","showhide","valueY","valueX","valueL","valueLST","hidden","ease","easeExp","easeLinear","interrupt","write","id","getUTCFullYear","fill","cx","cy","r","_updateLabel","labelX0","labelY0","labelText","_getLabelText","updateLabel","key","_setTooltip","tooltipText","s","c","labelValues","tooltipCache","invert","setTooltip","titleS","titleC","unitS","unitC","formatterS","formatterC","isDiscrete","getColorlegendMarker","getItems","sTitleContentON","cTitleContentON","sTitleText","sTitleWidth","remainigHeight","_setBubbleCrown","nonSelectedOpacityZero","glow","skipInnerFill","_axisProjections","radius","highlightValue","highlight","clone","entityOutOfView","hoverTrail","selectedData","target","skipCrownInnerFill","clonedSelectedData","isSuperHighlighted","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","PanZoom","Class","drag","zoom","subject","dragSubject","go","stop","zoomFilter","scaleExtent","Infinity","ratioX","ratioY","self","sourceEvent","touches","targetTouches","mouse","origin","abs","e","compensateDragging","_zoomOnRectangle","_data","k","pan","isNaN","deltaY","wheelDelta","minZoomScale","zoomXOut","zoomYOut","property","zoomIdentity","translate","xPanOffset","yPanOffset","xRange","yRange","xRangeBumped","yRangeBumped","xRangeMinOffset","xRangeMaxOffset","yRangeMinOffset","yRangeMaxOffset","xRangeBounds","yRangeBounds","xRangeBoundsBumped","yRangeBoundsBumped","rangeBands","n","isDate","toFixed","zoomedXRange","zoomedYRange","optionsY","optionsX","transitionDuration","mmX","mmY","suggestedFrame","x1","y1","x2","y2","xBounds","yBounds","TOLERANCE","xBoundsBumped","yBoundsBumped","minX","maxX","minY","maxY","zoomedX1","zoomedY1","zoomedX2","zoomedY2","zoomTransform","minZoom","maxZoom","direction","log","LN2","floor","ceil","locus","pow","scaleBy","Trail","_isCreated","actionsQueue","entityTrails","trailsData","trailsInProgress","activePromises","trailTransitions","delayedIterations","drawingQueue","_context","selection","Promise","resolve","reject","timePoints","getAllSteps","promises","_clearActions","selectedEntityData","insert","querySelector","trail","trailSegmentData","m","segment","getModelObject","trigger","all","_addActions","selections","actions","promise","_getNextAction","shift","action","pop","executeSequential","response","_remove","parentNode","_resize","transparent","next","lineLength","sqrt","_recolor","strokeColor","getColorShade","colorID","shadeID","_opacityHandler","_findVisible","resolve1","reject1","limits","getEntityLimits","cached","segmentVisibility","visibilityChanged","_groups","_abortAnimation","_reveal","delay","generateTrailSegment","nextIndex","level","datum","nextSegment","previous","nextTime","nextFrame","addNewIntervals","addPointBetween","previousIndex","previousSegment","firstLineLength","secondLineLength","mediumIndex","getPointBetween","first","round","_generateKeys","div","maxValue","minValue","__data__","unshift","processPoints","processPoint","pointIndex","random","point","JSON","stringify","generateTrails","processPointsBetween","framesAreReady","trailKeys","segments"],"mappings":"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Ad;AACD;AACD+R,gBAAQgB,GAAR,CAAYuE,QAAZ,EAAsBrnB,IAAtB,CAA2B,YAAM;AAC/B,cAAIwJ,OAAOC,IAAP,CAAY5K,MAAM6iB,iBAAN,CAAwBvS,EAAEtG,GAAF,CAAxB,CAAZ,EAA6CjJ,MAA7C,IAAuD,CAA3D,EAA8D;AAC5DmiB;AACD,WAFD,MAEO;AACLljB,kBAAM8iB,YAAN,CAAmBxS,EAAEtG,GAAF,CAAnB,IAA6BhK,MAAM6iB,iBAAN,CAAwBvS,EAAEtG,GAAF,CAAxB,CAA7B;AACAhK,kBAAM6iB,iBAAN,CAAwBvS,EAAEtG,GAAF,CAAxB,IAAkC,EAAlC;AACAqe;AACD;AACF,SARD,EAQG,YAAM;AACPnF;AACD,SAVD;AAWD;AACF,KAxDM,CAAP;AAyDD;AArwB+B,CAApB,CAAd;;kBAwwBeb,K;;;;;;AC7wBf;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC;;;;;;;;ACzGD,yC;;;;;;ACAA,8rE;;;;;;ACAA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C","file":"bubblechart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d5a674c92a6e7cb53203","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\nexport default Vizabi.Tool.extend(\"BubbleChart\", {\n\n  /**\n   * Initializes the tool (Bubble Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"bubblechart\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    this._super(placeholder, external_model);\n\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    if (model.ui.chart.lockNonSelected && (!model.ui.splash || model.state.time.splash === false)) {\n      const time = model.state.time.parse(\"\" + model.ui.chart.lockNonSelected);\n      if (time < model.state.time.start) model.ui.chart.lockNonSelected = model.state.time.formatDate(model.state.time.start);\n      if (time > model.state.time.end) model.ui.chart.lockNonSelected = model.state.time.formatDate(model.state.time.end);\n    }\n  },\n\n  /**\n   * Determines the default model of this tool\n   */\n  default_model: {\n    state: {\n      time: {\n        \"autoconfig\": {\n          \"type\": \"time\"\n        }\n      },\n      entities: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      entities_colorlegend: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      entities_tags: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"includeOnlyIDs\": [\"tag\"]\n        }\n      },\n      marker_tags: {\n        space: [\"entities_tags\"],\n        label: {\n          use: \"property\",\n          which: \"name\"\n        },\n        hook_parent: {}\n      },\n      marker: {\n        space: [\"entities\", \"time\"],\n        axis_x: {\n          use: \"indicator\",\n          \"autoconfig\": {\n            index: 0,\n            type: \"measure\"\n          }\n        },\n        axis_y: {\n          use: \"indicator\",\n          \"autoconfig\": {\n            index: 1,\n            type: \"measure\"\n          }\n        },\n        label: {\n          use: \"property\",\n          \"autoconfig\": {\n            \"includeOnlyIDs\": [\"name\"],\n            \"type\": \"string\"\n          }\n        },\n        size: {\n          \"autoconfig\": {\n              index: 2,\n              type: \"measure\"\n            }\n        },\n        color: {\n          syncModels: [\"marker_colorlegend\"],\n          \"autoconfig\": {}\n        },\n        size_label: {\n          use: \"constant\",\n          which: \"_default\",\n          scaleType: \"ordinal\",\n          _important: false,\n          extent: [0, 0.33],\n          allow: {\n            names: [\"_default\"]\n          }\n        },\n      },\n      \"marker_colorlegend\": {\n        \"space\": [\"entities_colorlegend\"],\n        \"label\": {\n          \"use\": \"property\",\n          \"which\": \"name\"\n        },\n        \"hook_rank\": {\n          \"use\": \"property\",\n          \"which\": \"rank\"\n        },\n        \"hook_geoshape\": {\n          \"use\": \"property\",\n          \"which\": \"shape_lores_svg\"\n        }\n      }\n    },\n    locale: {},\n    ui: {\n      chart: {\n        superhighlightOnMinimapHover: true,\n        whenHovering: {\n          showProjectionLineX: true,\n          showProjectionLineY: true,\n          higlightValueX: true,\n          higlightValueY: true\n        },\n        labels: {\n          dragging: true,\n          removeLabelBox: false\n        },\n        margin: {\n          left: 0,\n          top:0\n        },\n        trails: true,\n        lockNonSelected: 0\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      show_ticks: true,\n      presentation: false,\n      panWithArrow: false,\n      adaptMinMaxZoom: false,\n      cursorMode: \"arrow\",\n      zoomOnScrolling: false,\n      buttons: [\"colors\", \"find\", \"zoom\", \"trails\", \"lock\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      dialogs: {\n        popup: [\"colors\", \"find\", \"size\", \"zoom\", \"moreoptions\"],\n        sidebar: [\"colors\", \"find\", \"size\", \"zoom\"],\n        moreoptions: [\"opacity\", \"speed\", \"axes\", \"size\", \"colors\", \"label\", \"zoom\", \"presentation\", \"about\"]\n      }\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const { utils } = Vizabi;\n\nconst {\n  svgexport: Exporter,\n  labels: Labels,\n  'd3.axisWithLabelPicker': axisSmart,\n  'd3.dynamicBackground': DynamicBackground\n} = Vizabi.helpers;\n\nconst {\n  warn: iconWarn,\n  question: iconQuestion\n} = Vizabi.iconset;\n\nimport Trail from './trail';\nimport PanZoom from './panzoom';\n\n\n// BUBBLE CHART COMPONENT\nconst BubbleChart = Vizabi.Component.extend(\"bubblechart\", {\n\n  /**\n   * Initializes the component (Bubble Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    const _this = this;\n    this.name = \"bubblechart\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    this.model_binds = {\n      \"change:time.playing\": function(evt, original) {\n        if (utils.isTouchDevice() && _this.model.time.playing && _this.someHighlighted) {\n          _this.model.marker.clearHighlighted();\n        }\n      },\n      \"change:time.start\": function(evt, original) {\n        if (!_this._readyOnce || _this.model.time.splash) return;\n        if ([\"color\", \"axis_x\", \"axis_y\"].filter(hook => _this.model.marker[hook].which == _this.model.time.dim).length) {\n          _this.ready();\n          return;          \n        };\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n      },\n      \"change:time.end\": function(evt, original) {\n        if (!_this._readyOnce || _this.model.time.splash) return;\n        if ([\"color\", \"axis_x\", \"axis_y\"].filter(hook => _this.model.marker[hook].which == _this.model.time.dim).length) {\n          _this.ready();\n          return;          \n        };\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n      },\n      \"change:time.record\": function() {\n        //console.log(\"change time record\");\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:ui.chart.trails\": function(evt) {\n        //console.log(\"EVENT change:time:trails\");\n        if (!_this._readyOnce) return;\n        _this._trails.toggle(_this.model.ui.chart.trails);\n        _this.redrawDataPoints();\n      },\n      \"change:ui.chart.lockNonSelected\": function(evt) {\n        if (!_this._readyOnce) return;\n        //console.log(\"EVENT change:time:lockNonSelected\");\n        _this.redrawDataPoints(500);\n      },\n      \"change:marker\": function(evt, path) {\n        // bubble size change is processed separately\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n\n        if (path.indexOf(\"marker.color\") !== -1) return;\n        if (path.indexOf(\"marker.size\") !== -1) return;\n        if (path.indexOf(\"marker.size_label\") !== -1) return;\n\n        if (path.indexOf(\"domainMin\") > -1 || path.indexOf(\"domainMax\") > -1) {\n          if (!_this.yScale || !_this.xScale) return; //abort if building of the scale is in progress\n          _this.updateSize();\n          _this.updateMarkerSizeLimits();\n          _this._trails.run(\"findVisible\");\n          _this.redrawDataPoints();\n          _this._trails.run(\"resize\", null, 500);\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          if (_this.draggingNow) return;\n\n          //avoid zooming again if values didn't change.\n          //also prevents infinite loop on forced URL update from zoom.stop()\n          if (utils.approxEqual(_this._zoomedXYMinMax.axis_x.zoomedMin, _this.model.marker.axis_x.zoomedMin, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_x.zoomedMax, _this.model.marker.axis_x.zoomedMax, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_y.zoomedMin, _this.model.marker.axis_y.zoomedMin, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_y.zoomedMax, _this.model.marker.axis_y.zoomedMax, 0.01)\n          ) return;\n          let playAfterZoom = false;\n          if (_this.model.time.playing) {\n            playAfterZoom = true;\n            _this.model.time.pause(true);\n          }\n          _this._trails.run(\"abortAnimation\");\n          _this._panZoom.zoomToMaxMin(\n            _this.model.marker.axis_x.getZoomedMin(),\n            _this.model.marker.axis_x.getZoomedMax(),\n            _this.model.marker.axis_y.getZoomedMin(),\n            _this.model.marker.axis_y.getZoomedMax(),\n            500 /*duration*/, \"don't feed these zoom values back to state\"\n          );\n          if (playAfterZoom) {\n            _this.model.time.postponePause = false;\n          }\n        }\n\n        //console.log(\"EVENT change:marker\", evt);\n      },\n      \"change:marker.select\": function(evt, path) {\n        if (!_this._readyOnce || !_this.entityBubbles) return;\n        //console.log(\"EVENT change:marker:select\");\n\n        //disable trails if too many items get selected at once\n        //otherwise it's too much waiting time\n        if ((evt.source._val || []).length - (evt.source._previousVal || []).length > 50) _this.model.ui.chart.trails = false;\n\n        _this.selectDataPoints();\n        _this.redrawDataPoints();\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n        _this.updateBubbleOpacity();\n        _this._updateDoubtOpacity();\n      },\n      \"change:marker.superHighlight\": (evt, path) => {\n        if (this._readyOnce) {\n          this._blinkSuperHighlighted();\n        }\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        //path have values if trail is highlighted\n        if (path != \"highlight\") {\n          if (path !== null) {\n            const titles = _this._formatSTitleValues(path.size, path.color);\n            _this._updateSTitle(titles[0], titles[1]);\n          } else {\n            _this._updateSTitle();\n          }\n          return;\n        }\n        //console.log(\"EVENT change:marker:highlight\");\n        _this.highlightDataPoints();\n      },\n      \"change:time.value\": function() {\n        if (_this.model.time.splash || !_this._readyOnce || !_this.entityBubbles) return;\n        if (!_this.calculationQueue) { // collect timestamp that we request\n          _this.calculationQueue = [_this.model.time.value.toString()];\n        } else {\n          _this.calculationQueue.push(_this.model.time.value.toString());\n        }\n        (function(time) { // isolate timestamp\n          //_this._bubblesInteract().mouseout();\n          _this.model.marker.getFrame(time, (frame, time) => {\n            if (!_this._frameIsValid(frame)) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n            const index = _this.calculationQueue.indexOf(time.toString()); //\n            if (index == -1) { // we was receive more recent frame before so we pass this frame\n              return;\n            }\n            _this.calculationQueue.splice(0, index + 1); // remove timestamps that added to queue before current timestamp\n            _this.frameChanged(frame, time);\n          });\n\n        })(_this.model.time.value);\n      },\n      \"change:ui.adaptMinMaxZoom\": function() {\n        //console.log(\"EVENT change:ui:adaptMinMaxZoom\");\n        if (_this.model.ui.adaptMinMaxZoom) {\n          _this._panZoom.expandCanvas(500);\n        } else {\n          _this._panZoom.reset();\n        }\n      },\n      \"change:marker.size.extent\": function(evt, path) {\n        //console.log(\"EVENT change:marker:size:max\");\n        if (!_this._readyOnce) return;\n        _this.updateMarkerSizeLimits();\n        _this.redrawDataPointsOnlySize();\n        _this._trails.run(\"resize\");\n      },\n      \"change:marker.color\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        //console.log(\"EVENT change:marker:color:palette\");\n        _this.redrawDataPointsOnlyColors();\n        _this._trails.run(\"recolor\");\n      },\n      // 'change:marker.color.palette': function(evt, path) {\n      //   if(!_this._readyOnce) return;\n      //   //console.log(\"EVENT change:marker:color:palette\");\n      //   _this.redrawDataPointsOnlyColors();\n      //   _this._trails.run(\"recolor\");\n      // },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBubbleOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBubbleOpacity();\n        _this._trails.run(\"opacityHandler\");\n      },\n      \"change:ui.cursorMode\": function() {\n        const svg = _this.chartSvg;\n        if (_this.model.ui.cursorMode === \"plus\") {\n          svg.classed(\"vzb-zoomin\", true);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", false);\n        } else if (_this.model.ui.cursorMode === \"minus\") {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", true);\n          svg.classed(\"vzb-panhand\", false);\n        } else if (_this.model.ui.cursorMode === \"hand\") {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", true);\n        } else {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", false);\n        }\n      },\n      \"change:marker.space\": function() {\n        if (_this.someHighlighted) {\n          _this.model.marker.clearHighlighted();\n        }\n        if (_this.someSelected) {\n          _this.model.marker.clearSelected();\n        }\n      },\n      \"ready\": function() {\n        // if(_this.model.marker.color.scaleType === 'time') {\n        //   _this.model.marker.color.scale = null;\n        //   utils.defer(function() {\n        //     _this.trigger('ready');\n        //   });\n        // }\n      }\n    };\n\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.sScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n\n    _this.COLOR_BLACKISH = \"#333\";\n    _this.COLOR_WHITEISH = \"#fdfdfd\";\n\n    this.isCanvasPreviouslyExpanded = false;\n    this.draggingNow = null;\n\n    this._trails = new Trail(this);\n    this._panZoom = new PanZoom(this);\n    this._export = new Exporter(this);\n    this._export\n      .prefix(\"vzb-bc-\")\n      .deleteClasses([\"vzb-bc-bubbles-crop\", \"vzb-hidden\", \"vzb-bc-year\", \"vzb-bc-zoom-rect\",\n        \"vzb-bc-projection-x\", \"vzb-bc-projection-y\", \"vzb-bc-axis-c-title\"\n      ]);\n    this._labels = new Labels(this);\n    this._labels.config({\n      CSS_PREFIX: \"vzb-bc\",\n      LABELS_CONTAINER_CLASS: \"vzb-bc-labels\",\n      LINES_CONTAINER_CLASS: \"vzb-bc-bubbles\",\n      LINES_CONTAINER_SELECTOR_PREFIX: \"bubble-\"\n    });\n  },\n\n  _rangeBump(arg, undo) {\n    const bump = this.activeProfile.maxRadiusPx / 2;\n    undo = undo ? -1 : 1;\n    if (utils.isArray(arg) && arg.length > 1) {\n      let z1 = arg[0];\n      let z2 = arg[arg.length - 1];\n\n      //the sign of bump depends on the direction of the scale\n      if (z1 < z2) {\n        z1 += bump * undo;\n        z2 -= bump * undo;\n        // if the scale gets inverted because of bump, set it to avg between z1 and z2\n        if (z1 > z2) z1 = z2 = (z1 + z2) / 2;\n      } else if (z1 > z2) {\n        z1 -= bump * undo;\n        z2 += bump * undo;\n        // if the scale gets inverted because of bump, set it to avg between z1 and z2\n        if (z1 < z2) z1 = z2 = (z1 + z2) / 2;\n      } else {\n        // rangeBump error: the input scale range has 0 length. that sucks but we keep cool\n      }\n      return [z1, z2];\n    }\n    utils.warn(\"rangeBump error: input is not an array or empty\");\n  },\n\n\n  /**\n   * Executes right after the template is in place, but the model is not yet ready\n   */\n  readyOnce() {\n    const _this = this;\n    this._readyOnce = false;\n    this.scrollableAncestor = utils.findScrollableAncestor(this.element);\n    this.element = d3.select(this.element);\n\n    // reference elements\n    this.chartSvg = this.element.select(\"svg\");\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisElContainer = this.graph.select(\".vzb-bc-axis-y\");\n    this.yAxisEl = this.yAxisElContainer.select(\"g\");\n\n    this.xAxisElContainer = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisEl = this.xAxisElContainer.select(\"g\");\n\n    this.ySubTitleEl = this.graph.select(\".vzb-bc-axis-y-subtitle\");\n    this.xSubTitleEl = this.graph.select(\".vzb-bc-axis-x-subtitle\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.xTitleEl = this.graph.select(\".vzb-bc-axis-x-title\");\n    this.sTitleEl = this.graph.select(\".vzb-bc-axis-s-title\");\n    this.cTitleEl = this.graph.select(\".vzb-bc-axis-c-title\");\n    this.yearEl = this.graph.select(\".vzb-bc-year\");\n\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.yInfoEl = this.graph.select(\".vzb-bc-axis-y-info\");\n    this.xInfoEl = this.graph.select(\".vzb-bc-axis-x-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.projectionX = this.graph.select(\".vzb-bc-projection-x\");\n    this.projectionY = this.graph.select(\".vzb-bc-projection-y\");\n    this.lineEqualXY = this.graph.select(\".vzb-bc-line-equal-xy\");\n\n    this.trailsContainer = this.graph.select(\".vzb-bc-trails\");\n    this.bubbleContainerCrop = this.graph.select(\".vzb-bc-bubbles-crop\");\n    this.zoomSelection = this.graph.select(\".vzb-zoom-selection\");\n    this.labelsContainerCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bubbleContainer = this.graph.select(\".vzb-bc-bubbles\");\n    this.labelsContainer = this.graph.select(\".vzb-bc-labels\");\n    this.linesContainer = this.graph.select(\".vzb-bc-lines\");\n    this.zoomRect = this.element.select(\".vzb-bc-zoom-rect\");\n    this.eventArea = this.element.select(\".vzb-bc-eventarea\");\n\n    this.entityBubbles = null;\n    this.bubbleCrown = this.element.select(\".vzb-bc-bubble-crown\");\n    //set filter\n    this.bubbleCrown.selectAll(\".vzb-crown-glow\")\n      .attr(\"filter\", \"url(\" + location.pathname + \"#vzb-glow-filter)\");\n    this.tooltipMobile = this.element.select(\".vzb-tooltip-mobile\");\n    //component events\n    this.on(\"resize\", () => {\n      //console.log(\"EVENT: resize\");\n      //return if updatesize exists with error\n      _this._trails.run(\"abortAnimation\");\n      if (_this.updateSize()) return;\n      _this.updateMarkerSizeLimits();\n      _this._labels.updateSize();\n      (function(xMin, xMax, yMin, yMax) {\n        _this._panZoom.zoomer.dontFeedToState = true;\n        _this._panZoom.rerun(); // includes redraw data points and trail resize\n        _this._panZoom.zoomToMaxMin(xMin, xMax, yMin, yMax, 0, true);\n      })(_this._zoomedXYMinMax.axis_x.zoomedMin,\n        _this._zoomedXYMinMax.axis_x.zoomedMax,\n        _this._zoomedXYMinMax.axis_y.zoomedMin,\n        _this._zoomedXYMinMax.axis_y.zoomedMax);\n    });\n\n    //keyboard listeners\n    d3.select(\"body\")\n      .on(\"keydown\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (d3.event.metaKey || d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", true);\n      })\n      .on(\"keyup\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (!d3.event.metaKey && !d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", false);\n      })\n      //this is for the case when user would press ctrl and move away from the browser tab or window\n      //keyup event would happen somewhere else and won't be captured, so zoomin class would get stuck\n      .on(\"mouseenter\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (!d3.event.metaKey && !d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", false);\n      });\n\n    this.root.on(\"resetZoom\", () => {\n      _this._panZoom.reset(null, 500);\n    });\n\n    this._panZoom.zoomSelection(this.bubbleContainerCrop);\n    this.bubbleContainerCrop\n      .call(this._panZoom.dragRectangle)\n      .call(this._panZoom.zoomer)\n      .on(\"dblclick.zoom\", null)\n      .on(\"mouseup\", () => {\n        _this.draggingNow = false;\n      })\n      .on(\"click\", () => {\n        const cursor = _this.model.ui.cursorMode;\n        if (!d3.event.defaultPrevented && cursor !== \"arrow\" && cursor !== \"hand\") {\n          _this._panZoom.zoomByIncrement(cursor, 500);\n        }\n      });\n\n    this.TIMEDIM = this.model.time.getDimension();\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n    this.labelNames = this.model.marker.getLabelHookNames();\n\n    this.updateUIStrings();\n\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n\n    this._labels.readyOnce();\n\n    _this._readyOnce = true;\n  },\n\n  _frameIsValid(frame) {\n    return !(!frame\n    || Object.keys(frame.axis_y).length === 0\n    || Object.keys(frame.axis_x).length === 0\n    || Object.keys(frame.size).length === 0);\n  },\n\n  ready() {\n    const _this = this;\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.KEY = this.KEYS.join(\",\");\n    this.dataKeys = this.model.marker.getDataKeysPerHook();\n    this.labelNames = this.model.marker.getLabelHookNames();\n\n    this.updateUIStrings();\n    const endTime = this.model.time.end;\n    this.updateIndicators();\n    this.updateTime();\n    if (!_this.model.time.splash) {\n      _this._trails.create();\n    }\n    this.model.marker.getFrame(this.model.time.value, (frame, time) => {\n      // TODO: temporary fix for case when after data loading time changed on validation\n      if (time.toString() != _this.model.time.value.toString()) {\n        utils.defer(() => {\n          _this.ready();\n        });\n        return;\n      }\n      if (!_this._frameIsValid(frame)) return utils.warn(\"ready: empty data received from marker.getFrame(). doing nothing\");\n\n      _this.frame = frame;\n      _this.updateSize();\n      _this.updateMarkerSizeLimits();\n      _this.updateEntities();\n      _this._labels.ready();\n      _this.redrawDataPoints();\n      _this.selectDataPoints();\n      _this.updateBubbleOpacity();\n      _this._updateDoubtOpacity();\n      _this.zoomToMarkerMaxMin(); // includes redraw data points and trail resize\n      if (!_this.model.time.splash) {\n        _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n      }\n      if (_this.model.ui.adaptMinMaxZoom) _this._panZoom.expandCanvas();\n    });\n  },\n\n  /*\n   * Zoom to the min and max values given in the URL axes markers.\n   */\n  zoomToMarkerMaxMin() {\n    /*\n     * Reset just the zoom values without triggering a zoom event. This ensures\n     * a clean zoom state for the subsequent zoom event.\n     */\n    this._panZoom.resetZoomState();\n\n    const xAxis = this.model.marker.axis_x;\n    const yAxis = this.model.marker.axis_y;\n\n    const xDomain = xAxis.getScale().domain();\n    const yDomain = yAxis.getScale().domain();\n\n    /*\n     * The axes may return null when there is no value given for the zoomed\n     * min and max values. In that case, fall back to the axes' domain values.\n     */\n    const zoomedMinX = xAxis.getZoomedMin();\n    const zoomedMaxX = xAxis.getZoomedMax();\n    const zoomedMinY = yAxis.getZoomedMin();\n    const zoomedMaxY = yAxis.getZoomedMax();\n\n    //by default this will apply no transition and feed values back to state\n    this._panZoom.zoomToMaxMin(zoomedMinX, zoomedMaxX, zoomedMinY, zoomedMaxY, 0, \"don't feed these zoom values back to state\");\n  },\n\n  /*\n   * UPDATE INDICATORS\n   */\n  updateIndicators() {\n    const _this = this;\n\n    //scales\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.sScale = this.model.marker.size.getScale();\n    this.cScale = this.model.marker.color.getScale();\n    this._labels.setScales(this.xScale, this.yScale);\n\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n\n  frameChanged(frame, time) {\n//    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.frame = frame;\n    this.updateTime();\n\n    this._updateDoubtOpacity();\n    this._trails.run(\"findVisible\");\n    if (this.model.ui.adaptMinMaxZoom) {\n      this._panZoom.expandCanvas();\n    } else {\n      this.redrawDataPoints();\n    }\n    this._trails.run(\"reveal\", null, this.duration);\n    this.tooltipMobile.classed(\"vzb-hidden\", true);\n    this._reorderEntities();\n  },\n\n  _getSubtitle(title, shortTitle) {\n    let subtitle = title.replace(shortTitle,\"\");\n    if (subtitle[0] === \",\") subtitle = subtitle.slice(1);\n    const regexpResult = /^\\((.*)\\)$|.*/.exec(subtitle.trim());\n    return regexpResult[1] || regexpResult[0] || \"\";\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    const layoutProfile = this.getLayoutProfile();\n\n    const conceptPropsY = _this.model.marker.axis_y.getConceptprops();\n    const conceptPropsX = _this.model.marker.axis_x.getConceptprops();\n    const conceptPropsS = _this.model.marker.size.getConceptprops();\n    const conceptPropsC = _this.model.marker.color.getConceptprops();\n    this.translator = this.model.locale.getTFunction();\n\n    this.strings = {\n      title: {\n        Y: conceptPropsY.name,\n        X: conceptPropsX.name,\n        S: conceptPropsS.name,\n        C: conceptPropsC.name\n      },\n      title_short: {\n        Y: conceptPropsY.name_short,\n        X: conceptPropsX.name_short,\n        S: conceptPropsS.name_short,\n        C: conceptPropsC.name_short        \n      },\n      subtitle: {\n        Y: this._getSubtitle(conceptPropsY.name, conceptPropsY.name_short),\n        X: this._getSubtitle(conceptPropsX.name, conceptPropsX.name_short),\n        S: conceptPropsS.name_short,\n        C: conceptPropsC.name_short        \n      },\n      unit: {\n        Y: conceptPropsY.unit || \"\",\n        X: conceptPropsX.unit || \"\",\n        S: conceptPropsS.unit || \"\",\n        C: conceptPropsC.unit || \"\"\n      }\n    };\n\n    const ySubTitle = this.ySubTitleEl.selectAll(\"text\").data([0]);\n    ySubTitle.enter().append(\"text\");\n    const xSubTitle = this.xSubTitleEl.selectAll(\"text\").data([0]);\n    xSubTitle.enter().append(\"text\");\n\n    const yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    yTitle.enter().append(\"text\");\n    yTitle\n    //.attr(\"y\", \"-6px\")\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_y\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"bottom\")\n          .updateView()\n          .toggle();\n      });\n\n    const sTitle = this.sTitleEl.selectAll(\"text\").data([0]);\n    sTitle.enter().append(\"text\");\n    sTitle\n      .attr(\"text-anchor\", \"end\");\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.yInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsY.description || conceptPropsY.sourceLink)));\n\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.yInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.yInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.yInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this._updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this._updateDoubtOpacity();\n      });\n  },\n\n  _updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.model.time.formatDate(this.time));\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  /*\n   * UPDATE ENTITIES:\n   * Ideally should only update when show parameters change or data changes\n   */\n  updateEntities() {\n    const _this = this;\n    const dataKeys = this.dataKeys;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    const getKeys = function(prefix) {\n      prefix = prefix || \"\";\n      return _this.model.marker.getKeys()\n        .map(d => {\n          const pointer = Object.assign({}, d);\n          //pointer[KEY] = d[KEY];\n          pointer[TIMEDIM] = endTime;\n          pointer.sortValue = _this.frame.size[utils.getKey(d, dataKeys.size)] || 0;\n          pointer[KEY] = prefix + utils.getKey(d, KEYS);\n          return pointer;\n        })\n        .sort((a, b) => b.sortValue - a.sortValue);\n    };\n\n    // get array of GEOs, sorted by the size hook\n    // that makes larger bubbles go behind the smaller ones\n    const endTime = this.model.time.end;\n    const markers = getKeys.call(this);\n    this.model.marker.setVisible(markers);\n\n    //unselecting bubbles with no data is used for the scenario when\n    //some bubbles are selected and user would switch indicator.\n    //bubbles would disappear but selection would stay\n    if (!this.model.time.splash) {\n      this.unselectBubblesWithNoData(markers);\n    }\n    this.entityBubbles = this.bubbleContainer.selectAll(\"circle.vzb-bc-entity\")\n      .data(this.model.marker.getVisible(), d => d[KEY]); // trails have not keys\n\n    //exit selection\n    this.entityBubbles.exit().remove();\n\n    //enter selection -- init circles\n    this.entityBubbles = this.entityBubbles.enter().append(\"circle\")\n      .attr(\"class\", d => \"vzb-bc-entity \" + \"bubble-\" + d[KEY])\n      .on(\"mouseover\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n        _this._bubblesInteract().mouseover(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n\n        _this._bubblesInteract().mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n\n        _this._bubblesInteract().click(d, i);\n      })\n      .onTap((d, i) => {\n        d3.event.stopPropagation();\n        _this._bubblesInteract().click(d, i);\n      })\n      .onLongTap((d, i) => {\n      })\n      .merge(this.entityBubbles);\n\n    this._reorderEntities();\n  },\n\n  unselectBubblesWithNoData(entities) {\n    const _this = this;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    if (!this.model.marker.select.length) return;\n\n    const _select = [];\n    const keys = entities.map(d => d[KEY]);\n\n    this.model.marker.select.forEach(d => {\n      if (keys.indexOf(utils.getKey(d, KEYS)) !== -1) _select.push(d);\n    });\n\n    if (_select.length !== _this.model.marker.select.length) _this.model.marker.select = _select;\n  },\n\n  _reorderEntities() {\n    const _this = this;\n    const dataKeys = this.dataKeys;\n    const KEY = this.KEY;\n    this.bubbleContainer.selectAll(\".vzb-bc-entity\")\n      .sort((a, b) => {\n        const sizeA = _this.frame.size[utils.getKey(a, dataKeys.size)];\n        const sizeB = _this.frame.size[utils.getKey(b, dataKeys.size)];\n\n        if (typeof sizeA === \"undefined\" && typeof sizeB !== \"undefined\") return -1;\n        if (typeof sizeA !== \"undefined\" && typeof sizeB === \"undefined\") return 1;\n        if (sizeA != sizeB) return d3.descending(sizeA, sizeB);\n        if (a[KEY] != b[KEY]) return d3.ascending(a[KEY], b[KEY]);\n        if (typeof a.trailStartTime !== \"undefined\" || typeof b.trailStartTime !== \"undefined\") return typeof a.trailStartTime !== \"undefined\" ? -1 : 1; // only lines has trailStartTime\n        if (typeof a.status !== \"undefined\" || typeof b.status !== \"undefined\") return typeof a.status !== \"undefined\" ? -1 : 1; // only trails has attribute status\n        return d3.descending(sizeA, sizeB);\n      });\n  },\n\n  _bubblesInteract() {\n    const _this = this;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    return {\n      mouseover(d, i) {\n        _this.model.marker.highlightMarker(d);\n\n        _this._labels.showCloseCross(d, true);\n      },\n\n      mouseout(d, i) {\n        _this.model.marker.clearHighlighted();\n\n        _this._labels.showCloseCross(d, false);\n      },\n\n      click(d, i) {\n        if (_this.draggingNow) return;\n        const isSelected = _this.model.marker.isSelected(d);\n        _this.model.marker.selectMarker(d);\n        //return to highlighted state\n        if (!utils.isTouchDevice()) {\n          if (isSelected) _this.model.marker.highlightMarker(d);\n          _this.highlightDataPoints();\n        }\n      }\n    };\n  },\n\n\n  /*\n   * UPDATE TIME:\n   * Ideally should only update when time or data changes\n   */\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time, \"ui\"), this.duration);\n  },\n\n  /*\n   * RESIZE:\n   * Executed whenever the container is resized\n   */\n  updateSize() {\n\n    const { chartSvg } = this;\n    const svgWidth = utils.px2num(chartSvg.style(\"width\"));\n    const svgHeight = utils.px2num(chartSvg.style(\"height\"));\n    const marginScaleH = (marginMin, ratio = 0) => marginMin + svgHeight * ratio;\n    const marginScaleW = (marginMin, ratio = 0) => marginMin + svgWidth * ratio;\n\n    const profiles = {\n      small: {\n        margin: { top: 30, bottom: 35, left: 30, right: 10},\n        leftMarginRatio: 1,\n        padding: 2,\n        minRadiusPx: 0.5,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 16,\n        yAxisTitleBottomMargin: 6,\n        xAxisTitleBottomMargin: 4\n      },\n      medium: {\n        margin: { top: 15, bottom: 40, left: 40, right: 15},\n        leftMarginRatio: 1.6,\n        padding: 2,\n        minRadiusPx: 1,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 20,\n        yAxisTitleBottomMargin: 3,\n        xAxisTitleBottomMargin: 4\n      },\n      large: {\n        margin: { top: 15, bottom: marginScaleH(30, 0.03), left: marginScaleW(31, 0.015), right: 20},\n        leftMarginRatio: 1.8,\n        padding: 2,\n        minRadiusPx: 1,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 22,\n        yAxisTitleBottomMargin: 3,//marginScaleH(4, 0.01),\n        xAxisTitleBottomMargin: marginScaleH(0, 0.01),\n        hideSTitle: true\n      }\n    };\n\n    const presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, bottom: 55, left: 50, right: 20 },\n        yAxisTitleBottomMargin: 3,\n        xAxisTitleBottomMargin: 4,\n        infoElHeight: 26,\n      },\n      large: {\n        margin: { top: 30, bottom: marginScaleH(45, 0.03), left: marginScaleW(35, 0.025), right: 30 },\n        yAxisTitleBottomMargin: 3,//marginScaleH(4, 0.01),\n        xAxisTitleBottomMargin: marginScaleH(-10, 0.01),\n        infoElHeight: 32,\n        hideSTitle: true\n      }\n    };\n    \n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    const layoutProfile = this.getLayoutProfile();\n    const containerWH = this.root.getVizWidthHeight();\n    this.activeProfile.maxRadiusPx = Math.max(\n      this.activeProfile.minRadiusPx,\n      this.activeProfile.maxRadiusEm * utils.hypotenuse(containerWH.width, containerWH.height)\n    );\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //labels\n    _this._labels.setCloseCrossHeight(_this.activeProfile.infoElHeight * 1.2);\n    _this._labels.setTooltipFontSize(_this.activeProfile.infoElHeight + \"px\");\n    \n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left * this.activeProfile.leftMarginRatio - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Bubble chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph\n      .attr(\"transform\", \"translate(\" + (margin.left * this.activeProfile.leftMarginRatio) + \",\" + margin.top + \")\");\n\n    this.year.resize(this.width, this.height);\n    this.eventArea\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    //update scales to the new range\n    if (this.model.marker.axis_y.scaleType !== \"ordinal\") {\n      this.yScale.range(this._rangeBump([this.height, 0]));\n    } else {\n      this.yScale.rangePoints([this.height, 0], _this.activeProfile.padding).range();\n    }\n    if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n      this.xScale.range(this._rangeBump([0, this.width]));\n    } else {\n      this.xScale.rangePoints([0, this.width], _this.activeProfile.padding).range();\n    }\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6,\n        bump: this.activeProfile.maxRadiusPx / 2,\n        viewportLength: this.height,\n        formatter: this.model.marker.axis_y.getTickFormatter()\n      });\n\n    this.xAxis.scale(this.xScale)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        bump: this.activeProfile.maxRadiusPx / 2,\n        viewportLength: this.width,\n        formatter: this.model.marker.axis_x.getTickFormatter()\n      });\n\n\n    this.bubbleContainerCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsContainerCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.xAxisElContainer\n      .attr(\"width\", this.width + 1)\n      .attr(\"height\", this.activeProfile.margin.bottom + this.height)\n      .attr(\"y\", -1)\n      .attr(\"x\", -1);\n    this.xAxisEl\n      .attr(\"transform\", \"translate(1,\" + (1 + this.height) + \")\");\n\n    this.yAxisElContainer\n      .attr(\"width\", this.activeProfile.margin.left + this.width)\n      .attr(\"height\", Math.max(0, this.height))\n      .attr(\"x\", -this.activeProfile.margin.left);\n    this.yAxisEl\n      .attr(\"transform\", \"translate(\" + (this.activeProfile.margin.left - 1) + \",\" + 0 + \")\");\n\n    this.yAxisEl.call(this.yAxis);\n    this.xAxisEl.call(this.xAxis);\n\n    this.projectionX.attr(\"y1\", _this.yScale.range()[0] + this.activeProfile.maxRadiusPx / 2);\n    this.projectionY.attr(\"x2\", _this.xScale.range()[0] - this.activeProfile.maxRadiusPx / 2);\n\n\n    // reduce font size if the caption doesn't fit\n    this._updateSTitle();\n    this.sTitleEl\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + 20 + \") rotate(-90)\");\n\n    if (layoutProfile !== \"small\") {\n      this.ySubTitleEl.select(\"text\").attr(\"dy\", infoElHeight * 0.6).text(this.strings.subtitle.Y);\n      this.xSubTitleEl.select(\"text\").attr(\"dy\", -infoElHeight * 0.3).text(this.strings.subtitle.X);\n      \n      this.yTitleEl.select(\"text\").text(this.strings.title_short.Y + \" \")\n        .append(\"tspan\")\n        .style(\"font-size\", (infoElHeight * 0.7) + \"px\")\n        .text(\"\");\n      this.xTitleEl.select(\"text\").text(this.strings.title_short.X + \" \")\n        .append(\"tspan\")\n        .style(\"font-size\", (infoElHeight * 0.7) + \"px\")\n        .text(\"\");\n    } else {\n      this.ySubTitleEl.select(\"text\").text(\"\");\n      this.xSubTitleEl.select(\"text\").text(\"\");\n\n      const yTitleText = this.yTitleEl.select(\"text\").text(this.strings.title.Y);\n      if (yTitleText.node().getBBox().width > this.width) yTitleText.text(this.strings.title_short.Y);\n    \n      const xTitleText = this.xTitleEl.select(\"text\").text(this.strings.title.X);\n      if (xTitleText.node().getBBox().width > this.width - 100) xTitleText.text(this.strings.title_short.X);      \n    }\n\n    const isRTL = this.model.locale.isRTL();\n    this.ySubTitleEl\n      .style(\"font-size\", (infoElHeight * 0.8) + \"px\")\n      .attr(\"transform\", \"translate(\" + 0 + \",\" + 0 + \") rotate(-90)\");\n    this.xSubTitleEl\n      .style(\"font-size\", (infoElHeight * 0.8) + \"px\")\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\");\n  \n    this.yTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (-margin.left - this.activeProfile.yAxisTitleBottomMargin)  + \",\" + (this.height * 0.5) + \") rotate(-90)\"\n        : \n        \"translate(\" + (isRTL ? this.width : 10 - this.activeProfile.margin.left) + \", -\" + this.activeProfile.yAxisTitleBottomMargin + \")\")\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (this.width * 0.5) + \",\" + (this.height + margin.bottom - this.activeProfile.xAxisTitleBottomMargin) + \")\"\n        :\n        \"translate(\" + (isRTL ? this.width : 0) + \",\" + (this.height + margin.bottom - this.activeProfile.xAxisTitleBottomMargin) + \")\");\n\n    if (this.yInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n      const vTranslate = isRTL ? (t.translateY + infoElHeight * 1.4 + titleBBox.width * 0.5) : (t.translateY - infoElHeight * 0.4 - titleBBox.width * 0.5);\n\n      this.yInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.yInfoEl.attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (t.translateX - infoElHeight * 0.8) + \",\" + vTranslate + \") rotate(-90)\"\n        :\n        \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this._resizeDataWarning();\n\n    this.model.ui.chart.margin.set(\"left\", margin.left * this.activeProfile.leftMarginRatio, false, false);\n  },\n\n\n  _updateLineEqualXY(duration) {\n    const oneMeasure = this.model.marker.axis_x.which == this.model.marker.axis_y.which;\n    this.lineEqualXY.classed(\"vzb-invisible\", !oneMeasure);\n    if (!oneMeasure) return;\n\n    const min = d3.min(this.yScale.domain().concat(this.xScale.domain()));\n    const max = d3.max(this.yScale.domain().concat(this.xScale.domain()));\n\n    this.lineEqualXY\n      .transition()\n      .duration(duration || 0)\n      .attr(\"y1\", this.yScale(min))\n      .attr(\"y2\", this.yScale(max))\n      .attr(\"x1\", this.xScale(min))\n      .attr(\"x2\", this.xScale(max));\n  },\n\n  _resizeDataWarning() {\n    // reset font size to remove jumpy measurement\n    const dataWarningText = this.dataWarningEl.select(\"text\").style(\"font-size\", null);\n\n    // reduce font size if the caption doesn't fit\n    const dataWarningWidth = dataWarningText.node().getBBox().width + dataWarningText.node().getBBox().height * 3;\n    const remainingWidth = this.width - this.xTitleEl.node().getBBox().width - this.activeProfile.infoElHeight;\n    const font = parseInt(dataWarningText.style(\"font-size\")) * remainingWidth / dataWarningWidth;\n    dataWarningText.style(\"font-size\", dataWarningWidth > remainingWidth ? font + \"px\" : null);\n\n    // position the warning icon\n    const warnBB = dataWarningText.node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height * 0.75)\n      .attr(\"height\", warnBB.height * 0.75)\n      .attr(\"x\", -warnBB.width - warnBB.height * 1.2)\n      .attr(\"y\", -warnBB.height * 0.65);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\"\n        + (this.model.locale.isRTL() ? warnBB.width + warnBB.height : this.width) + \",\"\n        + (this.height + this.activeProfile.margin.bottom - this.activeProfile.xAxisTitleBottomMargin)\n        + \")\");\n  },\n\n  updateMarkerSizeLimits() {\n    const _this = this;\n    const extent = this.model.marker.size.extent || [0, 1];\n\n    if (!this.activeProfile) return utils.warn(\"updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data\");\n\n    let minRadius = this.activeProfile.minRadiusPx;\n    let maxRadius = this.activeProfile.maxRadiusPx;\n\n    let minArea = utils.radiusToArea(Math.max(maxRadius * extent[0], minRadius));\n    let maxArea = utils.radiusToArea(Math.max(maxRadius * extent[1], minRadius));\n\n    let range = minArea === maxArea? [minArea, maxArea] :\n      d3.range(minArea, maxArea, (maxArea - minArea)/this.sScale.domain().length).concat(maxArea);\n\n    this.sScale.range(range);\n  },\n\n  redrawDataPointsOnlyColors() {\n    const _this = this;\n    if (!this.entityBubbles) return utils.warn(\"redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!\");\n\n    let valuesNow;\n    const dataKeys = this.dataKeys;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n\n    let time = this.model.time.value;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n    }\n    this.model.marker.getFrame(time, valuesLocked => {\n      if (!_this._frameIsValid(valuesLocked)) return utils.warn(\"redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing\");\n\n      valuesNow = _this.frame;\n      _this.entityBubbles.each(function(d, index) {\n\n        const selected = _this.model.marker.isSelected(d);\n\n        const valueC = selected ? valuesNow.color[utils.getKey(d, dataKeys.color)] : valuesLocked.color[utils.getKey(d, dataKeys.color)];\n\n        const scaledC = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n\n        d3.select(this).style(\"fill\", scaledC);\n\n        //update lines of labels\n        if (selected) {\n\n          const select = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n\n          const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n          _this.model.marker.getFrame(trailStartTime, valuesTrailStart => {\n            if (!valuesTrailStart) return utils.warn(\"redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing\");\n\n            const cache = {};\n            if (!_this.model.ui.chart.trails || trailStartTime - _this.time == 0) {\n              cache.scaledC0 = scaledC;\n            } else {\n              const valueC = valuesTrailStart.color[utils.getKey(d, dataKeys.color)];\n              cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n            }\n\n            _this._labels.updateLabelOnlyColor(d, index, cache);\n\n          });\n        }\n      });\n    });\n\n  },\n\n  redrawDataPointsOnlySize() {\n    const _this = this;\n\n    let valuesNow;\n    const dataKeys = this.dataKeys;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n\n    let time = this.model.time.value;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n    }\n    this.model.marker.getFrame(time, valuesLocked => {\n      if (!_this._frameIsValid(valuesLocked)) return utils.warn(\"redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing\");\n\n      valuesNow = _this.frame;\n      _this.entityBubbles.each(function(d, index) {\n\n        const selected = _this.model.marker.isSelected(d);\n\n        const valueS = selected ? valuesNow.size[utils.getKey(d, dataKeys.size)] : valuesLocked.size[utils.getKey(d, dataKeys.size)];\n        if (valueS == null) return;\n\n        const scaledS = utils.areaToRadius(_this.sScale(valueS));\n        d3.select(this).attr(\"r\", scaledS);\n\n        //update lines of labels\n        if (selected) {\n\n          const select = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n\n          const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n          _this.model.marker.getFrame(trailStartTime, valuesTrailStart => {\n            if (!valuesTrailStart) return utils.warn(\"redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing\");\n\n            const cache = {};\n            if (!_this.model.ui.chart.trails || trailStartTime - _this.time == 0) {\n              cache.scaledS0 = scaledS;\n            } else {\n              cache.scaledS0 = utils.areaToRadius(_this.sScale(valuesTrailStart.size[utils.getKey(d, dataKeys.size)]));\n            }\n\n            _this._labels.updateLabelOnlyPosition(d, index, cache);\n\n          });\n        }\n      });\n    });\n  },\n\n  /*\n   * REDRAW DATA POINTS:\n   * Here plotting happens\n   * debouncing to improve performance: events might trigger it more than 1x\n   */\n  redrawDataPoints(duration) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (duration == null) duration = _this.duration;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      const time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n\n      //get values for locked frames\n      this.model.marker.getFrame(time, lockedFrame => {\n        if (!lockedFrame) return utils.warn(\"redrawDataPoints: empty data received from marker.getFrames(). doing nothing\");\n\n        // each bubble\n        _this.entityBubbles.each(function(d, index) {\n          const frame = _this.model.marker.isSelected(d) ? _this.frame : lockedFrame;\n          _this._updateBubble(d, frame, index, d3.select(this), duration);\n        });\n      });\n    } else {\n      // each bubble\n      _this.entityBubbles.each(function(d, index) {\n        _this._updateBubble(d, _this.frame, index, d3.select(this), duration);\n      });\n    }\n\n    this._updateLineEqualXY(duration);\n  },\n\n  //redraw Data Points\n  _updateBubble(d, values, index, view, duration) {\n    const _this = this;\n    const dataKeys = this.dataKeys;\n    \n    let showhide = false;\n\n    const valueY = values.axis_y[utils.getKey(d, dataKeys.axis_y)];\n    const valueX = values.axis_x[utils.getKey(d, dataKeys.axis_x)];\n    const valueS = values.size[utils.getKey(d, dataKeys.size)];\n    const valueL = values.label[utils.getKey(d, dataKeys.label)];\n    const valueC = values.color[utils.getKey(d, dataKeys.color)];\n    const valueLST = values.size_label[utils.getKey(d, dataKeys.size_label)];\n\n    // check if fetching data succeeded\n    if (!valueL && valueL !== 0 || !valueY && valueY !== 0 || !valueX && valueX !== 0 || !valueS && valueS !== 0) {\n      // if entity is missing data it should hide\n      if (!d.hidden) {\n        d.hidden = true;\n        showhide = true;\n      }\n\n      if (showhide) {\n        if (duration) {\n          const opacity = view.style(\"opacity\");\n          view.transition().duration(duration).ease(d3.easeExp)\n            .style(\"opacity\", 0)\n            .on(\"end\", () => {\n              //to avoid transition from null state add class with a delay\n              view.classed(\"vzb-invisible\", d.hidden);\n              view.style(\"opacity\", opacity);\n            });\n        } else {\n          //immediately hide the bubble\n          view.classed(\"vzb-invisible\", d.hidden);\n        }\n      }\n    } else {\n      if (d.hidden || view.classed(\"vzb-invisible\")) {\n        d.hidden = false;\n        showhide = true;\n      }\n\n\n      // if entity has all the data we update the visuals\n      const scaledS = utils.areaToRadius(_this.sScale(valueS));\n\n      view.style(\"fill\", valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH);\n\n      if (duration) {\n        if (showhide) {\n          const opacity = view.style(\"opacity\");\n          view.classed(\"vzb-invisible\", d.hidden);\n          view.style(\"opacity\", 0)\n            .attr(\"cy\", _this.yScale(valueY))\n            .attr(\"cx\", _this.xScale(valueX))\n            .attr(\"r\", scaledS)\n            .transition().duration(duration).ease(d3.easeExp)\n            .style(\"opacity\", opacity);\n        } else {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"cy\", _this.yScale(valueY))\n            .attr(\"cx\", _this.xScale(valueX))\n            .attr(\"r\", scaledS);\n        }\n\n      } else {\n\n        //interrupt the ongoing transition and immediately do the visual updates\n        view.interrupt()\n          .attr(\"cy\", _this.yScale(valueY))\n          .attr(\"cx\", _this.xScale(valueX))\n          .attr(\"r\", scaledS)\n          .transition();\n\n        //show entity if it was hidden\n        if (showhide) view.classed(\"vzb-invisible\", d.hidden);\n      }\n\n      if (this.model.time.record) _this._export.write({\n        type: \"circle\",\n        id: d[KEY],\n        time: this.model.time.value.getUTCFullYear(),\n        fill: valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH,\n        cx: _this.xScale(valueX),\n        cy: _this.yScale(valueY),\n        r: scaledS\n      });\n\n    } // data exists\n    _this._updateLabel(d, index, values, valueX, valueY, valueS, valueC, valueL, valueLST, duration, showhide);\n  },\n\n  _updateLabel(d, index, values, valueX, valueY, valueS, valueC, valueL, valueLST, duration, showhide) {\n    const _this = this;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n    // only for selected markers\n    if (_this.model.marker.isSelected(d)) {\n\n      const cache = {};\n\n      const select = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n\n      const time = _this.model.time.formatDate(_this.time);\n      if (!this.model.ui.chart.trails || select.trailStartTime == time || select.trailStartTime == null) {\n        if (this.model.ui.chart.trails && select.trailStartTime == null) select.trailStartTime = time; // need only when trailStartTime == null\n\n        cache.labelX0 = valueX;\n        cache.labelY0 = valueY;\n        cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH,\n        cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_this.sScale(valueS)) : null;\n      }\n\n      const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n      const labelText = _this._getLabelText(values, this.labelNames, d, select.trailStartTime);\n\n      if (showhide && d.hidden && _this.model.ui.chart.trails && trailStartTime && (trailStartTime < _this.time)) showhide = false;\n      if (d.hidden && !_this.model.ui.chart.trails) showhide = true;\n\n      this._labels.updateLabel(d, index, cache, valueX, valueY, valueS, valueC, labelText, valueLST, duration, showhide);\n\n    }\n  },\n\n  _getLabelText(values, labelNames, d, time) {\n    const value = this.KEYS.map(key => values[labelNames[key]] ? values[labelNames[key]][d[key]] : d[key]).join(\", \");    \n    return value + (time || time === 0 ? \" \" + time : \"\");\n  },\n\n  _setTooltip(tooltipText, x, y, s, c, d) {\n    if (tooltipText) {\n      const labelValues = {};\n      if (d) {\n        const dataKeys = this.dataKeys;\n        const values = this.frame;\n        labelValues.valueY = values.axis_y[utils.getKey(d, dataKeys.axis_y)];\n        labelValues.valueX = values.axis_x[utils.getKey(d, dataKeys.axis_x)];\n        labelValues.valueS = values.size[utils.getKey(d, dataKeys.size)];\n        labelValues.valueC = values.color[utils.getKey(d, dataKeys.color)];\n        labelValues.valueLST = values.size_label[utils.getKey(d, dataKeys.size_label)];\n        labelValues.labelText = this._getLabelText(values, this.labelNames, d, this.model.time.formatDate(this.time));\n      }\n\n      const tooltipCache = {};\n      tooltipCache.labelX0 = this.xScale.invert(x);\n      tooltipCache.labelY0 = this.yScale.invert(y);\n      tooltipCache.scaledS0 = s;\n      tooltipCache.scaledC0 = null;\n\n      this._labels.setTooltip(d, tooltipText, tooltipCache, labelValues);\n    } else {\n      this._labels.setTooltip();\n    }\n  },\n\n  _formatSTitleValues(titleS, titleC) {\n    const _this = this;\n    const unitS = this.strings.unit.S;\n    const unitC = this.strings.unit.C;\n\n    const formatterS = this.model.marker.size.getTickFormatter();\n    const formatterC = this.model.marker.color.getTickFormatter();\n\n    //resolve labels for colors via the color legend\n    if (this.model.marker.color.isDiscrete() && this.model.marker.color.use !== \"constant\" && titleC && this.model.marker.color.getColorlegendMarker()) {\n      titleC = this.model.marker.color.getColorlegendMarker().label.getItems()[titleC] || \"\";\n    }\n\n    return [formatterS(titleS) + \" \" + unitS,\n      titleC || titleC === 0 ? formatterC(titleC) + \" \" + unitC : this.translator(\"hints/nodata\")];\n  },\n\n  _updateSTitle(titleS, titleC) {\n\n    // vertical text about size and color\n    if (this.activeProfile.hideSTitle\n      && this.model.ui.dialogs.sidebar.indexOf(\"colors\") > -1\n      && this.model.ui.dialogs.sidebar.indexOf(\"size\") > -1) {\n      this.sTitleEl.classed(\"vzb-invisible\", true);\n      return;\n    }\n    if (this.sTitleEl.classed(\"vzb-invisible\")) {\n      this.sTitleEl.classed(\"vzb-invisible\", false);\n    }\n    const sTitleContentON = this.model.marker.size.use !== \"constant\";\n    const cTitleContentON = this.model.marker.color.use !== \"constant\";\n    const sTitleText = this.sTitleEl.select(\"text\")\n    // reset font size to remove jumpy measurement\n      .style(\"font-size\", null)\n      .text(\n        (sTitleContentON ? this.translator(\"buttons/size\") + \": \" + (titleS ? titleS : this.strings.title.S) : \"\") +\n        (sTitleContentON && cTitleContentON ? \", \" : \"\") +\n        (cTitleContentON ? this.translator(\"buttons/colors\") + \": \" + (titleC ? titleC : this.strings.title.C) : \"\")\n      );\n    const sTitleWidth = sTitleText.node().getBBox().width;\n    const remainigHeight = this.height - 30;\n    const font = parseInt(sTitleText.style(\"font-size\")) * remainigHeight / sTitleWidth;\n    sTitleText.style(\"font-size\", sTitleWidth > remainigHeight ? font + \"px\" : null);\n  },\n\n  selectDataPoints() {\n    const _this = this;\n    const KEY = this.KEY;\n\n    if (utils.isTouchDevice()) {\n      _this.model.marker.clearHighlighted();\n      _this._labels.showCloseCross(null, false);\n    } else {\n      //hide tooltip\n      _this._setTooltip();\n      _this._setBubbleCrown();\n    }\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n  },\n\n  _setBubbleCrown(x, y, r, glow, skipInnerFill) {\n    if (x != null) {\n      this.bubbleCrown.classed(\"vzb-hidden\", false);\n      this.bubbleCrown.select(\".vzb-crown\")\n        .attr(\"cx\", x)\n        .attr(\"cy\", y)\n        .attr(\"r\", r)\n        .attr(\"fill\", skipInnerFill ? \"none\" : glow);\n      this.bubbleCrown.selectAll(\".vzb-crown-glow\")\n        .attr(\"cx\", x)\n        .attr(\"cy\", y)\n        .attr(\"r\", r + 10)\n        .attr(\"stroke\", glow);\n\n    } else {\n      this.bubbleCrown.classed(\"vzb-hidden\", true);\n    }\n\n  },\n\n  /*\n   * Shows and hides axis projections\n   */\n  _axisProjections(d) {\n    const _this = this;\n    const TIMEDIM = this.TIMEDIM;\n    const dataKeys = this.dataKeys;\n\n    if (d != null) {\n\n      this.model.marker.getFrame(d[TIMEDIM], values => {\n        const valueY = values.axis_y[utils.getKey(d, dataKeys.axis_y)];\n        const valueX = values.axis_x[utils.getKey(d, dataKeys.axis_x)];\n        const valueS = values.size[utils.getKey(d, dataKeys.size)];\n        const radius = utils.areaToRadius(_this.sScale(valueS));\n\n        if (!valueY && valueY !== 0 || !valueX && valueX !== 0 || !valueS && valueS !== 0) return;\n\n        if (_this.model.ui.chart.whenHovering.showProjectionLineX\n          && _this.xScale(valueX) > 0 && _this.xScale(valueX) < _this.width\n          && (_this.yScale(valueY) + radius) < _this.height) {\n          _this.projectionX\n            .style(\"opacity\", 1)\n            .attr(\"y2\", _this.yScale(valueY) + radius)\n            .attr(\"x1\", _this.xScale(valueX))\n            .attr(\"x2\", _this.xScale(valueX));\n        }\n\n        if (_this.model.ui.chart.whenHovering.showProjectionLineY\n          && _this.yScale(valueY) > 0 && _this.yScale(valueY) < _this.height\n          && (_this.xScale(valueX) - radius) > 0) {\n          _this.projectionY\n            .style(\"opacity\", 1)\n            .attr(\"y1\", _this.yScale(valueY))\n            .attr(\"y2\", _this.yScale(valueY))\n            .attr(\"x1\", _this.xScale(valueX) - radius);\n        }\n\n        if (_this.model.ui.chart.whenHovering.higlightValueX) _this.xAxisEl.call(\n          _this.xAxis.highlightValue(valueX)\n        );\n\n        if (_this.model.ui.chart.whenHovering.higlightValueY) _this.yAxisEl.call(\n          _this.yAxis.highlightValue(valueY)\n        );\n      });\n\n    } else {\n\n      this.projectionX.style(\"opacity\", 0);\n      this.projectionY.style(\"opacity\", 0);\n      this.xAxisEl.call(this.xAxis.highlightValue(\"none\"));\n      this.yAxisEl.call(this.yAxis.highlightValue(\"none\"));\n\n    }\n\n  },\n\n  /*\n   * Highlights all hovered bubbles\n   */\n  highlightDataPoints() {\n    const _this = this;\n    const TIMEDIM = this.TIMEDIM;\n    const dataKeys = this.dataKeys;\n    const KEYS = this.KEYS;\n    const KEY = this.KEY;\n    \n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    this.updateBubbleOpacity();\n\n    if (this.model.marker.highlight.length === 1) {\n      const d = utils.clone(this.model.marker.highlight[0]);\n      d[KEY] = utils.getKey(d, KEYS);\n\n      if (_this.model.ui.chart.lockNonSelected && _this.someSelected && !_this.model.marker.isSelected(d)) {\n        d[TIMEDIM] = _this.model.time.parse(\"\" + _this.model.ui.chart.lockNonSelected);\n      } else {\n        d[TIMEDIM] = _this.model.time.parse(\"\" + d.trailStartTime) || _this.time;\n      }\n\n      _this.model.marker.getFrame(d[TIMEDIM], values => {\n        if (!values) return;\n        const x = _this.xScale(values.axis_x[utils.getKey(d, dataKeys.axis_x)]);\n        const y = _this.yScale(values.axis_y[utils.getKey(d, dataKeys.axis_y)]);\n        const s = utils.areaToRadius(_this.sScale(values.size[utils.getKey(d, dataKeys.size)]));\n        const c = values.color[utils.getKey(d, dataKeys.color)] != null ? _this.cScale(values.color[utils.getKey(d, dataKeys.color)]) : _this.COLOR_WHITEISH;\n        let entityOutOfView = false;\n\n        const titles = _this._formatSTitleValues(values.size[utils.getKey(d, dataKeys.size)], values.color[utils.getKey(d, dataKeys.color)]);\n        _this._updateSTitle(titles[0], titles[1]);\n        if (x + s < 0 || x - s > _this.width || y + s < 0 || y - s > _this.height) {\n          entityOutOfView = true;\n        }\n\n        //show tooltip\n        let text = \"\";\n        let hoverTrail = false;\n        if (_this.model.marker.isSelected(d) && _this.model.ui.chart.trails) {\n          text = _this.model.time.formatDate(_this.time);\n          const selectedData = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n          hoverTrail = text !== selectedData.trailStartTime && !d3.select(d3.event.target).classed(\"bubble-\" + d[KEY]);\n          text = text !== selectedData.trailStartTime && _this.time === d[TIMEDIM] ? text : \"\";\n        } else {\n          text = _this.model.marker.isSelected(d) ? \"\" : _this._getLabelText(values, _this.labelNames, d);\n        }\n\n        _this._labels.highlight(null, false);\n        _this._labels.highlight(d, true);\n        if (_this.model.marker.isSelected(d)) {\n          const skipCrownInnerFill = !d.trailStartTime || d.trailStartTime == _this.model.time.formatDate(_this.time);\n          _this._setBubbleCrown(x, y, s, c, skipCrownInnerFill);\n        }\n\n        if (!entityOutOfView && !hoverTrail) {\n          _this._axisProjections(d);\n        }\n\n        //set tooltip and show axis projections\n        if (text && !entityOutOfView && !hoverTrail) {\n          _this._setTooltip(text, x, y, s + 3, c, d);\n        }\n\n        const selectedData = utils.find(_this.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n        if (selectedData) {\n          const clonedSelectedData = utils.clone(selectedData);\n          //change opacity to OPACITY_HIGHLT = 1.0;\n          clonedSelectedData.opacity = 1.0;\n          _this._trails.run([\"opacityHandler\"], clonedSelectedData);\n        }\n      });\n    } else {\n      this._axisProjections();\n      this._trails.run([\"opacityHandler\"]);\n      //hide tooltip\n      _this._updateSTitle();\n      this._setTooltip();\n      this._setBubbleCrown();\n      this._labels.highlight(null, false);\n    }\n\n  },\n\n  _blinkSuperHighlighted() {\n    this.entityBubbles\n      .classed(\"vzb-super-highlighted\", d => this.model.marker.isSuperHighlighted(d));\n  },\n\n  updateBubbleOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.entityBubbles\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.entityBubbles.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BubbleChart;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","const { utils } = Vizabi;\n\nconst PanZoom = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n    this.dragRectangle = d3.drag();\n    this.zoomer = d3.zoom();\n\n    // this.dragLock = false;\n\n    this.dragRectangle\n      .subject(this.dragSubject())\n      .on(\"start\", this.drag().start)\n      .on(\"drag\", this.drag().go)\n      .on(\"end\", this.drag().stop);\n\n    this.zoomer\n      .filter(this.zoomFilter())\n      .scaleExtent([0.0625, +Infinity])\n      .on(\"start\", this.zoom().start)\n      .on(\"zoom\", this.zoom().go)\n      .on(\"end\", this.zoom().stop);\n\n    this.zoomer.ratioX = 1;\n    this.zoomer.ratioY = 1;\n\n    context._zoomedXYMinMax = {\n      axis_x: { zoomedMin: null, zoomedMax: null },\n      axis_y: { zoomedMin: null, zoomedMax: null }\n    };\n  },\n\n  dragSubject() {\n    const _this = this.context;\n    const self = this;\n\n    return function(d) {\n      /*\n       * Do not drag if the Ctrl key, Meta key, or plus cursor mode is\n       * not enabled. Also do not drag if zoom-pinching on touchmove\n       * events.\n       */\n      if (!(d3.event.sourceEvent.ctrlKey || d3.event.sourceEvent.metaKey ||\n        _this.ui.cursorMode === \"plus\") || (_this.ui.cursorMode === \"minus\") ||\n        (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        return null;\n      }\n\n      return {\n        x: d3.mouse(this)[0],\n        y: d3.mouse(this)[1]\n      };\n    };\n  },\n\n  drag() {\n    const _this = this.context;\n    const self = this;\n\n    return {\n      start(d, i) {\n        /*\n         * Do not drag if the Ctrl key, Meta key, or plus cursor mode is\n         * not enabled. Also do not drag if zoom-pinching on touchmove\n         * events.\n         */\n        //   if(!(d3.event.sourceEvent.ctrlKey || d3.event.sourceEvent.metaKey ||\n        //          _this.ui.cursorMode === \"plus\") ||\n        //          (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        //          (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        //         return;\n        //     }\n\n        // self.dragLock = true;\n        this.origin = {\n          x: d3.mouse(this)[0],\n          y: d3.mouse(this)[1]\n        };\n        _this.zoomRect.classed(\"vzb-invisible\", false);\n      },\n\n      go(d, i) {\n        /*\n         * Cancel drag if drag lock is false, or when zoom-pinching via\n         * touchmove events.\n         */\n        // if (!self.dragLock || (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        //             (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        //   self.dragLock = false;\n\n        //   _this.zoomRect\n        //     .attr(\"width\", 0)\n        //     .attr(\"height\", 0)\n        //     .classed(\"vzb-invisible\", true);\n\n        //   return;\n        // }\n\n        const origin = this.origin;\n        const mouse = {\n          x: d3.event.x,\n          y: d3.event.y\n        };\n\n        _this.zoomRect\n          .attr(\"x\", Math.min(mouse.x, origin.x))\n          .attr(\"y\", Math.min(mouse.y, origin.y))\n          .attr(\"width\", Math.abs(mouse.x - origin.x))\n          .attr(\"height\", Math.abs(mouse.y - origin.y));\n      },\n\n      stop(e) {\n        // if (!self.dragLock) return;\n        // self.dragLock = false;\n\n        _this.zoomRect\n          .attr(\"width\", 0)\n          .attr(\"height\", 0)\n          .classed(\"vzb-invisible\", true);\n\n        this.target = {\n          x: d3.mouse(this)[0],\n          y: d3.mouse(this)[1]\n        };\n        if (Math.abs(this.origin.x - this.target.x) < 10 || Math.abs(this.origin.y - this.target.y) < 10) return;\n\n        /*\n         * Only compensate for dragging when the Ctrl key or Meta key\n         * are pressed, or if the cursorMode is not in plus mode.\n         */\n        const compensateDragging = d3.event.sourceEvent.ctrlKey ||\n          d3.event.sourceEvent.metaKey ||\n          _this.ui.cursorMode === \"plus\";\n\n        self._zoomOnRectangle(\n          d3.select(this),\n          this.origin.x,\n          this.origin.y,\n          this.target.x,\n          this.target.y,\n          compensateDragging, 500\n        );\n      }\n    };\n  },\n  zoomFilter() {\n    const _this = this.context;\n    const self = this;\n\n    return function(d) {\n      const event = d3.event;\n\n      if (event.ctrlKey || event.metaKey) return false;\n\n      // Cancel drag lock when zoom-pinching via touchmove events.\n      if ((event.type === \"touchmove\" || event.type === \"touchstart\") &&\n        (event.touches.length > 1 || event.targetTouches.length > 1)) return true;\n\n      if ((event.type === \"wheel\" || event.type === \"mousewheel\") &&\n        _this.ui.zoomOnScrolling) {\n        // if (_this.scrollableAncestor) {\n        //   _this.scrollableAncestor.scrollTop -= (event.deltaY || -event.wheelDelta);\n        // }\n        // d3.event.scale = null;\n        //zoomer.scale(this.savedScale);\n        return true;\n      }\n\n      if ((event.type === \"mousedown\" || event.type === \"touchstart\") &&\n        (_this.ui.cursorMode !== \"plus\") && (_this.ui.cursorMode !== \"minus\") &&\n        (_this.ui.panWithArrow || _this.ui.cursorMode === \"hand\")) return true;\n\n      return false;\n    };\n  },\n  zoom() {\n    const _this = this.context;\n    const zoomer = this.zoomer;\n    const self = this;\n\n    return {\n      start() {\n        //this.savedScale = zoomer.scale;\n        if ((_this.ui.cursorMode !== \"plus\") && (_this.ui.cursorMode !== \"minus\")) {\n          _this.chartSvg.classed(\"vzb-zooming\", true);\n        }\n\n        _this.model._data.marker.clearHighlighted();\n        _this._setTooltip();\n\n      },\n      go() {\n\n        const sourceEvent = d3.event.sourceEvent;\n\n        //if (sourceEvent != null && (sourceEvent.ctrlKey || sourceEvent.metaKey)) return;\n\n        // Cancel drag lock when zoom-pinching via touchmove events.\n        // if (sourceEvent !== null &&\n        //             (sourceEvent.type === \"touchmove\" || sourceEvent.type === \"touchstart\") &&\n        //             (sourceEvent.touches.length > 1 || sourceEvent.targetTouches.length > 1)) {\n        //   self.dragLock = false;\n        // }\n\n        //if (self.dragLock) return;\n\n        //send the event to the page if fully zoomed our or page not scrolled into view\n//\n//                    if(d3.event.scale == 1)\n//\n//                    if(utils.getViewportPosition(_this.element.node()).y < 0 && d3.event.scale > 1) {\n//                        _this.scrollableAncestor.scrollTop += d3.event.sourceEvent.deltaY;\n//                        return;\n//                    }\n        /*\n         * Do not zoom on the chart if the scroll event is a wheel\n         * scroll. Instead, redirect the scroll event to the scrollable\n         * ancestor\n         */\n        // if (sourceEvent != null && (sourceEvent.type === \"wheel\" || sourceEvent.type === \"mousewheel\") &&\n        //             !_this.ui.zoomOnScrolling) {\n        //   if (_this.scrollableAncestor) {\n        //     _this.scrollableAncestor.scrollTop += (sourceEvent.deltaY || -sourceEvent.wheelDelta);\n        //   }\n        //   d3.event.scale = null;\n        //             //zoomer.scale(this.savedScale);\n        //   this.quitZoom = true;\n        //   return;\n        // }\n        // this.quitZoom = false;\n\n        //_this.model._data.marker.clearHighlighted();\n        //_this._setTooltip();\n\n        //var transform = d3.zoomTransform(self.zoomSelection.node())\n        //  .translate(, )\n        //.scale(d3.event.transform.k);\n        let zoom = d3.event.transform.k;\n\n        let pan = [d3.event.transform.x, d3.event.transform.y];//d3.event.translate;\n        let ratioY = zoomer.ratioY;\n        let ratioX = zoomer.ratioX;\n\n        _this.draggingNow = true;\n\n        //value protections and fallbacks\n        if (isNaN(zoom) || zoom == null) zoom = zoomer.scale;\n        if (isNaN(zoom) || zoom == null) zoom = 1;\n\n        //TODO: this is a patch to fix #221. A proper code review of zoom and zoomOnRectangle logic is needed\n        /*\n         * Mouse wheel and touchmove events set the zoom value\n         * independently of axis ratios. If the zoom event was triggered\n         * by a mouse wheel event scrolling down or touchmove event with\n         * more than 1 contact that sets zoom to 1, then set the axis\n         * ratios to 1 as well, which will fully zoom out.\n         */\n        if (zoom === 1 && sourceEvent !== null &&\n          ((sourceEvent.type === \"wheel\" || sourceEvent.type === \"mousewheel\") && (sourceEvent.deltaY || -sourceEvent.wheelDelta) > 0 ||\n          sourceEvent.type === \"touchmove\" && sourceEvent.touches.length > 1)) {\n          zoomer.ratioX = 1;\n          ratioX = 1;\n          zoomer.ratioY = 1;\n          ratioY = 1;\n        }\n\n//                if(isNaN(pan[0]) || isNaN(pan[1]) || pan[0] == null || pan[1] == null) pan = zoomer.translate();\n        if (isNaN(pan[0]) || isNaN(pan[1]) || pan[0] == null || pan[1] == null) pan = [0, 0];\n\n        // limit the zooming, so that it never goes below min value of zoom for any of the axes\n        const minZoomScale = zoomer.scaleExtent()[0];\n        if (zoom * ratioY < minZoomScale) {\n          ratioY = minZoomScale / zoom;\n          zoomer.ratioY = ratioY;\n        }\n        if (zoom * ratioX < minZoomScale) {\n          ratioX = minZoomScale / zoom;\n          zoomer.ratioX = ratioX;\n        }\n\n        const zoomXOut = zoom * ratioX < 1;\n        const zoomYOut = zoom * ratioY < 1;\n\n        //limit the panning, so that we are never outside the possible range\n        if (!zoomXOut) {\n          if (pan[0] > 0) pan[0] = 0;\n          if (pan[0] < (1 - zoom * ratioX) * _this.width) pan[0] = (1 - zoom * ratioX) * _this.width;\n        } else {\n          if (pan[0] < 0) pan[0] = 0;\n          if (pan[0] > (1 - zoom * ratioX) * _this.width) pan[0] = (1 - zoom * ratioX) * _this.width;\n        }\n\n        if (!zoomYOut) {\n          if (pan[1] > 0) pan[1] = 0;\n          if (pan[1] < (1 - zoom * ratioY) * _this.height) pan[1] = (1 - zoom * ratioY) * _this.height;\n        } else {\n          if (pan[1] < 0) pan[1] = 0;\n          if (pan[1] > (1 - zoom * ratioY) * _this.height) pan[1] = (1 - zoom * ratioY) * _this.height;\n        }\n\n        //limit zoom translate\n        self.zoomSelection.property(\"__zoom\", d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n\n        const xPanOffset = _this.width * zoom * ratioX;\n        const yPanOffset = _this.height * zoom * ratioY;\n\n        const xRange = [0 * zoom * ratioX + pan[0], xPanOffset + pan[0]];\n        const yRange = [yPanOffset + pan[1], 0 * zoom * ratioY + pan[1]];\n\n        const xRangeBumped = _this._rangeBump(xRange);\n        const yRangeBumped = _this._rangeBump(yRange);\n\n        /*\n         * Shift xRange and yRange by the difference between the bumped\n         * ranges, which is scaled by the zoom factor. This accounts for\n         * the range bump, which controls a gutter around the\n         * bubblechart, while correctly zooming.\n         */\n        const xRangeMinOffset = (xRangeBumped[0] - xRange[0]) * zoom * ratioX;\n        const xRangeMaxOffset = (xRangeBumped[1] - xRange[1]) * zoom * ratioX;\n\n        const yRangeMinOffset = (yRangeBumped[0] - yRange[0]) * zoom * ratioY;\n        const yRangeMaxOffset = (yRangeBumped[1] - yRange[1]) * zoom * ratioY;\n\n        xRange[0] += xRangeMinOffset;\n        xRange[1] += xRangeMaxOffset;\n\n        yRange[0] += yRangeMinOffset;\n        yRange[1] += yRangeMaxOffset;\n\n        // Calculate the maximum xRange and yRange available.\n        const xRangeBounds = [0, _this.width];\n        const yRangeBounds = [_this.height, 0];\n\n        const xRangeBoundsBumped = _this._rangeBump(xRangeBounds);\n        const yRangeBoundsBumped = _this._rangeBump(yRangeBounds);\n\n        /*\n         * Set the pan to account for the range bump by subtracting\n         * offsets and preventing panning past the range bump gutter.\n         */\n        if (!zoomXOut) {\n          if (xRange[0] > xRangeBoundsBumped[0]) pan[0] = xRangeBoundsBumped[0] - xRangeMinOffset;\n          if (xRange[1] < xRangeBoundsBumped[1]) pan[0] = xRangeBoundsBumped[1] - xRangeMaxOffset - xPanOffset;\n        } else {\n          if (xRange[0] < xRangeBoundsBumped[0]) pan[0] = xRangeBoundsBumped[0] - xRangeMinOffset;\n          if (xRange[1] > xRangeBoundsBumped[1]) pan[0] = xRangeBoundsBumped[1] - xRangeMaxOffset - xPanOffset;\n        }\n\n        if (!zoomYOut) {\n          if (yRange[0] < yRangeBoundsBumped[0]) pan[1] = yRangeBoundsBumped[0] - yRangeMinOffset - yPanOffset;\n          if (yRange[1] > yRangeBoundsBumped[1]) pan[1] = yRangeBoundsBumped[1] - yRangeMaxOffset;\n        } else {\n          if (yRange[0] > yRangeBoundsBumped[0]) pan[1] = yRangeBoundsBumped[0] - yRangeMinOffset - yPanOffset;\n          if (yRange[1] < yRangeBoundsBumped[1]) pan[1] = yRangeBoundsBumped[1] - yRangeMaxOffset;\n        }\n\n        //zoomer.translate = pan;\n        //self.zoomSelection.property(\"__zoom\", d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n\n        /*\n         * Clamp the xRange and yRange by the amount that the bounds\n         * that are range bumped.\n         *\n         * Additionally, take the amount clamped on the end of the range\n         * and either subtract or add it to the range's other end. This\n         * prevents visible stretching of the range when only panning.\n         */\n        if (!zoomXOut) {\n          if (xRange[0] > xRangeBoundsBumped[0]) {\n            xRange[1] -= Math.abs(xRange[0] - xRangeBoundsBumped[0]);\n            xRange[0] = xRangeBoundsBumped[0];\n          }\n\n          if (xRange[1] < xRangeBoundsBumped[1]) {\n            xRange[0] += Math.abs(xRange[1] - xRangeBoundsBumped[1]);\n            xRange[1] = xRangeBoundsBumped[1];\n          }\n        } else {\n          if (xRange[0] < xRangeBoundsBumped[0]) {\n            xRange[1] += Math.abs(xRange[0] - xRangeBoundsBumped[0]);\n            xRange[0] = xRangeBoundsBumped[0];\n          }\n\n          if (xRange[1] > xRangeBoundsBumped[1]) {\n            xRange[0] -= Math.abs(xRange[1] - xRangeBoundsBumped[1]);\n            xRange[1] = xRangeBoundsBumped[1];\n          }\n        }\n\n        if (!zoomYOut) {\n          if (yRange[0] < yRangeBoundsBumped[0]) {\n            yRange[1] += Math.abs(yRange[0] - yRangeBoundsBumped[0]);\n            yRange[0] = yRangeBoundsBumped[0];\n          }\n\n          if (yRange[1] > yRangeBoundsBumped[1]) {\n            yRange[0] -= Math.abs(yRange[1] - yRangeBoundsBumped[1]);\n            yRange[1] = yRangeBoundsBumped[1];\n          }\n        } else {\n          if (yRange[0] > yRangeBoundsBumped[0]) {\n            yRange[1] -= Math.abs(yRange[0] - yRangeBoundsBumped[0]);\n            yRange[0] = yRangeBoundsBumped[0];\n          }\n\n          if (yRange[1] < yRangeBoundsBumped[1]) {\n            yRange[0] += Math.abs(yRange[1] - yRangeBoundsBumped[1]);\n            yRange[1] = yRangeBoundsBumped[1];\n          }\n        }\n\n        if (_this.model.marker.axis_x.scaleType === \"ordinal\") {\n          _this.xScale.rangeBands(xRange);\n        } else {\n          _this.xScale.range(xRange);\n        }\n\n        if (_this.model.marker.axis_y.scaleType === \"ordinal\") {\n          _this.yScale.rangeBands(yRange);\n        } else {\n          _this.yScale.range(yRange);\n        }\n\n        const formatter = function(n) {\n          return utils.isDate(n) ? n : +n.toFixed(2);\n        };\n\n        const zoomedXRange = xRangeBoundsBumped;\n        const zoomedYRange = yRangeBoundsBumped;\n\n        /*\n         * Set the zoomed min/max to the correct value depending on if the\n         * min/max values lie within the range bound regions.\n         */\n        /*\n         if(!zoomXOut) {\n         zoomedXRange[0] = xRangeBounds[0] > xRange[0] ? xRangeBounds[0] : xRange[0];\n         zoomedXRange[1] = xRangeBounds[1] < xRange[1] ? xRangeBounds[1] : xRange[1];\n         }\n\n         if(!zoomYOut) {\n         zoomedYRange[0] = yRangeBounds[0] < yRange[0] ? yRangeBounds[0] : yRange[0];\n         zoomedYRange[1] = yRangeBounds[1] > yRange[1] ? yRangeBounds[1] : yRange[1];\n         }\n         */\n\n        _this._zoomedXYMinMax = {\n          axis_x: {\n            zoomedMin: formatter(_this.xScale.invert(zoomedXRange[0])),\n            zoomedMax: formatter(_this.xScale.invert(zoomedXRange[1]))\n          },\n          axis_y: {\n            zoomedMin: formatter(_this.yScale.invert(zoomedYRange[0])),\n            zoomedMax: formatter(_this.yScale.invert(zoomedYRange[1]))\n          }\n        };\n\n\n        if (!zoomer.dontFeedToState) _this.model.marker.set(_this._zoomedXYMinMax, null, false /*avoid storing it in URL*/);\n\n        const optionsY = _this.yAxis.labelerOptions();\n        const optionsX = _this.xAxis.labelerOptions();\n        optionsY.limitMaxTickNumber = zoom * ratioY < 1.5 ? 8 : zoom * ratioY * 8;\n        optionsX.limitMaxTickNumber = zoom * ratioX < 1.5 ? 8 : zoom * ratioX * 8;\n        optionsY.transitionDuration = zoomer.duration;\n        optionsX.transitionDuration = zoomer.duration;\n\n        _this.xAxisEl.call(_this.xAxis.labelerOptions(optionsX));\n        _this.yAxisEl.call(_this.yAxis.labelerOptions(optionsY));\n        _this.redrawDataPoints(zoomer.duration);\n        _this._trails.run(\"resize\", null, zoomer.duration);\n\n        zoomer.duration = 0;\n      },\n\n      stop() {\n        _this.chartSvg.classed(\"vzb-zooming\", false);\n\n        _this.draggingNow = false;\n\n        // if (this.quitZoom) return;\n\n        //Force the update of the URL and history, with the same values\n        if (!zoomer.dontFeedToState) _this.model.marker.set(_this._zoomedXYMinMax, true, true);\n        zoomer.dontFeedToState = null;\n      }\n    };\n  },\n\n  expandCanvas(duration) {\n    const _this = this.context;\n    if (!duration) duration = _this.duration;\n\n    //d3 extent returns min and max of the input array as [min, max]\n    const mmX = d3.extent(utils.values(_this.frame.axis_x));\n    const mmY = d3.extent(utils.values(_this.frame.axis_y));\n\n    //protection agains unreasonable min-max results -- abort function\n    if (!mmX[0] && mmX[0] !== 0 || !mmX[1] && mmX[1] !== 0 || !mmY[0] && mmY[0] !== 0 || !mmY[1] && mmY[1] !== 0) {\n      return utils.warn(\"panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action\");\n    }\n    /*\n     * Use a range bumped scale to correctly accommodate the range bump\n     * gutter.\n     */\n    const suggestedFrame = {\n      x1: _this.xScale(mmX[0]),\n      y1: _this.yScale(mmY[0]),\n      x2: _this.xScale(mmX[1]),\n      y2: _this.yScale(mmY[1])\n    };\n    const xBounds = [0, _this.width];\n    const yBounds = [_this.height, 0];\n\n    // Get the current zoom frame based on the current dimensions.\n    const frame = {\n      x1: xBounds[0],\n      x2: xBounds[1],\n      y1: yBounds[0],\n      y2: yBounds[1]\n    };\n\n    const TOLERANCE = 0.0;\n\n    /*\n     * If there is no current zoom frame, or if any of the suggested frame\n     * points extend outside of the current zoom frame, then expand the\n     * canvas.\n     */\n    if (!_this.isCanvasPreviouslyExpanded ||\n      suggestedFrame.x1 < frame.x1 * (1 - TOLERANCE) || suggestedFrame.x2 > frame.x2 * (1 + TOLERANCE) ||\n      suggestedFrame.y2 < frame.y2 * (1 - TOLERANCE) || suggestedFrame.y1 > frame.y1 * (1 + TOLERANCE)) {\n      /*\n       * If there is already a zoom frame, then clamp the suggested frame\n       * points to only zoom out and expand the canvas.\n       *\n       * If any of x1, x2, y1, or y2 is within the current frame\n       * boundaries, then clamp them to the frame boundaries. If any of\n       * the above values will translate into a data value that is outside\n       * of the possible data range, then clamp them to the frame\n       * coordinate that corresponds to the maximum data value that can\n       * be displayed.\n       */\n      if (_this.isCanvasPreviouslyExpanded) {\n        /*\n         * Calculate bounds and bumped scale for calculating the data boundaries\n         * to which the suggested frame points need to be clamped.\n         */\n        const xBoundsBumped = _this._rangeBump(xBounds);\n        const yBoundsBumped = _this._rangeBump(yBounds);\n\n        if (suggestedFrame.x1 > xBoundsBumped[0]) suggestedFrame.x1 = xBoundsBumped[0];\n        if (suggestedFrame.x2 < xBoundsBumped[1]) suggestedFrame.x2 = xBoundsBumped[1];\n        if (suggestedFrame.y1 < yBoundsBumped[0]) suggestedFrame.y1 = yBoundsBumped[0];\n        if (suggestedFrame.y2 > yBoundsBumped[0]) suggestedFrame.y2 = yBoundsBumped[1];\n      }\n\n      _this.isCanvasPreviouslyExpanded = true;\n      this._zoomOnRectangle(_this.element, suggestedFrame.x1, suggestedFrame.y1,\n        suggestedFrame.x2, suggestedFrame.y2, false, duration);\n    } else {\n      _this.redrawDataPoints(duration);\n    }\n  },\n\n  zoomToMaxMin(zoomedMinX, zoomedMaxX, zoomedMinY, zoomedMaxY, duration, dontFeedToState) {\n    const _this = this.context;\n    let minX = zoomedMinX;\n    let maxX = zoomedMaxX;\n    let minY = zoomedMinY;\n    let maxY = zoomedMaxY;\n\n    const xDomain = _this.xScale.domain();\n    const yDomain = _this.yScale.domain();\n\n    /*\n     * Prevent zoomout if only one of zoom edges set outside domain\n     */\n    if (minX < xDomain[0] && maxX < xDomain[1]) minX = xDomain[0];\n    if (minX > xDomain[0] && maxX > xDomain[1]) maxX = xDomain[1];\n    if (minY < yDomain[0] && maxY < yDomain[1]) minY = yDomain[0];\n    if (minY > yDomain[0] && maxY > yDomain[1]) maxY = yDomain[1];\n\n\n    const xRange = [_this.xScale(minX), _this.xScale(maxX)];\n    const yRange = [_this.yScale(minY), _this.yScale(maxY)];\n\n\n    this._zoomOnRectangle(_this.element, xRange[0], yRange[0], xRange[1], yRange[1], false, duration, dontFeedToState);\n  },\n\n  _zoomOnRectangle(element, zoomedX1, zoomedY1, zoomedX2, zoomedY2, compensateDragging, duration, dontFeedToState) {\n    const _this = this.context;\n    const zoomer = this.zoomer;\n    const transform = d3.zoomTransform(this.zoomSelection.node());\n\n    const x1 = zoomedX1;\n    const y1 = zoomedY1;\n    const x2 = zoomedX2;\n    const y2 = zoomedY2;\n\n    /*\n     * When dragging to draw a rectangle, the translate vector has (x2 - x1)\n     * added to zoomer.translate()[0], and (y2 - 1) added to\n     * zoomer.translate()[1].\n     *\n     * We need to compensate for this addition when\n     * zooming with a rectangle, because zooming with a rectangle will\n     * update the translate vector with new values based on the rectangle\n     * dimensions.\n     */\n    if (compensateDragging) {\n      transform.translate(\n        x1 - x2,\n        y1 - y2\n      );\n      // zoomer.translate([\n      //     zoomer.translate()[0] + x1 - x2,\n      //     zoomer.translate()[1] + y1 - y2\n      // ]);\n    }\n\n    const xRangeBounds = [0, _this.width];\n    const yRangeBounds = [_this.height, 0];\n\n    const xRangeBoundsBumped = _this._rangeBump(xRangeBounds);\n    const yRangeBoundsBumped = _this._rangeBump(yRangeBounds);\n\n    const minZoom = zoomer.scaleExtent()[0];\n    const maxZoom = zoomer.scaleExtent()[1];\n    let zoom, ratioX, ratioY;\n\n    if (x1 == x2 || y1 == y2 || xRangeBoundsBumped[0] == xRangeBoundsBumped[1] || yRangeBoundsBumped[0] == yRangeBoundsBumped[1]) {\n      return utils.warn(\"_zoomOnRectangle(): can not proceed because this may result in infinity zooms\");\n    }\n\n    if (Math.abs(x1 - x2) > Math.abs(y1 - y2)) {\n      zoom = Math.abs(yRangeBoundsBumped[0] - yRangeBoundsBumped[1]) / Math.abs(y1 - y2) * transform.k;\n\n      /*\n       * Clamp the zoom scalar to the maximum zoom allowed before\n       * calculating the next ratioX and ratioY.\n       */\n      if (zoom < minZoom) {\n        zoomer.ratioY *= zoom / transform.k;\n        zoom = minZoom;\n      }\n      if (zoom > maxZoom) zoom = maxZoom;\n\n      ratioX = Math.abs(xRangeBoundsBumped[0] - xRangeBoundsBumped[1]) / Math.abs(x1 - x2) * transform.k / zoom * zoomer.ratioX;\n      ratioY = zoomer.ratioY;\n    } else {\n      zoom = Math.abs(xRangeBoundsBumped[0] - xRangeBoundsBumped[1]) / Math.abs(x1 - x2) * transform.k;\n\n      /*\n       * Clamp the zoom scalar to the maximum zoom allowed before\n       * calculating the next ratioX and ratioY.\n       */\n      if (zoom < minZoom) {\n        zoomer.ratioX *= zoom / transform.k;\n        zoom = minZoom;\n      }\n      if (zoom > maxZoom) zoom = maxZoom;\n\n      ratioY = Math.abs(yRangeBoundsBumped[0] - yRangeBoundsBumped[1]) / Math.abs(y1 - y2) * transform.k / zoom * zoomer.ratioY;\n      ratioX = zoomer.ratioX;\n    }\n\n    const pan = [\n      (transform.x - Math.min(x1, x2)) / transform.k / zoomer.ratioX * zoom * ratioX + (xRangeBoundsBumped[0] - xRangeBounds[0]),\n      (transform.y - Math.min(y1, y2)) / transform.k / zoomer.ratioY * zoom * ratioY + (yRangeBoundsBumped[1] - yRangeBounds[1])\n    ];\n\n    zoomer.dontFeedToState = dontFeedToState;\n    //zoomer.scale(zoom);\n    zoomer.ratioY = ratioY || 1; //NaN defaults to 1\n    zoomer.ratioX = ratioX || 1; //NaN defaults to 1\n    //zoomer.translate(pan);\n    zoomer.duration = duration ? duration : 0;\n\n    //zoomer.event(element);\n    this.zoomSelection.call(zoomer.transform, d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n  },\n\n  /*\n   * Incrementally zoom in or out and pan the view so that it never looses the point where click happened\n   * this function is a modified d3's own zoom behavior on double click\n   * for the original code see https://github.com/mbostock/d3/blob/master/src/behavior/zoom.js\n   * function dblclicked() and what it refers to\n   */\n  zoomByIncrement(direction, duration) {\n    const _this = this.context;\n    const transform = d3.zoomTransform(this.zoomSelection.node());\n\n    let ratio = transform.k;\n    const pan = [transform.x, transform.y];\n\n    const mouse = d3.mouse(this.zoomSelection.node());\n    let k = Math.log(ratio) / Math.LN2;\n\n    //change factor direction based on the input. default is no direction supplied\n    if (direction == \"plus\" || !direction) k = Math.floor(k) + 1;\n    if (direction == \"minus\") k = Math.ceil(k) - 1;\n\n    //decode panning\n    let locus = [(mouse[0] - pan[0]) / ratio, (mouse[1] - pan[1]) / ratio];\n\n    //recalculate zoom ratio\n    const scaleExtent = this.zoomer.scaleExtent();\n    if (ratio == scaleExtent[0]) {\n      this.zoomer.ratioY = 1;\n      this.zoomer.ratioX = 1;\n    }\n    ratio = Math.max(scaleExtent[0], Math.min(scaleExtent[1], Math.pow(2, k)));\n\n    //recalculate panning\n    locus = [locus[0] * ratio + pan[0], locus[1] * ratio + pan[1]];\n    pan[0] += mouse[0] - locus[0];\n    pan[1] += mouse[1] - locus[1];\n\n    //save changes to the zoom behavior and run the event\n    //this.zoomer.scale(ratio);\n    //this.zoomer.translate([pan[0], pan[1]]);\n    this.zoomer.duration = duration || 0;\n    //this.zoomer.event(_this.element);\n    this.zoomSelection.call(this.zoomer.transform, d3.zoomIdentity.translate(pan[0], pan[1]).scale(ratio));\n\n  },\n\n\n  /*\n   * Reset zoom values without triggering a zoom event.\n   */\n  resetZoomState(element) {\n    //this.zoomer.scaleTo(element, 1);\n    this.zoomer.ratioY = 1;\n    this.zoomer.ratioX = 1;\n    //this.zoomer.translate([0, 0]);\n    (element || this.zoomSelection).property(\"__zoom\", d3.zoomIdentity);\n  },\n\n  reset(element, duration) {\n    const _this = this.context;\n    _this.isCanvasPreviouslyExpanded = false;\n\n    //this.zoomer.scale(1);\n    this.zoomer.ratioY = 1;\n    this.zoomer.ratioX = 1;\n    //this.zoomer.translate([0, 0]);\n    this.zoomer.duration = duration || 0;\n    //this.zoomer.event(element || _this.element);\n    (element || this.zoomSelection).call(this.zoomer.transform, d3.zoomIdentity);\n  },\n\n  rerun(element) {\n    const _this = this.context;\n    //this.zoomer.event(element || _this.element);\n    (element || this.zoomSelection).call(this.zoomer.scaleBy, 1);\n  },\n\n  zoomSelection(element) {\n    this.zoomSelection = element;\n  }\n\n});\n\nexport default PanZoom;\n\n\n// WEBPACK FOOTER //\n// ./src/panzoom.js","\nimport cssEscape from \"css.escape\";\n\nconst { utils } = Vizabi;\n\nconst Trail = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n    this._isCreated = null;\n    this.actionsQueue = {};\n    this.entityTrails = {};\n    this.trailsData = [];\n    this.trailsInProgress = {};\n    this.activePromises = {};\n    this.trailTransitions = {};\n    this.delayedIterations = {};\n    this.drawingQueue = {};\n  },\n\n  toggle(arg) {\n    const _context = this.context;\n    if (arg) {\n\n      _context._trails.create().then(() => {\n        _context._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n      });\n    } else {\n      _context._trails.run(\"remove\");\n      _context.model.marker.select.forEach(d => {\n        delete d.trailStartTime;\n      });\n    }\n  },\n\n  create(selection) {\n    const _context = this.context;\n    const _this = this;\n    const KEYS = _context.KEYS;\n    const KEY = _context.KEY;\n    const dataKeys = _context.dataKeys;\n    const TIMEDIM = _context.TIMEDIM;\n    this._isCreated = new Promise((resolve, reject) => {\n      //quit if the function is called accidentally\n      if (!_context.model.ui.chart.trails) return;\n\n      const timePoints = _context.model.time.getAllSteps();\n\n      //work with marker.select (all selected entities), if no particular selection is specified\n      const promises = [];\n      selection = selection == null ? _context.model.marker.select : [selection];\n      _this._clearActions(selection);\n      _this.trailsData = _context.model.marker.select.map(d => {\n        const r = {\n          status: \"created\",\n          selectedEntityData: d\n        };\n        KEYS.forEach(key => r[key] = d[key]);\n        r[KEY] = utils.getKey(d, KEYS);\n        return r;\n      });\n      _this.trailTransitions = {};\n      const _trails = _context.bubbleContainer.selectAll(\"g.vzb-bc-entity.entity-trail\")\n        .data(_this.trailsData, d => (d[KEY]));\n\n      _trails.exit().remove();\n      _trails.enter()\n        .insert(\"g\", function(d) {\n          return this.querySelector(\".bubble-\" + cssEscape(d[KEY]));\n        })\n        .attr(\"class\", d => \"vzb-bc-entity entity-trail trail-\" + d[KEY])\n        .merge(_trails)\n        .each(function(d, index) {\n          // used for prevent move trail start time forward when we have empty values at end of time range\n          const trail = this;\n          promises.push(new Promise((resolve, reject) => {\n            const trailSegmentData = timePoints.map(m => ({\n              t: m,\n              key: d[KEY]\n            }));\n            const entityTrails = d3.select(trail).selectAll(\"g\")\n              .data(trailSegmentData)\n              .classed(\"vzb-invisible\", true);\n\n            entityTrails.exit().remove();\n\n            _this.entityTrails[d[KEY]] = entityTrails.enter().append(\"g\")\n              .attr(\"class\", \"vzb-bc-trailsegment vzb-invisible\")\n              .on(\"mouseover\", function(segment, index) {\n                if (utils.isTouchDevice()) return;\n\n                const pointer = {};\n                pointer[KEY] = segment.key;\n                pointer[TIMEDIM] = segment.t;\n\n                _context._axisProjections(pointer);\n                _context._labels.highlight(d, true);\n                const text = _context.model.time.formatDate(segment.t);\n                const selectedData = utils.find(_context.model.marker.select, f => utils.getKey(f, KEYS) == d[KEY]);\n                _context.model.marker.getFrame(pointer[TIMEDIM], values => {\n                  const x = _context.xScale(values.axis_x[utils.getKey(d, dataKeys.axis_x)]);\n                  const y = _context.yScale(values.axis_y[utils.getKey(d, dataKeys.axis_y)]);\n                  const s = utils.areaToRadius(_context.sScale(values.size[utils.getKey(d, dataKeys.size)]));\n                  const c = values.color[utils.getKey(d, dataKeys.color)] != null ? _context.cScale(values.color[utils.getKey(d, dataKeys.color)]) : _context.COLOR_WHITEISH;\n                  if (text !== selectedData.trailStartTime) {\n                    _context._setTooltip(text, x, y, s + 3, c);\n                  }\n                  _context._setBubbleCrown(x, y, s, c);\n                  _context.model.marker.getModelObject(\"highlight\").trigger(\"change\", {\n                    \"size\": values.size[utils.getKey(d, dataKeys.size)],\n                    \"color\": values.color[utils.getKey(d, dataKeys.color)]\n                  });\n                });\n                //change opacity to OPACITY_HIGHLT = 1.0;\n                d3.select(this).style(\"opacity\", 1.0);\n              })\n              .on(\"mouseout\", function(segment, index) {\n                if (utils.isTouchDevice()) return;\n                _context._axisProjections();\n                _context._setTooltip();\n                _context._setBubbleCrown();\n                _context._labels.highlight(null, false);\n                _context.model.marker.getModelObject(\"highlight\").trigger(\"change\", null);\n                d3.select(this).style(\"opacity\", _context.model.marker.opacityRegular);\n              })\n              .each(function(segment, index) {\n                const view = d3.select(this);\n                view.append(\"circle\");\n                view.append(\"line\");\n              })\n              .merge(entityTrails);\n            resolve();\n          }));\n        });\n      if (promises.length > 0) {\n        Promise.all(promises).then(segments => {\n          resolve(true);\n        });\n      } else {\n        resolve(true);\n      }\n    });\n    return this._isCreated;\n  },\n\n  /**\n   * add actions for each selected entities\n   * @param selections\n   * @param actions\n   * @private\n   */\n  _addActions(selections, actions) {\n    const _context = this.context;\n    const _this = this;\n    const KEYS = _context.KEYS;\n\n    selections.forEach(d => {\n      const key = utils.getKey(d, KEYS);\n      if (!_this.actionsQueue[key]) _this.actionsQueue[key] = [];\n      _this.actionsQueue[key] = [].concat(_this.actionsQueue[key].filter(value => actions.indexOf(value) == -1), actions);\n    });\n  },\n\n  _clearActions(selections) {\n    const _context = this.context;\n    const _this = this;\n    const KEYS = _context.KEYS;\n    \n    selections.forEach(d => {\n      const key = utils.getKey(d, KEYS);\n      if (!_this.actionsQueue[key]) _this.actionsQueue[key] = [];\n      _this.actionsQueue[key] = [];\n      _this.drawingQueue[key] = {};\n      _this.delayedIterations[key] = {};\n      if (!_this.activePromises[key]) _this.activePromises[key] = [];\n      utils.forEach(_this.activePromises[key], (promise, key) => {\n        if (promise.status === \"pending\") promise.reject();\n      });\n      _this.trailsInProgress[key] = null;\n      _this.activePromises[key] = [];\n    });\n  },\n\n  _getNextAction(key) {\n    return this.actionsQueue[key].shift();\n  },\n\n  run(actions, selection, duration) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    if (!this._isCreated || _context.model.time.splash) return;\n    if (typeof actions === \"string\") actions = [actions];\n\n    this._isCreated.then(() => {\n      //quit if function is called accidentally\n      if ((!_context.model.ui.chart.trails || !_context.model.marker.select.length) && actions != \"remove\") return;\n\n      if (!duration) duration = 0;\n\n      //work with marker.select (all selected entities), if no particular selection is specified\n      selection = selection == null ? _context.model.marker.select : [selection];\n      for (let i = 0; i < actions.length; i++) {\n        if ([\"resize\", \"recolor\", \"remove\"].indexOf(actions[i]) != -1) {\n          const action = actions.splice(i, 1).pop();\n          --i;\n          _this.trailsData.forEach(d => {\n            const trail = _this.entityTrails[d[KEY]];\n            _context._trails[\"_\" + action](trail, duration, d);\n          });\n        }\n      }\n      if (actions.length == 0) {\n        return;\n      }\n      _this._addActions(selection, actions);\n      _this.trailsData.forEach(d => {\n        if (actions.indexOf(\"findVisible\") != -1) {\n          _this.drawingQueue[d[KEY]] = {};\n          _this.delayedIterations[d[KEY]] = {};\n        }\n        const trail = _this.entityTrails[d[KEY]];\n        //do all the actions over \"trail\"\n        const executeSequential = function(index) { // some function can be async, but we should run next when previous completed\n          const action = _this._getNextAction(d[KEY]);\n          if (action) {\n            _this.trailsInProgress[d[KEY]] = action;\n            const response = _context._trails[\"_\" + action](trail, duration, d);\n            if (response && response instanceof Promise) {\n              response.then(() => {\n                _this.trailsInProgress[d[KEY]] = null;\n                executeSequential(index + 1);\n              }, () => {\n                _this.trailsInProgress[d[KEY]] = null;\n              });\n            } else {\n              _this.trailsInProgress[d[KEY]] = null;\n              executeSequential(index + 1);\n            }\n          }\n        };\n        if (!_this.trailsInProgress[d[KEY]]) {\n          executeSequential(0);\n        }\n      });\n    });\n\n  },\n\n\n  _remove(trail, duration, d) {\n    this.actionsQueue[d[this.context.KEY]] = [];\n    if (trail) { // TODO: in some reason run twice\n      d3.select(this.entityTrails[d[this.context.KEY]].node().parentNode).remove();\n      this.entityTrails[d[this.context.KEY]] = null;\n    }\n  },\n\n  _resize(trail, duration, d) {\n    const _context = this.context;\n    if (_context.model.time.splash) {\n      return;\n    }\n//    this._isCreated.then(function() {\n    let updateLabel = false;\n\n    trail.each(function(segment, index) {\n\n      if (segment.valueY == null || segment.valueX == null || segment.valueS == null) return;\n\n      const view = d3.select(this);\n      if (duration) {\n        view.select(\"circle\")\n          .transition().duration(duration).ease(d3.easeLinear)\n          .attr(\"cy\", _context.yScale(segment.valueY))\n          .attr(\"cx\", _context.xScale(segment.valueX))\n          .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)));\n      } else {\n        view.select(\"circle\").interrupt()\n          .attr(\"cy\", _context.yScale(segment.valueY))\n          .attr(\"cx\", _context.xScale(segment.valueX))\n          .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n          .transition();\n      }\n\n      if (!updateLabel && !segment.transparent) {\n        updateLabel = true;\n        _context._labels.updateLabelOnlyPosition(d, null, { \"scaledS0\": utils.areaToRadius(_context.sScale(segment.valueS)) });\n      }\n\n      if (!segment.next) return;\n      const next = segment.next;\n      if (next == null) return;\n      if (next.valueY == null || next.valueX == null) return;\n\n      const lineLength = Math.sqrt(\n        Math.pow(_context.xScale(segment.valueX) - _context.xScale(next.valueX), 2) +\n        Math.pow(_context.yScale(segment.valueY) - _context.yScale(next.valueY), 2)\n      );\n      if (duration) {\n        view.select(\"line\")\n          .transition().duration(duration).ease(d3.easeLinear)\n          .attr(\"x1\", _context.xScale(next.valueX))\n          .attr(\"y1\", _context.yScale(next.valueY))\n          .attr(\"x2\", _context.xScale(segment.valueX))\n          .attr(\"y2\", _context.yScale(segment.valueY))\n          .attr(\"stroke-dasharray\", lineLength)\n          .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)));\n      } else {\n        view.select(\"line\").interrupt()\n          .attr(\"x1\", _context.xScale(next.valueX))\n          .attr(\"y1\", _context.yScale(next.valueY))\n          .attr(\"x2\", _context.xScale(segment.valueX))\n          .attr(\"y2\", _context.yScale(segment.valueY))\n          .attr(\"stroke-dasharray\", lineLength)\n          .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n          .transition();\n      }\n    });\n  },\n\n  _recolor(trail, duration, d) {\n    const _context = this.context;\n\n    trail.each(function(segment, index) {\n\n      const view = d3.select(this);\n\n      const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n        //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n        _context.model.marker.color.getColorShade({\n          colorID: segment.valueC,\n          shadeID: \"shade\"\n        })\n        :\n        //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n        (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n      view.select(\"circle\")\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n      view.select(\"line\")\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"stroke\", strokeColor);\n    });\n  },\n\n  _opacityHandler(trail, duration, d) {\n    const _context = this.context;\n\n    trail.each(function(segment, index) {\n\n      const view = d3.select(this);\n\n      view\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"opacity\", d.opacity || _context.model.marker.opacityRegular);\n    });\n  },\n\n\n  _findVisible(trail, duration, d) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    const dataKeys = _context.dataKeys;\n    return new Promise((resolve, reject) => {\n      new Promise((resolve1, reject1) => {\n        if (!d.limits) {\n          _context.model.marker.getEntityLimits(d[KEY]).then(limits => {\n            d.limits = limits;\n            resolve1();\n          });\n        } else {\n          resolve1();\n        }\n      }).then(() => {\n        if (!d.selectedEntityData.trailStartTime) {\n          d.selectedEntityData.trailStartTime = _context.model.time.formatDate(_context.time);\n        }\n        let trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n        if (_context.time - trailStartTime < 0 || d.limits.min - trailStartTime > 0) {\n          if (_context.time - trailStartTime < 0) {\n            // move trail start time with trail label back if need\n            d.selectedEntityData.trailStartTime = _context.model.time.formatDate(d3.max([_context.time, d.limits.min]));\n            trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n          } else {\n            // move trail start time with trail label to start time if need\n            d.selectedEntityData.trailStartTime = _context.model.time.formatDate(d.limits.min);\n            trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n          }\n          const cache = _context._labels.cached[d[KEY]];\n          const valueS = _context.frame.size[utils.getKey(d, dataKeys.size)];\n          const valueC = _context.frame.color[utils.getKey(d, dataKeys.color)];\n          cache.labelX0 = _context.frame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n          cache.labelY0 = _context.frame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n          cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_context.sScale(valueS)) : null;\n          cache.scaledC0 = valueC != null ? _context.cScale(valueC) : _context.COLOR_WHITEISH;\n          _context._updateLabel(d, 0, _context.frame, cache.labelX0, cache.labelY0, valueS, valueC, _context.frame.label[utils.getKey(d, dataKeys.label)], _context.frame.size_label[utils.getKey(d, dataKeys.size_label)], 0, true);\n        }\n        trail.each((segment, index) => {\n          // segment is transparent if it is after current time or before trail StartTime\n          const segmentVisibility = segment.transparent;\n          segment.transparent = d.selectedEntityData.trailStartTime == null || (segment.t - _context.time > 0) || (trailStartTime - segment.t > 0)\n            //no trail segment should be visible if leading bubble is shifted backwards, beyond start time\n            || (d.selectedEntityData.trailStartTime - _context.model.time.formatDate(_context.time) >= 0);\n          // always update nearest 2 points\n          if (segmentVisibility != segment.transparent || Math.abs(_context.model.time.formatDate(segment.t) - _context.model.time.formatDate(_context.time)) < 2) segment.visibilityChanged = true; // segment changed, so need to update it\n          if (segment.transparent) {\n            d3.select(trail._groups[0][index]).classed(\"vzb-invisible\", segment.transparent);\n          }\n        });\n        _this.drawingQueue[d[KEY]] = {};\n        _this.delayedIterations[d[KEY]] = {};\n        resolve();\n      });\n    });\n  },\n\n  _abortAnimation() {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    _this.trailsData.forEach(d => {\n      if (_this.trailTransitions[d[KEY]]) {\n        _this.trailTransitions[d[KEY]].select(\"line\").interrupt().transition();\n      }\n    });\n  },\n\n  _reveal(trail, duration, d) {\n    const _context = this.context;\n    if(_context.model.time.playing) duration = _context.model.time.delay;\n    const _this = this;\n    const KEYS = _context.KEYS;\n    const KEY = _context.KEY;\n    const dataKeys = _context.dataKeys;\n    d.status = \"reveal\";\n    const trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n    const generateTrailSegment = function(trail, index, nextIndex, level) {\n      return new Promise((resolve, reject) => {\n        const view = d3.select(trail._groups[0][index]);\n\n        const segment = view.datum();\n\n        //console.log(d[KEY] + \" transparent: \" + segment.transparent + \" vis_changed:\" + segment.visibilityChanged);\n        if (nextIndex - index == 1) {\n          if (segment.transparent) {\n            view.classed(\"vzb-invisible\", segment.transparent);\n            return resolve();\n          } else if (!segment.visibilityChanged) { // pass segment if it is not changed\n            return resolve();\n          }\n        }\n        _context.model.marker.getFrame(segment.t, frame => {\n          if (d.status != \"reveal\") return resolve();\n          if (!frame) return resolve();\n          segment.valueY = frame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n          segment.valueX = frame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n          segment.valueS = frame.size[utils.getKey(d, dataKeys.size)];\n          segment.valueC = frame.color[utils.getKey(d, dataKeys.color)];\n\n          if (segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n            return resolve();\n          }\n\n          // fix label position if it not in correct place\n          if (trailStartTime && trailStartTime.toString() == segment.t.toString()) {\n            const cache = _context._labels.cached[d[KEY]];\n            cache.labelX0 = segment.valueX;\n            cache.labelY0 = segment.valueY;\n            const valueS = segment.valueS;\n            cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_context.sScale(valueS)) : null;\n            cache.scaledC0 = segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH;\n            _context._updateLabel(d, index, frame, segment.valueX, segment.valueY, segment.valueS, segment.valueC, frame.label[utils.getKey(d, dataKeys.label)], frame.size_label[utils.getKey(d, dataKeys.size_label)], 0, true);\n          }\n          view.select(\"circle\")\n          //.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"cy\", _context.yScale(segment.valueY))\n            .attr(\"cx\", _context.xScale(segment.valueX))\n            .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n            .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n\n          view.select(\"line\")\n            .attr(\"x2\", _context.xScale(segment.valueX))\n            .attr(\"y2\", _context.yScale(segment.valueY))\n            .attr(\"x1\", _context.xScale(segment.valueX))\n            .attr(\"y1\", _context.yScale(segment.valueY));\n\n          // last point should have data for line but it is invisible\n          if (_context.time - segment.t > 0) {\n            segment.visibilityChanged = false;\n            view.classed(\"vzb-invisible\", segment.transparent);\n          } else {\n            view.classed(\"vzb-invisible\", true);\n          }\n\n          if (!trail._groups[0][nextIndex] || _context.time.toString() == segment.t.toString()) {\n            return resolve();\n          }\n\n          const next = d3.select(trail._groups[0][nextIndex]);\n          const nextSegment = next.datum();\n          nextSegment.previous = segment;\n          segment.next = nextSegment;\n          let nextTime = nextSegment.t;\n          if (_context.time - nextSegment.t < 0) { // time is not equal start of year\n            segment.visibilityChanged = true; // redraw needed next time because line not have full length\n            nextTime = _context.time;\n          }\n          _context.model.marker.getFrame(nextTime, nextFrame => {\n            if (d.status != \"reveal\") return resolve();\n            if (!nextFrame || segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n              return resolve();\n            }\n\n            if (nextFrame.axis_x[utils.getKey(d, dataKeys.axis_x)] == null || nextFrame.axis_y[utils.getKey(d, dataKeys.axis_y)] == null) {\n              return resolve();\n            }\n\n            nextSegment.valueY = nextFrame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n            nextSegment.valueX = nextFrame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n            nextSegment.valueS = nextFrame.size[utils.getKey(d, dataKeys.size)];\n            nextSegment.valueC = nextFrame.color[utils.getKey(d, dataKeys.color)];\n\n            _this.trailTransitions[d[KEY]] = view;\n            const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n              //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n              _context.model.marker.color.getColorShade({\n                colorID: segment.valueC,\n                shadeID: \"shade\"\n              })\n              :\n              //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n              (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n            const lineLength = Math.sqrt(\n              Math.pow(_context.xScale(segment.valueX) - _context.xScale(nextSegment.valueX), 2) +\n              Math.pow(_context.yScale(segment.valueY) - _context.yScale(nextSegment.valueY), 2)\n            );\n            view.select(\"line\")\n              .attr(\"stroke-dasharray\", lineLength)\n              .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"stroke\", strokeColor)\n              .transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"x1\", _context.xScale(nextSegment.valueX))\n              .attr(\"y1\", _context.yScale(nextSegment.valueY))\n              .attr(\"x2\", _context.xScale(segment.valueX))\n              .attr(\"y2\", _context.yScale(segment.valueY));\n            if (nextIndex - index > 1) {\n              addNewIntervals(index, nextIndex);\n              return resolve();\n            }\n            return resolve();\n          });\n        });\n      });\n    };\n    const addPointBetween = function(previousIndex, nextIndex, index) {\n      return new Promise((resolve, reject) => {\n        const previous = d3.select(trail._groups[0][previousIndex]);\n        const next = d3.select(trail._groups[0][nextIndex]);\n        const view = d3.select(trail._groups[0][index]);\n        const previousSegment = previous.datum();\n        const nextSegment = next.datum();\n        const segment = view.datum();\n\n        if ((!previousSegment.previous && !previousSegment.next) || (!nextSegment.previous && !nextSegment.next)) {\n          // segment data cleared by create action\n          return resolve();\n        }\n\n        _context.model.marker.getFrame(segment.t, frame => {\n          if (d.status != \"reveal\") return resolve();\n          if (!frame ||\n            (typeof frame.axis_x === \"undefined\") || frame.axis_x[utils.getKey(d, dataKeys.axis_x)] == null ||\n            (typeof frame.axis_y === \"undefined\") || frame.axis_y[utils.getKey(d, dataKeys.axis_y)] == null) {\n            utils.warn(\"Frame for trail missed: \" + segment.t);\n            return resolve();\n          }\n          segment.valueY = frame.axis_y[utils.getKey(d, dataKeys.axis_y)];\n          segment.valueX = frame.axis_x[utils.getKey(d, dataKeys.axis_x)];\n          segment.valueS = frame.size[utils.getKey(d, dataKeys.size)];\n          segment.valueC = frame.color[utils.getKey(d, dataKeys.color)];\n\n          segment.previous = previousSegment;\n          segment.next = nextSegment;\n          previousSegment.next = segment;\n          nextSegment.previous = segment;\n\n          if (segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n            utils.warn(\"Data for trail point missed: \" + segment.t);\n            return resolve();\n          }\n\n          const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n            //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n            _context.model.marker.color.getColorShade({\n              colorID: segment.valueC,\n              shadeID: \"shade\"\n            })\n            :\n            //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n            (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n          const firstLineLength = Math.sqrt(\n            Math.pow(_context.xScale(previousSegment.valueX) - _context.xScale(segment.valueX), 2) +\n            Math.pow(_context.yScale(previousSegment.valueY) - _context.yScale(segment.valueX), 2)\n          );\n\n          previous.select(\"line\")\n            .transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"x1\", _context.xScale(segment.valueX))\n            .attr(\"y1\", _context.yScale(segment.valueY))\n            .attr(\"x2\", _context.xScale(previousSegment.valueX))\n            .attr(\"y2\", _context.yScale(previousSegment.valueY))\n            .attr(\"stroke-dasharray\", firstLineLength)\n            .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(previousSegment.valueS)))\n            .style(\"stroke\", strokeColor);\n\n          view.classed(\"vzb-invisible\", segment.transparent);\n\n          if (!segment.transparent) {\n            view.select(\"circle\")\n            //.transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"cy\", _context.yScale(segment.valueY))\n              .attr(\"cx\", _context.xScale(segment.valueX))\n              .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n\n            const secondLineLength = Math.sqrt(\n              Math.pow(_context.xScale(segment.valueX) - _context.xScale(nextSegment.valueX), 2) +\n              Math.pow(_context.yScale(segment.valueY) - _context.yScale(nextSegment.valueY), 2)\n            );\n\n            view.select(\"line\")\n              .transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"x1\", _context.xScale(nextSegment.valueX))\n              .attr(\"y1\", _context.yScale(nextSegment.valueY))\n              .attr(\"x2\", _context.xScale(segment.valueX))\n              .attr(\"y2\", _context.yScale(segment.valueY))\n              .attr(\"stroke-dasharray\", secondLineLength)\n              .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"stroke\", strokeColor);\n          }\n          addNewIntervals(previousIndex, index, nextIndex);\n          resolve();\n        });\n      });\n    };\n    const addNewIntervals = function(previousIndex, index, nextIndex) {\n      let mediumIndex;\n      if (index - previousIndex > 1) {\n        mediumIndex = getPointBetween(previousIndex, index);\n        _this.delayedIterations[d[KEY]][previousIndex] = {\n          first: previousIndex,\n          next: index,\n          medium: mediumIndex\n        };\n      }\n      if (nextIndex && nextIndex - index > 1) {\n        mediumIndex = getPointBetween(index, nextIndex);\n        _this.delayedIterations[d[KEY]][index] = {\n          first: index,\n          next: nextIndex,\n          medium: mediumIndex\n        };\n      }\n    };\n    const getPointBetween = function(previous, next) {\n      return Math.round(previous + (next - previous) / 2);\n    };\n\n    const _generateKeys = function(d, trail, div) {\n      const response = [];\n      let min = 0, max = 0;\n      const maxValue = d3.min([d.limits.max, _context.time]);\n      const minValue = d3.max([d.limits.min, _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime)]);\n      utils.forEach(trail._groups[0], (segment, index) => {\n        const data = segment.__data__;\n        if (data.t - minValue == 0) {\n          min = index;\n        } else if (data.t - maxValue == 0) {\n          max = index;\n        } else {\n          if (data.t > minValue && data.t < maxValue) {\n            if (_context.model.time.formatDate(data.t) % div == 0 || (data.next && data.previous)) {\n              response.push(index);\n            }\n          }\n        }\n      });\n      response.unshift(min);\n      if (max > 0) {\n        response.push(max);\n      }\n      return response;\n    };\n\n    const processPoints = function() {\n      return new Promise((resolve, reject) => {\n        const processPoint = function() {\n          const pointIndex = Object.keys(_this.drawingQueue[d[KEY]])[Math.floor(Math.random() * Object.keys(_this.drawingQueue[d[KEY]]).length)];\n          const point = JSON.parse(JSON.stringify(_this.drawingQueue[d[KEY]][pointIndex]));\n          delete _this.drawingQueue[d[KEY]][pointIndex];\n          addPointBetween(point.first, point.next, point.medium).then(() => {\n            if (Object.keys(_this.drawingQueue[d[KEY]]).length > 0) {\n              processPoint();\n            } else {\n              resolve();\n            }\n          });\n        };\n        if (Object.keys(_this.drawingQueue[d[KEY]]).length > 0) {\n          processPoint(_this.drawingQueue[d[KEY]]);\n        } else {\n          resolve();\n        }\n      });\n    };\n\n    return new Promise((resolve, reject) => {\n      /**\n       * iteration for each point from first segment to last\n       * @param trail\n       * @param index\n       */\n      const generateTrails = function(trail, index) {\n        if (index < 0 || index >= trail._groups[0].length) {\n          return resolve();\n        }\n        generateTrailSegment(trail, index, index + 1).then(() => {\n          generateTrails(trail, index + 1);\n        }, () => resolve());\n      };\n\n      /**\n       * recursive iteration for drawing point between points calculated in previous step\n       */\n      const processPointsBetween = function() {\n        processPoints().then(() => {\n          if (Object.keys(_this.delayedIterations[d[KEY]]).length == 0) {\n            return resolve();\n          }\n          _this.drawingQueue[d[KEY]] = _this.delayedIterations[d[KEY]];\n          _this.delayedIterations[d[KEY]] = {};\n          processPointsBetween();\n        }, () => resolve());\n      };\n\n      if (_context.model.marker.framesAreReady()) {\n        generateTrails(trail, 0);\n      } else {\n        _this.delayedIterations[d[KEY]] = {};\n        _this.drawingQueue[d[KEY]] = {};\n        const trailKeys = _generateKeys(d, trail, 50);\n        const segments = [];\n        if (trailKeys.length <= 1) {\n          return resolve();\n        }\n\n        _this.delayedIterations[d[KEY]] = {};\n        for (let i = 0; i < trailKeys.length - 1; i++) {\n          segments.push(generateTrailSegment(trail, trailKeys[i], trailKeys[i + 1], 1));\n        }\n        Promise.all(segments).then(() => {\n          if (Object.keys(_this.delayedIterations[d[KEY]]).length == 0) {\n            resolve();\n          } else {\n            _this.drawingQueue[d[KEY]] = _this.delayedIterations[d[KEY]];\n            _this.delayedIterations[d[KEY]] = {};\n            processPointsBetween();\n          }\n        }, () => {\n          resolve();\n        });\n      }\n    });\n  }\n});\n\nexport default Trail;\n\n\n\n// WEBPACK FOOTER //\n// ./src/trail.js","/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n;(function(root, factory) {\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\tif (typeof exports == 'object') {\n\t\t// For Node.js.\n\t\tmodule.exports = factory(root);\n\t} else if (typeof define == 'function' && define.amd) {\n\t\t// For AMD. Register as an anonymous module.\n\t\tdefine([], factory.bind(root, root));\n\t} else {\n\t\t// For browser globals (not exposing the function separately).\n\t\tfactory(root);\n\t}\n}(typeof global != 'undefined' ? global : this, function(root) {\n\n\tif (root.CSS && root.CSS.escape) {\n\t\treturn root.CSS.escape;\n\t}\n\n\t// https://drafts.csswg.org/cssom/#serialize-an-identifier\n\tvar cssEscape = function(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: theres no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, []\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), []\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), []\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, []\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), []\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n\t};\n\n\tif (!root.CSS) {\n\t\troot.CSS = {};\n\t}\n\n\troot.CSS.escape = cssEscape;\n\treturn cssEscape;\n\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/css.escape/css.escape.js\n// module id = 4\n// module chunks = 0 1","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 5\n// module chunks = 0 1","module.exports = \"<!-- Bubble Chart Component -->\\n<div class=\\\"vzb-bubblechart\\\">\\n    <svg class=\\\"vzb-bubblechart-svg vzb-export\\\">\\n        <g class=\\\"vzb-bc-graph\\\">\\n            <g class=\\\"vzb-bc-year\\\"></g>\\n\\n            <svg class=\\\"vzb-bc-axis-x\\\"><g></g></svg>\\n            <svg class=\\\"vzb-bc-axis-y\\\"><g></g></svg>\\n            <line class=\\\"vzb-bc-projection-x\\\"></line>\\n            <line class=\\\"vzb-bc-projection-y\\\"></line>\\n\\n            <svg class=\\\"vzb-bc-bubbles-crop\\\">\\n                <g class=\\\"vzb-zoom-selection\\\"></g>\\n                <line class=\\\"vzb-bc-line-equal-xy vzb-invisible\\\"></line>\\n                <rect class=\\\"vzb-bc-eventarea\\\"></rect>\\n                <g class=\\\"vzb-bc-trails\\\"></g>\\n                <g class=\\\"vzb-bc-bubbles\\\"></g>\\n                <g class=\\\"vzb-bc-lines\\\"></g>\\n                <g class=\\\"vzb-bc-bubble-crown vzb-hidden\\\">\\n                    <circle class=\\\"vzb-crown-glow\\\"></circle>\\n                    <circle class=\\\"vzb-crown\\\"></circle>\\n                </g>\\n            </svg>\\n\\n            <g class=\\\"vzb-bc-axis-y-subtitle\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-subtitle\\\"></g>\\n            <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-s-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-c-title\\\"></g>\\n\\n            <g class=\\\"vzb-bc-axis-y-info vzb-noexport\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n\\n            <svg class=\\\"vzb-bc-labels-crop\\\">\\n                <g class=\\\"vzb-bc-labels\\\"></g>\\n            </svg>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <rect class=\\\"vzb-bc-zoom-rect\\\"></rect>\\n        </g>\\n    </svg>\\n    <svg>\\n        <defs>\\n            <filter id=\\\"vzb-glow-filter\\\" x=\\\"-50%\\\" y=\\\"-50%\\\" width=\\\"200%\\\" height=\\\"200%\\\">\\n                <feGaussianBlur in=\\\"SourceGraphic\\\" stdDeviation=\\\"2\\\"></feGaussianBlur>\\n            </filter>\\n        </defs>\\n    </svg>\\n    <!-- This could possibly be another component -->\\n    <div class=\\\"vzb-tooltip vzb-hidden vzb-tooltip-mobile\\\"></div>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 6\n// module chunks = 0 1","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 7\n// module chunks = 0 1"],"sourceRoot":""}