(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{34:function(t,e){t.exports="./assets/barchart-ds.css"},35:function(t,e){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(2);var n,r=i(1),o=(n=r)&&n.__esModule?n:{default:n};var a=Vizabi.Tool.extend("BarChartDS",{init:function(t,e){this.name="barchartds",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","state.marker_order","state.entities","state.entities_side","state.entities_allpossible","state.entities_geodomain","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),!this.model){var e=t.state.entities;if(Object.keys(e.show).length>0){var i={};e.show[e.dim]&&1!==Object.keys(e.show).length&&(i[e.dim]=e.show[e.dim]),e.show[e.dim]&&1==Object.keys(e.show).length||(e.show=i)}var n=t.state.entities_geodomain;n.skipFilter=t.state.entities.dim===n.dim||t.state.entities_side.dim===n.dim}},default_model:{state:{marker_tags:{}},ui:{chart:{stacked:!0,inpercent:!1,flipSides:!0},buttons:["colors","inpercent","find","side","moreoptions","fullscreen"],dialogs:{popup:["timedisplay","colors","find","side","moreoptions"],sidebar:["timedisplay","colors","find"],moreoptions:["opacity","speed","colors","side","presentation","about"]},presentation:!1},locale:{}},versionInfo:{version:"2.0.1",build:1524203847092}});e.default=a},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=Vizabi,o=r.utils,a=r.Component,s=r.helpers["d3.axisWithLabelPicker"],l=r.iconset.question,u=a.extend("barchartds",{init:function(t,e){this.name="barchartds",this.template=i(3),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"marker_order",type:"marker"},{name:"entities",type:"entities"},{name:"entities_side",type:"entities"},{name:"entities_allpossible",type:"entities"},{name:"entities_geodomain",type:"entities"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.value":function(t){if(n._readyOnce){if(1!=n.model.time.step&&!n.snapped&&!n.model.time.playing&&!n.model.time.dragging){var e=d3.bisectLeft(n.timeSteps,n.model.time.value);if(0!=e&&n.timeSteps[e]-n.model.time.value){n.snapped=!0;var i=n.model.time.value,r=n.timeSteps[e-1],o=i-r<(e=n.timeSteps[e])-i?r:e;n.model.time.value=new Date(o)}}n.snapped||n.model.marker.getFrame(n.model.time.value,function(t){n.frame=t,n.frameAxisX=t.axis_x,n.model.marker_order.getFrame(n.model.time.value,function(t){n.frameOrder=t.hook_order,n._reorderBars(),n._updateEntities(!0),n.updateBarsOpacity()})}),n.snapped=!1}},"change:marker":function(t,e){n._readyOnce&&e.indexOf("scaleType")>-1&&n.ready()},"change:marker.select":function(t){n.someSelected=n.model.marker.select.length>0,n.nonSelectedOpacityZero=!1,n.updateBarsOpacity()},"change:marker.highlight":function(t,e){n._readyOnce&&n._highlightBars()},"change:marker.opacitySelectDim":function(){n.updateBarsOpacity()},"change:marker.opacityRegular":function(){n.updateBarsOpacity()},"change:marker.color.palette":function(t){n._readyOnce&&n._updateEntities()},"change:marker.color.scaleType":function(t){n._readyOnce&&n._updateEntities()},"change:marker.color.which":function(t){n._readyOnce&&(n.model.marker_order.hook_order.which=n.model.marker.color.which)},"change:marker.side.which":function(t){if(n._readyOnce){var e=void 0,i={},r={};if("constant"==n.model.marker.side.use)e=null;else{var o=n.model.marker.side.getConceptprops();e="entity_set"==o.concept_type?o.domain:n.model.marker.side.which}n.model.marker.side.clearSideState();var a=e!==n.geoDomainDimension;a||(i["is--"+n.model.marker.side.which]=!0),n.model.entities_side.skipFilter=a,r.show=i,r.dim=e,n.model.entities_side.set(r),n.model.entities_geodomain.skipFilter=(e===n.geoDomainDimension||n.STACKDIM===n.geoDomainDimension)&&(Boolean(n.model.entities.getFilteredEntities().length)||!n.model.entities_side.skipFilter)}},"change:entities.show":function(t){if(n._readyOnce){if(n.model.entities.dim===n.model.entities_side.dim&&!o.isEmpty(n.model.entities_side.show)){var e=n.model.entities_side.getFilteredEntities().filter(function(t){return!n.model.entities.isShown(t)});e.length&&(n.model.marker.side.clearSideState(),n.model.entities_side.showEntity(e))}n.model.entities_geodomain.skipFilter=(n.SIDEDIM===n.geoDomainDimension||n.STACKDIM===n.geoDomainDimension)&&(Boolean(n.model.entities.getFilteredEntities().length)||!n.model.entities_side.skipFilter)}},"change:entities_side.show":function(t){if(n._readyOnce){var e=!1,i=null;if(o.forEach(n.model.marker.side._space,function(t){t.dim===n.model.entities_side.dim&&t._name!==n.model.entities_side._name&&t._name!==n.model.entities_geodomain._name&&(i=t)}),i){n.model.entities.getFilteredEntities();var r=n.model.entities_side.getFilteredEntities().filter(function(t){return!i.isShown(t)});r.length&&(i.showEntity(r),e=!0)}n.SIDEDIM!==n.model.entities_side.dim&&(e=!0),e||(n._updateIndicators(),n.model.ready&&n.frame&&(n._updateLimits(),n.resize(),n._updateEntities(!0)))}},"change:ui.chart.inpercent":function(t){n._readyOnce&&(n._updateLimits(),n.resize(),n._updateEntities())},"change:ui.chart.flipSides":function(t){n._readyOnce&&(n.model.marker.side.switchSideState(),n._updateIndicators(),n.resize(),n._updateEntities(!0))}},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=s("bottom"),this.xAxisLeft=s("bottom"),this.yAxis=s("left"),this.xScales=[],this.totalFieldName="Total"},checkDimensions:function(){var t=this.model.entities.dim,e=this.model.entities_side.dim;this.colorUseNotProperty="constant"==this.model.marker.color.use||this.model.marker.color.which==this.TIME,this.stackSkip=t==e,this.geoLess=t!==this.geoDomainDimension&&e!==this.geoDomainDimension,this.sideSkip="constant"==this.model.marker.side.use},readyOnce:function(){var t=this;this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.interaction=this._interaction(),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.xAxisLeftEl=this.graph.select(".vzb-bc-axis-x-left"),this.xTitleEl=this.element.select(".vzb-bc-axis-x-title"),this.xInfoEl=this.element.select(".vzb-bc-axis-x-info"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.barsCrop=this.graph.select(".vzb-bc-bars-crop"),this.labelsCrop=this.graph.select(".vzb-bc-labels-crop"),this.bars=this.graph.select(".vzb-bc-bars"),this.labels=this.graph.select(".vzb-bc-labels"),this.labels.select(".vzb-bc-stack").attr("y",-10),this.title=this.element.select(".vzb-bc-title"),this.titleRight=this.element.select(".vzb-bc-title-right"),this.year=this.element.select(".vzb-bc-year"),this.geoDomainDimension=this.model.entities_geodomain.getDimension(),this.geoDomainDefaultValue=((this.model.entities_geodomain.show[this.geoDomainDimension]||{}).$in||{})[0],t.someSelected=t.model.marker.select.length>0,t.nonSelectedOpacityZero=!1,this.on("resize",function(){t._updateEntities()}),this._attributeUpdaters={_newWidth:function(e,i){e.x_=0;var n=t.frameAxisX[o.getKey(e,t.KEYS)];return e.width_=n?t.xScale(n):0,t.ui.chart.inpercent&&(e.width_/=t.total[e[t.PREFIXEDSIDEDIM]]),e.width_},_newX:function(t,e){var i=this.previousSibling;if(i){var n=d3.select(i).datum();t.x_=n.x_+n.width_}else t.x_=0;return t.x_},_newColor:function(e,i){return t.cScale(t.colorUseNotProperty?t.frame.color[e[t.STACKDIM]]:t.frame.color[o.getKey(e,t.COLORKEYS)])}}},ready:function(){var t=this;if(this.model.marker._ready){var e=this;this.timeSteps=this.model.time.getAllSteps(),this.TIME=this.model.marker._getFirstDimension({type:"time"}),this.KEYS=o.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.side=this.model.marker.label_side.getEntity(),this.SIDEDIM=this.side.getDimension(),this.PREFIXEDSIDEDIM="side_"+this.SIDEDIM,this.stack=this.model.marker.axis_y.getEntity(),this.STACKDIM=this.stack.getDimension(),this.PREFIXEDSTACKDIM="stack_"+this.STACKDIM,this.TIMEDIM=this.model.time.getDimension(),this.COLORKEYS=[this.STACKDIM,this.PREFIXEDSIDEDIM],this.checkDimensions(),this.updateUIStrings(),this._updateIndicators(),this.frame=null,this.model.marker.getFrame(e.model.time.value,function(i){e.frame=i,e.frameAxisX=i.axis_x,e.model.marker_order.getFrame(e.model.time.value,function(i){e.frameOrder=i.hook_order,e.items=e.model.marker.getKeys(),e._createLimits(),e._updateLimits(),e._reorderBars(),e.markers=t.model.marker.getKeys(e.STACKDIM),e.resize(),e._updateEntities(!0),e.updateBarsOpacity()})})}},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=this.xTitleEl.selectAll("text").data([0]);e.enter().append("text"),e.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var i=this.model.marker.axis_x.getConceptprops();o.setIcon(this.xInfoEl,l).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+r.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()})},_updateIndicators:function(){var t=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this.xAxisLeft.tickFormat(this.model.marker.axis_x.getTickFormatter());var e,i=this.SIDEDIM,n=this.STACKDIM;e=this.model.marker.getKeys(n).map(function(t){return t[n]}),this.stackKeys=e;var r=this.model.marker.label_side.getItems(),a=[];if(!o.isEmpty(r)){var s=!!this.model.marker.side.getEntity().show[i];if((a=this.model.marker.getKeys(i).filter(function(e){return!s||t.model.marker.side.getEntity().isShown(e)}).map(function(t){return t[i]})).length>2&&(a.length=2),a.length>1){var l=this.ui.chart.flipSides?d3.ascending:d3.descending;a.sort(l)}}if(a.length||a.push("undefined"),this.sideKeys=a,this.twoSided=this.sideKeys.length>1,this.titleRight.classed("vzb-hidden",!this.twoSided),this.twoSided)this.xScaleLeft=this.xScale.copy(),this.title.text(r[this.sideKeys[1]]),this.titleRight.text(r[this.sideKeys[0]]);else{var u=this.sideKeys.length&&r[this.sideKeys[0]]?r[this.sideKeys[0]]:"";this.title.text(u)}this.cScale=this.model.marker.color.getScale()},_reorderBars:function(){var t=this,e=this.yScale.domain(),i=this.sideKeys;e.sort(function(e,n){var r=d3.ascending(t.frameOrder[e]||0,t.frameOrder[n]||0);return 0!==r?r:d3.ascending((t.frameAxisX[e]||{})[i[0]]||0,(t.frameAxisX[n]||{})[i[0]]||0)}),this.yScale.domain(e)},_createLimits:function(){var t=this,e=this.model.marker.axis_x,i=Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));i.length||i.push("undefined");var r=this.sideSkip?[]:[this.SIDEDIM],a=e.getLimitsByDimensions(r.concat([this.STACKDIM,this.TIMEDIM])),s=e.getUnique(),l={},u={},c={},h=void 0;i.forEach(function(t){c[t]=[],u[t]=[]}),t.sideSkip?o.forEach(s,function(e){l[e]={};var n=0,r=[];o.forEach(t.stackKeys,function(t){if(a[t]&&a[t][e]){var i=a[t][e].max;n+=i,r.push(i)}}),l[e][i[0]]=n;var s=Math.max.apply(Math,r);u[i[0]].push(s/n),c[i[0]].push(s)}):o.forEach(s,function(e){l[e]={},o.forEach(i,function(i){var n=0,r=[];o.forEach(t.stackKeys,function(t){if(a[h=i+","+t]&&a[h][e]){var o=a[h][e].max;n+=o,r.push(o)}}),l[e][i]=n;var s=Math.max.apply(Math,r);u[i].push(s/n),c[i].push(s)})}),this.maxLimits={},this.inpercentMaxLimits={},i.forEach(function(e){t.maxLimits[e]=Math.max.apply(Math,n(c[e])),t.inpercentMaxLimits[e]=Math.max.apply(Math,n(u[e]))}),this.totals=l},_updateLimits:function(){var t=this,e=this.model.marker.axis_x,i="log"==e.scaleType?.01:0,r=void 0;r=this.ui.chart.inpercent?[.01*i,Math.max.apply(Math,n(this.sideKeys.map(function(e){return t.inpercentMaxLimits[e]})))]:null!=e.domainMin&&null!=e.domainMax?[+e.domainMin,+e.domainMax]:[i,Math.max.apply(Math,n(this.sideKeys.map(function(e){return t.maxLimits[e]})))],this.xScale.domain(r),this.xScaleLeft&&this.xScaleLeft.domain(this.xScale.domain())},_interpolateBetweenTotals:function(t,e,i){var n=d3.bisectLeft(t,i),r=(i-t[n-1])/(t[n]-t[n-1]),a={};return o.forEach(this.sideKeys,function(i){a[i]=e[t[n]][i]*r+e[t[n-1]][i]*(1-r)}),a},_updateEntities:function(t){var e=this,i=this.model.time,n=this.SIDEDIM,r=this.PREFIXEDSIDEDIM,o=this.STACKDIM,a=(this.PREFIXEDSTACKDIM,this.TIMEDIM,i.playing?i.delayAnimations:0);this.ui.chart.inpercent&&(this.total=this.totals[i.value]?this.totals[i.value]:this._interpolateBetweenTotals(this.timeSteps,this.totals,i.value));this.yScale.domain();var s=this.markers.slice(0);this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(s,function(t){return t[o]}),this.entityBars.exit().remove();var l=this.barHeight,u=this.firstBarOffsetY;this.entityBars=this.entityBars.enter().append("g").attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[o]}).attr("transform",function(t,i){return"translate(0,"+(u-e.yScale(t[o]))+")"}).merge(this.entityBars);var c=this._attributeUpdaters;if(this.sideBars=this.entityBars.selectAll(".vzb-bc-side").data(function(t){return e.sideKeys.map(function(e){var i={};return i[o]=t[o],i[r]=e,i[n]=e,i})},function(t){return t[r]}),this.sideBars.exit().remove(),this.sideBars=this.sideBars.enter().append("g").attr("class",function(t,i){return"vzb-bc-side vzb-bc-side-"+(!i!=!e.twoSided?"right":"left")}).call(function(t){t.append("rect").attr("class",function(t,i){return"vzb-bc-stack vzb-bc-stack-"+i+(e.highlighted?" vzb-dimmed":"")}).attr("y",0).attr("height",l).attr("fill",c._newColor).attr("width",c._newWidth).attr("x",c._newX).on("mouseover",e.interaction.mouseover).on("mouseout",e.interaction.mouseout).on("click",e.interaction.click).onTap(e.interaction.tap)}).merge(this.sideBars),t&&this.sideBars.attr("transform",function(t,i){return i?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""}),this.stackBars=this.sideBars.selectAll(".vzb-bc-stack"),t&&this.stackBars.attr("fill",c._newColor),a){var h=d3.transition().duration(a).ease(d3.easeLinear);this.entityBars.attr("transform",function(t,i){return"translate(0,"+(u-e.yScale(t[o]))+")"}),this.stackBars.transition(h).attr("width",c._newWidth).attr("x",c._newX)}else this.entityBars.interrupt().attr("transform",function(t,i){return"translate(0,"+(u-e.yScale(t[o]))+")"}),this.stackBars.interrupt().attr("width",c._newWidth).attr("x",c._newX);a?this.year.transition().duration(a).ease(d3.easeLinear).on("end",this._setYear(i.value)):this.year.interrupt().text(i.formatDate(i.value)).transition()},_setYear:function(t){var e=this.model.time.formatDate(t);return function(){d3.select(this).text(e)}},_interaction:function(){var t=this;return{mouseover:function(e,i){o.isTouchDevice()||t.model.marker.highlightMarker(e)},mouseout:function(e,i){o.isTouchDevice()||t.model.marker.clearHighlighted()},click:function(e,i){o.isTouchDevice()||t.model.marker.selectMarker(e)},tap:function(e){d3.event.stopPropagation(),t.model.marker.selectMarker(e)}}},_highlightBars:function(t){this.someHighlighted=this.model.marker.highlight.length>0,this.updateBarsOpacity(),this.someHighlighted?this._showLabel(this.model.marker.highlight[0]):this.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1)},_showLabel:function(t){if(this.frame){var e=this,i=e.ui.chart.inpercent?d3.format(".2%"):e.model.marker.axis_x.getTickFormatter(),n=e.SIDEDIM,r=e.STACKDIM,a=this.KEYS,s=e.sideKeys.indexOf(t[n]),l=e.labels.select(".vzb-bc-label"),u=e.bars.select(".vzb-bc-bar-"+t[r]);l.attr("transform",u.attr("transform")).select(".vzb-bc-stack").text(function(s){var l=e.frame.label_stack[t[r]];l=e.twoSided?l:l+" "+e.stackItems[t[r]];var u=e.ui.chart.inpercent?e.total[t[n]]:1,c=e.frameAxisX[o.getKey(t,a)]/u;return l+": "+i(c)}).attr("x",(s?-1:1)*(.5*e.activeProfile.centerWidth+7)).classed("vzb-text-left",s),l.classed("vzb-hovered",!0)}},presentationProfileChanges:{medium:{margin:{right:80,bottom:80},infoElHeight:32},large:{margin:{top:100,right:100,left:100,bottom:80},infoElHeight:32}},profiles:{small:{margin:{top:70,right:20,left:40,bottom:40},infoElHeight:16,centerWidth:2,titlesSpacing:5},medium:{margin:{top:80,right:60,left:60,bottom:40},infoElHeight:20,centerWidth:2,titlesSpacing:10},large:{margin:{top:100,right:60,left:60,bottom:40},infoElHeight:22,centerWidth:2,titlesSpacing:20}},resize:function(){var t=this;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=this.activeProfile.margin,i=this.activeProfile.infoElHeight;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return o.warn("BarchartDS resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),this.barsCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsCrop.attr("width",this.width).attr("height",Math.max(0,this.height));var n=this.yScale.domain(),r=this.barHeight="ordinal"==this.model.marker.axis_y.scaleType?this.height/n.length:this.height/Math.abs(n[1]-n[0]);this.firstBarOffsetY=this.height-this.barHeight,this.stackBars&&this.stackBars.attr("height",r),this.sideBars&&this.sideBars.attr("transform",function(e,i){return i?"scale(-1,1) translate("+t.activeProfile.centerWidth+",0)":""}),this.yScale.range([this.height,0]);var a=this.twoSided?.5*(this.width-this.activeProfile.centerWidth):this.width;this.xScale.range([0,a]),this.yAxis.scale(this.yScale).tickValues([]).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:e,limitMaxTickNumber:1});var s=this.ui.chart.inpercent?d3.format(".1%"):this.model.marker.axis_x.getTickFormatter();this.xAxis.scale(this.xScale).tickFormat(s).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6});var l=this.twoSided?.5*(this.width+t.activeProfile.centerWidth):0;if(this.xAxisEl.attr("transform","translate("+l+","+this.height+")").call(this.xAxis),this.yAxisEl.attr("transform","translate(0,0)").call(this.yAxis),this.xAxisLeftEl.classed("vzb-hidden",!this.twoSided),this.twoSided){"ordinal"!==this.model.marker.axis_x.scaleType?this.xScaleLeft.range([.5*(this.width-this.activeProfile.centerWidth),0]):this.xScaleLeft.rangePoints([.5*(this.width-this.activeProfile.centerWidth),0]).range(),this.xAxisLeft.scale(this.xScaleLeft).tickFormat(s).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6}),this.xAxisLeftEl.attr("transform","translate(0,"+this.height+")").call(this.xAxisLeft);var u=this.xAxisEl.select(".tick text");if(!u.empty()){var c=u.node().getBBox().width;u.attr("dx",.5*-(this.activeProfile.centerWidth+c))}this.xAxisEl.select(".tick line").classed("vzb-hidden",!0);var h=this.xAxisLeftEl.selectAll(".tick").nodes();d3.select(h[h.length-1]).classed("vzb-hidden",!0)}var d=this.model.locale.isRTL();if(this.bars.attr("transform","translate("+l+",0)"),this.labels.attr("transform","translate("+l+",0)"),this.title.attr("x",e.left+(this.twoSided?l-this.activeProfile.titlesSpacing:0)).style("text-anchor",this.twoSided?"end":"").attr("y",.7*e.top),this.titleRight.attr("x",e.left+l+this.activeProfile.titlesSpacing).attr("y",.7*e.top),this.xTitleEl.style("font-size",i+"px").attr("transform","translate("+(d?this.width:.4*e.left)+","+.4*e.top+")"),this.xTitleEl.select("text").text(this.model.marker.axis_x.getConceptprops().name),this.xInfoEl.select("svg").node()){var f=this.xTitleEl.node().getBBox(),p=o.transform(this.xTitleEl.node()),m=d?f.x+p.translateX-1.4*i:f.x+p.translateX+f.width+.4*i;this.xInfoEl.select("svg").attr("width",i+"px").attr("height",i+"px"),this.xInfoEl.attr("transform","translate("+m+","+(p.translateY-.8*i)+")")}this.year.attr("x",this.width+e.left).attr("y",.4*e.top)},updateBarsOpacity:function(t){var e=this,i=this.model.marker.opacityHighlightDim,n=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.stackBars.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?1:e.someSelected?e.model.marker.isSelected(t)?1:r:e.someHighlighted?i:n}),this.stackBars.style("stroke",function(t){return e.model.marker.isSelected(t)?"#333":null});var o=e.model.marker.opacitySelectDim<.01;o!=this.nonSelectedOpacityZero&&this.stackBars.style("pointer-events",function(t){return e.someSelected&&o&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=u},function(t,e){},function(t,e){t.exports='\x3c!-- BarChartDS Component --\x3e\n<svg class="vzb-barchartds">\n    <g class="vzb-bc-header">\n        <g class="vzb-bc-axis-x-title"></g>\n        <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n        <text class="vzb-bc-title"></text>\n        <text class="vzb-bc-title vzb-bc-title-right"></text>\n        <text class="vzb-bc-year"></text>\n    </g>\n    <g class="vzb-bc-graph">\n\n        <g class="vzb-bc-axis-y-title"></g>\n\n        <g class="vzb-bc-axis-y"></g>\n\n        <svg class="vzb-bc-bars-crop">\n            <g class="vzb-bc-bars"></g>\n        </svg>\n\n        <g class="vzb-bc-axis-x"></g>\n        <g class="vzb-bc-axis-x vzb-bc-axis-x-left"></g>\n\n        <svg class="vzb-bc-labels-crop">\n            <g class="vzb-bc-labels">\n                <g class="vzb-bc-label"><text class="vzb-bc-stack"></text></g>\n            </g>\n        </svg>\n\n        <g class="vzb-bc-axis-labels">\n            \x3c!-- <text class="vzb-x_label">Lifespan</text>\n                  <text class="vzb-y_label">Lifespan</text> --\x3e\n        </g>\n    </g>\n</svg>\n'},function(t,e,i){t.exports=i(0)}])},36:function(t,e){t.exports="./assets/combo.css"},37:function(t,e){Vizabi.Tool.extend("combo",{init:function(t,e){this.name="combo",this.template='<div class="vzb-tool vzb-tool-'+this.name+' vzb-split-vertical"><div class="vzb-tool-stage"><div class="vzb-tool-viz vzb-tool-viz-bubble"></div><div class="vzb-tool-viz vzb-tool-viz-map"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.components=this.components=[{component:Vizabi.Component.get("bubblechart"),placeholder:".vzb-tool-viz-bubble",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("extapimap"),placeholder:".vzb-tool-viz-map",model:["state.time","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{},entities:{},entities_colorlegend:{},entities_tags:{},marker_tags:{space:["entities_tags"],label:{},hook_parent:{}},marker:{space:["entities","time"],axis_x:{},axis_y:{},label:{},size:{},color:{},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{decorations:{},superhighlightOnMinimapHover:!0,whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},margin:{left:0,top:0},trails:!1,lockNonSelected:0},presentation:!1,panWithArrow:!0,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!0,buttons:["colors","find","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}}})},38:function(t,e){t.exports="./assets/extapimap.css"},39:function(t,e){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=13)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(6);var n,r=i(1),o=(n=r)&&n.__esModule?n:{default:n};i(3),i(2);var a=Vizabi.Tool.extend("ExtApiMap",{init:function(t,e){this.name="extapimap",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui","data"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_map_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_tags:{autoconfig:{type:"entity_domain",includeOnlyIDs:["tag"]}},marker_tags:{space:["entities_tags"],label:{use:"property",which:"name"},hook_parent:{}},marker:{limit:1e3,space:["entities","time"],label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:0,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{index:1,type:"measure"}},color_map:{syncModels:["marker_colorlegend"],autoconfig:{}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{map:{overflowBottom:50},cursorMode:"arrow",panWithArrow:!0,adaptMinMaxZoom:!1,zoomOnScrolling:!0,buttons:["colors","size","find","moreoptions","mapcolors","zoom","fullscreen","presentation"],dialogs:{popup:["colors","mapcolors","find","size","zoom","moreoptions"],sidebar:["colors","find","mapoptions","zoom"],moreoptions:["mapoptions","opacity","speed","size","colors","mapcolors","zoom","presentation","about"]},chart:{labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}},versionInfo:{version:"2.1.1",build:1524203582577}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(4),o=(n=r)&&n.__esModule?n:{default:n};var a=Vizabi,s=a.utils,l=a.helpers,u=l.labels,c=l["d3.dynamicBackground"],h=a.iconset,d=h.warn,f=h.question,p=Vizabi.Component.extend("extapimap",{init:function(t,e){this.name="extapimap",this.template=i(10),this.bubblesDrawing=null,this.isMobile=s.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"},{name:"data",type:"data"}];var n=this;this.model_binds={"change:time.value":function(t){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,n.frameChanged.bind(n))},"change:marker.highlight":function(t){n._readyOnce&&(n.highlightMarkers(),n.updateOpacity())},"change:marker":function(t,e){n._readyOnce&&e.indexOf("scaleType")>-1&&n.ready()},"change:marker.size.extent":function(t,e){n._readyOnce&&n.entityBubbles&&(n.updateMarkerSizeLimits(),n.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){n._readyOnce&&n.redrawDataPoints(null,!1)},"change:marker.select":function(t){n._readyOnce&&(n.selectMarkers(),n.redrawDataPoints(null,!1),n.updateLabels(null),n.updateOpacity(),n.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){n.updateOpacity()},"change:marker.opacityRegular":function(t){n.updateOpacity()},"change:ui.map.mapStyle":function(t){n.map.layerChanged()},"change:ui.map.showBubbles":function(t){n.updateEntities(),n.redrawDataPoints(null,!0),n._reorderEntities(),n.updateOpacity()},"change:ui.map.showAreas":function(t){n.map.layerChanged()},"change:ui.map.showMap":function(t){n.map.layerChanged()},"change:ui.cursorMode":function(){var t=n.chartSvg;"plus"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1)):"minus"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0),t.classed("vzb-panhand",!1)):"hand"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1))}},this._super(t,e),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),n.COLOR_WHITEISH="#fdfdfd",n.COLOR_WHITEISH="#fdfdfd",this._labels=new u(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.chartSvg=this.element.select("svg"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new c(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var e=this;this.on("resize",function(){e.updateSize()||e.map.rescaleMap()}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=s.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce();var i=d3.drag().on("start",function(i,n){if((d3.event.sourceEvent.metaKey||d3.event.sourceEvent.ctrlKey)&&"arrow"==e.model.ui.cursorMode||"plus"==e.model.ui.cursorMode){e.dragAction="zooming",e.zooming=!0;var r=d3.mouse(t.graph.node());e.origin={x:r[0],y:r[1]},e.zoomRect.classed("vzb-invisible",!1)}else("hand"==e.model.ui.cursorMode||e.ui.panWithArrow&&"arrow"===e.ui.cursorMode)&&(e.dragAction="panning",e._hideEntities(),e.map.panStarted(),e.chartSvg.classed("vzb-zooming",!0))}).on("drag",function(i,n){switch(e.dragAction){case"zooming":var r=d3.mouse(t.graph.node());e.zoomRect.attr("x",Math.min(r[0],e.origin.x)).attr("y",Math.min(r[1],e.origin.y)).attr("width",Math.abs(r[0]-e.origin.x)).attr("height",Math.abs(r[1]-e.origin.y));break;case"panning":e.map.moveOver(d3.event.dx,d3.event.dy)}}).on("end",function(i,n){switch(e.dragAction){case"zooming":if(e.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),e.zooming){var r=d3.mouse(t.graph.node());Math.abs(e.origin.x-r[0])<5||Math.abs(e.origin.y-r[1])<5?(e._hideEntities(),e.map.zoomMap(r,1).then(function(){e._showEntities(300)})):e.map.zoomRectangle(e.origin.x,e.origin.y,r[0],r[1])}break;case"panning":e.map.panFinished(),e._showEntities(300),e.chartSvg.classed("vzb-zooming",!1)}if("minus"==e.model.ui.cursorMode){var o=d3.mouse(t.graph.node());e._hideEntities(),e.map.zoomMap(o,-1).then(function(){e._showEntities(300)})}e.dragAction=null,e.zooming=!1}),n=function(){if(e.model.ui.zoomOnScrolling){var t=d3.mouse(e.graph.node());return e._hideEntities(),e.map.zoomMap(t,d3.event.wheelDelta>0?1:-1).then(function(){e._showEntities(100)}),d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}};this.element.call(i),this.element.on("mousewheel",n).on("wheel",n),d3.select("body").on("keydown",function(){"arrow"!==e.model.ui.cursorMode&&"hand"!==e.model.ui.cursorMode||(d3.event.metaKey||d3.event.ctrlKey)&&e.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"!==e.model.ui.cursorMode&&"hand"!==e.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||e.element.select("svg").classed("vzb-zoomin",!1)}).on("mouseenter",function(){"arrow"!==e.model.ui.cursorMode&&"hand"!==e.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||(e.model.ui.cursorMode="arrow")}),this.root.on("resetZoom",function(){e._hideEntities(),e.map.resetZoom(500).then(function(){e._showEntities()})})},_hideEntities:function(t){this.graph.select("."+this._labels.options.LABELS_CONTAINER_CLASS).transition().duration(t).style("opacity",0),this.graph.select("."+this._labels.options.LINES_CONTAINER_CLASS).transition().duration(t).style("opacity",0),this.bubbleContainer.transition().duration(t).style("opacity",0)},_showEntities:function(t){this.graph.select("."+this._labels.options.LABELS_CONTAINER_CLASS).transition().duration(t).style("opacity",1),this.graph.select("."+this._labels.options.LINES_CONTAINER_CLASS).transition().duration(t).style("opacity",1),this.bubbleContainer.transition().duration(t).style("opacity",1)},ready:function(){var t=this;this.KEYS=s.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.map.rescaleMap(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){i.toString()==t.model.time.value.toString()?e&&(t.values=e,t.updateEntities(),t.updateTime(),t.map.ready(),t.map.updateColors(),t._labels.ready(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity()):s.defer(function(){t.ready()})})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1),this._reorderEntities(),this.map.updateColors())},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),i=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:i.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),s.setIcon(this.dataWarningEl,d).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(f).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(f).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x+r.left-n.left,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t=void 0;if(this.isMobile&&this.model.marker.select&&1===this.model.marker.select.length&&(t=this.model.marker.select[0]),this.hovered||t){var e=this.model.marker.size.getConceptprops(),i=this.model.marker.color.getConceptprops(),n=this.hovered||t,r=this.model.marker.size.getTickFormatter(),o=this.model.marker.color.getTickFormatter(),a=e.unit||"",l=i.unit||"",u=this.values.size[s.getKey(n,this.dataKeys.size)],c=this.values.color[s.getKey(n,this.dataKeys.color)];this.model.marker.color.isDiscrete()&&c&&(c=this.model.marker.color.getColorlegendMarker().label.getItems()[c]||""),this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+r(u)+" "+a),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+(c||0===c?o(c)+" "+l:this.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this;this.map.updateOpacity(),this.entityBubbles.style("opacity",function(e){return t.getOpacity(e)}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var e=t.model.marker.opacitySelectDim<.01;e!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(i){return t.someSelected&&e&&!t.model.marker.isSelected(i)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},getMapOpacity:function(t){if(this.model.ui.map.showBubbles)return this.model.marker.opacitySelectDim;var e={};return e[this.KEY]=t,this.getOpacity(e)},getOpacity:function(t){return this.someHighlighted&&this.model.marker.isHighlighted(t)?this.model.marker.opacityRegular:this.someSelected?this.model.marker.isSelected(t)?this.model.marker.opacityRegular:this.model.marker.opacitySelectDim:this.someHighlighted?this.model.marker.opacitySelectDim:this.model.marker.opacityRegular},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this.mcScale=this.model.marker.color_map.getScale()},updateEntities:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.TIMEDIM,r=this.model.time.end;this.model.marker.setVisible(function(o){return o=o||"",t.model.marker.getKeys().map(function(a){var l=Object.assign({},a);return l[n]=r,l.sortValue=t.values.size[s.getKey(a,t.dataKeys.size)]||0,l[i]=o+s.getKey(a,e),l}).sort(function(t,e){return e.sortValue-t.sortValue})}.call(this)),this.model.time.splash||this.unselectBubblesWithNoData();var o=[];this.model.ui.map.showBubbles&&(o=this.model.marker.getVisible()),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(o,function(t){return t[i]}),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._interact()._mouseout(e,i)}).on("click",function(e,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){}).merge(this.entityBubbles),this._reorderEntities()},_reorderEntities:function(){var t=this;this.KEY;this.bubbleContainer.selectAll(".vzb-bmc-bubble").sort(function(e,i){var n=t.values.size[s.getKey(e,t.dataKeys.size)],r=t.values.size[s.getKey(i,t.dataKeys.size)];return void 0===n&&void 0!==r?-1:void 0!==n&&void 0===r?1:d3.descending(n,r)})},unselectBubblesWithNoData:function(t){var e=this;this.KEY;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(i){var n=t.size[s.getKey(i,e.dataKeys.size)];n||0===n||e.model.marker.selectMarker(i)})},_getPosition:function(t){var e=this.dataKeys;return this.values.hook_lat&&this.values.hook_lat[s.getKey(t,e.hook_lat)]?this.map.geo2Point(this.values.hook_lat[s.getKey(t,e.hook_lat)],this.values.hook_lng[s.getKey(t,e.hook_lng)]):this.values.hook_centroid&&this.values.hook_centroid[s.getKey(t,e.hook_centroid)]?this.map.centroid(this.values.hook_centroid[s.getKey(t,e.hook_centroid)]):(s.warn("_getPosition(): was unable to resolve bubble positions either via lat/long or centroid"),[0,0])},redrawDataPoints:function(t,e){var i=this;if(t||(t=this.duration),!this.entityBubbles)return s.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!");var n=this.dataKeys,r=this.values;this.entityBubbles.each(function(o,a){var l=d3.select(this),u=r.size[s.getKey(o,n.size)],c=r.color[s.getKey(o,n.color)],h=r.label[s.getKey(o,n.label)],d=r.hook_centroid[s.getKey(o,n.hook_centroid)];if(o.hidden_1=o.hidden,e){var f=i._getPosition(o);f&&(o.cLoc=f,l.attr("cx",o.cLoc[0]).attr("cy",o.cLoc[1]))}o.hidden=!u&&0!==u||null==d||!o.cLoc,o.hidden!==o.hidden_1&&(t?l.transition().duration(t).ease(d3.easeLinear).style("opacity",0).on("end",function(){return l.classed("vzb-hidden",o.hidden).style("opacity",i.model.marker.opacityRegular)}):o.hidden?l.classed("vzb-hidden",o.hidden):o.cLoc&&l.classed("vzb-hidden",o.hidden)),o.hidden?i._updateLabel(o,a,0,0,u,c,h,t):(o.r=s.areaToRadius(i.sScale(u||0)),o.label=h,l.classed("vzb-hidden",!1).attr("fill",null!=c?i.cScale(c):i.COLOR_WHITEISH),t?l.transition().duration(t).ease(d3.easeLinear).attr("r",o.r):l.interrupt().attr("r",o.r).transition(),i._updateLabel(o,a,o.cLoc[0],o.cLoc[1],u,c,o.label,t))})},updateLabels:function(t){var e=this,i=this,n=this.dataKeys;this.model.marker.getSelected().map(function(r){var o=void 0,a=void 0,l=e.values.label[s.getKey(r,n.label)];if(r.cLoc)o=r.cLoc[0],a=r.cLoc[1];else{var u=i._getPosition(r);u&&(o=u[0],a=u[1])}var c=s.areaToRadius(i.sScale(i.values.size[s.getKey(r,n.size)]||0)),h=null!=i.values.color[s.getKey(r,n.color)]?i.cScale(i.values.color[s.getKey(r,n.color)]):i.COLOR_WHITEISH;i._updateLabel(r,null,o,a,c,h,l,t)})},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text");t.style("font-size",null);var e=this.cTitleEl.select("text");e.style("font-size",null);var i=t.node().getBBox(),n=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),r=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",r+"px"),e.style("font-size",r+"px")):(t.style("font-size",null),e.style("font-size",null))},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadiusPx:.5,maxRadiusEm:.05},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadiusPx:1,maxRadiusEm:.05},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadiusPx:1,maxRadiusEm:.05}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*s.hypotenuse(t.width,t.height));var e=this.activeProfile.margin;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.chartSvg.style("width",this.width+e.left+e.right+"px").style("height",this.height+e.top+e.bottom+(this.model.ui.map.overflowBottom||0)+"px"),this.height<=0||this.width<=0)return s.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none");this.repositionElements()},mapBoundsChanged:function(){this.updateMarkerSizeLimits(),this.redrawDataPoints(null,!0),this.updateLabels(null)},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height+t.bottom),this.yTitleEl.style("font-size",e).attr("transform","translate("+(i?this.width:0)+","+t.top+")");var n=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(t.top+n.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var r=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*r.height)+")").select("text"),this.yInfoEl.select("svg").node()){var o=this.yTitleEl.node().getBBox(),a=s.transform(this.yTitleEl.node()),l=i?o.x+a.translateX-1.4*e:o.x+a.translateX+o.width+.4*e;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+l+","+(a.translateY-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var u=this.cTitleEl.node().getBBox(),c=s.transform(this.cTitleEl.node()),h=i?u.x+c.translateX-1.4*e:u.x+c.translateX+u.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+h+","+(c.translateY-.8*e)+")")}},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return s.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,i=this.activeProfile.maxRadiusPx,n=s.radiusToArea(Math.max(i*t[0],e)),r=s.radiusToArea(Math.max(i*t[1],e)),o=n===r?[n,r]:d3.range(n,r,(r-n)/this.sScale.domain().length).concat(r);this.sScale.range(o)},_mapIteract:function(){var t=this,e={};return{_mouseover:function(i,n){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t.model.ui.map.showBubbles||!t.map.keys[i]||(e[t.KEY]=t.map.keys[i],t._interact()._mouseover(e))},_mouseout:function(i,n){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t.model.ui.map.showBubbles||!t.map.keys[i]||(e[t.KEY]=t.map.keys[i],t._interact()._mouseout(e))},_click:function(i,n){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t.model.ui.map.showBubbles||!t.map.keys[i]||(e[t.KEY]=t.map.keys[i],t._interact()._click(e))}}},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,i){t.model.marker.selectMarker(e)}}},highlightMarkers:function(){this.someHighlighted=this.model.marker.highlight.length>0,s.isTouchDevice()&&(this.someHighlighted?this.hovered=this.model.marker.highlight[0]:this.hovered=null,this.updateTitleNumbers(),this.fitSizeOfTitles())},_updateLabel:function(t,e,i,n,r,o,a,l){if(t[this.KEY]!=this.druging&&(null==l&&(l=this.duration),this.model.marker.isSelected(t))){var u=t.hidden!==t.hidden_1,c={};c.labelX0=i/this.width,c.labelY0=n/this.height,c.scaledS0=r?s.areaToRadius(this.sScale(r)):null,c.scaledC0=null!=o?this.cScale(o):this.COLOR_WHITEISH;var h=this.model.marker.getCompoundLabelText(t,this.values);this._labels.updateLabel(t,e,c,i/this.width,n/this.height,r,o,h,null,l,u)}},selectMarkers:function(){this.KEY;this.someSelected=this.model.marker.select.length>0,s.isTouchDevice()?(this._labels.showCloseCross(null,!1),this.someHighlighted?this.model.marker.clearHighlighted():(this.updateTitleNumbers(),this.fitSizeOfTitles())):this.hovered&&!this.model.marker.isSelected(this.hovered)||this._setTooltip(),this.nonSelectedOpacityZero=!1},_setTooltip:function(t){if(t){this.KEY;var e=this.values,i={},n={},r=t.cLoc?t.cLoc:this._getPosition(t),o=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),a=r[0]||o[0],l=r[1]||o[1];i.valueS=e.size[s.getKey(t,this.dataKeys.size)],i.labelText=this.model.marker.getCompoundLabelText(t,e),n.labelX0=i.valueX=a/this.width,n.labelY0=i.valueY=l/this.height;t.r||s.areaToRadius(this.sScale(i.valueS)||0);n.scaledS0=t.r,n.scaledC0=null,this._labels.setTooltip(t,i.labelText,n,i)}else this._labels.setTooltip()},preload:function(){return this.initMap()},initMap:function(){return this.map=new o.default(this,"#vzb-map-background").getMap(),this.map.initMap()}});e.default=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi.Component.get("_dialog").extend("mapcolors",{init:function(t,e){this.name="mapcolors",this.components=[{component:Vizabi.Component.get("indicatorpicker"),placeholder:".vzb-caxis-selector",model:["state.time","state.marker.color_map","locale"],showHoverValues:!0},{component:Vizabi.Component.get("colorlegend"),placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","state.marker.color_map","locale","ui"]}],this._super(t,e),this.template=i(8)}});e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(5);var n=[{title:"Google",value:"google"},{title:"Mapbox",value:"mapbox"}],r={google:[{title:"Terrain",value:"terrain"},{title:"Grayscale",value:"terrain grayscale"},{title:"Satellite",value:"satellite"}],mapbox:[{title:"Land",value:"mapbox://styles/mapbox/streets-v9"},{title:"Grayscale",value:"mapbox://styles/mapbox/light-v9"},{title:"Satellite",value:"mapbox://styles/mapbox/satellite-v9"},{title:"Satellite Street",value:"mapbox://styles/mapbox/satellite-streets-v9"}]},o=Vizabi.Component.get("_dialog").extend("mapoptions",{init:function(t,e){var n=this;this.name="mapoptions",this.components=[],this.model_binds={"change:ui.map":function(){n._ready&&n.updateView()}},this._super(t,e),this.template=i(9)},readyOnce:function(){this._super();var t=this;this.mapLayersEl=this.element.select(".vzb-map-layers"),this.mapEngineFormEl=this.element.select(".vzb-dialog-paragraph.vzb-map-engine"),this.mapStyleFormEl=this.element.select(".vzb-dialog-paragraph.vzb-map-style");var e=this.mapEngineFormEl.selectAll("label").data(n);e.exit().remove(),e.enter().append("label").attr("for",function(t,e){return"a"+e}).each(function(e,i){d3.select(this).append("input").attr("id","a"+i).attr("type","radio").attr("name","engine").attr("value",e.value).on("change",function(){return t.setModel("mapEngine",e.value)}),d3.select(this).append("span").text(e.title)}),this.mapLayersEl.select("input[name='showBubbles']").property("checked",function(e){return t.model.ui.map.showBubbles}).on("change",function(){t.setModel("showBubbles",d3.select(this).property("checked"))}),this.mapLayersEl.select("input[name='showAreas']").property("checked",t.model.ui.map.showAreas).on("change",function(){t.setModel("showAreas",d3.select(this).property("checked"))}),this.mapLayersEl.select("input[name='showMap']").property("checked",t.model.ui.map.showMap).on("change",function(){t.setModel("showMap",d3.select(this).property("checked"))}),this.updateView()},updateView:function(){var t=this,e=this;this.mapStyleFormEl.selectAll("label").remove();var i=this.mapStyleFormEl.selectAll("label").data(r[this.model.ui.map.mapEngine]||[]);i.exit().remove(),i.enter().append("label").attr("for",function(t,e){return"a"+e}).each(function(t,i){d3.select(this).append("input").attr("id","a"+i).attr("type","radio").attr("name","layer").attr("value",t.value).on("change",function(){return e.setModel("mapStyle",t.value)}),d3.select(this).append("span").text(t.title)}),this.mapEngineFormEl.selectAll("input").property("checked",function(e){return e.value===t.model.ui.map.mapEngine}),this.mapStyleFormEl.selectAll("input").property("checked",function(e){return e.value===t.model.ui.map.mapStyle}),this.mapLayersEl.select("input[name='showBubbles']").property("checked",this.model.ui.map.showBubbles),this.mapLayersEl.select("input[name='showAreas']").property("checked",this.model.ui.map.showAreas),this.mapLayersEl.select("input[name='showMap']").property("checked",this.model.ui.map.showMap)},setModel:function(t,e){"mapEngine"===t&&this.model.ui.map.set({mapEngine:e,mapStyle:r[e][0].value}),"mapStyle"===t&&(this.model.ui.map.mapStyle=e),"showBubbles"!==t&&"showAreas"!==t&&"showMap"!==t||(this.model.ui.map[t]=e)}});e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(7)),r=o(i(11));function o(t){return t&&t.__esModule?t:{default:t}}var a=Vizabi,s=a.utils,l=a.helpers,u=l.topojson,c=l["d3.geoProjection"],h=Vizabi.Class.extend({init:function(t,e){console.warn("init method should be implemented in map instance")},initMap:function(){console.warn("initMap method should be implemented in map instance")},rescaleMap:function(){console.warn("rescaleMap method should be implemented in map instance")},moveOver:function(t,e){console.warn("moveOver method should be implemented in map instance")},getCanvas:function(){return console.warn("getCanvas method should be implemented in map instance"),[[0,0],[0,0]]},getCenter:function(){return console.warn("getCenter method should be implemented in map instance"),{lat:0,lng:0}},zoomMap:function(t,e){console.warn("zoomMap method should be implemented in map instance")},geo2Point:function(t,e){return console.warn("geo2Point method should be implemented in map instance"),[0,0]},point2Geo:function(t,e){return console.warn("point2Geo method should be implemented in map instance"),[0,0]}}),d=h.extend({init:function(t,e){this.shapes=null,this.mapLands=[],this.parent=e,this.resolvedCentroidCache={},this.context=t,this.parent=e,this.paths={},this.areasAreShown=!1,c()},initMap:function(){var t=this,e=this;this.mapGraph=this.parent.mapSvg.html("").append("g").attr("class","vzb-bmc-map-graph");var i=s.getProp(this.context,["model","ui","map","topology","path"])||"assets/world-50m.json",n="geo"+s.capitalize(this.context.model.ui.map.projection);return this.zeroProjection=d3[n](),this.zeroProjection.scale(1).translate([0,0]),this.projection=d3[n](),this.projection.scale(1).translate([0,0]),this.mapPath=d3.geoPath().projection(this.projection),this.context.model.ui.map.scale=1,this._loadShapes(i).then(function(i){e.shapes=i,e.mapFeature=u.feature(e.shapes,e.shapes.objects[t.context.model.ui.map.topology.objects.geo]),e.mapBounds=e.mapPath.bounds(e.mapFeature),e.boundaries=u.mesh(e.shapes,e.shapes.objects[e.context.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e}),e.mapFeature.features&&s.forEach(e.mapFeature.features,function(t,i){t.key=t.properties[e.context.model.ui.map.topology.geoIdProperty]?t.properties[e.context.model.ui.map.topology.geoIdProperty].toString().toLowerCase():t.id,e.paths[t.key]=t})})},showAreas:function(){var t=this;this.areasAreShown=!0,t.mapFeature.features?t.mapLands=t.mapGraph.selectAll(".land").data(t.mapFeature.features).enter().insert("path").attr("d",t.mapPath).attr("class","land").style("opacity",t.context.model.marker.opacitySelectDim).on("mouseover",function(e,i){t.parent._interact()._mouseover(e.key)}).on("mouseout",function(e,i){t.parent._interact()._mouseout(e.key)}).on("click",function(e,i){t.parent._interact()._click(e.key)}).onTap(function(e,i){t.parent._interact()._click(e.key),d3.event.stopPropagation()}).each(function(e,i){d3.select(this).attr("id",e.key).style("opacity",function(e){return t.parent.getOpacity(e.key)}).style("fill",function(e){return t.parent.getMapColor(e.key)})}):t.mapGraph.insert("path").datum(t.mapFeature).attr("class","land"),t.mapGraph.insert("path").datum(t.boundaries).attr("class","boundary")},hideAreas:function(){this.areasAreShown=!1,this.mapGraph.selectAll("*").remove()},updateOpacity:function(){var t=this;this.mapLands.style("opacity",function(e){return t.parent.getOpacity(e.key)})},updateMapColors:function(){var t=this;this.mapLands.style("fill",function(e){return t.parent.getMapColor(e.key)})},_loadShapes:function(t){var e=this;return new Promise(function(i,n){e.context.model.data.getAsset(t,function(e){if(!1===e.success)return console.warn("Failed loading json "+t+". "+e.message);i(e)})})},rescaleMap:function(t,e){var i=!1,n=this.context.activeProfile?this.context.activeProfile.margin:{left:0,top:0},r=this.zeroProjection([this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north]),o=this.zeroProjection([this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south]),a=1,s=0,l=0;if(!t||e){t||(i=!0,t=[[0,0],[this.context.width,this.context.height]],s=n.top,l=n.left);var u=Math.abs((t[1][0]-t[0][0])/(o[0]-r[0])),c=Math.abs((t[1][1]-t[0][1])/(o[1]-r[1]));u!=c&&(u>c?(a=c,l+=(Math.abs(t[1][0]-t[0][0])-Math.abs(a*(r[1]-o[1])))/2):(a=u,s+=(Math.abs(t[1][1]-t[0][1])-Math.abs(a*(r[0]-o[0])))/2))}else a=Math.abs((t[1][0]-t[0][0])/(o[0]-r[0]));this.projection.translate([t[0][0]-r[0]*a+l-n.left,t[0][1]-r[1]*a+s-n.top]).scale(a).precision(.1),this.mapGraph.selectAll("path").attr("d",this.mapPath),this.parent.mapSvg.style("transform","translate("+n.left+"px,"+n.top+"px)").attr("width",this.context.width).attr("height",this.context.height);this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south);i&&this.parent.boundsChanged(!1)},centroid:function(t){if((t||0==t)&&this.paths[t]){if(this.resolvedCentroidCache[t])return this.geo2Point(this.resolvedCentroidCache[t][0],this.resolvedCentroidCache[t][1]);var e=this.mapPath.centroid(this.paths[t]);return this.resolvedCentroidCache[t]=this.point2Geo(e[0],e[1]),e}return null},geo2Point:function(t,e){return this.projection([t||0,e||0])},point2Geo:function(t,e){return this.projection.invert([t||0,e||0])},getCanvas:function(){return[this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},moveOver:function(t,e){var i=this.projection.translate();this.projection.translate([i[0]+t,i[1]+e]),this.mapGraph.selectAll("path").attr("d",this.mapPath)},zoomMap:function(t,e){var i=this;return new Promise(function(n){var r=i.geo2Point(t[0],t[1]),o=i.context.activeProfile?i.context.activeProfile.margin:{left:0,top:0},a=o.left,s=o.top,l=Math.min(2,Math.max(0,r[0]/i.context.width*2)),u=Math.min(2,Math.max(0,r[1]/i.context.height*2)),c=.1*i.context.width*e,h=.1*i.context.height*e;i.rescaleMap([[-c*l+a,-h*u+s],[i.context.width+c*(2-l)+a,i.context.height+h*(2-u)+s]],!0),n()})}}),f=h.extend({init:function(t,e){this.context=t,this.parent=e,this.bounds=null,this.transformation=null},initMap:function(t){var e=this,i=this;return this.mapCanvas=this.parent.mapRoot,this.mapCanvas.style("width","100%").style("height","100%"),n.default.KEY="AIzaSyAP0vMZwYojifwGYHTnEtYV40v6-MdLGFM",new Promise(function(t,r){n.default.load(function(n){i.map=new n.maps.Map(i.mapCanvas.node(),{draggable:!1,zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0,disableDefaultUI:!0,backgroundColor:"#FFFFFF"}),i.updateLayer(),i.overlay=new n.maps.OverlayView,i.overlay.draw=function(){},i.overlay.setMap(i.map),n.maps.event.addListener(i.map,"bounds_changed",function(){!e.transformation instanceof Promise&&(e.transformation=new Promise(function(t){n.maps.event.addListenerOnce(i.map,"idle",function(){t(),e.transformation=null})}))}),n.maps.event.addListenerOnce(i.map,"idle",function(){var t=new n.maps.LatLngBounds(new n.maps.LatLng(i.context.model.ui.map.bounds.north,i.context.model.ui.map.bounds.west),new n.maps.LatLng(i.context.model.ui.map.bounds.south,i.context.model.ui.map.bounds.east));i.map.fitBounds(t),n.maps.event.trigger(i.map,"resize")}),t()})})},_waitMap:function(){return this.transformation instanceof Promise?this.transformation:new Promise(function(t){return t()})},updateLayer:function(){if(this.map){var t=this.context.model.ui.map.mapStyle.split(" ");if(this.map.setMapTypeId(t[0]),t[1])switch(t[1]){case"grayscale":this.map.setOptions({styles:[{stylers:[{saturation:-100}]}]});break;default:this.map.setOptions({styles:[]})}else this.map.setOptions({styles:[]})}},rescaleMap:function(){var t=this;this._waitMap().then(function(){var e=new google.maps.LatLngBounds(new google.maps.LatLng(t.context.model.ui.map.bounds.north,t.context.model.ui.map.bounds.west),new google.maps.LatLng(t.context.model.ui.map.bounds.south,t.context.model.ui.map.bounds.east));t.map.fitBounds(e),google.maps.event.trigger(t.map,"resize"),google.maps.event.addListener(t.map,"idle",function(){var e=t.map.getBounds();!e||t.bounds&&t.bounds==e||(t.bounds=e,t.parent.boundsChanged())})})},zoomMap:function(t,e){var i=this,n=this;return new Promise(function(r,o){var a=i.geo2Point(t[0],t[1]);n.map.setZoom(n.map.getZoom()+1*e);var s=i.geo2Point(t[0],t[1]);n.map.panBy(s[0]-a[0],s[1]-a[1]),google.maps.event.addListenerOnce(n.map,"idle",function(){r()})})},geo2Point:function(t,e){var i=this.overlay.getProjection();if(!i)return null;var n=i.fromLatLngToContainerPixel(new google.maps.LatLng(e,t));return[n.x,n.y]},point2Geo:function(t,e){var i=this.map.getProjection(),n=this.map.getBounds().getNorthEast(),r=this.map.getBounds().getSouthWest(),o=i.fromLatLngToPoint(n),a=i.fromLatLngToPoint(r),s=Math.pow(2,this.map.getZoom()),l=i.fromPointToLatLng(new google.maps.Point(t/s+a.x,e/s+o.y));return[l.lng(),l.lat()]},moveOver:function(t,e){var i=this;return new Promise(function(n,r){i.map.panBy(-t,-e),google.maps.event.addListenerOnce(i.map,"idle",function(){n()})})},getZoom:function(){return this.map.getZoom()},getCanvas:function(){return[this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},getCenter:function(){var t=this.map.getCenter();return{lat:t.lat(),lng:t.lng()}}}),p=h.extend({init:function(t,e){r.default.accessToken=t.model.ui.map.accessToken||"pk.eyJ1Ijoic2VyZ2V5ZiIsImEiOiJjaXlqeWo5YnYwMDBzMzJwZnlwZXJ2bnA2In0.e711ku9KzcFW_x5wmOZTag",this.context=t,this.parent=e},initMap:function(){var t=this,e=this;return this.mapCanvas=this.parent.mapRoot,new Promise(function(i,n){e.map=new r.default.Map({container:e.mapCanvas.node(),interactive:!1,style:t.context.model.ui.map.mapStyle,hash:!1}),e.bounds=[[e.context.model.ui.map.bounds.west,e.context.model.ui.map.bounds.south],[e.context.model.ui.map.bounds.east,e.context.model.ui.map.bounds.north]],e.map.fitBounds(e.bounds),i()})},rescaleMap:function(t){var e=this;e.bounds=[[e.context.model.ui.map.bounds.west,e.context.model.ui.map.bounds.south],[e.context.model.ui.map.bounds.east,e.context.model.ui.map.bounds.north]],s.defer(function(){t||(t=0),e.map.fitBounds(e.bounds,{duration:t}),e.map.resize(),t?s.delay(t).then(function(){e.parent.boundsChanged()}):e.parent.boundsChanged()})},getCenter:function(){var t=this.map.getCenter();return{lat:t.lat,lng:t.lng}},moveOver:function(t,e){this.map.panBy([-t,-e],{duration:0})},zoomMap:function(t,e){var i=this,n=this;return new Promise(function(r,o){i.map.easeTo({duration:300,around:t,zoom:n.map.getZoom()+1*e}),s.delay(300).then(function(){r()})})},updateLayer:function(){this.map&&this.map.setStyle(this.context.model.ui.map.mapStyle)},getCanvas:function(){return[this.geo2Point(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.geo2Point(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},geo2Point:function(t,e){var i=this.map.project([t,e]);return[i.x,i.y]},point2Geo:function(t,e){var i=this.map.unproject([t,e]);return[i.lng,i.lat]}});e.default=Vizabi.Class.extend({init:function(t,e){return this.context=t,this.domSelector=e,this.zooming=!1,this.topojsonMap=null,this.keys={},this.mapEngine=this.context.model.ui.map.mapEngine,this.mapInstance=null,this.context.element instanceof d3.selection?(this.mapRoot=this.context.element.select(e),this.mapSvg=this.context.element.select(".vzb-bmc-map-background")):(this.mapRoot=d3.select(this.context.element).select(e),this.mapSvg=d3.select(this.context.element).select(".vzb-bmc-map-background")),this.mapRoot.html(""),this.mapSvg.html(""),this},getMap:function(){if(!this.mapInstance){if(this.context.model.ui.map.showMap)switch(this.context.model.ui.map.mapEngine){case"google":this.mapInstance=new f(this.context,this);break;case"mapbox":this.mapInstance=new p(this.context,this)}return this.topojsonMap||(this.topojsonMap=new d(this.context,this)),this}},initMap:function(){var t=this;if(!this.mapInstance)return this.topojsonMap.initMap(this.domSelector).then(function(){t.topojsonMap.showAreas()});var e=this.topojsonMap.initMap(this.domSelector);return this.context.model.ui.map.showAreas&&e.then(function(){t.topojsonMap.showAreas()}),Promise.all([this.mapInstance.initMap(this.domSelector),e])},ready:function(){var t=this,e=this;this._bounds=null;var i=void 0,n=void 0,r=void 0,o=void 0;if(this.keys=Object.keys(e.context.values.hook_centroid).reduce(function(t,i){return t[e.context.values.hook_centroid[i]]=i,t},{}),s.forEach(this.keys,function(e,a){var s=t.topojsonMap.centroid(a);s&&((!i&&0!=i||i>s[0])&&(i=s[0]),(!r&&0!=r||r<s[0])&&(r=s[0]),(!n&&0!=n||n>s[1])&&(n=s[1]),(!o&&0!=o||o<s[1])&&(o=s[1]))}),i<r&&n<o){var a=this.topojsonMap.point2Geo(i,n),l=this.topojsonMap.point2Geo(r,o);this._bounds={west:a[0],north:a[1],east:l[0],south:l[1]}}this.context.mapBoundsChanged()},rescaleMap:function(){if(this.mapInstance){var t=this.context.activeProfile.margin;this.mapRoot.style("position","absolute").style("left",0).style("right",0).style("top",0).style("bottom",0).style("width",this.context.width+t.left+t.right+"px").style("height",this.context.height+t.top+t.bottom+(this.context.model.ui.map.overflowBottom||0)+"px"),this.mapInstance.rescaleMap()}else this.topojsonMap.rescaleMap()},layerChanged:function(){var t=this;this.mapEngine==this.context.model.ui.map.mapEngine&&this.context.model.ui.map.showMap&&this.mapInstance?(this.topojsonMap.areasAreShown!=this.context.model.ui.map.showAreas&&(this.context.model.ui.map.showAreas?this.topojsonMap.showAreas():this.topojsonMap.hideAreas()),this.mapInstance.updateLayer()):(this.mapEngine=this.context.model.ui.map.mapEngine,this.mapInstance=null,this.mapRoot.html(""),this.getMap(),this.initMap(this.domSelector).then(function(){t.mapInstance?t.mapInstance.rescaleMap():t.topojsonMap.rescaleMap()}))},getMapColor:function(t){return this.keys[t]?this.context.mcScale(this.context.values.color_map[this.keys[t]]):this.context.COLOR_WHITEISH},getOpacity:function(t){return this.keys[t]?this.context.getMapOpacity(this.keys[t]):this.context.COLOR_WHITEISH},updateColors:function(){this.context.model.ui.map.showAreas&&this.topojsonMap.updateMapColors()},_getCenter:function(){return this.mapInstance?this.mapInstance.getCenter():this.topojsonMap.getCenter()},resetZoom:function(t){var e=this;if(this._bounds)return this._hideTopojson(),this.context.model.ui.map.bounds={west:this._bounds.west,north:this._bounds.north,east:this._bounds.east,south:this._bounds.south},this.mapInstance?this.mapInstance.rescaleMap(t):this.topojsonMap.rescaleMap(t),t||(t=0),new Promise(function(i,n){s.delay(t).then(function(){e._showTopojson(300),i()})})},panStarted:function(){this.zooming=!0,this.context.model.ui.map.showMap&&this._hideTopojson(),this.canvasBefore=this.getCanvas()},panFinished:function(){var t=this.point2Geo(this.canvasBefore[0][0],this.canvasBefore[0][1]),e=this.point2Geo(this.canvasBefore[1][0],this.canvasBefore[1][1]);this.context.model.ui.map.bounds={west:t[0],north:t[1],east:e[0],south:e[1]},this.zooming=!1,this.boundsChanged(),this._showTopojson(300)},zoomRectangle:function(t,e,i,n){var r=this.point2Geo(Math.min(t,i),Math.min(e,n)),o=this.point2Geo(Math.max(t,i),Math.max(e,n));this.context.model.ui.map.bounds={west:r[0],north:r[1],east:o[0],south:o[1]},this.zooming=!1,this.mapInstance?this.mapInstance.rescaleMap():this.topojsonMap.rescaleMap(),this._showTopojson(300)},moveOver:function(t,e){if(this.mapInstance)return this.mapInstance.moveOver(t,e);this.topojsonMap.moveOver(t,e)},_interact:function(){return this.context._mapIteract()},updateOpacity:function(){this.context.model.ui.map.showAreas&&this.topojsonMap.updateOpacity()},_hideTopojson:function(t){this.context.model.ui.map.showAreas&&(t?this.topojsonMap.mapGraph.transition().duration(t).style("opacity",0):this.topojsonMap.mapGraph.style("opacity",0))},_showTopojson:function(t){this.context.model.ui.map.showAreas&&this.topojsonMap.mapGraph.interrupt().transition().duration(t).style("opacity",t)},zoomMap:function(t,e){var i=this,n=this,r=this.point2Geo(t[0],t[1]);this.canvasBefore=this.getCanvas(),this.zooming=!0,this.context.model.ui.map.showMap&&this._hideTopojson(100);var o=void 0;return this.mapInstance?o=this.mapInstance.zoomMap(r,e):this.context.model.ui.map.showAreas&&(o=this.topojsonMap.zoomMap(r,e)),o.then(function(t){var e=i.point2Geo(i.canvasBefore[0][0],i.canvasBefore[0][1]),r=i.point2Geo(i.canvasBefore[1][0],i.canvasBefore[1][1]);n.context.model.ui.map.bounds={west:e[0],north:e[1],east:r[0],south:r[1]},i.zooming=!1,i.boundsChanged(),i._showTopojson(300)})},boundsChanged:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.zooming){if(t){var e=void 0;this.mapInstance&&(e=this.mapInstance.getCanvas()),this.topojsonMap.rescaleMap(e)}this.context.mapBoundsChanged()}},centroid:function(t){return this.topojsonMap?this.topojsonMap.centroid(t):null},getCanvas:function(){return this.mapInstance?this.mapInstance.getCanvas():this.context.model.ui.map.showAreas?this.topojsonMap.getCanvas():[[0,0],[0,0]]},point2Geo:function(t,e){return this.mapInstance?this.mapInstance.point2Geo(t,e):this.context.model.ui.map.showAreas?this.topojsonMap.point2Geo(t,e):[0,0]},geo2Point:function(t,e){return this.mapInstance?this.mapInstance.geo2Point(t,e):this.context.model.ui.map.showAreas?this.topojsonMap.geo2Point(t,e):[0,0]}})},function(t,e){},function(t,e){},function(t,e,i){var n,r;!function(o,a){if(null===o)throw new Error("Google-maps package can be used only in browser");void 0===(r="function"==typeof(n=a)?n.call(e,i,e,t):n)||(t.exports=r)}("undefined"!=typeof window?window:null,function(){"use strict";var t=null,e=null,i=!1,n=[],r=[],o=null,a={URL:"https://maps.googleapis.com/maps/api/js",KEY:null,LIBRARIES:[],CLIENT:null,CHANNEL:null,LANGUAGE:null,REGION:null,VERSION:"3.31",WINDOW_CALLBACK_NAME:"__google_maps_api_provider_initializator__",_googleMockApiObject:{},load:function(t){null===e?!0===i?t&&n.push(t):(i=!0,window[a.WINDOW_CALLBACK_NAME]=function(){s(t)},a.createLoader()):t&&t(e)},createLoader:function(){(t=document.createElement("script")).type="text/javascript",t.src=a.createUrl(),document.body.appendChild(t)},isLoaded:function(){return null!==e},createUrl:function(){var t=a.URL;return t+="?callback="+a.WINDOW_CALLBACK_NAME,a.KEY&&(t+="&key="+a.KEY),a.LIBRARIES.length>0&&(t+="&libraries="+a.LIBRARIES.join(",")),a.CLIENT&&(t+="&client="+a.CLIENT),a.CHANNEL&&(t+="&channel="+a.CHANNEL),a.LANGUAGE&&(t+="&language="+a.LANGUAGE),a.REGION&&(t+="&region="+a.REGION),a.VERSION&&(t+="&v="+a.VERSION),t},release:function(s){var l=function(){a.KEY=null,a.LIBRARIES=[],a.CLIENT=null,a.CHANNEL=null,a.LANGUAGE=null,a.REGION=null,a.VERSION="3.31",e=null,i=!1,n=[],r=[],void 0!==window.google&&delete window.google,void 0!==window[a.WINDOW_CALLBACK_NAME]&&delete window[a.WINDOW_CALLBACK_NAME],null!==o&&(a.createLoader=o,o=null),null!==t&&(t.parentElement.removeChild(t),t=null),s&&s()};i?a.load(function(){l()}):l()},onLoad:function(t){r.push(t)},makeMock:function(){o=a.createLoader,a.createLoader=function(){window.google=a._googleMockApiObject,window[a.WINDOW_CALLBACK_NAME]()}}},s=function(t){var o;for(i=!1,null===e&&(e=window.google),o=0;o<r.length;o++)r[o](e);for(t&&t(e),o=0;o<n.length;o++)n[o](e);n=[]};return a})},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="mapcolors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="mapcolors" data-click="dragDialog"></span>\n\n  <div class="vzb-dialog-title">\n      <%=t ("buttons/mapcolors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n\n\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="mapoptions" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="mapoptions" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/mapoptions") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-lmap-container vzb-lmap-layers">\n            <form class="vzb-dialog-paragraph  vzb-map-layers">\n                <label for="showBubblesChk"><input id="showBubblesChk" type="checkbox" name="showBubbles"><%=t ("hints/extapimap/showBubbles") %></label>\n                <label for="showAreasChk"><input id="showAreasChk" type="checkbox" name="showAreas"><%=t ("hints/extapimap/showAreas") %></label>\n                <label for="showMapChk"><input id="showMapChk" type="checkbox" name="showMap"><%=t ("hints/extapimap/showMap") %></label>\n            </form>\n        </div>\n        <div class="vzb-lmap-container vzb-lmap-engine">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/extapimap/mapEngine") %></p>\n            <form class="vzb-dialog-paragraph vzb-map-engine"></form>\n        </div>\n        <div class="vzb-lmap-container vzb-lmap-style">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/extapimap/mapStyle") %></p>\n            <form class="vzb-dialog-paragraph  vzb-map-style"></form>\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'},function(t,e){t.exports='\x3c!-- Bubble Map Chart Component --\x3e\n<div class="vzb-extapimap">\n    <div id="vzb-map-background"></div>\n    <svg class="vzb-extapimap-svg vzb-export">\n        <g class="vzb-bmc-map-background"></g>\n        <g class="vzb-bmc-graph">\n            <g class="vzb-bmc-year"></g>\n\n            <g class="vzb-bmc-lines"></g>\n            <g class="vzb-bmc-bubbles"></g>\n\n            <g class="vzb-bmc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-c-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-bmc-axis-y-info vzb-noexport">\n            </g>\n\n            <g class="vzb-bmc-axis-c-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n            <g class="vzb-bmc-labels"></g>\n\n            <rect class="vzb-bc-zoom-rect"></rect>\n        </g>\n    </svg>\n</div>\n'},function(t,e,i){(function(e){var i,n;n=function(){return function t(e,n,r){function o(s,l){if(!n[s]){if(!e[s]){if(!l&&("function"==typeof i&&i))return i(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return o(i||t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var a="function"==typeof i&&i,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,i){var n,r;n=this,r=function(){"use strict";return function(){var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0}(),function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}(),{vec3:{transformMat3:function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t}},vec4:{transformMat4:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,t}},mat2:{create:function(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},rotate:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*s,t[1]=r*l+a*s,t[2]=n*-s+o*l,t[3]=r*-s+a*l,t},scale:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],l=i[1];return t[0]=n*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t}},mat3:{create:function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromRotation:function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},mat4:{create:function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},translate:function(t,e,i){var n,r,o,a,s,l,u,c,h,d,f,p,m=i[0],v=i[1],g=i[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=d,t[10]=f,t[11]=p,t[12]=n*m+s*v+h*g+e[12],t[13]=r*m+l*v+d*g+e[13],t[14]=o*m+u*v+f*g+e[14],t[15]=a*m+c*v+p*g+e[15]),t},scale:function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],_=i[0],b=i[1],x=i[2],w=i[3];return t[0]=_*n+b*s+x*h+w*m,t[1]=_*r+b*l+x*d+w*v,t[2]=_*o+b*u+x*f+w*g,t[3]=_*a+b*c+x*p+w*y,_=i[4],b=i[5],x=i[6],w=i[7],t[4]=_*n+b*s+x*h+w*m,t[5]=_*r+b*l+x*d+w*v,t[6]=_*o+b*u+x*f+w*g,t[7]=_*a+b*c+x*p+w*y,_=i[8],b=i[9],x=i[10],w=i[11],t[8]=_*n+b*s+x*h+w*m,t[9]=_*r+b*l+x*d+w*v,t[10]=_*o+b*u+x*f+w*g,t[11]=_*a+b*c+x*p+w*y,_=i[12],b=i[13],x=i[14],w=i[15],t[12]=_*n+b*s+x*h+w*m,t[13]=_*r+b*l+x*d+w*v,t[14]=_*o+b*u+x*f+w*g,t[15]=_*a+b*c+x*p+w*y,t},perspective:function(t,e,i,n,r){var o=1/Math.tan(e/2),a=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*a,t[15]=0,t},rotateX:function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=a*r+c*n,t[6]=s*r+h*n,t[7]=l*r+d*n,t[8]=u*r-o*n,t[9]=c*r-a*n,t[10]=h*r-s*n,t[11]=d*r-l*n,t},rotateZ:function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=a*r+c*n,t[2]=s*r+h*n,t[3]=l*r+d*n,t[4]=u*r-o*n,t[5]=c*r-a*n,t[6]=h*r-s*n,t[7]=d*r-l*n,t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=i*s-n*a,_=i*l-r*a,b=i*u-o*a,x=n*l-r*s,w=n*u-o*s,S=r*u-o*l,M=c*m-h*p,E=c*v-d*p,z=c*g-f*p,k=h*v-d*m,T=h*g-f*m,O=d*g-f*v,C=y*O-_*T+b*k+x*z-w*E+S*M;return C?(C=1/C,t[0]=(s*O-l*T+u*k)*C,t[1]=(r*T-n*O-o*k)*C,t[2]=(m*S-v*w+g*x)*C,t[3]=(d*w-h*S-f*x)*C,t[4]=(l*z-a*O-u*E)*C,t[5]=(i*O-r*z+o*E)*C,t[6]=(v*b-p*S-g*_)*C,t[7]=(c*S-d*b+f*_)*C,t[8]=(a*T-s*z+u*M)*C,t[9]=(n*z-i*T-o*M)*C,t[10]=(p*w-m*b+g*y)*C,t[11]=(h*b-c*w-f*y)*C,t[12]=(s*E-a*k-l*M)*C,t[13]=(i*k-n*E+r*M)*C,t[14]=(m*_-p*x-v*y)*C,t[15]=(c*x-h*_+d*y)*C,t):null},ortho:function(t,e,i,n,r,o,a){var s=1/(e-i),l=1/(n-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(a+o)*u,t[15]=1,t}}}},"object"==typeof i&&void 0!==e?e.exports=r():n.glMatrix=r()},{}],2:[function(t,e,i){var n,r;n=this,r=function(){function t(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function e(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,n,r,o,a=[],s=0;s<t.length;s++)if(i=t[s].w||t[s].width,n=t[s].h||t[s].height,r=t[s].id,i&&n){if(!(o=this.packOne(i,n,r)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}if(this.shelves.length>0){for(var l=0,u=0,c=0;c<this.shelves.length;c++){var h=this.shelves[c];u+=h.h,l=Math.max(h.w-h.free,l)}this.resize(l,u)}return a},t.prototype.packOne=function(t,i,n){var r,o,a,s,l,u,c,h,d={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof n||"number"==typeof n){if(r=this.getBin(n))return this.ref(r),r;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(s=0;s<this.freebins.length;s++){if(i===(r=this.freebins[s]).maxh&&t===r.maxw)return this.allocFreebin(s,t,i,n);i>r.maxh||t>r.maxw||i<=r.maxh&&t<=r.maxw&&((a=r.maxw*r.maxh-t*i)<d.waste&&(d.waste=a,d.freebin=s))}for(s=0;s<this.shelves.length;s++)if(f+=(o=this.shelves[s]).h,!(t>o.free)){if(i===o.h)return this.allocShelf(s,t,i,n);i>o.h||i<o.h&&((a=(o.h-i)*t)<d.waste&&(d.freebin=-1,d.waste=a,d.shelf=s))}return-1!==d.freebin?this.allocFreebin(d.freebin,t,i,n):-1!==d.shelf?this.allocShelf(d.shelf,t,i,n):i<=this.h-f&&t<=this.w?(o=new e(f,this.w,i),this.allocShelf(this.shelves.push(o)-1,t,i,n)):this.autoResize?(l=u=this.h,((c=h=this.w)<=l||t>c)&&(h=2*Math.max(t,c)),(l<c||i>l)&&(u=2*Math.max(i,l)),this.resize(h,u),this.packOne(t,i,n)):null},t.prototype.allocFreebin=function(t,e,i,n){var r=this.freebins.splice(t,1)[0];return r.id=n,r.w=e,r.h=i,r.refcount=0,this.bins[n]=r,this.ref(r),r},t.prototype.allocShelf=function(t,e,i,n){var r=this.shelves[t].alloc(e,i,n);return this.bins[n]=r,this.ref(r),r},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},e.prototype.alloc=function(t,e,i){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,new function(t,e,i,n,r,o,a){this.id=t,this.x=e,this.y=i,this.w=n,this.h=r,this.maxw=o||n,this.maxh=a||r,this.refcount=0}(i,n,this.y,t,e,t,this.h)},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t},"object"==typeof i&&void 0!==e?e.exports=r():n.ShelfPack=r()},{}],3:[function(t,e,i){function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}e.exports=n,n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var i,n,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if(n=1,(r=t)<(i=0))return i;if(r>n)return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],4:[function(t,e,i){var n;n=this,function(t){function e(t,e,n){var r=i(256*t,256*(e=Math.pow(2,n)-e-1),n),o=i(256*(t+1),256*(e+1),n);return r[0]+","+r[1]+","+o[0]+","+o[1]}function i(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}t.getURL=function(t,i,n,r,o,a){return a=a||{},t+"?"+["bbox="+e(n,r,o),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof i&&void 0!==e?i:n.WhooTS=n.WhooTS||{})},{}],5:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,s,l,u,c,f,m,v=e&&e.length,g=v?e[0]*i:t.length,y=r(t,0,g,i,!0),_=[];if(!y)return _;if(v&&(y=function(t,e,i,n){var a,s,l,u,c,f=[];for(a=0,s=e.length;a<s;a++)l=e[a]*n,u=a<s-1?e[a+1]*n:t.length,(c=r(t,l,u,n,!1))===c.next&&(c.steiner=!0),f.push(p(c));for(f.sort(h),a=0;a<f.length;a++)d(f[a],i),i=o(i,i.next);return i}(t,e,y,i)),t.length>80*i){n=l=t[0],s=u=t[1];for(var b=i;b<g;b+=i)c=t[b],f=t[b+1],c<n&&(n=c),f<s&&(s=f),c>l&&(l=c),f>u&&(u=f);m=Math.max(l-n,u-s)}return a(y,_,i,n,s,m),_}function r(t,e,i,n,r){var o,a;if(r===E(t,e,i,n)>0)for(o=e;o<i;o+=n)a=w(o,t[o],t[o+1],a);else for(o=i-n;o>=e;o-=n)a=w(o,t[o],t[o+1],a);return a&&y(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!y(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(S(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function a(t,e,i,n,r,h,d){if(t){!d&&h&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=f(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,a,s,l,u=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,n=i,s=0,e=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;s>0||l>0&&n;)0===s?(r=n,n=n.nextZ,l--):0!==l&&n?i.z<=n.z?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--):(r=i,i=i.nextZ,s--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(a>1)}(r)}(t,n,r,h);for(var p,m,v=t;t.prev!==t.next;)if(p=t.prev,m=t.next,h?l(t,n,r,h):s(t))e.push(p.i/i),e.push(t.i/i),e.push(m.i/i),S(t),t=m.next,v=m.next;else if((t=m)===v){d?1===d?a(t=u(t,e,i),e,i,n,r,h,2):2===d&&c(t,e,i,n,r,h):a(o(t),e,i,n,r,h,1);break}}}function s(t){var e=t.prev,i=t,n=t.next;if(g(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(m(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,i,n){var r=t.prev,o=t,a=t.next;if(g(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=f(s,l,e,i,n),d=f(u,c,e,i,n),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&m(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function u(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!y(r,o)&&_(r,n,n.next,o)&&b(r,o)&&b(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),S(n),S(n.next),n=t=o),n=n.next}while(n!==t);return n}function c(t,e,i,n,r,s){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&v(l,u)){var c=x(l,u);return l=o(l,l.next),c=o(c,c.next),a(l,e,i,n,r,s),void a(c,e,i,n,r,s)}u=u.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var i,n=e,r=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a){if(a=s,s===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var l,u=i,c=i.x,h=i.y,d=1/0;for(n=i.next;n!==u;)r>=n.x&&n.x>=c&&m(o<h?r:a,o,c,h,o<h?a:r,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(r-n.x))<d||l===d&&n.x>i.x)&&b(n,t)&&(i=n,d=l),n=n.next;return i}(t,e)){var i=x(e,t);o(i,i.next)}}function f(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,n,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(i-a)*(e-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&_(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function g(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,i,n){return!!(y(t,e)&&y(i,n)||y(t,n)&&y(i,e))||g(t,e,i)>0!=g(t,e,n)>0&&g(i,n,t)>0!=g(i,n,e)>0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function x(t,e){var i=new M(t.i,t.x,t.y),n=new M(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function w(t,e,i,n){var r=new M(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function M(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,i,n){for(var r=0,o=e,a=i-n;o<i;o+=n)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}e.exports=n,n.deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,a=Math.abs(E(t,0,o,i));if(r)for(var s=0,l=e.length;s<l;s++){var u=e[s]*i,c=s<l-1?e[s+1]*i:t.length;a-=Math.abs(E(t,u,c,i))}var h=0;for(s=0;s<n.length;s+=3){var d=n[s]*i,f=n[s+1]*i,p=n[s+2]*i;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[r][o][a]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],6:[function(t,e,i){function n(t){var e=0;if(t&&t.length>0){e+=Math.abs(r(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(r(t[i]))}return e}function r(t){var e=0;if(t.length>2){for(var i,n,r=0;r<t.length-1;r++)i=t[r],e+=o((n=t[r+1])[0]-i[0])*(2+Math.sin(o(i[1]))+Math.sin(o(n[1])));e=e*a.RADIUS*a.RADIUS/2}return e}function o(t){return t*Math.PI/180}var a=t("wgs84");e.exports.geometry=function(t){if("Polygon"===t.type)return n(t.coordinates);if("MultiPolygon"===t.type){for(var e=0,i=0;i<t.coordinates.length;i++)e+=n(t.coordinates[i]);return e}return null},e.exports.ring=r},{wgs84:42}],7:[function(t,e,i){function n(t,e){return function(i){return t(i,e)}}function r(t,e){e=!!e,t[0]=o(t[0],!e);for(var i=1;i<t.length;i++)t[i]=o(t[i],e);return t}function o(t,e){return function(t){return a.ring(t)>=0}(t)===e?t:t.reverse()}var a=t("geojson-area");e.exports=function t(e,i){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(n(t,i)),e;case"Feature":return e.geometry=t(e.geometry,i),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=r(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(n(r,e))),t}(e,i);default:return e}}},{"geojson-area":6}],8:[function(t,e,i){"use strict";function n(t,e,i,n){for(var r=[],o=0;o<t.length;o++){var a=t[o],s=a[n];s>=e&&s<=i&&r.push(a)}return r}function r(t,e,i,n,r,a){for(var s=[],l=0;l<t.length;l++){var u,c,h,d=0,f=0,p=null,m=t[l],v=m.area,g=m.dist,y=m.outer,_=m.length,b=[];for(c=0;c<_-1;c++)u=p||m[c],p=m[c+1],d=f||u[n],f=p[n],d<e?f>i?(b.push(r(u,p,e),r(u,p,i)),a||(b=o(s,b,v,g,y))):f>=e&&b.push(r(u,p,e)):d>i?f<e?(b.push(r(u,p,i),r(u,p,e)),a||(b=o(s,b,v,g,y))):f<=i&&b.push(r(u,p,i)):(b.push(u),f<e?(b.push(r(u,p,e)),a||(b=o(s,b,v,g,y))):f>i&&(b.push(r(u,p,i)),a||(b=o(s,b,v,g,y))));(d=(u=m[_-1])[n])>=e&&d<=i&&b.push(u),h=b[b.length-1],a&&h&&(b[0][0]!==h[0]||b[0][1]!==h[1])&&b.push(b[0]),o(s,b,v,g,y)}return s}function o(t,e,i,n,r){return e.length&&(e.area=i,e.dist=n,void 0!==r&&(e.outer=r),t.push(e)),[]}e.exports=function(t,e,i,o,s,l,u,c){if(o/=e,u>=(i/=e)&&c<=o)return t;if(u>o||c<i)return null;for(var h=[],d=0;d<t.length;d++){var f,p,m=t[d],v=m.geometry,g=m.type;if(f=m.min[s],p=m.max[s],f>=i&&p<=o)h.push(m);else if(!(f>o||p<i)){var y=1===g?n(v,i,o,s):r(v,i,o,s,l,3===g);y.length&&h.push(a(m.tags,g,y,m.id))}}return h.length?h:null};var a=t("./feature")},{"./feature":10}],9:[function(t,e,i){"use strict";function n(t,e,i){if(null!==e.geometry){var a,l,u,c,h=e.geometry,d=h.type,f=h.coordinates,p=e.properties,m=e.id;if("Point"===d)t.push(s(p,1,[o(f)],m));else if("MultiPoint"===d)t.push(s(p,1,r(f),m));else if("LineString"===d)t.push(s(p,2,[r(f,i)],m));else if("MultiLineString"===d||"Polygon"===d){for(u=[],a=0;a<f.length;a++)c=r(f[a],i),"Polygon"===d&&(c.outer=0===a),u.push(c);t.push(s(p,"Polygon"===d?3:2,u,m))}else if("MultiPolygon"===d){for(u=[],a=0;a<f.length;a++)for(l=0;l<f[a].length;l++)(c=r(f[a][l],i)).outer=0===l,u.push(c);t.push(s(p,3,u,m))}else{if("GeometryCollection"!==d)throw new Error("Input data is not a valid GeoJSON object.");for(a=0;a<h.geometries.length;a++)n(t,{geometry:h.geometries[a],properties:p},i)}}}function r(t,e){for(var i=[],n=0;n<t.length;n++)i.push(o(t[n]));return e&&(a(i,e),function(t){for(var e,i,n=0,r=0,o=0;o<t.length-1;o++)e=i||t[o],i=t[o+1],n+=e[0]*i[1]-i[0]*e[1],r+=Math.abs(i[0]-e[0])+Math.abs(i[1]-e[1]);t.area=Math.abs(n/2),t.dist=r}(i)),i}function o(t){var e=Math.sin(t[1]*Math.PI/180),i=t[0]/360+.5,n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return[i,n=n<0?0:n>1?1:n,0]}e.exports=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)n(i,t.features[r],e);else"Feature"===t.type?n(i,t,e):n(i,{geometry:t},e);return i};var a=t("./simplify"),s=t("./feature")},{"./feature":10,"./simplify":12}],10:[function(t,e,i){"use strict";function n(t,e,i){for(var n,r=0;r<i.length;r++)n=i[r],t[0]=Math.min(n[0],t[0]),e[0]=Math.max(n[0],e[0]),t[1]=Math.min(n[1],t[1]),e[1]=Math.max(n[1],e[1])}e.exports=function(t,e,i,r){var o={id:r||null,type:e,geometry:i,tags:t||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(t){var e=t.geometry,i=t.min,r=t.max;if(1===t.type)n(i,r,e);else for(var o=0;o<e.length;o++)n(i,r,e[o])}(o),o}},{}],11:[function(t,e,i){"use strict";function n(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;i&&console.time("preprocess data");var n=1<<e.maxZoom,r=l(t,e.tolerance/(n*e.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=h(r,e.buffer/e.extent,o)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function r(t,e,i){return 32*((1<<t)*i+e)+t}function o(t,e,i){return[i,(i-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],1]}function a(t,e,i){return[(i-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],i,1]}function s(t,e,i){var n=t.source;if(1!==n.length)return!1;var r=n[0];if(3!==r.type||r.geometry.length>1)return!1;var o=r.geometry[0].length;if(5!==o)return!1;for(var a=0;a<o;a++){var s=u.point(r.geometry[0][a],e,t.z2,t.x,t.y);if(s[0]!==-i&&s[0]!==e+i||s[1]!==-i&&s[1]!==e+i)return!1}return!0}e.exports=function(t,e){return new n(t,e)};var l=t("./convert"),u=t("./transform"),c=t("./clip"),h=t("./wrap"),d=t("./tile");n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},n.prototype.splitTile=function(t,e,i,n,l,u,h){for(var f=[t,e,i,n],p=this.options,m=p.debug,v=null;f.length;){n=f.pop(),i=f.pop(),e=f.pop(),t=f.pop();var g=1<<e,y=r(e,i,n),_=this.tiles[y],b=e===p.maxZoom?0:p.tolerance/(g*p.extent);if(!_&&(m>1&&console.time("creation"),_=this.tiles[y]=d(t,g,i,n,b,e===p.maxZoom),this.tileCoords.push({z:e,x:i,y:n}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,_.numFeatures,_.numPoints,_.numSimplified),console.timeEnd("creation"));var x="z"+e;this.stats[x]=(this.stats[x]||0)+1,this.total++}if(_.source=t,l){if(e===p.maxZoom||e===l)continue;var w=1<<l-e;if(i!==Math.floor(u/w)||n!==Math.floor(h/w))continue}else if(e===p.indexMaxZoom||_.numPoints<=p.indexMaxPoints)continue;if(p.solidChildren||!s(_,p.extent,p.buffer)){_.source=null,m>1&&console.time("clipping");var S,M,E,z,k,T,O=.5*p.buffer/p.extent,C=.5-O,P=.5+O,A=1+O;S=M=E=z=null,k=c(t,g,i-O,i+P,0,o,_.min[0],_.max[0]),T=c(t,g,i+C,i+A,0,o,_.min[0],_.max[0]),k&&(S=c(k,g,n-O,n+P,1,a,_.min[1],_.max[1]),M=c(k,g,n+C,n+A,1,a,_.min[1],_.max[1])),T&&(E=c(T,g,n-O,n+P,1,a,_.min[1],_.max[1]),z=c(T,g,n+C,n+A,1,a,_.min[1],_.max[1])),m>1&&console.timeEnd("clipping"),t.length&&(f.push(S||[],e+1,2*i,2*n),f.push(M||[],e+1,2*i,2*n+1),f.push(E||[],e+1,2*i+1,2*n),f.push(z||[],e+1,2*i+1,2*n+1))}else l&&(v=e)}return v},n.prototype.getTile=function(t,e,i){var n=this.options,o=n.extent,a=n.debug,l=1<<t,c=r(t,e=(e%l+l)%l,i);if(this.tiles[c])return u.tile(this.tiles[c],o);a>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var h,d=t,f=e,p=i;!h&&d>0;)d--,f=Math.floor(f/2),p=Math.floor(p/2),h=this.tiles[r(d,f,p)];if(!h||!h.source)return null;if(a>1&&console.log("found parent tile z%d-%d-%d",d,f,p),s(h,o,n.buffer))return u.tile(h,o);a>1&&console.time("drilling down");var m=this.splitTile(h.source,d,f,p,t,e,i);if(a>1&&console.timeEnd("drilling down"),null!==m){var v=1<<t-m;c=r(m,Math.floor(e/v),Math.floor(i/v))}return this.tiles[c]?u.tile(this.tiles[c],o):null}},{"./clip":8,"./convert":9,"./tile":13,"./transform":14,"./wrap":15}],12:[function(t,e,i){"use strict";function n(t,e,i){var n=e[0],r=e[1],o=i[0],a=i[1],s=t[0],l=t[1],u=o-n,c=a-r;if(0!==u||0!==c){var h=((s-n)*u+(l-r)*c)/(u*u+c*c);h>1?(n=o,r=a):h>0&&(n+=u*h,r+=c*h)}return(u=s-n)*u+(c=l-r)*c}e.exports=function(t,e){var i,r,o,a,s=e*e,l=0,u=t.length-1,c=[];for(t[l][2]=1,t[u][2]=1;u;){for(r=0,i=l+1;i<u;i++)(o=n(t[i],t[l],t[u]))>r&&(a=i,r=o);r>s?(t[a][2]=r,c.push(l),c.push(a),l=a):(u=c.pop(),l=c.pop())}}},{}],13:[function(t,e,i){"use strict";function n(t,e,i,n){var o,a,s,l,u=e.geometry,c=e.type,h=[],d=i*i;if(1===c)for(o=0;o<u.length;o++)h.push(u[o]),t.numPoints++,t.numSimplified++;else for(o=0;o<u.length;o++)if(s=u[o],n||!(2===c&&s.dist<i||3===c&&s.area<d)){var f=[];for(a=0;a<s.length;a++)l=s[a],(n||l[2]>d)&&(f.push(l),t.numSimplified++),t.numPoints++;3===c&&r(f,s.outer),h.push(f)}else t.numPoints+=s.length;if(h.length){var p={geometry:h,type:c,tags:e.tags||null};null!==e.id&&(p.id=e.id),t.features.push(p)}}function r(t,e){(function(t){for(var e,i,n=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],i=t[a],n+=(i[0]-e[0])*(e[1]+i[1]);return n})(t)<0===e&&t.reverse()}e.exports=function(t,e,i,r,o,a){for(var s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z2:e,transformed:!1,min:[2,1],max:[-1,0]},l=0;l<t.length;l++){s.numFeatures++,n(s,t[l],o,a);var u=t[l].min,c=t[l].max;u[0]<s.min[0]&&(s.min[0]=u[0]),u[1]<s.min[1]&&(s.min[1]=u[1]),c[0]>s.max[0]&&(s.max[0]=c[0]),c[1]>s.max[1]&&(s.max[1]=c[1])}return s}},{}],14:[function(t,e,i){"use strict";function n(t,e,i,n,r){return[Math.round(e*(t[0]*i-n)),Math.round(e*(t[1]*i-r))]}i.tile=function(t,e){if(t.transformed)return t;var i,r,o,a=t.z2,s=t.x,l=t.y;for(i=0;i<t.features.length;i++){var u=t.features[i],c=u.geometry;if(1===u.type)for(r=0;r<c.length;r++)c[r]=n(c[r],e,a,s,l);else for(r=0;r<c.length;r++){var h=c[r];for(o=0;o<h.length;o++)h[o]=n(h[o],e,a,s,l)}}return t.transformed=!0,t},i.point=n},{}],15:[function(t,e,i){"use strict";function n(t,e){for(var i=[],n=0;n<t.length;n++){var o,s=t[n],l=s.type;if(1===l)o=r(s.geometry,e);else{o=[];for(var u=0;u<s.geometry.length;u++)o.push(r(s.geometry[u],e))}i.push(a(s.tags,l,o,s.id))}return i}function r(t,e){var i=[];i.area=t.area,i.dist=t.dist;for(var n=0;n<t.length;n++)i.push([t[n][0]+e,t[n][1],t[n][2]]);return i}var o=t("./clip"),a=t("./feature");e.exports=function(t,e,i){var r=t,a=o(t,1,-1-e,e,0,i,-1,2),s=o(t,1,1-e,2+e,0,i,-1,2);return(a||s)&&(r=o(t,1,-e,1+e,0,i,-1,2)||[],a&&(r=n(a,1).concat(r)),s&&(r=r.concat(n(s,-1)))),r}},{"./clip":8,"./feature":10}],16:[function(t,e,i){"use strict";function n(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],e=o[1],i=o[2],this.d=e+2*i;for(var a=0;a<this.d*this.d;a++){var s=o[r+a],l=o[r+a+1];n.push(s===l?null:o.subarray(s,l))}var u=o[r+n.length],c=o[r+n.length+1];this.keys=o.subarray(u,c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var h=0;h<this.d*this.d;h++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var d=i/e*t;this.min=-d,this.max=t+d}e.exports=n;var r=3;n.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(t,e,i,n,r,o){this.cells[r].push(o)},n.prototype.query=function(t,e,i,n){var r=this.min,o=this.max;if(t<=r&&e<=r&&o<=i&&o<=n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{}),a},n.prototype._queryCell=function(t,e,i,n,r,o,a){var s=this.cells[r];if(null!==s)for(var l=this.keys,u=this.bboxes,c=0;c<s.length;c++){var h=s[c];if(void 0===a[h]){var d=4*h;t<=u[d+2]&&e<=u[d+3]&&i>=u[d+0]&&n>=u[d+1]?(a[h]=!0,o.push(l[h])):a[h]=!1}}},n.prototype._forEachCell=function(t,e,i,n,r,o,a){for(var s=this._convertToCellCoord(t),l=this._convertToCellCoord(e),u=this._convertToCellCoord(i),c=this._convertToCellCoord(n),h=s;h<=u;h++)for(var d=l;d<=c;d++){var f=this.d*d+h;if(r.call(this,t,e,i,n,f,o,a))return}},n.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=r+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var o=new Int32Array(e+i+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var a=e,s=0;s<t.length;s++){var l=t[s];o[r+s]=a,o.set(l,a),a+=l.length}return o[r+t.length]=a,o.set(this.keys,a),a+=this.keys.length,o[r+t.length+1]=a,o.set(this.bboxes,a),a+=this.bboxes.length,o.buffer}},{}],17:[function(t,e,i){i.read=function(t,e,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?r-1:0,d=i?-1:1,f=t[e+h];for(h+=d,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=d,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=d,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=u}return(f?-1:1)*a*Math.pow(2,o-n)},i.write=function(t,e,i,n,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;t[i+f]=255&s,f+=p,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;t[i+f]=255&a,f+=p,a/=256,u-=8);t[i+f-p]|=128*m}},{}],18:[function(t,e,i){"use strict";function n(t,e,i,n,s){e=e||r,i=i||o,s=s||Array,this.nodeSize=n||64,this.points=t,this.ids=new s(t.length),this.coords=new s(2*t.length);for(var l=0;l<t.length;l++)this.ids[l]=l,this.coords[2*l]=e(t[l]),this.coords[2*l+1]=i(t[l]);a(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function r(t){return t[0]}function o(t){return t[1]}var a=t("./sort"),s=t("./range"),l=t("./within");e.exports=function(t,e,i,r,o){return new n(t,e,i,r,o)},n.prototype={range:function(t,e,i,n){return s(this.ids,this.coords,t,e,i,n,this.nodeSize)},within:function(t,e,i){return l(this.ids,this.coords,t,e,i,this.nodeSize)}}},{"./range":19,"./sort":20,"./within":21}],19:[function(t,e,i){"use strict";e.exports=function(t,e,i,n,r,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),d=u.pop(),f=u.pop();if(d-f<=a)for(var p=f;p<=d;p++)s=e[2*p],l=e[2*p+1],s>=i&&s<=r&&l>=n&&l<=o&&c.push(t[p]);else{var m=Math.floor((f+d)/2);s=e[2*m],l=e[2*m+1],s>=i&&s<=r&&l>=n&&l<=o&&c.push(t[m]);var v=(h+1)%2;(0===h?i<=s:n<=l)&&(u.push(f),u.push(m-1),u.push(v)),(0===h?r>=s:o>=l)&&(u.push(m+1),u.push(d),u.push(v))}}return c}},{}],20:[function(t,e,i){"use strict";function n(t,e,i,n){r(t,i,n),r(e,2*i,2*n),r(e,2*i+1,2*n+1)}function r(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}e.exports=function t(e,i,r,o,a,s){if(!(a-o<=r)){var l=Math.floor((o+a)/2);(function t(e,i,r,o,a,s){for(;a>o;){if(a-o>600){var l=a-o+1,u=r-o+1,c=Math.log(l),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1),f=Math.max(o,Math.floor(r-u*h/l+d)),p=Math.min(a,Math.floor(r+(l-u)*h/l+d));t(e,i,r,f,p,s)}var m=i[2*r+s],v=o,g=a;for(n(e,i,o,r),i[2*a+s]>m&&n(e,i,o,a);v<g;){for(n(e,i,v,g),v++,g--;i[2*v+s]<m;)v++;for(;i[2*g+s]>m;)g--}i[2*o+s]===m?n(e,i,o,g):n(e,i,++g,a),g<=r&&(o=g+1),r<=g&&(a=g-1)}})(e,i,l,o,a,s%2),t(e,i,r,o,l-1,s+1),t(e,i,r,l+1,a,s+1)}}},{}],21:[function(t,e,i){"use strict";function n(t,e,i,n){var r=t-i,o=e-n;return r*r+o*o}e.exports=function(t,e,i,r,o,a){for(var s=[0,t.length-1,0],l=[],u=o*o;s.length;){var c=s.pop(),h=s.pop(),d=s.pop();if(h-d<=a)for(var f=d;f<=h;f++)n(e[2*f],e[2*f+1],i,r)<=u&&l.push(t[f]);else{var p=Math.floor((d+h)/2),m=e[2*p],v=e[2*p+1];n(m,v,i,r)<=u&&l.push(t[p]);var g=(c+1)%2;(0===c?i-o<=m:r-o<=v)&&(s.push(d),s.push(p-1),s.push(g)),(0===c?i+o>=m:r+o>=v)&&(s.push(p+1),s.push(h),s.push(g))}}return l}},{}],22:[function(t,e,i){"use strict";function n(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&"Worker"in window&&"Uint8ClampedArray"in window&&function(t){return void 0===r[t]&&(r[t]=function(t){var e=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.probablySupportsContext?e.probablySupportsContext("webgl",i)||e.probablySupportsContext("experimental-webgl",i):e.supportsContext?e.supportsContext("webgl",i)||e.supportsContext("experimental-webgl",i):e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}(t)),r[t]}(t&&t.failIfMajorPerformanceCaveat))}void 0!==e&&e.exports?e.exports=n:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=n);var r={};n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},{}],23:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(i=a+"/"+i,r="/"===a.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),o="/"===a(t,-1);return(t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),o=n(e.split("/")),a=Math.min(r.length,o.length),s=a,l=0;l<a;l++)if(r[l]!==o[l]){s=l;break}var u=[];for(l=s;l<r.length;l++)u.push("..");return(u=u.concat(o.slice(s))).join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=o(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=o(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return o(t)[3]};var a="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return e<0&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:27}],24:[function(t,e,i){"use strict";function n(t){var e;t&&t.length&&(t=(e=t).length);var i=new Uint8Array(t||0);return e&&i.set(e),i.readUInt32LE=o.readUInt32LE,i.writeUInt32LE=o.writeUInt32LE,i.readInt32LE=o.readInt32LE,i.writeInt32LE=o.writeInt32LE,i.readFloatLE=o.readFloatLE,i.writeFloatLE=o.writeFloatLE,i.readDoubleLE=o.readDoubleLE,i.writeDoubleLE=o.writeDoubleLE,i.toString=o.toString,i.write=o.write,i.slice=o.slice,i.copy=o.copy,i._isBuffer=!0,i}function r(t){for(var e,i,n=t.length,r=[],o=0;o<n;o++){if((e=t.charCodeAt(o))>55295&&e<57344){if(!i){e>56319||o+1===n?r.push(239,191,189):i=e;continue}if(e<56320){r.push(239,191,189),i=e;continue}e=i-55296<<10|e-56320|65536,i=null}else i&&(r.push(239,191,189),i=null);e<128?r.push(e):e<2048?r.push(e>>6|192,63&e|128):e<65536?r.push(e>>12|224,e>>6&63|128,63&e|128):r.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return r}e.exports=n;var o,a,s,l=t("ieee754");(o={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return l.read(this,t,!0,23,4)},readDoubleLE:function(t){return l.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return l.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return l.write(this,t,e,!0,52,8)},toString:function(t,e,i){var n="",r="";e=e||0,i=Math.min(this.length,i||this.length);for(var o=e;o<i;o++){var a=this[o];a<=127?(n+=decodeURIComponent(r)+String.fromCharCode(a),r=""):r+="%"+a.toString(16)}return n+decodeURIComponent(r)},write:function(t,e){for(var i=t===a?s:r(t),n=0;n<i.length;n++)this[e+n]=i[n]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var i=0;i<this.length;i++)t[e+i]=this[i]}}).writeInt32LE=o.writeUInt32LE,n.byteLength=function(t){return a=t,(s=r(t)).length},n.isBuffer=function(t){return!(!t||!t._isBuffer)}},{ieee754:17}],25:[function(t,i,n){(function(e){"use strict";function n(t){this.buf=f.isBuffer(t)?t:new f(t||0),this.pos=0,this.length=this.buf.length}function r(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function o(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function a(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function s(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}i.exports=n;var f=e.Buffer||t("./buffer");n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var p=Math.pow(2,63);n.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readUInt32LE(this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readInt32LE(this.pos+4);return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,e,i=this.buf;return t=127&(e=i[this.pos++]),e<128?t:(t|=(127&(e=i[this.pos++]))<<7,e<128?t:(t|=(127&(e=i[this.pos++]))<<14,e<128?t:(t|=(127&(e=i[this.pos++]))<<21,e<128?t:function(t,e){var i,n=e.buf;if(t+=268435456*(127&(i=n[e.pos++])),i<128)return t;if(t+=34359738368*(127&(i=n[e.pos++])),i<128)return t;if(t+=4398046511104*(127&(i=n[e.pos++])),i<128)return t;if(t+=562949953421312*(127&(i=n[e.pos++])),i<128)return t;if(t+=72057594037927940*(127&(i=n[e.pos++])),i<128)return t;if(t+=0x8000000000000000*(127&(i=n[e.pos++])),i<128)return t;throw new Error("Expected varint not more than 10 bytes")}(t,this))))},readVarint64:function(){var t=this.pos,e=this.readVarint();if(e<p)return e;for(var i=this.pos-2;255===this.buf[i];)i--;i<t&&(i=t),e=0;for(var n=0;n<i-t+1;n++){var r=127&~this.buf[t+n];e+=n<4?r<<7*n:r*Math.pow(2,7*n)}return-e-1},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.buf.toString("utf8",this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.slice(this.pos,t);return this.pos=t,e},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readVarint());return e},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(t){var e=7&t;if(e===n.Varint)for(;this.buf[this.pos++]>127;);else if(e===n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===n.Fixed32)this.pos+=4;else{if(e!==n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new f(e);this.buf.copy(i),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeUInt32LE(Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeInt32LE(Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){return(t=+t)>268435455?void function(t,e){e.realloc(10);for(var i=e.pos+10;t>=1;){if(e.pos>=i)throw new Error("Given varint doesn't fit into 10 bytes");var n=255&t;e.buf[e.pos++]=n|(t>=128?128:0),t/=128}}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var e=f.byteLength(t);this.writeVarint(e),this.realloc(e),this.buf.write(t,this.pos),this.pos+=e},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&function(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,n.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,r,e)},writePackedSVarint:function(t,e){this.writeMessage(t,o,e)},writePackedBoolean:function(t,e){this.writeMessage(t,l,e)},writePackedFloat:function(t,e){this.writeMessage(t,a,e)},writePackedDouble:function(t,e){this.writeMessage(t,s,e)},writePackedFixed32:function(t,e){this.writeMessage(t,u,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,c,e)},writePackedFixed64:function(t,e){this.writeMessage(t,h,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,d,e)},writeBytesField:function(t,e){this.writeTag(t,n.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,n.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,n.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,n.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":24}],26:[function(t,e,i){"use strict";function n(t,e){this.x=t,this.y=e}e.exports=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},{}],27:[function(t,e,i){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(){m&&f&&(m=!1,f.length?p=f.concat(p):v=-1,p.length&&s())}function s(){if(!m){var t=o(a);m=!0;for(var e=p.length;e;){for(f=p,p=[];++v<e;)f&&f[v].run();v=-1,e=p.length}f=null,m=!1,function(t){if(h===clearTimeout)return clearTimeout(t);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}(t)}}function l(t,e){this.fun=t,this.array=e}function u(){}var c,h,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(t){h=r}}();var f,p=[],m=!1,v=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new l(t,e)),1!==p.length||m||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],28:[function(t,e,i){"use strict";function n(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function r(t,e){return t<e?-1:t>e?1:0}e.exports=function t(e,i,o,a,s){for(o=o||0,a=a||e.length-1,s=s||r;a>o;){if(a-o>600){var l=a-o+1,u=i-o+1,c=Math.log(l),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(l-h)/l)*(u-l/2<0?-1:1);t(e,i,Math.max(o,Math.floor(i-u*h/l+d)),Math.min(a,Math.floor(i+(l-u)*h/l+d)),s)}var f=e[i],p=o,m=a;for(n(e,o,i),s(e[a],f)>0&&n(e,o,a);p<m;){for(n(e,p,m),p++,m--;s(e[p],f)<0;)p++;for(;s(e[m],f)>0;)m--}0===s(e[o],f)?n(e,o,m):n(e,++m,a),m<=i&&(o=m+1),i<=m&&(a=m-1)}}},{}],29:[function(t,e,i){"use strict";function n(t){this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function r(t,e,i,n){return{x:t,y:e,zoom:1/0,id:n,numPoints:i}}function o(t,e){var i=t.geometry.coordinates;return r(l(i[0]),u(i[1]),1,e)}function a(t){return{type:"Feature",properties:s(t),geometry:{type:"Point",coordinates:[function(t){return 360*(t-.5)}(t.x),function(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(t.y)]}}}function s(t){var e=t.numPoints;return{cluster:!0,point_count:e,point_count_abbreviated:e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e}}function l(t){return t/360+.5}function u(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function c(t){return t.x}function h(t){return t.y}var d=t("kdbush");e.exports=function(t){return new n(t)},n.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1},load:function(t){var e=this.options.log;e&&console.time("total time");var i="prepare "+t.length+" points";e&&console.time(i),this.points=t;var n=t.map(o);e&&console.timeEnd(i);for(var r=this.options.maxZoom;r>=this.options.minZoom;r--){var a=+Date.now();this.trees[r+1]=d(n,c,h,this.options.nodeSize,Float32Array),n=this._cluster(n,r),e&&console.log("z%d: %d clusters in %dms",r,n.length,+Date.now()-a)}return this.trees[this.options.minZoom]=d(n,c,h,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var i=this.trees[this._limitZoom(e)],n=i.range(l(t[0]),u(t[3]),l(t[2]),u(t[1])),r=[],o=0;o<n.length;o++){var s=i.points[n[o]];r.push(-1!==s.id?this.points[s.id]:a(s))}return r},getTile:function(t,e,i){var n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(i-a)/r,l=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,s,(e+1+a)/r,l),n.points,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,s,1,l),n.points,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,s,a/r,l),n.points,-1,i,r,u),u.features.length?u:null},_addTileFeatures:function(t,e,i,n,r,o){for(var a=0;a<t.length;a++){var l=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(l.x*r-i)),Math.round(this.options.extent*(l.y*r-n))]],tags:-1!==l.id?this.points[l.id].properties:s(l)})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var i=[],n=this.options.radius/(this.options.extent*Math.pow(2,e)),o=0;o<t.length;o++){var a=t[o];if(!(a.zoom<=e)){a.zoom=e;for(var s=this.trees[e+1],l=s.within(a.x,a.y,n),u=!1,c=a.numPoints,h=a.x*c,d=a.y*c,f=0;f<l.length;f++){var p=s.points[l[f]];e<p.zoom&&(u=!0,p.zoom=e,h+=p.x*p.numPoints,d+=p.y*p.numPoints,c+=p.numPoints)}i.push(u?r(h/c,d/c,c,-1):a)}}return i}}},{kdbush:18}],30:[function(t,e,i){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||r,t)for(var i=Math.floor(this.length/2);i>=0;i--)this._down(i)}function r(t,e){return t<e?-1:t>e?1:0}function o(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}e.exports=n,n.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){var t=this.data[0];return this.data[0]=this.data[this.length-1],this.length--,this.data.pop(),this._down(0),t},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare;t>0;){var n=Math.floor((t-1)/2);if(!(i(e[t],e[n])<0))break;o(e,n,t),t=n}},_down:function(t){for(var e=this.data,i=this.compare,n=this.length;;){var r=2*t+1,a=r+1,s=t;if(r<n&&i(e[r],e[s])<0&&(s=r),a<n&&i(e[a],e[s])<0&&(s=a),s===t)return;o(e,s,t),t=s}}}},{}],31:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],32:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],33:[function(t,i,n){(function(e,i){function r(t,e){var i={seen:[],stylize:a};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),h(e)?i.showHidden=e:e&&n._extend(i,e),m(i.showHidden)&&(i.showHidden=!1),m(i.depth)&&(i.depth=2),m(i.colors)&&(i.colors=!1),m(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),s(i,t,i.depth)}function o(t,e){var i=r.styles[e];return i?"["+r.colors[i][0]+"m"+t+"["+r.colors[i][1]+"m":t}function a(t,e){return t}function s(t,e,i){if(t.customInspect&&e&&b(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(i,t);return p(r)||(r=s(t,r,i)),r}var o=function(t,e){if(m(e))return t.stylize("undefined","undefined");if(p(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return f(e)?t.stylize(""+e,"number"):h(e)?t.stylize(""+e,"boolean"):d(e)?t.stylize("null","null"):void 0}(t,e);if(o)return o;var a=Object.keys(e),g=function(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(e)),_(e)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(e);if(0===a.length){if(b(e)){var x=e.name?": "+e.name:"";return t.stylize("[Function"+x+"]","special")}if(v(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(y(e))return t.stylize(Date.prototype.toString.call(e),"date");if(_(e))return l(e)}var w,M="",E=!1,z=["{","}"];(c(e)&&(E=!0,z=["[","]"]),b(e))&&(M=" [Function"+(e.name?": "+e.name:"")+"]");return v(e)&&(M=" "+RegExp.prototype.toString.call(e)),y(e)&&(M=" "+Date.prototype.toUTCString.call(e)),_(e)&&(M=" "+l(e)),0!==a.length||E&&0!=e.length?i<0?v(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),w=E?function(t,e,i,n,r){for(var o=[],a=0,s=e.length;a<s;++a)S(e,String(a))?o.push(u(t,e,i,n,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(u(t,e,i,n,r,!0))}),o}(t,e,i,g,a):a.map(function(n){return u(t,e,i,g,n,E)}),t.seen.pop(),function(t,e,i){return t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}(w,M,z)):z[0]+M+z[1]}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function u(t,e,i,n,r,o){var a,l,u;if((u=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?l=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(l=t.stylize("[Setter]","special")),S(n,r)||(a="["+r+"]"),l||(t.seen.indexOf(u.value)<0?(l=d(i)?s(t,u.value,null):s(t,u.value,i-1)).indexOf("\n")>-1&&(l=o?l.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+l.split("\n").map(function(t){return"   "+t}).join("\n")):l=t.stylize("[Circular]","special")),m(a)){if(o&&r.match(/^\d+$/))return l;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+l}function c(t){return Array.isArray(t)}function h(t){return"boolean"==typeof t}function d(t){return null===t}function f(t){return"number"==typeof t}function p(t){return"string"==typeof t}function m(t){return void 0===t}function v(t){return g(t)&&"[object RegExp]"===x(t)}function g(t){return"object"==typeof t&&null!==t}function y(t){return g(t)&&"[object Date]"===x(t)}function _(t){return g(t)&&("[object Error]"===x(t)||t instanceof Error)}function b(t){return"function"==typeof t}function x(t){return Object.prototype.toString.call(t)}function w(t){return t<10?"0"+t.toString(10):t.toString(10)}function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var M=/%[sdj%]/g;n.format=function(t){if(!p(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(r(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,o=n.length,a=String(t).replace(M,function(t){if("%%"===t)return"%";if(i>=o)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),s=n[i];i<o;s=n[++i])a+=d(s)||!g(s)?" "+s:" "+r(s);return a},n.deprecate=function(t,r){if(m(i.process))return function(){return n.deprecate(t,r).apply(this,arguments)};if(!0===e.noDeprecation)return t;var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),o=!0}return t.apply(this,arguments)}};var E,z={};n.debuglog=function(t){if(m(E)&&(E=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!z[t])if(new RegExp("\\b"+t+"\\b","i").test(E)){var i=e.pid;z[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,i,e)}}else z[t]=function(){};return z[t]},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=c,n.isBoolean=h,n.isNull=d,n.isNullOrUndefined=function(t){return null==t},n.isNumber=f,n.isString=p,n.isSymbol=function(t){return"symbol"==typeof t},n.isUndefined=m,n.isRegExp=v,n.isObject=g,n.isDate=y,n.isError=_,n.isFunction=b,n.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},n.isBuffer=t("./support/isBuffer");var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[w(t.getHours()),w(t.getMinutes()),w(t.getSeconds())].join(":"),[t.getDate(),k[t.getMonth()],e].join(" ")),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!g(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(this,t("_process"),void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":32,_process:27,inherits:31}],34:[function(t,e,i){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":35,"./lib/vectortilefeature.js":36,"./lib/vectortilelayer.js":37}],35:[function(t,e,i){"use strict";function n(t,e,i){if(3===t){var n=new r(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var r=t("./vectortilelayer");e.exports=function(t,e){this.layers=t.readFields(n,{},e)}},{"./vectortilelayer":37}],36:[function(t,e,i){"use strict";function n(t,e,i,n,o){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=o,t.readFields(r,this,e)}function r(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function o(t){for(var e,i,n=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],n+=((i=t[a]).x-e.x)*(e.y+i.y);return n}var a=t("point-geometry");e.exports=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,r=0,o=0,s=0,l=[];t.pos<i;){if(!r){var u=t.readVarint();n=7&u,r=u>>3}if(r--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new a(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},n.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!n){var c=t.readVarint();i=7&c,n=c>>3}if(n--,1===i||2===i)r+=t.readSVarint(),o+=t.readSVarint(),r<a&&(a=r),r>s&&(s=r),o<l&&(l=o),o>u&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,s,u]},n.prototype.toGeoJSON=function(t,e,i){function r(t){for(var e=0;e<t.length;e++){var i=t[e],n=180-360*(i.y+c)/l;t[e]=[360*(i.x+u)/l-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}var a,s,l=this.extent*Math.pow(2,i),u=this.extent*t,c=this.extent*e,h=this.loadGeometry(),d=n.types[this.type];switch(this.type){case 1:var f=[];for(a=0;a<h.length;a++)f[a]=h[a][0];r(h=f);break;case 2:for(a=0;a<h.length;a++)r(h[a]);break;case 3:for(h=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],a=0;a<e;a++){var s=o(t[a]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[a]]):i.push(t[a]))}return i&&r.push(i),r}(h),a=0;a<h.length;a++)for(s=0;s<h[a].length;s++)r(h[a][s])}1===h.length?h=h[0]:d="Multi"+d;var p={type:"Feature",geometry:{type:d,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p}},{"point-geometry":26}],37:[function(t,e,i){"use strict";function n(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(r,this,e),this.length=this._features.length}function r(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}var o=t("./vectortilefeature.js");e.exports=n,n.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":36}],38:[function(t,e,i){function n(t){var e=[];for(var i in t.layers)e.push(r(t.layers[i]));var n=new u;return c.tile.write({layers:e},n),n.finish()}function r(t){for(var e={name:t.name||"",version:t.version||1,extent:t.extent||4096,keys:[],values:[],features:[]},i={},n={},r=0;r<t.length;r++){var o=t.feature(r);o.geometry=s(o.loadGeometry());var a=[];for(var u in o.properties){var c=i[u];void 0===c&&(e.keys.push(u),c=e.keys.length-1,i[u]=c);var h=l(o.properties[u]),d=n[h.key];void 0===d&&(e.values.push(h),d=e.values.length-1,n[h.key]=d),a.push(c),a.push(d)}o.tags=a,e.features.push(o)}return e}function o(t,e){return(e<<3)+(7&t)}function a(t){return t<<1^t>>31}function s(t){for(var e=[],i=0,n=0,r=t.length,s=0;s<r;s++){var l=t[s];e.push(o(1,1));for(var u=0;u<l.length;u++){1===u&&e.push(o(2,l.length-1));var c=l[u].x-i,h=l[u].y-n;e.push(a(c),a(h)),i+=c,n+=h}}return e}function l(t){var e,i=typeof t;return"string"===i?e={string_value:t}:"boolean"===i?e={bool_value:t}:"number"===i?e=t%1!=0?{double_value:t}:t<0?{sint_value:t}:{uint_value:t}:e={string_value:t=JSON.stringify(t)},e.key=i+":"+t,e}var u=t("pbf"),c=t("./vector-tile-pb"),h=t("./lib/geojson_wrapper");e.exports=n,e.exports.fromVectorTileJs=n,e.exports.fromGeojsonVt=function(t){var e={};for(var i in t)e[i]=new h(t[i].features),e[i].name=i;return n({layers:e})},e.exports.GeoJSONWrapper=h},{"./lib/geojson_wrapper":39,"./vector-tile-pb":40,pbf:25}],39:[function(t,e,i){"use strict";function n(t){this.features=t,this.length=t.length}function r(t){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}var o=t("point-geometry"),a=t("vector-tile").VectorTileFeature;e.exports=n,n.prototype.feature=function(t){return new r(this.features[t])},r.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new o(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},r.prototype.toGeoJSON=a.prototype.toGeoJSON},{"point-geometry":26,"vector-tile":34}],40:[function(t,e,i){"use strict";function n(t,e,i){3===t&&e.layers.push(c(i,i.readVarint()+i.pos))}function r(t,e){return t.readFields(o,{},e)}function o(t,e,i){1===t?e.string_value=i.readString():2===t?e.float_value=i.readFloat():3===t?e.double_value=i.readDouble():4===t?e.int_value=i.readVarint():5===t?e.uint_value=i.readVarint():6===t?e.sint_value=i.readSVarint():7===t&&(e.bool_value=i.readBoolean())}function a(t,e){void 0!==t.string_value&&e.writeStringField(1,t.string_value),void 0!==t.float_value&&e.writeFloatField(2,t.float_value),void 0!==t.double_value&&e.writeDoubleField(3,t.double_value),void 0!==t.int_value&&e.writeVarintField(4,t.int_value),void 0!==t.uint_value&&e.writeVarintField(5,t.uint_value),void 0!==t.sint_value&&e.writeSVarintField(6,t.sint_value),void 0!==t.bool_value&&e.writeBooleanField(7,t.bool_value)}function s(t,e){var i=t.readFields(l,{},e);return void 0===i.type&&(i.type="Unknown"),i}function l(t,e,i){1===t?e.id=i.readVarint():2===t?e.tags=i.readPackedVarint():3===t?e.type=i.readVarint():4===t&&(e.geometry=i.readPackedVarint())}function u(t,e){void 0!==t.id&&e.writeVarintField(1,t.id),void 0!==t.tags&&e.writePackedVarint(2,t.tags),void 0!==t.type&&e.writeVarintField(3,t.type),void 0!==t.geometry&&e.writePackedVarint(4,t.geometry)}function c(t,e){return t.readFields(h,{features:[],keys:[],values:[]},e)}function h(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():2===t?e.features.push(s(i,i.readVarint()+i.pos)):3===t?e.keys.push(i.readString()):4===t?e.values.push(r(i,i.readVarint()+i.pos)):5===t&&(e.extent=i.readVarint())}function d(t,e){var i;if(void 0!==t.version&&e.writeVarintField(15,t.version),void 0!==t.name&&e.writeStringField(1,t.name),void 0!==t.features)for(i=0;i<t.features.length;i++)e.writeMessage(2,u,t.features[i]);if(void 0!==t.keys)for(i=0;i<t.keys.length;i++)e.writeStringField(3,t.keys[i]);if(void 0!==t.values)for(i=0;i<t.values.length;i++)e.writeMessage(4,a,t.values[i]);void 0!==t.extent&&e.writeVarintField(5,t.extent)}var f=i.tile={read:function(t,e){return t.readFields(n,{layers:[]},e)},write:function(t,e){var i;if(void 0!==t.layers)for(i=0;i<t.layers.length;i++)e.writeMessage(3,d,t.layers[i])}};f.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},f.value={read:r,write:a},f.feature={read:s,write:u},f.layer={read:c,write:d}},{}],41:[function(t,e,i){var n=arguments[3],r=arguments[4],o=arguments[5],a=JSON.stringify;e.exports=function(t,e){for(var i,s=Object.keys(o),l=0,u=s.length;l<u;l++){var c=s[l],h=o[c].exports;if(h===t||h&&h.default===t){i=c;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var d={};for(l=0,u=s.length;l<u;l++){d[c=s[l]]=c}r[i]=[Function(["require","module","exports"],"("+t+")(self)"),d]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[i]=i,r[f]=[Function(["require"],"var f = require("+a(i)+");(f.default ? f.default : f)(self);"),p];var m={};!function t(e){for(var i in m[e]=!0,r[e][1]){var n=r[e][1][i];m[n]||t(n)}}(f);var v="("+n+")({"+Object.keys(m).map(function(t){return a(t)+":["+r[t][0]+","+a(r[t][1])+"]"}).join(",")+"},{},["+a(f)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([v],{type:"text/javascript"});if(e&&e.bare)return y;var _=g.createObjectURL(y),b=new Worker(_);return b.objectURL=_,b}},{}],42:[function(t,e,i){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},{}],43:[function(t,e,i){e.exports={version:"0.34.0"}},{}],44:[function(t,e,i){"use strict";var n=t("./program_configuration"),r=function(t,e){this.vertexOffset=t,this.primitiveOffset=e,this.vertexLength=0,this.primitiveLength=0},o=function(t,e,i){this.globalProperties={zoom:i};var r=t.layoutVertexArrayType;this.layoutVertexArray=new r;var o=t.elementArrayType;o&&(this.elementArray=new o);var a=t.elementArrayType2;a&&(this.elementArray2=new a),this.layerData={};for(var s=0,l=e;s<l.length;s+=1){var u=l[s],c=n.createDynamic(t.paintAttributes||[],u,i);this.layerData[u.id]={layer:u,programConfiguration:c,paintVertexArray:new c.PaintVertexArray,paintPropertyStatistics:c.createPaintPropertyStatistics()}}this.segments=[],this.segments2=[]};o.prototype.prepareSegment=function(t){var e=this.segments[this.segments.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new r(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(e)),e},o.prototype.prepareSegment2=function(t){var e=this.segments2[this.segments2.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new r(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(e)),e},o.prototype.populatePaintArrays=function(t){var e=this;for(var i in e.layerData){var n=e.layerData[i];0!==n.paintVertexArray.bytesPerElement&&n.programConfiguration.populatePaintArray(n.layer,n.paintVertexArray,n.paintPropertyStatistics,e.layoutVertexArray.length,e.globalProperties,t)}},o.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},o.prototype.serialize=function(t){return{layoutVertexArray:this.layoutVertexArray.serialize(t),elementArray:this.elementArray&&this.elementArray.serialize(t),elementArray2:this.elementArray2&&this.elementArray2.serialize(t),paintVertexArrays:function(t,e){var i={};for(var n in t){var r=t[n].paintVertexArray;if(0!==r.length){var o=r.serialize(e),a=r.constructor.serialize();i[n]={array:o,type:a}}}return i}(this.layerData,t),segments:this.segments,segments2:this.segments2}},o.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,e.exports=o},{"./program_configuration":58}],45:[function(t,e,i){"use strict";var n=t("./array_group"),r=t("./buffer_group"),o=t("../util/util"),a=function(t,e){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,t.arrays?this.buffers=new r(e,t.layers,t.zoom,t.arrays):this.arrays=new n(e,t.layers,t.zoom)};a.prototype.populate=function(t,e){for(var i=this,n=0,r=t;n<r.length;n+=1){var o=r[n];i.layers[0].filter(o)&&(i.addFeature(o),e.featureIndex.insert(o,i.index))}},a.prototype.getPaintPropertyStatistics=function(){return o.mapObject(this.arrays.layerData,function(t){return t.paintPropertyStatistics})},a.prototype.isEmpty=function(){return this.arrays.isEmpty()},a.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),arrays:this.arrays.serialize(t)}},a.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},e.exports=a,a.deserialize=function(t,e){if(e){for(var i={},n=0,r=t;n<r.length;n+=1){var a=r[n],s=a.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==s.length)for(var l=s[0].createBucket(o.extend({layers:s},a)),u=0,c=s;u<c.length;u+=1){i[c[u].id]=l}}return i}}},{"../util/util":212,"./array_group":44,"./buffer_group":52}],46:[function(t,e,i){"use strict";function n(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}var r=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),l=t("../extent"),u={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:a(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]},c=function(t){function e(e){t.call(this,e,u)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,i=0,r=s(t);i<r.length;i+=1)for(var o=0,a=r[i];o<a.length;o+=1){var u=a[o],c=u.x,h=u.y;if(!(c<0||c>=l||h<0||h>=l)){var d=e.prepareSegment(4),f=d.vertexLength;n(e.layoutVertexArray,c,h,-1,-1),n(e.layoutVertexArray,c,h,1,-1),n(e.layoutVertexArray,c,h,1,1),n(e.layoutVertexArray,c,h,-1,1),e.elementArray.emplaceBack(f,f+1,f+2),e.elementArray.emplaceBack(f,f+3,f+2),d.vertexLength+=4,d.primitiveLength+=2}}e.populatePaintArrays(t.properties)},e}(r);c.programInterface=u,e.exports=c},{"../bucket":45,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60}],47:[function(t,e,i){"use strict";var n=t("../bucket"),r=t("../vertex_array_type"),o=t("../element_array_type"),a=t("../load_geometry"),s=t("earcut"),l=t("../../util/classify_rings"),u={layoutVertexArrayType:r([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:o(3),elementArrayType2:o(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]},c=function(t){function e(e){t.call(this,e,u)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,i=0,n=l(a(t),500);i<n.length;i+=1){for(var r=n[i],o=0,u=0,c=r;u<c.length;u+=1){o+=c[u].length}for(var h=e.prepareSegment(o),d=h.vertexLength,f=[],p=[],m=0,v=r;m<v.length;m+=1){var g=v[m];if(0!==g.length){g!==r[0]&&p.push(f.length/2);var y=e.prepareSegment2(g.length),_=y.vertexLength;e.layoutVertexArray.emplaceBack(g[0].x,g[0].y),e.elementArray2.emplaceBack(_+g.length-1,_),f.push(g[0].x),f.push(g[0].y);for(var b=1;b<g.length;b++)e.layoutVertexArray.emplaceBack(g[b].x,g[b].y),e.elementArray2.emplaceBack(_+b-1,_+b),f.push(g[b].x),f.push(g[b].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var x=s(f,p),w=0;w<x.length;w+=3)e.elementArray.emplaceBack(d+x[w],d+x[w+1],d+x[w+2]);h.vertexLength+=o,h.primitiveLength+=x.length/3}e.populatePaintArrays(t.properties)},e}(n);c.programInterface=u,e.exports=c},{"../../util/classify_rings":195,"../bucket":45,"../element_array_type":53,"../load_geometry":56,"../vertex_array_type":60,earcut:5}],48:[function(t,e,i){"use strict";function n(t,e,i,n,r,o,a,s){t.emplaceBack(e,i,2*Math.floor(n*f)+a,r*f*2,o*f*2,Math.round(s))}function r(t,e){return t.x===e.x&&(t.x<0||t.x>u)||t.y===e.y&&(t.y<0||t.y>u)}var o=t("../bucket"),a=t("../vertex_array_type"),s=t("../element_array_type"),l=t("../load_geometry"),u=t("../extent"),c=t("earcut"),h=t("../../util/classify_rings"),d={layoutVertexArrayType:a([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:s(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]},f=Math.pow(2,13),p=function(t){function e(e){t.call(this,e,d)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,i=0,o=h(l(t),500);i<o.length;i+=1){for(var a=o[i],s=0,u=0,d=a;u<d.length;u+=1){s+=d[u].length}for(var f=e.prepareSegment(5*s),p=[],m=[],v=[],g=0,y=a;g<y.length;g+=1){var _=y[g];if(0!==_.length){_!==a[0]&&m.push(p.length/2);for(var b=0,x=0;x<_.length;x++){var w=_[x];if(n(e.layoutVertexArray,w.x,w.y,0,0,1,1,0),v.push(f.vertexLength++),x>=1){var S=_[x-1];if(!r(w,S)){var M=w.sub(S)._perp()._unit();n(e.layoutVertexArray,w.x,w.y,M.x,M.y,0,0,b),n(e.layoutVertexArray,w.x,w.y,M.x,M.y,0,1,b),b+=S.dist(w),n(e.layoutVertexArray,S.x,S.y,M.x,M.y,0,0,b),n(e.layoutVertexArray,S.x,S.y,M.x,M.y,0,1,b);var E=f.vertexLength;e.elementArray.emplaceBack(E,E+1,E+2),e.elementArray.emplaceBack(E+1,E+2,E+3),f.vertexLength+=4,f.primitiveLength+=2}}p.push(w.x),p.push(w.y)}}}for(var z=c(p,m),k=0;k<z.length;k+=3)e.elementArray.emplaceBack(v[z[k]],v[z[k+1]],v[z[k+2]]);f.primitiveLength+=z.length/3}e.populatePaintArrays(t.properties)},e}(o);p.programInterface=d,e.exports=p},{"../../util/classify_rings":195,"../bucket":45,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60,earcut:5}],49:[function(t,e,i){"use strict";function n(t,e,i,n,r,o,a){t.emplaceBack(e.x<<1|n,e.y<<1|r,Math.round(c*i.x)+128,Math.round(c*i.y)+128,1+(0===o?0:o<0?-1:1)|(a*d&63)<<2,a*d>>6)}var r=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),l=t("../extent"),u=t("vector-tile").VectorTileFeature,c=63,h=Math.cos(Math.PI/180*37.5),d=.5,f=Math.pow(2,14)/d,p={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:a()},m=function(t){function e(e){t.call(this,e,p)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.layers[0].layout,i=e["line-join"],n=e["line-cap"],r=e["line-miter-limit"],o=e["line-round-limit"],a=0,l=s(t,15);a<l.length;a+=1){var u=l[a];this.addLine(u,t,i,n,r,o)}},e.prototype.addLine=function(t,e,i,n,r,o){for(var a=this,s=e.properties,c="Polygon"===u.types[e.type],d=t.length;d>=2&&t[d-1].equals(t[d-2]);)d--;if(!(d<(c?3:2))){"bevel"===i&&(r=1.05);var f=l/(512*this.overscaling)*15,p=t[0],m=this.arrays,v=m.prepareSegment(10*d);this.distance=0;var g,y,_,b,x,w,S,M=n,E=c?"butt":n,z=!0;this.e1=this.e2=this.e3=-1,c&&(g=t[d-2],x=p.sub(g)._unit()._perp());for(var k=0;k<d;k++)if(!(_=c&&k===d-1?t[1]:t[k+1])||!t[k].equals(_)){x&&(b=x),g&&(y=g),g=t[k],x=_?_.sub(g)._unit()._perp():b;var T=(b=b||x).add(x);0===T.x&&0===T.y||T._unit();var O=T.x*x.x+T.y*x.y,C=0!==O?1/O:1/0,P=O<h&&y&&_;if(P&&k>0){var A=g.dist(y);if(A>2*f){var I=g.sub(g.sub(y)._mult(f/A)._round());a.distance+=I.dist(y),a.addCurrentVertex(I,a.distance,b.mult(1),0,0,!1,v),y=I}}var L=y&&_,D=L?i:_?M:E;if(L&&"round"===D&&(C<o?D="miter":C<=2&&(D="fakeround")),"miter"===D&&C>r&&(D="bevel"),"bevel"===D&&(C>2&&(D="flipbevel"),C<r&&(D="miter")),y&&(a.distance+=g.dist(y)),"miter"===D)T._mult(C),a.addCurrentVertex(g,a.distance,T,0,0,!1,v);else if("flipbevel"===D){if(C>100)T=x.clone().mult(-1);else{var R=b.x*x.y-b.y*x.x>0?-1:1,j=C*b.add(x).mag()/b.sub(x).mag();T._perp()._mult(j*R)}a.addCurrentVertex(g,a.distance,T,0,0,!1,v),a.addCurrentVertex(g,a.distance,T.mult(-1),0,0,!1,v)}else if("bevel"===D||"fakeround"===D){var F=b.x*x.y-b.y*x.x>0,B=-Math.sqrt(C*C-1);if(F?(S=0,w=B):(w=0,S=B),z||a.addCurrentVertex(g,a.distance,b,w,S,!1,v),"fakeround"===D){for(var N=Math.floor(8*(.5-(O-.5))),q=void 0,V=0;V<N;V++)q=x.mult((V+1)/(N+1))._add(b)._unit(),a.addPieSliceVertex(g,a.distance,q,F,v);a.addPieSliceVertex(g,a.distance,T,F,v);for(var H=N-1;H>=0;H--)q=b.mult((H+1)/(N+1))._add(x)._unit(),a.addPieSliceVertex(g,a.distance,q,F,v)}_&&a.addCurrentVertex(g,a.distance,x,-w,-S,!1,v)}else"butt"===D?(z||a.addCurrentVertex(g,a.distance,b,0,0,!1,v),_&&a.addCurrentVertex(g,a.distance,x,0,0,!1,v)):"square"===D?(z||(a.addCurrentVertex(g,a.distance,b,1,1,!1,v),a.e1=a.e2=-1),_&&a.addCurrentVertex(g,a.distance,x,-1,-1,!1,v)):"round"===D&&(z||(a.addCurrentVertex(g,a.distance,b,0,0,!1,v),a.addCurrentVertex(g,a.distance,b,1,1,!0,v),a.e1=a.e2=-1),_&&(a.addCurrentVertex(g,a.distance,x,-1,-1,!0,v),a.addCurrentVertex(g,a.distance,x,0,0,!1,v)));if(P&&k<d-1){var U=g.dist(_);if(U>2*f){var W=g.add(_.sub(g)._mult(f/U)._round());a.distance+=W.dist(g),a.addCurrentVertex(W,a.distance,x.mult(1),0,0,!1,v),g=W}}z=!1}m.populatePaintArrays(s)}},e.prototype.addCurrentVertex=function(t,e,i,r,o,a,s){var l,u=a?1:0,c=this.arrays,h=c.layoutVertexArray,d=c.elementArray;l=i.clone(),r&&l._sub(i.perp()._mult(r)),n(h,t,l,u,0,r,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,l=i.mult(-1),o&&l._sub(i.perp()._mult(o)),n(h,t,l,u,1,-o,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>f/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,o,a,s))},e.prototype.addPieSliceVertex=function(t,e,i,r,o){var a=r?1:0;i=i.mult(r?-1:1);var s=this.arrays,l=s.layoutVertexArray,u=s.elementArray;n(l,t,i,0,a,0,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3},e}(r);m.programInterface=p,e.exports=m},{"../bucket":45,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60,"vector-tile":34}],50:[function(t,e,i){"use strict";function n(t,e,i,n,r,o,a,s,l,u,c){t.emplaceBack(e,i,Math.round(64*n),Math.round(64*r),o/4,a/4,10*(u||0),c,10*(s||0),10*Math.min(l||25,25))}function r(t,e,i,n,r){return t.emplaceBack(e.x,e.y,Math.round(i.x),Math.round(i.y),10*n,10*r)}var o=t("point-geometry"),a=t("../array_group"),s=t("../buffer_group"),l=t("../vertex_array_type"),u=t("../element_array_type"),c=t("../extent"),h=t("../../symbol/anchor"),d=t("../../symbol/get_anchors"),f=t("../../util/token"),p=t("../../symbol/quads"),m=t("../../symbol/shaping"),v=t("../../symbol/resolve_text"),g=t("../../symbol/mergelines"),y=t("../../symbol/clip_line"),_=t("../../util/util"),b=t("../../util/script_detection"),x=t("../load_geometry"),w=t("../../symbol/collision_feature"),S=t("../../util/find_pole_of_inaccessibility"),M=t("../../util/classify_rings"),E=t("vector-tile").VectorTileFeature,z=t("../../source/rtl_text_plugin"),k=m.shapeText,T=m.shapeIcon,O=m.WritingMode,C=p.getGlyphQuads,P=p.getIconQuads,A=u(),I=l([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),L={glyph:{layoutVertexArrayType:I,elementArrayType:A,paintAttributes:[{name:"a_fill_color",property:"text-color",type:"Uint8"},{name:"a_halo_color",property:"text-halo-color",type:"Uint8"},{name:"a_halo_width",property:"text-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"text-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"text-opacity",type:"Uint8",multiplier:255}]},icon:{layoutVertexArrayType:I,elementArrayType:A,paintAttributes:[{name:"a_fill_color",property:"icon-color",type:"Uint8"},{name:"a_halo_color",property:"icon-halo-color",type:"Uint8"},{name:"a_halo_width",property:"icon-halo-width",type:"Uint16",multiplier:10},{name:"a_halo_blur",property:"icon-halo-blur",type:"Uint16",multiplier:10},{name:"a_opacity",property:"icon-opacity",type:"Uint8",multiplier:255}]},collisionBox:{layoutVertexArrayType:l([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:u(2)}},D=function(t){if(this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,this.sdfIcons=t.sdfIcons,this.iconsNeedLinear=t.iconsNeedLinear,this.adjustedTextSize=t.adjustedTextSize,this.adjustedIconSize=t.adjustedIconSize,this.fontstack=t.fontstack,t.arrays)for(var e in this.buffers={},t.arrays)t.arrays[e]&&(this.buffers[e]=new s(L[e],t.layers,t.zoom,t.arrays[e]))};D.prototype.populate=function(t,e){var i=this.layers[0],n=i.layout,r=n["text-font"],o=n["icon-image"],a=r&&(!i.isLayoutValueFeatureConstant("text-field")||n["text-field"]),s=o;if(this.features=[],a||s){for(var l=e.iconDependencies,u=e.glyphDependencies,c=u[r]=u[r]||{},h=0;h<t.length;h++){var d=t[h];if(i.filter(d)){var p=void 0;a&&(p=v(i,{zoom:this.zoom},d.properties),z.applyArabicShaping&&(p=z.applyArabicShaping(p)));var m=void 0;if(s&&(m=f(d.properties,o)),(p||m)&&(this.features.push({text:p,icon:m,index:h,sourceLayerIndex:d.sourceLayerIndex,geometry:x(d),properties:d.properties,type:E.types[d.type]}),m&&(l[m]=!0),p))for(var y=0;y<p.length;y++)c[p.charCodeAt(y)]=!0}}"line"===n["symbol-placement"]&&(this.features=g(this.features))}},D.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},D.prototype.getPaintPropertyStatistics=function(){for(var t=this,e={},i=0,n=t.layers;i<n.length;i+=1){var r=n[i];e[r.id]=_.extend({},t.arrays.icon.layerData[r.id].paintPropertyStatistics,t.arrays.glyph.layerData[r.id].paintPropertyStatistics)}return e},D.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:_.mapObject(this.arrays,function(e){return e.isEmpty()?null:e.serialize(t)})}},D.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},D.prototype.createArrays=function(){var t=this;this.arrays=_.mapObject(L,function(e){return new a(e,t.layers,t.zoom)})},D.prototype.prepare=function(t,e){var i=this;this.symbolInstances=[],this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var n=512*this.overscaling;this.tilePixelRatio=c/n,this.compareText={},this.iconsNeedLinear=!1;var r=this.layers[0].layout,o=.5,a=.5;switch(r["text-anchor"]){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(r["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}for(var s="right"===r["text-justify"]?1:"left"===r["text-justify"]?0:.5,l=24,u=r["text-line-height"]*l,h="line"!==r["symbol-placement"]?r["text-max-width"]*l:0,d=r["text-letter-spacing"]*l,f=[r["text-offset"][0]*l,r["text-offset"][1]*l],p=this.fontstack=r["text-font"].join(","),m="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],v=0,g=i.features;v<g.length;v+=1){var y=g[v],x=void 0;if(y.text){var w=b.allowsVerticalWritingMode(y.text);(x={})[O.horizontal]=k(y.text,t[p],h,u,o,a,s,d,f,l,O.horizontal),x[O.vertical]=w&&m&&k(y.text,t[p],h,u,o,a,s,d,f,l,O.vertical)}else x={};var S=void 0;if(y.icon){var M=e[y.icon],E=i.layers[0].getLayoutValue("icon-offset",{zoom:i.zoom},y.properties);S=T(M,E),M&&(void 0===i.sdfIcons?i.sdfIcons=M.sdf:i.sdfIcons!==M.sdf&&_.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==M.pixelRatio?i.iconsNeedLinear=!0:0===r["icon-rotate"]&&i.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(i.iconsNeedLinear=!0))}(x[O.horizontal]||S)&&i.addFeature(y,x,S)}},D.prototype.addFeature=function(t,e,i){var n=this,r=this.layers[0].layout,o=this.adjustedTextSize/24,a=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,s=this.tilePixelRatio*o,l=this.tilePixelRatio*a/24,u=this.tilePixelRatio*this.adjustedIconSize,f=this.tilePixelRatio*r["symbol-spacing"],p=r["symbol-avoid-edges"],m=r["text-padding"]*this.tilePixelRatio,v=r["icon-padding"]*this.tilePixelRatio,g=r["text-max-angle"]/180*Math.PI,_="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],b="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"],x=r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"],w=f/2,E=function(r,o){var a=!(o.x<0||o.x>c||o.y<0||o.y>c);if(!p||a){var l=a||x;n.addSymbolInstance(o,r,e,i,n.layers[0],l,n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,s,m,_,u,v,b,{zoom:n.zoom},t.properties)}};if("line"===r["symbol-placement"])for(var z=0,k=y(t.geometry,0,0,c,c);z<k.length;z+=1)for(var T=k[z],C=0,P=d(T,f,g,e[O.vertical]||e[O.horizontal],i,24,l,n.overscaling,c);C<P.length;C+=1){var A=P[C],I=e[O.horizontal];I&&n.anchorIsTooClose(I.text,w,A)||E(T,A)}else if("Polygon"===t.type)for(var L=0,D=M(t.geometry,0);L<D.length;L+=1){var R=D[L],j=S(R,16);E(R[0],new h(j.x,j.y,0))}else if("LineString"===t.type)for(var F=0,B=t.geometry;F<B.length;F+=1){var N=B[F];E(N,new h(N[0].x,N[0].y,0))}else if("Point"===t.type)for(var q=0,V=t.geometry;q<V.length;q+=1)for(var H=0,U=V[q];H<U.length;H+=1){var W=U[H];E([W],new h(W.x,W.y,0))}},D.prototype.anchorIsTooClose=function(t,e,i){var n=this.compareText;if(t in n){for(var r=n[t],o=r.length-1;o>=0;o--)if(i.dist(r[o])<e)return!0}else n[t]=[];return n[t].push(i),!1},D.prototype.place=function(t,e){var i=this;this.createArrays();var n=this.layers[0].layout,r=t.maxScale,o="map"===n["text-rotation-alignment"]&&"line"===n["symbol-placement"],a="map"===n["icon-rotation-alignment"]&&"line"===n["symbol-placement"];if(n["text-allow-overlap"]||n["icon-allow-overlap"]||n["text-ignore-placement"]||n["icon-ignore-placement"]){var s=t.angle,l=Math.sin(s),u=Math.cos(s);this.symbolInstances.sort(function(t,e){return(l*t.anchor.x+u*t.anchor.y|0)-(l*e.anchor.x+u*e.anchor.y|0)||e.featureIndex-t.featureIndex})}for(var c=0,h=i.symbolInstances;c<h.length;c+=1){var d=h[c],f={boxStartIndex:d.textBoxStartIndex,boxEndIndex:d.textBoxEndIndex},p={boxStartIndex:d.iconBoxStartIndex,boxEndIndex:d.iconBoxEndIndex},m=!(d.textBoxStartIndex===d.textBoxEndIndex),v=!(d.iconBoxStartIndex===d.iconBoxEndIndex),g=n["text-optional"]||!m,y=n["icon-optional"]||!v,_=m?t.placeCollisionFeature(f,n["text-allow-overlap"],n["symbol-avoid-edges"]):t.minScale,b=v?t.placeCollisionFeature(p,n["icon-allow-overlap"],n["symbol-avoid-edges"]):t.minScale;g||y?!y&&_?_=Math.max(b,_):!g&&b&&(b=Math.max(b,_)):b=_=Math.max(b,_),m&&(t.insertCollisionFeature(f,_,n["text-ignore-placement"]),_<=r&&i.addSymbols(i.arrays.glyph,d.glyphQuads,_,n["text-keep-upright"],o,t.angle,d.featureProperties,d.writingModes)),v&&(t.insertCollisionFeature(p,b,n["icon-ignore-placement"]),b<=r&&i.addSymbols(i.arrays.icon,d.iconQuads,b,n["icon-keep-upright"],a,t.angle,d.featureProperties))}e&&this.addToDebugBuffers(t)},D.prototype.addSymbols=function(t,e,i,r,o,a,s,l){for(var u=t.elementArray,c=t.layoutVertexArray,h=this.zoom,d=Math.max(Math.log(i)/Math.LN2+h,0),f=0,p=e;f<p.length;f+=1){var m=p[f],v=(m.anchorAngle+a+Math.PI)%(2*Math.PI);if(l&O.vertical){if(o&&m.writingMode===O.vertical){if(r&&o&&v<=5*Math.PI/4||v>7*Math.PI/4)continue}else if(r&&o&&v<=3*Math.PI/4||v>5*Math.PI/4)continue}else if(r&&o&&(v<=Math.PI/2||v>3*Math.PI/2))continue;var g=m.tl,y=m.tr,_=m.bl,b=m.br,x=m.tex,w=m.anchorPoint,S=Math.max(h+Math.log(m.minScale)/Math.LN2,d),M=Math.min(h+Math.log(m.maxScale)/Math.LN2,25);if(!(M<=S)){S===d&&(S=0);var E=Math.round(m.glyphAngle/(2*Math.PI)*256),z=t.prepareSegment(4),k=z.vertexLength;n(c,w.x,w.y,g.x,g.y,x.x,x.y,S,M,d,E),n(c,w.x,w.y,y.x,y.y,x.x+x.w,x.y,S,M,d,E),n(c,w.x,w.y,_.x,_.y,x.x,x.y+x.h,S,M,d,E),n(c,w.x,w.y,b.x,b.y,x.x+x.w,x.y+x.h,S,M,d,E),u.emplaceBack(k,k+1,k+2),u.emplaceBack(k+1,k+2,k+3),z.vertexLength+=4,z.primitiveLength+=2}}t.populatePaintArrays(s)},D.prototype.addToDebugBuffers=function(t){for(var e=this,i=this.arrays.collisionBox,n=i.layoutVertexArray,a=i.elementArray,s=-t.angle,l=t.yStretch,u=0,c=e.symbolInstances;u<c.length;u+=1){var h=c[u];h.textCollisionFeature={boxStartIndex:h.textBoxStartIndex,boxEndIndex:h.textBoxEndIndex},h.iconCollisionFeature={boxStartIndex:h.iconBoxStartIndex,boxEndIndex:h.iconBoxEndIndex};for(var d=0;d<2;d++){var f=h[0===d?"textCollisionFeature":"iconCollisionFeature"];if(f)for(var p=f.boxStartIndex;p<f.boxEndIndex;p++){var m=e.collisionBoxArray.get(p),v=m.anchorPoint,g=new o(m.x1,m.y1*l)._rotate(s),y=new o(m.x2,m.y1*l)._rotate(s),_=new o(m.x1,m.y2*l)._rotate(s),b=new o(m.x2,m.y2*l)._rotate(s),x=Math.max(0,Math.min(25,e.zoom+Math.log(m.maxScale)/Math.LN2)),w=Math.max(0,Math.min(25,e.zoom+Math.log(m.placementScale)/Math.LN2)),S=i.prepareSegment(4),M=S.vertexLength;r(n,v,g,x,w),r(n,v,y,x,w),r(n,v,b,x,w),r(n,v,_,x,w),a.emplaceBack(M,M+1),a.emplaceBack(M+1,M+2),a.emplaceBack(M+2,M+3),a.emplaceBack(M+3,M),S.vertexLength+=4,S.primitiveLength+=4}}}},D.prototype.addSymbolInstance=function(t,e,i,n,r,o,a,s,l,u,c,h,d,f,p,m,v,g){var y,b,x=[],S=[];for(var M in i){var E=parseInt(M,10);i[E]&&(S=S.concat(o?C(t,i[E],c,e,r,d):[]),y=new w(a,e,t,s,l,u,i[E],c,h,d,!1))}var z=y?y.boxStartIndex:this.collisionBoxArray.length,k=y?y.boxEndIndex:this.collisionBoxArray.length;n&&(x=o?P(t,n,f,e,r,m,i[O.horizontal],v,g):[],b=new w(a,e,t,s,l,u,n,f,p,m,!0));var T=b?b.boxStartIndex:this.collisionBoxArray.length,A=b?b.boxEndIndex:this.collisionBoxArray.length;k>D.MAX_INSTANCES&&_.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),A>D.MAX_INSTANCES&&_.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var I=(i[O.vertical]?O.vertical:0)|(i[O.horizontal]?O.horizontal:0);this.symbolInstances.push({textBoxStartIndex:z,textBoxEndIndex:k,iconBoxStartIndex:T,iconBoxEndIndex:A,glyphQuads:S,iconQuads:x,anchor:t,featureIndex:s,featureProperties:g,writingModes:I})},D.programInterfaces=L,D.MAX_INSTANCES=65535,e.exports=D},{"../../source/rtl_text_plugin":90,"../../symbol/anchor":157,"../../symbol/clip_line":159,"../../symbol/collision_feature":161,"../../symbol/get_anchors":163,"../../symbol/mergelines":166,"../../symbol/quads":167,"../../symbol/resolve_text":168,"../../symbol/shaping":169,"../../util/classify_rings":195,"../../util/find_pole_of_inaccessibility":201,"../../util/script_detection":209,"../../util/token":211,"../../util/util":212,"../array_group":44,"../buffer_group":52,"../element_array_type":53,"../extent":54,"../load_geometry":56,"../vertex_array_type":60,"point-geometry":26,"vector-tile":34}],51:[function(t,e,i){"use strict";var n={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"},r=function(t,e,i){this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.attributes=e.members,this.itemSize=e.bytesPerElement,this.type=i,this.arrayType=e};r.fromStructArray=function(t,e){return new r(t.serialize(),t.constructor.serialize(),e)},r.prototype.bind=function(t){var e=t[this.type];this.buffer?t.bindBuffer(e,this.buffer):(this.gl=t,this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.arrayBuffer,t.STATIC_DRAW),this.arrayBuffer=null)},r.prototype.setVertexAttribPointers=function(t,e,i){for(var r=this,o=0;o<this.attributes.length;o++){var a=r.attributes[o],s=e[a.name];void 0!==s&&t.vertexAttribPointer(s,a.components,t[n[a.type]],!1,r.arrayType.bytesPerElement,a.offset+(r.arrayType.bytesPerElement*i||0))}},r.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},r.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},e.exports=r},{}],52:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("./buffer"),o=t("./program_configuration"),a=t("../render/vertex_array_object"),s=function(t,e,i,s){var l=this;this.layoutVertexBuffer=new r(s.layoutVertexArray,t.layoutVertexArrayType.serialize(),r.BufferType.VERTEX),s.elementArray&&(this.elementBuffer=new r(s.elementArray,t.elementArrayType.serialize(),r.BufferType.ELEMENT)),s.elementArray2&&(this.elementBuffer2=new r(s.elementArray2,t.elementArrayType2.serialize(),r.BufferType.ELEMENT)),this.layerData={};for(var u=0,c=e;u<c.length;u+=1){var h=c[u],d=s.paintVertexArrays&&s.paintVertexArrays[h.id],f=o.createDynamic(t.paintAttributes||[],h,i),p=d?new r(d.array,d.type,r.BufferType.VERTEX):null;l.layerData[h.id]={programConfiguration:f,paintVertexBuffer:p}}this.segments=s.segments,this.segments2=s.segments2;for(var m=0,v=[l.segments,l.segments2];m<v.length;m+=1)for(var g=0,y=v[m]||[];g<y.length;g+=1){y[g].vaos=n.mapObject(l.layerData,function(){return new a})}};s.prototype.destroy=function(){var t=this;for(var e in this.layoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy(),t.layerData){var i=t.layerData[e].paintVertexBuffer;i&&i.destroy()}for(var n=0,r=[t.segments,t.segments2];n<r.length;n+=1)for(var o=0,a=r[n]||[];o<a.length;o+=1){var s=a[o];for(var l in s.vaos)s.vaos[l].destroy()}},e.exports=s},{"../render/vertex_array_object":80,"../util/util":212,"./buffer":51,"./program_configuration":58}],53:[function(t,e,i){"use strict";var n=t("../util/struct_array");e.exports=function(t){return n({members:[{type:"Uint16",name:"vertices",components:t||3}]})}},{"../util/struct_array":210}],54:[function(t,e,i){"use strict";e.exports=8192},{}],55:[function(t,e,i){"use strict";function n(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function r(t,e){return e-t}function o(t,e){return e>0?e+2*t:t}function a(t,e,i,n,r){if(!e[0]&&!e[1])return t;e=l.convert(e),"viewport"===i&&e._rotate(-n);for(var o=[],a=0;a<t.length;a++){for(var s=t[a],u=[],c=0;c<s.length;c++)u.push(s[c].sub(e._mult(r)));o.push(u)}return o}function s(t,e){for(var i=[],n=new l(0,0),r=0;r<t.length;r++){for(var o=t[r],a=[],s=0;s<o.length;s++){var u=o[s-1],c=o[s],h=o[s+1],d=0===s?n:c.sub(u)._unit()._perp(),f=s===o.length-1?n:h.sub(c)._unit()._perp(),p=d._add(f)._unit(),m=p.x*f.x+p.y*f.y;p._mult(1/m),a.push(p._mult(e)._add(c))}i.push(a)}return i}var l=t("point-geometry"),u=t("./load_geometry"),c=t("./extent"),h=t("../style-spec/feature_filter"),d=t("../util/struct_array"),f=t("grid-index"),p=t("../util/dictionary_coder"),m=t("vector-tile"),v=t("pbf"),g=t("../util/vectortile_to_geojson"),y=t("../util/util").arraysIntersect,_=t("../util/intersection_tests"),b=_.multiPolygonIntersectsBufferedMultiPoint,x=_.multiPolygonIntersectsMultiPolygon,w=_.multiPolygonIntersectsBufferedMultiLine,S=d({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),M=function(t,e,i){if(t.grid){var n=t,r=e;t=n.coord,e=n.overscaling,this.grid=new f(n.grid),this.featureIndexArray=new S(n.featureIndexArray),this.rawTileData=r,this.bucketLayerIDs=n.bucketLayerIDs,this.paintPropertyStatistics=n.paintPropertyStatistics}else this.grid=new f(c,16,0),this.featureIndexArray=new S;this.coord=t,this.overscaling=e,this.x=t.x,this.y=t.y,this.z=t.z-Math.log(e)/Math.LN2,this.setCollisionTile(i)};M.prototype.insert=function(t,e){var i=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(t.index,t.sourceLayerIndex,e);for(var n=u(t),r=0;r<n.length;r++){for(var o=n[r],a=[1/0,1/0,-1/0,-1/0],s=0;s<o.length;s++){var l=o[s];a[0]=Math.min(a[0],l.x),a[1]=Math.min(a[1],l.y),a[2]=Math.max(a[2],l.x),a[3]=Math.max(a[3],l.y)}this.grid.insert(i,a[0],a[1],a[2],a[3])}},M.prototype.setCollisionTile=function(t){this.collisionTile=t},M.prototype.serialize=function(t){var e=this.grid.toArrayBuffer();return t&&t.push(e),{coord:this.coord,overscaling:this.overscaling,grid:e,featureIndexArray:this.featureIndexArray.serialize(t),bucketLayerIDs:this.bucketLayerIDs,paintPropertyStatistics:this.paintPropertyStatistics}},M.prototype.query=function(t,e){var i=this;this.vtLayers||(this.vtLayers=new m.VectorTile(new v(this.rawTileData)).layers,this.sourceLayerCoder=new p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var a={},s=t.params||{},u=c/t.tileSize/t.scale,d=h(s.filter),f=0;for(var g in e)if(i.hasLayer(g)){var y=e[g],_=0;if("line"===y.type){var b=o(i.getPaintValue("line-width",y),i.getPaintValue("line-gap-width",y)),x=i.getPaintValue("line-offset",y),w=i.getPaintValue("line-translate",y);_=b/2+Math.abs(x)+n(w)}else"fill"===y.type?_=n(i.getPaintValue("fill-translate",y)):"fill-extrusion"===y.type?_=n(i.getPaintValue("fill-extrusion-translate",y)):"circle"===y.type&&(_=i.getPaintValue("circle-radius",y)+n(i.getPaintValue("circle-translate",y)));f=Math.max(f,_*u)}for(var S=t.queryGeometry.map(function(t){return t.map(function(t){return new l(t.x,t.y)})}),M=1/0,E=1/0,z=-1/0,k=-1/0,T=0;T<S.length;T++)for(var O=S[T],C=0;C<O.length;C++){var P=O[C];M=Math.min(M,P.x),E=Math.min(E,P.y),z=Math.max(z,P.x),k=Math.max(k,P.y)}var A=this.grid.query(M-f,E-f,z+f,k+f);A.sort(r),this.filterMatching(a,A,this.featureIndexArray,S,d,s.layers,e,t.bearing,u);var I=this.collisionTile.queryRenderedSymbols(S,t.scale);return I.sort(),this.filterMatching(a,I,this.collisionTile.collisionBoxArray,S,d,s.layers,e,t.bearing,u),a},M.prototype.filterMatching=function(t,e,i,n,r,l,c,h,d){for(var f,p=this,m=0;m<e.length;m++){var v=e[m];if(v!==f){f=v;var _=i.get(v),S=p.bucketLayerIDs[_.bucketIndex];if(!l||y(l,S)){var M=p.sourceLayerCoder.decode(_.sourceLayerIndex),E=p.vtLayers[M].feature(_.featureIndex);if(r(E))for(var z=null,k=0;k<S.length;k++){var T=S[k];if(!(l&&l.indexOf(T)<0)){var O=c[T];if(O){var C=void 0;if("symbol"!==O.type)if(z||(z=u(E)),"line"===O.type){C=a(n,p.getPaintValue("line-translate",O,E),p.getPaintValue("line-translate-anchor",O,E),h,d);var P=d/2*o(p.getPaintValue("line-width",O,E),p.getPaintValue("line-gap-width",O,E)),A=p.getPaintValue("line-offset",O,E);if(A&&(z=s(z,A*d)),!w(C,z,P))continue}else if("fill"===O.type||"fill-extrusion"===O.type){var I=O.type;if(C=a(n,p.getPaintValue(I+"-translate",O,E),p.getPaintValue(I+"-translate-anchor",O,E),h,d),!x(C,z))continue}else if("circle"===O.type){C=a(n,p.getPaintValue("circle-translate",O,E),p.getPaintValue("circle-translate-anchor",O,E),h,d);var L=p.getPaintValue("circle-radius",O,E)*d;if(!b(C,z,L))continue}var D=new g(E,p.z,p.x,p.y);D.layer=O.serialize();var R=t[T];void 0===R&&(R=t[T]=[]),R.push(D)}}}}}}},M.prototype.hasLayer=function(t){for(var e in this.bucketLayerIDs)for(var i=0,n=this.bucketLayerIDs[e];i<n.length;i+=1){if(t===n[i])return!0}return!1},M.prototype.getPaintValue=function(t,e,i){if(e.isPaintValueFeatureConstant(t)||i){var n=i?i.properties:{};return e.getPaintValue(t,{zoom:this.z},n)}return this.paintPropertyStatistics[e.id][t].max},e.exports=M},{"../style-spec/feature_filter":103,"../util/dictionary_coder":197,"../util/intersection_tests":205,"../util/struct_array":210,"../util/util":212,"../util/vectortile_to_geojson":213,"./extent":54,"./load_geometry":56,"grid-index":16,pbf:25,"point-geometry":26,"vector-tile":34}],56:[function(t,e,i){"use strict";function n(t){return{min:-1*Math.pow(2,t-1),max:Math.pow(2,t-1)-1}}var r=t("../util/util"),o=t("./extent"),a={15:n(15),16:n(16)};e.exports=function(t,e){for(var i=a[e||16],n=o/t.extent,s=t.loadGeometry(),l=0;l<s.length;l++)for(var u=s[l],c=0;c<u.length;c++){var h=u[c];h.x=Math.round(h.x*n),h.y=Math.round(h.y*n),(h.x<i.min||h.x>i.max||h.y<i.min||h.y>i.max)&&r.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}},{"../util/util":212,"./extent":54}],57:[function(t,e,i){"use strict";var n=t("../util/struct_array")({members:[{name:"a_pos",type:"Int16",components:2}]});e.exports=n},{"../util/struct_array":210}],58:[function(t,e,i){"use strict";function n(t,e,i,n){if(!t.zoomStops)return e.getPaintValue(t.property,i,n);var r=t.zoomStops.map(function(r){return e.getPaintValue(t.property,a.extend({},i,{zoom:r}),n)});return 1===r.length?r[0]:r}function r(t,e){var i=t.name;i||(i=t.property.replace(e.type+"-","").replace(/-/g,"_"));var n="color"===e._paintSpecifications[t.property].type;return a.extend({name:"a_"+i,components:n?4:1,multiplier:n?255:1,dimensions:n?4:1},t)}var o=t("./vertex_array_type"),a=t("../util/util"),s=function(){this.attributes=[],this.uniforms=[],this.interpolationUniforms=[],this.pragmas={vertex:{},fragment:{}},this.cacheKey=""};s.createDynamic=function(t,e,i){for(var n=new s,a=0,l=t;a<l.length;a+=1){var u=r(l[a],e),c=u.name.slice(2);e.isPaintValueFeatureConstant(u.property)?n.addZoomAttribute(c,u):e.isPaintValueZoomConstant(u.property)?n.addPropertyAttribute(c,u):n.addZoomAndPropertyAttribute(c,u,e,i)}return n.PaintVertexArray=o(n.attributes),n},s.createStatic=function(t){for(var e=new s,i=0,n=t;i<n.length;i+=1){var r=n[i];e.addUniform(r,"u_"+r)}return e},s.prototype.addUniform=function(t,e){var i=this.getPragmas(t);i.define.push("uniform {precision} {type} "+e+";"),i.initialize.push("{precision} {type} "+t+" = "+e+";"),this.cacheKey+="/u_"+t},s.prototype.addZoomAttribute=function(t,e){this.uniforms.push(e),this.addUniform(t,e.name)},s.prototype.addPropertyAttribute=function(t,e){var i=this.getPragmas(t);this.attributes.push(e),i.define.push("varying {precision} {type} "+t+";"),i.vertex.define.push("attribute {precision} {type} "+e.name+";"),i.vertex.initialize.push(t+" = "+e.name+" / "+e.multiplier+".0;"),this.cacheKey+="/a_"+t},s.prototype.addZoomAndPropertyAttribute=function(t,e,i,n){var r=this.getPragmas(t);r.define.push("varying {precision} {type} "+t+";");for(var o=0,s=i.getPaintValueStopZoomLevels(e.property);o<s.length&&s[o]<n;)o++;var l=Math.max(0,Math.min(s.length-4,o-2)),u="u_"+t+"_t";r.vertex.define.push("uniform lowp float "+u+";"),this.interpolationUniforms.push({name:u,property:e.property,stopOffset:l});for(var c=[],h=0;h<4;h++)c.push(s[Math.min(l+h,s.length-1)]);var d=[];if(1===e.components)this.attributes.push(a.extend({},e,{components:4,zoomStops:c})),r.vertex.define.push("attribute {precision} vec4 "+e.name+";"),d.push(e.name);else for(var f=0;f<4;f++){var p=e.name+f;d.push(p),this.attributes.push(a.extend({},e,{name:p,zoomStops:[c[f]]})),r.vertex.define.push("attribute {precision} {type} "+p+";")}r.vertex.initialize.push(t+" = evaluate_zoom_function_"+e.components+"(            "+d.join(", ")+", "+u+") / "+e.multiplier+".0;"),this.cacheKey+="/z_"+t},s.prototype.getPragmas=function(t){return this.pragmas[t]||(this.pragmas[t]={define:[],initialize:[]},this.pragmas[t].fragment={define:[],initialize:[]},this.pragmas[t].vertex={define:[],initialize:[]}),this.pragmas[t]},s.prototype.applyPragmas=function(t,e){var i=this;return t.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(t,n,r,o,a){return i.pragmas[a][n].concat(i.pragmas[a][e][n]).join("\n").replace(/{type}/g,o).replace(/{precision}/g,r)})},s.prototype.createPaintPropertyStatistics=function(){for(var t={},e=0,i=this.attributes;e<i.length;e+=1){var n=i[e];1===n.dimensions&&(t[n.property]={max:-1/0})}return t},s.prototype.populatePaintArray=function(t,e,i,r,o,a){var s=e.length;e.resize(r);for(var l=0,u=this.attributes;l<u.length;l+=1)for(var c=u[l],h=n(c,t,o,a),d=s;d<r;d++){var f=e.get(d);if(4===c.components)for(var p=0;p<4;p++)f[c.name+p]=h[p]*c.multiplier;else f[c.name]=h*c.multiplier;if(1===c.dimensions){var m=i[c.property];m.max=Math.max(m.max,1===c.components?h:Math.max.apply(Math,h))}}},s.prototype.setUniforms=function(t,e,i,n){for(var r=0,o=this.uniforms;r<o.length;r+=1){var a=o[r],s=i.getPaintValue(a.property,n);4===a.components?t.uniform4fv(e[a.name],s):t.uniform1f(e[a.name],s)}for(var l=0,u=this.interpolationUniforms;l<u.length;l+=1){var c=u[l],h=i.getPaintInterpolationT(c.property,n);t.uniform1f(e[c.name],Math.max(0,Math.min(4,h-c.stopOffset)))}},e.exports=s},{"../util/util":212,"./vertex_array_type":60}],59:[function(t,e,i){"use strict";var n=t("../util/struct_array")({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});e.exports=n},{"../util/struct_array":210}],60:[function(t,e,i){"use strict";var n=t("../util/struct_array");e.exports=function(t){return n({members:t,alignment:4})}},{"../util/struct_array":210}],61:[function(t,e,i){"use strict";var n=function(t,e,i){this.column=t,this.row=e,this.zoom=i};n.prototype.clone=function(){return new n(this.column,this.row,this.zoom)},n.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},n.prototype.sub=function(t){return this.clone()._sub(t)},n.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},n.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this},e.exports=n},{}],62:[function(t,e,i){"use strict";var n=t("../util/util").wrap,r=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};r.prototype.wrap=function(){return new r(n(this.lng,-180,180),this.lat)},r.prototype.toArray=function(){return[this.lng,this.lat]},r.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},r.convert=function(t){if(t instanceof r)return t;if(t&&t.hasOwnProperty("lng")&&t.hasOwnProperty("lat"))return new r(t.lng,t.lat);if(Array.isArray(t)&&2===t.length)return new r(t[0],t[1]);throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},e.exports=r},{"../util/util":212}],63:[function(t,e,i){"use strict";var n=t("./lng_lat"),r=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};r.prototype.setNorthEast=function(t){return this._ne=n.convert(t),this},r.prototype.setSouthWest=function(t){return this._sw=n.convert(t),this},r.prototype.extend=function(t){var e,i,o=this._sw,a=this._ne;if(t instanceof n)e=t,i=t;else{if(!(t instanceof r))return Array.isArray(t)?t.every(Array.isArray)?this.extend(r.convert(t)):this.extend(n.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return o||a?(o.lng=Math.min(e.lng,o.lng),o.lat=Math.min(e.lat,o.lat),a.lng=Math.max(i.lng,a.lng),a.lat=Math.max(i.lat,a.lat)):(this._sw=new n(e.lng,e.lat),this._ne=new n(i.lng,i.lat)),this},r.prototype.getCenter=function(){return new n((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},r.prototype.getSouthWest=function(){return this._sw},r.prototype.getNorthEast=function(){return this._ne},r.prototype.getNorthWest=function(){return new n(this.getWest(),this.getNorth())},r.prototype.getSouthEast=function(){return new n(this.getEast(),this.getSouth())},r.prototype.getWest=function(){return this._sw.lng},r.prototype.getSouth=function(){return this._sw.lat},r.prototype.getEast=function(){return this._ne.lng},r.prototype.getNorth=function(){return this._ne.lat},r.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},r.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},r.convert=function(t){return!t||t instanceof r?t:new r(t)},e.exports=r},{"./lng_lat":62}],64:[function(t,e,i){"use strict";var n=t("./lng_lat"),r=t("point-geometry"),o=t("./coordinate"),a=t("../util/util"),s=t("../util/interpolate"),l=t("../source/tile_coord"),u=t("../data/extent"),c=t("@mapbox/gl-matrix"),h=c.vec4,d=c.mat4,f=c.mat2,p=function(t,e,i){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new n(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},m={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};m.minZoom.get=function(){return this._minZoom},m.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},m.maxZoom.get=function(){return this._maxZoom},m.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},m.worldSize.get=function(){return this.tileSize*this.scale},m.centerPoint.get=function(){return this.size._div(2)},m.size.get=function(){return new r(this.width,this.height)},m.bearing.get=function(){return-this.angle/Math.PI*180},m.bearing.set=function(t){var e=-a.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=f.create(),f.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},m.pitch.get=function(){return this._pitch/Math.PI*180},m.pitch.set=function(t){var e=a.clamp(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},m.fov.get=function(){return this._fov/Math.PI*180},m.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},m.zoom.get=function(){return this._zoom},m.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},m.center.get=function(){return this._center},m.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},p.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},p.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),i=e;if(e<t.minzoom)return[];e>t.maxzoom&&(e=t.maxzoom);var n=this.pointCoordinate(this.centerPoint,e),o=new r(n.column-.5,n.row-.5),a=[this.pointCoordinate(new r(0,0),e),this.pointCoordinate(new r(this.width,0),e),this.pointCoordinate(new r(this.width,this.height),e),this.pointCoordinate(new r(0,this.height),e)];return l.cover(e,a,t.reparseOverscaled?i:e,this._renderWorldCopies).sort(function(t,e){return o.dist(t)-o.dist(e)})},p.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},m.unmodified.get=function(){return this._unmodified},p.prototype.zoomScale=function(t){return Math.pow(2,t)},p.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},p.prototype.project=function(t){return new r(this.lngX(t.lng),this.latY(t.lat))},p.prototype.unproject=function(t){return new n(this.xLng(t.x),this.yLat(t.y))},m.x.get=function(){return this.lngX(this.center.lng)},m.y.get=function(){return this.latY(this.center.lat)},m.point.get=function(){return new r(this.x,this.y)},p.prototype.lngX=function(t){return(180+t)*this.worldSize/360},p.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},p.prototype.xLng=function(t){return 360*t/this.worldSize-180},p.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},p.prototype.setLocationAtPoint=function(t,e){var i=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(i))},p.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},p.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},p.prototype.locationCoordinate=function(t){return new o(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},p.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new n(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},p.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];h.transformMat4(i,i,this.pixelMatrixInverse),h.transformMat4(n,n,this.pixelMatrixInverse);var r=i[3],a=n[3],l=i[1]/r,u=n[1]/a,c=i[2]/r,d=n[2]/a,f=c===d?0:(0-c)/(d-c);return new o(s(i[0]/r,n[0]/a,f)/this.tileSize,s(l,u,f)/this.tileSize,this.zoom)._zoomTo(e)},p.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return h.transformMat4(i,i,this.pixelMatrix),new r(i[0]/i[3],i[1]/i[3])},p.prototype.calculatePosMatrix=function(t,e){var i=t.toCoordinate(e),n=this.worldSize/this.zoomScale(i.zoom),r=d.identity(new Float64Array(16));return d.translate(r,r,[i.column*n,i.row*n,0]),d.scale(r,r,[n/u,n/u,1]),d.multiply(r,this.projMatrix,r),new Float32Array(r)},p.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,i,n,o,a,s,l,u=this.size,c=this._unmodified;this.latRange&&(t=this.latY(this.latRange[1]),o=(e=this.latY(this.latRange[0]))-t<u.y?u.y/(e-t):0),this.lngRange&&(i=this.lngX(this.lngRange[0]),a=(n=this.lngX(this.lngRange[1]))-i<u.x?u.x/(n-i):0);var h=Math.max(a||0,o||0);if(h)return this.center=this.unproject(new r(a?(n+i)/2:this.x,o?(e+t)/2:this.y)),this.zoom+=this.scaleZoom(h),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var d=this.y,f=u.y/2;d-f<t&&(l=t+f),d+f>e&&(l=e-f)}if(this.lngRange){var p=this.x,m=u.x/2;p-m<i&&(s=i+m),p+m>n&&(s=n-m)}void 0===s&&void 0===l||(this.center=this.unproject(new r(void 0!==s?s:this.x,void 0!==l?l:this.y))),this._unmodified=c,this._constraining=!1}},p.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),n=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),r=new Float64Array(16);d.perspective(r,this._fov,this.width/this.height,1,n),d.scale(r,r,[1,-1,1]),d.translate(r,r,[0,0,-this.cameraToCenterDistance]),d.rotateX(r,r,this._pitch),d.rotateZ(r,r,this.angle),d.translate(r,r,[-this.x,-this.y,0]);var o=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(d.scale(r,r,[1,1,o,1]),this.projMatrix=r,r=d.create(),d.scale(r,r,[this.width/2,-this.height/2,1]),d.translate(r,r,[1,-1,0]),this.pixelMatrix=d.multiply(new Float64Array(16),r,this.projMatrix),!(r=d.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=r}},Object.defineProperties(p.prototype,m),e.exports=p},{"../data/extent":54,"../source/tile_coord":94,"../util/interpolate":204,"../util/util":212,"./coordinate":61,"./lng_lat":62,"@mapbox/gl-matrix":1,"point-geometry":26}],65:[function(t,e,i){"use strict";var n=t("./util/browser"),r=e.exports={};r.version=t("../package.json").version,r.workerCount=Math.max(Math.floor(n.hardwareConcurrency/2),1),r.Map=t("./ui/map"),r.NavigationControl=t("./ui/control/navigation_control"),r.GeolocateControl=t("./ui/control/geolocate_control"),r.AttributionControl=t("./ui/control/attribution_control"),r.ScaleControl=t("./ui/control/scale_control"),r.FullscreenControl=t("./ui/control/fullscreen_control"),r.Popup=t("./ui/popup"),r.Marker=t("./ui/marker"),r.Style=t("./style/style"),r.LngLat=t("./geo/lng_lat"),r.LngLatBounds=t("./geo/lng_lat_bounds"),r.Point=t("point-geometry"),r.Evented=t("./util/evented"),r.supported=t("./util/browser").supported;var o=t("./util/config");r.config=o;var a=t("./source/rtl_text_plugin");r.setRTLTextPlugin=a.setRTLTextPlugin,Object.defineProperty(r,"accessToken",{get:function(){return o.ACCESS_TOKEN},set:function(t){o.ACCESS_TOKEN=t}})},{"../package.json":43,"./geo/lng_lat":62,"./geo/lng_lat_bounds":63,"./source/rtl_text_plugin":90,"./style/style":146,"./ui/control/attribution_control":173,"./ui/control/fullscreen_control":174,"./ui/control/geolocate_control":175,"./ui/control/navigation_control":177,"./ui/control/scale_control":178,"./ui/map":187,"./ui/marker":188,"./ui/popup":189,"./util/browser":192,"./util/config":196,"./util/evented":200,"point-geometry":26}],66:[function(t,e,i){"use strict";var n=t("./pattern");e.exports=function(t,e,i){var r=t.gl,o=t.transform,a=o.tileSize,s=i.paint["background-color"],l=i.paint["background-pattern"],u=i.paint["background-opacity"],c=!l&&1===s[3]&&1===u;if(t.isOpaquePass===c){var h;r.disable(r.STENCIL_TEST),t.setDepthSublayer(0),l?(h=t.useProgram("fillPattern",t.basicFillProgramConfiguration),n.prepare(l,t,h),t.tileExtentPatternVAO.bind(r,h,t.tileExtentBuffer)):(h=t.useProgram("fill",t.basicFillProgramConfiguration),r.uniform4fv(h.u_color,s),t.tileExtentVAO.bind(r,h,t.tileExtentBuffer)),r.uniform1f(h.u_opacity,u);for(var d=0,f=o.coveringTiles({tileSize:a});d<f.length;d+=1){var p=f[d];l&&n.setTile({coord:p,tileSize:a},t,h),r.uniformMatrix4fv(h.u_matrix,!1,t.transform.calculatePosMatrix(p)),r.drawArrays(r.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}},{"./pattern":78}],67:[function(t,e,i){"use strict";var n=t("../util/browser");e.exports=function(t,e,i,r){if(!t.isOpaquePass){var o=t.gl;t.setDepthSublayer(0),t.depthMask(!1),o.disable(o.STENCIL_TEST);for(var a=0;a<r.length;a++){var s=r[a],l=e.getTile(s),u=l.getBucket(i);if(u){var c=u.buffers,h=c.layerData[i.id],d=h.programConfiguration,f=t.useProgram("circle",d);d.setUniforms(o,f,i,{zoom:t.transform.zoom}),"map"===i.paint["circle-pitch-scale"]?(o.uniform1i(f.u_scale_with_map,!0),o.uniform2f(f.u_extrude_scale,t.transform.pixelsToGLUnits[0]*t.transform.cameraToCenterDistance,t.transform.pixelsToGLUnits[1]*t.transform.cameraToCenterDistance)):(o.uniform1i(f.u_scale_with_map,!1),o.uniform2fv(f.u_extrude_scale,t.transform.pixelsToGLUnits)),o.uniform1f(f.u_devicepixelratio,n.devicePixelRatio),o.uniformMatrix4fv(f.u_matrix,!1,t.translatePosMatrix(s.posMatrix,l,i.paint["circle-translate"],i.paint["circle-translate-anchor"]));for(var p=0,m=c.segments;p<m.length;p+=1){var v=m[p];v.vaos[i.id].bind(o,f,c.layoutVertexBuffer,c.elementBuffer,h.paintVertexBuffer,v.vertexOffset),o.drawElements(o.TRIANGLES,3*v.primitiveLength,o.UNSIGNED_SHORT,3*v.primitiveOffset*2)}}}}}},{"../util/browser":192}],68:[function(t,e,i){"use strict";e.exports=function(t,e,i,n){var r=t.gl;r.enable(r.STENCIL_TEST);for(var o=t.useProgram("collisionBox"),a=0;a<n.length;a++){var s=n[a],l=e.getTile(s),u=l.getBucket(i);if(u){var c=u.buffers.collisionBox;if(c){r.uniformMatrix4fv(o.u_matrix,!1,s.posMatrix),t.enableTileClippingMask(s),t.lineWidth(1),r.uniform1f(o.u_scale,Math.pow(2,t.transform.zoom-l.coord.z)),r.uniform1f(o.u_zoom,10*t.transform.zoom),r.uniform1f(o.u_maxzoom,10*(l.coord.z+1));for(var h=0,d=c.segments;h<d.length;h+=1){var f=d[h];f.vaos[i.id].bind(r,o,c.layoutVertexBuffer,c.elementBuffer,null,f.vertexOffset),r.drawElements(r.LINES,2*f.primitiveLength,r.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}}}}},{}],69:[function(t,e,i){"use strict";function n(t,e,i){var n=t.gl;n.disable(n.STENCIL_TEST),t.lineWidth(1*r.devicePixelRatio);var h=i.posMatrix,d=t.useProgram("debug");n.uniformMatrix4fv(d.u_matrix,!1,h),n.uniform4f(d.u_color,1,0,0,1),t.debugVAO.bind(n,d,t.debugBuffer),n.drawArrays(n.LINE_STRIP,0,t.debugBuffer.length);for(var f=function(t,e,i,n){n=n||1;var r,o,a,s,l,u,h,d,f=[];for(r=0,o=t.length;r<o;r++)if(l=c[t[r]]){for(d=null,a=0,s=l[1].length;a<s;a+=2)-1===l[1][a]&&-1===l[1][a+1]?d=null:(u=e+l[1][a]*n,h=i-l[1][a+1]*n,d&&f.push(d.x,d.y,u,h),d={x:u,y:h});e+=l[0]*n}return f}(i.toString(),50,200,5),p=new u,m=0;m<f.length;m+=2)p.emplaceBack(f[m],f[m+1]);var v=s.fromStructArray(p,s.BufferType.VERTEX);(new l).bind(n,d,v),n.uniform4f(d.u_color,1,1,1,1);for(var g=e.getTile(i).tileSize,y=a/(Math.pow(2,t.transform.zoom-i.z)*g),_=[[-1,-1],[-1,1],[1,-1],[1,1]],b=0;b<_.length;b++){var x=_[b];n.uniformMatrix4fv(d.u_matrix,!1,o.translate([],h,[y*x[0],y*x[1],0])),n.drawArrays(n.LINES,0,v.length)}n.uniform4f(d.u_color,0,0,0,1),n.uniformMatrix4fv(d.u_matrix,!1,h),n.drawArrays(n.LINES,0,v.length)}var r=t("../util/browser"),o=t("@mapbox/gl-matrix").mat4,a=t("../data/extent"),s=t("../data/buffer"),l=t("./vertex_array_object"),u=t("../data/pos_array");e.exports=function(t,e,i){for(var r=0;r<i.length;r++)n(t,e,i[r])};var c={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]}},{"../data/buffer":51,"../data/extent":54,"../data/pos_array":57,"../util/browser":192,"./vertex_array_object":80,"@mapbox/gl-matrix":1}],70:[function(t,e,i){"use strict";function n(t,e,i,n,r){for(var o=!0,a=0,s=n;a<s.length;a+=1){var l=s[a],u=e.getTile(l),c=u.getBucket(i);c&&(t.enableTileClippingMask(l),r(t,e,i,u,l,c.buffers,o),o=!1)}}function r(t,e,i,n,r,o,s){for(var l=t.gl,u=o.layerData[i.id],c=a("fill",i.paint["fill-pattern"],t,u,i,n,r,s),h=0,d=o.segments;h<d.length;h+=1){var f=d[h];f.vaos[i.id].bind(l,c,o.layoutVertexBuffer,o.elementBuffer,u.paintVertexBuffer,f.vertexOffset),l.drawElements(l.TRIANGLES,3*f.primitiveLength,l.UNSIGNED_SHORT,3*f.primitiveOffset*2)}}function o(t,e,i,n,r,o,s){var l=t.gl,u=o.layerData[i.id],c=a("fillOutline",i.paint["fill-pattern"]&&!i.getPaintProperty("fill-outline-color"),t,u,i,n,r,s);l.uniform2f(c.u_world,l.drawingBufferWidth,l.drawingBufferHeight);for(var h=0,d=o.segments2;h<d.length;h+=1){var f=d[h];f.vaos[i.id].bind(l,c,o.layoutVertexBuffer,o.elementBuffer2,u.paintVertexBuffer,f.vertexOffset),l.drawElements(l.LINES,2*f.primitiveLength,l.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}function a(t,e,i,n,r,o,a,l){var u,c=i.currentProgram;return e?(u=i.useProgram(t+"Pattern",n.programConfiguration),(l||u!==c)&&(n.programConfiguration.setUniforms(i.gl,u,r,{zoom:i.transform.zoom}),s.prepare(r.paint["fill-pattern"],i,u)),s.setTile(o,i,u)):(u=i.useProgram(t,n.programConfiguration),(l||u!==c)&&n.programConfiguration.setUniforms(i.gl,u,r,{zoom:i.transform.zoom})),i.gl.uniformMatrix4fv(u.u_matrix,!1,i.translatePosMatrix(a.posMatrix,o,r.paint["fill-translate"],r.paint["fill-translate-anchor"])),u}var s=t("./pattern");e.exports=function(t,e,i,a){var s=t.gl;s.enable(s.STENCIL_TEST);var l=!i.paint["fill-pattern"]&&i.isPaintValueFeatureConstant("fill-color")&&i.isPaintValueFeatureConstant("fill-opacity")&&1===i.paint["fill-color"][3]&&1===i.paint["fill-opacity"];t.isOpaquePass===l&&(t.setDepthSublayer(1),n(t,e,i,a,r)),!t.isOpaquePass&&i.paint["fill-antialias"]&&(t.lineWidth(2),t.depthMask(!1),t.setDepthSublayer(i.getPaintProperty("fill-outline-color")?2:0),n(t,e,i,a,o))}},{"./pattern":78}],71:[function(t,e,i){"use strict";function n(t,e,i){this.gl=t,this.width=e.width,this.height=e.height,this.painter=e,this.layer=i,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function r(t,e,i,n){if(!t.isOpaquePass){var r=e.getTile(n),o=r.getBucket(i);if(o){var a=o.buffers,s=t.gl,l=i.paint["fill-extrusion-pattern"],h=a.layerData[i.id],f=h.programConfiguration,p=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",f);f.setUniforms(s,p,i,{zoom:t.transform.zoom}),l&&(u.prepare(l,t,p),u.setTile(r,t,p),s.uniform1f(p.u_height_factor,-Math.pow(2,n.z)/r.tileSize/8)),t.gl.uniformMatrix4fv(p.u_matrix,!1,t.translatePosMatrix(n.posMatrix,r,i.paint["fill-extrusion-translate"],i.paint["fill-extrusion-translate-anchor"])),function(t,e){var i=e.gl,n=e.style.light,r=n.calculated.position,o=[r.x,r.y,r.z],a=c.create();"viewport"===n.calculated.anchor&&c.fromRotation(a,-e.transform.angle),d.transformMat3(o,o,a),i.uniform3fv(t.u_lightpos,o),i.uniform1f(t.u_lightintensity,n.calculated.intensity),i.uniform3fv(t.u_lightcolor,n.calculated.color.slice(0,3))}(p,t);for(var m=0,v=a.segments;m<v.length;m+=1){var g=v[m];g.vaos[i.id].bind(s,p,a.layoutVertexBuffer,a.elementBuffer,h.paintVertexBuffer,g.vertexOffset),s.drawElements(s.TRIANGLES,3*g.primitiveLength,s.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}}}var o=t("@mapbox/gl-matrix"),a=t("../data/buffer"),s=t("./vertex_array_object"),l=t("../data/pos_array"),u=t("./pattern"),c=o.mat3,h=o.mat4,d=o.vec3;e.exports=function(t,e,i,o){if(0!==i.paint["fill-extrusion-opacity"]){var a=t.gl;a.disable(a.STENCIL_TEST),a.enable(a.DEPTH_TEST),t.depthMask(!0);var s=new n(a,t,i);s.bindFramebuffer(),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);for(var l=0;l<o.length;l++)r(t,e,i,o[l]);s.unbindFramebuffer(),s.renderToMap()}},n.prototype.bindFramebuffer=function(){var t=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),t.activeTexture(t.TEXTURE1),this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);else{this.fbo=t.createFramebuffer();var e=t.createRenderbuffer(),i=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,this.width,this.height),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},n.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},n.prototype.renderToMap=function(){var t=this.gl,e=this.painter,i=e.useProgram("extrusionTexture");t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1f(i.u_opacity,this.layer.paint["fill-extrusion-opacity"]),t.uniform1i(i.u_texture,1),t.uniformMatrix4fv(i.u_matrix,!1,h.ortho(h.create(),0,e.width,e.height,0,0,1)),t.disable(t.DEPTH_TEST),t.uniform1i(i.u_xdim,e.width),t.uniform1i(i.u_ydim,e.height);var n=new l;n.emplaceBack(0,0),n.emplaceBack(e.width,0),n.emplaceBack(0,e.height),n.emplaceBack(e.width,e.height);var r=a.fromStructArray(n,a.BufferType.VERTEX);(new s).bind(t,i,r),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.enable(t.DEPTH_TEST)}},{"../data/buffer":51,"../data/pos_array":57,"./pattern":78,"./vertex_array_object":80,"@mapbox/gl-matrix":1}],72:[function(t,e,i){"use strict";function n(t,e,i,n,a,s,l,u,c){var h,d,f,p,m=e.gl,v=a.paint["line-dasharray"],g=a.paint["line-pattern"];if(u||c){var y=1/o(i,1,e.transform.tileZoom);if(v){h=e.lineAtlas.getDash(v.from,"round"===a.layout["line-cap"]),d=e.lineAtlas.getDash(v.to,"round"===a.layout["line-cap"]);var _=h.width*v.fromScale,b=d.width*v.toScale;m.uniform2f(t.u_patternscale_a,y/_,-h.height/2),m.uniform2f(t.u_patternscale_b,y/b,-d.height/2),m.uniform1f(t.u_sdfgamma,e.lineAtlas.width/(256*Math.min(_,b)*r.devicePixelRatio)/2)}else if(g){if(f=e.spriteAtlas.getPosition(g.from,!0),p=e.spriteAtlas.getPosition(g.to,!0),!f||!p)return;m.uniform2f(t.u_pattern_size_a,f.size[0]*g.fromScale/y,p.size[1]),m.uniform2f(t.u_pattern_size_b,p.size[0]*g.toScale/y,p.size[1])}m.uniform2f(t.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}u&&(v?(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.lineAtlas.bind(m),m.uniform1f(t.u_tex_y_a,h.y),m.uniform1f(t.u_tex_y_b,d.y),m.uniform1f(t.u_mix,v.t)):g&&(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.spriteAtlas.bind(m,!0),m.uniform2fv(t.u_pattern_tl_a,f.tl),m.uniform2fv(t.u_pattern_br_a,f.br),m.uniform2fv(t.u_pattern_tl_b,p.tl),m.uniform2fv(t.u_pattern_br_b,p.br),m.uniform1f(t.u_fade,g.t)),m.uniform1f(t.u_width,a.paint["line-width"])),e.enableTileClippingMask(s);var x=e.translatePosMatrix(s.posMatrix,i,a.paint["line-translate"],a.paint["line-translate-anchor"]);m.uniformMatrix4fv(t.u_matrix,!1,x),m.uniform1f(t.u_ratio,1/o(i,1,e.transform.zoom));for(var w=0,S=n.segments;w<S.length;w+=1){var M=S[w];M.vaos[a.id].bind(m,t,n.layoutVertexBuffer,n.elementBuffer,l.paintVertexBuffer,M.vertexOffset),m.drawElements(m.TRIANGLES,3*M.primitiveLength,m.UNSIGNED_SHORT,3*M.primitiveOffset*2)}}var r=t("../util/browser"),o=t("../source/pixels_to_tile_units");e.exports=function(t,e,i,r){if(!t.isOpaquePass){t.setDepthSublayer(0),t.depthMask(!1);var o=t.gl;if(o.enable(o.STENCIL_TEST),!(i.paint["line-width"]<=0))for(var a,s=i.paint["line-dasharray"]?"lineSDF":i.paint["line-pattern"]?"linePattern":"line",l=!0,u=0,c=r;u<c.length;u+=1){var h=c[u],d=e.getTile(h),f=d.getBucket(i);if(f){var p=f.buffers.layerData[i.id],m=t.currentProgram,v=t.useProgram(s,p.programConfiguration),g=l||v!==m,y=a!==d.coord.z;g&&p.programConfiguration.setUniforms(t.gl,v,i,{zoom:t.transform.zoom}),n(v,t,d,f.buffers,i,h,p,g,y),a=d.coord.z,l=!1}}}}},{"../source/pixels_to_tile_units":87,"../util/browser":192}],73:[function(t,e,i){"use strict";function n(t,e,i,n){var o=t.gl;o.disable(o.STENCIL_TEST);var a=e.getTile(n),s=t.transform.calculatePosMatrix(n,e.getSource().maxzoom);a.registerFadeDuration(t.style.animationLoop,i.paint["raster-fade-duration"]);var l=t.useProgram("raster");o.uniformMatrix4fv(l.u_matrix,!1,s),o.uniform1f(l.u_brightness_low,i.paint["raster-brightness-min"]),o.uniform1f(l.u_brightness_high,i.paint["raster-brightness-max"]),o.uniform1f(l.u_saturation_factor,function(t){return t>0?1-1/(1.001-t):-t}(i.paint["raster-saturation"])),o.uniform1f(l.u_contrast_factor,function(t){return t>0?1/(1-t):1+t}(i.paint["raster-contrast"])),o.uniform3fv(l.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(i.paint["raster-hue-rotate"]));var u,c,h=a.sourceCache&&a.sourceCache.findLoadedParent(n,0,{}),d=function(t,e,i,n){var o=i.paint["raster-fade-duration"];if(t.sourceCache&&o>0){var a=Date.now(),s=(a-t.timeAdded)/o,l=e?(a-e.timeAdded)/o:-1,u=t.sourceCache.getSource(),c=n.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!e||Math.abs(e.coord.z-c)>Math.abs(t.coord.z-c),d=h&&t.refreshedUponExpiration?1:r.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}(a,h,i,t.transform);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a.texture),o.activeTexture(o.TEXTURE1),h?(o.bindTexture(o.TEXTURE_2D,h.texture),u=Math.pow(2,h.coord.z-a.coord.z),c=[a.coord.x*u%1,a.coord.y*u%1]):o.bindTexture(o.TEXTURE_2D,a.texture),o.uniform2fv(l.u_tl_parent,c||[0,0]),o.uniform1f(l.u_scale_parent,u||1),o.uniform1f(l.u_buffer_scale,1),o.uniform1f(l.u_fade_t,d.mix),o.uniform1f(l.u_opacity,d.opacity*i.paint["raster-opacity"]),o.uniform1i(l.u_image0,0),o.uniform1i(l.u_image1,1);var f=a.boundsBuffer||t.rasterBoundsBuffer;(a.boundsVAO||t.rasterBoundsVAO).bind(o,l,f),o.drawArrays(o.TRIANGLE_STRIP,0,f.length)}var r=t("../util/util");e.exports=function(t,e,i,r){if(!t.isOpaquePass){var o=t.gl;o.enable(o.DEPTH_TEST),t.depthMask(!0),o.depthFunc(o.LESS);for(var a=r.length&&r[0].z,s=0;s<r.length;s++){var l=r[s];t.setDepthSublayer(l.z-a),n(t,e,i,l)}o.depthFunc(o.LEQUAL)}}},{"../util/util":212}],74:[function(t,e,i){"use strict";function n(t,e,i,n,a,s,l,u,c,h){if(a||!t.style.sprite||t.style.sprite.loaded()){var d=t.gl,f="map"===u,p="map"===c,m=p;m?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST);for(var v,g,y=0,_=n;y<_.length;y+=1){var b=_[y],x=e.getTile(b),w=x.getBucket(i);if(w){var S=a?w.buffers.glyph:w.buffers.icon;if(S&&S.segments.length){var M=S.layerData[i.id].programConfiguration,E=a||w.sdfIcons;v&&w.fontstack===g||(v=t.useProgram(E?"symbolSDF":"symbolIcon",M),M.setUniforms(d,v,i,{zoom:t.transform.zoom}),r(v,t,a,E,f,p,w.fontstack,h,w.iconsNeedLinear,a?w.adjustedTextSize:w.adjustedIconSize)),t.enableTileClippingMask(b),d.uniformMatrix4fv(v.u_matrix,!1,t.translatePosMatrix(b.posMatrix,x,s,l)),o(v,t,i,x,S,a,E,p,h),g=w.fontstack}}}m||d.enable(d.DEPTH_TEST)}}function r(t,e,i,n,r,o,a,l,u,c){var h=e.gl,d=e.transform;if(h.uniform1i(t.u_rotate_with_map,r),h.uniform1i(t.u_pitch_with_map,o),h.activeTexture(h.TEXTURE0),h.uniform1i(t.u_texture,0),i){var f=a&&e.glyphSource.getGlyphAtlas(a);if(!f)return;f.updateTexture(h),h.uniform2f(t.u_texsize,f.width/4,f.height/4)}else{var p=e.options.rotating||e.options.zooming,m=1!==l||s.devicePixelRatio!==e.spriteAtlas.pixelRatio||u,v=o||d.pitch;e.spriteAtlas.bind(h,n||p||m||v),h.uniform2f(t.u_texsize,e.spriteAtlas.width/4,e.spriteAtlas.height/4)}h.activeTexture(h.TEXTURE1),e.frameHistory.bind(h),h.uniform1i(t.u_fadetexture,1);var g=Math.log(l/c)/Math.LN2||0;h.uniform1f(t.u_zoom,10*(d.zoom-g)),h.uniform1f(t.u_pitch,d.pitch/360*2*Math.PI),h.uniform1f(t.u_bearing,d.bearing/360*2*Math.PI),h.uniform1f(t.u_aspect_ratio,d.width/d.height)}function o(t,e,i,n,r,o,s,l,c){var h=e.gl,d=e.transform,f=c/(o?24:1);if(l){var p=u(n,f,d.zoom);h.uniform2f(t.u_extrude_scale,p,p)}else{var m=d.cameraToCenterDistance*f;h.uniform2f(t.u_extrude_scale,d.pixelsToGLUnits[0]*m,d.pixelsToGLUnits[1]*m)}if(s){var v=(o?"text":"icon")+"-halo-width",g=!i.isPaintValueFeatureConstant(v)||i.paint[v],y=f*(l?Math.cos(d._pitch):1)*d.cameraToCenterDistance;h.uniform1f(t.u_font_scale,f),h.uniform1f(t.u_gamma_scale,y),g&&(h.uniform1f(t.u_is_halo,1),a(r,i,h,t)),h.uniform1f(t.u_is_halo,0)}a(r,i,h,t)}function a(t,e,i,n){for(var r=t.layerData[e.id],o=r&&r.paintVertexBuffer,a=0,s=t.segments;a<s.length;a+=1){var l=s[a];l.vaos[e.id].bind(i,n,t.layoutVertexBuffer,t.elementBuffer,o,l.vertexOffset),i.drawElements(i.TRIANGLES,3*l.primitiveLength,i.UNSIGNED_SHORT,3*l.primitiveOffset*2)}}var s=t("../util/browser"),l=t("./draw_collision_debug"),u=t("../source/pixels_to_tile_units");e.exports=function(t,e,i,r){if(!t.isOpaquePass){var o=!(i.layout["text-allow-overlap"]||i.layout["icon-allow-overlap"]||i.layout["text-ignore-placement"]||i.layout["icon-ignore-placement"]),a=t.gl;o?a.disable(a.STENCIL_TEST):a.enable(a.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),n(t,e,i,r,!1,i.paint["icon-translate"],i.paint["icon-translate-anchor"],i.layout["icon-rotation-alignment"],i.layout["icon-rotation-alignment"],i.layout["icon-size"]),n(t,e,i,r,!0,i.paint["text-translate"],i.paint["text-translate-anchor"],i.layout["text-rotation-alignment"],i.layout["text-pitch-alignment"],i.layout["text-size"]),e.map.showCollisionBoxes&&l(t,e,i,r)}}},{"../source/pixels_to_tile_units":87,"../util/browser":192,"./draw_collision_debug":68}],75:[function(t,e,i){"use strict";var n=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};n.prototype.record=function(t,e,i){var n,r=this;if(this.firstFrame&&(t=0,this.firstFrame=!1),(e=Math.floor(10*e))<this.previousZoom)for(n=e+1;n<=this.previousZoom;n++)r.changeTimes[n]=t,r.changeOpacities[n]=r.opacities[n];else for(n=e;n>this.previousZoom;n--)r.changeTimes[n]=t,r.changeOpacities[n]=r.opacities[n];for(n=0;n<256;n++){var o=t-r.changeTimes[n],a=255*(i?o/i:1);r.opacities[n]=n<=e?r.changeOpacities[n]+a:r.changeOpacities[n]-a}this.changed=!0,this.previousZoom=e},n.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.changed&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,256,1,t.ALPHA,t.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,256,1,0,t.ALPHA,t.UNSIGNED_BYTE,this.array))},e.exports=n},{}],76:[function(t,e,i){"use strict";var n=t("../util/util"),r=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};r.prototype.setSprite=function(t){this.sprite=t},r.prototype.getDash=function(t,e){var i=t.join(",")+e;return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},r.prototype.addDash=function(t,e){var i=this,r=e?7:0,o=2*r+1;if(this.nextRow+o>this.height)return n.warnOnce("LineAtlas out of space"),null;for(var a=0,s=0;s<t.length;s++)a+=t[s];for(var l=this.width/a,u=l/2,c=t.length%2==1,h=-r;h<=r;h++)for(var d=i.nextRow+r+h,f=i.width*d,p=c?-t[t.length-1]:0,m=t[0],v=1,g=0;g<this.width;g++){for(;m<g/l;)p=m,m+=t[v],c&&v===t.length-1&&(m+=t[0]),v++;var y=Math.abs(g-p*l),_=Math.abs(g-m*l),b=Math.min(y,_),x=v%2==1,w=void 0;if(e){var S=r?h/r*(u+1):0;if(x){var M=u-Math.abs(S);w=Math.sqrt(b*b+M*M)}else w=u-Math.sqrt(b*b+S*S)}else w=(x?1:-1)*b;i.data[3+4*(f+g)]=Math.max(0,Math.min(255,w+128))}var E={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=o,this.dirty=!0,E},r.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},e.exports=r},{"../util/util":212}],77:[function(t,e,i){"use strict";var n=t("../util/browser"),r=t("@mapbox/gl-matrix").mat4,o=t("./frame_history"),a=t("../source/source_cache"),s=t("../data/extent"),l=t("../source/pixels_to_tile_units"),u=t("../util/util"),c=t("../data/buffer"),h=t("./vertex_array_object"),d=t("../data/raster_bounds_array"),f=t("../data/pos_array"),p=t("../data/program_configuration"),m=t("./shaders"),v={symbol:t("./draw_symbol"),circle:t("./draw_circle"),line:t("./draw_line"),fill:t("./draw_fill"),"fill-extrusion":t("./draw_fill_extrusion"),raster:t("./draw_raster"),background:t("./draw_background"),debug:t("./draw_debug")},g=function(t,e){this.gl=t,this.transform=e,this.reusableTextures={tiles:{},viewport:null},this.preFbos={},this.frameHistory=new o,this.setup(),this.numSublayers=a.maxUnderzooming+a.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=p.createStatic(["color","opacity"]),this.emptyProgramConfiguration=new p};g.prototype.resize=function(t,e){var i=this.gl;this.width=t*n.devicePixelRatio,this.height=e*n.devicePixelRatio,i.viewport(0,0,this.width,this.height)},g.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),this._depthMask=!1,t.depthMask(!1);var e=new f;e.emplaceBack(0,0),e.emplaceBack(s,0),e.emplaceBack(0,s),e.emplaceBack(s,s),this.tileExtentBuffer=c.fromStructArray(e,c.BufferType.VERTEX),this.tileExtentVAO=new h,this.tileExtentPatternVAO=new h;var i=new f;i.emplaceBack(0,0),i.emplaceBack(s,0),i.emplaceBack(s,s),i.emplaceBack(0,s),i.emplaceBack(0,0),this.debugBuffer=c.fromStructArray(i,c.BufferType.VERTEX),this.debugVAO=new h;var n=new d;n.emplaceBack(0,0,0,0),n.emplaceBack(s,0,32767,0),n.emplaceBack(0,s,0,32767),n.emplaceBack(s,s,32767,32767),this.rasterBoundsBuffer=c.fromStructArray(n,c.BufferType.VERTEX),this.rasterBoundsVAO=new h},g.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},g.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},g.prototype.clearDepth=function(){var t=this.gl;t.clearDepth(1),this.depthMask(!0),t.clear(t.DEPTH_BUFFER_BIT)},g.prototype._renderTileClippingMasks=function(t){var e=this,i=this.gl;i.colorMask(!1,!1,!1,!1),this.depthMask(!1),i.disable(i.DEPTH_TEST),i.enable(i.STENCIL_TEST),i.stencilMask(248),i.stencilOp(i.KEEP,i.KEEP,i.REPLACE);var n=1;this._tileClippingMaskIDs={};for(var r=0,o=t;r<o.length;r+=1){var a=o[r],s=e._tileClippingMaskIDs[a.id]=n++<<3;i.stencilFunc(i.ALWAYS,s,248);var l=e.useProgram("fill",e.basicFillProgramConfiguration);i.uniformMatrix4fv(l.u_matrix,!1,a.posMatrix),e.tileExtentVAO.bind(i,l,e.tileExtentBuffer),i.drawArrays(i.TRIANGLE_STRIP,0,e.tileExtentBuffer.length)}i.stencilMask(0),i.colorMask(!0,!0,!0,!0),this.depthMask(!0),i.enable(i.DEPTH_TEST)},g.prototype.enableTileClippingMask=function(t){var e=this.gl;e.stencilFunc(e.EQUAL,this._tileClippingMaskIDs[t.id],248)},g.prototype.prepareBuffers=function(){},g.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},g.prototype.render=function(t,e){if(this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphSource=t.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,t.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(e.showOverdrawInspector),this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var i=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];i&&v.debug(this,i,i.getVisibleCoordinates())}},g.prototype.renderPass=function(){var t,e,i=this,n=this.style._order;this.currentLayer=this.isOpaquePass?n.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var r=0;r<n.length;r++){var o=i.style._layers[n[i.currentLayer]];o.source!==(t&&t.id)&&(e=[],(t=i.style.sourceCaches[o.source])&&(t.prepare&&t.prepare(),i.clearStencil(),e=t.getVisibleCoordinates(),t.getSource().isTileClipped&&i._renderTileClippingMasks(e)),i.isOpaquePass||e.reverse()),i.renderLayer(i,t,o,e),i.currentLayer+=i.isOpaquePass?-1:1}},g.prototype.depthMask=function(t){t!==this._depthMask&&(this._depthMask=t,this.gl.depthMask(t))},g.prototype.renderLayer=function(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||n.length)&&(this.id=i.id,v[i.type](t,e,i,n))},g.prototype.setDepthSublayer=function(t){var e=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,i=e-1+this.depthRange;this.gl.depthRange(i,e)},g.prototype.translatePosMatrix=function(t,e,i,n){if(!i[0]&&!i[1])return t;if("viewport"===n){var o=Math.sin(-this.transform.angle),a=Math.cos(-this.transform.angle);i=[i[0]*a-i[1]*o,i[0]*o+i[1]*a]}var s=[l(e,i[0],this.transform.zoom),l(e,i[1],this.transform.zoom),0],u=new Float32Array(16);return r.translate(u,t,s),u},g.prototype.saveTileTexture=function(t){var e=this.reusableTextures.tiles[t.size];e?e.push(t):this.reusableTextures.tiles[t.size]=[t]},g.prototype.saveViewportTexture=function(t){this.reusableTextures.viewport=t},g.prototype.getTileTexture=function(t){var e=this.reusableTextures.tiles[t];return e&&e.length>0?e.pop():null},g.prototype.getViewportTexture=function(t,e){var i=this.reusableTextures.viewport;if(i)return i.width===t&&i.height===e?i:(this.gl.deleteTexture(i),void(this.reusableTextures.viewport=null))},g.prototype.lineWidth=function(t){this.gl.lineWidth(u.clamp(t,this.lineWidthRange[0],this.lineWidthRange[1]))},g.prototype.showOverdrawInspector=function(t){if(t||this._showOverdrawInspector){this._showOverdrawInspector=t;var e=this.gl;if(t){e.blendFunc(e.CONSTANT_COLOR,e.ONE);e.blendColor(1/8,1/8,1/8,0),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}else e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}},g.prototype.createProgram=function(t,e){var i=this.gl,r=i.createProgram(),o=m[t],a="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+n.devicePixelRatio.toFixed(1)+"\n";this._showOverdrawInspector&&(a+="#define OVERDRAW_INSPECTOR;\n");var s=e.applyPragmas(a+m.prelude.fragmentSource+o.fragmentSource,"fragment"),l=e.applyPragmas(a+m.prelude.vertexSource+o.vertexSource,"vertex"),u=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(u,s),i.compileShader(u),i.attachShader(r,u);var c=i.createShader(i.VERTEX_SHADER);i.shaderSource(c,l),i.compileShader(c),i.attachShader(r,c),i.linkProgram(r);for(var h=i.getProgramParameter(r,i.ACTIVE_ATTRIBUTES),d={program:r,numAttributes:h},f=0;f<h;f++){var p=i.getActiveAttrib(r,f);d[p.name]=i.getAttribLocation(r,p.name)}for(var v=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),g=0;g<v;g++){var y=i.getActiveUniform(r,g);d[y.name]=i.getUniformLocation(r,y.name)}return d},g.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var i=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=this.createProgram(t,e)),this.cache[i]},g.prototype.useProgram=function(t,e){var i=this.gl,n=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.currentProgram!==n&&(i.useProgram(n.program),this.currentProgram=n),n},e.exports=g},{"../data/buffer":51,"../data/extent":54,"../data/pos_array":57,"../data/program_configuration":58,"../data/raster_bounds_array":59,"../source/pixels_to_tile_units":87,"../source/source_cache":92,"../util/browser":192,"../util/util":212,"./draw_background":66,"./draw_circle":67,"./draw_debug":69,"./draw_fill":70,"./draw_fill_extrusion":71,"./draw_line":72,"./draw_raster":73,"./draw_symbol":74,"./frame_history":75,"./shaders":79,"./vertex_array_object":80,"@mapbox/gl-matrix":1}],78:[function(t,e,i){"use strict";var n=t("../source/pixels_to_tile_units");i.prepare=function(t,e,i){var n=e.gl,r=e.spriteAtlas.getPosition(t.from,!0),o=e.spriteAtlas.getPosition(t.to,!0);r&&o&&(n.uniform1i(i.u_image,0),n.uniform2fv(i.u_pattern_tl_a,r.tl),n.uniform2fv(i.u_pattern_br_a,r.br),n.uniform2fv(i.u_pattern_tl_b,o.tl),n.uniform2fv(i.u_pattern_br_b,o.br),n.uniform1f(i.u_mix,t.t),n.uniform2fv(i.u_pattern_size_a,r.size),n.uniform2fv(i.u_pattern_size_b,o.size),n.uniform1f(i.u_scale_a,t.fromScale),n.uniform1f(i.u_scale_b,t.toScale),n.activeTexture(n.TEXTURE0),e.spriteAtlas.bind(n,!0))},i.setTile=function(t,e,i){var r=e.gl;r.uniform1f(i.u_tile_units_to_pixels,1/n(t,1,e.transform.tileZoom));var o=Math.pow(2,t.coord.z),a=t.tileSize*Math.pow(2,e.transform.tileZoom)/o,s=a*(t.coord.x+t.coord.w*o),l=a*t.coord.y;r.uniform2f(i.u_pixel_coord_upper,s>>16,l>>16),r.uniform2f(i.u_pixel_coord_lower,65535&s,65535&l)}},{"../source/pixels_to_tile_units":87}],79:[function(t,e,i){"use strict";t("path");e.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n\n// To minimize the number of attributes needed in the mapbox-gl-native shaders,\n// we encode a 4-component color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    float r = floor(encodedColor[0]/256.0)/255.0;\n    float g = (encodedColor[0] - r*256.0*255.0)/255.0;\n    float b = floor(encodedColor[1]/256.0)/255.0;\n    float a = (encodedColor[1] - b*256.0*255.0)/255.0;\n    return vec4(r, g, b, a);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\n\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n#pragma mapbox: define lowp float opacity\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma mapbox: define lowp vec4 fill_color\n#pragma mapbox: define lowp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_font_scale;\nuniform highp float u_gamma_scale;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 fill_color\n    #pragma mapbox: initialize lowp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / u_gamma_scale;\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / u_gamma_scale;\n        buff = (6.0 - halo_width / u_font_scale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    highp float gamma_scaled = gamma * v_gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist) * fade_alpha;\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n#pragma mapbox: define lowp vec4 fill_color\n#pragma mapbox: define lowp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 fill_color\n    #pragma mapbox: initialize lowp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"}}},{path:23}],80:[function(t,e,i){"use strict";var n=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};n.prototype.bind=function(t,e,i,n,r,o){void 0===t.extVertexArrayObject&&(t.extVertexArrayObject=t.getExtension("OES_vertex_array_object"));var a=!this.vao||this.boundProgram!==e||this.boundVertexBuffer!==i||this.boundVertexBuffer2!==r||this.boundElementBuffer!==n||this.boundVertexOffset!==o;!t.extVertexArrayObject||a?(this.freshBind(t,e,i,n,r,o),this.gl=t):t.extVertexArrayObject.bindVertexArrayOES(this.vao)},n.prototype.freshBind=function(t,e,i,n,r,o){var a,s=e.numAttributes;if(t.extVertexArrayObject)this.vao&&this.destroy(),this.vao=t.extVertexArrayObject.createVertexArrayOES(),t.extVertexArrayObject.bindVertexArrayOES(this.vao),a=0,this.boundProgram=e,this.boundVertexBuffer=i,this.boundVertexBuffer2=r,this.boundElementBuffer=n,this.boundVertexOffset=o;else{a=t.currentNumAttributes||0;for(var l=s;l<a;l++)t.disableVertexAttribArray(l)}for(var u=a;u<s;u++)t.enableVertexAttribArray(u);i.bind(t),i.setVertexAttribPointers(t,e,o),r&&(r.bind(t),r.setVertexAttribPointers(t,e,o)),n&&n.bind(t),t.currentNumAttributes=s},n.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},e.exports=n},{}],81:[function(t,e,i){"use strict";var n=t("./image_source"),r=t("../util/window"),o=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.options=i,this.animate=!i.hasOwnProperty("animate")||i.animate}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){if(this.canvas=this.canvas||r.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions())return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var t;this.play=function(){t=this.map.style.animationLoop.set(1/0),this.map._rerender()},this.pause=function(){this.map.style.animationLoop.cancel(t)},this._finishLoading()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.canvas&&this.animate&&this.play())},e.prototype.prepare=function(){var t=!1;this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||this.tile&&this._prepareImage(this.map.painter.gl,this.canvas,t)},e.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},e.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},e}(n);e.exports=o},{"../util/window":194,"./image_source":85}],82:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("../util/util"),o=t("../util/window"),a=t("../data/extent"),s=function(t){function e(e,i,n,o){t.call(this),i=i||{},this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=n,this.setEventedParent(o),this._data=i.data,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type);var s=a/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*s,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*s,extent:a,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(i.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:a,radius:(i.clusterRadius||50)*s,log:!1}},i.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){return e?void t.fire("error",{error:e}):void t.fire("data",{dataType:"source",sourceDataType:"metadata"})})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){return t?e.fire("error",{error:t}):void e.fire("data",{dataType:"source",sourceDataType:"content"})}),this},e.prototype._updateWorkerData=function(t){var e=this,i=r.extend({},this.workerOptions),n=this._data;"string"==typeof n?i.url=function(t){var e=o.document.createElement("a");return e.href=t,e.href}(n):i.data=JSON.stringify(n),this.workerID=this.dispatcher.send(this.type+".loadData",i,function(i){e._loaded=!0,t(i)})},e.prototype.loadTile=function(t,e){var i=this,n=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={type:this.type,uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:n,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send("loadTile",r,function(n,r){if(t.unloadVectorData(),!t.aborted)return n?e(n):(t.loadVectorData(r,i.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(i)),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},function(){},t.workerID)},e.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},e.prototype.serialize=function(){return{type:this.type,data:this._data}},e}(n);e.exports=s},{"../data/extent":54,"../util/evented":200,"../util/util":212,"../util/window":194}],83:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("geojson-rewind"),o=t("./geojson_wrapper"),a=t("vt-pbf"),s=t("supercluster"),l=t("geojson-vt"),u=function(t){function e(e,i,n){t.call(this,e,i),n&&(this.loadGeoJSON=n),this._geoJSONIndexes={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.loadVectorData=function(t,e){var i=t.source,n=t.coord;if(!this._geoJSONIndexes[i])return e(null,null);var r=this._geoJSONIndexes[i].getTile(Math.min(n.z,t.maxZoom),n.x,n.y);if(!r)return e(null,null);var s=new o(r.features);s.name="_geojsonTileLayer";var l=a({layers:{_geojsonTileLayer:s}});0===l.byteOffset&&l.byteLength===l.buffer.byteLength||(l=new Uint8Array(l)),s.rawData=l.buffer,e(null,s)},e.prototype.loadData=function(t,e){var i=function(i,n){var o=this;return i?e(i):"object"!=typeof n?e(new Error("Input data is not a valid GeoJSON object.")):(r(n,!0),void this._indexData(n,t,function(i,n){return i?e(i):(o._geoJSONIndexes[t.source]=n,void e(null))}))}.bind(this);this.loadGeoJSON(t,i)},e.prototype.loadGeoJSON=function(t,e){if(t.url)n.getJSON(t.url,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},e.prototype.removeSource=function(t){this._geoJSONIndexes[t.source]&&delete this._geoJSONIndexes[t.source]},e.prototype._indexData=function(t,e,i){try{e.cluster?i(null,s(e.superclusterOptions).load(t.features)):i(null,l(t,e.geojsonVtOptions))}catch(t){return i(t)}},e}(t("./vector_tile_worker_source"));e.exports=u},{"../util/ajax":191,"./geojson_wrapper":84,"./vector_tile_worker_source":96,"geojson-rewind":7,"geojson-vt":11,supercluster:29,"vt-pbf":38}],84:[function(t,e,i){"use strict";var n=t("point-geometry"),r=t("vector-tile").VectorTileFeature,o=t("../data/extent"),a=function(t){if(this.type=t.type,1===t.type){this.rawGeometry=[];for(var e=0;e<t.geometry.length;e++)this.rawGeometry.push([t.geometry[e]])}else this.rawGeometry=t.geometry;this.properties=t.tags,"id"in t&&(this.id=t.id),this.extent=o};a.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],o=0;o<i.length;o++)r.push(new n(i[o][0],i[o][1]));this.geometry.push(r)}return this.geometry},a.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},a.prototype.toGeoJSON=function(){r.prototype.toGeoJSON.call(this)};var s=function(t){this.features=t,this.length=t.length,this.extent=o};s.prototype.feature=function(t){return new a(this.features[t])},e.exports=s},{"../data/extent":54,"point-geometry":26,"vector-tile":34}],85:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/window"),o=t("./tile_coord"),a=t("../geo/lng_lat"),s=t("point-geometry"),l=t("../util/evented"),u=t("../util/ajax"),c=t("../data/extent"),h=t("../data/raster_bounds_array"),d=t("../data/buffer"),f=t("../render/vertex_array_object"),p=function(t){function e(e,i,n,r){t.call(this),this.id=e,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.setEventedParent(r),this.options=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,u.getImage(this.options.url,function(e,i){return e?t.fire("error",{error:e}):(t.image=i,void t._finishLoading())})},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire("data",{dataType:"source",sourceDataType:"metadata"}))},e.prototype.onAdd=function(t){this.load(),this.map=t,this.image&&this.setCoordinates(this.coordinates)},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,i=t.map(function(t){return e.transform.locationCoordinate(a.convert(t)).zoomTo(0)}),r=this.centerCoord=n.getCoordinatesCenter(i);return r.column=Math.round(r.column),r.row=Math.round(r.row),this.minzoom=this.maxzoom=r.zoom,this.coord=new o(r.zoom,r.column,r.row),this._tileCoords=i.map(function(t){var e=t.zoomTo(r.zoom);return new s(Math.round((e.column-r.column)*c),Math.round((e.row-r.row)*c))}),this.fire("data",{dataType:"source",sourceDataType:"content"}),this},e.prototype._setTile=function(t){this.tile=t;var e=32767,i=new h;i.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),i.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,e,0),i.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,e),i.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,e,e),this.tile.buckets={},this.tile.boundsBuffer=d.fromStructArray(i,d.BufferType.VERTEX),this.tile.boundsVAO=new f},e.prototype.prepare=function(){this.tile&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},e.prototype._prepareImage=function(t,e,i){"loaded"!==this.tile.state?(this.tile.state="loaded",this.tile.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)):i?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):(e instanceof r.HTMLVideoElement||e instanceof r.ImageData||e instanceof r.HTMLCanvasElement)&&(t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e))},e.prototype.loadTile=function(t,e){this.coord&&this.coord.toString()===t.coord.toString()?(this._setTile(t),e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",urls:this.url,coordinates:this.coordinates}},e}(l);e.exports=p},{"../data/buffer":51,"../data/extent":54,"../data/raster_bounds_array":59,"../geo/lng_lat":62,"../render/vertex_array_object":80,"../util/ajax":191,"../util/evented":200,"../util/util":212,"../util/window":194,"./tile_coord":94,"point-geometry":26}],86:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/ajax"),o=t("../util/browser"),a=t("../util/mapbox").normalizeSourceURL;e.exports=function(t,e){var i=function(t,i){if(t)return e(t);var r=n.pick(i,["tiles","minzoom","maxzoom","attribution","mapbox_logo"]);i.vector_layers&&(r.vectorLayers=i.vector_layers,r.vectorLayerIds=r.vectorLayers.map(function(t){return t.id})),e(null,r)};t.url?r.getJSON(a(t.url),i):o.frame(i.bind(null,null,t))}},{"../util/ajax":191,"../util/browser":192,"../util/mapbox":208,"../util/util":212}],87:[function(t,e,i){"use strict";var n=t("../data/extent");e.exports=function(t,e,i){return e*(n/(t.tileSize*Math.pow(2,i-t.coord.z)))}},{"../data/extent":54}],88:[function(t,e,i){"use strict";function n(t,e){var i=t.coord,n=e.coord;return i.z-n.z||i.y-n.y||i.w-n.w||i.x-n.x}var r=t("./tile_coord");i.rendered=function(t,e,i,r,o,a){var s=t.tilesIn(i);s.sort(n);for(var l=[],u=0;u<s.length;u++){var c=s[u];c.tile.featureIndex&&l.push(c.tile.featureIndex.query({queryGeometry:c.queryGeometry,scale:c.scale,tileSize:c.tile.tileSize,bearing:a,params:r},e))}return function(t){for(var e=t[0]||{},i=1;i<t.length;i++){var n=t[i];for(var r in n){var o=n[r],a=e[r];if(void 0===a)a=e[r]=o;else for(var s=0;s<o.length;s++)a.push(o[s])}}return e}(l)},i.source=function(t,e){for(var i=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),n=[],o={},a=0;a<i.length;a++){var s=i[a],l=new r(Math.min(s.sourceMaxZoom,s.coord.z),s.coord.x,s.coord.y,0).id;o[l]||(o[l]=!0,s.querySourceFeatures(n,e))}return n}},{"./tile_coord":94}],89:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/ajax"),o=t("../util/evented"),a=t("./load_tilejson"),s=t("../util/mapbox").normalizeTileURL,l=function(t){function e(e,i,r,o){t.call(this),this.id=e,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.options=i,n.extend(this,n.pick(i,["url","scheme","tileSize"]))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),a(this.options,function(e,i){return e?t.fire("error",e):(n.extend(t,i),t.fire("data",{dataType:"source",sourceDataType:"metadata"}),void t.fire("data",{dataType:"source",sourceDataType:"content"}))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.serialize=function(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}},e.prototype.loadTile=function(t,e){var i=s(t.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);t.request=r.getImage(i,function(i,n){if(delete t.request,t.aborted)return this.state="unloaded",e(null);if(i)return this.state="errored",e(i);this.map._refreshExpiredTiles||t.setExpiryData(n),delete n.cacheControl,delete n.expires;var r=this.map.painter.gl;t.texture=this.map.painter.getTileTexture(n.width),t.texture?(r.bindTexture(r.TEXTURE_2D,t.texture),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,n)):(t.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,t.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),t.texture.size=n.width),r.generateMipmap(r.TEXTURE_2D),t.state="loaded",e(null)}.bind(this))},e.prototype.abortTile=function(t){t.request&&(t.request.abort(),delete t.request)},e.prototype.unloadTile=function(t){t.texture&&this.map.painter.saveTileTexture(t.texture)},e}(o);e.exports=l},{"../util/ajax":191,"../util/evented":200,"../util/mapbox":208,"../util/util":212,"./load_tilejson":86}],90:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("../util/evented"),o=t("../util/window"),a=!1,s=null;e.exports.evented=new r,e.exports.registerForPluginAvailability=function(t){return s?t(s,e.exports.errorCallback):e.exports.evented.once("pluginAvailable",t),t},e.exports.setRTLTextPlugin=function(t,i){if(a)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=!0,e.exports.errorCallback=i,n.getArrayBuffer(t,function(t,n){t?i(t):(s=o.URL.createObjectURL(new o.Blob([n.data]),{type:"text/javascript"}),e.exports.evented.fire("pluginAvailable",{pluginBlobURL:s,errorCallback:i}))})}},{"../util/ajax":191,"../util/evented":200,"../util/window":194}],91:[function(t,e,i){"use strict";var n=t("../util/util"),r={vector:t("../source/vector_tile_source"),raster:t("../source/raster_tile_source"),geojson:t("../source/geojson_source"),video:t("../source/video_source"),image:t("../source/image_source"),canvas:t("../source/canvas_source")};i.create=function(t,e,i,o){if((e=new r[e.type](t,e,i,o)).id!==t)throw new Error("Expected Source id to be "+t+" instead of "+e.id);return n.bindAll(["load","abort","unload","serialize","prepare"],e),e},i.getType=function(t){return r[t]},i.setType=function(t,e){r[t]=e}},{"../source/canvas_source":81,"../source/geojson_source":82,"../source/image_source":85,"../source/raster_tile_source":89,"../source/vector_tile_source":95,"../source/video_source":97,"../util/util":212}],92:[function(t,e,i){"use strict";function n(t,e,i){var n=i.zoomTo(Math.min(t.z,e));return{x:(n.column-(t.x+t.w*Math.pow(2,t.z)))*d,y:(n.row-t.y)*d}}function r(t,e){return t%32-e%32}var o=t("./source"),a=t("./tile"),s=t("../util/evented"),l=t("./tile_coord"),u=t("../util/lru_cache"),c=t("../geo/coordinate"),h=t("../util/util"),d=t("../data/extent"),f=function(t){function e(e,i,n){t.call(this),this.id=e,this.dispatcher=n,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("error",function(){this._sourceErrored=!0}),this._source=o.create(e,i,n,this),this._tiles={},this._cache=new u(0,this.unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._isIdRenderable=this._isIdRenderable.bind(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){this.map=t,this._source&&this._source.onAdd&&this._source.onAdd(t)},e.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},e.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},e.prototype.getSource=function(){return this._source},e.prototype.loadTile=function(t,e){return this._source.loadTile(t,e)},e.prototype.unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t)},e.prototype.abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t)},e.prototype.serialize=function(){return this._source.serialize()},e.prototype.prepare=function(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()},e.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(r)},e.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},e.prototype._isIdRenderable=function(t){return this._tiles[t].hasData()&&!this._coveredTiles[t]},e.prototype.reload=function(){for(var t in this._cache.reset(),this._tiles)this.reloadTile(t,"reloading")},e.prototype.reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this.loadTile(i,this._tileLoaded.bind(this,i,t,e)))},e.prototype._tileLoaded=function(t,e,i,n){return n?(t.state="errored",void this._source.fire("error",{tile:t,error:n})):(t.sourceCache=this,t.timeAdded=(new Date).getTime(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),this._source.fire("data",{dataType:"source",tile:t,coord:t.coord}),void(this.map&&(this.map.painter.tileExtentVAO.vao=null)))},e.prototype.getTile=function(t){return this.getTileByID(t.id)},e.prototype.getTileByID=function(t){return this._tiles[t]},e.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},e.prototype.findLoadedChildren=function(t,e,i){var n=this,r=!1;for(var o in n._tiles){var a=n._tiles[o];if(!(i[o]||!a.hasData()||a.coord.z<=t.z||a.coord.z>e)){var s=Math.pow(2,Math.min(a.coord.z,n._source.maxzoom)-Math.min(t.z,n._source.maxzoom));if(Math.floor(a.coord.x/s)===t.x&&Math.floor(a.coord.y/s)===t.y)for(i[o]=!0,r=!0;a&&a.coord.z-1>t.z;){var l=a.coord.parent(n._source.maxzoom).id;(a=n._tiles[l])&&a.hasData()&&(delete i[o],i[l]=!0)}}}return r},e.prototype.findLoadedParent=function(t,e,i){for(var n=this,r=t.z-1;r>=e;r--){t=t.parent(n._source.maxzoom);var o=n._tiles[t.id];if(o&&o.hasData())return i[t.id]=!0,o;if(n._cache.has(t.id))return i[t.id]=!0,n._cache.getWithoutRemoving(t.id)}},e.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/t.tileSize)+1)*(Math.ceil(t.height/t.tileSize)+1);this._cache.setMaxSize(Math.floor(5*e))},e.prototype.update=function(t){var i=this;if(this.transform=t,this._sourceLoaded){var n,r,o,a;this.updateCacheSize(t);var s,u=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),c=Math.max(u-e.maxOverzooming,this._source.minzoom),d=Math.max(u+e.maxUnderzooming,this._source.minzoom),f={};for(this._coveredTiles={},s=this.used?this._source.coord?[this._source.coord]:t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}):[],n=0;n<s.length;n++)r=s[n],o=i.addTile(r),f[r.id]=!0,o.hasData()||i.findLoadedChildren(r,d,f)||(a=i.findLoadedParent(r,c,f))&&i.addTile(a.coord);var p,m={};if(function(t){return"raster"===t||"image"===t||"video"===t}(this._source.type))for(var v=Object.keys(f),g=0;g<v.length;g++){var y=v[g];r=l.fromID(y),(o=i._tiles[y])&&(void 0===o.fadeEndTime||o.fadeEndTime>=Date.now())&&(i.findLoadedChildren(r,d,f)&&(f[y]=!0),(a=i.findLoadedParent(r,c,m))&&i.addTile(a.coord))}for(p in m)f[p]||(i._coveredTiles[p]=!0);for(p in m)f[p]=!0;var _=h.keysDifference(this._tiles,f);for(n=0;n<_.length;n++)i.removeTile(+_[n])}},e.prototype.addTile=function(t){var e=this._tiles[t.id];if(e)return e;var i=t.wrapped();(e=this._tiles[i.id])||(e=this._cache.get(i.id))&&(e.redoPlacement(this._source),this._cacheTimers[i.id]&&(clearTimeout(this._cacheTimers[i.id]),this._cacheTimers[i.id]=void 0,this._setTileReloadTimer(i.id,e)));var n=Boolean(e);if(!n){var r=t.z,o=r>this._source.maxzoom?Math.pow(2,r-this._source.maxzoom):1;e=new a(i,this._source.tileSize*o,this._source.maxzoom),this.loadTile(e,this._tileLoaded.bind(this,e,t.id,e.state))}return e.uses++,this._tiles[t.id]=e,n||this._source.fire("dataloading",{tile:e,coord:e.coord,dataType:"source"}),e},e.prototype._setTileReloadTimer=function(t,e){var i=this,n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){i.reloadTile(t,"expired"),i._timers[t]=void 0},n))},e.prototype._setCacheInvalidationTimer=function(t,e){var i=this,n=e.getExpiryTimeout();n&&(this._cacheTimers[t]=setTimeout(function(){i._cache.remove(t),i._cacheTimers[t]=void 0},n))},e.prototype.removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),this._timers[t]=void 0),!(e.uses>0)))if(e.hasData()){var i=e.coord.wrapped().id;this._cache.add(i,e),this._setCacheInvalidationTimer(i,e)}else e.aborted=!0,this.abortTile(e),this.unloadTile(e)},e.prototype.clearTiles=function(){for(var t in this._tiles)this.removeTile(t);this._cache.reset()},e.prototype.tilesIn=function(t){for(var e={},i=this.getIds(),r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0].zoom,h=0;h<t.length;h++){var f=t[h];r=Math.min(r,f.column),o=Math.min(o,f.row),a=Math.max(a,f.column),s=Math.max(s,f.row)}for(var p=0;p<i.length;p++){var m=this._tiles[i[p]],v=l.fromID(i[p]),g=[n(v,m.sourceMaxZoom,new c(r,o,u)),n(v,m.sourceMaxZoom,new c(a,s,u))];if(g[0].x<d&&g[0].y<d&&g[1].x>=0&&g[1].y>=0){for(var y=[],_=0;_<t.length;_++)y.push(n(v,m.sourceMaxZoom,t[_]));var b=e[m.coord.id];void 0===b&&(b=e[m.coord.id]={tile:m,coord:v,queryGeometry:[],scale:Math.pow(2,this.transform.zoom-m.coord.z)}),b.queryGeometry.push(y)}}var x=[];for(var w in e)x.push(e[w]);return x},e.prototype.redoPlacement=function(){for(var t=this.getIds(),e=0;e<t.length;e++){this.getTileByID(t[e]).redoPlacement(this._source)}},e.prototype.getVisibleCoordinates=function(){for(var t=this.getRenderableIds().map(l.fromID),e=0,i=t;e<i.length;e+=1){var n=i[e];n.posMatrix=this.transform.calculatePosMatrix(n,this._source.maxzoom)}return t},e}(s);f.maxOverzooming=10,f.maxUnderzooming=3,e.exports=f},{"../data/extent":54,"../geo/coordinate":61,"../util/evented":200,"../util/lru_cache":207,"../util/util":212,"./source":91,"./tile":93,"./tile_coord":94}],93:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../data/bucket"),o=t("../data/feature_index"),a=t("vector-tile"),s=t("pbf"),l=t("../util/vectortile_to_geojson"),u=t("../style-spec/feature_filter"),c=t("../symbol/collision_tile"),h=t("../symbol/collision_box"),d=function(t,e,i){this.coord=t,this.uid=n.uniqueId(),this.uses=0,this.tileSize=e,this.sourceMaxZoom=i,this.buckets={},this.expirationTime=null,this.expiredRequestCount=0,this.state="loading"};d.prototype.registerFadeDuration=function(t,e){var i=e+this.timeAdded;i<Date.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i,t.set(this.fadeEndTime-Date.now()))},d.prototype.loadVectorData=function(t,e){this.hasData()&&this.unloadVectorData(),this.state="loaded",t&&(t.rawTileData&&(this.rawTileData=t.rawTileData),this.collisionBoxArray=new h(t.collisionBoxArray),this.collisionTile=new c(t.collisionTile,this.collisionBoxArray),this.featureIndex=new o(t.featureIndex,this.rawTileData,this.collisionTile),this.buckets=r.deserialize(t.buckets,e.style))},d.prototype.reloadSymbolData=function(t,e){var i=this;if("unloaded"!==this.state){for(var o in this.collisionTile=new c(t.collisionTile,this.collisionBoxArray),this.featureIndex.setCollisionTile(this.collisionTile),i.buckets){var a=i.buckets[o];"symbol"===a.layers[0].type&&(a.destroy(),delete i.buckets[o])}n.extend(this.buckets,r.deserialize(t.buckets,e))}},d.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.collisionBoxArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},d.prototype.redoPlacement=function(t){var e=this;if("vector"===t.type||"geojson"===t.type)return"loaded"!==this.state?void(this.redoWhenDone=!0):void(this.collisionTile&&(this.state="reloading",t.dispatcher.send("redoPlacement",{type:t.type,uid:this.uid,source:t.id,angle:t.map.transform.angle,pitch:t.map.transform.pitch,showCollisionBoxes:t.map.showCollisionBoxes},function(i,n){e.reloadSymbolData(n,t.map.style),t.map&&(t.map.painter.tileExtentVAO.vao=null),e.state="loaded",e.redoWhenDone&&(e.redoWhenDone=!1,e.redoPlacement(t))},this.workerID)))},d.prototype.getBucket=function(t){return this.buckets[t.id]},d.prototype.querySourceFeatures=function(t,e){var i=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new a.VectorTile(new s(this.rawTileData)).layers);var n=this.vtLayers._geojsonTileLayer||this.vtLayers[e.sourceLayer];if(n)for(var r=u(e&&e.filter),o={z:this.coord.z,x:this.coord.x,y:this.coord.y},c=0;c<n.length;c++){var h=n.feature(c);if(r(h)){var d=new l(h,i.coord.z,i.coord.x,i.coord.y);d.tile=o,t.push(d)}}}},d.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},d.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=n.parseCacheControl(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),o=!1;if(this.expirationTime>r)o=!1;else if(e)if(this.expirationTime<e)o=!0;else{var a=this.expirationTime-e;a?this.expirationTime=r+Math.max(a,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},d.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},e.exports=d},{"../data/bucket":45,"../data/feature_index":55,"../style-spec/feature_filter":103,"../symbol/collision_box":160,"../symbol/collision_tile":162,"../util/util":212,"../util/vectortile_to_geojson":213,pbf:25,"vector-tile":34}],94:[function(t,e,i){"use strict";function n(t,e){if(t.row>e.row){var i=t;t=e,e=i}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function r(t,e,i,n,r){var o=Math.max(i,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=t.dx>0,h=e.dx<0,d=o;d<a;d++){var f=l*Math.max(0,Math.min(t.dy,d+c-t.y0))+t.x0,p=u*Math.max(0,Math.min(e.dy,d+h-e.y0))+e.x0;r(Math.floor(p),Math.ceil(f),d)}}function o(t,e,i,o,a,s){var l,u=n(t,e),c=n(e,i),h=n(i,t);u.dy>c.dy&&(l=u,u=c,c=l),u.dy>h.dy&&(l=u,u=h,h=l),c.dy>h.dy&&(l=c,c=h,h=l),u.dy&&r(h,u,o,a,s),c.dy&&r(h,c,o,a,s)}var a=t("@mapbox/whoots-js"),s=t("../geo/coordinate"),l=function(t,e,i,n){isNaN(n)&&(n=0),this.z=+t,this.x=+e,this.y=+i,this.w=+n,(n*=2)<0&&(n=-1*n-1);var r=1<<this.z;this.id=32*(r*r*n+r*this.y+this.x)+this.z,this.posMatrix=null};l.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},l.prototype.toCoordinate=function(t){var e=Math.min(this.z,void 0===t?this.z:t),i=Math.pow(2,e),n=this.y,r=this.x+i*this.w;return new s(r,n,e)},l.prototype.url=function(t,e,i){var n=a.getTileBBox(this.x,this.y,this.z),r=function(t,e,i){for(var n,r="",o=t;o>0;o--)r+=(e&(n=1<<o-1)?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,e||this.z)).replace("{x}",this.x).replace("{y}","tms"===i?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",r).replace("{bbox-epsg-3857}",n)},l.prototype.parent=function(t){return 0===this.z?null:this.z>t?new l(this.z-1,this.x,this.y,this.w):new l(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},l.prototype.wrapped=function(){return new l(this.z,this.x,this.y,0)},l.prototype.children=function(t){if(this.z>=t)return[new l(this.z+1,this.x,this.y,this.w)];var e=this.z+1,i=2*this.x,n=2*this.y;return[new l(e,i,n,this.w),new l(e,i+1,n,this.w),new l(e,i,n+1,this.w),new l(e,i+1,n+1,this.w)]},l.cover=function(t,e,i,n){function r(t,e,r){var o,u,c;if(r>=0&&r<=a)for(o=t;o<e;o++)0!==(u=Math.floor(o/a))&&!0!==n||(c=new l(i,(o%a+a)%a,r,u),s[c.id]=c)}void 0===n&&(n=!0);var a=1<<t,s={};return o(e[0],e[1],e[2],0,a,r),o(e[2],e[3],e[0],0,a,r),Object.keys(s).map(function(t){return s[t]})},l.fromID=function(t){var e=t%32,i=1<<e,n=(t-e)/32,r=n%i,o=(n-r)/i%i,a=Math.floor(n/(i*i));return a%2!=0&&(a=-1*a-1),new l(e,r,o,a/=2)},e.exports=l},{"../geo/coordinate":61,"@mapbox/whoots-js":4}],95:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("../util/util"),o=t("./load_tilejson"),a=t("../util/mapbox").normalizeTileURL,s=function(t){function e(e,i,n,o){if(t.call(this),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,r.extend(this,r.pick(i,["url","scheme","tileSize"])),this._options=r.extend({type:"vector"},i),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),o(this._options,function(e,i){return e?void t.fire("error",e):(r.extend(t,i),t.fire("data",{dataType:"source",sourceDataType:"metadata"}),void t.fire("data",{dataType:"source",sourceDataType:"content"}))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.serialize=function(){return r.extend({},this._options)},e.prototype.loadTile=function(t,e){function i(i,n){if(!t.aborted){if(i)return e(i);this.map._refreshExpiredTiles||t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(this)),e(null),t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)}}var n=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={url:a(t.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:t.uid,coord:t.coord,zoom:t.coord.z,tileSize:this.tileSize*n,type:this.type,source:this.id,overscaling:n,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",r,i.bind(this),t.workerID):t.workerID=this.dispatcher.send("loadTile",r,i.bind(this))},e.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e}(n);e.exports=s},{"../util/evented":200,"../util/mapbox":208,"../util/util":212,"./load_tilejson":86}],96:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("vector-tile"),o=t("pbf"),a=t("./worker_tile"),s=t("../util/util"),l=function(t,e,i){this.actor=t,this.layerIndex=e,i&&(this.loadVectorData=i),this.loading={},this.loaded={}};l.prototype.loadTile=function(t,e){var i=t.source,n=t.uid;this.loading[i]||(this.loading[i]={});var r=this.loading[i][n]=new a(t);r.abort=this.loadVectorData(t,function(t,o){return delete this.loading[i][n],t?e(t):o?(r.vectorTile=o,r.parse(o,this.layerIndex,this.actor,function(t,i,n){if(t)return e(t);var r={};o.expires&&(r.expires=o.expires),o.cacheControl&&(r.cacheControl=o.cacheControl),e(null,s.extend({rawTileData:o.rawData},i,r),n)}),this.loaded[i]=this.loaded[i]||{},void(this.loaded[i][n]=r)):e(null,null)}.bind(this))},l.prototype.reloadTile=function(t,e){var i=this.loaded[t.source],n=t.uid,r=this;if(i&&i[n]){var o=i[n];"parsing"===o.status?o.reloadCallback=e:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,function(t,i){if(this.reloadCallback){var n=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,r.layerIndex,r.actor,n)}e(t,i)}.bind(o))}},l.prototype.abortTile=function(t){var e=this.loading[t.source],i=t.uid;e&&e[i]&&e[i].abort&&(e[i].abort(),delete e[i])},l.prototype.removeTile=function(t){var e=this.loaded[t.source],i=t.uid;e&&e[i]&&delete e[i]},l.prototype.loadVectorData=function(t,e){var i=n.getArrayBuffer(t.url,function(t,i){if(t)return e(t);var n=new r.VectorTile(new o(i.data));n.rawData=i.data,n.cacheControl=i.cacheControl,n.expires=i.expires,e(t,n)}.bind(this));return function(){i.abort()}},l.prototype.redoPlacement=function(t,e){var i=this.loaded[t.source],n=this.loading[t.source],r=t.uid;if(i&&i[r]){var o=i[r].redoPlacement(t.angle,t.pitch,t.showCollisionBoxes);o.result&&e(null,o.result,o.transferables)}else n&&n[r]&&(n[r].angle=t.angle)},e.exports=l},{"../util/ajax":191,"../util/util":212,"./worker_tile":99,pbf:25,"vector-tile":34}],97:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.roundZoom=!0,this.type="video",this.options=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=e.urls,n.getVideo(e.urls,function(e,i){if(e)return t.fire("error",{error:e});var n;t.video=i,t.video.loop=!0,t.video.addEventListener("playing",function(){n=t.map.style.animationLoop.set(1/0),t.map._rerender()}),t.video.addEventListener("pause",function(){t.map.style.animationLoop.cancel(n)}),t.map&&t.video.play(),t._finishLoading()})},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.load(),this.map=t,this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){!this.tile||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e}(t("./image_source"));e.exports=r},{"../util/ajax":191,"./image_source":85}],98:[function(t,e,i){"use strict";var n=t("../util/actor"),r=t("../style/style_layer_index"),o=t("./vector_tile_worker_source"),a=t("./geojson_worker_source"),s=t("./rtl_text_plugin"),l=function(t){var e=this;this.self=t,this.actor=new n(t,this),this.layerIndexes={},this.workerSourceTypes={vector:o,geojson:a},this.workerSources={},this.self.registerWorkerSource=function(t,i){if(e.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');e.workerSourceTypes[t]=i},this.self.registerRTLTextPlugin=function(t){if(s.applyArabicShaping||s.processBidirectionalText)throw new Error("RTL text plugin already registered.");s.applyArabicShaping=t.applyArabicShaping,s.processBidirectionalText=t.processBidirectionalText}};l.prototype.setLayers=function(t,e){this.getLayerIndex(t).replace(e)},l.prototype.updateLayers=function(t,e){this.getLayerIndex(t).update(e.layers,e.removedIds,e.symbolOrder)},l.prototype.loadTile=function(t,e,i){this.getWorkerSource(t,e.type).loadTile(e,i)},l.prototype.reloadTile=function(t,e,i){this.getWorkerSource(t,e.type).reloadTile(e,i)},l.prototype.abortTile=function(t,e){this.getWorkerSource(t,e.type).abortTile(e)},l.prototype.removeTile=function(t,e){this.getWorkerSource(t,e.type).removeTile(e)},l.prototype.removeSource=function(t,e){var i=this.getWorkerSource(t,e.type);void 0!==i.removeSource&&i.removeSource(e)},l.prototype.redoPlacement=function(t,e,i){this.getWorkerSource(t,e.type).redoPlacement(e,i)},l.prototype.loadWorkerSource=function(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t)}},l.prototype.loadRTLTextPlugin=function(t,e,i){try{s.applyArabicShaping||s.processBidirectionalText||this.self.importScripts(e)}catch(t){i(t)}},l.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},l.prototype.getWorkerSource=function(t,e){var i=this;if(this.workerSources[t]||(this.workerSources[t]={}),!this.workerSources[t][e]){var n={send:function(e,n,r,o){i.actor.send(e,n,r,o,t)}};this.workerSources[t][e]=new this.workerSourceTypes[e](n,this.getLayerIndex(t))}return this.workerSources[t][e]},e.exports=function(t){return new l(t)}},{"../style/style_layer_index":154,"../util/actor":190,"./geojson_worker_source":83,"./rtl_text_plugin":90,"./vector_tile_worker_source":96}],99:[function(t,e,i){"use strict";function n(t,e){for(var i=0,n=t.layers;i<n.length;i+=1){n[i].recalculate(e)}}function r(t,e){return t.filter(function(t){return!t.isEmpty()}).map(function(t){return t.serialize(e)})}var o=t("../data/feature_index"),a=t("../symbol/collision_tile"),s=t("../symbol/collision_box"),l=t("../util/dictionary_coder"),u=t("../util/util"),c=function(t){this.coord=t.coord,this.uid=t.uid,this.zoom=t.zoom,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.angle=t.angle,this.pitch=t.pitch,this.showCollisionBoxes=t.showCollisionBoxes};c.prototype.parse=function(t,e,i,c){var h=this;t.layers||(t={layers:{_geojsonTileLayer:t}}),this.status="parsing",this.data=t,this.collisionBoxArray=new s;var d=new l(Object.keys(t.layers).sort()),f=new o(this.coord,this.overscaling);f.bucketLayerIDs={};var p={},m=0,v={featureIndex:f,iconDependencies:{},glyphDependencies:{}},g=e.familiesBySource[this.source];for(var y in g){var _=t.layers[y];if(_){1===_.version&&u.warnOnce('Vector tile source "'+h.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var b=d.encode(y),x=[],w=0;w<_.length;w++){var S=_.feature(w);S.index=w,S.sourceLayerIndex=b,x.push(S)}for(var M=0,E=g[y];M<E.length;M+=1){var z=E[M],k=z[0];if(!(k.minzoom&&h.zoom<k.minzoom||k.maxzoom&&h.zoom>=k.maxzoom||k.layout&&"none"===k.layout.visibility)){for(var T=0,O=z;T<O.length;T+=1){O[T].recalculate(h.zoom)}(p[k.id]=k.createBucket({index:m,layers:z,zoom:h.zoom,overscaling:h.overscaling,collisionBoxArray:h.collisionBoxArray})).populate(x,v),f.bucketLayerIDs[m]=z.map(function(t){return t.id}),m++}}}}var C=function(t){for(var e in h.status="done",f.paintPropertyStatistics={},p)u.extend(f.paintPropertyStatistics,p[e].getPaintPropertyStatistics());var i=[];c(null,{buckets:r(u.values(p),i),featureIndex:f.serialize(i),collisionTile:t.serialize(i),collisionBoxArray:h.collisionBoxArray.serialize()},i)};this.symbolBuckets=[];for(var P=e.symbolOrder.length-1;P>=0;P--){var A=p[e.symbolOrder[P]];A&&h.symbolBuckets.push(A)}if(0===this.symbolBuckets.length)return C(new a(this.angle,this.pitch,this.collisionBoxArray));var I=0,L=Object.keys(v.iconDependencies),D=u.mapObject(v.glyphDependencies,function(t){return Object.keys(t).map(Number)}),R=function(t){if(t)return c(t);if(2===++I){for(var e=new a(h.angle,h.pitch,h.collisionBoxArray),i=0,r=h.symbolBuckets;i<r.length;i+=1){var o=r[i];n(o,h.zoom),o.prepare(D,L),o.place(e,h.showCollisionBoxes)}C(e)}};Object.keys(D).length?i.send("getGlyphs",{uid:this.uid,stacks:D},function(t,e){D=e,R(t)}):R(),L.length?i.send("getIcons",{icons:L},function(t,e){L=e,R(t)}):R()},c.prototype.redoPlacement=function(t,e,i){if(this.angle=t,this.pitch=e,"done"!==this.status)return{};for(var o=new a(this.angle,this.pitch,this.collisionBoxArray),s=0,l=this.symbolBuckets;s<l.length;s+=1){var u=l[s];n(u,this.zoom),u.place(o,i)}var c=[];return{result:{buckets:r(this.symbolBuckets,c),collisionTile:o.serialize(c)},transferables:c}},e.exports=c},{"../data/feature_index":55,"../symbol/collision_box":160,"../symbol/collision_tile":162,"../util/dictionary_coder":197,"../util/util":212}],100:[function(t,e,i){"use strict";function n(t,e){var i={};for(var n in t)"ref"!==n&&(i[n]=t[n]);return r.forEach(function(t){t in e&&(i[t]=e[t])}),i}var r=t("./util/ref_properties");e.exports=function(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=n(t[r],e[t[r].ref]));return t}},{"./util/ref_properties":122}],101:[function(t,e,i){"use strict";function n(t,e,i,n,r,o){var s;for(s in t=t||{},e=e||{},t)t.hasOwnProperty(s)&&(a(t[s],e[s])||i.push({command:o,args:[n,s,e[s],r]}));for(s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(a(t[s],e[s])||i.push({command:o,args:[n,s,e[s],r]}))}function r(t){return t.id}function o(t,e){return t[e.id]=e,t}var a=t("lodash.isequal"),s={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};e.exports=function(t,e){if(!t)return[{command:s.setStyle,args:[e]}];var i=[];try{if(!a(t.version,e.version))return[{command:s.setStyle,args:[e]}];a(t.center,e.center)||i.push({command:s.setCenter,args:[e.center]}),a(t.zoom,e.zoom)||i.push({command:s.setZoom,args:[e.zoom]}),a(t.bearing,e.bearing)||i.push({command:s.setBearing,args:[e.bearing]}),a(t.pitch,e.pitch)||i.push({command:s.setPitch,args:[e.pitch]}),a(t.sprite,e.sprite)||i.push({command:s.setSprite,args:[e.sprite]}),a(t.glyphs,e.glyphs)||i.push({command:s.setGlyphs,args:[e.glyphs]}),a(t.transition,e.transition)||i.push({command:s.setTransition,args:[e.transition]}),a(t.light,e.light)||i.push({command:s.setLight,args:[e.light]});var l={},u=[];!function(t,e,i,n){var r;for(r in t=t||{},e=e||{},t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||(i.push({command:s.removeSource,args:[r]}),n[r]=!0));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?a(t[r],e[r])||(i.push({command:s.removeSource,args:[r]}),i.push({command:s.addSource,args:[r,e[r]]}),n[r]=!0):i.push({command:s.addSource,args:[r,e[r]]}))}(t.sources,e.sources,u,l);var c=[];t.layers&&t.layers.forEach(function(t){l[t.source]?i.push({command:s.removeLayer,args:[t.id]}):c.push(t)}),i=i.concat(u),function(t,e,i){t=t||[],e=e||[];var l,u,c,h,d,f,p,m=t.map(r),v=e.map(r),g=t.reduce(o,{}),y=e.reduce(o,{}),_=m.slice(),b=Object.create(null);for(l=0,u=0;l<m.length;l++)c=m[l],y.hasOwnProperty(c)?u++:(i.push({command:s.removeLayer,args:[c]}),_.splice(_.indexOf(c,u),1));for(l=0,u=0;l<v.length;l++)c=v[v.length-1-l],_[_.length-1-l]!==c&&(g.hasOwnProperty(c)?(i.push({command:s.removeLayer,args:[c]}),_.splice(_.lastIndexOf(c,_.length-u),1)):u++,f=_[_.length-l],i.push({command:s.addLayer,args:[y[c],f]}),_.splice(_.length-l,0,c),b[c]=!0);for(l=0;l<v.length;l++)if(h=g[c=v[l]],d=y[c],!b[c]&&!a(h,d))if(a(h.source,d.source)&&a(h["source-layer"],d["source-layer"])&&a(h.type,d.type)){for(p in n(h.layout,d.layout,i,c,null,s.setLayoutProperty),n(h.paint,d.paint,i,c,null,s.setPaintProperty),a(h.filter,d.filter)||i.push({command:s.setFilter,args:[c,d.filter]}),a(h.minzoom,d.minzoom)&&a(h.maxzoom,d.maxzoom)||i.push({command:s.setLayerZoomRange,args:[c,d.minzoom,d.maxzoom]}),h)h.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?n(h[p],d[p],i,c,p.slice(6),s.setPaintProperty):a(h[p],d[p])||i.push({command:s.setLayerProperty,args:[c,p,d[p]]}));for(p in d)d.hasOwnProperty(p)&&!h.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?n(h[p],d[p],i,c,p.slice(6),s.setPaintProperty):a(h[p],d[p])||i.push({command:s.setLayerProperty,args:[c,p,d[p]]}))}else i.push({command:s.removeLayer,args:[c]}),f=_[_.lastIndexOf(c)+1],i.push({command:s.addLayer,args:[d,f]})}(c,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:s.setStyle,args:[e]}]}return i},e.exports.operations=s},{"lodash.isequal":114}],102:[function(t,e,i){"use strict";var n=t("util").format;e.exports=function(t,e){this.message=(t?t+": ":"")+n.apply(n,Array.prototype.slice.call(arguments,2)),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__)}},{util:33}],103:[function(t,e,i){"use strict";function n(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?o(t[1],t[2],"===",!1):"!="===e?o(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?o(t[1],t[2],e,!0):"any"===e?a(t.slice(1),"||"):"all"===e?a(t.slice(1),"&&"):"none"===e?u(a(t.slice(1),"||")):"in"===e?s(t[1],t.slice(2)):"!in"===e?u(s(t[1],t.slice(2))):"has"===e?l(t[1]):"!has"===e?u(l(t[1])):"true")+")"}function r(t){return"$type"===t?"f.type":"$id"===t?"f.id":"p["+JSON.stringify(t)+"]"}function o(t,e,i,n){var o=r(t),a="$type"===t?h.indexOf(e):JSON.stringify(e);return(n?"typeof "+o+"=== typeof "+a+"&&":"")+o+i+a}function a(t,e){return t.map(n).join(e)}function s(t,e){"$type"===t&&(e=e.map(function(t){return h.indexOf(t)}));var i=JSON.stringify(e.sort(c)),n=r(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function l(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function u(t){return"!("+t+")"}function c(t,e){return t<e?-1:t>e?1:0}e.exports=function(t){return new Function("f","var p = (f && f.properties || {}); return "+n(t))};var h=["Unknown","Point","LineString","Polygon"]},{}],104:[function(t,e,i){"use strict";function n(t){return t>m?Math.pow(t,1/3):t/p+d}function r(t){return t>f?t*t*t:p*(t-d)}function o(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function a(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function s(t){var e=a(t[0]),i=a(t[1]),r=a(t[2]),o=n((.4124564*e+.3575761*i+.1804375*r)/u),s=n((.2126729*e+.7151522*i+.072175*r)/c);return[116*s-16,500*(o-s),200*(s-n((.0193339*e+.119192*i+.9503041*r)/h)),t[3]]}function l(t){var e=(t[0]+16)/116,i=isNaN(t[1])?e:e+t[1]/500,n=isNaN(t[2])?e:e-t[2]/200;return e=c*r(e),[o(3.2404542*(i=u*r(i))-1.5371385*e-.4985314*(n=h*r(n))),o(-.969266*i+1.8760108*e+.041556*n),o(.0556434*i-.2040259*e+1.0572252*n),t[3]]}var u=.95047,c=1,h=1.08883,d=4/29,f=6/29,p=3*f*f,m=f*f*f,v=Math.PI/180,g=180/Math.PI;e.exports={lab:{forward:s,reverse:l},hcl:{forward:function(t){var e=s(t),i=e[0],n=e[1],r=e[2],o=Math.atan2(r,n)*g;return[o<0?o+360:o,Math.sqrt(n*n+r*r),i,t[3]]},reverse:function(t){var e=t[0]*v,i=t[1];return l([t[2],Math.cos(e)*i,Math.sin(e)*i,t[3]])}}}},{}],105:[function(t,e,i){"use strict";function n(t){return t}function r(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function o(t,e,i,n,o){return r(typeof i===o?n[i]:void 0,t.default,e.default)}function a(t,e,i){if("number"!==m(i))return r(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];var o=u(t.stops,i);return t.stops[o][1]}function s(t,e,i){var n=void 0!==t.base?t.base:1;if("number"!==m(i))return r(t.default,e.default);var o=t.stops.length;if(1===o)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];var a=u(t.stops,i);return function t(e,i,n,r,o,a){return"function"==typeof o?function(){var s=o.apply(void 0,arguments),l=a.apply(void 0,arguments);if(void 0!==s&&void 0!==l)return t(e,i,n,r,s,l)}:o.length?function(t,e,i,n,r,o){for(var a=[],s=0;s<r.length;s++)a[s]=c(t,e,i,n,r[s],o[s]);return a}(e,i,n,r,o,a):c(e,i,n,r,o,a)}(i,n,t.stops[a][0],t.stops[a+1][0],t.stops[a][1],t.stops[a+1][1])}function l(t,e,i){return"color"===e.type?i=f(i):m(i)!==e.type&&(i=void 0),r(i,t.default,e.default)}function u(t,e){for(var i,n,r=0,o=t.length-1,a=0;r<=o;){if(i=t[a=Math.floor((r+o)/2)][0],n=t[a+1][0],e>=i&&e<n)return a;i<e?r=a+1:i>e&&(o=a-1)}return Math.max(a-1,0)}function c(t,e,i,n,r,o){var a,s=n-i,l=t-i;return r*(1-(a=1===e?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1)))+o*a}function h(t){return"object"==typeof t&&(t.stops||"identity"===t.type)}var d=t("./color_spaces"),f=t("../util/parse_color"),p=t("../util/extend"),m=t("../util/get_type");e.exports=function t(e,i){var u,c="color"===i.type;if(h(e)){var m,v,g,y,_=e.stops&&"object"==typeof e.stops[0][0],b=_||void 0!==e.property,x=_||!b,w=e.type||("interpolated"===i.function?"exponential":"interval");if(c&&((e=p({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],f(t[1])]})),e.default?e.default=f(e.default):e.default=f(i.default)),"exponential"===w)m=s;else if("interval"===w)m=a;else if("categorical"===w){m=o,v=Object.create(null);for(var S=0,M=e.stops;S<M.length;S+=1){var E=M[S];v[E[0]]=E[1]}g=typeof e.stops[0][0]}else{if("identity"!==w)throw new Error('Unknown function type "'+w+'"');m=l}if(e.colorSpace&&"rgb"!==e.colorSpace){if(!d[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);var z=d[e.colorSpace];e=JSON.parse(JSON.stringify(e));for(var k=0;k<e.stops.length;k++)e.stops[k]=[e.stops[k][0],z.forward(e.stops[k][1])];y=z.reverse}else y=n;if(_){for(var T={},O=[],C=0;C<e.stops.length;C++){var P=e.stops[C];void 0===T[P[0].zoom]&&(T[P[0].zoom]={zoom:P[0].zoom,type:e.type,property:e.property,stops:[]}),T[P[0].zoom].stops.push([P[0].value,P[1]])}for(var A in T)O.push([T[A].zoom,t(T[A],i)]);(u=function(t,n){return y(s({stops:O,base:e.base},i,t)(t,n))}).isFeatureConstant=!1,u.isZoomConstant=!1}else x?((u=function(t){return y(m(e,i,t,v,g))}).isFeatureConstant=!0,u.isZoomConstant=!1):((u=function(t,n){var o=n[e.property];return void 0===o?r(e.default,i.default):y(m(e,i,o,v,g))}).isFeatureConstant=!1,u.isZoomConstant=!0)}else c&&e&&(e=f(e)),(u=function(){return e}).isFeatureConstant=!0,u.isZoomConstant=!0;return u},e.exports.isFunctionDefinition=h},{"../util/extend":119,"../util/get_type":120,"../util/parse_color":121,"./color_spaces":104}],106:[function(t,e,i){"use strict";function n(t){return o(r.map(function(e){return t[e]}))}var r=t("./util/ref_properties"),o=t("fast-stable-stringify");e.exports=function(t){for(var e={},i=0;i<t.length;i++){var r=n(t[i]),o=e[r];o||(o=e[r]=[]),o.push(t[i])}var a=[];for(var s in e)a.push(e[s]);return a}},{"./util/ref_properties":122,"fast-stable-stringify":108}],107:[function(t,e,i){function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function a(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{i.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in s)return s[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),u=i.indexOf(")");if(-1!==l&&u+1===i.length){var c=i.substr(0,l),h=i.substr(l+1,u-(l+1)).split(","),d=1;switch(c){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=o(h[1]),m=o(h[2]),v=m<=.5?m*(p+1):m+p-m*p,g=2*m-v;return[n(255*a(g,v,f+1/3)),n(255*a(g,v,f)),n(255*a(g,v,f-1/3)),d];default:return null}}return null}}catch(t){}},{}],108:[function(t,e,i){var n={}.toString,r=Array.isArray||function(t){return"[object Array]"===n.call(t)},o=Object.keys||function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},a=/[\u0000-\u001f"\\]/g,s=function(t){var e=t.charCodeAt(0);switch(e){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return e>15?"\\u00"+e.toString(16):"\\u000"+e.toString(16)}};e.exports=function(t){if(void 0!==t)return""+function t(e){var i,n,l,u,c,h;switch(typeof e){case"object":if(null===e)return null;if(r(e)){for(l="[",n=e.length-1,i=0;i<n;i++)l+=t(e[i])+",";return n>-1&&(l+=t(e[i])),l+"]"}for(n=(u=o(e).sort()).length,l="{",c=u[i=0],h=n>0&&void 0!==e[c];i<n;)h?(l+='"'+c.replace(a,s)+'":'+t(e[c]),c=u[++i],(h=i<n&&void 0!==e[c])&&(l+=",")):(c=u[++i],h=i<n&&void 0!==e[c]);return l+"}";case"undefined":return null;case"string":return'"'+e.replace(a,s)+'"';default:return e}}(t)},e.exports.stringSearch=a,e.exports.stringReplace=s},{}],109:[function(t,e,i){function n(t,e){for(var i=-1,n=t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}var r=t("lodash.isarray"),o=t("lodash.istypedarray"),a=t("lodash.keys"),s="[object Arguments]",l="[object Array]",u="[object Boolean]",c="[object Date]",h="[object Error]",d="[object Number]",f="[object Object]",p="[object RegExp]",m="[object String]",v=Object.prototype,g=v.hasOwnProperty,y=v.toString;e.exports=function t(e,i,v,_,b,x){return e===i||(null==e||null==i||!function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(e)&&!function(t){return!!t&&"object"==typeof t}(i)?e!=e&&i!=i:function(t,e,i,v,_,b,x){var w=r(t),S=r(e),M=l,E=l;w||((M=y.call(t))==s?M=f:M!=f&&(w=o(t))),S||((E=y.call(e))==s?E=f:E!=f&&(S=o(e)));var z=M==f,k=E==f,T=M==E;if(T&&!w&&!z)return function(t,e,i){switch(i){case u:case c:return+t==+e;case h:return t.name==e.name&&t.message==e.message;case d:return t!=+t?e!=+e:t==+e;case p:case m:return t==e+""}return!1}(t,e,M);if(!_){var O=z&&g.call(t,"__wrapped__"),C=k&&g.call(e,"__wrapped__");if(O||C)return i(O?t.value():t,C?e.value():e,v,_,b,x)}if(!T)return!1;b||(b=[]),x||(x=[]);for(var P=b.length;P--;)if(b[P]==t)return x[P]==e;b.push(t),x.push(e);var A=(w?function(t,e,i,r,o,a,s){var l=-1,u=t.length,c=e.length;if(u!=c&&!(o&&c>u))return!1;for(;++l<u;){var h=t[l],d=e[l],f=r?r(o?d:h,o?h:d,l):void 0;if(void 0!==f){if(f)continue;return!1}if(o){if(!n(e,function(t){return h===t||i(h,t,r,o,a,s)}))return!1}else if(h!==d&&!i(h,d,r,o,a,s))return!1}return!0}:function(t,e,i,n,r,o,s){var l=a(t),u=l.length,c=a(e).length;if(u!=c&&!r)return!1;for(var h=u;h--;){var d=l[h];if(!(r?d in e:g.call(e,d)))return!1}for(var f=r;++h<u;){d=l[h];var p=t[d],m=e[d],v=n?n(r?m:p,r?p:m,d):void 0;if(!(void 0===v?i(p,m,n,r,o,s):v))return!1;f||(f="constructor"==d)}if(!f){var y=t.constructor,_=e.constructor;if(y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _))return!1}return!0})(t,e,i,v,_,b,x);return b.pop(),x.pop(),A}(e,i,t,v,_,b,x))}},{"lodash.isarray":113,"lodash.istypedarray":115,"lodash.keys":116}],110:[function(t,e,i){function n(t){return t}e.exports=function(t,e,i){if("function"!=typeof t)return n;if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,o){return t.call(e,i,n,r,o)};case 5:return function(i,n,r,o,a){return t.call(e,i,n,r,o,a)}}return function(){return t.apply(e,arguments)}}},{}],111:[function(t,e,i){var n="[object Function]",r=/^\[object .+?Constructor\]$/,o=Object.prototype,a=Function.prototype.toString,s=o.hasOwnProperty,l=o.toString,u=RegExp("^"+a.call(s).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(t,e){var i=null==t?void 0:t[e];return function(t){return null!=t&&(function(t){return function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)&&l.call(t)==n}(t)?u.test(a.call(t)):function(t){return!!t&&"object"==typeof t}(t)&&r.test(t))}(i)?i:void 0}},{}],112:[function(t,e,i){var n=9007199254740991,r="[object Arguments]",o="[object Function]",a="[object GeneratorFunction]",s=Object.prototype,l=s.hasOwnProperty,u=s.toString,c=s.propertyIsEnumerable;e.exports=function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?u.call(t):"";return e==o||e==a}(t)}(t)}(t)&&l.call(t,"callee")&&(!c.call(t,"callee")||u.call(t)==r)}},{}],113:[function(t,e,i){function n(t){return!!t&&"object"==typeof t}var r,o,a="[object Function]",s=/^\[object .+?Constructor\]$/,l=Object.prototype,u=Function.prototype.toString,c=l.hasOwnProperty,h=l.toString,d=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),f=9007199254740991,p=(r=Array,function(t){return null!=t&&(function(t){return function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)&&h.call(t)==a}(t)?d.test(u.call(t)):n(t)&&s.test(t))}(o=null==r?void 0:r["isArray"])?o:void 0)||function(t){return n(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=f}(t.length)&&"[object Array]"==h.call(t)};e.exports=p},{}],114:[function(t,e,i){var n=t("lodash._baseisequal"),r=t("lodash._bindcallback");e.exports=function(t,e,i,o){var a=(i="function"==typeof i?r(i,o,3):void 0)?i(t,e):void 0;return void 0===a?n(t,e,i):!!a}},{"lodash._baseisequal":109,"lodash._bindcallback":110}],115:[function(t,e,i){var n=9007199254740991,r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1;var o=Object.prototype.toString;e.exports=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!!r[o.call(t)]}},{}],116:[function(t,e,i){function n(t,e){return t="number"==typeof t||h.test(t)?+t:-1,e=null==e?p:e,t>-1&&t%1==0&&t<e}function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function o(t){for(var e=function(t){if(null==t)return[];a(t)||(t=Object(t));var e=t.length;e=e&&r(e)&&(c(t)||u(t))&&e||0;for(var i=t.constructor,o=-1,s="function"==typeof i&&i.prototype===t,l=Array(e),h=e>0;++o<e;)l[o]=o+"";for(var f in t)h&&n(f,e)||"constructor"==f&&(s||!d.call(t,f))||l.push(f);return l}(t),i=e.length,o=i&&t.length,s=!!o&&r(o)&&(c(t)||u(t)),l=-1,h=[];++l<i;){var f=e[l];(s&&n(f,o)||d.call(t,f))&&h.push(f)}return h}function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var s,l=t("lodash._getnative"),u=t("lodash.isarguments"),c=t("lodash.isarray"),h=/^\d+$/,d=Object.prototype.hasOwnProperty,f=l(Object,"keys"),p=9007199254740991,m=(s="length",function(t){return null==t?void 0:t[s]}),v=f?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&function(t){return null!=t&&r(m(t))}(t)?o(t):a(t)?f(t):[]}:o;e.exports=v},{"lodash._getnative":111,"lodash.isarguments":112,"lodash.isarray":113}],117:[function(t,e,i){"use strict";e.exports=t("./v8.json")},{"./v8.json":118}],118:[function(t,e,i){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image","source_canvas"],source_tile:{type:{required:!0,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_canvas:{type:{required:!0,type:"enum",values:{canvas:{}}},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},animate:{type:"boolean",default:"true"},canvas:{type:"string",required:!0}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"milliseconds"}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],119:[function(t,e,i){"use strict";e.exports=function(t){for(var e=arguments,i=1;i<arguments.length;i++){var n=e[i];for(var r in n)t[r]=n[r]}return t}},{}],120:[function(t,e,i){"use strict";e.exports=function(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}},{}],121:[function(t,e,i){"use strict";var n=t("csscolorparser").parseCSSColor;e.exports=function(t){if("string"==typeof t){var e=n(t);if(!e)return;return[e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]]}return Array.isArray(t)?t:void 0}},{csscolorparser:107}],122:[function(t,e,i){"use strict";e.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],123:[function(t,e,i){"use strict";e.exports=function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}},{}],124:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),o=t("../util/extend");e.exports=function(e){var i=t("./validate_function"),a=t("./validate_object"),s={"*":function(){return[]},array:t("./validate_array"),boolean:t("./validate_boolean"),number:t("./validate_number"),color:t("./validate_color"),constants:t("./validate_constants"),enum:t("./validate_enum"),filter:t("./validate_filter"),function:t("./validate_function"),layer:t("./validate_layer"),object:t("./validate_object"),source:t("./validate_source"),light:t("./validate_light"),string:t("./validate_string")},l=e.value,u=e.valueSpec,c=e.key,h=e.styleSpec,d=e.style;if("string"===r(l)&&"@"===l[0]){if(h.$version>7)return[new n(c,l,"constants have been deprecated as of v8")];if(!(l in d.constants))return[new n(c,l,'constant "%s" not found',l)];e=o({},e,{value:d.constants[l]})}return u.function&&"object"===r(l)?i(e):u.type&&s[u.type]?s[u.type](e):a(o({},e,{valueSpec:u.type?h[u.type]:u}))}},{"../error/validation_error":102,"../util/extend":119,"../util/get_type":120,"./validate_array":125,"./validate_boolean":126,"./validate_color":127,"./validate_constants":128,"./validate_enum":129,"./validate_filter":130,"./validate_function":131,"./validate_layer":133,"./validate_light":135,"./validate_number":136,"./validate_object":137,"./validate_source":140,"./validate_string":141}],125:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("./validate"),o=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.valueSpec,a=t.style,s=t.styleSpec,l=t.key,u=t.arrayElementValidator||r;if("array"!==n(e))return[new o(l,e,"array expected, %s found",n(e))];if(i.length&&e.length!==i.length)return[new o(l,e,"array length %d expected, length %d found",i.length,e.length)];if(i["min-length"]&&e.length<i["min-length"])return[new o(l,e,"array length at least %d expected, length %d found",i["min-length"],e.length)];var c={type:i.value};s.$version<7&&(c.function=i.function),"object"===n(i.value)&&(c=i.value);for(var h=[],d=0;d<e.length;d++)h=h.concat(u({array:e,arrayIndex:d,value:e[d],valueSpec:c,style:a,styleSpec:s,key:l+"["+d+"]"}));return h}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],126:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.key,o=n(e);return"boolean"!==o?[new r(i,e,"boolean expected, %s found",o)]:[]}},{"../error/validation_error":102,"../util/get_type":120}],127:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),o=t("csscolorparser").parseCSSColor;e.exports=function(t){var e=t.key,i=t.value,a=r(i);return"string"!==a?[new n(e,i,"color expected, %s found",a)]:null===o(i)?[new n(e,i,'color expected, "%s" found',i)]:[]}},{"../error/validation_error":102,"../util/get_type":120,csscolorparser:107}],128:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type");e.exports=function(t){var e=t.key,i=t.value;if(t.styleSpec.$version>7)return i?[new n(e,i,"constants have been deprecated as of v8")]:[];var o=r(i);if("object"!==o)return[new n(e,i,"object expected, %s found",o)];var a=[];for(var s in i)"@"!==s[0]&&a.push(new n(e+"."+s,i[s],'constants must start with "@"'));return a}},{"../error/validation_error":102,"../util/get_type":120}],129:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/unbundle_jsonlint");e.exports=function(t){var e=t.key,i=t.value,o=t.valueSpec,a=[];return Array.isArray(o.values)?-1===o.values.indexOf(r(i))&&a.push(new n(e,i,"expected one of [%s], %s found",o.values.join(", "),i)):-1===Object.keys(o.values).indexOf(r(i))&&a.push(new n(e,i,"expected one of [%s], %s found",Object.keys(o.values).join(", "),i)),a}},{"../error/validation_error":102,"../util/unbundle_jsonlint":123}],130:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("./validate_enum"),o=t("../util/get_type"),a=t("../util/unbundle_jsonlint");e.exports=function t(e){var i,s=e.value,l=e.key,u=e.styleSpec,c=[];if("array"!==o(s))return[new n(l,s,"array expected, %s found",o(s))];if(s.length<1)return[new n(l,s,"filter array must have at least 1 element")];switch(c=c.concat(r({key:l+"[0]",value:s[0],valueSpec:u.filter_operator,style:e.style,styleSpec:e.styleSpec})),a(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===a(s[1])&&c.push(new n(l,s,'"$type" cannot be use with operator "%s"',s[0]));case"==":case"!=":3!==s.length&&c.push(new n(l,s,'filter array for operator "%s" must have 3 elements',s[0]));case"in":case"!in":s.length>=2&&("string"!==(i=o(s[1]))&&c.push(new n(l+"[1]",s[1],"string expected, %s found",i)));for(var h=2;h<s.length;h++)i=o(s[h]),"$type"===a(s[1])?c=c.concat(r({key:l+"["+h+"]",value:s[h],valueSpec:u.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&c.push(new n(l+"["+h+"]",s[h],"string, number, or boolean expected, %s found",i));break;case"any":case"all":case"none":for(var d=1;d<s.length;d++)c=c.concat(t({key:l+"["+d+"]",value:s[d],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=o(s[1]),2!==s.length?c.push(new n(l,s,'filter array for "%s" operator must have 2 elements',s[0])):"string"!==i&&c.push(new n(l+"[1]",s[1],"string expected, %s found",i))}return c}},{"../error/validation_error":102,"../util/get_type":120,"../util/unbundle_jsonlint":123,"./validate_enum":129}],131:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),o=t("./validate"),a=t("./validate_object"),s=t("./validate_array"),l=t("./validate_number"),u=t("../util/unbundle_jsonlint");e.exports=function(t){function e(t){var e=[],s=t.value,c=t.key;if("array"!==r(s))return[new n(c,s,"array expected, %s found",r(s))];if(2!==s.length)return[new n(c,s,"array length %d expected, length %d found",2,s.length)];if(y){if("object"!==r(s[0]))return[new n(c,s,"object expected, %s found",r(s[0]))];if(void 0===s[0].zoom)return[new n(c,s,"object stop key must have zoom")];if(void 0===s[0].value)return[new n(c,s,"object stop key must have value")];if(d&&d>u(s[0].zoom))return[new n(c,s[0].zoom,"stop zoom values must appear in ascending order")];u(s[0].zoom)!==d&&(d=u(s[0].zoom),h=void 0,m={}),e=e.concat(a({key:c+"[0]",value:s[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:l,value:i}}))}else e=e.concat(i({key:c+"[0]",value:s[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec}));return e.concat(o({key:c+"[1]",value:s[1],valueSpec:f,style:t.style,styleSpec:t.styleSpec}))}function i(t){var e=r(t.value),i=u(t.value);if(c){if(e!==c)return[new n(t.key,t.value,"%s stop domain type must match previous stop domain type %s",e,c)]}else c=e;if("number"!==e&&"string"!==e&&"boolean"!==e)return[new n(t.key,t.value,"stop domain value must be a number, string, or boolean")];if("number"!==e&&"categorical"!==p){var o="number expected, %s found";return f["property-function"]&&void 0===p&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n(t.key,t.value,o,e)]}return"categorical"!==p||"number"!==e||isFinite(i)&&Math.floor(i)===i?"number"===e&&void 0!==h&&i<h?[new n(t.key,t.value,"stop domain values must appear in ascending order")]:(h=i,"categorical"===p&&i in m?[new n(t.key,t.value,"stop domain values must be unique")]:(m[i]=!0,[])):[new n(t.key,t.value,"integer expected, found %s",i)]}var c,h,d,f=t.valueSpec,p=u(t.value.type),m={},v="categorical"!==p&&void 0===t.value.property,g=!v,y="array"===r(t.value.stops)&&"array"===r(t.value.stops[0])&&"object"===r(t.value.stops[0][0]),_=a({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===p)return[new n(t.key,t.value,'identity function may not have a "stops" property')];var i=[],o=t.value;return i=i.concat(s({key:t.key,value:o,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:e})),"array"===r(o)&&0===o.length&&i.push(new n(t.key,o,"array must have at least one stop")),i},default:function(t){return o({key:t.key,value:t.value,valueSpec:f,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===p&&v&&_.push(new n(t.key,t.value,'missing required property "property"')),"identity"===p||t.value.stops||_.push(new n(t.key,t.value,'missing required property "stops"')),"exponential"===p&&"piecewise-constant"===t.valueSpec.function&&_.push(new n(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(g&&!t.valueSpec["property-function"]?_.push(new n(t.key,t.value,"property functions not supported")):v&&!t.valueSpec["zoom-function"]&&_.push(new n(t.key,t.value,"zoom functions not supported"))),"categorical"!==p&&!y||void 0!==t.value.property||_.push(new n(t.key,t.value,'"property" property is required')),_}},{"../error/validation_error":102,"../util/get_type":120,"../util/unbundle_jsonlint":123,"./validate":124,"./validate_array":125,"./validate_number":136,"./validate_object":137}],132:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("./validate_string");e.exports=function(t){var e=t.value,i=t.key,o=r(t);return o.length?o:(-1===e.indexOf("{fontstack}")&&o.push(new n(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&o.push(new n(i,e,'"glyphs" url must include a "{range}" token')),o)}},{"../error/validation_error":102,"./validate_string":141}],133:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/unbundle_jsonlint"),o=t("./validate_object"),a=t("./validate_filter"),s=t("./validate_paint_property"),l=t("./validate_layout_property"),u=t("../util/extend");e.exports=function(t){var e=[],i=t.value,c=t.key,h=t.style,d=t.styleSpec;i.type||i.ref||e.push(new n(c,i,'either "type" or "ref" is required'));var f,p=r(i.type),m=r(i.ref);if(i.id)for(var v=r(i.id),g=0;g<t.arrayIndex;g++){var y=h.layers[g];r(y.id)===v&&e.push(new n(c,i.id,'duplicate layer id "%s", previously used at line %d',i.id,y.id.__line__))}if("ref"in i)["type","source","source-layer","filter","layout"].forEach(function(t){t in i&&e.push(new n(c,i[t],'"%s" is prohibited for ref layers',t))}),h.layers.forEach(function(t){r(t.id)===m&&(f=t)}),f?f.ref?e.push(new n(c,i.ref,"ref cannot reference another ref layer")):p=r(f.type):e.push(new n(c,i.ref,'ref layer "%s" not found',m));else if("background"!==p)if(i.source){var _=h.sources&&h.sources[i.source],b=_&&r(_.type);_?"vector"===b&&"raster"===p?e.push(new n(c,i.source,'layer "%s" requires a raster source',i.id)):"raster"===b&&"raster"!==p?e.push(new n(c,i.source,'layer "%s" requires a vector source',i.id)):"vector"!==b||i["source-layer"]||e.push(new n(c,i,'layer "%s" must specify a "source-layer"',i.id)):e.push(new n(c,i.source,'source "%s" not found',i.source))}else e.push(new n(c,i,'missing required property "source"'));return e=e.concat(o({key:c,value:i,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},filter:a,layout:function(t){return o({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return l(u({layerType:p},t))}}})},paint:function(t){return o({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return s(u({layerType:p},t))}}})}}}))}},{"../error/validation_error":102,"../util/extend":119,"../util/unbundle_jsonlint":123,"./validate_filter":130,"./validate_layout_property":134,"./validate_object":137,"./validate_paint_property":138}],134:[function(t,e,i){"use strict";var n=t("./validate_property");e.exports=function(t){return n(t,"layout")}},{"./validate_property":139}],135:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),o=t("./validate");e.exports=function(t){var e=t.value,i=t.styleSpec,a=i.light,s=t.style,l=[],u=r(e);if(void 0===e)return l;if("object"!==u)return l.concat([new n("light",e,"object expected, %s found",u)]);for(var c in e){var h=c.match(/^(.*)-transition$/);l=h&&a[h[1]]&&a[h[1]].transition?l.concat(o({key:c,value:e[c],valueSpec:i.transition,style:s,styleSpec:i})):a[c]?l.concat(o({key:c,value:e[c],valueSpec:a[c],style:s,styleSpec:i})):l.concat([new n(c,e[c],'unknown property "%s"',c)])}return l}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],136:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.key,i=t.value,o=t.valueSpec,a=n(i);return"number"!==a?[new r(e,i,"number expected, %s found",a)]:"minimum"in o&&i<o.minimum?[new r(e,i,"%s is less than the minimum value %s",i,o.minimum)]:"maximum"in o&&i>o.maximum?[new r(e,i,"%s is greater than the maximum value %s",i,o.maximum)]:[]}},{"../error/validation_error":102,"../util/get_type":120}],137:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),o=t("./validate");e.exports=function(t){var e=t.key,i=t.value,a=t.valueSpec||{},s=t.objectElementValidators||{},l=t.style,u=t.styleSpec,c=[],h=r(i);if("object"!==h)return[new n(e,i,"object expected, %s found",h)];for(var d in i){var f=d.split(".")[0],p=a[f]||a["*"],m=void 0;if(s[f])m=s[f];else if(a[f])m=o;else if(s["*"])m=s["*"];else{if(!a["*"]){c.push(new n(e,i[d],'unknown property "%s"',d));continue}m=o}c=c.concat(m({key:(e?e+".":e)+d,value:i[d],valueSpec:p,style:l,styleSpec:u,object:i,objectKey:d}))}for(var v in a)a[v].required&&void 0===a[v].default&&void 0===i[v]&&c.push(new n(e,i,'missing required property "%s"',v));return c}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],138:[function(t,e,i){"use strict";var n=t("./validate_property");e.exports=function(t){return n(t,"paint")}},{"./validate_property":139}],139:[function(t,e,i){"use strict";var n=t("./validate"),r=t("../error/validation_error"),o=t("../util/get_type");e.exports=function(t,e){var i=t.key,a=t.style,s=t.styleSpec,l=t.value,u=t.objectKey,c=s[e+"_"+t.layerType];if(!c)return[];var h=u.match(/^(.*)-transition$/);if("paint"===e&&h&&c[h[1]]&&c[h[1]].transition)return n({key:i,value:l,valueSpec:s.transition,style:a,styleSpec:s});var d,f=t.valueSpec||c[u];if(!f)return[new r(i,l,'unknown property "%s"',u)];if("string"===o(l)&&f["property-function"]&&!f.tokens&&(d=/^{([^}]+)}$/.exec(l)))return[new r(i,l,'"%s" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": %s` }`.',u,JSON.stringify(d[1]))];var p=[];return"symbol"===t.layerType&&"text-field"===u&&a&&!a.glyphs&&p.push(new r(i,l,'use of "text-field" requires a style "glyphs" property')),p.concat(n({key:t.key,value:l,valueSpec:f,style:a,styleSpec:s}))}},{"../error/validation_error":102,"../util/get_type":120,"./validate":124}],140:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/unbundle_jsonlint"),o=t("./validate_object"),a=t("./validate_enum");e.exports=function(t){var e=t.value,i=t.key,s=t.styleSpec,l=t.style;if(!e.type)return[new n(i,e,'"type" is required')];var u=[];switch(r(e.type)){case"vector":case"raster":if(u=u.concat(o({key:i,value:e,valueSpec:s.source_tile,style:t.style,styleSpec:s})),"url"in e)for(var c in e)["type","url","tileSize"].indexOf(c)<0&&u.push(new n(i+"."+c,e[c],'a source with a "url" property may not include a "%s" property',c));return u;case"geojson":return o({key:i,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s});case"video":return o({key:i,value:e,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return o({key:i,value:e,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return o({key:i,value:e,valueSpec:s.source_canvas,style:l,styleSpec:s});default:return a({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:l,styleSpec:s})}}},{"../error/validation_error":102,"../util/unbundle_jsonlint":123,"./validate_enum":129,"./validate_object":137}],141:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.key,o=n(e);return"string"!==o?[new r(i,e,"string expected, %s found",o)]:[]}},{"../error/validation_error":102,"../util/get_type":120}],142:[function(t,e,i){"use strict";function n(t,e){e=e||l;var i=[];return i=i.concat(s({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:u,"*":function(){return[]}}})),e.$version>7&&t.constants&&(i=i.concat(a({key:"constants",value:t.constants,style:t,styleSpec:e}))),r(i)}function r(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function o(t){return function(){return r(t.apply(this,arguments))}}var a=t("./validate/validate_constants"),s=t("./validate/validate"),l=t("./reference/latest"),u=t("./validate/validate_glyphs_url");n.source=o(t("./validate/validate_source")),n.light=o(t("./validate/validate_light")),n.layer=o(t("./validate/validate_layer")),n.filter=o(t("./validate/validate_filter")),n.paintProperty=o(t("./validate/validate_paint_property")),n.layoutProperty=o(t("./validate/validate_layout_property")),e.exports=n},{"./reference/latest":117,"./validate/validate":124,"./validate/validate_constants":128,"./validate/validate_filter":130,"./validate/validate_glyphs_url":132,"./validate/validate_layer":133,"./validate/validate_layout_property":134,"./validate/validate_light":135,"./validate/validate_paint_property":138,"./validate/validate_source":140}],143:[function(t,e,i){"use strict";var n=function(){this.n=0,this.times=[]};n.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},n.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},n.prototype.cancel=function(t){this.times=this.times.filter(function(e){return e.id!==t})},e.exports=n},{}],144:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("../util/ajax"),o=t("../util/browser"),a=t("../util/mapbox").normalizeSpriteURL,s=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},l=function(t){function e(e,i){var n=this;t.call(this),this.base=e,this.retina=o.devicePixelRatio>1,this.setEventedParent(i);var s=this.retina?"@2x":"";r.getJSON(a(e,s,".json"),function(t,e){return t?void n.fire("error",{error:t}):(n.data=e,void(n.imgData&&n.fire("data",{dataType:"style"})))}),r.getImage(a(e,s,".png"),function(t,e){if(t)n.fire("error",{error:t});else{n.imgData=o.getImageData(e);for(var i=0;i<n.imgData.length;i+=4){var r=n.imgData[i+3]/255;n.imgData[i+0]*=r,n.imgData[i+1]*=r,n.imgData[i+2]*=r}n.width=e.width,n.data&&n.fire("data",{dataType:"style"})}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return this.base},e.prototype.loaded=function(){return!(!this.data||!this.imgData)},e.prototype.resize=function(){var t=this;if(o.devicePixelRatio>1!==this.retina){var i=new e(this.base);i.on("data",function(){t.data=i.data,t.imgData=i.imgData,t.width=i.width,t.retina=i.retina})}},e.prototype.getSpritePosition=function(t){if(!this.loaded())return new s;var e=this.data&&this.data[t];return e&&this.imgData?e:new s},e}(n);e.exports=l},{"../util/ajax":191,"../util/browser":192,"../util/evented":200,"../util/mapbox":208}],145:[function(t,e,i){"use strict";var n=t("../style-spec/reference/latest"),r=t("../util/util"),o=t("../util/evented"),a=t("./validate_style"),s=t("./style_declaration"),l=t("./style_transition"),u=function(t){function e(e){t.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=n.light,this.set(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){var e=this;if(!this._validate(a.light,t)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},t=r.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},t);for(var i=0,n=e.properties;i<n.length;i+=1){var o=n[i];e._declarations[o]=new s(e._specifications[o],t[o])}return this}},e.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},e.prototype.getLightProperty=function(t){return r.endsWith(t,"-transition")?this._transitionOptions[t]:this._declarations[t]&&this._declarations[t].value},e.prototype.getLightValue=function(t,e){if("position"===t){var i=this._transitions[t].calculate(e),n=r.sphericalToCartesian(i);return{x:n[0],y:n[1],z:n[2]}}return this._transitions[t].calculate(e)},e.prototype.setLight=function(t){var e=this;if(!this._validate(a.light,t))for(var i in t){var n=t[i];r.endsWith(i,"-transition")?e._transitionOptions[i]=n:null===n||void 0===n?delete e._declarations[i]:e._declarations[i]=new s(e._specifications[i],n)}},e.prototype.recalculate=function(t){var e=this;for(var i in e._declarations)e.calculated[i]=e.getLightValue(i,{zoom:t})},e.prototype._applyLightDeclaration=function(t,e,i,n,o){var a=i.transition?this._transitions[t]:void 0,u=this._specifications[t];if(null!==e&&void 0!==e||(e=new s(u,u.default)),!a||a.declaration.json!==e.json){var c=r.extend({duration:300,delay:0},n,this.getLightProperty(t+"-transition")),h=this._transitions[t]=new l(u,e,a,c);h.instant()||(h.loopID=o.set(h.endTime-Date.now())),a&&o.cancel(a.loopID)}},e.prototype.updateLightTransitions=function(t,e,i){var n,r=this;for(n in r._declarations)r._applyLightDeclaration(n,r._declarations[n],t,e,i)},e.prototype._validate=function(t,e){return a.emitErrors(this,t.call(a,r.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:n})))},e}(o);e.exports=u},{"../style-spec/reference/latest":117,"../util/evented":200,"../util/util":212,"./style_declaration":147,"./style_transition":155,"./validate_style":156}],146:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("./style_layer"),o=t("./image_sprite"),a=t("./light"),s=t("../symbol/glyph_source"),l=t("../symbol/sprite_atlas"),u=t("../render/line_atlas"),c=t("../util/util"),h=t("../util/ajax"),d=t("../util/mapbox"),f=t("../util/browser"),p=t("../util/dispatcher"),m=t("./animation_loop"),v=t("./validate_style"),g=t("../source/source"),y=t("../source/query_features"),_=t("../source/source_cache"),b=t("../style-spec/reference/latest"),x=t("../style-spec/function"),w=t("../util/global_worker_pool"),S=t("../style-spec/deref"),M=t("../style-spec/diff"),E=t("../source/rtl_text_plugin"),z=c.pick(M.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),k=c.pick(M.operations,["setCenter","setZoom","setBearing","setPitch"]),T=function(t){function e(e,i,n){var r=this;t.call(this),this.map=i,this.animationLoop=i&&i.animationLoop||new m,this.dispatcher=new p(w(),this),this.spriteAtlas=new l(1024,1024),this.spriteAtlas.setEventedParent(this),this.lineAtlas=new u(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,c.bindAll(["_redoPlacement"],this),this._resetUpdates(),n=c.extend({validate:"string"!=typeof e||!d.isMapboxURL(e)},n),this.setEventedParent(i),this.fire("dataloading",{dataType:"style"});var a=this;this._rtlTextPluginCallback=E.registerForPluginAvailability(function(t){for(var e in a.dispatcher.broadcast("loadRTLTextPlugin",t.pluginBlobURL,t.errorCallback),a.sourceCaches)a.sourceCaches[e].reload()});var g=function(t,e){if(t)r.fire("error",{error:t});else if(!n.validate||!v.emitErrors(r,v(e))){for(var i in r._loaded=!0,r.stylesheet=e,r.updateClasses(),e.sources)r.addSource(i,e.sources[i],n);e.sprite&&(r.sprite=new o(e.sprite,r)),r.glyphSource=new s(e.glyphs),r._resolve(),r.fire("data",{dataType:"style"}),r.fire("style.load")}};"string"==typeof e?h.getJSON(d.normalizeStyleURL(e),g):f.frame(g.bind(this,null,e)),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=r.sourceCaches[t.sourceId].getSource();if(e&&e.vectorLayerIds)for(var i in r._layers){var n=r._layers[i];n.source===e.id&&r._validateLayer(n)}}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(t.sourceLayer&&e){var i=e.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(t.sourceLayer))&&this.fire("error",{error:new Error('Source layer "'+t.sourceLayer+'" does not exist on source "'+i.id+'" as specified by style layer "'+t.id+'"')})}},e.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},e.prototype._resolve=function(){var t=S(this.stylesheet.layers);this._order=t.map(function(t){return t.id}),this._layers={};for(var e=0,i=t;e<i.length;e+=1){var n=i[e];(n=r.create(n)).setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=n}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new a(this.stylesheet.light)},e.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},e.prototype._applyClasses=function(t,e){var i=this;if(this._loaded){t=t||[],e=e||{transition:!0};var n=this.stylesheet.transition||{},r=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var o in r){var a=i._layers[o],s=i._updatedPaintProps[o];if(i._updatedAllPaintProps||s.all)a.updatePaintTransitions(t,e,n,i.animationLoop,i.zoomHistory);else for(var l in s)i._layers[o].updatePaintTransition(l,t,e,n,i.animationLoop,i.zoomHistory)}this.light.updateLightTransitions(e,n,this.animationLoop)}},e.prototype._recalculate=function(t){var e=this;if(this._loaded){for(var i in e.sourceCaches)e.sourceCaches[i].used=!1;this._updateZoomHistory(t);for(var n=0,r=e._order;n<r.length;n+=1){var o=r[n],a=e._layers[o];a.recalculate(t),!a.isHidden(t)&&a.source&&(e.sourceCaches[a.source].used=!0)}this.light.recalculate(t);Math.floor(this.z)!==Math.floor(t)&&this.animationLoop.set(300),this.z=t}},e.prototype._updateZoomHistory=function(t){var e=this.zoomHistory;void 0===e.lastIntegerZoom&&(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=0,e.lastZoom=t),Math.floor(e.lastZoom)<Math.floor(t)?(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=Date.now()):Math.floor(e.lastZoom)>Math.floor(t)&&(e.lastIntegerZoom=Math.floor(t+1),e.lastIntegerZoomTime=Date.now()),e.lastZoom=t},e.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},e.prototype.update=function(t,e){var i=this;if(this._changed){var n=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var o in(n.length||r.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(n,r),i._updatedSources){var a=i._updatedSources[o];"reload"===a?i._reloadSource(o):"clear"===a&&i._clearSource(o)}this._applyClasses(t,e),this._resetUpdates(),this.fire("data",{dataType:"style"})}},e.prototype._updateWorkerLayers=function(t,e){var i=this,n=this._updatedSymbolOrder?this._order.filter(function(t){return"symbol"===i._layers[t].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e,symbolOrder:n})},e.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},e.prototype.setState=function(t){var e=this;if(this._checkLoaded(),v.emitErrors(this,v(t)))return!1;(t=c.extend({},t)).layers=S(t.layers);var i=M(this.serialize(),t).filter(function(t){return!(t.command in k)});if(0===i.length)return!1;var n=i.filter(function(t){return!(t.command in z)});if(n.length>0)throw new Error("Unimplemented: "+n.map(function(t){return t.command}).join(", ")+".");return i.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},e.prototype.addSource=function(t,e,i){var n=this;if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e)+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(e.type)>=0)||!this._validate(v.source,"sources."+t,e,null,i)){var r=this.sourceCaches[t]=new _(t,e,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:n.loaded(),source:r.serialize(),sourceId:t}}),r.onAdd(this.map),this._changed=!0}},e.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");var e=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],e.setEventedParent(null),e.clearTiles(),e.onRemove&&e.onRemove(this.map),this._changed=!0},e.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},e.prototype.addLayer=function(t,e,i){this._checkLoaded();var n=t.id;if("object"==typeof t.source&&(this.addSource(n,t.source),t=c.extend(t,{source:n})),!this._validate(v.layer,"layers."+n,t,{arrayIndex:-1},i)){var o=r.create(t);this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}});var a=e?this._order.indexOf(e):this._order.length;if(this._order.splice(a,0,n),this._layers[n]=o,this._removedLayers[n]&&o.source){var s=this._removedLayers[n];delete this._removedLayers[n],this._updatedSources[o.source]=s.type!==o.type?"clear":"reload"}this._updateLayer(o),"symbol"===o.type&&(this._updatedSymbolOrder=!0),this.updateClasses(n)}},e.prototype.moveLayer=function(t,e){this._checkLoaded(),this._changed=!0;var i=this._layers[t];if(i){var n=this._order.indexOf(t);this._order.splice(n,1);var r=e?this._order.indexOf(e):this._order.length;this._order.splice(r,0,t),"symbol"===i.type&&(this._updatedSymbolOrder=!0,i.source&&!this._updatedSources[i.source]&&(this._updatedSources[i.source]="reload"))}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")})},e.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(e){e.setEventedParent(null);var i=this._order.indexOf(t);this._order.splice(i,1),"symbol"===e.type&&(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")})},e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.setLayerZoomRange=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);return n?void(n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")})},e.prototype.setFilter=function(t,e){this._checkLoaded();var i=this.getLayer(t);return i?void(null!==e&&void 0!==e&&this._validate(v.filter,"layers."+i.id+".filter",e)||c.deepEqual(i.filter,e)||(i.filter=c.clone(e),this._updateLayer(i))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")})},e.prototype.getFilter=function(t){return c.clone(this.getLayer(t).filter)},e.prototype.setLayoutProperty=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);return n?void(c.deepEqual(n.getLayoutProperty(e),i)||(n.setLayoutProperty(e,i),this._updateLayer(n))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},e.prototype.setPaintProperty=function(t,e,i,n){this._checkLoaded();var r=this.getLayer(t);if(r){if(!c.deepEqual(r.getPaintProperty(e,n),i)){var o=r.isPaintValueFeatureConstant(e);r.setPaintProperty(e,i,n),!(i&&x.isFunctionDefinition(i)&&"$zoom"!==i.property&&void 0!==i.property)&&o||this._updateLayer(r),this.updateClasses(t,e)}}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getPaintProperty=function(t,e,i){return this.getLayer(t).getPaintProperty(e,i)},e.prototype.getTransition=function(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},e.prototype.updateClasses=function(t,e){if(this._changed=!0,t){var i=this._updatedPaintProps;i[t]||(i[t]={}),i[t][e||"all"]=!0}else this._updatedAllPaintProps=!0},e.prototype.serialize=function(){var t=this;return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:c.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(e){return t._layers[e].serialize()})},function(t){return void 0!==t})},e.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload"),this._changed=!0},e.prototype._flattenRenderedFeatures=function(t){for(var e=[],i=this._order.length-1;i>=0;i--)for(var n=this._order[i],r=0,o=t;r<o.length;r+=1){var a=o[r][n];if(a)for(var s=0,l=a;s<l.length;s+=1){var u=l[s];e.push(u)}}return e},e.prototype.queryRenderedFeatures=function(t,e,i,n){var r=this;e&&e.filter&&this._validate(v.filter,"queryRenderedFeatures.filter",e.filter);var o={};if(e&&e.layers){if(!Array.isArray(e.layers))return void this.fire("error",{error:"parameters.layers must be an Array."});for(var a=0,s=e.layers;a<s.length;a+=1){var l=s[a],u=r._layers[l];if(!u)return void r.fire("error",{error:"The layer '"+l+"' does not exist in the map's style and cannot be queried for features."});o[u.source]=!0}}var c=[];for(var h in r.sourceCaches)if(!e.layers||o[h]){var d=y.rendered(r.sourceCaches[h],r._layers,t,e,i,n);c.push(d)}return this._flattenRenderedFeatures(c)},e.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(v.filter,"querySourceFeatures.filter",e.filter);var i=this.sourceCaches[t];return i?y.source(i,e):[]},e.prototype.addSourceType=function(t,e,i){return g.getType(t)?i(new Error('A source type called "'+t+'" already exists.')):(g.setType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},e.prototype.getLight=function(){return this.light.getLight()},e.prototype.setLight=function(t,e){this._checkLoaded();var i=this.light.getLight(),n=!1;for(var r in t)if(!c.deepEqual(t[r],i[r])){n=!0;break}if(n){var o=this.stylesheet.transition||{};this.light.setLight(t),this.light.updateLightTransitions(e||{transition:!0},o,this.animationLoop)}},e.prototype._validate=function(t,e,i,n,r){return(!r||!1!==r.validate)&&v.emitErrors(this,t.call(v,c.extend({key:e,style:this.serialize(),value:i,styleSpec:b},n)))},e.prototype._remove=function(){for(var t in E.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[t].clearTiles();this.dispatcher.remove()},e.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},e.prototype._reloadSource=function(t){this.sourceCaches[t].reload()},e.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},e.prototype._redoPlacement=function(){for(var t in this.sourceCaches)this.sourceCaches[t].redoPlacement()},e.prototype.getIcons=function(t,e,i){var n=this,r=function(){n.spriteAtlas.setSprite(n.sprite),n.spriteAtlas.addIcons(e.icons,i)};!this.sprite||this.sprite.loaded()?r():this.sprite.on("data",r)},e.prototype.getGlyphs=function(t,e,i){function n(t,e,n){t&&console.error(t),a[n]=e,0===--o&&i(null,a)}var r=e.stacks,o=Object.keys(r).length,a={};for(var s in r)this.glyphSource.getSimpleGlyphs(s,r[s],e.uid,n)},e}(n);e.exports=T},{"../render/line_atlas":76,"../source/query_features":88,"../source/rtl_text_plugin":90,"../source/source":91,"../source/source_cache":92,"../style-spec/deref":100,"../style-spec/diff":101,"../style-spec/function":105,"../style-spec/reference/latest":117,"../symbol/glyph_source":165,"../symbol/sprite_atlas":170,"../util/ajax":191,"../util/browser":192,"../util/dispatcher":198,"../util/evented":200,"../util/global_worker_pool":202,"../util/mapbox":208,"../util/util":212,"./animation_loop":143,"./image_sprite":144,"./light":145,"./style_layer":148,"./validate_style":156}],147:[function(t,e,i){"use strict";var n=t("../style-spec/function"),r=t("../util/util"),o=function(t,e){var i=this;if(this.value=r.clone(e),this.isFunction=n.isFunctionDefinition(e),this.json=JSON.stringify(this.value),this.minimum=t.minimum,this.function=n(this.value,t),this.isFeatureConstant=this.function.isFeatureConstant,this.isZoomConstant=this.function.isZoomConstant,!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];for(var o=[],a=0,s=i.value.stops;a<s.length;a+=1){var l=s[a][0].zoom;i.stopZoomLevels.indexOf(l)<0&&(i.stopZoomLevels.push(l),o.push([l,o.length]))}this.functionInterpolationT=n({type:"exponential",stops:o,base:e.base},{type:"number"})}};o.prototype.calculate=function(t,e){var i=this.function(t&&t.zoom,e||{});return void 0!==this.minimum&&i<this.minimum?this.minimum:i},o.prototype.calculateInterpolationT=function(t,e){return this.functionInterpolationT(t&&t.zoom,e||{})},e.exports=o},{"../style-spec/function":105,"../util/util":212}],148:[function(t,e,i){"use strict";function n(t){return t.value}var r=t("../util/util"),o=t("./style_transition"),a=t("./style_declaration"),s=t("../style-spec/reference/latest"),l=t("./validate_style"),u=t("./../style-spec/util/parse_color"),c=function(t){function e(e){var i=this;t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.source=e.source,this.sourceLayer=e["source-layer"],this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.filter=e.filter,this.paint={},this.layout={},this._paintSpecifications=s["paint_"+this.type],this._layoutSpecifications=s["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var n,r,o={validate:!1};for(var a in e){var l=a.match(/^paint(?:\.(.*))?$/);if(l){var u=l[1]||"";for(n in e[a])i.setPaintProperty(n,e[a][n],u,o)}}for(r in e.layout)i.setLayoutProperty(r,e.layout[r],o);for(n in i._paintSpecifications)i.paint[n]=i.getPaintValue(n);for(r in i._layoutSpecifications)i._updateLayoutValue(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setLayoutProperty=function(t,e,i){if(null==e)delete this._layoutDeclarations[t];else{var n="layers."+this.id+".layout."+t;if(this._validate(l.layoutProperty,n,t,e,i))return;this._layoutDeclarations[t]=new a(this._layoutSpecifications[t],e)}this._updateLayoutValue(t)},e.prototype.getLayoutProperty=function(t){return this._layoutDeclarations[t]&&this._layoutDeclarations[t].value},e.prototype.getLayoutValue=function(t,e,i){var n=this._layoutSpecifications[t],r=this._layoutDeclarations[t];return r?r.calculate(e,i):n.default},e.prototype.setPaintProperty=function(t,e,i,n){var o="layers."+this.id+(i?'["paint.'+i+'"].':".paint.")+t;if(r.endsWith(t,"-transition"))if(this._paintTransitionOptions[i||""]||(this._paintTransitionOptions[i||""]={}),null===e||void 0===e)delete this._paintTransitionOptions[i||""][t];else{if(this._validate(l.paintProperty,o,t,e,n))return;this._paintTransitionOptions[i||""][t]=e}else if(this._paintDeclarations[i||""]||(this._paintDeclarations[i||""]={}),null===e||void 0===e)delete this._paintDeclarations[i||""][t];else{if(this._validate(l.paintProperty,o,t,e,n))return;this._paintDeclarations[i||""][t]=new a(this._paintSpecifications[t],e)}},e.prototype.getPaintProperty=function(t,e){return e=e||"",r.endsWith(t,"-transition")?this._paintTransitionOptions[e]&&this._paintTransitionOptions[e][t]:this._paintDeclarations[e]&&this._paintDeclarations[e][t]&&this._paintDeclarations[e][t].value},e.prototype.getPaintValue=function(t,e,i){var n=this._paintSpecifications[t],r=this._paintTransitions[t];return r?r.calculate(e,i):"color"===n.type&&n.default?u(n.default):n.default},e.prototype.getPaintValueStopZoomLevels=function(t){var e=this._paintTransitions[t];return e?e.declaration.stopZoomLevels:[]},e.prototype.getPaintInterpolationT=function(t,e){return this._paintTransitions[t].declaration.calculateInterpolationT(e)},e.prototype.isPaintValueFeatureConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isFeatureConstant},e.prototype.isLayoutValueFeatureConstant=function(t){var e=this._layoutDeclarations[t];return!e||e.isFeatureConstant},e.prototype.isPaintValueZoomConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isZoomConstant},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.layout.visibility},e.prototype.updatePaintTransitions=function(t,e,i,n,o){for(var a=this,s=r.extend({},this._paintDeclarations[""]),l=0;l<t.length;l++)r.extend(s,a._paintDeclarations[t[l]]);var u;for(u in s)a._applyPaintDeclaration(u,s[u],e,i,n,o);for(u in a._paintTransitions)u in s||a._applyPaintDeclaration(u,null,e,i,n,o)},e.prototype.updatePaintTransition=function(t,e,i,n,r,o){for(var a=this._paintDeclarations[""][t],s=0;s<e.length;s++){var l=this._paintDeclarations[e[s]];l&&l[t]&&(a=l[t])}this._applyPaintDeclaration(t,a,i,n,r,o)},e.prototype.recalculate=function(t){var e=this;for(var i in e._paintTransitions)e.paint[i]=e.getPaintValue(i,{zoom:t});for(var n in e._layoutFunctions)e.layout[n]=e.getLayoutValue(n,{zoom:t})},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:r.mapObject(this._layoutDeclarations,n)};for(var e in this._paintDeclarations){t[""===e?"paint":"paint."+e]=r.mapObject(this._paintDeclarations[e],n)}return r.filterObject(t,function(t,e){return void 0!==t&&!("layout"===e&&!Object.keys(t).length)})},e.prototype._applyPaintDeclaration=function(t,e,i,n,s,l){var u=i.transition?this._paintTransitions[t]:void 0,c=this._paintSpecifications[t];if(null!==e&&void 0!==e||(e=new a(c,c.default)),!u||u.declaration.json!==e.json){var h=r.extend({duration:300,delay:0},n,this.getPaintProperty(t+"-transition")),d=this._paintTransitions[t]=new o(c,e,u,h,l);d.instant()||(d.loopID=s.set(d.endTime-Date.now())),u&&s.cancel(u.loopID)}},e.prototype._updateLayoutValue=function(t){var e=this._layoutDeclarations[t];e&&e.isFunction?this._layoutFunctions[t]=!0:(delete this._layoutFunctions[t],this.layout[t]=this.getLayoutValue(t))},e.prototype._validate=function(t,e,i,n,r){return(!r||!1!==r.validate)&&l.emitErrors(this,t.call(l,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:s,style:{glyphs:!0,sprite:!0}}))},e}(t("../util/evented"));e.exports=c;var h={circle:t("./style_layer/circle_style_layer"),fill:t("./style_layer/fill_style_layer"),"fill-extrusion":t("./style_layer/fill_extrusion_style_layer"),line:t("./style_layer/line_style_layer"),symbol:t("./style_layer/symbol_style_layer")};c.create=function(t){return new(h[t.type]||c)(t)}},{"../style-spec/reference/latest":117,"../util/evented":200,"../util/util":212,"./../style-spec/util/parse_color":121,"./style_declaration":147,"./style_layer/circle_style_layer":149,"./style_layer/fill_extrusion_style_layer":150,"./style_layer/fill_style_layer":151,"./style_layer/line_style_layer":152,"./style_layer/symbol_style_layer":153,"./style_transition":155,"./validate_style":156}],149:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/circle_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=o},{"../../data/bucket/circle_bucket":46,"../style_layer":148}],150:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/fill_extrusion_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,i,n){var r=t.prototype.getPaintValue.call(this,e,i,n);return"fill-extrusion-color"===e&&r&&(r[3]=1),r},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=o},{"../../data/bucket/fill_extrusion_bucket":48,"../style_layer":148}],151:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/fill_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,i,n){if("fill-outline-color"===e){if(void 0===this.getPaintProperty("fill-outline-color"))return t.prototype.getPaintValue.call(this,"fill-color",i,n);for(var r=this._paintTransitions["fill-outline-color"];r;){if(!(r&&r.declaration&&r.declaration.value))return t.prototype.getPaintValue.call(this,"fill-color",i,n);r=r.oldTransition}}return t.prototype.getPaintValue.call(this,e,i,n)},e.prototype.getPaintValueStopZoomLevels=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):t.prototype.getPaintValueStopZoomLevels.call(this,e)},e.prototype.getPaintInterpolationT=function(e,i){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintInterpolationT.call(this,"fill-color",i):t.prototype.getPaintInterpolationT.call(this,e,i)},e.prototype.isPaintValueFeatureConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):t.prototype.isPaintValueFeatureConstant.call(this,e)},e.prototype.isPaintValueZoomConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueZoomConstant.call(this,"fill-color"):t.prototype.isPaintValueZoomConstant.call(this,e)},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=o},{"../../data/bucket/fill_bucket":47,"../style_layer":148}],152:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/line_bucket"),o=t("../../util/util"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,i,n){var r=t.prototype.getPaintValue.call(this,e,i,n);if(r&&"line-dasharray"===e){var a=this.getPaintValue("line-width",o.extend({},i,{zoom:Math.floor(i.zoom)}),n);r.fromScale*=a,r.toScale*=a}return r},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=a},{"../../data/bucket/line_bucket":49,"../../util/util":212,"../style_layer":148}],153:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/symbol_bucket"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,i,n){var r=t.prototype.getLayoutValue.call(this,e,i,n);if("auto"!==r)return r;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",i,n)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",i,n);default:return r}},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=o},{"../../data/bucket/symbol_bucket":50,"../style_layer":148}],154:[function(t,e,i){"use strict";var n=t("./style_layer"),r=t("../util/util"),o=t("../style-spec/feature_filter"),a=t("../style-spec/group_by_layout"),s=function(t){t&&this.replace(t)};s.prototype.replace=function(t){this.symbolOrder=[];for(var e=0,i=t;e<i.length;e+=1){var n=i[e];"symbol"===n.type&&this.symbolOrder.push(n.id)}this._layerConfigs={},this._layers={},this.update(t,[])},s.prototype.update=function(t,e,i){for(var s=this,l=0,u=t;l<u.length;l+=1){var c=u[l];s._layerConfigs[c.id]=c;var h=s._layers[c.id]=n.create(c);h.updatePaintTransitions({},{transition:!1}),h.filter=o(h.filter)}for(var d=0,f=e;d<f.length;d+=1){var p=f[d];delete s._layerConfigs[p],delete s._layers[p]}i&&(this.symbolOrder=i),this.familiesBySource={};for(var m=0,v=a(r.values(this._layerConfigs));m<v.length;m+=1){var g=v[m].map(function(t){return s._layers[t.id]}),y=g[0];if(!y.layout||"none"!==y.layout.visibility){var _=y.source||"",b=s.familiesBySource[_];b||(b=s.familiesBySource[_]={});var x=y.sourceLayer||"_geojsonTileLayer",w=b[x];w||(w=b[x]=[]),w.push(g)}}},e.exports=s},{"../style-spec/feature_filter":103,"../style-spec/group_by_layout":106,"../util/util":212,"./style_layer":148}],155:[function(t,e,i){"use strict";function n(t,e,i){if(void 0!==t&&void 0!==e)return{from:t.to,fromScale:t.toScale,to:e.to,toScale:e.toScale,t:i}}var r=t("../util/util"),o=t("../util/interpolate"),a={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},s=function(t,e,i,r,s){this.declaration=e,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=i,this.duration=r.duration||0,this.delay=r.delay||0,this.zoomTransitioned="piecewise-constant"===t.function&&t.transition,this.interp=this.zoomTransitioned?n:o[t.type],this.zoomHistory=s||a,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),i&&i.endTime<=this.startTime&&delete i.oldTransition};s.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},s.prototype.calculate=function(t,e,i){var n=this._calculateTargetValue(t,e);if(this.instant())return n;if((i=i||Date.now())>=this.endTime)return n;var o=this.oldTransition.calculate(t,e,this.startTime),a=r.easeCubicInOut((i-this.startTime-this.delay)/this.duration);return this.interp(o,n,a)},s.prototype._calculateTargetValue=function(t,e){if(!this.zoomTransitioned)return this.declaration.calculate(t,e);var i=t.zoom,n=this.zoomHistory.lastIntegerZoom,r=i>n?2:.5,a=this.declaration.calculate({zoom:i>n?i-1:i+1},e),s=this.declaration.calculate({zoom:i},e),l=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),u=Math.abs(i-n),c=o(l,1,u);return void 0!==a&&void 0!==s?{from:a,fromScale:r,to:s,toScale:1,t:c}:void 0},e.exports=s},{"../util/interpolate":204,"../util/util":212}],156:[function(t,e,i){"use strict";e.exports=t("../style-spec/validate_style.min"),e.exports.emitErrors=function(t,e){if(e&&e.length){for(var i=0;i<e.length;i++)t.fire("error",{error:new Error(e[i].message)});return!0}return!1}},{"../style-spec/validate_style.min":142}],157:[function(t,e,i){"use strict";var n=function(t){function e(e,i,n,r){t.call(this,e,i),this.angle=n,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(t("point-geometry"));e.exports=n},{"point-geometry":26}],158:[function(t,e,i){"use strict";e.exports=function(t,e,i,n,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-i/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<i/2;){var c=t[a-1],h=t[a],d=t[a+1];if(!d)return!1;var f=c.angleTo(h)-h.angleTo(d);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>n;)u-=l.shift().angleDelta;if(u>r)return!1;a++,s+=h.dist(d)}return!0}},{}],159:[function(t,e,i){"use strict";var n=t("point-geometry");e.exports=function(t,e,i,r,o){for(var a=[],s=0;s<t.length;s++)for(var l=t[s],u=void 0,c=0;c<l.length-1;c++){var h=l[c],d=l[c+1];h.x<e&&d.x<e||(h.x<e?h=new n(e,h.y+(d.y-h.y)*((e-h.x)/(d.x-h.x)))._round():d.x<e&&(d=new n(e,h.y+(d.y-h.y)*((e-h.x)/(d.x-h.x)))._round()),h.y<i&&d.y<i||(h.y<i?h=new n(h.x+(d.x-h.x)*((i-h.y)/(d.y-h.y)),i)._round():d.y<i&&(d=new n(h.x+(d.x-h.x)*((i-h.y)/(d.y-h.y)),i)._round()),h.x>=r&&d.x>=r||(h.x>=r?h=new n(r,h.y+(d.y-h.y)*((r-h.x)/(d.x-h.x)))._round():d.x>=r&&(d=new n(r,h.y+(d.y-h.y)*((r-h.x)/(d.x-h.x)))._round()),h.y>=o&&d.y>=o||(h.y>=o?h=new n(h.x+(d.x-h.x)*((o-h.y)/(d.y-h.y)),o)._round():d.y>=o&&(d=new n(h.x+(d.x-h.x)*((o-h.y)/(d.y-h.y)),o)._round()),u&&h.equals(u[u.length-1])||(u=[h],a.push(u)),u.push(d)))))}return a}},{"point-geometry":26}],160:[function(t,e,i){"use strict";var n=t("../util/struct_array"),r=t("point-geometry"),o=n({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(o.prototype.StructType.prototype,"anchorPoint",{get:function(){return new r(this.anchorPointX,this.anchorPointY)}}),e.exports=o},{"../util/struct_array":210,"point-geometry":26}],161:[function(t,e,i){"use strict";var n=function(t,e,i,n,r,o,a,s,l,u,c){var h=a.top*s-l,d=a.bottom*s+l,f=a.left*s-l,p=a.right*s+l;if(this.boxStartIndex=t.length,u){var m=d-h,v=p-f;if(m>0)if(m=Math.max(10*s,m),c){var g=e[i.segment+1].sub(e[i.segment])._unit()._mult(v),y=[i.sub(g),i.add(g)];this._addLineCollisionBoxes(t,y,i,0,v,m,n,r,o)}else this._addLineCollisionBoxes(t,e,i,i.segment,v,m,n,r,o)}else t.emplaceBack(i.x,i.y,f,h,p,d,1/0,n,r,o,0,0,0,0,0);this.boxEndIndex=t.length};n.prototype._addLineCollisionBoxes=function(t,e,i,n,r,o,a,s,l){var u=o/2,c=Math.floor(r/u),h=-o/2,d=this.boxes,f=i,p=n+1,m=h;do{if(--p<0)return d;m-=e[p].dist(f),f=e[p]}while(m>-r/2);for(var v=e[p].dist(e[p+1]),g=0;g<c;g++){for(var y=-r/2+g*u;m+v<y;){if(m+=v,++p+1>=e.length)return d;v=e[p].dist(e[p+1])}var _=y-m,b=e[p],x=e[p+1].sub(b)._unit()._mult(_)._add(b)._round(),w=r/2/Math.max(Math.abs(y-h)-u/2,0);t.emplaceBack(x.x,x.y,-o/2,-o/2,o/2,o/2,w,a,s,l,0,0,0,0,0)}return d},e.exports=n},{}],162:[function(t,e,i){"use strict";var n=t("point-geometry"),r=t("../data/extent"),o=t("grid-index"),a=t("../util/intersection_tests"),s=function(t,e,i){if("object"==typeof t){var n=t;i=e,t=n.angle,e=n.pitch,this.grid=new o(n.grid),this.ignoredGrid=new o(n.ignoredGrid)}else this.grid=new o(r,12,6),this.ignoredGrid=new o(r,12,0);this.minScale=.5,this.maxScale=2,this.angle=t,this.pitch=e;var a=Math.sin(t),s=Math.cos(t);if(this.rotationMatrix=[s,-a,a,s],this.reverseRotationMatrix=[s,a,-a,s],this.yStretch=1/Math.cos(e/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=i,0===i.length){i.emplaceBack();var l=32767;i.emplaceBack(0,0,0,-l,0,l,l,0,0,0,0,0,0,0,0,0),i.emplaceBack(r,0,0,-l,0,l,l,0,0,0,0,0,0,0,0,0),i.emplaceBack(0,0,-l,0,l,0,l,0,0,0,0,0,0,0,0,0),i.emplaceBack(0,r,-l,0,l,0,l,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=i.get(0),this.edges=[i.get(1),i.get(2),i.get(3),i.get(4)]};s.prototype.serialize=function(t){var e=this.grid.toArrayBuffer(),i=this.ignoredGrid.toArrayBuffer();return t&&(t.push(e),t.push(i)),{angle:this.angle,pitch:this.pitch,grid:e,ignoredGrid:i}},s.prototype.placeCollisionFeature=function(t,e,i){for(var r=this,o=this.collisionBoxArray,a=this.minScale,s=this.rotationMatrix,l=this.yStretch,u=t.boxStartIndex;u<t.boxEndIndex;u++){var c=o.get(u),h=c.anchorPoint._matMult(s),d=h.x,f=h.y,p=d+c.x1,m=f+c.y1*l,v=d+c.x2,g=f+c.y2*l;if(c.bbox0=p,c.bbox1=m,c.bbox2=v,c.bbox3=g,!e)for(var y=r.grid.query(p,m,v,g),_=0;_<y.length;_++){var b=o.get(y[_]),x=b.anchorPoint._matMult(s);if((a=r.getPlacementScale(a,h,c,x,b))>=r.maxScale)return a}if(i){var w=void 0;if(r.angle){var S=r.reverseRotationMatrix,M=new n(c.x1,c.y1).matMult(S),E=new n(c.x2,c.y1).matMult(S),z=new n(c.x1,c.y2).matMult(S),k=new n(c.x2,c.y2).matMult(S);(w=r.tempCollisionBox).anchorPointX=c.anchorPoint.x,w.anchorPointY=c.anchorPoint.y,w.x1=Math.min(M.x,E.x,z.x,k.x),w.y1=Math.min(M.y,E.x,z.x,k.x),w.x2=Math.max(M.x,E.x,z.x,k.x),w.y2=Math.max(M.y,E.x,z.x,k.x),w.maxScale=c.maxScale}else w=c;for(var T=0;T<this.edges.length;T++){var O=r.edges[T];if((a=r.getPlacementScale(a,c.anchorPoint,w,O.anchorPoint,O))>=r.maxScale)return a}}}return a},s.prototype.queryRenderedSymbols=function(t,e){var i={},r=[];if(0===t.length||0===this.grid.length&&0===this.ignoredGrid.length)return r;for(var o=this.collisionBoxArray,s=this.rotationMatrix,l=this.yStretch,u=[],c=1/0,h=1/0,d=-1/0,f=-1/0,p=0;p<t.length;p++)for(var m=t[p],v=0;v<m.length;v++){var g=m[v].matMult(s);c=Math.min(c,g.x),h=Math.min(h,g.y),d=Math.max(d,g.x),f=Math.max(f,g.y),u.push(g)}for(var y=this.grid.query(c,h,d,f),_=this.ignoredGrid.query(c,h,d,f),b=0;b<_.length;b++)y.push(_[b]);for(var x=Math.pow(2,Math.ceil(Math.log(e)/Math.LN2*10)/10),w=0;w<y.length;w++){var S=o.get(y[w]),M=S.sourceLayerIndex,E=S.featureIndex;if(void 0===i[M]&&(i[M]={}),!i[M][E]&&!(x<S.placementScale||x>S.maxScale)){var z=S.anchorPoint.matMult(s),k=z.x+S.x1/e,T=z.y+S.y1/e*l,O=z.x+S.x2/e,C=z.y+S.y2/e*l,P=[new n(k,T),new n(O,T),new n(O,C),new n(k,C)];a.polygonIntersectsPolygon(u,P)&&(i[M][E]=!0,r.push(y[w]))}}return r},s.prototype.getPlacementScale=function(t,e,i,n,r){var o=e.x-n.x,a=e.y-n.y,s=(r.x1-i.x2)/o,l=(r.x2-i.x1)/o,u=(r.y1-i.y2)*this.yStretch/a,c=(r.y2-i.y1)*this.yStretch/a;(isNaN(s)||isNaN(l))&&(s=l=1),(isNaN(u)||isNaN(c))&&(u=c=1);var h=Math.min(Math.max(s,l),Math.max(u,c)),d=r.maxScale,f=i.maxScale;return h>d&&(h=d),h>f&&(h=f),h>t&&h>=r.placementScale&&(t=h),t},s.prototype.insertCollisionFeature=function(t,e,i){for(var n=i?this.ignoredGrid:this.grid,r=this.collisionBoxArray,o=t.boxStartIndex;o<t.boxEndIndex;o++){var a=r.get(o);a.placementScale=e,e<this.maxScale&&n.insert(o,a.bbox0,a.bbox1,a.bbox2,a.bbox3)}},e.exports=s},{"../data/extent":54,"../util/intersection_tests":205,"grid-index":16,"point-geometry":26}],163:[function(t,e,i){"use strict";var n=t("../util/interpolate"),r=t("../symbol/anchor"),o=t("./check_max_angle");e.exports=function(t,e,i,a,s,l,u,c,h){var d=a?.6*l*u:0,f=Math.max(a?a.right-a.left:0,s?s.right-s.left:0),p=0===t[0].x||t[0].x===h||0===t[0].y||t[0].y===h;return e-f*u<e/4&&(e=f*u+e/4),function t(e,i,a,s,l,u,c,h,d){for(var f=u/2,p=0,m=0;m<e.length-1;m++)p+=e[m].dist(e[m+1]);for(var v=0,g=i-a,y=[],_=0;_<e.length-1;_++){for(var b=e[_],x=e[_+1],w=b.dist(x),S=x.angleTo(b);g+a<v+w;){var M=((g+=a)-v)/w,E=n(b.x,x.x,M),z=n(b.y,x.y,M);if(E>=0&&E<d&&z>=0&&z<d&&g-f>=0&&g+f<=p){var k=new r(E,z,S,_)._round();s&&!o(e,k,u,s,l)||y.push(k)}}v+=w}return h||y.length||c||(y=t(e,v/2,a,s,l,u,c,!0,d)),y}(t,p?e/2*c%e:(f/2+2*l)*u*c%e,e,d,i,f*u,p,!1,h)}},{"../symbol/anchor":157,"../util/interpolate":204,"./check_max_angle":158}],164:[function(t,e,i){"use strict";var n=t("@mapbox/shelf-pack"),r=t("../util/util"),o=function(){this.width=128,this.height=128,this.atlas=new n(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};o.prototype.getGlyphs=function(){var t,e,i,n={};for(var r in this.ids)e=(t=r.split("#"))[0],i=t[1],n[e]||(n[e]=[]),n[e].push(i);return n},o.prototype.getRects=function(){var t,e,i,n={};for(var r in this.ids)e=(t=r.split("#"))[0],i=t[1],n[e]||(n[e]={}),n[e][i]=this.index[r];return n},o.prototype.addGlyph=function(t,e,i,n){if(!i)return null;var o=e+"#"+i.id;if(this.index[o])return this.ids[o].indexOf(t)<0&&this.ids[o].push(t),this.index[o];if(!i.bitmap)return null;var a=i.width+2*n,s=i.height+2*n,l=a+2,u=s+2;l+=4-l%4,u+=4-u%4;var c=this.atlas.packOne(l,u);if(c||(this.resize(),c=this.atlas.packOne(l,u)),!c)return r.warnOnce("glyph bitmap overflow"),null;this.index[o]=c,this.ids[o]=[t];for(var h=this.data,d=i.bitmap,f=0;f<s;f++)for(var p=this.width*(c.y+f+1)+c.x+1,m=a*f,v=0;v<a;v++)h[p+v]=d[m+v];return this.dirty=!0,c},o.prototype.resize=function(){var t=this.width,e=this.height;if(!(t>=2048||e>=2048)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=4,this.height*=4,this.atlas.resize(this.width,this.height);for(var i=new ArrayBuffer(this.width*this.height),n=0;n<e;n++){var r=new Uint8Array(this.data.buffer,e*n,t);new Uint8Array(i,e*n*4,t).set(r)}this.data=new Uint8Array(i)}},o.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},o.prototype.updateTexture=function(t){this.bind(t),this.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.dirty=!1)},e.exports=o},{"../util/util":212,"@mapbox/shelf-pack":2}],165:[function(t,e,i){"use strict";var n=t("../util/mapbox").normalizeGlyphsURL,r=t("../util/ajax"),o=t("../util/verticalize_punctuation"),a=t("../util/glyphs"),s=t("../symbol/glyph_atlas"),l=t("pbf"),u=function(t,e,i){this.advance=t.advance,this.left=t.left-i-1,this.top=t.top+i+1,this.rect=e},c=function(t){this.url=t&&n(t),this.atlases={},this.stacks={},this.loading={}};c.prototype.getSimpleGlyphs=function(t,e,i,n){var r=this;void 0===this.stacks[t]&&(this.stacks[t]={}),void 0===this.atlases[t]&&(this.atlases[t]=new s);for(var a={},l=this.stacks[t],c=this.atlases[t],h={},d=0,f=function(e){var n=Math.floor(e/256);if(l[n]){var r=l[n].glyphs[e],o=c.addGlyph(i,t,r,3);r&&(a[e]=new u(r,o,3))}else void 0===h[n]&&(h[n]=[],d++),h[n].push(e)},p=0;p<e.length;p++){var m=e[p],v=String.fromCharCode(m);f(m),o.lookup[v]&&f(o.lookup[v].charCodeAt(0))}d||n(void 0,a,t);var g=function(e,o,s){if(!e)for(var l=r.stacks[t][o]=s.stacks[0],f=0;f<h[o].length;f++){var p=h[o][f],m=l.glyphs[p],v=c.addGlyph(i,t,m,3);m&&(a[p]=new u(m,v,3))}--d||n(void 0,a,t)};for(var y in h)r.loadRange(t,y,g)},c.prototype.loadRange=function(t,e,i){if(256*e>65535)return i("glyphs > 65535 not supported");void 0===this.loading[t]&&(this.loading[t]={});var n=this.loading[t];if(n[e])n[e].push(i);else{n[e]=[i];var o=function(t,e,i,n){return n=n||"abc",i.replace("{s}",n[t.length%n.length]).replace("{fontstack}",t).replace("{range}",e)}(t,256*e+"-"+(256*e+255),this.url);r.getArrayBuffer(o,function(t,i){for(var r=!t&&new a(new l(i.data)),o=0;o<n[e].length;o++)n[e][o](t,e,r);delete n[e]})}},c.prototype.getGlyphAtlas=function(t){return this.atlases[t]},e.exports=c},{"../symbol/glyph_atlas":164,"../util/ajax":191,"../util/glyphs":203,"../util/mapbox":208,"../util/verticalize_punctuation":214,pbf:25}],166:[function(t,e,i){"use strict";e.exports=function(t){function e(e){s.push(t[e]),l++}function i(t,e,i){var n=a[t];return delete a[t],a[e]=n,s[n].geometry[0].pop(),s[n].geometry[0]=s[n].geometry[0].concat(i[0]),n}function n(t,e,i){var n=o[e];return delete o[e],o[t]=n,s[n].geometry[0].shift(),s[n].geometry[0]=i[0].concat(s[n].geometry[0]),n}function r(t,e,i){var n=i?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var o={},a={},s=[],l=0,u=0;u<t.length;u++){var c=t[u],h=c.geometry,d=c.text;if(d){var f=r(d,h),p=r(d,h,!0);if(f in a&&p in o&&a[f]!==o[p]){var m=n(f,p,h),v=i(f,p,s[m].geometry);delete o[f],delete a[p],a[r(d,s[v].geometry,!0)]=v,s[m].geometry=null}else f in a?i(f,p,h):p in o?n(f,p,h):(e(u),o[f]=l-1,a[p]=l-1)}else e(u)}return s.filter(function(t){return t.geometry})}},{}],167:[function(t,e,i){"use strict";function n(t,e,i,n,r,o,a,s,l,u,c){this.anchorPoint=t,this.tl=e,this.tr=i,this.bl=n,this.br=r,this.tex=o,this.anchorAngle=a,this.glyphAngle=s,this.minScale=l,this.maxScale=u,this.writingMode=c}function r(t,e,i,n,r,s){var l=!s;i<0&&(s=!s),s&&r++;var u=new o(e.x,e.y),c=n[r],h=1/0;i=Math.abs(i);for(var d=a;;){var f=u.dist(c),p=i/f,m=Math.atan2(c.y-u.y,c.x-u.x);if(s||(m+=Math.PI),t.push({anchorPoint:u,offset:l?Math.PI:0,minScale:p,maxScale:h,angle:(m+2*Math.PI)%(2*Math.PI)}),p<=d)break;for(u=c;u.equals(c);)if(!(c=n[r+=s?1:-1]))return p;var v=c.sub(u)._unit();u=u.sub(v._mult(f)),h=p}return d}var o=t("point-geometry");e.exports={getIconQuads:function(t,e,i,r,s,l,u,c,h){var d,f,p,m,v=e.image.rect,g=s.layout,y=e.left-1,_=y+v.w/e.image.pixelRatio,b=e.top-1,x=b+v.h/e.image.pixelRatio;if("none"!==g["icon-text-fit"]&&u){var w=_-y,S=x-b,M=g["text-size"]/24,E=u.left*M,z=u.right*M,k=u.top*M,T=z-E,O=u.bottom*M-k,C=g["icon-text-fit-padding"][0],P=g["icon-text-fit-padding"][1],A=g["icon-text-fit-padding"][2],I=g["icon-text-fit-padding"][3],L="width"===g["icon-text-fit"]?.5*(O-S):0,D="height"===g["icon-text-fit"]?.5*(T-w):0,R="width"===g["icon-text-fit"]||"both"===g["icon-text-fit"]?T:w,j="height"===g["icon-text-fit"]||"both"===g["icon-text-fit"]?O:S;d=new o(E+D-I,k+L-C),f=new o(E+D+P+R,k+L-C),p=new o(E+D+P+R,k+L+A+j),m=new o(E+D-I,k+L+A+j)}else d=new o(y,b),f=new o(_,b),p=new o(_,x),m=new o(y,x);var F=s.getLayoutValue("icon-rotate",c,h)*Math.PI/180;if(l){var B=r[t.segment];if(t.y===B.y&&t.x===B.x&&t.segment+1<r.length){var N=r[t.segment+1];F+=Math.atan2(t.y-N.y,t.x-N.x)+Math.PI}else F+=Math.atan2(t.y-B.y,t.x-B.x)}if(F){var q=Math.sin(F),V=Math.cos(F),H=[V,-q,q,V];d=d.matMult(H),f=f.matMult(H),m=m.matMult(H),p=p.matMult(H)}return[new n(new o(t.x,t.y),d,f,m,p,e.image.rect,0,0,a,1/0)]},getGlyphQuads:function(t,e,i,s,l,u){for(var c=l.layout["text-rotate"]*Math.PI/180,h=l.layout["text-keep-upright"],d=e.positionedGlyphs,f=[],p=0;p<d.length;p++){var m=d[p],v=m.glyph;if(v){var g=v.rect;if(g){var y=(m.x+v.advance/2)*i,_=void 0,b=a;u?(b=r(_=[],t,y,s,t.segment,!0),h&&(b=Math.min(b,r(_,t,y,s,t.segment,!1)))):_=[{anchorPoint:new o(t.x,t.y),offset:0,angle:0,maxScale:1/0,minScale:a}];var x=m.x+v.left,w=m.y-v.top,S=x+g.w,M=w+g.h,E=new o(m.x,v.advance/2),z=new o(x,w),k=new o(S,w),T=new o(x,M),O=new o(S,M);0!==m.angle&&(z._sub(E)._rotate(m.angle)._add(E),k._sub(E)._rotate(m.angle)._add(E),T._sub(E)._rotate(m.angle)._add(E),O._sub(E)._rotate(m.angle)._add(E));for(var C=0;C<_.length;C++){var P=_[C],A=z,I=k,L=T,D=O;if(c){var R=Math.sin(c),j=Math.cos(c),F=[j,-R,R,j];A=A.matMult(F),I=I.matMult(F),L=L.matMult(F),D=D.matMult(F)}var B=Math.max(P.minScale,b),N=(t.angle+P.offset+2*Math.PI)%(2*Math.PI),q=(P.angle+P.offset+2*Math.PI)%(2*Math.PI);f.push(new n(P.anchorPoint,A,I,L,D,g,N,q,B,P.maxScale,e.writingMode))}}}}return f},SymbolQuad:n};var a=.5},{"point-geometry":26}],168:[function(t,e,i){"use strict";var n=t("../util/token");e.exports=function(t,e,i){var r=t.getLayoutValue("text-field",e,i);if(t.isLayoutValueFeatureConstant("text-field")&&(r=n(i,r)),r){r=r.toString();var o=t.getLayoutValue("text-transform",e,i);return"uppercase"===o?r=r.toLocaleUpperCase():"lowercase"===o&&(r=r.toLocaleLowerCase()),r}}},{"../util/token":211}],169:[function(t,e,i){"use strict";function n(t,e,i,n,r){this.codePoint=t,this.x=e,this.y=i,this.glyph=n||null,this.angle=r}function r(t,e,i,n){var r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function o(t,e){var i=0;return 10===t&&(i-=1e4),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function a(t,e,i,n,o,a){for(var s=null,l=r(e,i,o,a),u=0,c=n;u<c.length;u+=1){var h=c[u],d=r(e-h.x,i,o,a)+h.badness;d<=l&&(s=h,l=d)}return{index:t,x:e,priorBreak:s,badness:l}}function s(t,e,i,n){if(!i)return[];if(!t)return[];for(var r=[],s=function(t,e,i,n){var r=0;for(var o in t){var a=n[t.charCodeAt(o)];a&&(r+=a.advance+e)}return r/Math.max(1,Math.ceil(r/i))}(t,e,i,n),l=0,c=0;c<t.length;c++){var h=t.charCodeAt(c),d=n[h];d&&!f[h]&&(l+=d.advance+e),c<t.length-1&&(p[h]||u.charAllowsIdeographicBreaking(h))&&r.push(a(c+1,l,s,r,o(h,t.charCodeAt(c+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(a(t.length,l,s,r,0,!0))}function l(t,e,i,n,r){if(r)for(var o=e[t[n].codePoint].advance,a=(t[n].x+o)*r,s=i;s<=n;s++)t[s].x-=a}var u=t("../util/script_detection"),c=t("../util/verticalize_punctuation"),h=t("../source/rtl_text_plugin"),d={horizontal:1,vertical:2};e.exports={shapeText:function(t,e,i,r,o,a,f,p,m,v,g){var y=t.trim();g===d.vertical&&(y=c(y));var _=[],b=new function(t,e,i,n,r,o,a){this.positionedGlyphs=t,this.text=e,this.top=i,this.bottom=n,this.left=r,this.right=o,this.writingMode=a}(_,y,m[1],m[1],m[0],m[0],g);return function(t,e,i,r,o,a,s,c,h,f,p){var m=0,v=-17,g=0,y=t.positionedGlyphs;for(var _ in i){var b=i[_].trim();if(b.length){for(var x=y.length,w=0;w<b.length;w++){var S=b.charCodeAt(w),M=e[S];M&&(u.charHasUprightVerticalOrientation(S)&&h!==d.horizontal?(y.push(new n(S,m,0,M,-Math.PI/2)),m+=p+f):(y.push(new n(S,m,v,M,0)),m+=M.advance+f))}if(y.length!==x){var E=m-f;g=Math.max(E,g),l(y,e,x,y.length-1,s)}m=0,v+=r}else v+=r}!function(t,e,i,n,r,o,a,s){for(var l=(e-i)*r+s[0],u=(-n*a+.5)*o+s[1],c=0;c<t.length;c++)t[c].x+=l,t[c].y+=u}(y,s,o,a,g,r,i.length,c);var z=i.length*r;t.top+=-a*z,t.bottom=t.top+z,t.left+=-o*g,t.right=t.left+g}(b,e,h.processBidirectionalText?h.processBidirectionalText(y,s(y,p,i,e)):function(t,e){for(var i=[],n=0,r=0,o=e;r<o.length;r+=1){var a=o[r];i.push(t.substring(n,a)),n=a}return n<t.length&&i.push(t.substring(n,t.length)),i}(y,s(y,p,i,e)),r,o,a,f,m,g,p,v),!!_.length&&b},shapeIcon:function(t,e){if(!t||!t.rect)return null;var i=e[0],n=e[1],r=i-t.width/2,o=r+t.width,a=n-t.height/2;return new function(t,e,i,n,r){this.image=t,this.top=e,this.bottom=i,this.left=n,this.right=r}(t,a,a+t.height,r,o)},WritingMode:d};var f={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},p={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0}},{"../source/rtl_text_plugin":90,"../util/script_detection":209,"../util/verticalize_punctuation":214}],170:[function(t,e,i){"use strict";var n=t("@mapbox/shelf-pack"),r=t("../util/browser"),o=t("../util/util"),a=t("../util/window"),s=function(t){function e(e,i){t.call(this),this.width=e,this.height=i,this.shelfPack=new n(e,i),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.allocateImage=function(t,e){var i=(t/=this.pixelRatio)+2+(4-(t+2)%4),n=(e/=this.pixelRatio)+2+(4-(e+2)%4),r=this.shelfPack.packOne(i,n);return r||(o.warnOnce("SpriteAtlas out of space."),null)},e.prototype.addImage=function(t,e,i){var n,o,s;if(e instanceof a.HTMLImageElement?(n=e.width,o=e.height,e=r.getImageData(e),s=this.pixelRatio):(n=i.width,o=i.height,s=i.pixelRatio||this.pixelRatio),ArrayBuffer.isView(e)&&(e=new Uint32Array(e.buffer)),!(e instanceof Uint32Array))return this.fire("error",{error:new Error("Image provided in an invalid format. Supported formats are HTMLImageElement, ImageData, and ArrayBufferView.")});if(this.images[t])return this.fire("error",{error:new Error("An image with this name already exists.")});var l=this.allocateImage(n,o);if(!l)return this.fire("error",{error:new Error("There is not enough space to add this image.")});var u={rect:l,width:n/s,height:o/s,sdf:!1,pixelRatio:1};this.images[t]=u,this.copy(e,n,l,{pixelRatio:s,x:0,y:0,width:n,height:o},!1),this.fire("data",{dataType:"style"})},e.prototype.removeImage=function(t){var e=this.images[t];return delete this.images[t],e?(this.shelfPack.unref(e.rect),void this.fire("data",{dataType:"style"})):this.fire("error",{error:new Error("No image with this name exists.")})},e.prototype.getImage=function(t,e){if(this.images[t])return this.images[t];if(!this.sprite)return null;var i=this.sprite.getSpritePosition(t);if(!i.width||!i.height)return null;var n=this.allocateImage(i.width,i.height);if(!n)return null;var r={rect:n,width:i.width/i.pixelRatio,height:i.height/i.pixelRatio,sdf:i.sdf,pixelRatio:i.pixelRatio/this.pixelRatio};if(this.images[t]=r,!this.sprite.imgData)return null;var o=new Uint32Array(this.sprite.imgData.buffer);return this.copy(o,this.sprite.width,n,i,e),r},e.prototype.getPosition=function(t,e){var i=this.getImage(t,e),n=i&&i.rect;if(!n)return null;var r=i.width*i.pixelRatio,o=i.height*i.pixelRatio;return{size:[i.width,i.height],tl:[(n.x+1)/this.width,(n.y+1)/this.height],br:[(n.x+1+r)/this.width,(n.y+1+o)/this.height]}},e.prototype.allocate=function(){if(!this.data){var t=Math.floor(this.width*this.pixelRatio),e=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(t*e);for(var i=0;i<this.data.length;i++)this.data[i]=0}},e.prototype.copy=function(t,e,i,n,r){this.allocate();var o=this.data;(function(t,e,i,n,r,o,a,s,l,u,c){var h,d,f=n*e+i,p=s*o+a;if(c)for(p-=o,d=-1;d<=u;d++,p+=o)for(f=((d+u)%u+n)*e+i,h=-1;h<=l;h++)r[p+h]=t[f+(h+l)%l];else for(d=0;d<u;d++,f+=e,p+=o)for(h=0;h<l;h++)r[p+h]=t[f+h]})(t,e,n.x,n.y,o,this.width*this.pixelRatio,(i.x+1)*this.pixelRatio,(i.y+1)*this.pixelRatio,n.width,n.height,r),this.dirty=!0},e.prototype.setSprite=function(t){t&&(this.pixelRatio=r.devicePixelRatio>1?2:1,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio)),this.sprite=t},e.prototype.addIcons=function(t,e){for(var i=0;i<t.length;i++)this.getImage(t[i]);e(null,this.images)},e.prototype.bind=function(t,e){var i=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i=!0);var n=e?t.LINEAR:t.NEAREST;n!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),this.filter=n),this.dirty&&(this.allocate(),i?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},e}(t("../util/evented"));e.exports=s},{"../util/browser":192,"../util/evented":200,"../util/util":212,"../util/window":194,"@mapbox/shelf-pack":2}],171:[function(t,e,i){"use strict";var n=t("../util/dom"),r=t("point-geometry"),o={scrollZoom:t("./handler/scroll_zoom"),boxZoom:t("./handler/box_zoom"),dragRotate:t("./handler/drag_rotate"),dragPan:t("./handler/drag_pan"),keyboard:t("./handler/keyboard"),doubleClickZoom:t("./handler/dblclick_zoom"),touchZoomRotate:t("./handler/touch_zoom_rotate")};e.exports=function(t,e){function i(){d=null}function a(e,i){var r=n.mousePos(l,i);return t.fire(e,{lngLat:t.unproject(r),point:r,originalEvent:i})}function s(e,i){var o=n.touchPos(l,i),a=o.reduce(function(t,e,i,n){return t.add(e.div(n.length))},new r(0,0));return t.fire(e,{lngLat:t.unproject(a),point:a,lngLats:o.map(function(e){return t.unproject(e)},this),points:o,originalEvent:i})}var l=t.getCanvasContainer(),u=null,c=!1,h=null,d=null;for(var f in o)t[f]=new o[f](t,e),e.interactive&&e[f]&&t[f].enable(e[f]);l.addEventListener("mouseout",function(t){a("mouseout",t)},!1),l.addEventListener("mousedown",function(e){t.stop(),h=n.mousePos(l,e),a("mousedown",e),c=!0},!1),l.addEventListener("mouseup",function(e){var i=t.dragRotate&&t.dragRotate.isActive();u&&!i&&a("contextmenu",u),u=null,c=!1,a("mouseup",e)},!1),l.addEventListener("mousemove",function(e){if(!(t.dragPan&&t.dragPan.isActive()||t.dragRotate&&t.dragRotate.isActive())){for(var i=e.toElement||e.target;i&&i!==l;)i=i.parentNode;i===l&&a("mousemove",e)}},!1),l.addEventListener("touchstart",function(e){t.stop(),s("touchstart",e),!e.touches||e.touches.length>1||(d?(clearTimeout(d),d=null,a("dblclick",e)):d=setTimeout(i,300))},!1),l.addEventListener("touchend",function(t){s("touchend",t)},!1),l.addEventListener("touchmove",function(t){s("touchmove",t)},!1),l.addEventListener("touchcancel",function(t){s("touchcancel",t)},!1),l.addEventListener("click",function(t){n.mousePos(l,t).equals(h)&&a("click",t)},!1),l.addEventListener("dblclick",function(t){a("dblclick",t),t.preventDefault()},!1),l.addEventListener("contextmenu",function(e){var i=t.dragRotate&&t.dragRotate.isActive();c||i?c&&(u=e):a("contextmenu",e),e.preventDefault()},!1)}},{"../util/dom":199,"./handler/box_zoom":179,"./handler/dblclick_zoom":180,"./handler/drag_pan":181,"./handler/drag_rotate":182,"./handler/keyboard":183,"./handler/scroll_zoom":184,"./handler/touch_zoom_rotate":185,"point-geometry":26}],172:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/interpolate"),o=t("../util/browser"),a=t("../geo/lng_lat"),s=t("../geo/lng_lat_bounds"),l=t("point-geometry"),u=function(t){function e(e,i){t.call(this),this.moving=!1,this.transform=e,this._bearingSnap=i.bearingSnap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e),this},e.prototype.panBy=function(t,e,i){return this.panTo(this.transform.center,n.extend({offset:l.convert(t).mult(-1)},e),i),this},e.prototype.panTo=function(t,e,i){return this.easeTo(n.extend({center:t},e),i)},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},e.prototype.zoomTo=function(t,e,i){return this.easeTo(n.extend({zoom:t},e),i)},e.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},e.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},e.prototype.getBearing=function(){return this.transform.bearing},e.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},e.prototype.rotateTo=function(t,e,i){return this.easeTo(n.extend({bearing:t},e),i)},e.prototype.resetNorth=function(t,e){return this.rotateTo(0,n.extend({duration:1e3},t),e),this},e.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},e.prototype.getPitch=function(){return this.transform.pitch},e.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},e.prototype.fitBounds=function(t,e,i){if("number"==typeof(e=n.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){var r=e.padding;e.padding={top:r,bottom:r,right:r,left:r}}if(n.deepEqual(Object.keys(e.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){t=s.convert(t);var o=[e.padding.left-e.padding.right,e.padding.top-e.padding.bottom],a=Math.min(e.padding.right,e.padding.left),u=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+o[0],e.offset[1]+o[1]];var c=l.convert(e.offset),h=this.transform,d=h.project(t.getNorthWest()),f=h.project(t.getSouthEast()),p=f.sub(d),m=(h.width-2*a-2*Math.abs(c.x))/p.x,v=(h.height-2*u-2*Math.abs(c.y))/p.y;return v<0||m<0?void n.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."):(e.center=h.unproject(d.add(f).div(2)),e.zoom=Math.min(h.scaleZoom(h.scale*Math.min(m,v)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,i):this.flyTo(e,i))}n.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},e.prototype.jumpTo=function(t,e){this.stop();var i=this.transform,n=!1,r=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),"center"in t&&(i.center=a.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),n&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),r&&this.fire("rotate",e),o&&this.fire("pitch",e),this.fire("moveend",e)},e.prototype.easeTo=function(t,e){var i=this;this.stop(),t=n.extend({offset:[0,0],duration:500,easing:n.ease},t);var o,s,u=this.transform,c=l.convert(t.offset),h=this.getZoom(),d=this.getBearing(),f=this.getPitch(),p="zoom"in t?+t.zoom:h,m="bearing"in t?this._normalizeBearing(t.bearing,d):d,v="pitch"in t?+t.pitch:f;"center"in t?(o=a.convert(t.center),s=u.centerPoint.add(c)):"around"in t?(o=a.convert(t.around),s=u.locationPoint(o)):(s=u.centerPoint.add(c),o=u.pointLocation(s));var g=u.locationPoint(o);return!1===t.animate&&(t.duration=0),this.zooming=p!==h,this.rotating=d!==m,this.pitching=v!==f,t.smoothEasing&&0!==t.duration&&(t.easing=this._smoothOutEasing(t.duration)),t.noMoveStart||(this.moving=!0,this.fire("movestart",e)),this.zooming&&this.fire("zoomstart",e),clearTimeout(this._onEaseEnd),this._ease(function(t){this.zooming&&(u.zoom=r(h,p,t)),this.rotating&&(u.bearing=r(d,m,t)),this.pitching&&(u.pitch=r(f,v,t)),u.setLocationAtPoint(o,g.add(s.sub(g)._mult(t))),this.fire("move",e),this.zooming&&this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){t.delayEndEvents?i._onEaseEnd=setTimeout(i._easeToEnd.bind(i,e),t.delayEndEvents):i._easeToEnd(e)},t),this},e.prototype._easeToEnd=function(t){var e=this.zooming;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),this.fire("moveend",t)},e.prototype.flyTo=function(t,e){function i(t){var e=(S*S-w*w+(t?-1:1)*k*k*M*M)/(2*(t?S:w)*k*M);return Math.log(Math.sqrt(e*e+1)-e)}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},t);var u=this.transform,c=l.convert(t.offset),h=this.getZoom(),d=this.getBearing(),f=this.getPitch(),p="center"in t?a.convert(t.center):this.getCenter(),m="zoom"in t?+t.zoom:h,v="bearing"in t?this._normalizeBearing(t.bearing,d):d,g="pitch"in t?+t.pitch:f;Math.abs(u.center.lng)+Math.abs(p.lng)>180&&(u.center.lng>0&&p.lng<0?p.lng+=360:u.center.lng<0&&p.lng>0&&(p.lng-=360));var y=u.zoomScale(m-h),_=u.point,b="center"in t?u.project(p).sub(c.div(y)):_,x=t.curve,w=Math.max(u.width,u.height),S=w/y,M=b.sub(_).mag();if("minZoom"in t){var E=n.clamp(Math.min(t.minZoom,h,m),u.minZoom,u.maxZoom),z=w/u.zoomScale(E-h);x=Math.sqrt(z/M*2)}var k=x*x,T=i(0),O=function(t){return s(T)/s(T+x*t)},C=function(t){return w*((s(T)*function(t){return o(t)/s(t)}(T+x*t)-o(T))/k)/M},P=(i(1)-T)/x;if(Math.abs(M)<1e-6){if(Math.abs(w-S)<1e-6)return this.easeTo(t,e);var A=S<w?-1:1;P=Math.abs(Math.log(S/w))/x,C=function(){return 0},O=function(t){return Math.exp(A*x*t)}}if("duration"in t)t.duration=+t.duration;else{var I="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*P/I}return this.moving=!0,this.zooming=!0,d!==v&&(this.rotating=!0),f!==g&&(this.pitching=!0),this.fire("movestart",e),this.fire("zoomstart",e),this._ease(function(t){var i=t*P,n=C(i),o=1/O(i);u.zoom=h+u.scaleZoom(o),u.center=u.unproject(_.add(b.sub(_).mult(n)).mult(o)),this.rotating&&(u.bearing=r(d,v,t)),this.pitching&&(u.pitch=r(f,g,t)),this.fire("move",e),this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.fire("zoomend",e),this.fire("moveend",e)},t),this},e.prototype.isEasing=function(){return!!this._abortFn},e.prototype.isMoving=function(){return this.moving},e.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},e.prototype._ease=function(t,e,i){this._finishFn=e,this._abortFn=o.timed(function(e){t.call(this,i.easing(e)),1===e&&this._finishEase()},!1===i.animate?0:i.duration,this)},e.prototype._finishEase=function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},e.prototype._normalizeBearing=function(t,e){t=n.wrap(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t},e.prototype._smoothOutEasing=function(t){var e=n.ease;if(this._prevEase){var i=this._prevEase,r=(Date.now()-i.start)/i.duration,o=i.easing(r+.01)-i.easing(r),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);e=n.bezier(a,s,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:t,easing:e},e},e}(t("../util/evented"));e.exports=u},{"../geo/lng_lat":62,"../geo/lng_lat_bounds":63,"../util/browser":192,"../util/evented":200,"../util/interpolate":204,"../util/util":212,"point-geometry":26}],173:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=function(t){this.options=t,r.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};o.prototype.getDefaultPosition=function(){return"bottom-right"},o.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},o.prototype._updateEditLink=function(){if(this._editLink||(this._editLink=this._container.querySelector(".mapbox-improve-map")),this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}},o.prototype._updateData=function(t){this._updateAttributions(t),this._updateEditLink()},o.prototype._updateAttributions=function(t){if(this._map.style&&(!t||"metadata"===t.sourceDataType)){var e=[],i=this._map.style.sourceCaches;for(var n in i){var r=i[n].getSource();r.attribution&&e.indexOf(r.attribution)<0&&e.push(r.attribution)}e.sort(function(t,e){return t.length-e.length}),e=e.filter(function(t,i){for(var n=i+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0}),this._container.innerHTML=e.join(" | "),this._editLink=null}},o.prototype._updateCompact=function(){var t=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[t?"add":"remove"]("compact")},e.exports=o},{"../../util/dom":199,"../../util/util":212}],174:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=function(){this._fullscreen=!1,r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.document&&(this._fullscreenchange="MSFullscreenChange")};a.prototype.onAdd=function(t){var e="mapboxgl-ctrl",i=this._container=n.create("div",e+" mapboxgl-ctrl-group"),r=this._fullscreenButton=n.create("button",e+"-icon "+e+"-fullscreen",this._container);return r.setAttribute("aria-label","Toggle fullscreen"),r.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),this._mapContainer=t.getContainer(),o.document.addEventListener(this._fullscreenchange,this._changeIcon),i},a.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=null,o.document.removeEventListener(this._fullscreenchange,this._changeIcon)},a.prototype._isFullscreen=function(){return this._fullscreen},a.prototype._changeIcon=function(t){if(t.target===this._mapContainer){this._fullscreen=!this._fullscreen;var e="mapboxgl-ctrl";this._fullscreenButton.classList.toggle(e+"-shrink"),this._fullscreenButton.classList.toggle(e+"-fullscreen")}},a.prototype._onClickFullscreen=function(){this._isFullscreen()?o.document.exitFullscreen?o.document.exitFullscreen():o.document.mozCancelFullScreen?o.document.mozCancelFullScreen():o.document.msExitFullscreen?o.document.msExitFullscreen():o.document.webkitCancelFullScreen&&o.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},e.exports=a},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],175:[function(t,e,i){"use strict";var n,r=t("../../util/evented"),o=t("../../util/dom"),a=t("../../util/window"),s=t("../../util/util"),l={enableHighAccuracy:!1,timeout:6e3},u=function(t){function e(e){t.call(this),this.options=e||{},s.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),function(t){void 0!==n?t(n):void 0!==a.navigator.permissions?a.navigator.permissions.query({name:"geolocation"}).then(function(e){n="denied"!==e.state,t(n)}):(n=!!a.navigator.geolocation,t(n))}(this._setupUI),this._container},e.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=void 0},e.prototype._onSuccess=function(t){this._map.jumpTo({center:[t.coords.longitude,t.coords.latitude],zoom:17,bearing:0,pitch:0}),this.fire("geolocate",t),this._finish()},e.prototype._onError=function(t){this.fire("error",t),this._finish()},e.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},e.prototype._setupUI=function(t){!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=o.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.watchPosition&&this._geolocateButton.setAttribute("aria-pressed",!1),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)))},e.prototype._onClickGeolocate=function(){var t=s.extend(l,this.options&&this.options.positionOptions||{});this.options.watchPosition?void 0!==this._geolocationWatchID?(this._geolocateButton.classList.remove("watching"),this._geolocateButton.setAttribute("aria-pressed",!1),a.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0):(this._geolocateButton.classList.add("watching"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=a.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)):(a.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,t),this._timeoutId=setTimeout(this._finish,1e4))},e}(r);e.exports=u},{"../../util/dom":199,"../../util/evented":200,"../../util/util":212,"../../util/window":194}],176:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=function(){r.bindAll(["_updateLogo"],this)};o.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl"),this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("sourcedata",this._updateLogo)},o.prototype.getDefaultPosition=function(){return"bottom-left"},o.prototype._updateLogo=function(t){if(t&&"metadata"===t.sourceDataType)if(!this._container.childNodes.length&&this._logoRequired()){var e=n.create("a","mapboxgl-ctrl-logo");e.target="_blank",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),this._container.appendChild(e),this._map.off("data",this._updateLogo)}else this._container.childNodes.length&&!this._logoRequired()&&this.onRemove()},o.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t){if(t[e].getSource().mapbox_logo)return!0}return!1}},e.exports=o},{"../../util/dom":199,"../../util/util":212}],177:[function(t,e,i){"use strict";function n(t){return new o.MouseEvent(t.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:t.detail,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX,movementY:t.movementY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey})}var r=t("../../util/dom"),o=t("../../util/window"),a=t("../../util/util"),s="mapboxgl-ctrl",l=function(){a.bindAll(["_rotateCompassArrow"],this)};l.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},l.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div",s+" "+s+"-group",t.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(s+"-icon "+s+"-zoom-in","Zoom In",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(s+"-icon "+s+"-zoom-out","Zoom Out",t.zoomOut.bind(t)),this._compass=this._createButton(s+"-icon "+s+"-compass","Reset North",t.resetNorth.bind(t)),this._compassArrow=r.create("span",s+"-compass-arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},l.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},l.prototype._onContextMenu=function(t){t.preventDefault()},l.prototype._onCompassDown=function(t){0===t.button&&(r.disableDrag(),o.document.addEventListener("mousemove",this._onCompassMove),o.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(n(t)),t.stopPropagation())},l.prototype._onCompassMove=function(t){0===t.button&&(this._map.getCanvasContainer().dispatchEvent(n(t)),t.stopPropagation())},l.prototype._onCompassUp=function(t){0===t.button&&(o.document.removeEventListener("mousemove",this._onCompassMove),o.document.removeEventListener("mouseup",this._onCompassUp),r.enableDrag(),this._map.getCanvasContainer().dispatchEvent(n(t)),t.stopPropagation())},l.prototype._createButton=function(t,e,i){var n=r.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",e),n.addEventListener("click",function(){i()}),n},e.exports=l},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],178:[function(t,e,i){"use strict";function n(t,e,i){var n=i&&i.maxWidth||100,o=t._container.clientHeight/2,a=function(t,e){var i=Math.PI/180,n=t.lat*i,r=e.lat*i,o=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-t.lng)*i);return 6371e3*Math.acos(Math.min(o,1))}(t.unproject([0,o]),t.unproject([n,o]));if(i&&"imperial"===i.unit){var s=3.2808*a;if(s>5280)r(e,n,s/5280,"mi");else r(e,n,s,"ft")}else r(e,n,a,"m")}function r(t,e,i,n){var r=function(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),i=t/e;return e*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)}(i),o=r/i;"m"===n&&r>=1e3&&(r/=1e3,n="km"),t.style.width=e*o+"px",t.innerHTML=r+n}var o=t("../../util/dom"),a=t("../../util/util"),s=function(t){this.options=t,a.bindAll(["_onMove"],this)};s.prototype.getDefaultPosition=function(){return"bottom-left"},s.prototype._onMove=function(){n(this._map,this._container,this.options)},s.prototype.onAdd=function(t){return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},s.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},e.exports=s},{"../../util/dom":199,"../../util/util":212}],179:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../geo/lng_lat_bounds"),o=t("../../util/util"),a=t("../../util/window"),s=function(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),o.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onMouseDown,!1),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},s.prototype._onMouseDown=function(t){t.shiftKey&&0===t.button&&(a.document.addEventListener("mousemove",this._onMouseMove,!1),a.document.addEventListener("keydown",this._onKeyDown,!1),a.document.addEventListener("mouseup",this._onMouseUp,!1),n.disableDrag(),this._startPos=n.mousePos(this._el,t),this._active=!0)},s.prototype._onMouseMove=function(t){var e=this._startPos,i=n.mousePos(this._el,t);this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var r=Math.min(e.x,i.x),o=Math.max(e.x,i.x),a=Math.min(e.y,i.y),s=Math.max(e.y,i.y);n.setTransform(this._box,"translate("+r+"px,"+a+"px)"),this._box.style.width=o-r+"px",this._box.style.height=s-a+"px"},s.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,i=n.mousePos(this._el,t),o=(new r).extend(this._map.unproject(e)).extend(this._map.unproject(i));this._finish(),e.x===i.x&&e.y===i.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(o,{linear:!0}).fire("boxzoomend",{originalEvent:t,boxZoomBounds:o})}},s.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},s.prototype._finish=function(){this._active=!1,a.document.removeEventListener("mousemove",this._onMouseMove,!1),a.document.removeEventListener("keydown",this._onKeyDown,!1),a.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),n.enableDrag()},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},e.exports=s},{"../../geo/lng_lat_bounds":63,"../../util/dom":199,"../../util/util":212,"../../util/window":194}],180:[function(t,e,i){"use strict";var n=function(t){this._map=t,this._onDblClick=this._onDblClick.bind(this)};n.prototype.isEnabled=function(){return!!this._enabled},n.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},n.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},n.prototype._onDblClick=function(t){this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},e.exports=n},{}],181:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=r.bezier(0,0,.3,1),s=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},s.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(o.document.addEventListener("touchmove",this._onMove),o.document.addEventListener("touchend",this._onTouchEnd)):(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onMouseUp)),o.addEventListener("blur",this._onMouseUp),this._active=!1,this._startPos=this._pos=n.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]])},s.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t));var e=n.mousePos(this._el,t),i=this._map;i.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),e]),i.transform.setLocationAtPoint(i.transform.pointLocation(this._pos),e),this._fireEvent("drag",t),this._fireEvent("move",t),this._pos=e,t.preventDefault()}},s.prototype._onUp=function(t){var e=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",t),this._drainInertiaBuffer();var i=function(){e._map.moving=!1,e._fireEvent("moveend",t)},n=this._inertia;if(n.length<2)return void i();var r=n[n.length-1],o=n[0],s=r[1].sub(o[1]),l=(r[0]-o[0])/1e3;if(0===l||r[1].equals(o[1]))return void i();var u=s.mult(.3/l),c=u.mag();c>1400&&(c=1400,u._unit()._mult(c));var h=c/750,d=u.mult(-h/2);this._map.panBy(d,{duration:1e3*h,easing:a,noMoveStart:!0},{originalEvent:t})}},s.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onMouseUp),o.removeEventListener("blur",this._onMouseUp))},s.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onTouchEnd))},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},s.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragRotate&&e.dragRotate.isActive())return!0;if(t.touches)return t.touches.length>1;if(t.ctrlKey)return!0;return"mousemove"===t.type?!1&t.buttons:t.button&&0!==t.button},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},e.exports=s},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],182:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=r.bezier(0,0,.25,1),s=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._bearingSnap=e.bearingSnap,this._pitchWithRotate=!1!==e.pitchWithRotate,r.bindAll(["_onDown","_onMove","_onUp"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},s.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onUp),o.addEventListener("blur",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=n.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault())},s.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t));var e=this._map;e.stop();var i=this._pos,r=n.mousePos(this._el,t),o=.8*(i.x-r.x),a=-.5*(i.y-r.y),s=e.getBearing()-o,l=e.getPitch()-a,u=this._inertia,c=u[u.length-1];this._drainInertiaBuffer(),u.push([Date.now(),e._normalizeBearing(s,c[1])]),e.transform.bearing=s,this._pitchWithRotate&&(e.transform.pitch=l),this._fireEvent("rotate",t),this._fireEvent("move",t),this._pos=r}},s.prototype._onUp=function(t){var e=this;if(!this._ignoreEvent(t)&&(o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onUp),o.removeEventListener("blur",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),r=this._inertia,s=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):(e._map.moving=!1,e._fireEvent("moveend",t))};if(r.length<2)return void s();var l=r[0],u=r[r.length-1],c=r[r.length-2],h=i._normalizeBearing(n,c[1]),d=u[1]-l[1],f=d<0?-1:1,p=(u[0]-l[0])/1e3;if(0===d||0===p)return void s();var m=Math.abs(d*(.25/p));m>180&&(m=180);var v=m/180;h+=f*m*(v/2),Math.abs(i._normalizeBearing(h,0))<this._bearingSnap&&(h=i._normalizeBearing(0,h)),i.rotateTo(h,{duration:1e3*v,easing:a,noMoveStart:!0},{originalEvent:t})}},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},s.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragPan&&e.dragPan.isActive())return!0;if(t.touches)return t.touches.length>1;var i=t.ctrlKey?1:2,n=t.ctrlKey?0:2,r=t.button;return"undefined"!=typeof InstallTrigger&&2===t.button&&t.ctrlKey&&o.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(r=0),"mousemove"===t.type?t.buttons&0===i:!this.isActive()&&r!==n},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>0&&e-t[0][0]>160;)t.shift()},e.exports=s},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],183:[function(t,e,i){"use strict";function n(t){return t*(2-t)}var r=function(t){this._map=t,this._el=t.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};r.prototype.isEnabled=function(){return!!this._enabled},r.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},r.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},r.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,r=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?r=-1:(a=1,t.preventDefault())}var s=this._map,l=s.getZoom(),u={duration:300,delayEndEvents:500,easing:n,zoom:e?Math.round(l)+e*(t.shiftKey?2:1):l,bearing:s.getBearing()+15*i,pitch:s.getPitch()+10*r,offset:[100*-o,100*-a],center:s.getCenter()};s.easeTo(u,{originalEvent:t})}},e.exports=r},{}],184:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/browser"),a=t("../../util/window"),s=a.navigator.userAgent.toLowerCase(),l=-1!==s.indexOf("firefox"),u=-1!==s.indexOf("safari")&&-1===s.indexOf("chrom"),c=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onWheel","_onTimeout"],this)};c.prototype.isEnabled=function(){return!!this._enabled},c.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},c.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},c.prototype._onWheel=function(t){var e;"wheel"===t.type?(e=t.deltaY,l&&t.deltaMode===a.WheelEvent.DOM_DELTA_PIXEL&&(e/=o.devicePixelRatio),t.deltaMode===a.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,u&&(e/=3));var i=o.now(),r=i-(this._time||0);this._pos=n.mousePos(this._el,t),this._time=i,0!==e&&e%4.000244140625==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(r*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&this._zoom(-e,t),t.preventDefault()},c.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},c.prototype._zoom=function(t,e){if(0!==t){var i=this._map,n=2/(1+Math.exp(-Math.abs(t/100)));t<0&&0!==n&&(n=1/n);var r=i.ease?i.ease.to:i.transform.scale,o=i.transform.scaleZoom(r*n);i.zoomTo(o,{duration:"wheel"===this._type?200:0,around:this._aroundCenter?i.getCenter():i.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:e})}},e.exports=c},{"../../util/browser":192,"../../util/dom":199,"../../util/util":212,"../../util/window":194}],185:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=r.bezier(0,0,.15,1),s=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onStart","_onMove","_onEnd"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},s.prototype.disableRotation=function(){this._rotationDisabled=!0},s.prototype.enableRotation=function(){this._rotationDisabled=!1},s.prototype._onStart=function(t){if(2===t.touches.length){var e=n.mousePos(this._el,t.touches[0]),i=n.mousePos(this._el,t.touches[1]);this._startVec=e.sub(i),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],o.document.addEventListener("touchmove",this._onMove,!1),o.document.addEventListener("touchend",this._onEnd,!1)}},s.prototype._onMove=function(t){if(2===t.touches.length){var e=n.mousePos(this._el,t.touches[0]),i=n.mousePos(this._el,t.touches[1]),r=e.add(i).div(2),o=e.sub(i),a=o.mag()/this._startVec.mag(),s=this._rotationDisabled?0:180*o.angleWith(this._startVec)/Math.PI,l=this._map;if(this._gestureIntent){var u={duration:0,around:l.unproject(r)};"rotate"===this._gestureIntent&&(u.bearing=this._startBearing+s),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(u.zoom=l.transform.scaleZoom(this._startScale*a)),l.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),a,r]),l.easeTo(u,{originalEvent:t})}else{var c=Math.abs(1-a)>.15;Math.abs(s)>4?this._gestureIntent="rotate":c&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=o,this._startScale=l.transform.scale,this._startBearing=l.transform.bearing)}t.preventDefault()}},s.prototype._onEnd=function(t){o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,i=this._map;if(e.length<2)i.snapToNorth({},{originalEvent:t});else{var n=e[e.length-1],r=e[0],s=i.transform.scaleZoom(this._startScale*n[1]),l=i.transform.scaleZoom(this._startScale*r[1]),u=s-l,c=(n[0]-r[0])/1e3,h=n[2];if(0!==c&&s!==l){var d=.15*u/c;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var f=1e3*Math.abs(d/(12*.15)),p=s+d*f/2e3;p<0&&(p=0),i.easeTo({zoom:p,duration:f,easing:a,around:this._aroundCenter?i.getCenter():i.unproject(h)},{originalEvent:t})}else i.snapToNorth({},{originalEvent:t})}},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now();t.length>2&&e-t[0][0]>160;)t.shift()},e.exports=s},{"../../util/dom":199,"../../util/util":212,"../../util/window":194}],186:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/window"),o=function(){n.bindAll(["_onHashChange","_updateHash"],this)};o.prototype.addTo=function(t){return this._map=t,r.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},o.prototype.remove=function(){return r.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},o.prototype._onHashChange=function(){var t=r.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},o.prototype._updateHash=function(){var t=this._map.getCenter(),e=this._map.getZoom(),i=this._map.getBearing(),n=this._map.getPitch(),o=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),a="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(o)+"/"+t.lng.toFixed(o);(i||n)&&(a+="/"+Math.round(10*i)/10),n&&(a+="/"+Math.round(n)),r.history.replaceState("","",a)},e.exports=o},{"../util/util":212,"../util/window":194}],187:[function(t,e,i){"use strict";function n(t){t.parentNode&&t.parentNode.removeChild(t)}var r=t("../util/util"),o=t("../util/browser"),a=t("../util/window"),s=t("../util/dom"),l=t("../style/style"),u=t("../style/animation_loop"),c=t("../render/painter"),h=t("../geo/transform"),d=t("./hash"),f=t("./bind_handlers"),p=t("./camera"),m=t("../geo/lng_lat"),v=t("../geo/lng_lat_bounds"),g=t("point-geometry"),y=t("./control/attribution_control"),_=t("./control/logo_control"),b=t("mapbox-gl-supported"),x={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0},w=function(t){function e(e){var i=this;if(null!=(e=r.extend({},x,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var n=new h(e.minZoom,e.maxZoom,e.renderWorldCopies);if(t.call(this,n,e),this._interactive=e.interactive,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,"string"==typeof e.container){if(this._container=a.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else this._container=e.container;this.animationLoop=new u,e.maxBounds&&this.setMaxBounds(e.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){i.animationLoop.set(300),i._rerender()}),void 0!==a&&(a.addEventListener("online",this._onWindowOnline,!1),a.addEventListener("resize",this._onWindowResize,!1)),f(this,e),this._hash=e.hash&&(new d).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this._classes=[],this.resize(),e.classes&&this.setClasses(e.classes),e.style&&this.setStyle(e.style),e.attributionControl&&this.addControl(new y),this.addControl(new _,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return e.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),n=this._controlPositions[e];return-1!==e.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},e.prototype.removeControl=function(t){return t.onRemove(this),this},e.prototype.addClass=function(t,e){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0||""===t?this:(this._classes.push(t),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.removeClass=function(t,e){r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");var i=this._classes.indexOf(t);return i<0||""===t?this:(this._classes.splice(i,1),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.setClasses=function(t,e){r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");for(var i={},n=0;n<t.length;n++)""!==t[n]&&(i[t[n]]=!0);return this._classes=Object.keys(i),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0)},e.prototype.hasClass=function(t){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0},e.prototype.getClasses=function(){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes},e.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],i=t[1];return this._resizeCanvas(e,i),this.transform.resize(e,i),this.painter.resize(e,i),this.fire("movestart").fire("move").fire("resize").fire("moveend")},e.prototype.getBounds=function(){var t=new v(this.transform.pointLocation(new g(0,this.transform.height)),this.transform.pointLocation(new g(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new g(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new g(0,this.transform.size.y)))),t},e.prototype.setMaxBounds=function(t){if(t){var e=v.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!==t&&void 0!==t||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},e.prototype.setMinZoom=function(t){if((t=null===t||void 0===t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},e.prototype.getMinZoom=function(){return this.transform.minZoom},e.prototype.setMaxZoom=function(t){if((t=null===t||void 0===t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},e.prototype.getMaxZoom=function(){return this.transform.maxZoom},e.prototype.project=function(t){return this.transform.locationPoint(m.convert(t))},e.prototype.unproject=function(t){return this.transform.pointLocation(g.convert(t))},e.prototype.queryRenderedFeatures=function(){var t,e={};return 2===arguments.length?(t=arguments[0],e=arguments[1]):1===arguments.length&&function(t){return t instanceof g||Array.isArray(t)}(arguments[0])?t=arguments[0]:1===arguments.length&&(e=arguments[0]),this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform.zoom,this.transform.angle)},e.prototype._makeQueryGeometry=function(t){var e,i=this;if(void 0===t&&(t=[g.convert([0,0]),g.convert([this.transform.width,this.transform.height])]),t instanceof g||"number"==typeof t[0]){e=[g.convert(t)]}else{var n=[g.convert(t[0]),g.convert(t[1])];e=[n[0],new g(n[1].x,n[0].y),n[1],new g(n[0].x,n[1].y),n[0]]}return e.map(function(t){return i.transform.pointCoordinate(t)})},e.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},e.prototype.setStyle=function(t,e){if((!e||!1!==e.diff)&&this.style&&t&&!(t instanceof l)&&"string"!=typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){r.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),t?(this.style=t instanceof l?t:new l(t,this),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},e.prototype.getStyle=function(){if(this.style)return this.style.serialize()},e.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},e.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire("error",{error:new Error("There is no source with ID '"+t+"'")}):e.loaded()},e.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},e.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},e.prototype.getSource=function(t){return this.style.getSource(t)},e.prototype.addImage=function(t,e,i){this.style.spriteAtlas.addImage(t,e,i)},e.prototype.removeImage=function(t){this.style.spriteAtlas.removeImage(t)},e.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},e.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},e.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},e.prototype.getLayer=function(t){return this.style.getLayer(t)},e.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},e.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},e.prototype.getFilter=function(t){return this.style.getFilter(t)},e.prototype.setPaintProperty=function(t,e,i,n){return this.style.setPaintProperty(t,e,i,n),this._update(!0),this},e.prototype.getPaintProperty=function(t,e,i){return this.style.getPaintProperty(t,e,i)},e.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},e.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},e.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},e.prototype.getLight=function(){return this.style.getLight()},e.prototype.getContainer=function(){return this._container},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.getCanvas=function(){return this._canvas},e.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},e.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map");var e=this._canvasContainer=s.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=s.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",0),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=s.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=s.create("div","mapboxgl-ctrl-"+t,n)})},e.prototype._resizeCanvas=function(t,e){var i=a.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},e.prototype._setupPainter=function(){var t=r.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},b.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);return e?void(this.painter=new c(e,this.transform)):void this.fire("error",{error:new Error("Failed to initialize WebGL")})},e.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&o.cancelFrame(this._frameId),this.fire("webglcontextlost",{originalEvent:t})},e.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},e.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},e.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},e.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},e.prototype.remove=function(){this._hash&&this._hash.remove(),o.cancelFrame(this._frameId),this.setStyle(null),void 0!==a&&(a.removeEventListener("resize",this._onWindowResize,!1),a.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),n(this._canvasContainer),n(this._controlContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},e.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=o.frame(this._render))},e.prototype._onWindowOnline=function(){this._update()},e.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},i.showTileBoundaries.get=function(){return!!this._showTileBoundaries},i.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},i.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},i.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this.style._redoPlacement())},i.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},i.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},i.repaint.get=function(){return!!this._repaint},i.repaint.set=function(t){this._repaint=t,this._update()},i.vertices.get=function(){return!!this._vertices},i.vertices.set=function(t){this._vertices=t,this._update()},e.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},e.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(e.prototype,i),e}(p);e.exports=w},{"../geo/lng_lat":62,"../geo/lng_lat_bounds":63,"../geo/transform":64,"../render/painter":77,"../style/animation_loop":143,"../style/style":146,"../util/browser":192,"../util/dom":199,"../util/util":212,"../util/window":194,"./bind_handlers":171,"./camera":172,"./control/attribution_control":173,"./control/logo_control":176,"./hash":186,"mapbox-gl-supported":22,"point-geometry":26}],188:[function(t,e,i){"use strict";var n=t("../util/dom"),r=t("../geo/lng_lat"),o=t("point-geometry"),a=function(t,e){this._offset=o.convert(e&&e.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),t||(t=n.create("div")),t.classList.add("mapboxgl-marker"),this._element=t,this._popup=null};a.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},a.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),n.remove(this._element),this._popup&&this._popup.remove(),this},a.prototype.getLngLat=function(){return this._lngLat},a.prototype.setLngLat=function(t){return this._lngLat=r.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},a.prototype.getElement=function(){return this._element},a.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},a.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},a.prototype.getPopup=function(){return this._popup},a.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},a.prototype._update=function(t){if(this._map){var e=this._map.project(this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),n.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},e.exports=a},{"../geo/lng_lat":62,"../util/dom":199,"point-geometry":26}],189:[function(t,e,i){"use strict";function n(t){if(t){if("number"==typeof t){var e=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new l(0,t),"top-left":new l(e,e),"top-right":new l(-e,e),bottom:new l(0,-t),"bottom-left":new l(e,-e),"bottom-right":new l(-e,-e),left:new l(t,0),right:new l(-t,0)}}if(function(t){return t instanceof l||Array.isArray(t)}(t)){var i=l.convert(t);return{top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{top:l.convert(t.top||[0,0]),"top-left":l.convert(t["top-left"]||[0,0]),"top-right":l.convert(t["top-right"]||[0,0]),bottom:l.convert(t.bottom||[0,0]),"bottom-left":l.convert(t["bottom-left"]||[0,0]),"bottom-right":l.convert(t["bottom-right"]||[0,0]),left:l.convert(t.left||[0,0]),right:l.convert(t.right||[0,0])}}return n(new l(0,0))}var r=t("../util/util"),o=t("../util/evented"),a=t("../util/dom"),s=t("../geo/lng_lat"),l=t("point-geometry"),u=t("../util/window"),c={closeButton:!0,closeOnClick:!0},h=function(t){function e(e){t.call(this),this.options=r.extend(Object.create(c),e),r.bindAll(["_update","_onClickClose"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},e.prototype.isOpen=function(){return!!this._map},e.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},e.prototype.getLngLat=function(){return this._lngLat},e.prototype.setLngLat=function(t){return this._lngLat=s.convert(t),this._update(),this},e.prototype.setText=function(t){return this.setDOMContent(u.document.createTextNode(t))},e.prototype.setHTML=function(t){var e,i=u.document.createDocumentFragment(),n=u.document.createElement("body");for(n.innerHTML=t;e=n.firstChild;)i.appendChild(e);return this.setDOMContent(i)},e.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},e.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=a.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=a.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},e.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=a.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=a.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,e=n(this.options.offset),i=this._map.project(this._lngLat).round();if(!t){var r=this._container.offsetWidth,o=this._container.offsetHeight;t=i.y+e.bottom.y<o?["top"]:i.y>this._map.transform.height-o?["bottom"]:[],i.x<r/2?t.push("left"):i.x>this._map.transform.width-r/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var s=i.add(e[t]),l={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},u=this._container.classList;for(var c in l)u.remove("mapboxgl-popup-anchor-"+c);u.add("mapboxgl-popup-anchor-"+t),a.setTransform(this._container,l[t]+" translate("+s.x+"px,"+s.y+"px)")}},e.prototype._onClickClose=function(){this.remove()},e}(o);e.exports=h},{"../geo/lng_lat":62,"../util/dom":199,"../util/evented":200,"../util/util":212,"../util/window":194,"point-geometry":26}],190:[function(t,e,i){"use strict";var n=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};n.prototype.send=function(t,e,i,n,r){var o=i?this.mapId+":"+this.callbackID++:null;i&&(this.callbacks[o]=i),this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:t,id:String(o),data:e},n)},n.prototype.receive=function(t){var e,i=this,n=t.data,r=n.id;if(!n.targetMapId||this.mapId===n.targetMapId){var o=function(t,e,n){i.target.postMessage({sourceMapId:i.mapId,type:"<response>",id:String(r),error:t?String(t):null,data:e},n)};if("<response>"===n.type)e=this.callbacks[n.id],delete this.callbacks[n.id],e&&e(n.error||null,n.data);else if(void 0!==n.id&&this.parent[n.type])this.parent[n.type](n.sourceMapId,n.data,o);else if(void 0!==n.id&&this.parent.getWorkerSource){var a=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,a[0])[a[1]](n.data,o)}else this.parent[n.type](n.data)}},n.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},e.exports=n},{}],191:[function(t,e,i){"use strict";function n(t){var e=r.document.createElement("a");return e.href=t,e.protocol===r.document.location.protocol&&e.host===r.document.location.host}var r=t("./window");i.getJSON=function(t,e){var i=new r.XMLHttpRequest;return i.open("GET",t,!0),i.setRequestHeader("Accept","application/json"),i.onerror=function(t){e(t)},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var t;try{t=JSON.parse(i.response)}catch(t){return e(t)}e(null,t)}else e(new Error(i.statusText))},i.send(),i},i.getArrayBuffer=function(t,e){var i=new r.XMLHttpRequest;return i.open("GET",t,!0),i.responseType="arraybuffer",i.onerror=function(t){e(t)},i.onload=function(){return 0===i.response.byteLength&&200===i.status?e(new Error("http status 200 returned without content.")):void(i.status>=200&&i.status<300&&i.response?e(null,{data:i.response,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):e(new Error(i.statusText)))},i.send(),i};i.getImage=function(t,e){return i.getArrayBuffer(t,function(t,i){if(t)return e(t);var n=new r.Image,o=r.URL||r.webkitURL;n.onload=function(){e(null,n),o.revokeObjectURL(n.src)};var a=new r.Blob([new Uint8Array(i.data)],{type:"image/png"});n.cacheControl=i.cacheControl,n.expires=i.expires,n.src=i.data.byteLength?o.createObjectURL(a):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="})},i.getVideo=function(t,e){var i=r.document.createElement("video");i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=r.document.createElement("source");n(t[o])||(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return i}},{"./window":194}],192:[function(t,e,i){"use strict";var n=t("./window");e.exports.now=n.performance&&n.performance.now?n.performance.now.bind(n.performance):Date.now.bind(Date);var r=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||n.msRequestAnimationFrame;i.frame=function(t){return r(t)};var o=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.msCancelAnimationFrame;i.cancelFrame=function(t){o(t)},i.timed=function(t,n,r){if(!n)return t.call(r,1),null;var o=!1,a=e.exports.now();return i.frame(function s(l){o||((l=e.exports.now())>=a+n?t.call(r,1):(t.call(r,(l-a)/n),i.frame(s)))}),function(){o=!0}},i.getImageData=function(t){var e=n.document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data},i.supported=t("mapbox-gl-supported"),i.hardwareConcurrency=n.navigator.hardwareConcurrency||4,Object.defineProperty(i,"devicePixelRatio",{get:function(){return n.devicePixelRatio}}),i.supportsWebp=!1;var a=n.document.createElement("img");a.onload=function(){i.supportsWebp=!0},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":194,"mapbox-gl-supported":22}],193:[function(t,e,i){"use strict";var n=t("webworkify"),r=t("../window"),o=r.URL.createObjectURL(new n(t("../../source/worker"),{bare:!0}));e.exports=function(){return new r.Worker(o)}},{"../../source/worker":98,"../window":194,webworkify:41}],194:[function(t,e,i){"use strict";e.exports=self},{}],195:[function(t,e,i){"use strict";function n(t,e){return e.area-t.area}var r=t("quickselect"),o=t("./util").calculateSignedArea;e.exports=function(t,e){var i=t.length;if(i<=1)return[t];for(var a,s,l=[],u=0;u<i;u++){var c=o(t[u]);0!==c&&(t[u].area=Math.abs(c),void 0===s&&(s=c<0),s===c<0?(a&&l.push(a),a=[t[u]]):a.push(t[u]))}if(a&&l.push(a),e>1)for(var h=0;h<l.length;h++)l[h].length<=e||(r(l[h],e,1,l[h].length-1,n),l[h]=l[h].slice(0,e));return l}},{"./util":212,quickselect:28}],196:[function(t,e,i){"use strict";e.exports={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null}},{}],197:[function(t,e,i){"use strict";var n=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}};n.prototype.encode=function(t){return this._stringToNumber[t]},n.prototype.decode=function(t){return this._numberToString[t]},e.exports=n},{}],198:[function(t,e,i){"use strict";var n=t("./util"),r=t("./actor"),o=function(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=i[o],s=new r(a,e,this.id);s.name="Worker "+o,this.actors.push(s)}};o.prototype.broadcast=function(t,e,i){i=i||function(){},n.asyncAll(this.actors,function(i,n){i.send(t,e,n)},i)},o.prototype.send=function(t,e,i,n,r){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,i,r),n},o.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},e.exports=o},{"./actor":190,"./util":212}],199:[function(t,e,i){"use strict";function n(t){for(var e=0;e<t.length;e++)if(t[e]in l)return t[e];return t[0]}function r(t){t.preventDefault(),t.stopPropagation(),a.removeEventListener("click",r,!0)}var o=t("point-geometry"),a=t("./window");i.create=function(t,e,i){var n=a.document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n};var s,l=a.document.documentElement.style,u=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){u&&(s=l[u],l[u]="none")},i.enableDrag=function(){u&&(l[u]=s)};var c=n(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[c]=e},i.suppressClick=function(){a.addEventListener("click",r,!0),a.setTimeout(function(){a.removeEventListener("click",r,!0)},0)},i.mousePos=function(t,e){var i=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new o(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)},i.touchPos=function(t,e){for(var i=t.getBoundingClientRect(),n=[],r="touchend"===e.type?e.changedTouches:e.touches,a=0;a<r.length;a++)n.push(new o(r[a].clientX-i.left-t.clientLeft,r[a].clientY-i.top-t.clientTop));return n},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)}},{"./window":194,"point-geometry":26}],200:[function(t,e,i){"use strict";function n(t,e,i){i[t]=i[t]||[],i[t].push(e)}function r(t,e,i){if(i&&i[t]){var n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}var o=t("./util"),a=function(){};a.prototype.on=function(t,e){return this._listeners=this._listeners||{},n(t,e,this._listeners),this},a.prototype.off=function(t,e){return r(t,e,this._listeners),r(t,e,this._oneTimeListeners),this},a.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},n(t,e,this._oneTimeListeners),this},a.prototype.fire=function(t,e){var i=this;if(this.listens(t)){e=o.extend({},e,{type:t,target:this});for(var n=this._listeners&&this._listeners[t]?this._listeners[t].slice():[],a=0;a<n.length;a++)n[a].call(i,e);for(var s=this._oneTimeListeners&&this._oneTimeListeners[t]?this._oneTimeListeners[t].slice():[],l=0;l<s.length;l++)s[l].call(i,e),r(t,s[l],i._oneTimeListeners);this._eventedParent&&this._eventedParent.fire(t,o.extend({},e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData))}else o.endsWith(t,"error")&&console.error(e&&e.error||e||"Empty error event");return this},a.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},a.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this},e.exports=a},{"./util":212}],201:[function(t,e,i){"use strict";function n(t,e){return e.max-t.max}function r(t,e,i,n){this.p=new a(t,e),this.h=i,this.d=function(t,e){for(var i=!1,n=1/0,r=0;r<e.length;r++)for(var o=e[r],a=0,l=o.length,u=l-1;a<l;u=a++){var c=o[a],h=o[u];c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(i=!i),n=Math.min(n,s(t,c,h))}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var o=t("tinyqueue"),a=t("point-geometry"),s=t("./intersection_tests").distToSegmentSquared;e.exports=function(t,e,i){e=e||1;for(var a,s,l,u,c=t[0],h=0;h<c.length;h++){var d=c[h];(!h||d.x<a)&&(a=d.x),(!h||d.y<s)&&(s=d.y),(!h||d.x>l)&&(l=d.x),(!h||d.y>u)&&(u=d.y)}var f=l-a,p=u-s,m=Math.min(f,p),v=m/2,g=new o(null,n);if(0===m)return[a,s];for(var y=a;y<l;y+=m)for(var _=s;_<u;_+=m)g.push(new r(y+v,_+v,v,t));for(var b=function(t){for(var e=0,i=0,n=0,o=t[0],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l],h=u.x*c.y-c.x*u.y;i+=(u.x+c.x)*h,n+=(u.y+c.y)*h,e+=3*h}return new r(i/e,n/e,0,t)}(t),x=g.length;g.length;){var w=g.pop();(w.d>b.d||!b.d)&&(b=w,i&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,x)),w.max-b.d<=e||(v=w.h/2,g.push(new r(w.p.x-v,w.p.y-v,v,t)),g.push(new r(w.p.x+v,w.p.y-v,v,t)),g.push(new r(w.p.x-v,w.p.y+v,v,t)),g.push(new r(w.p.x+v,w.p.y+v,v,t)),x+=4)}return i&&(console.log("num probes: "+x),console.log("best distance: "+b.d)),b.p}},{"./intersection_tests":205,"point-geometry":26,tinyqueue:30}],202:[function(t,e,i){"use strict";var n,r=t("./worker_pool");e.exports=function(){return n||(n=new r),n}},{"./worker_pool":215}],203:[function(t,e,i){"use strict";function n(t,e,i){if(1===t){var n=i.readMessage(r,{glyphs:{}});e.push(n)}}function r(t,e,i){if(1===t)e.name=i.readString();else if(2===t)e.range=i.readString();else if(3===t){var n=i.readMessage(o,{});e.glyphs[n.id]=n}}function o(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}e.exports=function(t,e){this.stacks=t.readFields(n,[],e)}},{}],204:[function(t,e,i){"use strict";function n(t,e,i){return t*(1-i)+e*i}e.exports=n,n.number=n,n.vec2=function(t,e,i){return[n(t[0],e[0],i),n(t[1],e[1],i)]},n.color=function(t,e,i){return[n(t[0],e[0],i),n(t[1],e[1],i),n(t[2],e[2],i),n(t[3],e[3],i)]},n.array=function(t,e,i){return t.map(function(t,r){return n(t,e[r],i)})}},{}],205:[function(t,e,i){"use strict";function n(t,e,i){if(t.length>1){if(r(t,e))return!0;for(var n=0;n<e.length;n++)if(a(e[n],t,i))return!0}for(var o=0;o<t.length;o++)if(a(t[o],e,i))return!0;return!1}function r(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var n=t[i],r=t[i+1],a=0;a<e.length-1;a++){if(o(n,r,e[a],e[a+1]))return!0}return!1}function o(t,e,i,n){return c(t,i,n)!==c(e,i,n)&&c(t,e,i)!==c(t,e,n)}function a(t,e,i){var n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(var r=1;r<e.length;r++){if(s(t,e[r-1],e[r])<n)return!0}return!1}function s(t,e,i){var n=e.distSqr(i);if(0===n)return t.distSqr(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r<0?t.distSqr(e):r>1?t.distSqr(i):t.distSqr(i.sub(e)._mult(r)._add(e))}function l(t,e){for(var i,n,r,o=!1,a=0;a<t.length;a++)for(var s=0,l=(i=t[a]).length-1;s<i.length;l=s++)n=i[s],r=i[l],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o);return o}function u(t,e){for(var i=!1,n=0,r=t.length-1;n<t.length;r=n++){var o=t[n],a=t[r];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(i=!i)}return i}var c=t("./util").isCounterClockwise;e.exports={multiPolygonIntersectsBufferedMultiPoint:function(t,e,i){for(var n=0;n<t.length;n++)for(var r=t[n],o=0;o<e.length;o++)for(var s=e[o],l=0;l<s.length;l++){var c=s[l];if(u(r,c))return!0;if(a(c,r,i))return!0}return!1},multiPolygonIntersectsMultiPolygon:function(t,e){if(1===t.length&&1===t[0].length)return l(e,t[0][0]);for(var i=0;i<e.length;i++)for(var n=e[i],o=0;o<n.length;o++)if(l(t,n[o]))return!0;for(var a=0;a<t.length;a++){for(var s=t[a],u=0;u<s.length;u++)if(l(e,s[u]))return!0;for(var c=0;c<e.length;c++)if(r(s,e[c]))return!0}return!1},multiPolygonIntersectsBufferedMultiLine:function(t,e,i){for(var r=0;r<e.length;r++)for(var o=e[r],a=0;a<t.length;a++){var s=t[a];if(s.length>=3)for(var l=0;l<o.length;l++)if(u(s,o[l]))return!0;if(n(s,o,i))return!0}return!1},polygonIntersectsPolygon:function(t,e){for(var i=0;i<t.length;i++)if(u(e,t[i]))return!0;for(var n=0;n<e.length;n++)if(u(t,e[n]))return!0;return!!r(t,e)},distToSegmentSquared:s}},{"./util":212}],206:[function(t,e,i){"use strict";e.exports={"Latin-1 Supplement":function(t){return t>=128&&t<=255},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}}},{}],207:[function(t,e,i){"use strict";var n=function(t,e){this.max=t,this.onRemove=e,this.reset()};n.prototype.reset=function(){var t=this;for(var e in t.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},n.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.get(this.order[0]);i&&this.onRemove(i)}return this},n.prototype.has=function(t){return t in this.data},n.prototype.keys=function(){return this.order},n.prototype.get=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},n.prototype.getWithoutRemoving=function(t){return this.has(t)?this.data[t]:null},n.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},n.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var i=e.get(e.order[0]);i&&e.onRemove(i)}return this},e.exports=n},{}],208:[function(t,e,i){"use strict";function n(t,e){var i=o(s.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,!s.REQUIRE_ACCESS_TOKEN)return a(t);if(!(e=e||s.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params.push("access_token="+e),a(t)}function r(t){return 0===t.indexOf("mapbox:")}function o(t){var e=t.match(h);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function a(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var s=t("./config"),l=t("./browser"),u="See https://www.mapbox.com/api-documentation/#access-tokens";i.isMapboxURL=r,i.normalizeStyleURL=function(t,e){if(!r(t))return t;var i=o(t);return i.path="/styles/v1"+i.path,n(i,e)},i.normalizeGlyphsURL=function(t,e){if(!r(t))return t;var i=o(t);return i.path="/fonts/v1"+i.path,n(i,e)},i.normalizeSourceURL=function(t,e){if(!r(t))return t;var i=o(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),n(i,e)},i.normalizeSpriteURL=function(t,e,i,s){var l=o(t);return r(t)?(l.path="/styles/v1"+l.path+"/sprite"+e+i,n(l,s)):(l.path+=""+e+i,a(l))};var c=/(\.(png|jpg)\d*)(?=$)/;i.normalizeTileURL=function(t,e,i){if(!e||!r(e))return t;var n=o(t),u=l.devicePixelRatio>=2||512===i?"@2x":"",h=l.supportsWebp?".webp":"$1";return n.path=n.path.replace(c,""+u+h),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(s.ACCESS_TOKEN||""))}(n.params),a(n)};var h=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/},{"./browser":192,"./config":196}],209:[function(t,e,i){"use strict";var n=t("./is_char_in_unicode_block");e.exports.allowsIdeographicBreaking=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!i.charAllowsIdeographicBreaking(r.charCodeAt(0)))return!1}return!0},e.exports.allowsVerticalWritingMode=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(i.charHasUprightVerticalOrientation(r.charCodeAt(0)))return!0}return!1},e.exports.charAllowsIdeographicBreaking=function(t){return!!(!(t<11904)&&(n["Bopomofo Extended"](t)||n.Bopomofo(t)||n["CJK Compatibility Forms"](t)||n["CJK Compatibility Ideographs"](t)||n["CJK Compatibility"](t)||n["CJK Radicals Supplement"](t)||n["CJK Strokes"](t)||n["CJK Symbols and Punctuation"](t)||n["CJK Unified Ideographs Extension A"](t)||n["CJK Unified Ideographs"](t)||n["Enclosed CJK Letters and Months"](t)||n["Halfwidth and Fullwidth Forms"](t)||n.Hiragana(t)||n["Ideographic Description Characters"](t)||n["Kangxi Radicals"](t)||n["Katakana Phonetic Extensions"](t)||n.Katakana(t)||n["Vertical Forms"](t)||n["Yi Radicals"](t)||n["Yi Syllables"](t)))},i.charHasUprightVerticalOrientation=function(t){return!!(746===t||747===t||!(t<4352)&&(n["Bopomofo Extended"](t)||n.Bopomofo(t)||n["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||n["CJK Compatibility Ideographs"](t)||n["CJK Compatibility"](t)||n["CJK Radicals Supplement"](t)||n["CJK Strokes"](t)||!(!n["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||n["CJK Unified Ideographs Extension A"](t)||n["CJK Unified Ideographs"](t)||n["Enclosed CJK Letters and Months"](t)||n["Hangul Compatibility Jamo"](t)||n["Hangul Jamo Extended-A"](t)||n["Hangul Jamo Extended-B"](t)||n["Hangul Jamo"](t)||n["Hangul Syllables"](t)||n.Hiragana(t)||n["Ideographic Description Characters"](t)||n.Kanbun(t)||n["Kangxi Radicals"](t)||n["Katakana Phonetic Extensions"](t)||n.Katakana(t)&&12540!==t||!(!n["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!n["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||n["Unified Canadian Aboriginal Syllabics"](t)||n["Unified Canadian Aboriginal Syllabics Extended"](t)||n["Vertical Forms"](t)||n["Yijing Hexagram Symbols"](t)||n["Yi Syllables"](t)||n["Yi Radicals"](t)))},i.charHasNeutralVerticalOrientation=function(t){return!!(n["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||n["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||n["Letterlike Symbols"](t)||n["Number Forms"](t)||n["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||n["Control Pictures"](t)&&9251!==t||n["Optical Character Recognition"](t)||n["Enclosed Alphanumerics"](t)||n["Geometric Shapes"](t)||n["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||n["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||n["CJK Symbols and Punctuation"](t)||n.Katakana(t)||n["Private Use Area"](t)||n["CJK Compatibility Forms"](t)||n["Small Form Variants"](t)||n["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)},i.charHasRotatedVerticalOrientation=function(t){return!(i.charHasUprightVerticalOrientation(t)||i.charHasNeutralVerticalOrientation(t))}},{"./is_char_in_unicode_block":206}],210:[function(t,e,i){"use strict";function n(t,e){return Math.ceil(t/e)*e}function r(t){return u[t].BYTES_PER_ELEMENT}function o(t){return t.toLowerCase()}function a(t,e){var i="this._pos"+r(t.type).toFixed(0)+" + "+(t.offset/r(t.type)+e).toFixed(0);return"this._structArray."+o(t.type)+"["+i+"]"}function s(t,e){return new Function("return "+a(t,e)+";")}function l(t,e){return new Function("x",a(t,e)+" = x;")}e.exports=function(t){var e=JSON.stringify(t);if(d[e])return d[e];var i=void 0===t.alignment?1:t.alignment,a=0,u=0,f=["Uint8"],p=t.members.map(function(t){f.indexOf(t.type)<0&&f.push(t.type);var e=r(t.type),o=a=n(a,Math.max(i,e)),s=t.components||1;return u=Math.max(u,e),a+=e*s,{name:t.name,type:t.type,components:s,offset:o}}),m=n(a,Math.max(u,i)),v=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(c);v.prototype.alignment=i,v.prototype.size=m;for(var g=0,y=p;g<y.length;g+=1)for(var _=y[g],b=0;b<_.components;b++){var x=_.name+(1===_.components?"":b);Object.defineProperty(v.prototype,x,{get:s(_,b),set:l(_,b)})}var w=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(h);return w.prototype.members=p,w.prototype.StructType=v,w.prototype.bytesPerElement=m,w.prototype.emplaceBack=function(t,e){for(var i=[],n=[],a="var i = this.length;\nthis.resize(this.length + 1);\n",s=0,l=t;s<l.length;s+=1){var u=l[s],c=r(u.type);i.indexOf(c)<0&&(i.push(c),a+="var o"+c.toFixed(0)+" = i * "+(e/c).toFixed(0)+";\n");for(var h=0;h<u.components;h++){var d="v"+n.length,f="o"+c.toFixed(0)+" + "+(u.offset/c+h).toFixed(0);a+="this."+o(u.type)+"["+f+"] = "+d+";\n",n.push(d)}}return a+="return i;",new Function(n.toString(),a)}(p,m),w.prototype._usedTypes=f,d[e]=w,w};var u={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},c=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},h=function(t){this.isTransferred=!1,void 0!==t?(this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};h.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},h.prototype.serialize=function(t){return this._trim(),t&&(this.isTransferred=!0,t.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},h.prototype.get=function(t){return new this.StructType(this,t)},h.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},h.prototype.resize=function(t){if(this.length=t,t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},h.prototype._refreshViews=function(){for(var t=this,e=0,i=t._usedTypes;e<i.length;e+=1){var n=i[e];t[o(n)]=new u[n](t.arrayBuffer)}},h.prototype.toArray=function(t,e){for(var i=[],n=t;n<e;n++){var r=this.get(n);i.push(r)}return i};var d={}},{}],211:[function(t,e,i){"use strict";e.exports=function(t,e){return e.replace(/{([^{}]+)}/g,function(e,i){return i in t?t[i]:""})}},{}],212:[function(t,e,i){"use strict";var n=t("@mapbox/unitbezier"),r=t("../geo/coordinate");t("point-geometry");i.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},i.bezier=function(t,e,i,r){var o=new n(t,e,i,r);return function(t){return o.solve(t)}},i.ease=i.bezier(.25,.1,.25,1),i.clamp=function(t,e,i){return Math.min(i,Math.max(e,t))},i.wrap=function(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r},i.asyncAll=function(t,e,i){if(!t.length)return i(null,[]);var n=t.length,r=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),r[a]=e,0==--n&&i(o,r)})})},i.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},i.keysDifference=function(t,e){var i=[];for(var n in t)n in e||i.push(n);return i},i.extend=function(t,e,i,n){for(var r=arguments,o=1;o<arguments.length;o++){var a=r[o];for(var s in a)t[s]=a[s]}return t},i.pick=function(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n];r in t&&(i[r]=t[r])}return i};var o=1;i.uniqueId=function(){return o++},i.bindAll=function(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})},i.getCoordinatesCenter=function(t){for(var e=1/0,i=1/0,n=-1/0,o=-1/0,a=0;a<t.length;a++)e=Math.min(e,t[a].column),i=Math.min(i,t[a].row),n=Math.max(n,t[a].column),o=Math.max(o,t[a].row);var s=n-e,l=o-i,u=Math.max(s,l);return new r((e+n)/2,(i+o)/2,0).zoomTo(Math.floor(-Math.log(u)/Math.LN2))},i.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},i.mapObject=function(t,e,i){var n={};for(var r in t)n[r]=e.call(i||this,t[r],r,t);return n},i.filterObject=function(t,e,i){var n={};for(var r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n},i.deepEqual=function(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!i.deepEqual(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!i.deepEqual(t[r],e[r]))return!1;return!0}return t===e},i.clone=function(t){return Array.isArray(t)?t.map(i.clone):"object"==typeof t&&t?i.mapObject(t,i.clone):t},i.arraysIntersect=function(t,e){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1};var a={};i.warnOnce=function(t){a[t]||("undefined"!=typeof console&&console.warn(t),a[t]=!0)},i.isCounterClockwise=function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)},i.calculateSignedArea=function(t){for(var e=0,i=0,n=t.length,r=n-1,o=void 0,a=void 0;i<n;r=i++)o=t[i],e+=((a=t[r]).x-o.x)*(o.y+a.y);return e},i.isClosedPolygon=function(t){if(t.length<4)return!1;var e=t[0],n=t[t.length-1];return!(Math.abs(e.x-n.x)>0||Math.abs(e.y-n.y)>0)&&Math.abs(i.calculateSignedArea(t))>.01},i.sphericalToCartesian=function(t){var e=t[0],i=t[1],n=t[2];return i+=90,i*=Math.PI/180,n*=Math.PI/180,[e*Math.cos(i)*Math.sin(n),e*Math.sin(i)*Math.sin(n),e*Math.cos(n)]},i.parseCacheControl=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,i,n,r){var o=n||r;return e[i]=!o||o.toLowerCase(),""}),e["max-age"]){var i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}},{"../geo/coordinate":61,"@mapbox/unitbezier":3,"point-geometry":26}],213:[function(t,e,i){"use strict";var n=function(t,e,i,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},r={geometry:{}};r.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},r.geometry.set=function(t){this._geometry=t},n.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(n.prototype,r),e.exports=n},{}],214:[function(t,e,i){"use strict";var n=t("./script_detection");e.exports=function(t){for(var i="",r=0;r<t.length;r++){var o=t.charCodeAt(r+1)||null,a=t.charCodeAt(r-1)||null;i+=(!o||!n.charHasRotatedVerticalOrientation(o)||e.exports.lookup[t[r+1]])&&(!a||!n.charHasRotatedVerticalOrientation(a)||e.exports.lookup[t[r-1]])&&e.exports.lookup[t[r]]?e.exports.lookup[t[r]]:t[r]}return i},e.exports.lookup={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}},{"./script_detection":209}],215:[function(t,e,i){"use strict";var n=t("./web_worker"),r=function(){this.active={}};r.prototype.acquire=function(e){if(!this.workers){var i=t("../").workerCount;for(this.workers=[];this.workers.length<i;)this.workers.push(new n)}return this.active[e]=!0,this.workers.slice()},r.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},e.exports=r},{"../":65,"./web_worker":193}]},{},[65])(65)},t.exports=n()}).call(e,i(12))},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){t.exports=i(0)}])},40:function(t,e){t.exports="./assets/bubblechart.css"},41:function(t,e){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(5);var n,r=i(1),o=(n=r)&&n.__esModule?n:{default:n};e.default=Vizabi.Tool.extend("BubbleChart",{init:function(t,e){this.name="bubblechart",this.components=[{component:o.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","locale","ui"]},{component:Vizabi.Component.get("timeslider"),placeholder:".vzb-tool-timeslider",model:["state.time","state.marker","ui"]},{component:Vizabi.Component.get("dialogs"),placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:Vizabi.Component.get("buttonlist"),placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:Vizabi.Component.get("treemenu"),placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:Vizabi.Component.get("datawarning"),placeholder:".vzb-tool-datawarning",model:["locale"]},{component:Vizabi.Component.get("datanotes"),placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:Vizabi.Component.get("steppedspeedslider"),placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),t.ui.chart.lockNonSelected&&(!t.ui.splash||!1===t.state.time.splash)){var e=t.state.time.parse(""+t.ui.chart.lockNonSelected);e<t.state.time.start&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.start)),e>t.state.time.end&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.end))}},default_model:{state:{time:{autoconfig:{type:"time"}},entities:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_colorlegend:{autoconfig:{type:"entity_domain",excludeIDs:["tag"]}},entities_tags:{autoconfig:{type:"entity_domain",includeOnlyIDs:["tag"]}},marker_tags:{space:["entities_tags"],label:{use:"property",which:"name"},hook_parent:{}},marker:{limit:5e3,space:["entities","time"],axis_x:{use:"indicator",autoconfig:{index:0,type:"measure"}},axis_y:{use:"indicator",autoconfig:{index:1,type:"measure"}},label:{use:"property",autoconfig:{includeOnlyIDs:["name"],type:"string"}},size:{autoconfig:{index:2,type:"measure"}},color:{syncModels:["marker_colorlegend"],autoconfig:{}},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{decorations:{enabled:!0,xAxisGroups:null},superhighlightOnMinimapHover:!0,whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},margin:{left:0,top:0},trails:!0,lockNonSelected:0},datawarning:{doubtDomain:[],doubtRange:[]},show_ticks:!0,presentation:!1,panWithArrow:!1,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!1,buttons:["colors","find","zoom","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}},versionInfo:{version:"2.0.5-0",build:1524663764006}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(3)),r=o(i(2));function o(t){return t&&t.__esModule?t:{default:t}}var a=Vizabi.utils,s=Vizabi.helpers,l=s.svgexport,u=s.labels,c=s["d3.axisWithLabelPicker"],h=s["d3.dynamicBackground"],d=Vizabi.iconset,f=d.warn,p=d.question,m=Vizabi.Component.extend("bubblechart",{init:function(t,e){var o=this,s=this;this.name="bubblechart",this.template=i(6),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.playing":function(t,e){a.isTouchDevice()&&s.model.time.playing&&s.someHighlighted&&s.model.marker.clearHighlighted()},"change:time.start":function(t,e){s._readyOnce&&!s.model.time.splash&&(["color","axis_x","axis_y"].filter(function(t){return s.model.marker[t].which==s.model.time.dim}).length?s.ready():s._trails.create().then(function(){s._trails.run(["findVisible","reveal","opacityHandler"])}))},"change:time.end":function(t,e){s._readyOnce&&!s.model.time.splash&&(["color","axis_x","axis_y"].filter(function(t){return s.model.marker[t].which==s.model.time.dim}).length?s.ready():s._trails.create().then(function(){s._trails.run(["findVisible","reveal","opacityHandler"])}))},"change:time.record":function(){s.model.time.record?s._export.open(this.element,this.name):s._export.reset()},"change:ui.chart.trails":function(t){s._readyOnce&&(s._trails.toggle(s.model.ui.chart.trails),s.redrawDataPoints())},"change:ui.chart.lockNonSelected":function(t){s._readyOnce&&s.redrawDataPoints(500)},"change:ui.chart.decorations":function(t){s._readyOnce&&s._updateDecorations(500)},"change:marker":function(t,e){if(s._readyOnce)if(e.indexOf("scaleType")>-1)s.ready();else if(-1===e.indexOf("marker.color")&&-1===e.indexOf("marker.size")&&-1===e.indexOf("marker.size_label"))if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1){if(!s.yScale||!s.xScale)return;s.updateSize(),s.updateMarkerSizeLimits(),s._trails.run("findVisible"),s.redrawDataPoints(),s._trails.run("resize",null,500)}else if(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(s.draggingNow)return;if(a.approxEqual(s._zoomedXYMinMax.axis_x.zoomedMin,s.model.marker.axis_x.zoomedMin,.01)&&a.approxEqual(s._zoomedXYMinMax.axis_x.zoomedMax,s.model.marker.axis_x.zoomedMax,.01)&&a.approxEqual(s._zoomedXYMinMax.axis_y.zoomedMin,s.model.marker.axis_y.zoomedMin,.01)&&a.approxEqual(s._zoomedXYMinMax.axis_y.zoomedMax,s.model.marker.axis_y.zoomedMax,.01))return;var i=!1;s.model.time.playing&&(i=!0,s.model.time.pause(!0)),s._trails.run("abortAnimation"),s._panZoom.zoomToMaxMin(s.model.marker.axis_x.getZoomedMin(),s.model.marker.axis_x.getZoomedMax(),s.model.marker.axis_y.getZoomedMin(),s.model.marker.axis_y.getZoomedMax(),500,"don't feed these zoom values back to state"),i&&(s.model.time.postponePause=!1)}},"change:marker.select":function(t,e){s._readyOnce&&s.entityBubbles&&((t.source._val||[]).length-(t.source._previousVal||[]).length>50&&(s.model.ui.chart.trails=!1),s.selectDataPoints(),s.redrawDataPoints(),s._trails.create().then(function(){s._trails.run(["findVisible","reveal","opacityHandler"])}),s.updateBubbleOpacity(),s._updateDoubtOpacity())},"change:marker.superHighlight":function(t,e){o._readyOnce&&o._blinkSuperHighlighted()},"change:marker.highlight":function(t,e){if(s._readyOnce)if("highlight"==e)s.highlightDataPoints();else if(null!==e){var i=s._formatSTitleValues(e.size,e.color);s._updateSTitle(i[0],i[1])}else s._updateSTitle()},"change:time.value":function(){var t;!s.model.time.splash&&s._readyOnce&&s.entityBubbles&&(s.calculationQueue?s.calculationQueue.push(s.model.time.value.toString()):s.calculationQueue=[s.model.time.value.toString()],t=s.model.time.value,s.model.marker.getFrame(t,function(t,e){if(!s._frameIsValid(t))return a.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");var i=s.calculationQueue.indexOf(e.toString());-1!=i&&(s.calculationQueue.splice(0,i+1),s.frameChanged(t,e))}))},"change:ui.adaptMinMaxZoom":function(){s.model.ui.adaptMinMaxZoom?s._panZoom.expandCanvas(500):s._panZoom.reset()},"change:marker.size.extent":function(t,e){s._readyOnce&&(s.updateMarkerSizeLimits(),s.redrawDataPointsOnlySize(),s._trails.run("resize"))},"change:marker.color":function(t,e){s._readyOnce&&(s.redrawDataPointsOnlyColors(),s._trails.run("recolor"))},"change:marker.opacitySelectDim":function(){s.updateBubbleOpacity()},"change:marker.opacityRegular":function(){s.updateBubbleOpacity(),s._trails.run("opacityHandler")},"change:ui.cursorMode":function(){var t=s.chartSvg;"plus"===s.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1)):"minus"===s.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0),t.classed("vzb-panhand",!1)):"hand"===s.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1))},"change:marker.space":function(){s.someHighlighted&&s.model.marker.clearHighlighted(),s.someSelected&&s.model.marker.clearSelected()},ready:function(){}},this._super(t,e),this.xScale=null,this.yScale=null,this.sScale=null,this.cScale=null,this.xAxis=c("bottom"),this.yAxis=c("left"),s.COLOR_BLACKISH="#333",s.COLOR_WHITEISH="#fdfdfd",this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this._trails=new n.default(this),this._panZoom=new r.default(this),this._export=new l(this),this._export.prefix("vzb-bc-").deleteClasses(["vzb-bc-bubbles-crop","vzb-hidden","vzb-bc-year","vzb-bc-zoom-rect","vzb-bc-projection-x","vzb-bc-projection-y","vzb-bc-axis-c-title"]),this._labels=new u(this),this._labels.config({CSS_PREFIX:"vzb-bc",LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-bubbles",LINES_CONTAINER_SELECTOR_PREFIX:"bubble-"})},_rangeBump:function(t,e){var i=this.activeProfile.maxRadiusPx/2;if(e=e?-1:1,a.isArray(t)&&t.length>1){var n=t[0],r=t[t.length-1];return n<r?(n+=i*e)>(r-=i*e)&&(n=r=(n+r)/2):n>r&&(n-=i*e)<(r+=i*e)&&(n=r=(n+r)/2),[n,r]}a.warn("rangeBump error: input is not an array or empty")},readyOnce:function(){var t=this;this._readyOnce=!1,this.scrollableAncestor=a.findScrollableAncestor(this.element),this.element=d3.select(this.element),this.chartSvg=this.element.select("svg"),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisElContainer=this.graph.select(".vzb-bc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-bc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.ySubTitleEl=this.graph.select(".vzb-bc-axis-y-subtitle"),this.xSubTitleEl=this.graph.select(".vzb-bc-axis-x-subtitle"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.sTitleEl=this.graph.select(".vzb-bc-axis-s-title"),this.cTitleEl=this.graph.select(".vzb-bc-axis-c-title"),this.yearEl=this.graph.select(".vzb-bc-year"),this.year=new h(this.yearEl),this.yInfoEl=this.graph.select(".vzb-bc-axis-y-info"),this.xInfoEl=this.graph.select(".vzb-bc-axis-x-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.projectionX=this.graph.select(".vzb-bc-projection-x"),this.projectionY=this.graph.select(".vzb-bc-projection-y"),this.decorationsEl=this.graph.select(".vzb-bc-decorations"),this.lineEqualXY=this.decorationsEl.select(".vzb-bc-line-equal-xy"),this.xAxisGroupsEl=this.decorationsEl.select(".vzb-bc-x-axis-groups"),this.trailsContainer=this.graph.select(".vzb-bc-trails"),this.bubbleContainerCrop=this.graph.select(".vzb-bc-bubbles-crop"),this.zoomSelection=this.graph.select(".vzb-zoom-selection"),this.labelsContainerCrop=this.graph.select(".vzb-bc-labels-crop"),this.bubbleContainer=this.graph.select(".vzb-bc-bubbles"),this.labelsContainer=this.graph.select(".vzb-bc-labels"),this.linesContainer=this.graph.select(".vzb-bc-lines"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.eventArea=this.element.select(".vzb-bc-eventarea"),this.entityBubbles=null,this.bubbleCrown=this.element.select(".vzb-bc-bubble-crown"),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltipMobile=this.element.select(".vzb-tooltip-mobile"),this.on("resize",function(){var e,i,n,r;(t._trails.run("abortAnimation"),t.updateSize())||(t.updateMarkerSizeLimits(),t._labels.updateSize(),e=t._zoomedXYMinMax.axis_x.zoomedMin,i=t._zoomedXYMinMax.axis_x.zoomedMax,n=t._zoomedXYMinMax.axis_y.zoomedMin,r=t._zoomedXYMinMax.axis_y.zoomedMax,t._panZoom.zoomer.dontFeedToState=!0,t._panZoom.rerun(),t._panZoom.zoomToMaxMin(e,i,n,r,0,!0))}),d3.select("body").on("keydown",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||(d3.event.metaKey||d3.event.ctrlKey)&&t.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}).on("mouseenter",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}),this.root.on("resetZoom",function(){t._panZoom.reset(null,500)}),this._panZoom.zoomSelection(this.bubbleContainerCrop),this.bubbleContainerCrop.call(this._panZoom.dragRectangle).call(this._panZoom.zoomer).on("dblclick.zoom",null).on("mouseup",function(){t.draggingNow=!1}).on("click",function(){var e=t.model.ui.cursorMode;d3.event.defaultPrevented||"arrow"===e||"hand"===e||t._panZoom.zoomByIncrement(e,500)}),this.TIMEDIM=this.model.time.getDimension(),this.KEYS=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings(),this.wScale=d3.scaleLinear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce(),t._readyOnce=!0},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.size).length)},ready:function(){var t=this;this.KEYS=a.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.dataKeys=this.model.marker.getDataKeysPerHook(),this.updateUIStrings();this.model.time.end;this.updateIndicators(),this.updateTime(),t.model.time.splash||t._trails.create(),this.model.marker.getFrame(this.model.time.value,function(e,i){if(i.toString()==t.model.time.value.toString()){if(!t._frameIsValid(e))return a.warn("ready: empty data received from marker.getFrame(). doing nothing");t.frame=e,t.updateSize(),t.updateMarkerSizeLimits(),t.updateEntities(),t._labels.ready(),t.redrawDataPoints(),t.selectDataPoints(),t.updateBubbleOpacity(),t._updateDoubtOpacity(),t.zoomToMarkerMaxMin(),t.model.time.splash||t._trails.run(["findVisible","reveal","opacityHandler"]),t.model.ui.adaptMinMaxZoom&&t._panZoom.expandCanvas()}else a.defer(function(){t.ready()})})},zoomToMarkerMaxMin:function(){this._panZoom.resetZoomState();var t=this.model.marker.axis_x,e=this.model.marker.axis_y,i=(t.getScale().domain(),e.getScale().domain(),t.getZoomedMin()),n=t.getZoomedMax(),r=e.getZoomedMin(),o=e.getZoomedMax();this._panZoom.zoomToMaxMin(i,n,r,o,0,"don't feed these zoom values back to state")},updateIndicators:function(){this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this._labels.setScales(this.xScale,this.yScale),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter())},frameChanged:function(t,e){this.frame=t,this.updateTime(),this._updateDoubtOpacity(),this._trails.run("findVisible"),this.model.ui.adaptMinMaxZoom?this._panZoom.expandCanvas():this.redrawDataPoints(),this._trails.run("reveal",null,this.duration),this.tooltipMobile.classed("vzb-hidden",!0),this._reorderEntities()},_getSubtitle:function(t,e){var i=t.replace(e,"");","===i[0]&&(i=i.slice(1));var n=/^\((.*)\)$|.*/.exec(i.trim());return n[1]||n[0]||""},updateUIStrings:function(){var t=this,e=(this.getLayoutProfile(),t.model.marker.axis_y.getConceptprops()),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.size.getConceptprops(),r=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:i.name,S:n.name,C:r.name},title_short:{Y:e.name_short,X:i.name_short,S:n.name_short,C:r.name_short},subtitle:{Y:this._getSubtitle(e.name,e.name_short),X:this._getSubtitle(i.name,i.name_short),S:n.name_short,C:r.name_short},unit:{Y:e.unit||"",X:i.unit||"",S:n.unit||"",C:r.unit||""}},this.ySubTitleEl.selectAll("text").data([0]).enter().append("text"),this.xSubTitleEl.selectAll("text").data([0]).enter().append("text");var o=this.yTitleEl.selectAll("text").data([0]);o.enter().append("text"),o.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var s=this.xTitleEl.selectAll("text").data([0]);s.enter().append("text"),s.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("bottom").updateView().toggle()});var l=this.sTitleEl.selectAll("text").data([0]);l.enter().append("text"),l.attr("text-anchor","end"),a.setIcon(this.dataWarningEl,f).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),a.setIcon(this.yInfoEl,p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(e.description||e.sourceLink))),a.setIcon(this.xInfoEl,p).select("svg").attr("width","0px").attr("height","0px").style("opacity",Number(Boolean(i.description||i.sourceLink))),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=a.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+r.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t._updateDoubtOpacity(1)}).on("mouseout",function(){t._updateDoubtOpacity()})},_updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.model.time.formatDate(this.time))),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateEntities:function(){var t=this,e=this.dataKeys=this.model.marker.getDataKeysPerHook(),i=this.KEYS,n=this.KEY,r=this.TIMEDIM,o=this.model.time.end,s=function(s){return s=s||"",t.model.marker.getKeys().map(function(l){var u=Object.assign({},l);return u[r]=o,u.sortValue=t.frame.size[a.getKey(l,e.size)]||0,u[n]=s+a.getKey(l,i),u}).sort(function(t,e){return e.sortValue-t.sortValue})}.call(this);this.model.marker.setVisible(s),this.model.time.splash||this.unselectBubblesWithNoData(s),this.entityBubbles=this.bubbleContainer.selectAll("circle.vzb-bc-entity").data(this.model.marker.getVisible(),function(t){return t[n]}),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class",function(t){return"vzb-bc-entity bubble-"+t[n]}).on("mouseover",function(e,i){a.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseover(e,i)}).on("mouseout",function(e,i){a.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseout(e,i)}).on("click",function(e,i){a.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().click(e,i)}).onTap(function(e,i){d3.event.stopPropagation(),t._bubblesInteract().click(e,i)}).onLongTap(function(t,e){}).merge(this.entityBubbles),this._reorderEntities()},unselectBubblesWithNoData:function(t){var e=this.KEYS,i=this.KEY;if(this.model.marker.select.length){var n=[],r=t.map(function(t){return t[i]});this.model.marker.select.forEach(function(t){-1!==r.indexOf(a.getKey(t,e))&&n.push(t)}),n.length!==this.model.marker.select.length&&(this.model.marker.select=n)}},_reorderEntities:function(){var t=this,e=this.dataKeys,i=this.KEY;this.bubbleContainer.selectAll(".vzb-bc-entity").sort(function(n,r){var o=t.frame.size[a.getKey(n,e.size)],s=t.frame.size[a.getKey(r,e.size)];return void 0===o&&void 0!==s?-1:void 0!==o&&void 0===s?1:o!=s?d3.descending(o,s):n[i]!=r[i]?d3.ascending(n[i],r[i]):void 0!==n.trailStartTime||void 0!==r.trailStartTime?void 0!==n.trailStartTime?-1:1:void 0!==n.status||void 0!==r.status?void 0!==n.status?-1:1:d3.descending(o,s)})},_bubblesInteract:function(){var t=this;this.KEY,this.TIMEDIM;return{mouseover:function(e,i){t.model.marker.highlightMarker(e),t._labels.showCloseCross(e,!0)},mouseout:function(e,i){t.model.marker.clearHighlighted(),t._labels.showCloseCross(e,!1)},click:function(e,i){if(!t.draggingNow){var n=t.model.marker.isSelected(e);t.model.marker.selectMarker(e),a.isTouchDevice()||(n&&t.model.marker.highlightMarker(e),t.highlightDataPoints())}}}},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time,"ui"),this.duration)},updateSize:function(){var t=this.chartSvg,e=a.px2num(t.style("width")),i=a.px2num(t.style("height")),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+i*e},r=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t+e*i},o={small:{margin:{top:30,bottom:35,left:30,right:10},leftMarginRatio:1,padding:2,minRadiusPx:.5,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},medium:{margin:{top:15,bottom:40,left:40,right:15},leftMarginRatio:1.6,padding:2,minRadiusPx:1,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:20,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4},large:{margin:{top:15,bottom:n(30,.03),left:r(31,.015),right:20},leftMarginRatio:1.8,padding:2,minRadiusPx:1,maxRadiusEm:this.model.ui.chart.maxRadiusEm||.05,infoElHeight:22,yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:n(0,.01),hideSTitle:!0}},s={medium:{margin:{top:20,bottom:55,left:50,right:20},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:4,infoElHeight:26},large:{margin:{top:30,bottom:n(45,.03),left:r(35,.025),right:30},yAxisTitleBottomMargin:3,xAxisTitleBottomMargin:n(-10,.01),infoElHeight:32,hideSTitle:!0}};this.activeProfile=this.getActiveProfile(o,s);var l=this.getLayoutProfile(),u=this.root.getVizWidthHeight();this.activeProfile.maxRadiusPx=Math.max(this.activeProfile.minRadiusPx,this.activeProfile.maxRadiusEm*a.hypotenuse(u.width,u.height));var c=this.activeProfile.margin,h=this.activeProfile.infoElHeight;if(this._labels.setCloseCrossHeight(1.2*this.activeProfile.infoElHeight),this._labels.setTooltipFontSize(this.activeProfile.infoElHeight+"px"),this.height=parseInt(this.element.style("height"),10)-c.top-c.bottom||0,this.width=parseInt(this.element.style("width"),10)-c.left*this.activeProfile.leftMarginRatio-c.right||0,(this.height<=0||this.width<=0)&&(this.height=0,this.width=0,a.warn("Bubble chart updateSize(): vizabi container is too little or has display:none")),this.graph.attr("transform","translate("+c.left*this.activeProfile.leftMarginRatio+","+c.top+")"),this.year.resize(this.width,this.height),this.eventArea.attr("width",this.width).attr("height",Math.max(0,this.height)),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range(this._rangeBump([this.height,0])):this.yScale.rangePoints([this.height,0],this.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range(this._rangeBump([0,this.width])):this.xScale.rangePoints([0,this.width],this.activeProfile.padding).range(),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:c,limitMaxTickNumber:6,bump:this.activeProfile.maxRadiusPx/2,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:c,bump:this.activeProfile.maxRadiusPx/2,viewportLength:this.width,formatter:this.model.marker.axis_x.getTickFormatter()}),this.bubbleContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-1),this.xAxisEl.attr("transform","translate(1,"+(1+this.height)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.projectionX.attr("y1",this.yScale.range()[0]+this.activeProfile.maxRadiusPx/2),this.projectionY.attr("x2",this.xScale.range()[0]-this.activeProfile.maxRadiusPx/2),this._updateSTitle(),this.sTitleEl.attr("transform","translate("+this.width+",20) rotate(-90)"),"small"!==l)this.ySubTitleEl.select("text").attr("dy",.6*h).text(this.strings.subtitle.Y),this.xSubTitleEl.select("text").attr("dy",.3*-h).text(this.strings.subtitle.X),this.yTitleEl.select("text").text(this.strings.title_short.Y+" ").append("tspan").style("font-size",.7*h+"px").text(""),this.xTitleEl.select("text").text(this.strings.title_short.X+" ").append("tspan").style("font-size",.7*h+"px").text("");else{this.ySubTitleEl.select("text").text(""),this.xSubTitleEl.select("text").text("");var d=this.yTitleEl.select("text").text(this.strings.title.Y);d.node().getBBox().width>this.width&&d.text(this.strings.title_short.Y);var f=this.xTitleEl.select("text").text(this.strings.title.X);f.node().getBBox().width>this.width-100&&f.text(this.strings.title_short.X)}var p=this.model.locale.isRTL();if(this.ySubTitleEl.style("font-size",.8*h+"px").attr("transform","translate(0,0) rotate(-90)"),this.xSubTitleEl.style("font-size",.8*h+"px").attr("transform","translate("+this.width+","+this.height+")"),this.yTitleEl.style("font-size",h+"px").attr("transform","small"!==l?"translate("+(-c.left-this.activeProfile.yAxisTitleBottomMargin)+","+.5*this.height+") rotate(-90)":"translate("+(p?this.width:10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")"),this.xTitleEl.style("font-size",h+"px").attr("transform","small"!==l?"translate("+.5*this.width+","+(this.height+c.bottom-this.activeProfile.xAxisTitleBottomMargin)+")":"translate("+(p?this.width:0)+","+(this.height+c.bottom-this.activeProfile.xAxisTitleBottomMargin)+")"),this.yInfoEl.select("svg").node()){var m=this.yTitleEl.node().getBBox(),v=a.transform(this.yTitleEl.node()),g=p?m.x+v.translateX-1.4*h:m.x+v.translateX+m.width+.4*h,y=p?v.translateY+1.4*h+.5*m.width:v.translateY-.4*h-.5*m.width;this.yInfoEl.select("svg").attr("width",h+"px").attr("height",h+"px"),this.yInfoEl.attr("transform","small"!==l?"translate("+(v.translateX-.8*h)+","+y+") rotate(-90)":"translate("+g+","+(v.translateY-.8*h)+")")}if(this.xInfoEl.select("svg").node()){var _=this.xTitleEl.node().getBBox(),b=a.transform(this.xTitleEl.node()),x=p?_.x+b.translateX-1.4*h:_.x+b.translateX+_.width+.4*h;this.xInfoEl.select("svg").attr("width",h+"px").attr("height",h+"px"),this.xInfoEl.attr("transform","translate("+x+","+(b.translateY-.8*h)+")")}this._resizeDataWarning(),this.model.ui.chart.margin.set("left",c.left*this.activeProfile.leftMarginRatio,!1,!1)},_updateDecorations:function(t){var e=this,i=this.model.ui.chart.decorations.xAxisGroups&&this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which]&&this.model.ui.chart.decorations.enabled&&"small"!==this.getLayoutProfile();if(this.xAxisGroupsEl.classed("vzb-invisible",!i),i){var n=this.model.ui.chart.decorations.xAxisGroups[this.model.marker.axis_x.which],r=this.xAxisGroupsEl.selectAll(".vzb-bc-x-axis-group").data(n);r.exit().remove(),(r=r.enter().append("g").attr("class","vzb-bc-x-axis-group").each(function(){var t=d3.select(this);t.append("line").attr("class","vzb-bc-x-axis-group-line"),t.append("text")}).merge(r)).each(function(i){var n=d3.select(this),r=n.select("text").text(e.translator(i.label)),o=r.node().getBBox().height;r.transition().duration(t||0).attr("y",o).attr("x",e.xScale(i.min||0===i.min?i.min:e.model.marker.axis_x.domainMin)/2+e.xScale(i.max||0===i.max?i.max:e.model.marker.axis_x.domainMax)/2);var a=i.max||0===i.max;n.select("line.vzb-bc-x-axis-group-line").classed("vzb-invisible",!a),a&&n.select("line.vzb-bc-x-axis-group-line").transition().duration(t||0).attr("y1",0).attr("y2",o).attr("x1",e.xScale(i.max)).attr("x2",e.xScale(i.max))})}var o=this.model.marker.axis_x.which==this.model.marker.axis_y.which&&this.model.ui.chart.decorations.enabled&&"small"!==this.getLayoutProfile();if(this.lineEqualXY.classed("vzb-invisible",!o),o){var a=d3.min(this.yScale.domain().concat(this.xScale.domain())),s=d3.max(this.yScale.domain().concat(this.xScale.domain()));this.lineEqualXY.transition().duration(t||0).attr("y1",this.yScale(a)).attr("y2",this.yScale(s)).attr("x1",this.xScale(a)).attr("x2",this.xScale(s))}},_resizeDataWarning:function(){var t=this.dataWarningEl.select("text").style("font-size",null),e=t.node().getBBox().width+3*t.node().getBBox().height,i=this.width-this.xTitleEl.node().getBBox().width-this.activeProfile.infoElHeight,n=parseInt(t.style("font-size"))*i/e;t.style("font-size",e>i?n+"px":null);var r=t.node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+(this.model.locale.isRTL()?r.width+r.height:this.width)+","+(this.height+this.activeProfile.margin.bottom-this.activeProfile.xAxisTitleBottomMargin)+")")},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return a.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var e=this.activeProfile.minRadiusPx,i=this.activeProfile.maxRadiusPx,n=a.radiusToArea(Math.max(i*t[0],e)),r=a.radiusToArea(Math.max(i*t[1],e)),o=n===r?[n,r]:d3.range(n,r,(r-n)/this.sScale.domain().length).concat(r);this.sScale.range(o)},redrawDataPointsOnlyColors:function(){var t=this;if(!this.entityBubbles)return a.warn("redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!");var e=void 0,i=this.dataKeys=this.model.marker.getDataKeysPerHook(),n=this.KEYS,r=this.KEY,o=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(o=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(o,function(o){if(!t._frameIsValid(o))return a.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing");e=t.frame,t.entityBubbles.each(function(s,l){var u=t.model.marker.isSelected(s),c=u?e.color[a.getKey(s,i.color)]:o.color[a.getKey(s,i.color)],h=null!=c?t.cScale(c):t.COLOR_WHITEISH;if(d3.select(this).style("fill",h),u){var d=a.find(t.model.marker.select,function(t){return a.getKey(t,n)==s[r]}),f=t.model.time.parse(""+d.trailStartTime);t.model.marker.getFrame(f,function(e){if(!e)return a.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing");var n={};if(t.model.ui.chart.trails&&f-t.time!=0){var r=e.color[a.getKey(s,i.color)];n.scaledC0=null!=r?t.cScale(r):t.COLOR_WHITEISH}else n.scaledC0=h;t._labels.updateLabelOnlyColor(s,l,n)})}})})},redrawDataPointsOnlySize:function(){var t=this,e=void 0,i=this.dataKeys=this.model.marker.getDataKeysPerHook(),n=this.KEYS,r=this.KEY,o=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(o=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(o,function(o){if(!t._frameIsValid(o))return a.warn("redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing");e=t.frame,t.entityBubbles.each(function(s,l){var u=t.model.marker.isSelected(s),c=u?e.size[a.getKey(s,i.size)]:o.size[a.getKey(s,i.size)];if(null!=c){var h=a.areaToRadius(t.sScale(c));if(d3.select(this).attr("r",h),u){var d=a.find(t.model.marker.select,function(t){return a.getKey(t,n)==s[r]}),f=t.model.time.parse(""+d.trailStartTime);t.model.marker.getFrame(f,function(e){if(!e)return a.warn("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing");var n={};t.model.ui.chart.trails&&f-t.time!=0?n.scaledS0=a.areaToRadius(t.sScale(e.size[a.getKey(s,i.size)])):n.scaledS0=h,t._labels.updateLabelOnlyPosition(s,l,n)})}}})})},redrawDataPoints:function(t){var e=this;this.KEY;if(null==t&&(t=e.duration),this.model.ui.chart.lockNonSelected&&this.someSelected){var i=this.model.time.parse(""+this.model.ui.chart.lockNonSelected);this.model.marker.getFrame(i,function(i){if(!i)return a.warn("redrawDataPoints: empty data received from marker.getFrames(). doing nothing");e.entityBubbles.each(function(n,r){var o=e.model.marker.isSelected(n)?e.frame:i;e._updateBubble(n,o,r,d3.select(this),t)})})}else e.entityBubbles.each(function(i,n){e._updateBubble(i,e.frame,n,d3.select(this),t)});this._updateDecorations(t)},_updateBubble:function(t,e,i,n,r){var o=this.dataKeys,s=!1,l=e.axis_y[a.getKey(t,o.axis_y)],u=e.axis_x[a.getKey(t,o.axis_x)],c=e.size[a.getKey(t,o.size)],h=e.label[a.getKey(t,o.label)],d=e.color[a.getKey(t,o.color)],f=e.size_label[a.getKey(t,o.size_label)];if(!l&&0!==l||!u&&0!==u||!c&&0!==c){if(t.hidden||(t.hidden=!0,s=!0),s)if(r){var p=n.style("opacity");n.transition().duration(r).ease(d3.easeExp).style("opacity",0).on("end",function(){n.classed("vzb-invisible",t.hidden),n.style("opacity",p)})}else n.classed("vzb-invisible",t.hidden)}else{(t.hidden||n.classed("vzb-invisible"))&&(t.hidden=!1,s=!0);var m=a.areaToRadius(this.sScale(c));if(n.style("fill",null!=d?this.cScale(d):this.COLOR_WHITEISH),r)if(s){var v=n.style("opacity");n.classed("vzb-invisible",t.hidden),n.style("opacity",0).attr("cy",this.yScale(l)).attr("cx",this.xScale(u)).attr("r",m).transition().duration(r).ease(d3.easeExp).style("opacity",v)}else n.transition().duration(r).ease(d3.easeLinear).attr("cy",this.yScale(l)).attr("cx",this.xScale(u)).attr("r",m);else n.interrupt().attr("cy",this.yScale(l)).attr("cx",this.xScale(u)).attr("r",m).transition(),s&&n.classed("vzb-invisible",t.hidden);this.model.time.record&&this._export.write({type:"circle",id:t[KEY],time:this.model.time.value.getUTCFullYear(),fill:null!=d?this.cScale(d):this.COLOR_WHITEISH,cx:this.xScale(u),cy:this.yScale(l),r:m})}this._updateLabel(t,i,e,u,l,c,d,h,f,r,s)},_updateLabel:function(t,e,i,n,r,o,s,l,u,c,h){var d=this.KEYS,f=this.KEY;if(this.model.marker.isSelected(t)){var p={},m=a.find(this.model.marker.select,function(e){return a.getKey(e,d)==t[f]}),v=this.model.time.formatDate(this.time);this.model.ui.chart.trails&&m.trailStartTime!=v&&null!=m.trailStartTime||(this.model.ui.chart.trails&&null==m.trailStartTime&&(m.trailStartTime=v),p.labelX0=n,p.labelY0=r,p.scaledC0=null!=s?this.cScale(s):this.COLOR_WHITEISH,p.scaledS0=o||0===o?a.areaToRadius(this.sScale(o)):null);var g=this.model.time.parse(""+m.trailStartTime),y=this._getLabelText(i,t,m.trailStartTime);h&&t.hidden&&this.model.ui.chart.trails&&g&&g<this.time&&(h=!1),t.hidden&&!this.model.ui.chart.trails&&(h=!0),this._labels.updateLabel(t,e,p,n,r,o,s,y,u,c,h)}},_getLabelText:function(t,e,i){return this.model.marker.getCompoundLabelText(e,t)+(i&&this.model.time.start-this.model.time.end!=0?" "+i:"")},_setTooltip:function(t,e,i,n,r,o){if(t){var s={};if(o){var l=this.dataKeys,u=this.frame;s.valueY=u.axis_y[a.getKey(o,l.axis_y)],s.valueX=u.axis_x[a.getKey(o,l.axis_x)],s.valueS=u.size[a.getKey(o,l.size)],s.valueC=u.color[a.getKey(o,l.color)],s.valueLST=u.size_label[a.getKey(o,l.size_label)],s.labelText=this._getLabelText(u,o,this.model.time.formatDate(this.time))}var c={};c.labelX0=this.xScale.invert(e),c.labelY0=this.yScale.invert(i),c.scaledS0=n,c.scaledC0=null,this._labels.setTooltip(o,t,c,s)}else this._labels.setTooltip()},_formatSTitleValues:function(t,e){var i=this.strings.unit.S,n=this.strings.unit.C,r=this.model.marker.size.getTickFormatter(),o=this.model.marker.color.getTickFormatter();return this.model.marker.color.isDiscrete()&&"constant"!==this.model.marker.color.use&&e&&this.model.marker.color.getColorlegendMarker()&&(e=this.model.marker.color.getColorlegendMarker().label.getItems()[e]||""),[r(t)+" "+i,e||0===e?o(e)+" "+n:this.translator("hints/nodata")]},_updateSTitle:function(t,e){if(this.activeProfile.hideSTitle&&this.model.ui.dialogs.sidebar.indexOf("colors")>-1&&this.model.ui.dialogs.sidebar.indexOf("size")>-1)this.sTitleEl.classed("vzb-invisible",!0);else{this.sTitleEl.classed("vzb-invisible")&&this.sTitleEl.classed("vzb-invisible",!1);var i="constant"!==this.model.marker.size.use,n="constant"!==this.model.marker.color.use,r=this.sTitleEl.select("text").style("font-size",null).text((i?this.translator("buttons/size")+": "+(t||this.strings.title.S):"")+(i&&n?", ":"")+(n?this.translator("buttons/colors")+": "+(e||this.strings.title.C):"")),o=r.node().getBBox().width,a=this.height-30,s=parseInt(r.style("font-size"))*a/o;r.style("font-size",o>a?s+"px":null)}},selectDataPoints:function(){this.KEY;a.isTouchDevice()?(this.model.marker.clearHighlighted(),this._labels.showCloseCross(null,!1)):(this._setTooltip(),this._setBubbleCrown()),this.someSelected=this.model.marker.select.length>0,this.nonSelectedOpacityZero=!1},_setBubbleCrown:function(t,e,i,n,r){null!=t?(this.bubbleCrown.classed("vzb-hidden",!1),this.bubbleCrown.select(".vzb-crown").attr("cx",t).attr("cy",e).attr("r",i).attr("fill",r?"none":n),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("cx",t).attr("cy",e).attr("r",i+10).attr("stroke",n)):this.bubbleCrown.classed("vzb-hidden",!0)},_axisProjections:function(t){var e=this,i=this.TIMEDIM,n=this.dataKeys;null!=t?this.model.marker.getFrame(t[i],function(i){var r=i.axis_y[a.getKey(t,n.axis_y)],o=i.axis_x[a.getKey(t,n.axis_x)],s=i.size[a.getKey(t,n.size)],l=a.areaToRadius(e.sScale(s));!r&&0!==r||!o&&0!==o||!s&&0!==s||(e.model.ui.chart.whenHovering.showProjectionLineX&&e.xScale(o)>0&&e.xScale(o)<e.width&&e.yScale(r)+l<e.height&&e.projectionX.style("opacity",1).attr("y2",e.yScale(r)+l).attr("x1",e.xScale(o)).attr("x2",e.xScale(o)),e.model.ui.chart.whenHovering.showProjectionLineY&&e.yScale(r)>0&&e.yScale(r)<e.height&&e.xScale(o)-l>0&&e.projectionY.style("opacity",1).attr("y1",e.yScale(r)).attr("y2",e.yScale(r)).attr("x1",e.xScale(o)-l),e.model.ui.chart.whenHovering.higlightValueX&&e.xAxisEl.call(e.xAxis.highlightValue(o)),e.model.ui.chart.whenHovering.higlightValueY&&e.yAxisEl.call(e.yAxis.highlightValue(r)))}):(this.projectionX.style("opacity",0),this.projectionY.style("opacity",0),this.xAxisEl.call(this.xAxis.highlightValue("none")),this.yAxisEl.call(this.yAxis.highlightValue("none")))},highlightDataPoints:function(){var t=this,e=this.TIMEDIM,i=this.dataKeys,n=this.KEYS,r=this.KEY;if(this.someHighlighted=this.model.marker.highlight.length>0,this.updateBubbleOpacity(),1===this.model.marker.highlight.length){var o=a.clone(this.model.marker.highlight[0]);o[r]=a.getKey(o,n),t.model.ui.chart.lockNonSelected&&t.someSelected&&!t.model.marker.isSelected(o)?o[e]=t.model.time.parse(""+t.model.ui.chart.lockNonSelected):o[e]=t.model.time.parse(""+o.trailStartTime)||t.time,t.model.marker.getFrame(o[e],function(s){if(s){var l=t.xScale(s.axis_x[a.getKey(o,i.axis_x)]),u=t.yScale(s.axis_y[a.getKey(o,i.axis_y)]),c=a.areaToRadius(t.sScale(s.size[a.getKey(o,i.size)])),h=null!=s.color[a.getKey(o,i.color)]?t.cScale(s.color[a.getKey(o,i.color)]):t.COLOR_WHITEISH,d=!1,f=t._formatSTitleValues(s.size[a.getKey(o,i.size)],s.color[a.getKey(o,i.color)]);t._updateSTitle(f[0],f[1]),(l+c<0||l-c>t.width||u+c<0||u-c>t.height)&&(d=!0);var p="",m=!1;if(t.model.marker.isSelected(o)&&t.model.ui.chart.trails){p=t.model.time.formatDate(t.time);var v=a.find(t.model.marker.select,function(t){return a.getKey(t,n)==o[r]});m=p!==v.trailStartTime&&!d3.select(d3.event.target).classed("bubble-"+o[r]),p=p!==v.trailStartTime&&t.time===o[e]?p:""}else p=t.model.marker.isSelected(o)?"":t._getLabelText(s,o);if(t._labels.highlight(null,!1),t._labels.highlight(o,!0),t.model.marker.isSelected(o)){var g=!o.trailStartTime||o.trailStartTime==t.model.time.formatDate(t.time);t._setBubbleCrown(l,u,c,h,g)}d||m||t._axisProjections(o),!p||d||m||t._setTooltip(p,l,u,c+3,h,o);var y=a.find(t.model.marker.select,function(t){return a.getKey(t,n)==o[r]});if(y){var _=a.clone(y);_.opacity=1,t._trails.run(["opacityHandler"],_)}}})}else this._axisProjections(),this._trails.run(["opacityHandler"]),t._updateSTitle(),this._setTooltip(),this._setBubbleCrown(),this._labels.highlight(null,!1)},_blinkSuperHighlighted:function(){var t=this;this.entityBubbles.classed("vzb-super-highlighted",function(e){return t.model.marker.isSuperHighlighted(e)})},updateBubbleOpacity:function(t){var e=this,i=this.model.marker.opacityHighlightDim,n=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?1:e.someSelected?e.model.marker.isSelected(t)?1:r:e.someHighlighted?i:n});var o=e.model.marker.opacitySelectDim<.01;o!=this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(t){return e.someSelected&&o&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=m},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Vizabi.utils,r=Vizabi.Class.extend({init:function(t){this.context=t,this.dragRectangle=d3.drag(),this.zoomer=d3.zoom(),this.dragRectangle.subject(this.dragSubject()).on("start",this.drag().start).on("drag",this.drag().go).on("end",this.drag().stop),this.zoomer.filter(this.zoomFilter()).scaleExtent([.0625,1/0]).on("start",this.zoom().start).on("zoom",this.zoom().go).on("end",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,t._zoomedXYMinMax={axis_x:{zoomedMin:null,zoomedMax:null},axis_y:{zoomedMin:null,zoomedMax:null}}},dragSubject:function(){var t=this.context;return function(e){return!d3.event.sourceEvent.ctrlKey&&!d3.event.sourceEvent.metaKey&&"plus"!==t.ui.cursorMode||"minus"===t.ui.cursorMode||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1)?null:{x:d3.mouse(this)[0],y:d3.mouse(this)[1]}}},drag:function(){var t=this.context,e=this;return{start:function(e,i){this.origin={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},t.zoomRect.classed("vzb-invisible",!1)},go:function(e,i){var n=this.origin,r={x:d3.event.x,y:d3.event.y};t.zoomRect.attr("x",Math.min(r.x,n.x)).attr("y",Math.min(r.y,n.y)).attr("width",Math.abs(r.x-n.x)).attr("height",Math.abs(r.y-n.y))},stop:function(i){if(t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},!(Math.abs(this.origin.x-this.target.x)<10||Math.abs(this.origin.y-this.target.y)<10)){var n=d3.event.sourceEvent.ctrlKey||d3.event.sourceEvent.metaKey||"plus"===t.ui.cursorMode;e._zoomOnRectangle(d3.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,n,500)}}}},zoomFilter:function(){var t=this.context;return function(e){var i=d3.event;return!i.ctrlKey&&!i.metaKey&&(("touchmove"===i.type||"touchstart"===i.type)&&(i.touches.length>1||i.targetTouches.length>1)||(!("wheel"!==i.type&&"mousewheel"!==i.type||!t.ui.zoomOnScrolling)||!("mousedown"!==i.type&&"touchstart"!==i.type||"plus"===t.ui.cursorMode||"minus"===t.ui.cursorMode||!t.ui.panWithArrow&&"hand"!==t.ui.cursorMode)))}},zoom:function(){var t=this.context,e=this.zoomer,i=this;return{start:function(){"plus"!==t.ui.cursorMode&&"minus"!==t.ui.cursorMode&&t.chartSvg.classed("vzb-zooming",!0),t.model._data.marker.clearHighlighted(),t._setTooltip()},go:function(){var r=d3.event.sourceEvent,o=d3.event.transform.k,a=[d3.event.transform.x,d3.event.transform.y],s=e.ratioY,l=e.ratioX;t.draggingNow=!0,(isNaN(o)||null==o)&&(o=e.scale),(isNaN(o)||null==o)&&(o=1),1===o&&null!==r&&(("wheel"===r.type||"mousewheel"===r.type)&&(r.deltaY||-r.wheelDelta)>0||"touchmove"===r.type&&r.touches.length>1)&&(e.ratioX=1,l=1,e.ratioY=1,s=1),(isNaN(a[0])||isNaN(a[1])||null==a[0]||null==a[1])&&(a=[0,0]);var u=e.scaleExtent()[0];o*s<u&&(s=u/o,e.ratioY=s),o*l<u&&(l=u/o,e.ratioX=l);var c=o*l<1,h=o*s<1;c?(a[0]<0&&(a[0]=0),a[0]>(1-o*l)*t.width&&(a[0]=(1-o*l)*t.width)):(a[0]>0&&(a[0]=0),a[0]<(1-o*l)*t.width&&(a[0]=(1-o*l)*t.width)),h?(a[1]<0&&(a[1]=0),a[1]>(1-o*s)*t.height&&(a[1]=(1-o*s)*t.height)):(a[1]>0&&(a[1]=0),a[1]<(1-o*s)*t.height&&(a[1]=(1-o*s)*t.height)),i.zoomSelection.property("__zoom",d3.zoomIdentity.translate(a[0],a[1]).scale(o));var d=t.width*o*l,f=t.height*o*s,p=[0*o*l+a[0],d+a[0]],m=[f+a[1],0*o*s+a[1]],v=t._rangeBump(p),g=t._rangeBump(m),y=(v[0]-p[0])*o*l,_=(v[1]-p[1])*o*l,b=(g[0]-m[0])*o*s,x=(g[1]-m[1])*o*s;p[0]+=y,p[1]+=_,m[0]+=b,m[1]+=x;var w=[0,t.width],S=[t.height,0],M=t._rangeBump(w),E=t._rangeBump(S);c?(p[0]<M[0]&&(a[0]=M[0]-y),p[1]>M[1]&&(a[0]=M[1]-_-d)):(p[0]>M[0]&&(a[0]=M[0]-y),p[1]<M[1]&&(a[0]=M[1]-_-d)),h?(m[0]>E[0]&&(a[1]=E[0]-b-f),m[1]<E[1]&&(a[1]=E[1]-x)):(m[0]<E[0]&&(a[1]=E[0]-b-f),m[1]>E[1]&&(a[1]=E[1]-x)),c?(p[0]<M[0]&&(p[1]+=Math.abs(p[0]-M[0]),p[0]=M[0]),p[1]>M[1]&&(p[0]-=Math.abs(p[1]-M[1]),p[1]=M[1])):(p[0]>M[0]&&(p[1]-=Math.abs(p[0]-M[0]),p[0]=M[0]),p[1]<M[1]&&(p[0]+=Math.abs(p[1]-M[1]),p[1]=M[1])),h?(m[0]>E[0]&&(m[1]-=Math.abs(m[0]-E[0]),m[0]=E[0]),m[1]<E[1]&&(m[0]+=Math.abs(m[1]-E[1]),m[1]=E[1])):(m[0]<E[0]&&(m[1]+=Math.abs(m[0]-E[0]),m[0]=E[0]),m[1]>E[1]&&(m[0]-=Math.abs(m[1]-E[1]),m[1]=E[1])),"ordinal"===t.model.marker.axis_x.scaleType?t.xScale.rangeBands(p):t.xScale.range(p),"ordinal"===t.model.marker.axis_y.scaleType?t.yScale.rangeBands(m):t.yScale.range(m);var z=function(t){return n.isDate(t)?t:+t.toFixed(2)},k=M,T=E;t._zoomedXYMinMax={axis_x:{zoomedMin:z(t.xScale.invert(k[0])),zoomedMax:z(t.xScale.invert(k[1]))},axis_y:{zoomedMin:z(t.yScale.invert(T[0])),zoomedMax:z(t.yScale.invert(T[1]))}},e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,null,!1);var O=t.yAxis.labelerOptions(),C=t.xAxis.labelerOptions();O.limitMaxTickNumber=o*s<1.5?8:o*s*8,C.limitMaxTickNumber=o*l<1.5?8:o*l*8,O.transitionDuration=e.duration,C.transitionDuration=e.duration,t.xAxisEl.call(t.xAxis.labelerOptions(C)),t.yAxisEl.call(t.yAxis.labelerOptions(O)),t.redrawDataPoints(e.duration),t._trails.run("resize",null,e.duration),e.duration=0},stop:function(){t.chartSvg.classed("vzb-zooming",!1),t.draggingNow=!1,e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,!0,!0),e.dontFeedToState=null}}},expandCanvas:function(t){var e=this.context;t||(t=e.duration);var i=d3.extent(n.values(e.frame.axis_x)),r=d3.extent(n.values(e.frame.axis_y));if(!i[0]&&0!==i[0]||!i[1]&&0!==i[1]||!r[0]&&0!==r[0]||!r[1]&&0!==r[1])return n.warn("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");var o={x1:e.xScale(i[0]),y1:e.yScale(r[0]),x2:e.xScale(i[1]),y2:e.yScale(r[1])},a=[0,e.width],s=[e.height,0],l=a[0],u=a[1],c=s[0],h=s[1];if(!e.isCanvasPreviouslyExpanded||o.x1<1*l||o.x2>1*u||o.y2<1*h||o.y1>1*c){if(e.isCanvasPreviouslyExpanded){var d=e._rangeBump(a),f=e._rangeBump(s);o.x1>d[0]&&(o.x1=d[0]),o.x2<d[1]&&(o.x2=d[1]),o.y1<f[0]&&(o.y1=f[0]),o.y2>f[0]&&(o.y2=f[1])}e.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(e.element,o.x1,o.y1,o.x2,o.y2,!1,t)}else e.redrawDataPoints(t)},zoomToMaxMin:function(t,e,i,n,r,o){var a=this.context,s=t,l=e,u=i,c=n,h=a.xScale.domain(),d=a.yScale.domain();s<h[0]&&l<h[1]&&(s=h[0]),s>h[0]&&l>h[1]&&(l=h[1]),u<d[0]&&c<d[1]&&(u=d[0]),u>d[0]&&c>d[1]&&(c=d[1]);var f=[a.xScale(s),a.xScale(l)],p=[a.yScale(u),a.yScale(c)];this._zoomOnRectangle(a.element,f[0],p[0],f[1],p[1],!1,r,o)},_zoomOnRectangle:function(t,e,i,r,o,a,s,l){var u=this.context,c=this.zoomer,h=d3.zoomTransform(this.zoomSelection.node()),d=e,f=i,p=r,m=o;a&&h.translate(d-p,f-m);var v=[0,u.width],g=[u.height,0],y=u._rangeBump(v),_=u._rangeBump(g),b=c.scaleExtent()[0],x=c.scaleExtent()[1],w=void 0,S=void 0,M=void 0;if(d==p||f==m||y[0]==y[1]||_[0]==_[1])return n.warn("_zoomOnRectangle(): can not proceed because this may result in infinity zooms");Math.abs(d-p)>Math.abs(f-m)?((w=Math.abs(_[0]-_[1])/Math.abs(f-m)*h.k)<b&&(c.ratioY*=w/h.k,w=b),w>x&&(w=x),S=Math.abs(y[0]-y[1])/Math.abs(d-p)*h.k/w*c.ratioX,M=c.ratioY):((w=Math.abs(y[0]-y[1])/Math.abs(d-p)*h.k)<b&&(c.ratioX*=w/h.k,w=b),w>x&&(w=x),M=Math.abs(_[0]-_[1])/Math.abs(f-m)*h.k/w*c.ratioY,S=c.ratioX);var E=[(h.x-Math.min(d,p))/h.k/c.ratioX*w*S+(y[0]-v[0]),(h.y-Math.min(f,m))/h.k/c.ratioY*w*M+(_[1]-g[1])];c.dontFeedToState=l,c.ratioY=M||1,c.ratioX=S||1,c.duration=s||0,this.zoomSelection.call(c.transform,d3.zoomIdentity.translate(E[0],E[1]).scale(w))},zoomByIncrement:function(t,e){this.context;var i=d3.zoomTransform(this.zoomSelection.node()),n=i.k,r=[i.x,i.y],o=d3.mouse(this.zoomSelection.node()),a=Math.log(n)/Math.LN2;"plus"!=t&&t||(a=Math.floor(a)+1),"minus"==t&&(a=Math.ceil(a)-1);var s=[(o[0]-r[0])/n,(o[1]-r[1])/n],l=this.zoomer.scaleExtent();n==l[0]&&(this.zoomer.ratioY=1,this.zoomer.ratioX=1),n=Math.max(l[0],Math.min(l[1],Math.pow(2,a))),s=[s[0]*n+r[0],s[1]*n+r[1]],r[0]+=o[0]-s[0],r[1]+=o[1]-s[1],this.zoomer.duration=e||0,this.zoomSelection.call(this.zoomer.transform,d3.zoomIdentity.translate(r[0],r[1]).scale(n))},resetZoomState:function(t){this.zoomer.ratioY=1,this.zoomer.ratioX=1,(t||this.zoomSelection).property("__zoom",d3.zoomIdentity)},reset:function(t,e){this.context.isCanvasPreviouslyExpanded=!1,this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.duration=e||0,(t||this.zoomSelection).call(this.zoomer.transform,d3.zoomIdentity)},rerun:function(t){this.context;(t||this.zoomSelection).call(this.zoomer.scaleBy,1)},zoomSelection:function(t){this.zoomSelection=t}});e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(4),o=(n=r)&&n.__esModule?n:{default:n};var a=Vizabi.utils,s=Vizabi.Class.extend({init:function(t){this.context=t,this._isCreated=null,this.actionsQueue={},this.entityTrails={},this.trailsData=[],this.trailsInProgress={},this.activePromises={},this.trailTransitions={},this.delayedIterations={},this.drawingQueue={}},toggle:function(t){var e=this.context;t?e._trails.create().then(function(){e._trails.run(["findVisible","reveal","opacityHandler"])}):(e._trails.run("remove"),e.model.marker.select.forEach(function(t){delete t.trailStartTime}))},create:function(t){var e=this.context,i=this,n=e.KEYS,r=e.KEY,s=e.dataKeys,l=e.TIMEDIM;return this._isCreated=new Promise(function(u,c){if(e.model.ui.chart.trails){var h=e.model.time.getAllSteps(),d=[];t=null==t?e.model.marker.select:[t],i._clearActions(t),i.trailsData=e.model.marker.select.map(function(t){var e={status:"created",selectedEntityData:t};return n.forEach(function(i){return e[i]=t[i]}),e[r]=a.getKey(t,n),e}),i.trailTransitions={};var f=e.bubbleContainer.selectAll("g.vzb-bc-entity.entity-trail").data(i.trailsData,function(t){return t[r]});f.exit().remove(),f.enter().insert("g",function(t){return this.querySelector(".bubble-"+(0,o.default)(t[r]))}).attr("class",function(t){return"vzb-bc-entity entity-trail trail-"+t[r]}).merge(f).each(function(t,o){var u=this;d.push(new Promise(function(o,c){var d=h.map(function(e){return{t:e,key:t[r]}}),f=d3.select(u).selectAll("g").data(d).classed("vzb-invisible",!0);f.exit().remove(),i.entityTrails[t[r]]=f.enter().append("g").attr("class","vzb-bc-trailsegment vzb-invisible").on("mouseover",function(i,o){if(!a.isTouchDevice()){var u={};u[r]=i.key,u[l]=i.t,e._axisProjections(u),e._labels.highlight(t,!0);var c=e.model.time.formatDate(i.t),h=a.find(e.model.marker.select,function(e){return a.getKey(e,n)==t[r]});e.model.marker.getFrame(u[l],function(i){var n=e.xScale(i.axis_x[a.getKey(t,s.axis_x)]),r=e.yScale(i.axis_y[a.getKey(t,s.axis_y)]),o=a.areaToRadius(e.sScale(i.size[a.getKey(t,s.size)])),l=null!=i.color[a.getKey(t,s.color)]?e.cScale(i.color[a.getKey(t,s.color)]):e.COLOR_WHITEISH;c!==h.trailStartTime&&e._setTooltip(c,n,r,o+3,l),e._setBubbleCrown(n,r,o,l),e.model.marker.getModelObject("highlight").trigger("change",{size:i.size[a.getKey(t,s.size)],color:i.color[a.getKey(t,s.color)]})}),d3.select(this).style("opacity",1)}}).on("mouseout",function(t,i){a.isTouchDevice()||(e._axisProjections(),e._setTooltip(),e._setBubbleCrown(),e._labels.highlight(null,!1),e.model.marker.getModelObject("highlight").trigger("change",null),d3.select(this).style("opacity",e.model.marker.opacityRegular))}).each(function(t,e){var i=d3.select(this);i.append("circle"),i.append("line")}).merge(f),o()}))}),d.length>0?Promise.all(d).then(function(t){u(!0)}):u(!0)}}),this._isCreated},_addActions:function(t,e){var i=this,n=this.context.KEYS;t.forEach(function(t){var r=a.getKey(t,n);i.actionsQueue[r]||(i.actionsQueue[r]=[]),i.actionsQueue[r]=[].concat(i.actionsQueue[r].filter(function(t){return-1==e.indexOf(t)}),e)})},_clearActions:function(t){var e=this,i=this.context.KEYS;t.forEach(function(t){var n=a.getKey(t,i);e.actionsQueue[n]||(e.actionsQueue[n]=[]),e.actionsQueue[n]=[],e.drawingQueue[n]={},e.delayedIterations[n]={},e.activePromises[n]||(e.activePromises[n]=[]),a.forEach(e.activePromises[n],function(t,e){"pending"===t.status&&t.reject()}),e.trailsInProgress[n]=null,e.activePromises[n]=[]})},_getNextAction:function(t){return this.actionsQueue[t].shift()},run:function(t,e,i){var n=this.context,r=this,o=n.KEY;this._isCreated&&!n.model.time.splash&&("string"==typeof t&&(t=[t]),this._isCreated.then(function(){if(n.model.ui.chart.trails&&n.model.marker.select.length||"remove"==t){i||(i=0),e=null==e?n.model.marker.select:[e];for(var a=0;a<t.length;a++)-1!=["resize","recolor","remove"].indexOf(t[a])&&function(){var e=t.splice(a,1).pop();--a,r.trailsData.forEach(function(t){var a=r.entityTrails[t[o]];n._trails["_"+e](a,i,t)})}();0!=t.length&&(r._addActions(e,t),r.trailsData.forEach(function(e){-1!=t.indexOf("findVisible")&&(r.drawingQueue[e[o]]={},r.delayedIterations[e[o]]={});var a=r.entityTrails[e[o]];r.trailsInProgress[e[o]]||function t(s){var l=r._getNextAction(e[o]);if(l){r.trailsInProgress[e[o]]=l;var u=n._trails["_"+l](a,i,e);u&&u instanceof Promise?u.then(function(){r.trailsInProgress[e[o]]=null,t(s+1)},function(){r.trailsInProgress[e[o]]=null}):(r.trailsInProgress[e[o]]=null,t(s+1))}}(0)}))}}))},_remove:function(t,e,i){this.actionsQueue[i[this.context.KEY]]=[],t&&(d3.select(this.entityTrails[i[this.context.KEY]].node().parentNode).remove(),this.entityTrails[i[this.context.KEY]]=null)},_resize:function(t,e,i){var n=this.context;if(!n.model.time.splash){var r=!1;t.each(function(t,o){if(null!=t.valueY&&null!=t.valueX&&null!=t.valueS){var s=d3.select(this);if(e?s.select("circle").transition().duration(e).ease(d3.easeLinear).attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",a.areaToRadius(n.sScale(t.valueS))):s.select("circle").interrupt().attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",a.areaToRadius(n.sScale(t.valueS))).transition(),r||t.transparent||(r=!0,n._labels.updateLabelOnlyPosition(i,null,{scaledS0:a.areaToRadius(n.sScale(t.valueS))})),t.next){var l=t.next;if(null!=l&&null!=l.valueY&&null!=l.valueX){var u=Math.sqrt(Math.pow(n.xScale(t.valueX)-n.xScale(l.valueX),2)+Math.pow(n.yScale(t.valueY)-n.yScale(l.valueY),2));e?s.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).attr("stroke-dasharray",u).attr("stroke-dashoffset",a.areaToRadius(n.sScale(t.valueS))):s.select("line").interrupt().attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).attr("stroke-dasharray",u).attr("stroke-dashoffset",a.areaToRadius(n.sScale(t.valueS))).transition()}}}})}},_recolor:function(t,e,i){var n=this.context;t.each(function(t,e){var i=d3.select(this),r="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:t.valueC,shadeID:"shade"}):null!=t.valueC?n.cScale(t.valueC):n.COLOR_BLACKISH;i.select("circle").style("fill",null!=t.valueC?n.cScale(t.valueC):n.COLOR_WHITEISH),i.select("line").style("stroke",r)})},_opacityHandler:function(t,e,i){var n=this.context;t.each(function(t,e){d3.select(this).style("opacity",i.opacity||n.model.marker.opacityRegular)})},_findVisible:function(t,e,i){var n=this.context,r=this,o=n.KEY,s=n.dataKeys;return new Promise(function(e,l){new Promise(function(t,e){i.limits?t():n.model.marker.getEntityLimits(i[o]).then(function(e){i.limits=e,t()})}).then(function(){i.selectedEntityData.trailStartTime||(i.selectedEntityData.trailStartTime=n.model.time.formatDate(n.time));var l=n.model.time.parse(""+i.selectedEntityData.trailStartTime);if(n.time-l<0||i.limits.min-l>0){n.time-l<0?(i.selectedEntityData.trailStartTime=n.model.time.formatDate(d3.max([n.time,i.limits.min])),l=n.model.time.parse(""+i.selectedEntityData.trailStartTime)):(i.selectedEntityData.trailStartTime=n.model.time.formatDate(i.limits.min),l=n.model.time.parse(""+i.selectedEntityData.trailStartTime));var u=n._labels.cached[i[o]],c=n.frame.size[a.getKey(i,s.size)],h=n.frame.color[a.getKey(i,s.color)];u.labelX0=n.frame.axis_x[a.getKey(i,s.axis_x)],u.labelY0=n.frame.axis_y[a.getKey(i,s.axis_y)],u.scaledS0=c||0===c?a.areaToRadius(n.sScale(c)):null,u.scaledC0=null!=h?n.cScale(h):n.COLOR_WHITEISH,n._updateLabel(i,0,n.frame,u.labelX0,u.labelY0,c,h,n.frame.label[a.getKey(i,s.label)],n.frame.size_label[a.getKey(i,s.size_label)],0,!0)}t.each(function(e,r){var o=e.transparent;e.transparent=null==i.selectedEntityData.trailStartTime||e.t-n.time>0||l-e.t>0||i.selectedEntityData.trailStartTime-n.model.time.formatDate(n.time)>=0,(o!=e.transparent||Math.abs(n.model.time.formatDate(e.t)-n.model.time.formatDate(n.time))<2)&&(e.visibilityChanged=!0),e.transparent&&d3.select(t._groups[0][r]).classed("vzb-invisible",e.transparent)}),r.drawingQueue[i[o]]={},r.delayedIterations[i[o]]={},e()})})},_abortAnimation:function(){var t=this,e=this.context.KEY;t.trailsData.forEach(function(i){t.trailTransitions[i[e]]&&t.trailTransitions[i[e]].select("line").interrupt().transition()})},_reveal:function(t,e,i){var n=this.context;n.model.time.playing&&(e=n.model.time.delay);var r=this,o=(n.KEYS,n.KEY),s=n.dataKeys;i.status="reveal";var l=n.model.time.parse(""+i.selectedEntityData.trailStartTime),u=function(t,u,h,d){return new Promise(function(d,f){var p=d3.select(t._groups[0][u]),m=p.datum();if(h-u==1){if(m.transparent)return p.classed("vzb-invisible",m.transparent),d();if(!m.visibilityChanged)return d()}n.model.marker.getFrame(m.t,function(f){if("reveal"!=i.status)return d();if(!f)return d();if(m.valueY=f.axis_y[a.getKey(i,s.axis_y)],m.valueX=f.axis_x[a.getKey(i,s.axis_x)],m.valueS=f.size[a.getKey(i,s.size)],m.valueC=f.color[a.getKey(i,s.color)],null==m.valueY||null==m.valueX||null==m.valueS)return d();if(l&&l.toString()==m.t.toString()){var v=n._labels.cached[i[o]];v.labelX0=m.valueX,v.labelY0=m.valueY;var g=m.valueS;v.scaledS0=g||0===g?a.areaToRadius(n.sScale(g)):null,v.scaledC0=null!=m.valueC?n.cScale(m.valueC):n.COLOR_WHITEISH,n._updateLabel(i,u,f,m.valueX,m.valueY,m.valueS,m.valueC,f.label[a.getKey(i,s.label)],f.size_label[a.getKey(i,s.size_label)],0,!0)}if(p.select("circle").attr("cy",n.yScale(m.valueY)).attr("cx",n.xScale(m.valueX)).attr("r",a.areaToRadius(n.sScale(m.valueS))).style("fill",null!=m.valueC?n.cScale(m.valueC):n.COLOR_WHITEISH),p.select("line").attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).attr("x1",n.xScale(m.valueX)).attr("y1",n.yScale(m.valueY)),n.time-m.t>0?(m.visibilityChanged=!1,p.classed("vzb-invisible",m.transparent)):p.classed("vzb-invisible",!0),!t._groups[0][h]||n.time.toString()==m.t.toString())return d();var y=d3.select(t._groups[0][h]).datum();y.previous=m,m.next=y;var _=y.t;n.time-y.t<0&&(m.visibilityChanged=!0,_=n.time),n.model.marker.getFrame(_,function(t){if("reveal"!=i.status)return d();if(!t||null==m.valueY||null==m.valueX||null==m.valueS)return d();if(null==t.axis_x[a.getKey(i,s.axis_x)]||null==t.axis_y[a.getKey(i,s.axis_y)])return d();y.valueY=t.axis_y[a.getKey(i,s.axis_y)],y.valueX=t.axis_x[a.getKey(i,s.axis_x)],y.valueS=t.size[a.getKey(i,s.size)],y.valueC=t.color[a.getKey(i,s.color)],r.trailTransitions[i[o]]=p;var l="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:m.valueC,shadeID:"shade"}):null!=m.valueC?n.cScale(m.valueC):n.COLOR_BLACKISH,f=Math.sqrt(Math.pow(n.xScale(m.valueX)-n.xScale(y.valueX),2)+Math.pow(n.yScale(m.valueY)-n.yScale(y.valueY),2));return p.select("line").attr("stroke-dasharray",f).attr("stroke-dashoffset",a.areaToRadius(n.sScale(m.valueS))).style("stroke",l).transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(y.valueX)).attr("y1",n.yScale(y.valueY)).attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)),h-u>1?(c(u,h),d()):d()})})})},c=function(t,e,n){var a=void 0;e-t>1&&(a=h(t,e),r.delayedIterations[i[o]][t]={first:t,next:e,medium:a}),n&&n-e>1&&(a=h(e,n),r.delayedIterations[i[o]][e]={first:e,next:n,medium:a})},h=function(t,e){return Math.round(t+(e-t)/2)},d=function(){return new Promise(function(l,u){Object.keys(r.drawingQueue[i[o]]).length>0?function u(){var h,d,f,p=Object.keys(r.drawingQueue[i[o]])[Math.floor(Math.random()*Object.keys(r.drawingQueue[i[o]]).length)],m=JSON.parse(JSON.stringify(r.drawingQueue[i[o]][p]));delete r.drawingQueue[i[o]][p],(h=m.first,d=m.next,f=m.medium,new Promise(function(r,o){var l=d3.select(t._groups[0][h]),u=d3.select(t._groups[0][d]),p=d3.select(t._groups[0][f]),m=l.datum(),v=u.datum(),g=p.datum();if(!m.previous&&!m.next||!v.previous&&!v.next)return r();n.model.marker.getFrame(g.t,function(t){if("reveal"!=i.status)return r();if(!t||void 0===t.axis_x||null==t.axis_x[a.getKey(i,s.axis_x)]||void 0===t.axis_y||null==t.axis_y[a.getKey(i,s.axis_y)])return a.warn("Frame for trail missed: "+g.t),r();if(g.valueY=t.axis_y[a.getKey(i,s.axis_y)],g.valueX=t.axis_x[a.getKey(i,s.axis_x)],g.valueS=t.size[a.getKey(i,s.size)],g.valueC=t.color[a.getKey(i,s.color)],g.previous=m,g.next=v,m.next=g,v.previous=g,null==g.valueY||null==g.valueX||null==g.valueS)return a.warn("Data for trail point missed: "+g.t),r();var o="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:g.valueC,shadeID:"shade"}):null!=g.valueC?n.cScale(g.valueC):n.COLOR_BLACKISH,u=Math.sqrt(Math.pow(n.xScale(m.valueX)-n.xScale(g.valueX),2)+Math.pow(n.yScale(m.valueY)-n.yScale(g.valueX),2));if(l.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(g.valueX)).attr("y1",n.yScale(g.valueY)).attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).attr("stroke-dasharray",u).attr("stroke-dashoffset",a.areaToRadius(n.sScale(m.valueS))).style("stroke",o),p.classed("vzb-invisible",g.transparent),!g.transparent){p.select("circle").attr("cy",n.yScale(g.valueY)).attr("cx",n.xScale(g.valueX)).attr("r",a.areaToRadius(n.sScale(g.valueS))).style("fill",null!=g.valueC?n.cScale(g.valueC):n.COLOR_WHITEISH);var y=Math.sqrt(Math.pow(n.xScale(g.valueX)-n.xScale(v.valueX),2)+Math.pow(n.yScale(g.valueY)-n.yScale(v.valueY),2));p.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(v.valueX)).attr("y1",n.yScale(v.valueY)).attr("x2",n.xScale(g.valueX)).attr("y2",n.yScale(g.valueY)).attr("stroke-dasharray",y).attr("stroke-dashoffset",a.areaToRadius(n.sScale(g.valueS))).style("stroke",o)}c(h,f,d),r()})})).then(function(){Object.keys(r.drawingQueue[i[o]]).length>0?u():l()})}(r.drawingQueue[i[o]]):l()})};return new Promise(function(e,s){if(n.model.marker.framesAreReady())!function t(i,n){if(n<0||n>=i._groups[0].length)return e();u(i,n,n+1).then(function(){t(i,n+1)},function(){return e()})}(t,0);else{r.delayedIterations[i[o]]={},r.drawingQueue[i[o]]={};var l=function(t,e,i){var r=[],o=0,s=0,l=d3.min([t.limits.max,n.time]),u=d3.max([t.limits.min,n.model.time.parse(""+t.selectedEntityData.trailStartTime)]);return a.forEach(e._groups[0],function(t,e){var a=t.__data__;a.t-u==0?o=e:a.t-l==0?s=e:a.t>u&&a.t<l&&(n.model.time.formatDate(a.t)%i==0||a.next&&a.previous)&&r.push(e)}),r.unshift(o),s>0&&r.push(s),r}(i,t,50),c=[];if(l.length<=1)return e();r.delayedIterations[i[o]]={};for(var h=0;h<l.length-1;h++)c.push(u(t,l[h],l[h+1]));Promise.all(c).then(function(){0==Object.keys(r.delayedIterations[i[o]]).length?e():(r.drawingQueue[i[o]]=r.delayedIterations[i[o]],r.delayedIterations[i[o]]={},function t(){d().then(function(){if(0==Object.keys(r.delayedIterations[i[o]]).length)return e();r.drawingQueue[i[o]]=r.delayedIterations[i[o]],r.delayedIterations[i[o]]={},t()},function(){return e()})}())},function(){e()})}})}});e.default=s},function(t,e,i){(function(e){var i,n;i=void 0!==e?e:this,n=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,i=String(t),n=i.length,r=-1,o="",a=i.charCodeAt(0);++r<n;)0!=(e=i.charCodeAt(r))?o+=e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==a?"\\"+e.toString(16)+" ":(0!=r||1!=n||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?i.charAt(r):"\\"+i.charAt(r):o+="";return o};return t.CSS||(t.CSS={}),t.CSS.escape=e,e},t.exports=n(i)}).call(e,i(7))},function(t,e){},function(t,e){t.exports='\x3c!-- Bubble Chart Component --\x3e\n<div class="vzb-bubblechart">\n    <svg class="vzb-bubblechart-svg vzb-export">\n        <g class="vzb-bc-graph">\n            <g class="vzb-bc-year"></g>\n\n            <svg class="vzb-bc-axis-x"><g></g></svg>\n            <svg class="vzb-bc-axis-y"><g></g></svg>\n            <line class="vzb-bc-projection-x"></line>\n            <line class="vzb-bc-projection-y"></line>\n\n            <svg class="vzb-bc-bubbles-crop">\n                <g class="vzb-zoom-selection"></g>\n                <g class="vzb-bc-decorations">\n                    <line class="vzb-bc-line-equal-xy vzb-invisible"></line>\n                    <g class="vzb-bc-x-axis-groups"></g>\n                </g>\n                <rect class="vzb-bc-eventarea"></rect>\n                <g class="vzb-bc-trails"></g>\n                <g class="vzb-bc-bubbles"></g>\n                <g class="vzb-bc-lines"></g>\n                <g class="vzb-bc-bubble-crown vzb-hidden">\n                    <circle class="vzb-crown-glow"></circle>\n                    <circle class="vzb-crown"></circle>\n                </g>\n            </svg>\n\n            <g class="vzb-bc-axis-y-subtitle"></g>\n            <g class="vzb-bc-axis-x-subtitle"></g>\n            <g class="vzb-bc-axis-y-title"></g>\n            <g class="vzb-bc-axis-x-title"></g>\n            <g class="vzb-bc-axis-s-title"></g>\n            <g class="vzb-bc-axis-c-title"></g>\n\n            <g class="vzb-bc-axis-y-info vzb-noexport"></g>\n            <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n\n            <svg class="vzb-bc-labels-crop">\n                <g class="vzb-bc-labels"></g>\n            </svg>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <rect class="vzb-bc-zoom-rect"></rect>\n        </g>\n    </svg>\n    <svg>\n        <defs>\n            <filter id="vzb-glow-filter" x="-50%" y="-50%" width="200%" height="200%">\n                <feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur>\n            </filter>\n        </defs>\n    </svg>\n    \x3c!-- This could possibly be another component --\x3e\n    <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div>\n</div>\n'},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){t.exports=i(0)}])},44:function(t,e){t.exports="./assets/js/toolconfigs/BubbleChart.js"},46:function(t,e){t.exports="./assets/vizabi.css"},47:function(t,e){var i=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=t,i.c=e,i.p="",i(0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=i(1);e.FrontendFileReader=r.FrontendFileReader;var o=i(3);e.DdfCsvError=o.DdfCsvError;var a=i(4);e.getDDFCsvReaderObject=a.prepareDDFCsvReaderObject(new n.FrontendFileReader)},function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0}),i(2);var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,[{key:"setRecordTransformer",value:function(t){this.recordTransformer=t}},{key:"readText",value:function(t,e){fetch(t).then(function(t){return t.text()}).then(function(t){e(null,t)}).catch(function(i){e(i||t+" read error")})}}]),t}();e.FrontendFileReader=r},function(t,e){"use strict";!function(){if(!self.fetch){o.prototype.append=function(t,e){t=n(t),e=r(e);var i=this.map[t];i||(i=[],this.map[t]=i),i.push(e)},o.prototype.delete=function(t){delete this.map[n(t)]},o.prototype.get=function(t){var e=this.map[n(t)];return e?e[0]:null},o.prototype.getAll=function(t){return this.map[n(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(n(t))},o.prototype.set=function(t,e){this.map[n(t)]=[r(e)]},o.prototype.forEach=function(t){var e=this;Object.getOwnPropertyNames(this.map).forEach(function(i){t(i,e.map[i])})};var t={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in self},e=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],i=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);u.call(c.prototype),u.call(d.prototype),self.Headers=o,self.Request=c,self.Response=d,self.fetch=function(e,n){var r;return r=c.prototype.isPrototypeOf(e)&&!n?e:new c(e,n),new fetch.Promise(function(e,n){var a=function(){return i&&!/^(get|post|head|put|delete|options)$/i.test(this.method)?(this.usingActiveXhr=!0,new ActiveXObject("Microsoft.XMLHTTP")):new XMLHttpRequest}();function s(){if(4===a.readyState){var t=1223===a.status?204:a.status;if(t<100||t>599)n(new TypeError("Network request failed"));else{var i={status:t,statusText:a.statusText,headers:function(t){var e=new o;return t.getAllResponseHeaders().trim().split("\n").forEach(function(t){var i=t.trim().split(":"),n=i.shift().trim(),r=i.join(":").trim();e.append(n,r)}),e}(a),url:"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0},r="response"in a?a.response:a.responseText;e(new d(r,i))}}}"cors"===r.credentials&&(a.withCredentials=!0),a.onreadystatechange=s,self.usingActiveXhr||(a.onload=s,a.onerror=function(){n(new TypeError("Network request failed"))}),a.open(r.method,r.url,!0),"responseType"in a&&t.blob&&(a.responseType="blob"),r.headers.forEach(function(t,e){e.forEach(function(e){a.setRequestHeader(t,e)})}),a.send(void 0===r._bodyInit?null:r._bodyInit)})},fetch.Promise=self.Promise,self.fetch.polyfill=!0}function n(t){if("string"!=typeof t&&(t=t.toString()),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function r(t){return"string"!=typeof t&&(t=t.toString()),t}function o(t){this.map={};var e=this;t instanceof o?t.forEach(function(t,i){i.forEach(function(i){e.append(t,i)})}):t&&Object.getOwnPropertyNames(t).forEach(function(i){e.append(i,t[i])})}function a(t){if(t.bodyUsed)return fetch.Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function s(t){return new fetch.Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function l(t){var e=new FileReader;return e.readAsArrayBuffer(t),s(e)}function u(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else{if(e)throw new Error("unsupported BodyInit type");this._bodyText=""}},t.blob?(this.blob=function(){var t=a(this);if(t)return t;if(this._bodyBlob)return fetch.Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return fetch.Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(l)},this.text=function(){var t,e,i=a(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,(e=new FileReader).readAsText(t),s(e);if(this._bodyFormData)throw new Error("could not read FormData body as text");return fetch.Promise.resolve(this._bodyText)}):this.text=function(){var t=a(this);return t||fetch.Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(function(t){return JSON.parse(t)})},this}function c(t,i){var n,r;if(i=i||{},this.url=t,this.credentials=i.credentials||"omit",this.headers=new o(i.headers),this.method=(n=i.method||"GET",r=n.toUpperCase(),e.indexOf(r)>-1?r:n),this.mode=i.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i.body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i.body)}function h(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function d(t,e){e||(e={}),this._initBody(t),this.type="default",this.url=null,this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof o?e.headers:new o(e.headers),this.url=e.url||""}}()},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FILE_READING_ERROR="File reading error",e.JSON_PARSING_ERROR="JSON parsing error",e.CSV_PARSING_ERROR="CSV parsing error",e.DDF_ERROR="DDF error";var i=function(t){function e(t,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.details=i,r.file=n,r.name="DdfCsvError",r.message=t,r.details=i,r.file=n,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,Error),e}();e.DdfCsvError=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),r=i(44);e.prepareDDFCsvReaderObject=function(t){return function(e,i){return{init:function(n){this._basepath=n.path,this._lastModified=n._lastModified,this.fileReader=e||t,this.logger=i,this.resultTransformer=n.resultTransformer,this.reader=r.ddfCsvReader(this._basepath+"/datapackage.json",this.fileReader,this.logger)},getAsset:function(t){var e=this,i=".json"===t.slice(-".json".length);return new n(function(n,r){e.fileReader.readText(e._basepath+"/"+t,function(t,e){if(t)r(t);else if(i)try{n(JSON.parse(e))}catch(e){r(t)}else n(e)})})},read:function(t,e){var r=this;return new n(function(n,o){r.reader.query(t).then(function(o){o=e?o.map(function(t){return Object.keys(t).forEach(function(i){e[i]&&(t[i]=e[i](t[i]))}),t}):o,r.resultTransformer&&(o=r.resultTransformer(o)),r.logger&&r.logger.log&&(i.log(JSON.stringify(t),o.length),i.log(o)),n(o)}).catch(function(t){o(t)})})}}}}},function(t,e,i){"use strict";var n;"undefined"!=typeof Promise&&(n=Promise);var r=i(6)();r.noConflict=function(){try{Promise===r&&(Promise=n)}catch(t){}return r},t.exports=r},function(t,e,i){(function(e){"use strict";t.exports=function(){var n=function(){return new p("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},r=function(){return new O.PromiseInspection(this._target())},o=function(t){return O.reject(new p(t))};function a(){}var s,l={},u=i(8);s=u.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},u.notEnumerableProp(O,"_getDomain",s);var c=i(9),h=i(10),d=new h;c.defineProperty(O,"_async",{value:d});var f=i(15),p=O.TypeError=f.TypeError;O.RangeError=f.RangeError;var m=O.CancellationError=f.CancellationError;O.TimeoutError=f.TimeoutError,O.OperationalError=f.OperationalError,O.RejectionError=f.OperationalError,O.AggregateError=f.AggregateError;var v=function(){},g={},y={},_=i(16)(O,v),b=i(17)(O,v,_,o,a),x=i(18)(O),w=x.create,S=i(19)(O,x),M=(S.CapturedTrace,i(20)(O,_,y)),E=i(21)(y),z=i(22),k=u.errorObj,T=u.tryCatch;function O(t){t!==v&&function(t,e){if(null==t||t.constructor!==O)throw new p("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new p("expecting a function but got "+u.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function C(t){this.promise._resolveCallback(t)}function P(t){this.promise._rejectCallback(t,!1)}function A(t){var e=new O(v);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return O.prototype.toString=function(){return"[object Promise]"},O.prototype.caught=O.prototype.catch=function(t){var e=arguments.length;if(e>1){var i,n=new Array(e-1),r=0;for(i=0;i<e-1;++i){var a=arguments[i];if(!u.isObject(a))return o("Catch statement predicate: expecting an object but got "+u.classString(a));n[r++]=a}return n.length=r,t=arguments[i],this.then(void 0,E(n,t,this))}return this.then(void 0,t)},O.prototype.reflect=function(){return this._then(r,r,void 0,this,void 0)},O.prototype.then=function(t,e){if(S.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var i=".then() only accepts functions but was passed: "+u.classString(t);arguments.length>1&&(i+=", "+u.classString(e)),this._warn(i)}return this._then(t,e,void 0,void 0,void 0)},O.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},O.prototype.spread=function(t){return"function"!=typeof t?o("expecting a function but got "+u.classString(t)):this.all()._then(t,void 0,void 0,g,void 0)},O.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},O.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new b(this).promise()},O.prototype.error=function(t){return this.caught(u.originatesFromRejection,t)},O.getNewLibraryCopy=t.exports,O.is=function(t){return t instanceof O},O.fromNode=O.fromCallback=function(t){var e=new O(v);e._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=T(t)(z(e,i));return n===k&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},O.all=function(t){return new b(t).promise()},O.cast=function(t){var e=_(t);return e instanceof O||((e=new O(v))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},O.resolve=O.fulfilled=O.cast,O.reject=O.rejected=function(t){var e=new O(v);return e._captureStackTrace(),e._rejectCallback(t,!0),e},O.setScheduler=function(t){if("function"!=typeof t)throw new p("expecting a function but got "+u.classString(t));return d.setScheduler(t)},O.prototype._then=function(t,e,i,n,r){var o=void 0!==r,a=o?r:new O(v),l=this._target(),c=l._bitField;o||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&c)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=s();if(0!=(50397184&c)){var f,p,g=l._settlePromiseCtx;0!=(33554432&c)?(p=l._rejectionHandler0,f=t):0!=(16777216&c)?(p=l._fulfillmentHandler0,f=e,l._unsetRejectionIsUnhandled()):(g=l._settlePromiseLateCancellationObserver,p=new m("late cancellation observer"),l._attachExtraTrace(p),f=e),d.invoke(g,l,{handler:null===h?f:"function"==typeof f&&u.domainBind(h,f),promise:a,receiver:n,value:p})}else l._addCallbacks(t,e,a,n,h);return a},O.prototype._length=function(){return 65535&this._bitField},O.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},O.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},O.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},O.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},O.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},O.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},O.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},O.prototype._isFinal=function(){return(4194304&this._bitField)>0},O.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},O.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},O.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},O.prototype._setAsyncGuaranteed=function(){d.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},O.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==l)return void 0===e&&this._isBound()?this._boundValue():e},O.prototype._promiseAt=function(t){return this[4*t-4+2]},O.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},O.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},O.prototype._boundValue=function(){},O.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,i=t._rejectionHandler0,n=t._promise0,r=t._receiverAt(0);void 0===r&&(r=l),this._addCallbacks(e,i,n,r,null)},O.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),r=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=l),this._addCallbacks(i,n,r,o,null)},O.prototype._addCallbacks=function(t,e,i,n,r){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===r?t:u.domainBind(r,t)),"function"==typeof e&&(this._rejectionHandler0=null===r?e:u.domainBind(r,e));else{var a=4*o-4;this[a+2]=i,this[a+3]=n,"function"==typeof t&&(this[a+0]=null===r?t:u.domainBind(r,t)),"function"==typeof e&&(this[a+1]=null===r?e:u.domainBind(r,e))}return this._setLength(o+1),o},O.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},O.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(n(),!1);var i=_(t,this);if(!(i instanceof O))return this._fulfill(t);e&&this._propagateFrom(i,2);var r=i._target();if(r!==this){var o=r._bitField;if(0==(50397184&o)){var a=this._length();a>0&&r._migrateCallback0(this);for(var s=1;s<a;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&o))this._fulfill(r._value());else if(0!=(16777216&o))this._reject(r._reason());else{var l=new m("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}else this._reject(n())}},O.prototype._rejectCallback=function(t,e,i){var n=u.ensureErrorObject(t),r=n===t;if(!r&&!i&&S.warnings()){var o="a promise was rejected with a non-error: "+u.classString(t);this._warn(o,!0)}this._attachExtraTrace(n,!!e&&r),this._reject(t)},O.prototype._resolveFromExecutor=function(t){if(t!==v){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,i)});i=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)}},O.prototype._settlePromiseFromHandler=function(t,e,i,n){var r=n._bitField;if(0==(65536&r)){var o;n._pushContext(),e===g?i&&"number"==typeof i.length?o=T(t).apply(this._boundValue(),i):(o=k).e=new p("cannot .spread() a non-array: "+u.classString(i)):o=T(t).call(e,i);var a=n._popContext();0==(65536&(r=n._bitField))&&(o===y?n._reject(i):o===k?n._rejectCallback(o.e,!1):(S.checkForgottenReturns(o,a,"",n,this),n._resolveCallback(o)))}},O.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},O.prototype._followee=function(){return this._rejectionHandler0},O.prototype._setFollowee=function(t){this._rejectionHandler0=t},O.prototype._settlePromise=function(t,e,i,n){var o=t instanceof O,s=this._bitField,l=0!=(134217728&s);0!=(65536&s)?(o&&t._invokeInternalOnCancel(),i instanceof M&&i.isFinallyHandler()?(i.cancelPromise=t,T(e).call(i,n)===k&&t._reject(k.e)):e===r?t._fulfill(r.call(i)):i instanceof a?i._promiseCancelled(t):o||t instanceof b?t._cancel():i.cancel()):"function"==typeof e?o?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,n,t)):e.call(i,n,t):i instanceof a?i._isResolved()||(0!=(33554432&s)?i._promiseFulfilled(n,t):i._promiseRejected(n,t)):o&&(l&&t._setAsyncGuaranteed(),0!=(33554432&s)?t._fulfill(n):t._reject(n))},O.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,r=t.value;"function"==typeof e?i instanceof O?this._settlePromiseFromHandler(e,n,r,i):e.call(n,r,i):i instanceof O&&i._reject(r)},O.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},O.prototype._settlePromise0=function(t,e,i){var n=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,r,e)},O.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},O.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=n();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():d.settlePromises(this))}},O.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return d.fatalError(t,u.isNode);(65535&e)>0?d.settlePromises(this):this._ensurePossibleRejectionHandled()}},O.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),r=this._promiseAt(i),o=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,o,e)}},O.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),r=this._promiseAt(i),o=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,o,e)}},O.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,t),this._rejectPromises(e,i)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},O.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},O.defer=O.pending=function(){return S.deprecated("Promise.defer","new Promise"),{promise:new O(v),resolve:C,reject:P}},u.notEnumerableProp(O,"_makeSelfResolutionError",n),i(23)(O,v,_,o,S),i(24)(O,v,_,S),i(25)(O,b,o,S),i(26)(O),i(27)(O),i(28)(O,b,_,v,d,s),O.Promise=O,O.version="3.5.0",i(29)(O,b,o,_,v,S),i(30)(O),i(31)(O,o,_,w,v,S),i(32)(O,v,S),i(33)(O,o,v,_,a,S),i(34)(O),i(35)(O,v),i(36)(O,b,_,o),i(37)(O,v,_,o),i(38)(O,b,o,_,v,S),i(39)(O,b,S),i(40)(O,b,o),i(41)(O,v),i(42)(O,v),i(43)(O),u.toFastProperties(O),u.toFastProperties(O.prototype),A({a:1}),A({b:2}),A({c:3}),A(1),A(function(){}),A(void 0),A(!1),A(new O(v)),S.setBounds(h.firstLineError,u.lastLineError),O}}).call(e,i(7))},function(t,e){"use strict";var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var l,u=[],c=!1,h=-1;function d(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!c){var t=s(d);c=!0;for(var e=u.length;e;){for(l=u,u=[];++h<e;)l&&l[h].run();h=-1,e=u.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new p(t,e)),1!==u.length||c||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){(function(e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=i(9),a="undefined"==typeof navigator,s={e:{}},l,u="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:null;function c(){try{var t=l;return l=null,t.apply(this,arguments)}catch(t){return s.e=t,s}}function h(t){return l=t,c}var d=function(t,e){var i={}.hasOwnProperty;function n(){for(var n in this.constructor=t,this.constructor$=e,e.prototype)i.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}return n.prototype=e.prototype,t.prototype=new n,t.prototype};function f(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function p(t){return"function"==typeof t||"object"===(void 0===t?"undefined":r(t))&&null!==t}function m(t){return f(t)?new Error(k(t)):t}function v(t,e){var i,n=t.length,r=new Array(n+1);for(i=0;i<n;++i)r[i]=t[i];return r[i]=e,r}function g(t,e,i){if(!o.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:i:void 0}function y(t,e,i){if(f(t))return t;var n={value:i,configurable:!0,enumerable:!1,writable:!0};return o.defineProperty(t,e,n),t}function _(t){throw t}var b=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(o.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var n=[],r=Object.create(null);null!=t&&!e(t);){var a;try{a=i(t)}catch(t){return n}for(var s=0;s<a.length;++s){var l=a[s];if(!r[l]){r[l]=!0;var u=Object.getOwnPropertyDescriptor(t,l);null!=u&&null==u.get&&null==u.set&&n.push(l)}}t=o.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(i){if(e(i))return[];var r=[];t:for(var o in i)if(n.call(i,o))r.push(o);else{for(var a=0;a<t.length;++a)if(n.call(t[a],o))continue t;r.push(o)}return r}}(),x=/this\s*\.\s*\S+\s*=/;function w(t){try{if("function"==typeof t){var e=o.names(t.prototype),i=o.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),r=x.test(t+"")&&o.names(t).length>0;if(i||n||r)return!0}return!1}catch(t){return!1}}function S(t){function e(){}e.prototype=t;for(var i=8;i--;)new e;return t}var M=/^[a-z$_][a-z$_0-9]*$/i;function E(t){return M.test(t)}function z(t,e,i){for(var n=new Array(t),r=0;r<t;++r)n[r]=e+r+i;return n}function k(t){try{return t+""}catch(t){return"[no string representation]"}}function T(t){return null!==t&&"object"===(void 0===t?"undefined":r(t))&&"string"==typeof t.message&&"string"==typeof t.name}function O(t){try{y(t,"isOperational",!0)}catch(t){}}function C(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function P(t){return T(t)&&o.propertyIsWritable(t,"stack")}var A="stack"in new Error?function(t){return P(t)?t:new Error(k(t))}:function(t){if(P(t))return t;try{throw new Error(k(t))}catch(t){return t}};function I(t){return{}.toString.call(t)}function L(t,e,i){for(var n=o.names(t),r=0;r<n.length;++r){var a=n[r];if(i(a))try{o.defineProperty(e,a,o.getDescriptor(t,a))}catch(t){}}}var D=function(t){return o.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var R="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i};D=function(t){return o.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?R(t):null}}var j=void 0!==n&&"[object process]"===I(n).toLowerCase(),F=void 0!==n&&void 0!==n.env;function B(t){return F?n.env[t]:void 0}function N(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function q(t,e){return t.bind(e)}var V={isClass:w,isIdentifier:E,inheritedDataKeys:b,getDataPropertyOrDefault:g,thrower:_,isArray:o.isArray,asArray:D,notEnumerableProp:y,isPrimitive:f,isObject:p,isError:T,canEvaluate:a,errorObj:s,tryCatch:h,inherits:d,withAppended:v,maybeWrapAsError:m,toFastProperties:S,filledRange:z,toString:k,canAttachTrace:P,ensureErrorObject:A,originatesFromRejection:C,markAsOriginatingFromRejection:O,classString:I,copyDescriptors:L,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:j,hasEnvVariables:F,env:B,global:u,getNativePromise:N,domainBind:q},H;V.isRecentNode=V.isNode&&(H=n.versions.node.split(".").map(Number),0===H[0]&&H[1]>10||H[0]>0),V.isNode&&V.toFastProperties(n);try{throw new Error}catch(t){V.lastLineError=t}t.exports=V}).call(e,function(){return this}(),i(7))},function(t,e){"use strict";var i=function(){return void 0===this}();if(i)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var n={}.hasOwnProperty,r={}.toString,o={}.constructor.prototype,a=function(t){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e};t.exports={isArray:function(t){try{return"[object Array]"===r.call(t)}catch(t){return!1}},keys:a,names:a,defineProperty:function(t,e,i){return t[e]=i.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return o}},isES5:i,propertyIsWritable:function(){return!0}}}},function(t,e,i){(function(e){"use strict";var n;try{throw new Error}catch(t){n=t}var r=i(11),o=i(14),a=i(8);function s(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new o(16),this._normalQueue=new o(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=r}function l(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function u(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function c(t){this._normalQueue._pushOne(t),this._queueTick()}s.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},s.prototype.hasCustomScheduler=function(){return this._customScheduler},s.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},s.prototype.disableTrampolineIfNecessary=function(){a.hasDevTools&&(this._trampolineEnabled=!1)},s.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},s.prototype.fatalError=function(t,i){i?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},s.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.hasDevTools?(s.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?l.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},s.prototype.invoke=function(t,e,i){this._trampolineEnabled?u.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},s.prototype.settlePromises=function(t){this._trampolineEnabled?c.call(this,t):this._schedule(function(){t._settlePromises()})}):(s.prototype.invokeLater=l,s.prototype.invoke=u,s.prototype.settlePromises=c),s.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var i=t.shift(),n=t.shift();e.call(i,n)}else e._settlePromises()}},s.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},s.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},s.prototype._reset=function(){this._isTickUsed=!1},t.exports=s,t.exports.firstLineError=n}).call(e,i(7))},function(t,e,i){(function(e,n,r){"use strict";var o,a=i(8),s=a.getNativePromise();if(a.isNode&&"undefined"==typeof MutationObserver){var l=e.setImmediate,u=n.nextTick;o=a.isRecentNode?function(t){l.call(e,t)}:function(t){u.call(n,t)}}else if("function"==typeof s&&"function"==typeof s.resolve){var c=s.resolve();o=function(t){c.then(t)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==r?function(t){r(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var t=document.createElement("div"),e={attributes:!0},i=!1,n=document.createElement("div");new MutationObserver(function(){t.classList.toggle("foo"),i=!1}).observe(n,e);return function(r){var o=new MutationObserver(function(){o.disconnect(),r()});o.observe(t,e),i||(i=!0,n.classList.toggle("foo"))}}();t.exports=o}).call(e,function(){return this}(),i(7),i(12).setImmediate)},function(t,e,i){"use strict";var n=Function.prototype.apply;function r(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new r(n.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new r(n.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(13),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e,i){(function(t,e){"use strict";!function(t,i){if(!t.setImmediate){var n,r,o,a,s,l=1,u={},c=!1,h=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick(function(){p(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){p(t.data)},n=function(t){o.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(r=h.documentElement,n=function(t){var e=h.createElement("script");e.onreadystatechange=function(){p(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):n=function(t){setTimeout(p,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&p(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),n=function(e){t.postMessage(a+e,"*")}),d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var r={callback:t,args:e};return u[l]=r,n(l),l++},d.clearImmediate=f}function f(t){delete u[t]}function p(t){if(c)setTimeout(p,0,t);else{var e=u[t];if(e){c=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{f(t),c=!1}}}}}("undefined"==typeof self?void 0===t?void 0:t:self)}).call(e,function(){return this}(),i(7))},function(t,e){"use strict";function i(t){this._capacity=t,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},i.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var r=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[r+0&o]=t,this[r+1&o]=e,this[r+2&o]=i,this._length=n},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,i,n,r){for(var o=0;o<r;++o)i[o+n]=t[o+e],t[o+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},t.exports=i},function(t,e,i){"use strict";var n,r,o=i(9),a=o.freeze,s=i(8),l=s.inherits,u=s.notEnumerableProp;function c(t,e){function i(n){if(!(this instanceof i))return new i(n);u(this,"message","string"==typeof n?n:e),u(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(i,Error),i}var h=c("Warning","warning"),d=c("CancellationError","cancellation error"),f=c("TimeoutError","timeout error"),p=c("AggregateError","aggregate error");try{n=TypeError,r=RangeError}catch(t){n=c("TypeError","type error"),r=c("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<m.length;++v)"function"==typeof Array.prototype[m[v]]&&(p.prototype[m[v]]=Array.prototype[m[v]]);o.defineProperty(p.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),p.prototype.isOperational=!0;var g=0;function y(t){if(!(this instanceof y))return new y(t);u(this,"name","OperationalError"),u(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(u(this,"message",t.message),u(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}p.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",r=n.split("\n"),o=0;o<r.length;++o)r[o]=t+r[o];e+=(n=r.join("\n"))+"\n"}return g--,e},l(y,Error);var _=Error.__BluebirdErrorTypes__;_||(_=a({CancellationError:d,TimeoutError:f,OperationalError:y,RejectionError:y,AggregateError:p}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:n,RangeError:r,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:h}},function(t,e,i){"use strict";t.exports=function(t,e){var n=i(8),r=n.errorObj,o=n.isObject;var a={}.hasOwnProperty;return function(i,s){if(o(i)){if(i instanceof t)return i;var l=function(t){try{return function(t){return t.then}(t)}catch(t){return r.e=t,r}}(i);if(l===r){s&&s._pushContext();var u=t.reject(l.e);return s&&s._popContext(),u}if("function"==typeof l)return function(t){try{return a.call(t,"_promise0")}catch(t){return!1}}(i)?(u=new t(e),i._then(u._fulfill,u._reject,void 0,u,null),u):function(i,o,a){var s=new t(e),l=s;a&&a._pushContext(),s._captureStackTrace(),a&&a._popContext();var u=!0,c=n.tryCatch(o).call(i,function(t){s&&(s._resolveCallback(t),s=null)},function(t){s&&(s._rejectCallback(t,u,!0),s=null)});return u=!1,s&&c===r&&(s._rejectCallback(c.e,!0,!0),s=null),l}(i,l,s)}return i}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,o){var a=i(8);a.isArray;function s(i){var n=this._promise=new t(e);i instanceof t&&n._propagateFrom(i,3),n._setOnCancel(this),this._values=i,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return a.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(i,o){var s=n(this._values,this._promise);if(s instanceof t){var l=(s=s._target())._bitField;if(this._values=s,0==(50397184&l))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,o);if(0==(33554432&l))return 0!=(16777216&l)?this._reject(s._reason()):this._cancel();s=s._value()}if(null!==(s=a.asArray(s)))0!==s.length?this._iterate(s):-5===o?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(o));else{var u=r("expecting an array or an iterable object but got "+a.classString(s)).reason();this._promise._rejectCallback(u,!1)}},s.prototype._iterate=function(e){var i=this.getActualLength(e.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var r=this._promise,o=!1,a=null,s=0;s<i;++s){var l=n(e[s],r);a=l instanceof t?(l=l._target())._bitField:null,o?null!==a&&l.suppressUnhandledRejections():null!==a?0==(50397184&a)?(l._proxy(this,s),this._values[s]=l):o=0!=(33554432&a)?this._promiseFulfilled(l._value(),s):0!=(16777216&a)?this._promiseRejected(l._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(l,s)}o||r._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},s.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var i=0;i<e.length;++i)e[i]instanceof t&&e[i].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},function(t,e){"use strict";t.exports=function(t){var e=!1,i=[];function n(){this._trace=new n.CapturedTrace(r())}function r(){var t=i.length-1;if(t>=0)return i[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},n.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},n.prototype._popContext=function(){if(void 0!==this._trace){var t=i.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},n.CapturedTrace=null,n.create=function(){if(e)return new n},n.deactivateLongStackTraces=function(){},n.activateLongStackTraces=function(){var i=t.prototype._pushContext,o=t.prototype._popContext,a=t._peekContext,s=t.prototype._peekContext,l=t.prototype._promiseCreated;n.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=o,t._peekContext=a,t.prototype._peekContext=s,t.prototype._promiseCreated=l,e=!1},e=!0,t.prototype._pushContext=n.prototype._pushContext,t.prototype._popContext=n.prototype._popContext,t._peekContext=t.prototype._peekContext=r,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},n}},function(t,e,i){(function(e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t,r){var o,a,s,l=t._getDomain,u=t._async,c=i(15).Warning,h=i(8),d=h.canAttachTrace,f=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,p=/\((?:timers\.js):\d+:\d+\)/,m=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,v=null,g=null,y=!1,_=!(0==h.env("BLUEBIRD_DEBUG")||!h.env("BLUEBIRD_DEBUG")&&"development"!==h.env("NODE_ENV")),b=!(0==h.env("BLUEBIRD_WARNINGS")||!_&&!h.env("BLUEBIRD_WARNINGS")),x=!(0==h.env("BLUEBIRD_LONG_STACK_TRACES")||!_&&!h.env("BLUEBIRD_LONG_STACK_TRACES")),w=0!=h.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(b||!!h.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),u.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){U("rejectionHandled",o,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),U("unhandledRejection",a,t,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(t,e,i){return N(t,e,i||this)},t.onPossiblyUnhandledRejection=function(t){var e=l();a="function"==typeof t?null===e?t:h.domainBind(e,t):void 0},t.onUnhandledRejectionHandled=function(t){var e=l();o="function"==typeof t?null===e?t:h.domainBind(e,t):void 0};var S=function(){};t.longStackTraces=function(){if(u.haveItemsQueued()&&!Q.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!Q.longStackTraces&&K()){var e=t.prototype._captureStackTrace,i=t.prototype._attachExtraTrace;Q.longStackTraces=!0,S=function(){if(u.haveItemsQueued()&&!Q.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=i,r.deactivateLongStackTraces(),u.enableTrampoline(),Q.longStackTraces=!1},t.prototype._captureStackTrace=F,t.prototype._attachExtraTrace=B,r.activateLongStackTraces(),u.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return Q.longStackTraces&&K()};var M=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return h.global.dispatchEvent(t),function(t,e){var i=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!h.global.dispatchEvent(i)}}if("function"==typeof Event){t=new Event("CustomEvent");return h.global.dispatchEvent(t),function(t,e){var i=new Event(t.toLowerCase(),{cancelable:!0});return i.detail=e,!h.global.dispatchEvent(i)}}return(t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),h.global.dispatchEvent(t),function(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t.toLowerCase(),!1,!0,e),!h.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),E=h.isNode?function(){return e.emit.apply(e,arguments)}:h.global?function(t){var e="on"+t.toLowerCase(),i=h.global[e];return!!i&&(i.apply(h.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function z(t,e){return{promise:e}}var k={promiseCreated:z,promiseFulfilled:z,promiseRejected:z,promiseResolved:z,promiseCancelled:z,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:z},T=function(t){var e=!1;try{e=E.apply(null,arguments)}catch(t){u.throwLater(t),e=!0}var i=!1;try{i=M(t,k[t].apply(null,arguments))}catch(t){u.throwLater(t),i=!0}return i||e};function O(){return!1}function C(t,e,i){var n=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+h.toString(t));n._attachCancellationCallback(t)})}catch(t){return t}}function P(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?h.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function A(){return this._onCancelField}function I(t){this._onCancelField=t}function L(){this._cancellationParent=void 0,this._onCancelField=void 0}function D(t,e){if(0!=(1&e)){this._cancellationParent=t;var i=t._branchesRemainingToCancel;void 0===i&&(i=0),t._branchesRemainingToCancel=i+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&S()),"warnings"in e){var i=e.warnings;Q.warnings=!!i,w=Q.warnings,h.isObject(i)&&"wForgottenReturn"in i&&(w=!!i.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!Q.cancellation){if(u.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=L,t.prototype._propagateFrom=D,t.prototype._onCancel=A,t.prototype._setOnCancel=I,t.prototype._attachCancellationCallback=P,t.prototype._execute=C,R=D,Q.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!Q.monitoring?(Q.monitoring=!0,t.prototype._fireEvent=T):!e.monitoring&&Q.monitoring&&(Q.monitoring=!1,t.prototype._fireEvent=O)),t},t.prototype._fireEvent=O,t.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(t){},t.prototype._attachCancellationCallback=function(t){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(t,e){};var R=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function j(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function F(){this._trace=new Z(this._peekContext())}function B(t,e){if(d(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=V(t);h.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),h.notEnumerableProp(t,"__stackCleaned__",!0)}}}function N(e,i,n){if(Q.warnings){var r,o=new c(e);if(i)n._attachExtraTrace(o);else if(Q.longStackTraces&&(r=t._peekContext()))r.attachExtraTrace(o);else{var a=V(o);o.stack=a.message+"\n"+a.stack.join("\n")}T("warning",o)||H(o,"",!0)}}function q(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r="    (No stack trace)"===n||v.test(n),o=r&&G(n);r&&!o&&(y&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function V(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||v.test(n))break}return i>0&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}(t):["    (No stack trace)"],{message:i,stack:"SyntaxError"==t.name?e:q(e)}}function H(t,e,i){if("undefined"!=typeof console){var r;if(h.isObject(t)){var o=t.stack;r=e+g(o,t)}else r=e+String(t);"function"==typeof s?s(r,i):"function"!=typeof console.log&&"object"!==n(console.log)||console.log(r)}}function U(t,e,i,n){var r=!1;try{"function"==typeof e&&(r=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){u.throwLater(t)}"unhandledRejection"===t?T(t,i,n)||r||H(i,"Unhandled rejection "):T(t,n)}function W(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():h.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){if(t.length<41)return t;return t.substr(0,38)+"..."}(e)+">, no stack trace)"}function K(){return"function"==typeof $}var G=function(){return!1},X=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function Y(t){var e=t.match(X);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function Z(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);$(this,Z),e>32&&this.uncycle()}h.inherits(Z,Error),r.CapturedTrace=Z,Z.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,r=this;void 0!==r;++n)e.push(r),r=r._parent;for(n=(t=this._length=n)-1;n>=0;--n){var o=e[n].stack;void 0===i[o]&&(i[o]=n)}for(n=0;n<t;++n){var a=i[e[n].stack];if(void 0!==a&&a!==n){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var s=n>0?e[n-1]:this;a<t-1?(s._parent=e[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var l=s._length+1,u=n-2;u>=0;--u)e[u]._length=l,l++;return}}}},Z.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=V(t),i=e.message,n=[e.stack],r=this;void 0!==r;)n.push(q(r.stack.split("\n"))),r=r._parent;!function(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],r=e.length-1,o=e[r],a=-1,s=n.length-1;s>=0;--s)if(n[s]===o){a=s;break}for(s=a;s>=0;--s){var l=n[s];if(e[r]!==l)break;e.pop(),r--}e=n}}(n),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(n),h.notEnumerableProp(t,"stack",function(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}(i,n)),h.notEnumerableProp(t,"__stackCleaned__",!0)}};var $=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():W(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,v=t,g=e;var i=Error.captureStackTrace;return G=function(t){return f.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var r,o=new Error;if("string"==typeof o.stack&&o.stack.split("\n")[0].indexOf("stackDetection@")>=0)return v=/@/,g=e,y=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return"stack"in o||!r||"number"!=typeof Error.stackTraceLimit?(g=function(t,e){return"string"==typeof t?t:"object"!==(void 0===e?"undefined":n(e))&&"function"!=typeof e||void 0===e.name||void 0===e.message?W(e):e.toString()},null):(v=t,g=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(s=function(t){console.warn(t)},h.isNode&&e.stderr.isTTY?s=function(t,e){var i=e?"[33m":"[31m";console.warn(i+t+"[0m\n")}:h.isNode||"string"!=typeof(new Error).stack||(s=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var Q={warnings:b,longStackTraces:!1,cancellation:!1,monitoring:!1};return x&&t.longStackTraces(),{longStackTraces:function(){return Q.longStackTraces},warnings:function(){return Q.warnings},cancellation:function(){return Q.cancellation},monitoring:function(){return Q.monitoring},propagateFromFunction:function(){return R},boundValueFunction:function(){return j},checkForgottenReturns:function(t,e,i,n,r){if(void 0===t&&null!==e&&w){if(void 0!==r&&r._returnedNonUndefined())return;if(0==(65535&n._bitField))return;i&&(i+=" ");var o="",a="";if(e._trace){for(var s=e._trace.stack.split("\n"),l=q(s),u=l.length-1;u>=0;--u){var c=l[u];if(!p.test(c)){var h=c.match(m);h&&(o="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(l.length>0){var d=l[0];for(u=0;u<s.length;++u)if(s[u]===d){u>0&&(a="\n"+s[u-1]);break}}}var f="a promise was created in a "+i+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;n._warn(f,!0,e)}},setBounds:function(t,e){if(K()){for(var i,n,r=t.stack.split("\n"),o=e.stack.split("\n"),a=-1,s=-1,l=0;l<r.length;++l)if(u=Y(r[l])){i=u.fileName,a=u.line;break}for(l=0;l<o.length;++l){var u;if(u=Y(o[l])){n=u.fileName,s=u.line;break}}a<0||s<0||!i||!n||i!==n||a>=s||(G=function(t){if(f.test(t))return!0;var e=Y(t);return!!(e&&e.fileName===i&&a<=e.line&&e.line<=s)})}},warn:N,deprecated:function(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),N(i)},CapturedTrace:Z,fireDomEvent:M,fireGlobalEvent:E}}}).call(e,i(7))},function(t,e,i){"use strict";t.exports=function(t,e,n){var r=i(8),o=t.CancellationError,a=r.errorObj,s=i(21)(n);function l(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function u(t){this.finallyHandler=t}function c(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function h(){return f.call(this,this.promise._target()._settledValue())}function d(t){if(!c(this,t))return a.e=t,a}function f(i){var r=this.promise,s=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?s.call(r._boundValue()):s.call(r._boundValue(),i);if(l===n)return l;if(void 0!==l){r._setReturnedNonUndefined();var f=e(l,r);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var p=new o("late cancellation observer");return r._attachExtraTrace(p),a.e=p,a}f.isPending()&&f._attachCancellationCallback(new u(this))}return f._then(h,d,void 0,this,void 0)}}}return r.isRejected()?(c(this),a.e=i,a):(c(this),i)}return l.prototype.isFinallyHandler=function(){return 0===this.type},u.prototype._resultCancelled=function(){c(this.finallyHandler)},t.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new l(this,e,t),void 0)},t.prototype.lastly=t.prototype.finally=function(t){return this._passThrough(t,0,f,f)},t.prototype.tap=function(t){return this._passThrough(t,1,f)},t.prototype.tapCatch=function(e){var i=arguments.length;if(1===i)return this._passThrough(e,1,void 0,f);var n,o=new Array(i-1),a=0;for(n=0;n<i-1;++n){var l=arguments[n];if(!r.isObject(l))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+r.classString(l)));o[a++]=l}o.length=a;var u=arguments[n];return this._passThrough(s(o,u,this),1,void 0,f)},l}},function(t,e,i){"use strict";t.exports=function(t){var e=i(8),n=i(9).keys,r=e.tryCatch,o=e.errorObj;return function(i,a,s){return function(l){var u=s._boundValue();t:for(var c=0;c<i.length;++c){var h=i[c];if(h===Error||null!=h&&h.prototype instanceof Error){if(l instanceof h)return r(a).call(u,l)}else if("function"==typeof h){var d=r(h).call(u,l);if(d===o)return d;if(d)return r(a).call(u,l)}else if(e.isObject(l)){for(var f=n(h),p=0;p<f.length;++p){var m=f[p];if(h[m]!=l[m])continue t}return r(a).call(u,l)}}return t}}}},function(t,e,i){"use strict";var n=i(8),r=n.maybeWrapAsError,o=i(15).OperationalError,a=i(9);var s=/^(?:name|message|stack|cause)$/;function l(t){var e;if(function(t){return t instanceof Error&&a.getPrototypeOf(t)===Error.prototype}(t)){(e=new o(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var i=a.keys(t),r=0;r<i.length;++r){var l=i[r];s.test(l)||(e[l]=t[l])}return e}return n.markAsOriginatingFromRejection(t),t}t.exports=function(t,e){return function(i,n){if(null!==t){if(i){var o=l(r(i));t._attachExtraTrace(o),t._reject(o)}else if(e){for(var a=arguments.length,s=new Array(Math.max(a-1,0)),u=1;u<a;++u)s[u-1]=arguments[u];t._fulfill(s)}else t._fulfill(n);t=null}}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,o){var a=i(8),s=a.tryCatch;t.method=function(i){if("function"!=typeof i)throw new t.TypeError("expecting a function but got "+a.classString(i));return function(){var n=new t(e);n._captureStackTrace(),n._pushContext();var r=s(i).apply(this,arguments),a=n._popContext();return o.checkForgottenReturns(r,a,"Promise.method",n),n._resolveFromSyncValue(r),n}},t.attempt=t.try=function(i){if("function"!=typeof i)return r("expecting a function but got "+a.classString(i));var n,l=new t(e);if(l._captureStackTrace(),l._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],c=arguments[2];n=a.isArray(u)?s(i).apply(c,u):s(i).call(c,u)}else n=s(i)();var h=l._popContext();return o.checkForgottenReturns(n,h,"Promise.try",l),l._resolveFromSyncValue(n),l},t.prototype._resolveFromSyncValue=function(t){t===a.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},function(t,e){"use strict";t.exports=function(t,e,i,n){var r=!1,o=function(t,e){this._reject(e)},a=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},s=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},l=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){r||(r=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var u=i(o),c=new t(e);c._propagateFrom(this,1);var h=this._target();if(c._setBoundTo(u),u instanceof t){var d={promiseRejectionQueued:!1,promise:c,target:h,bindingPromise:u};h._then(e,a,void 0,c,d),u._then(s,l,void 0,c,d),c._setOnCancel(u)}else c._resolveCallback(h);return c},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,i){return t.resolve(i).bind(e)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){var o=i(8),a=o.tryCatch,s=o.errorObj,l=t._async;t.prototype.break=t.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var i=0;i<t.length;++i)this._doInvokeOnCancel(t[i],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=a(t).call(this._boundValue());n===s&&(this._attachExtraTrace(n.e),l.throwLater(n.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},function(t,e){"use strict";t.exports=function(t){function e(){return this.value}function i(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(i){return i instanceof t&&i.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:i},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},t.prototype.catchReturn=function(i){if(arguments.length<=1)return i instanceof t&&i.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:i},void 0);var n=arguments[1];n instanceof t&&n.suppressUnhandledRejections();return this.caught(i,function(){return n})}}},function(t,e){"use strict";t.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return a.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return r.call(this._target())},t.prototype.isResolved=function(){return s.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,o,a){var s,l=i(8),u=l.canEvaluate,c=l.tryCatch,h=l.errorObj;if(u){for(var d=function(t){return new Function("value","holder","                             \n\t            'use strict';                                                    \n\t            holder.pIndex = value;                                           \n\t            holder.checkFulfillment(this);                                   \n\t            ".replace(/Index/g,t))},f=function(t){return new Function("promise","holder","                           \n\t            'use strict';                                                    \n\t            holder.pIndex = promise;                                         \n\t            ".replace(/Index/g,t))},p=function(e){for(var i=new Array(e),n=0;n<i.length;++n)i[n]="this.p"+(n+1);var r=i.join(" = ")+" = null;",a="var promise;\n"+i.map(function(t){return"                                                         \n\t                promise = "+t+";                                      \n\t                if (promise instanceof Promise) {                            \n\t                    promise.cancel();                                        \n\t                }                                                            \n\t            "}).join("\n"),s=i.join(", "),l="Holder$"+e,u="return function(tryCatch, errorObj, Promise, async) {    \n\t            'use strict';                                                    \n\t            function [TheName](fn) {                                         \n\t                [TheProperties]                                              \n\t                this.fn = fn;                                                \n\t                this.asyncNeeded = true;                                     \n\t                this.now = 0;                                                \n\t            }                                                                \n\t                                                                             \n\t            [TheName].prototype._callFunction = function(promise) {          \n\t                promise._pushContext();                                      \n\t                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n\t                promise._popContext();                                       \n\t                if (ret === errorObj) {                                      \n\t                    promise._rejectCallback(ret.e, false);                   \n\t                } else {                                                     \n\t                    promise._resolveCallback(ret);                           \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype.checkFulfillment = function(promise) {       \n\t                var now = ++this.now;                                        \n\t                if (now === [TheTotal]) {                                    \n\t                    if (this.asyncNeeded) {                                  \n\t                        async.invoke(this._callFunction, this, promise);     \n\t                    } else {                                                 \n\t                        this._callFunction(promise);                         \n\t                    }                                                        \n\t                                                                             \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype._resultCancelled = function() {              \n\t                [CancellationCode]                                           \n\t            };                                                               \n\t                                                                             \n\t            return [TheName];                                                \n\t        }(tryCatch, errorObj, Promise, async);                               \n\t        ";return u=u.replace(/\[TheName\]/g,l).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,r).replace(/\[CancellationCode\]/g,a),new Function("tryCatch","errorObj","Promise","async",u)(c,h,t,o)},m=[],v=[],g=[],y=0;y<8;++y)m.push(p(y+1)),v.push(d(y+1)),g.push(f(y+1));s=function(t){this._reject(t)}}t.join=function(){var i,o=arguments.length-1;if(o>0&&"function"==typeof arguments[o]&&(i=arguments[o],o<=8&&u)){(w=new t(r))._captureStackTrace();for(var c=new(0,m[o-1])(i),h=v,d=0;d<o;++d){var f=n(arguments[d],w);if(f instanceof t){var p=(f=f._target())._bitField;0==(50397184&p)?(f._then(h[d],s,void 0,w,c),g[d](f,c),c.asyncNeeded=!1):0!=(33554432&p)?h[d].call(w,f._value(),c):0!=(16777216&p)?w._reject(f._reason()):w._cancel()}else h[d].call(w,f,c)}if(!w._isFateSealed()){if(c.asyncNeeded){var y=a();null!==y&&(c.fn=l.domainBind(y,c.fn))}w._setAsyncGuaranteed(),w._setOnCancel(c)}return w}for(var _=arguments.length,b=new Array(_),x=0;x<_;++x)b[x]=arguments[x];i&&b.pop();var w=new e(b).promise();return void 0!==i?w.spread(i):w}}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t,e,r,o,a,s){var l=t._getDomain,u=i(8),c=u.tryCatch,h=u.errorObj,d=t._async;function f(t,e,i,n){this.constructor$(t),this._promise._captureStackTrace();var r=l();this._callback=null===r?e:u.domainBind(r,e),this._preservedValues=n===a?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=[],d.invoke(this._asyncInit,this,void 0)}function p(e,i,o,a){if("function"!=typeof i)return r("expecting a function but got "+u.classString(i));var s=0;if(void 0!==o){if("object"!==(void 0===o?"undefined":n(o))||null===o)return t.reject(new TypeError("options argument must be an object but it is "+u.classString(o)));if("number"!=typeof o.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(o.concurrency)));s=o.concurrency}return new f(e,i,s="number"==typeof s&&isFinite(s)&&s>=1?s:0,a).promise()}u.inherits(f,e),f.prototype._asyncInit=function(){this._init$(void 0,-2)},f.prototype._init=function(){},f.prototype._promiseFulfilled=function(e,i){var n=this._values,r=this.length(),a=this._preservedValues,l=this._limit;if(i<0){if(n[i=-1*i-1]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return n[i]=e,this._queue.push(i),!1;null!==a&&(a[i]=e);var u=this._promise,d=this._callback,f=u._boundValue();u._pushContext();var p=c(d).call(f,e,i,r),m=u._popContext();if(s.checkForgottenReturns(p,m,null!==a?"Promise.filter":"Promise.map",u),p===h)return this._reject(p.e),!0;var v=o(p,this._promise);if(v instanceof t){var g=(v=v._target())._bitField;if(0==(50397184&g))return l>=1&&this._inFlight++,n[i]=v,v._proxy(this,-1*(i+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(v._reason()),!0):(this._cancel(),!0);p=v._value()}n[i]=p}return++this._totalResolved>=r&&(null!==a?this._filter(n,a):this._resolve(n),!0)},f.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},f.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),r=0,o=0;o<i;++o)t[o]&&(n[r++]=e[o]);n.length=r,this._resolve(n)},f.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,e){return p(this,t,e,null)},t.map=function(t,e,i,n){return p(t,e,i,n)}}},function(t,e,i){"use strict";var n=Object.create;if(n){var r=n(null),o=n(null);r[" size"]=o[" size"]=0}t.exports=function(t){var e,n,a=i(8),s=a.canEvaluate,l=a.isIdentifier,u=function(t){return new Function("ensureMethod","                                    \n\t        return function(obj) {                                               \n\t            'use strict'                                                     \n\t            var len = this.length;                                           \n\t            ensureMethod(obj, 'methodName');                                 \n\t            switch(len) {                                                    \n\t                case 1: return obj.methodName(this[0]);                      \n\t                case 2: return obj.methodName(this[0], this[1]);             \n\t                case 3: return obj.methodName(this[0], this[1], this[2]);    \n\t                case 0: return obj.methodName();                             \n\t                default:                                                     \n\t                    return obj.methodName.apply(obj, this);                  \n\t            }                                                                \n\t        };                                                                   \n\t        ".replace(/methodName/g,t))(d)},c=function(t){return new Function("obj","                                             \n\t        'use strict';                                                        \n\t        return obj.propertyName;                                             \n\t        ".replace("propertyName",t))},h=function(t,e,i){var n=i[t];if("function"!=typeof n){if(!l(t))return null;if(n=e(t),i[t]=n,i[" size"]++,i[" size"]>512){for(var r=Object.keys(i),o=0;o<256;++o)delete i[r[o]];i[" size"]=r.length-256}}return n};function d(e,i){var n;if(null!=e&&(n=e[i]),"function"!=typeof n){var r="Object "+a.classString(e)+" has no method '"+a.toString(i)+"'";throw new t.TypeError(r)}return n}function f(t){return d(t,this.pop()).apply(t,this)}function p(t){return t[this]}function m(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}e=function(t){return h(t,u,r)},n=function(t){return h(t,c,o)},t.prototype.call=function(t){for(var i=arguments.length,n=new Array(Math.max(i-1,0)),r=1;r<i;++r)n[r-1]=arguments[r];if(s){var o=e(t);if(null!==o)return this._then(o,void 0,void 0,n,void 0)}return n.push(t),this._then(f,void 0,void 0,n,void 0)},t.prototype.get=function(t){var e;if("number"==typeof t)e=m;else if(s){var i=n(t);e=null!==i?i:p}else e=p;return this._then(e,void 0,void 0,t,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,o,a){var s=i(8),l=i(15).TypeError,u=i(8).inherits,c=s.errorObj,h=s.tryCatch,d={};function f(t){setTimeout(function(){throw t},0)}function p(e,i){var r=0,a=e.length,s=new t(o);return function o(){if(r>=a)return s._fulfill();var l=function(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(e[r++]);if(l instanceof t&&l._isDisposable()){try{l=n(l._getDisposer().tryDispose(i),e.promise)}catch(t){return f(t)}if(l instanceof t)return l._then(o,f,null,null,null)}o()}(),s}function m(t,e,i){this._data=t,this._promise=e,this._context=i}function v(t,e,i){this.constructor$(t,e,i)}function g(t){return m.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function y(t){this.length=t,this.promise=null,this[t-1]=null}m.prototype.data=function(){return this._data},m.prototype.promise=function(){return this._promise},m.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():d},m.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var n=e!==d?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,n},m.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},u(v,m),v.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},y.prototype._resultCancelled=function(){for(var e=this.length,i=0;i<e;++i){var n=this[i];n instanceof t&&n.cancel()}},t.using=function(){var i=arguments.length;if(i<2)return e("you must pass at least 2 arguments to Promise.using");var r,o=arguments[i-1];if("function"!=typeof o)return e("expecting a function but got "+s.classString(o));var l=!0;2===i&&Array.isArray(arguments[0])?(i=(r=arguments[0]).length,l=!1):(r=arguments,i--);for(var u=new y(i),d=0;d<i;++d){var f=r[d];if(m.isDisposer(f)){var v=f;(f=f.promise())._setDisposable(v)}else{var _=n(f);_ instanceof t&&(f=_._then(g,null,null,{resources:u,index:d},void 0))}u[d]=f}var b=new Array(u.length);for(d=0;d<b.length;++d)b[d]=t.resolve(u[d]).reflect();var x=t.all(b).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return c.e=i.error(),c;if(!i.isFulfilled())return void x.cancel();t[e]=i.value()}w._pushContext(),o=h(o);var n=l?o.apply(void 0,t):o(t),r=w._popContext();return a.checkForgottenReturns(n,r,"Promise.using",w),n}),w=x.lastly(function(){var e=new t.PromiseInspection(x);return p(u,e)});return u.promise=w,w._setOnCancel(u),w},t.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(t){if("function"==typeof t)return new v(t,this,r());throw new l}}},function(t,e,i){"use strict";t.exports=function(t,e,n){var r=i(8),o=t.TimeoutError;function a(t){this.handle=t}a.prototype._resultCancelled=function(){clearTimeout(this.handle)};var s=function(t){return l(+this).thenReturn(t)},l=t.delay=function(i,r){var o,l;return void 0!==r?(o=t.resolve(r)._then(s,null,null,i,void 0),n.cancellation()&&r instanceof t&&o._setOnCancel(r)):(o=new t(e),l=setTimeout(function(){o._fulfill()},+i),n.cancellation()&&o._setOnCancel(new a(l)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};t.prototype.delay=function(t){return l(t,this)};function u(t){return clearTimeout(this.handle),t}function c(t){throw clearTimeout(this.handle),t}t.prototype.timeout=function(t,e){var i,s;t=+t;var l=new a(setTimeout(function(){i.isPending()&&function(t,e,i){var n;n="string"!=typeof e?e instanceof Error?e:new o("operation timed out"):new o(e),r.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=i&&i.cancel()}(i,e,s)},t));return n.cancellation()?(s=this.then(),(i=s._then(u,c,void 0,l,void 0))._setOnCancel(l)):i=this._then(u,c,void 0,l,void 0),i}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,o,a){var s=i(15).TypeError,l=i(8),u=l.errorObj,c=l.tryCatch,h=[];function d(e,i,r,o){if(a.cancellation()){var s=new t(n),l=this._finallyPromise=new t(n);this._promise=s.lastly(function(){return l}),s._captureStackTrace(),s._setOnCancel(this)}else{(this._promise=new t(n))._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}l.inherits(d,o),d.prototype._isResolved=function(){return null===this._promise},d.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},d.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=c(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var i=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=i,this._promise._attachExtraTrace(i),this._promise._pushContext(),e=c(this._generator.throw).call(this._generator,i),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},d.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=c(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=c(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},d.prototype.promise=function(){return this._promise},d.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},d.prototype._continue=function(e){var i=this._promise;if(e===u)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var o=r(n,this._promise);if(o instanceof t||null!==(o=function(e,i,n){for(var o=0;o<i.length;++o){n._pushContext();var a=c(i[o])(e);if(n._popContext(),a===u){n._pushContext();var s=t.reject(u.e);return n._popContext(),s}var l=r(a,n);if(l instanceof t)return l}return null}(o,this._yieldHandlers,this._promise))){var a=(o=o._target())._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new s("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(t,e){if("function"!=typeof t)throw new s("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,n=d,r=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new n(void 0,void 0,i,r),a=o.promise();return o._generator=e,o._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new s("expecting a function but got "+l.classString(t));h.push(t)},t.spawn=function(i){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof i)return e("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new d(i,this),r=n.promise();return n._run(t.spawn),r}}},function(t,e,i){"use strict";t.exports=function(t){var e=i(8),n=t._async,r=e.tryCatch,o=e.errorObj;function a(t,i){if(!e.isArray(t))return s.call(this,t,i);var a=r(i).apply(this._boundValue(),[null].concat(t));a===o&&n.throwLater(a.e)}function s(t,e){var i=this._boundValue(),a=void 0===t?r(e).call(i,null):r(e).call(i,null,t);a===o&&n.throwLater(a.e)}function l(t,e){if(!t){var i=new Error(t+"");i.cause=t,t=i}var a=r(e).call(this._boundValue(),t);a===o&&n.throwLater(a.e)}t.prototype.asCallback=t.prototype.nodeify=function(t,e){if("function"==typeof t){var i=s;void 0!==e&&Object(e).spread&&(i=a),this._then(i,l,void 0,this,t)}return this}}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t,e){var r={},o=i(8),a=i(22),s=o.withAppended,l=o.maybeWrapAsError,u=o.canEvaluate,c=i(15).TypeError,h={__isPromisified__:!0},d=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),f=function(t){return o.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function p(t){return!d.test(t)}function m(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function v(t,e,i){var n=o.getDataPropertyOrDefault(t,e+i,h);return!!n&&m(n)}function g(t,e,i,n){for(var r=o.inheritedDataKeys(t),a=[],s=0;s<r.length;++s){var l=r[s],u=t[l],h=n===f||f(l,u,t);"function"!=typeof u||m(u)||v(t,l,e)||!n(l,u,t,h)||a.push(l,u)}return function(t,e,i){for(var n=0;n<t.length;n+=2){var r=t[n];if(i.test(r))for(var o=r.replace(i,""),a=0;a<t.length;a+=2)if(t[a]===o)throw new c("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(a,e,i),a}var y=function(t){return t.replace(/([$])/,"\\$")},_=function(t){return o.filledRange(t,"_arg","")};var b=u?function(i,n,u,c,h,d){var f=Math.max(0,function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0}(c)-1),p=function(t){for(var e=[t],i=Math.max(0,t-1-3),n=t-1;n>=i;--n)e.push(n);for(n=t+1;n<=3;++n)e.push(n);return e}(f),m="string"==typeof i||n===r;var v="string"==typeof i?"this != null ? this['"+i+"'] : fn":"fn",g="'use strict';                                                \n\t        var ret = function (Parameters) {                                    \n\t            'use strict';                                                    \n\t            var len = arguments.length;                                      \n\t            var promise = new Promise(INTERNAL);                             \n\t            promise._captureStackTrace();                                    \n\t            var nodeback = nodebackForPromise(promise, "+d+");   \n\t            var ret;                                                         \n\t            var callback = tryCatch([GetFunctionCode]);                      \n\t            switch(len) {                                                    \n\t                [CodeForSwitchCase]                                          \n\t            }                                                                \n\t            if (ret === errorObj) {                                          \n\t                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n\t            }                                                                \n\t            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n\t            return promise;                                                  \n\t        };                                                                   \n\t        notEnumerableProp(ret, '__isPromisified__', true);                   \n\t        return ret;                                                          \n\t    ".replace("[CodeForSwitchCase]",function(){for(var t,e,i,r="",o=0;o<p.length;++o)r+="case "+p[o]+":"+(t=p[o],e=_(t).join(", "),i=t>0?", ":"",(m?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===n?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n").replace("{{args}}",e).replace(", ",i));return r+="                                                             \n\t        default:                                                             \n\t            var args = new Array(len + 1);                                   \n\t            var i = 0;                                                       \n\t            for (var i = 0; i < len; ++i) {                                  \n\t               args[i] = arguments[i];                                       \n\t            }                                                                \n\t            args[i] = nodeback;                                              \n\t            [CodeForCall]                                                    \n\t            break;                                                           \n\t        ".replace("[CodeForCall]",m?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",v);return g=g.replace("Parameters",function(t){return o.filledRange(Math.max(t,3),"_arg","")}(f)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",g)(t,c,n,s,l,a,o.tryCatch,o.errorObj,o.notEnumerableProp,e)}:function(i,n,u,c,h,d){var f=function(){return this}(),p=i;function m(){var o=n;n===r&&(o=this);var u=new t(e);u._captureStackTrace();var c="string"==typeof p&&this!==f?this[p]:i,h=a(u,d);try{c.apply(o,s(arguments,h))}catch(t){u._rejectCallback(l(t),!0,!0)}return u._isFateSealed()||u._setAsyncGuaranteed(),u}return"string"==typeof p&&(i=c),o.notEnumerableProp(m,"__isPromisified__",!0),m};function x(t,e,i,n,a){for(var s=new RegExp(y(e)+"$"),l=g(t,e,s,i),u=0,c=l.length;u<c;u+=2){var h=l[u],d=l[u+1],f=h+e;if(n===b)t[f]=b(h,r,h,d,e,a);else{var p=n(d,function(){return b(h,r,h,d,e,a)});o.notEnumerableProp(p,"__isPromisified__",!0),t[f]=p}}return o.toFastProperties(t),t}t.promisify=function(t,e){if("function"!=typeof t)throw new c("expecting a function but got "+o.classString(t));if(m(t))return t;var i=function(t,e,i){return b(t,e,void 0,t,null,i)}(t,void 0===(e=Object(e)).context?r:e.context,!!e.multiArgs);return o.copyDescriptors(t,i,p),i},t.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!==(void 0===t?"undefined":n(t)))throw new c("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var i=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var a=e.filter;"function"!=typeof a&&(a=f);var s=e.promisifier;if("function"!=typeof s&&(s=b),!o.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var l=o.inheritedDataKeys(t),u=0;u<l.length;++u){var h=t[l[u]];"constructor"!==l[u]&&o.isClass(h)&&(x(h.prototype,r,a,s,i),x(h,r,a,s,i))}return x(t,r,a,s,i)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){var o,a=i(8),s=a.isObject,l=i(9);"function"==typeof Map&&(o=Map);var u=function(){var t=0,e=0;function i(i,n){this[t]=i,this[t+e]=n,t++}return function(n){e=n.size,t=0;var r=new Array(2*n.size);return n.forEach(i,r),r}}();function c(t){var e,i=!1;if(void 0!==o&&t instanceof o)e=u(t),i=!0;else{var n=l.keys(t),r=n.length;e=new Array(2*r);for(var a=0;a<r;++a){var s=n[a];e[a]=t[s],e[a+r]=s}}this.constructor$(e),this._isMap=i,this._init$(void 0,i?-6:-3)}function h(e){var i,o=n(e);return s(o)?(i=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new c(o).promise(),o instanceof t&&i._propagateFrom(o,2),i):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}a.inherits(c,e),c.prototype._init=function(){},c.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var i;if(this._isMap)i=function(t){for(var e=new o,i=t.length/2|0,n=0;n<i;++n){var r=t[i+n],a=t[n];e.set(r,a)}return e}(this._values);else{i={};for(var n=this.length(),r=0,a=this.length();r<a;++r)i[this._values[r+n]]=this._values[r]}return this._resolve(i),!0}return!1},c.prototype.shouldCopyValues=function(){return!1},c.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return h(this)},t.props=function(t){return h(t)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){var o=i(8),a=function(t){return t.then(function(e){return s(e,t)})};function s(i,s){var l=n(i);if(l instanceof t)return a(l);if(null===(i=o.asArray(i)))return r("expecting an array or an iterable object but got "+o.classString(i));var u=new t(e);void 0!==s&&u._propagateFrom(s,3);for(var c=u._fulfill,h=u._reject,d=0,f=i.length;d<f;++d){var p=i[d];(void 0!==p||d in i)&&t.cast(p)._then(c,h,void 0,u,null)}return u}t.race=function(t){return s(t,void 0)},t.prototype.race=function(){return s(this,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,o,a){var s=t._getDomain,l=i(8),u=l.tryCatch;function c(e,i,n,r){this.constructor$(e);var a=s();this._fn=null===a?i:l.domainBind(a,i),void 0!==n&&(n=t.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===o?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function h(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function d(t,e,i,r){return"function"!=typeof e?n("expecting a function but got "+l.classString(e)):new c(t,e,i,r).promise()}function f(e){this.accum=e,this.array._gotAccum(e);var i=r(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(p,void 0,void 0,this,void 0)):p.call(this,i)}function p(e){var i,n=this.array,r=n._promise,o=u(n._fn);r._pushContext(),(i=void 0!==n._eachValues?o.call(r._boundValue(),e,this.index,this.length):o.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=i);var s=r._popContext();return a.checkForgottenReturns(i,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),i}l.inherits(c,e),c.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==o&&this._eachValues.push(t)},c.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},c.prototype.shouldCopyValues=function(){return!1},c.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},c.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},c.prototype._iterate=function(e){var i,n;this._values=e;var r=e.length;if(void 0!==this._initialValue?(i=this._initialValue,n=0):(i=t.resolve(e[0]),n=1),this._currentCancellable=i,!i.isRejected())for(;n<r;++n){var o={accum:null,value:e[n],index:n,length:r,array:this};i=i._then(f,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(h,h,void 0,i,this)},t.prototype.reduce=function(t,e){return d(this,t,e,null)},t.reduce=function(t,e,i,n){return d(t,e,i,n)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){var r=t.PromiseInspection;function o(t){this.constructor$(t)}i(8).inherits(o,e),o.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(t,e){var i=new r;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},o.prototype._promiseRejected=function(t,e){var i=new r;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},t.settle=function(t){return n.deprecated(".settle()",".reflect()"),new o(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){var r=i(8),o=i(15).RangeError,a=i(15).AggregateError,s=r.isArray,l={};function u(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function c(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new u(t),r=i.promise();return i.setHowMany(e),i.init(),r}r.inherits(u,e),u.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=s(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},u.prototype.init=function(){this._initialized=!0,this._init()},u.prototype.setUnwrap=function(){this._unwrap=!0},u.prototype.howMany=function(){return this._howMany},u.prototype.setHowMany=function(t){this._howMany=t},u.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},u.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},u.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new a,e=this.length();e<this._values.length;++e)this._values[e]!==l&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},u.prototype._fulfilled=function(){return this._totalResolved},u.prototype._rejected=function(){return this._values.length-this.length()},u.prototype._addRejected=function(t){this._values.push(t)},u.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},u.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new o(e)},u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return c(t,e)},t.prototype.some=function(t){return c(this,t)},t._SomePromiseArray=u}},function(t,e){"use strict";t.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,n){return i(this,t,n,e)},t.filter=function(t,n,r){return i(t,n,r,e)}}},function(t,e){"use strict";t.exports=function(t,e){var i=t.reduce,n=t.all;function r(){return n(this)}t.prototype.each=function(t){return i(this,t,e,0)._then(r,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,n){return i(t,n,e,0)._then(r,void 0,void 0,t,void 0)},t.mapSeries=function(t,n){return i(t,n,e,e)}}},function(t,e){"use strict";t.exports=function(t){var e=t._SomePromiseArray;function i(t){var i=new e(t),n=i.promise();return i.setHowMany(1),i.setUnwrap(),i.init(),n}t.any=function(t){return i(t)},t.prototype.any=function(){return i(this)}}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),l=i(5),u=i(45),c=function(t){return!("number"!=typeof t&&!t)};e.ddfCsvReader=function(t,e,i){var h,d,f=[{concept:"concept",concept_type:"string",domain:null},{concept:"concept_type",concept_type:"string",domain:null}],p=new Map([["$and",function(t,e){return e.every(function(e){return T(t,e)})}],["$or",function(t,e){return e.some(function(e){return T(t,e)})}],["$not",function(t,e){return!T(t,e)}],["$nor",function(t,e){return!e.some(function(e){return T(t,e)})}],["$eq",function(t,e){return t==e}],["$ne",function(t,e){return t!=e}],["$gt",function(t,e){return c(t)&&t>e}],["$gte",function(t,e){return c(t)&&t>=e}],["$lt",function(t,e){return c(t)&&t<e}],["$lte",function(t,e){return c(t)&&t<=e}],["$in",function(t,e){return e.has(t)}],["$nin",function(t,e){return!e.has(t)}]]),m=function(t){return t.endsWith("datapackage.json")||(t.endsWith("/")||(t+="/"),t+="datapackage.json"),t}(t),v=((h=m.split("/")).pop(),h.join("/")+"/"),g=(d=m,new l(function(t,i){e.readText(d,function(e,n){if(e)return i(new s.DdfCsvError(s.FILE_READING_ERROR,e,d));try{w=JSON.parse(n)}catch(t){return i(new s.DdfCsvError(s.JSON_PARSING_ERROR,t,d))}!function(t){if(b.size>0)return b;t.resources.forEach(function(t){Array.isArray(t.schema.primaryKey)||(t.schema.primaryKey=[t.schema.primaryKey]),t.translations={},b.set(t.name,t)})}(w),function(t){if(_.size>0)return _;for(var e in t.ddfSchema)t.ddfSchema[e].map(function(t){var e=R(t.primaryKey),i=t.resources.map(function(t){return b.get(t)});_.has(e)?_.get(e).set(t.value,i):_.set(e,new Map([[t.value,i]]))})}(w),t(w)})})),y=g.then(function(){return E(f),k({select:{key:["concept"],value:["concept_type","domain"]},from:"concepts"}).then(S).then(M)}),_=new Map,b=new Map,x=new Map,w=void 0;function S(t){var e=t.filter(function(t){return"entity_set"===t.concept_type}).map(function(t){return{concept:"is--"+t.concept,concept_type:"boolean",domain:null}});return E(t=t.concat(e).concat(f)),x}function M(){var t=new Map([["boolean",function(t){return"true"===t||"TRUE"===t}],["measure",function(t){return parseFloat(t)}]]),e=A(["concept"]),i=[].concat(a(e)).map(function(e){return e.data.then(function(e){var i=Object.keys(e.data[0]),n=new Map;return i.forEach(function(e){var i=x.get(e).concept_type,r=t.get(i);r&&n.set(e,r)}),e.data.forEach(function(t){var e=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var l=r(a.value,2),u=l[0],c=l[1];t[u]=c(t[u])}}catch(t){i=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw o}}})})});return l.all(i)}function E(t){x.clear(),t.forEach(function(t){return x.set(t.concept,t)})}function z(t){return function(t){return"schema"===(t.from||"").split(".")[1]}(t)?g.then(function(){return e=function(t){return w.ddfSchema[t].map(function(t){var e=t.primaryKey,i=t.value;return{key:e,value:i}})},i=t.from.split(".")[0],w.ddfSchema[i]?e(i):"*"===i?Object.keys(w.ddfSchema).map(e).reduce(function(t,e){return t.concat(e)}):void D(new s.DdfCsvError(s.DDF_ERROR,"No valid collection ("+i+") for schema query"));var e,i}):y.then(function(){return k(t)})}function k(t){var e,i,s=t.select,u=s.key,c=void 0===u?[]:u,h=s.value,d=void 0===h?[]:h,f=(t.from,t.where),p=void 0===f?{}:f,m=t.join,g=void 0===m?{}:m,y=t.order_by,_=void 0===y?[]:y,b=t.language,S={key:c,value:d},M=new Set(S.key.concat(S.value)),E=C(p).filter(function(t){return!M.has(t)}),k=function(t,e,i){var n=A(t,e);return l.all([].concat(a(n)).map(function(t){return function(t,e){var i=[];void 0===t.data&&(t.data=j(v+t.path)),i.push(t.data);var n=void 0!==e&&(w.translations?w.translations.map(function(t){return t.id}):[]).includes(e),r=void 0!==t.translations[e];if(n){if(!r){var o=v+"lang/"+e+"/"+t.path;t.translations[e]=j(o)}i.push(t.translations[e])}return l.all(i).then(function(e){var i=e.map(function(t){return t.data}),n=t.schema.primaryKey,r=L.apply(void 0,[n,"translation"].concat(a(i)));return{data:r,resource:t}})}(t,i)}))}(S.key,[].concat(a(S.value),a(E)),b),D=function(t){return l.all(Object.keys(t).map(function(e){return function(t,e){return"time"===x.get(e.key).concept_type?l.resolve(o({},t,e.where)):z({select:{key:[e.key]},where:e.where}).then(function(i){return o({},t,o({},e.key,{$in:new Set(i.map(function(t){return t[e.key]}))}))})}(e,t[e])})).then(function(t){return t.reduce(O,{})})}(g),R=(e=S.key,i=P(["entity_set"],e).map(function(t){return z({select:{key:[t.domain],value:["is--"+t.concept]}}).then(function(e){return o({},t.concept,{$in:new Set(e.filter(function(e){return e["is--"+t.concept]}).map(function(e){return e[t.domain]}))})})}),l.all(i).then(function(t){return t.reduce(function(t,e){return Object.assign(t,e)},{})}));return l.all([k,R,D]).then(function(t){var e=r(t,3),i=e[0],o=e[1],s=e[2],l=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(function(t,e){return t.$and.push(e),t},{$and:[]})}(o,function t(e,i){var r={};for(var o in e){var a=e[o];["$and","$or","$nor"].includes(o)?r[o]=a.map(function(e){return t(e,i)}):"$in"===o||"$nin"===o?r[o]=new Set(a):void 0!==i[a]?Object.assign(r,i[a]):"object"===(void 0===a?"undefined":n(a))?r[o]=t(a,i):r[o]=a}return r}(p,s)),u=i.map(function(t){return function(t,e,i){var n=t.resource.schema.primaryKey,r=new Set([].concat(a(n),a(e.value),a(i))),o=function(t,e){var i=new Set(e),n=["entity_set","entity_domain"],r=P(n,t);if(0===r.length)return new Map;var o=P(n);return r.map(function(t){return o.filter(function(e){return"entity_set"===t.concept_type?i.has(e.concept)&&e.concept!==t.concept&&(e.domain===t.domain||e.concept===t.domain):i.has(e.concept)&&e.concept!==t.concept&&e.domain===t.concept}).reduce(function(e,i){return e.set(i.concept,t.concept)},new Map)}).reduce(function(t,e){return new Map([].concat(a(t),a(e)))},new Map)}(e.key,n);return t.data.map(function(t){return I(t,r)}).map(function(t){return function(t,e){var i={};for(var n in t)i[e.get(n)||n]=t[n];return i}(t,o)})}(t,S,E)}),c=L.apply(void 0,[S.key,"overwrite"].concat(a(u))).filter(function(t){return T(t,l)}).map(function(t){return function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;void 0===t[s]&&(t[s]=null)}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return t}(t,M)}).map(function(t){return I(t,M)});return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0!==e.length){var i=e.map(function(t){if("string"==typeof t)return{concept:t,direction:1};var e=Object.keys(t)[0],i="asc"===t[e]?1:-1;return{concept:e,direction:i}}),n=i.length;t.sort(function(t,e){for(var r=0;r<n;r++){var o=i[r];if(t[o.concept]<e[o.concept])return-1*o.direction;if(t[o.concept]>e[o.concept])return 1*o.direction}return 0})}}(c,_),c})}function T(t,e){return Object.keys(e).every(function(i){var r=p.get(i);return r?r(t,e[i]):"object"!==n(e[i])?p.get("$eq")(t[i],e[i]):T(t[i],e[i])})}function O(t,e){return Object.assign(t,e)}function C(t){var e=[];for(var i in t)["$and","$or","$not","$nor"].includes(i)?t[i].map(C).forEach(function(t){return e.push.apply(e,a(t))}):e.push(i);return e}function P(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Array.from(x.keys()),i=[],n=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,u=x.get(l);t.includes(u.concept_type)&&i.push(u)}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}function A(t,e){return e&&0!==e.length?Array.isArray(e)?e.map(function(e){return A(t,e)}).reduce(function(t,e){return new Set([].concat(a(t),a(e)))},new Set):new Set(_.get(R(t)).get(e)):new Set([].concat(a(_.get(R(t)).values())).reduce(function(t,e){return t.concat(e)}))}function I(t,e){var i={};for(var n in t)e.has(n)&&(i[n]=t[n]);return i}function L(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];if(1===n.length)return n[0];var o=t.slice(0).sort(),l=n.reduce(function(t,i){return i.forEach(function(i){var n=o.map(function(t){return i[t]}).join(",");t.has(n)?function(t,e,i){switch(i){case"overwrite":Object.assign(t,e);break;case"translation":for(var n in e)""!==e[n]&&(t[n]=e[n]);break;case"overwriteWithError":for(var r in e)if(void 0!==t[r]&&t[r]!==e[r]){var o=JSON.stringify(e),a=JSON.stringify(t),l='JOIN Error: two resources have different data for "'+r+'": '+o+","+a;D(new s.DdfCsvError(s.DDF_ERROR,l))}else t[r]=e[r]}}(t.get(n),i,e):t.set(n,i)}),t},new Map);return[].concat(a(l.values()))}function D(t){throw(i||console).error(t.message),t}function R(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.slice(0).sort();return e?i.map(function(t){return e[t]}).join(","):i.join(",")}function j(t){return new l(function(i,n){e.readText(t,function(e,r){if(e)return n(new s.DdfCsvError(s.FILE_READING_ERROR,e,t));u.parse(r,{header:!0,skipEmptyLines:!0,dynamicTyping:function(t){if(!x)return!0;var e=x.get(t)||{};return["boolean","measure"].includes(e.concept_type)},complete:function(t){return i(t)},error:function(e){return n(new s.DdfCsvError(s.CSV_PARSING_ERROR,e,t))}})})})}return{query:z}}},function(t,e,i){var n,r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r=[],void 0===(o="function"==typeof(n=function(){"use strict";var t,e,i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{},n=!i.document&&!!i.postMessage,r=n&&/(\?|&)papaworker(=|&|$)/.test(i.location.search),o=!1,s={},l=0,u={parse:function(e,n){var r=(n=n||{}).dynamicTyping||!1;S(r)&&(n.dynamicTypingFunction=r,r={});if(n.dynamicTyping=r,n.worker&&u.WORKERS_SUPPORTED){var a=function(){if(!u.WORKERS_SUPPORTED)return!1;if(!o&&null===u.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var e=u.SCRIPT_PATH||t;e+=(-1!==e.indexOf("?")?"&":"?")+"papaworker";var n=new i.Worker(e);return n.onmessage=y,n.id=l++,s[n.id]=n,n}();return a.userStep=n.step,a.userChunk=n.chunk,a.userComplete=n.complete,a.userError=n.error,n.step=S(n.step),n.chunk=S(n.chunk),n.complete=S(n.complete),n.error=S(n.error),delete n.worker,void a.postMessage({input:e,config:n,workerId:a.id})}var c=null;"string"==typeof e?c=n.download?new d(n):new p(n):!0===e.readable&&S(e.read)&&S(e.on)?c=new m(n):(i.File&&e instanceof File||e instanceof Object)&&(c=new f(n));return c.stream(e)},unparse:function(t,e){var i=!1,n=!0,r=",",o="\r\n",s='"';!function(){if("object"!==(void 0===e?"undefined":a(e)))return;"string"==typeof e.delimiter&&1===e.delimiter.length&&-1===u.BAD_DELIMITERS.indexOf(e.delimiter)&&(r=e.delimiter);("boolean"==typeof e.quotes||e.quotes instanceof Array)&&(i=e.quotes);"string"==typeof e.newline&&(o=e.newline);"string"==typeof e.quoteChar&&(s=e.quoteChar);"boolean"==typeof e.header&&(n=e.header)}();var l=new RegExp(s,"g");"string"==typeof t&&(t=JSON.parse(t));if(t instanceof Array){if(!t.length||t[0]instanceof Array)return h(null,t);if("object"===a(t[0]))return h(c(t[0]),t)}else if("object"===(void 0===t?"undefined":a(t)))return"string"==typeof t.data&&(t.data=JSON.parse(t.data)),t.data instanceof Array&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=t.data[0]instanceof Array?t.fields:c(t.data[0])),t.data[0]instanceof Array||"object"===a(t.data[0])||(t.data=[t.data])),h(t.fields||[],t.data||[]);throw"exception: Unable to serialize unrecognized input";function c(t){if("object"!==(void 0===t?"undefined":a(t)))return[];var e=[];for(var i in t)e.push(i);return e}function h(t,e){var i="";"string"==typeof t&&(t=JSON.parse(t)),"string"==typeof e&&(e=JSON.parse(e));var a=t instanceof Array&&t.length>0,s=!(e[0]instanceof Array);if(a&&n){for(var l=0;l<t.length;l++)l>0&&(i+=r),i+=d(t[l],l);e.length>0&&(i+=o)}for(var u=0;u<e.length;u++){for(var c=a?t.length:e[u].length,h=0;h<c;h++){h>0&&(i+=r);var f=a&&s?t[h]:h;i+=d(e[u][f],h)}u<e.length-1&&(i+=o)}return i}function d(t,e){if(void 0===t||null===t)return"";t=t.toString().replace(l,s+s);var n="boolean"==typeof i&&i||i instanceof Array&&i[e]||function(t,e){for(var i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return!0;return!1}(t,u.BAD_DELIMITERS)||t.indexOf(r)>-1||" "===t.charAt(0)||" "===t.charAt(t.length-1);return n?s+t+s:t}}};if(u.RECORD_SEP=String.fromCharCode(30),u.UNIT_SEP=String.fromCharCode(31),u.BYTE_ORDER_MARK="\ufeff",u.BAD_DELIMITERS=["\r","\n",'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!n&&!!i.Worker,u.SCRIPT_PATH=null,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=g,u.ParserHandle=v,u.NetworkStreamer=d,u.FileStreamer=f,u.StringStreamer=p,u.ReadableStreamStreamer=m,i.jQuery){var c=i.jQuery;c.fn.parse=function(t){var e=t.config||{},n=[];return this.each(function(t){if(!("INPUT"===c(this).prop("tagName").toUpperCase()&&"file"===c(this).attr("type").toLowerCase()&&i.FileReader)||!this.files||0===this.files.length)return!0;for(var r=0;r<this.files.length;r++)n.push({file:this.files[r],inputElem:this,instanceConfig:c.extend({},e)})}),r(),this;function r(){if(0!==n.length){var e,i,r,s,l=n[0];if(S(t.before)){var h=t.before(l.file,l.inputElem);if("object"===(void 0===h?"undefined":a(h))){if("abort"===h.action)return e="AbortError",i=l.file,r=l.inputElem,s=h.reason,void(S(t.error)&&t.error({name:e},i,r,s));if("skip"===h.action)return void o();"object"===a(h.config)&&(l.instanceConfig=c.extend(l.instanceConfig,h.config))}else if("skip"===h)return void o()}var d=l.instanceConfig.complete;l.instanceConfig.complete=function(t){S(d)&&d(t,l.file,l.inputElem),o()},u.parse(l.file,l.instanceConfig)}else S(t.complete)&&t.complete()}function o(){n.splice(0,1),r()}}}function h(t){this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var e=x(t);e.chunkSize=parseInt(e.chunkSize),t.step||t.chunk||(e.chunkSize=null);this._handle=new v(e),this._handle.streamer=this,this._config=e}.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&S(this._config.beforeFirstChunk)){var e=this._config.beforeFirstChunk(t);void 0!==e&&(t=e)}this.isFirstChunk=!1;var n=this._partialLine+t;this._partialLine="";var o=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var a=o.meta.cursor;this._finished||(this._partialLine=n.substring(a-this._baseIndex),this._baseIndex=a),o&&o.data&&(this._rowCount+=o.data.length);var s=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)i.postMessage({results:o,workerId:u.WORKER_ID,finished:s});else if(S(this._config.chunk)){if(this._config.chunk(o,this._handle),this._paused)return;o=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!s||!S(this._config.complete)||o&&o.meta.aborted||this._config.complete(this._completeResults,this._input),s||o&&o.meta.paused||this._nextChunk(),o}},this._sendError=function(t){S(this._config.error)?this._config.error(t):r&&this._config.error&&i.postMessage({workerId:u.WORKER_ID,error:t,finished:!1})}}function d(t){var e;(t=t||{}).chunkSize||(t.chunkSize=u.RemoteChunkSize),h.call(this,t),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(t){this._input=t,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),n||(e.onload=w(this._chunkLoaded,this),e.onerror=w(this._chunkError,this)),e.open("GET",this._input,!n),this._config.downloadRequestHeaders){var t=this._config.downloadRequestHeaders;for(var i in t)e.setRequestHeader(i,t[i])}if(this._config.chunkSize){var r=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+r),e.setRequestHeader("If-None-Match","webkit-no-cache")}try{e.send()}catch(t){this._chunkError(t.message)}n&&0===e.status?this._chunkError():this._start+=this._config.chunkSize}},this._chunkLoaded=function(){4==e.readyState&&(e.status<200||e.status>=400?this._chunkError():(this._finished=!this._config.chunkSize||this._start>function(t){var e=t.getResponseHeader("Content-Range");if(null===e)return-1;return parseInt(e.substr(e.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(t){var i=e.statusText||t;this._sendError(i)}}function f(t){var e,i;(t=t||{}).chunkSize||(t.chunkSize=u.LocalChunkSize),h.call(this,t);var n="undefined"!=typeof FileReader;this.stream=function(t){this._input=t,i=t.slice||t.webkitSlice||t.mozSlice,n?((e=new FileReader).onload=w(this._chunkLoaded,this),e.onerror=w(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var t=this._input;if(this._config.chunkSize){var r=Math.min(this._start+this._config.chunkSize,this._input.size);t=i.call(t,this._start,r)}var o=e.readAsText(t,this._config.encoding);n||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(t){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(t.target.result)},this._chunkError=function(){this._sendError(e.error)}}function p(t){var e;t=t||{},h.call(this,t),this.stream=function(t){return t,e=t,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var t=this._config.chunkSize,i=t?e.substr(0,t):e;return e=t?e.substr(t):"",this._finished=!e,this.parseChunk(i)}}}function m(t){t=t||{},h.call(this,t);var e=[],i=!0;this.stream=function(t){this._input=t,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._nextChunk=function(){e.length?this.parseChunk(e.shift()):i=!0},this._streamData=w(function(t){try{e.push("string"==typeof t?t:t.toString(this._config.encoding)),i&&(i=!1,this.parseChunk(e.shift()))}catch(t){this._streamError(t)}},this),this._streamError=w(function(t){this._streamCleanUp(),this._sendError(t.message)},this),this._streamEnd=w(function(){this._streamCleanUp(),this._finished=!0,this._streamData("")},this),this._streamCleanUp=w(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function v(t){var e,i,n,r=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,o=this,a=0,s=!1,l=!1,c=[],h={data:[],errors:[],meta:{}};if(S(t.step)){var d=t.step;t.step=function(e){if(h=e,p())f();else{if(f(),0===h.data.length)return;a+=e.data.length,t.preview&&a>t.preview?i.abort():d(h,o)}}}function f(){if(h&&n&&(v("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),n=!1),t.skipEmptyLines)for(var e=0;e<h.data.length;e++)1===h.data[e].length&&""===h.data[e][0]&&h.data.splice(e--,1);return p()&&function(){if(!h)return;for(var t=0;p()&&t<h.data.length;t++)for(var e=0;e<h.data[t].length;e++)c.push(h.data[t][e]);h.data.splice(0,1)}(),function(){if(!h||!t.header&&!t.dynamicTyping)return h;for(var e=0;e<h.data.length;e++){for(var i=t.header?{}:[],n=0;n<h.data[e].length;n++){var r=n,o=h.data[e][n];t.header&&(r=n>=c.length?"__parsed_extra":c[n]),o=m(r,o),"__parsed_extra"===r?(i[r]=i[r]||[],i[r].push(o)):i[r]=o}h.data[e]=i,t.header&&(n>c.length?v("FieldMismatch","TooManyFields","Too many fields: expected "+c.length+" fields but parsed "+n,e):n<c.length&&v("FieldMismatch","TooFewFields","Too few fields: expected "+c.length+" fields but parsed "+n,e))}t.header&&h.meta&&(h.meta.fields=c);return h}()}function p(){return t.header&&0===c.length}function m(e,i){return function(e){return t.dynamicTypingFunction&&void 0===t.dynamicTyping[e]&&(t.dynamicTyping[e]=t.dynamicTypingFunction(e)),!0===(t.dynamicTyping[e]||t.dynamicTyping)}(e)?"true"===i||"TRUE"===i||"false"!==i&&"FALSE"!==i&&(n=i,r.test(n)?parseFloat(n):n):i;var n}function v(t,e,i,n){h.errors.push({type:t,code:e,message:i,row:n})}this.parse=function(r,o,a){if(t.newline||(t.newline=function(t){var e=(t=t.substr(0,1048576)).split("\r"),i=t.split("\n"),n=i.length>1&&i[0].length<e[0].length;if(1===e.length||n)return"\n";for(var r=0,o=0;o<e.length;o++)"\n"===e[o][0]&&r++;return r>=e.length/2?"\r\n":"\r"}(r)),n=!1,t.delimiter)S(t.delimiter)&&(t.delimiter=t.delimiter(r),h.meta.delimiter=t.delimiter);else{var l=function(e,i,n){for(var r,o,a,s=[",","\t","|",";",u.RECORD_SEP,u.UNIT_SEP],l=0;l<s.length;l++){var c=s[l],h=0,d=0,f=0;a=void 0;for(var p=new g({delimiter:c,newline:i,preview:10}).parse(e),m=0;m<p.data.length;m++)if(n&&1===p.data[m].length&&0===p.data[m][0].length)f++;else{var v=p.data[m].length;d+=v,void 0!==a?v>1&&(h+=Math.abs(v-a),a=v):a=v}p.data.length>0&&(d/=p.data.length-f),(void 0===o||h<o)&&d>1.99&&(o=h,r=c)}return t.delimiter=r,{successful:!!r,bestDelimiter:r}}(r,t.newline,t.skipEmptyLines);l.successful?t.delimiter=l.bestDelimiter:(n=!0,t.delimiter=u.DefaultDelimiter),h.meta.delimiter=t.delimiter}var c=x(t);return t.preview&&t.header&&c.preview++,e=r,i=new g(c),h=i.parse(e,o,a),f(),s?{meta:{paused:!0}}:h||{meta:{paused:!1}}},this.paused=function(){return s},this.pause=function(){s=!0,i.abort(),e=e.substr(i.getCharIndex())},this.resume=function(){s=!1,o.streamer.parseChunk(e)},this.aborted=function(){return l},this.abort=function(){l=!0,i.abort(),h.meta.aborted=!0,S(t.complete)&&t.complete(h),e=""}}function g(t){var e=(t=t||{}).delimiter,i=t.newline,n=t.comments,r=t.step,o=t.preview,a=t.fastMode,s=t.quoteChar||'"';if(("string"!=typeof e||u.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw"Comment character same as delimiter";!0===n?n="#":("string"!=typeof n||u.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=i&&"\r"!=i&&"\r\n"!=i&&(i="\n");var l=0,c=!1;this.parse=function(t,u,h){if("string"!=typeof t)throw"Input must be a string";var d=t.length,f=e.length,p=i.length,m=n.length,v=S(r);l=0;var g=[],y=[],_=[],b=0;if(!t)return P();if(a||!1!==a&&-1===t.indexOf(s)){for(var x=t.split(i),w=0;w<x.length;w++){_=x[w];if(l+=_.length,w!==x.length-1)l+=i.length;else if(h)return P();if(!n||_.substr(0,m)!==n){if(v){if(g=[],T(_.split(e)),A(),c)return P()}else T(_.split(e));if(o&&w>=o)return g=g.slice(0,o),P(!0)}}return P()}for(var M=t.indexOf(e,l),E=t.indexOf(i,l),z=new RegExp(s+s,"g");;)if(t[l]!==s)if(n&&0===_.length&&t.substr(l,m)===n){if(-1===E)return P();l=E+p,E=t.indexOf(i,l),M=t.indexOf(e,l)}else if(-1!==M&&(M<E||-1===E))_.push(t.substring(l,M)),l=M+f,M=t.indexOf(e,l);else{if(-1===E)break;if(_.push(t.substring(l,E)),C(E+p),v&&(A(),c))return P();if(o&&g.length>=o)return P(!0)}else{var k=l;for(l++;;){if(-1===(k=t.indexOf(s,k+1)))return h||y.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:g.length,index:l}),O();if(k===d-1)return O(t.substring(l,k).replace(z,s));if(t[k+1]!==s){if(t[k+1]===e){_.push(t.substring(l,k).replace(z,s)),l=k+1+f,M=t.indexOf(e,l),E=t.indexOf(i,l);break}if(t.substr(k+1,p)===i){if(_.push(t.substring(l,k).replace(z,s)),C(k+1+p),M=t.indexOf(e,l),v&&(A(),c))return P();if(o&&g.length>=o)return P(!0);break}y.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:g.length,index:l}),k++}else k++}}return O();function T(t){g.push(t),b=l}function O(e){return h?P():(void 0===e&&(e=t.substr(l)),_.push(e),l=d,T(_),v&&A(),P())}function C(e){l=e,T(_),_=[],E=t.indexOf(i,l)}function P(t){return{data:g,errors:y,meta:{delimiter:e,linebreak:i,aborted:c,truncated:!!t,cursor:b+(u||0)}}}function A(){r(P()),g=[],y=[]}},this.abort=function(){c=!0},this.getCharIndex=function(){return l}}function y(t){var e=t.data,i=s[e.workerId],n=!1;if(e.error)i.userError(e.error,e.file);else if(e.results&&e.results.data){var r={abort:function(){n=!0,_(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:b,resume:b};if(S(i.userStep)){for(var o=0;o<e.results.data.length&&(i.userStep({data:[e.results.data[o]],errors:e.results.errors,meta:e.results.meta},r),!n);o++);delete e.results}else S(i.userChunk)&&(i.userChunk(e.results,r,e.file),delete e.results)}e.finished&&!n&&_(e.workerId,e.results)}function _(t,e){var i=s[t];S(i.userComplete)&&i.userComplete(e),i.terminate(),delete s[t]}function b(){throw"Not implemented."}function x(t){if("object"!==(void 0===t?"undefined":a(t)))return t;var e=t instanceof Array?[]:{};for(var i in t)e[i]=x(t[i]);return e}function w(t,e){return function(){t.apply(e,arguments)}}function S(t){return"function"==typeof t}return r?i.onmessage=function(t){var e=t.data;void 0===u.WORKER_ID&&e&&(u.WORKER_ID=e.workerId);if("string"==typeof e.input)i.postMessage({workerId:u.WORKER_ID,results:u.parse(e.input,e.config),finished:!0});else if(i.File&&e.input instanceof File||e.input instanceof Object){var n=u.parse(e.input,e.config);n&&i.postMessage({workerId:u.WORKER_ID,results:n,finished:!0})}}:u.WORKERS_SUPPORTED&&(e=document.getElementsByTagName("script"),t=e.length?e[e.length-1].src:"",document.body?document.addEventListener("DOMContentLoaded",function(){o=!0},!0):o=!0),d.prototype=Object.create(h.prototype),d.prototype.constructor=d,f.prototype=Object.create(h.prototype),f.prototype.constructor=f,p.prototype=Object.create(p.prototype),p.prototype.constructor=p,m.prototype=Object.create(h.prototype),m.prototype.constructor=m,u})?n.apply(e,r):n)||(t.exports=o)}]);t.exports=i},48:function(t,e){var i=function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=45)}([function(t,e,i){"use strict";var n=Array.isArray;t.exports=n},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(29),o="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,a=r||o||Function("return this")();t.exports=a},function(t,e,i){"use strict";var n=i(61),r=i(67);t.exports=function(t,e){var i=r(t,e);return n(i)?i:void 0}},function(t,e,i){"use strict";var n=i(11),r=i(63),o=i(64),a="[object Null]",s="[object Undefined]",l=n?n.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?s:a:l&&l in Object(t)?r(t):o(t)}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){return null!=t&&"object"==(void 0===t?"undefined":n(t))}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){var e=void 0===t?"undefined":n(t);return null!=t&&("object"==e||"function"==e)}},function(t,e,i){"use strict";var n=i(7);t.exports=function(t){return null==t?"":n(t)}},function(t,e,i){"use strict";var n=i(11),r=i(26),o=i(0),a=i(15),s=1/0,l=n?n.prototype:void 0,u=l?l.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(o(e))return r(e,t)+"";if(a(e))return u?u.call(e):"";var i=e+"";return"0"==i&&1/e==-s?"-0":i}},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}var r=i(51),o=i(52),a=i(53),s=i(54),l=i(55);n.prototype.clear=r,n.prototype.delete=o,n.prototype.get=a,n.prototype.has=s,n.prototype.set=l,t.exports=n},function(t,e,i){"use strict";var n=i(10);t.exports=function(t,e){for(var i=t.length;i--;)if(n(t[i][0],e))return i;return-1}},function(t,e,i){"use strict";t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,i){"use strict";var n=i(1).Symbol;t.exports=n},function(t,e,i){"use strict";var n=i(2)(Object,"create");t.exports=n},function(t,e,i){"use strict";var n=i(76);t.exports=function(t,e){var i=t.__data__;return n(e)?i["string"==typeof e?"string":"hash"]:i.map}},function(t,e,i){"use strict";var n=i(28),r=i(22);t.exports=function(t){return null!=t&&r(t.length)&&!n(t)}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(3),o=i(4),a="[object Symbol]";t.exports=function(t){return"symbol"==(void 0===t?"undefined":n(t))||o(t)&&r(t)==a}},function(t,e,i){"use strict";var n=i(15),r=1/0;t.exports=function(t){if("string"==typeof t||n(t))return t;var e=t+"";return"0"==e&&1/t==-r?"-0":e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WS_RESPONSE_ERROR="WS response error",e.NETWORK_ERROR="Network error",e.WS_BAD_RESPONSE="WS bad response",e.WS_ERROR="WS error",e.WS_MESSAGE="WS message",e.WsError=function(t){function e(t,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.name="WaffleServerError",n.message=t,n.details=i,n.endpoint=null,n.url=null,n.ddfql=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,Error),e}()},function(t,e,i){"use strict";var n=i(2)(i(1),"Map");t.exports=n},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}var r=i(68),o=i(75),a=i(77),s=i(78),l=i(79);n.prototype.clear=r,n.prototype.delete=o,n.prototype.get=a,n.prototype.has=s,n.prototype.set=l,t.exports=n},function(t,e,i){"use strict";var n=i(97),r=i(102),o=i(14);t.exports=function(t){return o(t)?n(t):r(t)}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var i=void 0===t?"undefined":n(t);return!!(e=null==e?r:e)&&("number"==i||"symbol"!=i&&o.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,i){"use strict";var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(0),o=i(15),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var i=void 0===t?"undefined":n(t);return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!o(t))||s.test(t)||!a.test(t)||null!=e&&t in Object(e)}},function(t,e,i){"use strict";var n=i(144);t.exports=function(t,e,i){var r=t.length;return i=void 0===i?r:i,!e&&i>=r?t:n(t,e,i)}},function(t,e,i){"use strict";var n=i(148),r=i(43),o=i(149);t.exports=function(t){return r(t)?o(t):n(t)}},function(t,e,i){"use strict";t.exports=function(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}},function(t,e,i){"use strict";function n(t){var e=this.__data__=new r(t);this.size=e.size}var r=i(8),o=i(56),a=i(57),s=i(58),l=i(59),u=i(60);n.prototype.clear=o,n.prototype.delete=a,n.prototype.get=s,n.prototype.has=l,n.prototype.set=u,t.exports=n},function(t,e,i){"use strict";var n=i(3),r=i(5),o="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",l="[object Proxy]";t.exports=function(t){if(!r(t))return!1;var e=n(t);return e==a||e==s||e==o||e==l}},function(t,e,i){"use strict";(function(e){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n="object"==(void 0===e?"undefined":i(e))&&e&&e.Object===Object&&e;t.exports=n}).call(e,i(62))},function(t,e,i){"use strict";var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,i){"use strict";var n=i(80),r=i(4);t.exports=function t(e,i,o,a,s){return e===i||(null==e||null==i||!r(e)&&!r(i)?e!=e&&i!=i:n(e,i,o,a,t,s))}},function(t,e,i){"use strict";var n=i(81),r=i(84),o=i(85),a=1,s=2;t.exports=function(t,e,i,l,u,c){var h=i&a,d=t.length,f=e.length;if(d!=f&&!(h&&f>d))return!1;var p=c.get(t);if(p&&c.get(e))return p==e;var m=-1,v=!0,g=i&s?new n:void 0;for(c.set(t,e),c.set(e,t);++m<d;){var y=t[m],_=e[m];if(l)var b=h?l(_,y,m,e,t,c):l(y,_,m,t,e,c);if(void 0!==b){if(b)continue;v=!1;break}if(g){if(!r(e,function(t,e){if(!o(g,e)&&(y===t||u(y,t,i,l,c)))return g.push(e)})){v=!1;break}}else if(y!==_&&!u(y,_,i,l,c)){v=!1;break}}return c.delete(t),c.delete(e),v}},function(t,e,i){"use strict";var n=i(99),r=i(4),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(t){return r(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=l},function(t,e,i){"use strict";(function(t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(1),o=i(100),a="object"==n(e)&&e&&!e.nodeType&&e,s=a&&"object"==n(t)&&t&&!t.nodeType&&t,l=s&&s.exports===a?r.Buffer:void 0,u=(l?l.isBuffer:void 0)||o;t.exports=u}).call(e,i(35)(t))},function(t,e,i){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){"use strict";var n=i(101),r=i(37),o=i(38),a=o&&o.isTypedArray,s=a?r(a):n;t.exports=s},function(t,e,i){"use strict";t.exports=function(t){return function(e){return t(e)}}},function(t,e,i){"use strict";(function(t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(29),o="object"==n(e)&&e&&!e.nodeType&&e,a=o&&"object"==n(t)&&t&&!t.nodeType&&t,s=a&&a.exports===o&&r.process,l=function(){try{return s&&s.binding&&s.binding("util")}catch(t){}}();t.exports=l}).call(e,i(35)(t))},function(t,e,i){"use strict";var n=i(5);t.exports=function(t){return t==t&&!n(t)}},function(t,e,i){"use strict";t.exports=function(t,e){return function(i){return null!=i&&i[t]===e&&(void 0!==e||t in Object(i))}}},function(t,e,i){"use strict";var n=i(42),r=i(16);t.exports=function(t,e){for(var i=0,o=(e=n(e,t)).length;null!=t&&i<o;)t=t[r(e[i++])];return i&&i==o?t:void 0}},function(t,e,i){"use strict";var n=i(0),r=i(23),o=i(114),a=i(6);t.exports=function(t,e){return n(t)?t:r(t,e)?[t]:o(a(t))}},function(t,e,i){"use strict";var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return n.test(t)}},function(t,e,i){"use strict";var n=i(152),r=i(153),o=i(154);t.exports=function(t,e,i){return e==e?o(t,e,i):n(t,r,i)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WsReader=e.WsError=void 0;var n=i(17);Object.defineProperty(e,"WsError",{enumerable:!0,get:function(){return n.WsError}});var r=i(46),o=i(136),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(159));e.WsReader={getReader:function(){for(var t={ajax:a.ajax},e=(0,o.getBaseWsReader)(t),i=arguments.length,n=Array(i),s=0;s<i;s++)n[s]=arguments[s];return Object.assign.apply(Object,[e].concat(n)),Object.assign({},e,r.WsJsonReader)}}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.WsJsonReader=void 0;var r=n(i(47)),o=n(i(130)),a=n(i(135));e.WsJsonReader={_toPojo:function(t){var e=t.rows,i=t.headers;return(0,r.default)(e,function(t){return(0,o.default)(i,(0,r.default)(t,function(t){return(0,a.default)(t)?null:t}))})}}},function(t,e,i){"use strict";var n=i(26),r=i(48),o=i(124),a=i(0);t.exports=function(t,e){return(a(t)?n:o)(t,r(e,3))}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(49),o=i(112),a=i(120),s=i(0),l=i(121);t.exports=function(t){return"function"==typeof t?t:null==t?a:"object"==(void 0===t?"undefined":n(t))?s(t)?o(t[0],t[1]):r(t):l(t)}},function(t,e,i){"use strict";var n=i(50),r=i(111),o=i(40);t.exports=function(t){var e=r(t);return 1==e.length&&e[0][2]?o(e[0][0],e[0][1]):function(i){return i===t||n(i,t,e)}}},function(t,e,i){"use strict";var n=i(27),r=i(31),o=1,a=2;t.exports=function(t,e,i,s){var l=i.length,u=l,c=!s;if(null==t)return!u;for(t=Object(t);l--;){var h=i[l];if(c&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++l<u;){var d=(h=i[l])[0],f=t[d],p=h[1];if(c&&h[2]){if(void 0===f&&!(d in t))return!1}else{var m=new n;if(s)var v=s(f,p,d,t,e,m);if(!(void 0===v?r(p,f,o|a,s,m):v))return!1}}return!0}},function(t,e,i){"use strict";t.exports=function(){this.__data__=[],this.size=0}},function(t,e,i){"use strict";var n=i(9),r=Array.prototype.splice;t.exports=function(t){var e=this.__data__,i=n(e,t);return!(i<0||(i==e.length-1?e.pop():r.call(e,i,1),--this.size,0))}},function(t,e,i){"use strict";var n=i(9);t.exports=function(t){var e=this.__data__,i=n(e,t);return i<0?void 0:e[i][1]}},function(t,e,i){"use strict";var n=i(9);t.exports=function(t){return n(this.__data__,t)>-1}},function(t,e,i){"use strict";var n=i(9);t.exports=function(t,e){var i=this.__data__,r=n(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}},function(t,e,i){"use strict";var n=i(8);t.exports=function(){this.__data__=new n,this.size=0}},function(t,e,i){"use strict";t.exports=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}},function(t,e,i){"use strict";t.exports=function(t){return this.__data__.get(t)}},function(t,e,i){"use strict";t.exports=function(t){return this.__data__.has(t)}},function(t,e,i){"use strict";var n=i(8),r=i(18),o=i(19),a=200;t.exports=function(t,e){var i=this.__data__;if(i instanceof n){var s=i.__data__;if(!r||s.length<a-1)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new o(s)}return i.set(t,e),this.size=i.size,this}},function(t,e,i){"use strict";var n=i(28),r=i(65),o=i(5),a=i(30),s=/^\[object .+?Constructor\]$/,l=Function.prototype,u=Object.prototype,c=l.toString,h=u.hasOwnProperty,d=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||r(t))&&(n(t)?d:s).test(a(t))}},function(t,e,i){"use strict";var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"===("undefined"==typeof window?"undefined":r(window))&&(n=window)}t.exports=n},function(t,e,i){"use strict";var n=i(11),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,s=n?n.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),i=t[s];try{t[s]=void 0;var n=!0}catch(t){}var r=a.call(t);return n&&(e?t[s]=i:delete t[s]),r}},function(t,e,i){"use strict";var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,i){"use strict";var n=i(66),r=function(){var t=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=function(t){return!!r&&r in t}},function(t,e,i){"use strict";var n=i(1)["__core-js_shared__"];t.exports=n},function(t,e,i){"use strict";t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,i){"use strict";var n=i(69),r=i(8),o=i(18);t.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||r),string:new n}}},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}var r=i(70),o=i(71),a=i(72),s=i(73),l=i(74);n.prototype.clear=r,n.prototype.delete=o,n.prototype.get=a,n.prototype.has=s,n.prototype.set=l,t.exports=n},function(t,e,i){"use strict";var n=i(12);t.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(t,e,i){"use strict";t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,i){"use strict";var n=i(12),r="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(n){var i=e[t];return i===r?void 0:i}return o.call(e,t)?e[t]:void 0}},function(t,e,i){"use strict";var n=i(12),r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return n?void 0!==e[t]:r.call(e,t)}},function(t,e,i){"use strict";var n=i(12),r="__lodash_hash_undefined__";t.exports=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=n&&void 0===e?r:e,this}},function(t,e,i){"use strict";var n=i(13);t.exports=function(t){var e=n(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){var e=void 0===t?"undefined":n(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,i){"use strict";var n=i(13);t.exports=function(t){return n(this,t).get(t)}},function(t,e,i){"use strict";var n=i(13);t.exports=function(t){return n(this,t).has(t)}},function(t,e,i){"use strict";var n=i(13);t.exports=function(t,e){var i=n(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}},function(t,e,i){"use strict";var n=i(27),r=i(32),o=i(86),a=i(90),s=i(106),l=i(0),u=i(34),c=i(36),h=1,d="[object Arguments]",f="[object Array]",p="[object Object]",m=Object.prototype.hasOwnProperty;t.exports=function(t,e,i,v,g,y){var _=l(t),b=l(e),x=_?f:s(t),w=b?f:s(e),S=(x=x==d?p:x)==p,M=(w=w==d?p:w)==p,E=x==w;if(E&&u(t)){if(!u(e))return!1;_=!0,S=!1}if(E&&!S)return y||(y=new n),_||c(t)?r(t,e,i,v,g,y):o(t,e,x,i,v,g,y);if(!(i&h)){var z=S&&m.call(t,"__wrapped__"),k=M&&m.call(e,"__wrapped__");if(z||k){var T=z?t.value():t,O=k?e.value():e;return y||(y=new n),g(T,O,i,v,y)}}return!!E&&(y||(y=new n),a(t,e,i,v,g,y))}},function(t,e,i){"use strict";function n(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new r;++e<i;)this.add(t[e])}var r=i(19),o=i(82),a=i(83);n.prototype.add=n.prototype.push=o,n.prototype.has=a,t.exports=n},function(t,e,i){"use strict";var n="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,n),this}},function(t,e,i){"use strict";t.exports=function(t){return this.__data__.has(t)}},function(t,e,i){"use strict";t.exports=function(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}},function(t,e,i){"use strict";t.exports=function(t,e){return t.has(e)}},function(t,e,i){"use strict";var n=i(11),r=i(87),o=i(10),a=i(32),s=i(88),l=i(89),u=1,c=2,h="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Map]",m="[object Number]",v="[object RegExp]",g="[object Set]",y="[object String]",_="[object Symbol]",b="[object ArrayBuffer]",x="[object DataView]",w=n?n.prototype:void 0,S=w?w.valueOf:void 0;t.exports=function(t,e,i,n,w,M,E){switch(i){case x:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case b:return!(t.byteLength!=e.byteLength||!M(new r(t),new r(e)));case h:case d:case m:return o(+t,+e);case f:return t.name==e.name&&t.message==e.message;case v:case y:return t==e+"";case p:var z=s;case g:var k=n&u;if(z||(z=l),t.size!=e.size&&!k)return!1;var T=E.get(t);if(T)return T==e;n|=c,E.set(t,e);var O=a(z(t),z(e),n,w,M,E);return E.delete(t),O;case _:if(S)return S.call(t)==S.call(e)}return!1}},function(t,e,i){"use strict";var n=i(1).Uint8Array;t.exports=n},function(t,e,i){"use strict";t.exports=function(t){var e=-1,i=Array(t.size);return t.forEach(function(t,n){i[++e]=[n,t]}),i}},function(t,e,i){"use strict";t.exports=function(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}},function(t,e,i){"use strict";var n=i(91),r=1,o=Object.prototype.hasOwnProperty;t.exports=function(t,e,i,a,s,l){var u=i&r,c=n(t),h=c.length;if(h!=n(e).length&&!u)return!1;for(var d=h;d--;){var f=c[d];if(!(u?f in e:o.call(e,f)))return!1}var p=l.get(t);if(p&&l.get(e))return p==e;var m=!0;l.set(t,e),l.set(e,t);for(var v=u;++d<h;){var g=t[f=c[d]],y=e[f];if(a)var _=u?a(y,g,f,e,t,l):a(g,y,f,t,e,l);if(!(void 0===_?g===y||s(g,y,i,a,l):_)){m=!1;break}v||(v="constructor"==f)}if(m&&!v){var b=t.constructor,x=e.constructor;b!=x&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x)&&(m=!1)}return l.delete(t),l.delete(e),m}},function(t,e,i){"use strict";var n=i(92),r=i(94),o=i(20);t.exports=function(t){return n(t,o,r)}},function(t,e,i){"use strict";var n=i(93),r=i(0);t.exports=function(t,e,i){var o=e(t);return r(t)?o:n(o,i(t))}},function(t,e,i){"use strict";t.exports=function(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}},function(t,e,i){"use strict";var n=i(95),r=i(96),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:(t=Object(t),n(a(t),function(e){return o.call(t,e)}))}:r;t.exports=s},function(t,e,i){"use strict";t.exports=function(t,e){for(var i=-1,n=null==t?0:t.length,r=0,o=[];++i<n;){var a=t[i];e(a,i,t)&&(o[r++]=a)}return o}},function(t,e,i){"use strict";t.exports=function(){return[]}},function(t,e,i){"use strict";var n=i(98),r=i(33),o=i(0),a=i(34),s=i(21),l=i(36),u=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=o(t),c=!i&&r(t),h=!i&&!c&&a(t),d=!i&&!c&&!h&&l(t),f=i||c||h||d,p=f?n(t.length,String):[],m=p.length;for(var v in t)!e&&!u.call(t,v)||f&&("length"==v||h&&("offset"==v||"parent"==v)||d&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,m))||p.push(v);return p}},function(t,e,i){"use strict";t.exports=function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}},function(t,e,i){"use strict";var n=i(3),r=i(4),o="[object Arguments]";t.exports=function(t){return r(t)&&n(t)==o}},function(t,e,i){"use strict";t.exports=function(){return!1}},function(t,e,i){"use strict";var n=i(3),r=i(22),o=i(4),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return o(t)&&r(t.length)&&!!a[n(t)]}},function(t,e,i){"use strict";var n=i(103),r=i(104),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return r(t);var e=[];for(var i in Object(t))o.call(t,i)&&"constructor"!=i&&e.push(i);return e}},function(t,e,i){"use strict";var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e,i){"use strict";var n=i(105)(Object.keys,Object);t.exports=n},function(t,e,i){"use strict";t.exports=function(t,e){return function(i){return t(e(i))}}},function(t,e,i){"use strict";var n=i(107),r=i(18),o=i(108),a=i(109),s=i(110),l=i(3),u=i(30),c=u(n),h=u(r),d=u(o),f=u(a),p=u(s),m=l;(n&&"[object DataView]"!=m(new n(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(t){var e=l(t),i="[object Object]"==e?t.constructor:void 0,n=i?u(i):"";if(n)switch(n){case c:return"[object DataView]";case h:return"[object Map]";case d:return"[object Promise]";case f:return"[object Set]";case p:return"[object WeakMap]"}return e}),t.exports=m},function(t,e,i){"use strict";var n=i(2)(i(1),"DataView");t.exports=n},function(t,e,i){"use strict";var n=i(2)(i(1),"Promise");t.exports=n},function(t,e,i){"use strict";var n=i(2)(i(1),"Set");t.exports=n},function(t,e,i){"use strict";var n=i(2)(i(1),"WeakMap");t.exports=n},function(t,e,i){"use strict";var n=i(39),r=i(20);t.exports=function(t){for(var e=r(t),i=e.length;i--;){var o=e[i],a=t[o];e[i]=[o,a,n(a)]}return e}},function(t,e,i){"use strict";var n=i(31),r=i(113),o=i(117),a=i(23),s=i(39),l=i(40),u=i(16),c=1,h=2;t.exports=function(t,e){return a(t)&&s(e)?l(u(t),e):function(i){var a=r(i,t);return void 0===a&&a===e?o(i,t):n(e,a,c|h)}}},function(t,e,i){"use strict";var n=i(41);t.exports=function(t,e,i){var r=null==t?void 0:n(t,e);return void 0===r?i:r}},function(t,e,i){"use strict";var n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,o=i(115)(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(n,function(t,i,n,o){e.push(n?o.replace(r,"$1"):i||t)}),e});t.exports=o},function(t,e,i){"use strict";var n=i(116),r=500;t.exports=function(t){var e=n(t,function(t){return i.size===r&&i.clear(),t}),i=e.cache;return e}},function(t,e,i){"use strict";function n(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(o);var i=function i(){var n=arguments,r=e?e.apply(this,n):n[0],o=i.cache;if(o.has(r))return o.get(r);var a=t.apply(this,n);return i.cache=o.set(r,a)||o,a};return i.cache=new(n.Cache||r),i}var r=i(19),o="Expected a function";n.Cache=r,t.exports=n},function(t,e,i){"use strict";var n=i(118),r=i(119);t.exports=function(t,e){return null!=t&&r(t,e,n)}},function(t,e,i){"use strict";t.exports=function(t,e){return null!=t&&e in Object(t)}},function(t,e,i){"use strict";var n=i(42),r=i(33),o=i(0),a=i(21),s=i(22),l=i(16);t.exports=function(t,e,i){for(var u=-1,c=(e=n(e,t)).length,h=!1;++u<c;){var d=l(e[u]);if(!(h=null!=t&&i(t,d)))break;t=t[d]}return h||++u!=c?h:!!(c=null==t?0:t.length)&&s(c)&&a(d,c)&&(o(t)||r(t))}},function(t,e,i){"use strict";t.exports=function(t){return t}},function(t,e,i){"use strict";var n=i(122),r=i(123),o=i(23),a=i(16);t.exports=function(t){return o(t)?n(a(t)):r(t)}},function(t,e,i){"use strict";t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,i){"use strict";var n=i(41);t.exports=function(t){return function(e){return n(e,t)}}},function(t,e,i){"use strict";var n=i(125),r=i(14);t.exports=function(t,e){var i=-1,o=r(t)?Array(t.length):[];return n(t,function(t,n,r){o[++i]=e(t,n,r)}),o}},function(t,e,i){"use strict";var n=i(126),r=i(129)(n);t.exports=r},function(t,e,i){"use strict";var n=i(127),r=i(20);t.exports=function(t,e){return t&&n(t,e,r)}},function(t,e,i){"use strict";var n=i(128)();t.exports=n},function(t,e,i){"use strict";t.exports=function(t){return function(e,i,n){for(var r=-1,o=Object(e),a=n(e),s=a.length;s--;){var l=a[t?s:++r];if(!1===i(o[l],l,o))break}return e}}},function(t,e,i){"use strict";var n=i(14);t.exports=function(t,e){return function(i,r){if(null==i)return i;if(!n(i))return t(i,r);for(var o=i.length,a=e?o:-1,s=Object(i);(e?a--:++a<o)&&!1!==r(s[a],a,s););return i}}},function(t,e,i){"use strict";var n=i(131),r=i(134);t.exports=function(t,e){return r(t||[],e||[],n)}},function(t,e,i){"use strict";var n=i(132),r=i(10),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,i){var a=t[e];o.call(t,e)&&r(a,i)&&(void 0!==i||e in t)||n(t,e,i)}},function(t,e,i){"use strict";var n=i(133);t.exports=function(t,e,i){"__proto__"==e&&n?n(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}},function(t,e,i){"use strict";var n=i(2),r=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=r},function(t,e,i){"use strict";t.exports=function(t,e,i){for(var n=-1,r=t.length,o=e.length,a={};++n<r;){var s=n<o?e[n]:void 0;i(a,t[n],s)}return a}},function(t,e,i){"use strict";t.exports=function(t){return null==t}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.getBaseWsReader=function(t){return{init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._name="waffle",this._dataset=t.dataset,this._assetsPath=(0,c.default)(t.assetsPath||"/api/ddf/assets","/"),this._basepath=t.path,this._dataset_access_token=t.dataset_access_token,this.versionInfo={version:"2.5.0",build:1522324694627},this._basepath||console.error("There is no base path for waffle reader, please, consider to provide one")},getAsset:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._toDatasetPath(i.dataset||this._dataset),r=(0,h.default)(e,"/"),o=(0,a.default)(r,".json"),s=i.dataset_access_token||this._dataset_access_token?"dataset_access_token="+(i.dataset_access_token||this._dataset_access_token):"",l=this._assetsPath+"/"+n+"/"+r;return t.ajax({url:s?l+"?"+s:l,json:o})},_toDatasetPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if("default"===t)return t;var e=(0,u.default)(t,"#"),i=o(e,2),n=i[0],r=i[1];return n?n+"/"+(void 0===r?"master":r):"default"},read:function(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.dataset||this._dataset,o=(0,l.default)(r)?Object.assign({},e,{dataset:encodeURIComponent(r)}):e;this._dataset_access_token&&(o.dataset_access_token=this._dataset_access_token);var a=this._basepath+"?"+d.stringify(o),u=this._basepath;return t.ajax({url:a,json:!0}).then(function(t){var e=null;if((0,s.default)(t)?t.error?e=new p.WsError(p.WS_ERROR,t.error):t.message&&(e=new p.WsError(p.WS_MESSAGE,t.message)):e=new p.WsError(p.WS_BAD_RESPONSE,t),e){var r=Object.assign(e,{endpoint:u,url:a,ddfql:o});return Promise.reject(r)}return f.mapRows(i._toPojo(t),n)}).catch(function(t){var e=Object.assign(t,{endpoint:u,url:a,ddfql:o});return Promise.reject(e)})}}};var a=r(i(137)),s=r(i(5)),l=r(i(142)),u=r(i(143)),c=r(i(150)),h=r(i(155)),d=n(i(157)),f=n(i(158)),p=i(17)},function(t,e,i){"use strict";var n=i(138),r=i(7),o=i(139),a=i(6);t.exports=function(t,e,i){t=a(t),e=r(e);var s=t.length,l=i=void 0===i?s:n(o(i),0,s);return(i-=e.length)>=0&&t.slice(i,l)==e}},function(t,e,i){"use strict";t.exports=function(t,e,i){return t==t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e&&(t=t>=e?t:e)),t}},function(t,e,i){"use strict";var n=i(140);t.exports=function(t){var e=n(t),i=e%1;return e==e?i?e-i:e:0}},function(t,e,i){"use strict";var n=i(141),r=1/0,o=1.7976931348623157e308;t.exports=function(t){return t?(t=n(t))===r||t===-r?(t<0?-1:1)*o:t==t?t:0:0===t?t:0}},function(t,e,i){"use strict";var n=i(5),r=i(15),o=NaN,a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(r(t))return o;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var i=l.test(t);return i||u.test(t)?c(t.slice(2),i?2:8):s.test(t)?o:+t}},function(t,e,i){"use strict";var n=i(3),r=i(0),o=i(4),a="[object String]";t.exports=function(t){return"string"==typeof t||!r(t)&&o(t)&&n(t)==a}},function(t,e,i){"use strict";var n=i(7),r=i(24),o=i(43),a=i(145),s=i(146),l=i(25),u=i(6),c=4294967295;t.exports=function(t,e,i){return i&&"number"!=typeof i&&a(t,e,i)&&(e=i=void 0),(i=void 0===i?c:i>>>0)?(t=u(t))&&("string"==typeof e||null!=e&&!s(e))&&!(e=n(e))&&o(t)?r(l(t),0,i):t.split(e,i):[]}},function(t,e,i){"use strict";t.exports=function(t,e,i){var n=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(i=i>r?r:i)<0&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0;for(var o=Array(r);++n<r;)o[n]=t[n+e];return o}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(10),o=i(14),a=i(21),s=i(5);t.exports=function(t,e,i){if(!s(i))return!1;var l=void 0===e?"undefined":n(e);return!!("number"==l?o(i)&&a(e,i.length):"string"==l&&e in i)&&r(i[e],t)}},function(t,e,i){"use strict";var n=i(147),r=i(37),o=i(38),a=o&&o.isRegExp,s=a?r(a):n;t.exports=s},function(t,e,i){"use strict";var n=i(3),r=i(4),o="[object RegExp]";t.exports=function(t){return r(t)&&n(t)==o}},function(t,e,i){"use strict";t.exports=function(t){return t.split("")}},function(t,e,i){"use strict";var n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",r="\\ud83c[\\udffb-\\udfff]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",l="[\\ufe0e\\ufe0f]?"+s+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",o,a].join("|")+")[\\ufe0e\\ufe0f]?"+s+")*"),u="(?:"+["[^\\ud800-\\udfff]"+n+"?",n,o,a,"[\\ud800-\\udfff]"].join("|")+")",c=RegExp(r+"(?="+r+")|"+u+l,"g");t.exports=function(t){return t.match(c)||[]}},function(t,e,i){"use strict";var n=i(7),r=i(24),o=i(151),a=i(25),s=i(6),l=/\s+$/;t.exports=function(t,e,i){if((t=s(t))&&(i||void 0===e))return t.replace(l,"");if(!t||!(e=n(e)))return t;var u=a(t),c=o(u,a(e))+1;return r(u,0,c).join("")}},function(t,e,i){"use strict";var n=i(44);t.exports=function(t,e){for(var i=t.length;i--&&n(e,t[i],0)>-1;);return i}},function(t,e,i){"use strict";t.exports=function(t,e,i,n){for(var r=t.length,o=i+(n?1:-1);n?o--:++o<r;)if(e(t[o],o,t))return o;return-1}},function(t,e,i){"use strict";t.exports=function(t){return t!=t}},function(t,e,i){"use strict";t.exports=function(t,e,i){for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}},function(t,e,i){"use strict";var n=i(7),r=i(24),o=i(156),a=i(25),s=i(6),l=/^\s+/;t.exports=function(t,e,i){if((t=s(t))&&(i||void 0===e))return t.replace(l,"");if(!t||!(e=n(e)))return t;var u=a(t),c=o(u,a(e));return r(u,c).join("")}},function(t,e,i){"use strict";var n=i(44);t.exports=function(t,e){for(var i=-1,r=t.length;++i<r&&n(e,t[i],0)>-1;);return i}},function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t){function e(t){return encodeURI(t.replace(/([=:&@_;\/])/g,"/$1"))}return function t(i){if("number"==typeof i||!0===i||!1===i||null===i)return":"+i;if(i instanceof Array){for(var r=[],o=0;o<i.length;++o)r.push(t(i[o]));return"@"+r.join("&")+";"}if("object"===(void 0===i?"undefined":n(i))){for(var a in r=[],i)r.push(e(a)+t(i[a]));return"_"+r.join("&")+";"}return"="+e((null!==i?void 0!==i?i:"undefined":"null").toString())}(t).replace(/;+$/g,"")},o=function(t){function e(){for(var e="";i!==t.length;++i){if("/"===t.charAt(i)){if((i+=1)===t.length){e+=";";break}}else if(t.charAt(i).match(/[=:&@_;]/))break;e+=t.charAt(i)}return e}var i=0;return t=decodeURI(t),function n(){var r=t.charAt(i++);if("="===r)return e();if(":"===r){var o=e();return"true"===o||"false"!==o&&(o=parseFloat(o),isNaN(o)?null:o)}if("@"===r){var a=[];t:if(!(i>=t.length||";"===t.charAt(i)))for(;;){if(a.push(n()),i>=t.length||";"===t.charAt(i))break t;i+=1}return i+=1,a}if("_"===r){a={};t:if(!(i>=t.length||";"===t.charAt(i)))for(;;){if(a[e()]=n(),i>=t.length||";"===t.charAt(i))break t;i+=1}return i+=1,a}throw"Unexpected char "+r}()};e.stringify=r,e.parse=o},function(t,e,i){"use strict";function n(t){if(""===t||null===t)return null;if(!t.trim)return t;if(null==t.trim().match(/^[0-9.,]+$/))return t;var e=parseFloat(t);return isNaN(e)||!isFinite(e)?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.mapRows=void 0;var r=function(t){return t&&t.__esModule?t:{default:t}}(i(0));e.mapRows=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.map(function(t){return Object.keys(t).forEach(function(i){t[i]=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return(0,r.default)(e)?e.map(function(e){return t(e,i)}):i(e)}(t[i],e[i])}),t})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ajax=void 0,i(160);var n=i(17),r=500;e.ajax=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.url,i=void 0===e?"":e,o=t.json,a=void 0!==o&&o,s={};return a&&(s["Content-Type"]="text/plain; charset=UTF-8"),fetch(i,{method:"GET",headers:s}).then(function(t){if(!t.ok)throw new n.WsError(n.WS_RESPONSE_ERROR,t.error);return t}).then(function(t){return a?t.json():t.text()}).catch(function(t){if("WaffleServerError"===t.name)throw t;var e=t.response?t.response.status:r;throw new n.WsError(n.NETWORK_ERROR+" with status code "+e,t)})}},function(t,e,i){"use strict";!function(t){function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function i(t){return"string"!=typeof t&&(t=String(t)),t}function n(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return p.iterable&&(e[Symbol.iterator]=function(){return e}),e}function r(t){this.map={},t instanceof r?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function o(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function a(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function s(t){var e=new FileReader,i=a(e);return e.readAsArrayBuffer(t),i}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function u(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(p.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(p.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(p.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(p.arrayBuffer&&p.blob&&v(t))this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!p.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!g(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(s)}),this.text=function(){var t=o(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,i=a(e);return e.readAsText(t),i}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),i=new Array(e.length),n=0;n<e.length;n++)i[n]=String.fromCharCode(e[n]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(t,e){var i=(e=e||{}).body;if(t instanceof c){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new r(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new r(e.headers)),this.method=function(t){var e=t.toUpperCase();return y.indexOf(e)>-1?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function h(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function d(t){var e=new r;return t.split(/\r?\n/).forEach(function(t){var i=t.split(":"),n=i.shift().trim();if(n){var r=i.join(":").trim();e.append(n,r)}}),e}function f(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new r(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var p={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(p.arrayBuffer)var m=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(t){return t&&DataView.prototype.isPrototypeOf(t)},g=ArrayBuffer.isView||function(t){return t&&m.indexOf(Object.prototype.toString.call(t))>-1};r.prototype.append=function(t,n){t=e(t),n=i(n);var r=this.map[t];this.map[t]=r?r+","+n:n},r.prototype.delete=function(t){delete this.map[e(t)]},r.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(t,n){this.map[e(t)]=i(n)},r.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},r.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),n(t)},r.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),n(t)},r.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),n(t)},p.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this,{body:this._bodyInit})},u.call(c.prototype),u.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},f.error=function(){var t=new f(null,{status:0,statusText:""});return t.type="error",t};var _=[301,302,303,307,308];f.redirect=function(t,e){if(-1===_.indexOf(e))throw new RangeError("Invalid status code");return new f(null,{status:e,headers:{location:t}})},t.Headers=r,t.Request=c,t.Response=f,t.fetch=function(t,e){return new Promise(function(i,n){var r=new c(t,e),o=new XMLHttpRequest;o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:d(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;i(new f(e,t))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials&&(o.withCredentials=!0),"responseType"in o&&p.blob&&(o.responseType="blob"),r.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===r._bodyInit?null:r._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:void 0)}]);t.exports=i},49:function(t,e){var i,r;i=this,r=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=187)}([function(t,e,i){var n=i(3),r=i(25),o=i(14),a=i(15),s=i(22),l=function(t,e,i){var u,c,h,d,f=t&l.F,p=t&l.G,m=t&l.S,v=t&l.P,g=t&l.B,y=p?n:m?n[e]||(n[e]={}):(n[e]||{}).prototype,_=p?r:r[e]||(r[e]={}),b=_.prototype||(_.prototype={});for(u in p&&(i=e),i)h=((c=!f&&y&&void 0!==y[u])?y:i)[u],d=g&&c?s(h,n):v&&"function"==typeof h?s(Function.call,h):h,y&&a(y,u,h,t&l.U),_[u]!=h&&o(_,u,d),v&&b[u]!=h&&(b[u]=h)};n.core=r,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getOSname=e.getBrowserDetails=e.getSubtitle=e.replaceNumberSpacesToNonBreak=e.px2num=e.getProp=e.isFunction=e.isMobileOrTablet=e.capitalize=e.setIcon=e.pruneTree=e.isTouchDevice=e.debounce=e.memoize=e.post=e.get=e.ajax=e.interpolatePoint=e.interpolateVector=e.nestArrayToValues=e.nestArrayToObjWithFlatKeys=e.nestArrayToObj=e.hashCode=e.clearDelay=e.delay=e.defer=e.diffObject=e.arrayLast=e.arrayMedian=e.arraySum=e.arrayMean=e.arrayMax=e.arrayMin=e.values=e.keys=e.throttle=e.hasClass=e.classed=e.removeClass=e.addClass=e.countDecimals=e.error=e.groupEnd=e.groupCollapsed=e.warn=e.timeStamp=e.areaToRadius=e.cathetus=e.hypotenuse=e.radiusToArea=e.preventAncestorScrolling=e.matchAny=e.filterAny=e.filter=e.find=e.uniqueLast=e.unique=e.without=e.deepClone=e.clone=e.merge=e.deepExtend=e.extend=e.forEach=e.strToFloat=e.roundStep=e.findScrollableAncestor=e.getViewportPosition=e.comparePlainObjects=e.deepArrayEquals=e.arrayEquals=e.isPlainObject=e.isNumber=e.isEmpty=e.isNaN=e.isString=e.isDate=e.isObject=e.isArray=e.isElement=e.uniqueId=e.printAutoconfigResult=e.approxEqual=e.d3text=e.d3json=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.makeAbsoluteContext=function(t,e){return function(i,n){var r=e.getBoundingClientRect(),o=t.getScreenCTM();return{x:o.a*i+o.c*n+o.e-r.left,y:o.b*i+o.d*n+o.f-r.top}}},e.firstBy=function(){function t(t){return t}function e(t){return"string"==typeof t?t.toLowerCase():t}return function i(n,r){var o="function"==typeof this&&this;var a=function(i,n){if(n="number"==typeof n?{direction:n}:n||{},"function"!=typeof i){var r=i;i=function(t){return t[r]?t[r]:""}}if(1===i.length){var o=i,a=n.ignoreCase?e:t;i=function(t,e){return a(o(t))<a(o(e))?-1:a(o(t))>a(o(e))?1:0}}return-1===n.direction?function(t,e){return-i(t,e)}:i}(n,r);var s=o?function(t,e){return o(t,e)||a(t,e)}:a;s.thenBy=i;return s}},e.transform=function(t){var e=t.transform.baseVal.consolidate().matrix,i=e.a,n=e.b,r=e.c,o=e.d,a=e.e,s=e.f;return function(t,e,i,n,r,o){var a=void 0,s=void 0,l=void 0;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*Math.PI/180,skewX:Math.atan(l)*Math.PI/180,scaleX:a,scaleY:s}}(i,n,r,o,a,s)},e.getKey=function(t,e){for(var i=t[e[0]],n=1,r=e.length;n<r;n++)i=i+","+t[e[n]];return i};var r,o=i(391),a=(r=o)&&r.__esModule?r:{default:r};e.d3json=function(t,e){window.fetch&&-1===navigator.userAgent.toLowerCase().indexOf(" electron/")?fetch(t).then(function(t){if(t.ok)return t.json();e(new Error)}).then(function(t){e(null,t)}).catch(function(t){return e(t)}):d3.json(t,e)},e.d3text=function(t,e){window.fetch&&-1===navigator.userAgent.toLowerCase().indexOf(" electron/")?fetch(t).then(function(t){if(t.ok)return t.text();e(new Error)}).then(function(t){e(null,t)}).catch(function(t){return e(t)}):d3.text(t,e)},e.approxEqual=function(t,e,i){return i=i||0,e>0?(1-i)*e<=t&&t<=e*(1+i):e<0?(1+i)*e<=t&&t<=e*(1-i):Math.abs(t)<=i},e.printAutoconfigResult=function(t){console.info("AUTOCONFIG: "+t._name+(t.isHook()?" of "+t._parent._name:"")+" choses "+(t.dim||t.which)+" from "+(t.dataSource?t.dataSource._name:"<DATA SOURCE MISSING!>")+" to be "+("entities"===t._type||"time"===t._type?"DIM":"WHICH"))},e.uniqueId=(s=0,function(t){return t?t+(s+=1):s+=1}),e.isElement=function(t){return!(!t||1!==t.nodeType)};var s,l=e.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=e.isObject=function(t){return"object"===(void 0===t?"undefined":n(t))&&!!t},c=(e.isDate=function(t){return t instanceof Date},e.isString=function(t){return"string"==typeof t}),h=e.isNaN=function(t){return f(t)&&t!==+t},d=e.isEmpty=function(t){return 0===Object.keys(t).length&&t.constructor===Object},f=e.isNumber=function(t){return"number"==typeof t||!!t&&"object"===(void 0===t?"undefined":n(t))&&"[object Number]"===Object.prototype.toString.call(t)},p=e.isPlainObject=function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},m=(e.arrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},e.deepArrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(p(t[i])&&p(e[i])){if(!v(t[i],e[i]))return!1}else if(t[i]!==e[i])return!1;return!0}),v=e.comparePlainObjects=function(t,e){var i=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e=void 0===t?"undefined":n(t);return"object"===e&&(e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]}(t).toLowerCase()),"number"===e?t.toString().indexOf(".")>0?"float":"integer":e},r=function(t,e){if(t===e)return!0;for(var i in t){if(!e.hasOwnProperty(i))return!1;if(!a(t[i],e[i]))return!1}for(var n in e)if(!t.hasOwnProperty(n))return!1;return!0},o={array:function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!a(t[i],e[i]))return!1;return!0}};o.object=r,o.date=function(t,e){return t.getTime()===e.getTime()},o.regexp=function(t,e){return t.toString()===e.toString()};var a=function(t,e){if(t!==e){var n=i(t);return n===i(e)&&(o.hasOwnProperty(n)?o[n](t,e):t==e)}return!0};return r(t,e)},g=(e.getViewportPosition=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:i}},e.findScrollableAncestor=function(t){for(var e=["scroll","auto"];t=t.parentNode;){if(t.scrollHeight>t.clientHeight&&-1!==e.indexOf(d3.select(t).style("overflow")))return t}return null},e.roundStep=function(t,e){return Math.round(t/e)*e},e.strToFloat=function(t){return+t.replace(/[^\d.-]/g,"")},e.forEach=function(t,e,i){if(t){var n=void 0,r=void 0;if(l(t))for(r=t.length,n=0;n<r;n+=1){if(!1===e.apply(i,[t[n],n]))break}else{var o=Object.keys(t);for(r=o.length,n=0;n<r;n+=1){if(!1===e.apply(i,[t[o[n]],o[n]]))break}}}});e.extend=function(t){var e=Array.prototype.slice.call(arguments,1);return g(e,function(e,i){g(e,function(i,n){e.hasOwnProperty(n)&&(t[n]=i)})}),t};function y(t){return Boolean(t instanceof Date||t instanceof RegExp)}function _(t){if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function b(t){var e=[];return g(t,function(t,i){"object"===(void 0===t?"undefined":n(t))&&null!==t?l(t)?e[i]=b(t):y(t)?e[i]=_(t):e[i]=x({},t):e[i]=t}),e}var x=e.deepExtend=function t(){if(arguments.length<1||"object"!==n(arguments[0]))return!1;if(arguments.length<2)return arguments[0];var e=arguments[0],i="boolean"==typeof arguments[arguments.length-1],r=i&&arguments[arguments.length-1],o=Array.prototype.slice.call(arguments,1,i?-1:arguments.length),a=void 0,s=void 0;return g(o,function(i){"object"!==(void 0===i?"undefined":n(i))||l(i)||g(Object.keys(i),function(o){s=e[o],(a=i[o])===e||("object"!==(void 0===a?"undefined":n(a))||null===a||a._data?e[o]=a:l(a)?e[o]=b(a):y(a)?e[o]=_(a):"object"!==(void 0===s?"undefined":n(s))||null===s||l(s)?e[o]=t({},a):r&&d(a)?e[o]={}:e[o]=t(s,a,r))})}),e},w=(e.merge=function(t){var e=Array.prototype.slice.call(arguments,1);return g(e,function(e,i){g(e,function(i,n){e.hasOwnProperty(n)&&(t.hasOwnProperty(n)?(l(t[n])||(t[n]=[t[n]]),t[n].push(i)):t[n]=i)})}),t},e.clone=function(t,e,i){if(l(t))return t.slice(0);var n={};return g(t,function(r,o){e&&-1===e.indexOf(o)||i&&-1!==i.indexOf(o)||t.hasOwnProperty(o)&&(n[o]=r)}),n},e.deepClone=function t(e){var i={};return l(e)&&(i=[]),g(e,function(e,n){u(e)||l(e)?i[n]=t(e):i[n]=e}),i},e.without=function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},e.unique=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},i={};return t.filter(function(t){var n=e(t);return!i.hasOwnProperty(n)&&(i[n]=1,!0)})},e.uniqueLast=function(t,e){var i={},n=[];e||(e=function(t){return t});for(var r=0,o=t.length;r<o;r+=1){var a=e(t[r]);i.hasOwnProperty(a)&&n.splice(i[a],1),n.push(t[r]),i[a]=n.length-1}return n},e.find=function(t,e){var i=void 0;return g(t,function(t){if(e(t))return i=t,!1}),i},e.filter=function(t,e){for(var i=-1,n=t.length,r=-1,o=[],a=Object.keys(e),s=a.length,l=void 0,u=void 0;(i+=1)<n;){var c=t[i],h=!0;for(l=0;l<s;l+=1)if(u=a[l],!c.hasOwnProperty(u)||c[u]!==e[u]){h=!1;break}h&&(o[r+=1]=c)}return o},e.filterAny=function(t,e,i){for(var n=-1,r=t.length,o=-1,a=[],s=Object.keys(e),l=s.length,u=void 0,c=void 0;(n+=1)<r;){var h=t[n],d=!0;for(u=0;u<l;u+=1)if(c=s[u],!h.hasOwnProperty(c)||!w(h[c],e[c],i)){d=!1;break}d&&(a[o+=1]=h)}return a},e.matchAny=function(t,e,i){l(t)||(t=[t]),i||(i="*");for(var n=!1,r=0;r<t.length;r++){var o=t[r];if(!l(e)&&o==e){n=!0;break}if(l(e)){for(var a=-1,s=0;s<e.length;s++){var u=e[s];if(!(l(u)||u!=o&&u!==i)){a=s;break}if(l(u)){var c=u[0],h=u[1]||c;if(o>=c&&o<=h){a=s;break}}}if(-1!==a){n=!0;break}}}return n}),S=(e.preventAncestorScrolling=function(t){var e=!1;t.on("mousewheel",function(i,n){var r=this.scrollTop,o=this.scrollHeight,a=t.node().offsetHeight,s=d3.event.wheelDelta,l=s>0,u=function(t){return function(){var e=this,i=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=i(t)}}};if(l?l&&(s>r&&r>0?(t.transition().delay(0).duration(0).tween("scrolltween",u(0)),e=!0,setTimeout(function(){e=!1},2e3)):o==a+r&&(e=!1)):-s>o-a-r&&o!=a+r?(t.transition().delay(0).duration(0).tween("scrolltween",u(o)),e=!0,setTimeout(function(){e=!1},2e3)):0==r&&(e=!1),e)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1})},e.radiusToArea=function(t){return t*t*Math.PI},e.hypotenuse=function(t,e){return Math.sqrt(t*t+e*e)},e.cathetus=function(t,e){return Math.sqrt(t*t-e*e)},e.areaToRadius=function(t){return Math.sqrt(t/Math.PI)},e.timeStamp=function(t){console&&"function"==typeof console.timeStamp&&console.timeStamp(t)},e.warn=function(t){return t=Array.prototype.slice.call(arguments).map(function(t){return t instanceof Object?JSON.stringify(t,null,4):t}).join(" "),console&&"function"==typeof console.warn&&console.warn(t),!0}),M=(e.groupCollapsed=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(t)},e.groupEnd=function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},e.error=function(t){console&&"function"==typeof console.error&&(t.stack?console.error(t.stack):console.error(t),arguments.length>1&&console.error.apply(this,Array.prototype.slice.call(arguments,1)))},e.countDecimals=function(t){return Math.floor(t.valueOf())===t.valueOf()?0:t.toString().split(".")[1].length||0},e.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e}),E=e.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},z=(e.classed=function(t,e,i){if(!0===i)M(t,e);else{if(!1!==i)return z(t,e);E(t,e)}},e.hasClass=function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}),k=(e.throttle=function(t,e){var i=!1,n=void 0,r=void 0,o=void 0,a=function(){i&&(i=!1,t.apply(r,n))},s=function(){if(o>Date.now())return i=!0,n=arguments,void(r=this);o=Date.now()+e,i=!1,t.apply(this,arguments),setTimeout(function(){a()},e)};return s.recallLast=a,s},e.keys=function(t){return Object.keys(t)},e.values=function(t){for(var e=[],i=Object.keys(t),n=i.length,r=0;r<n;r+=1)e.push(t[i[r]]);return e},e.arrayMin=function(t){return t.reduce(function(t,e){return t<e?t:e})},e.arrayMax=function(t){return t.reduce(function(t,e){return t>e?t:e})},e.arrayMean=function(t){return k(t)/t.length},e.arraySum=function(t){return t.reduce(function(t,e){return t+e})}),T=(e.arrayMedian=function(t){t=t.sort(function(t,e){return t-e});var e=Math.floor((t.length-1)/2);return t.length%2?t[e]:(t[e]+t[e+1])/2},e.arrayLast=function(t){return t.length?t[t.length-1]:null},e.diffObject=function t(e,i){var n={};return g(i,function(i,r){!e.hasOwnProperty(r)&&p(i)&&(n[r]=t({},i))}),g(e,function(e,r){if(i.hasOwnProperty(r)){if(e!==i[r])if(p(e)&&p(i[r]))if(d(e))d(i[r])||(n[r]={});else{var o=t(e,i[r]);Object.keys(o).length>0&&(n[r]=o)}else l(e)&&l(i[r])&&m(e,i[r])||(n[r]=e)}else n[r]=e}),n},e.defer=function(t){setTimeout(t,1)},e.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.clearDelay=function(t){return clearTimeout(t)},e.hashCode=function(t){c(t)||(t=JSON.stringify(t));var e=0,i=t.length;if(0===i)return e;for(var n=0;n<i;n+=1)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e.toString()},e.nestArrayToObj=function t(e){if(!e||!e.length||!e[0].key)return e;for(var i={},n=0;n<e.length;n++)i[e[n].key]=t(e[n].values);return i},e.nestArrayToObjWithFlatKeys=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e||!e.length||!e[0].key)return n?(!i[n+="]"]&&(i[n]={}),i[n][r]=e):i[r]=e,e;r&&(n=n?n+","+JSON.stringify(r):"["+JSON.stringify(r));for(var o=0;o<e.length;o++)t(e[o].values||e[o].value,i,n,e[o].key);return i},e.nestArrayToValues=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e&&e.length&&e[0].key){for(var n=0;n<e.length;n++)t(e[n].values||e[n].value,i);return i}i.push.apply(i,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(e))},e.interpolateVector=function(){},e.interpolatePoint=function(t,e,i,n,r,o,s,l){if(!t||0===t.length)return S("interpolatePoint failed because incoming array is empty. It was "+i),null;if("constant"===e)return i;if("property"===e)return t[0][i];if(l){if(o-t[0][r]<=0)return t[0][i];if(o-t[t.length-1][r]>=0)return t[t.length-1][i]}else if(o<t[0][r]||o>t[t.length-1][r])return null;if(n||0===n||(n=d3.bisectLeft(t.map(function(t){return t[r]}),o)),0===n)return t[0][i];if(void 0===t[n]||null===t[n][i]||null===t[n-1][i]||""===t[n][i])return S("interpolatePoint failed because next/previous points are bad in "+i),null;var u=a.default[s||"linear"](t[n-1][r],t[n][r],t[n-1][i],t[n][i],o);return i===r&&(u=new Date(u)),h(u)&&(S("interpolatePoint failed because result is NaN. It was "+i),u=null),u},e.ajax=function(t){var e=new XMLHttpRequest;e.open(t.method,t.url,!0),"POST"!==t.method||t.json?"POST"===t.method&&t.json&&e.setRequestHeader("Content-Type","application/json; charset=UTF-8"):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){var i=t.json?JSON.parse(e.responseText):e.responseText;t.success&&t.success(i)}else t.error&&t.error()},e.onerror=function(){t.error&&t.error()},e.send(t.data)});e.get=function(t,e,i,n,r){g(e=e||[],function(t,i){e.push(i+"="+t)}),t=e.length?t+"?"+e.join("&"):t,T({method:"GET",url:t,success:i,error:n,json:r})},e.post=function(t,e,i,n,r){T({method:"POST",url:t,success:i,error:n,json:r,data:e})},e.memoize=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),i="",n=e.length,r=null;n--;)i+=(r=e[n])===Object(r)?JSON.stringify(r):r,t.memoize||(t.memoize={});return i in t.memoize?t.memoize[i]:t.memoize[i]=t.apply(this,e)}},e.debounce=function(t,e,i){var n=void 0;return function(){var r=this,o=arguments,a=i&&!n;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(r,o)},e),a&&t.apply(r,o)}},e.isTouchDevice=function(){return null!=((d3.event||{}).sourceCapabilities||{}).firesTouchEvents?d3.event.sourceCapabilities.firesTouchEvents:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},e.pruneTree=function t(e,i){var n={},r=[];return e.hasOwnProperty("children")&&(r=e.children.map(function(e){return t(e,i)}).filter(function(t){return 0!==Object.keys(t).length})),(0!=r.length||i(e))&&g(e,function(t,e){n[e]=t}),0!=r.length&&(n.children=r),n},e.setIcon=function(t,e){return t.selectAll("*").remove(),t.node().appendChild(t.node().ownerDocument.importNode((new DOMParser).parseFromString(e,"application/xml").documentElement,!0)),t};e.capitalize=function(t){return t.slice(0,1).toUpperCase()+t.slice(1).toLowerCase()},e.isMobileOrTablet=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))};e.isFunction=function(t){return"function"==typeof t},e.getProp=function(t,e,i){for(;e.length;){var n=e.shift();if(!t.hasOwnProperty(n))return i;t=t[n]}return t},e.px2num=function(t){return c(t)&&t.endsWith("px")?parseFloat(t):console.warn("Strange pixels value: "+t)||t},e.replaceNumberSpacesToNonBreak=function(t){return t?t.replace(/\d{1,3}(?: \d{3})+(?=\W)/g,function(t){return t.replace(/ /g,"")}):t},e.getSubtitle=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],i=t.replace(e,"");","===i[0]&&(i=i.slice(1));var n=/^\((.*)\)$|.*/.exec(i.trim());return n[1]||n[0]||""},e.getBrowserDetails=function(){navigator.appVersion;var t=navigator.userAgent,e=navigator.appName,i=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10),r=void 0,o=void 0,a=void 0,s=navigator.userAgent.toLowerCase().indexOf(" electron/")>-1;return-1!=(o=t.indexOf("Opera"))?(e="Opera",i=t.substring(o+6),-1!=(o=t.indexOf("Version"))&&(i=t.substring(o+8))):-1!=(o=t.indexOf("MSIE"))?(e="Microsoft Internet Explorer",i=t.substring(o+5)):-1!=(o=t.indexOf("Chrome"))?(e="Chrome",i=t.substring(o+7)):-1!=(o=t.indexOf("Safari"))?(e="Safari",i=t.substring(o+7),-1!=(o=t.indexOf("Version"))&&(i=t.substring(o+8))):-1!=(o=t.indexOf("Firefox"))?(e="Firefox",i=t.substring(o+8)):(r=t.lastIndexOf(" ")+1)<(o=t.lastIndexOf("/"))&&(e=t.substring(r,o),i=t.substring(o+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),-1!=(a=i.indexOf(";"))&&(i=i.substring(0,a)),-1!=(a=i.indexOf(" "))&&(i=i.substring(0,a)),n=parseInt(""+i,10),h(n)&&(i=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10)),(s?"Electron ":"")+e+" "+n+" ("+i+")"},e.getOSname=function(){var t="Unknown";return-1!=window.navigator.userAgent.indexOf("Windows NT 10.0")&&(t="Windows 10"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(t="Windows 8"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(t="Windows 7"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(t="Windows Vista"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(t="Windows XP"),-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(t="Windows 2000"),-1!=window.navigator.userAgent.indexOf("Mac")&&(t="Mac/iOS"),-1!=window.navigator.userAgent.indexOf("X11")&&(t="UNIX"),-1!=window.navigator.userAgent.indexOf("Linux")&&(t="Linux"),t}},function(t,e,i){var n=i(5);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=l(i(49)),o=l(i(48)),a=l(i(110)),s=i(21);function l(t){return t&&t.__esModule?t:{default:t}}var u={},c=r.default.extend({init:function(t,e){if(this._id=this._id||n.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||t.name||this._id,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||t.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!n.isElement(this.placeholder))try{this.placeholder=e.placeholder.querySelector(this.placeholder)}catch(t){n.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=e||null,this.root=this.parent?this.parent.root:this,this.components=this.components||[],this._components_config=this.components.map(function(t){return n.clone(t)}),this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.createModel(t.model),this.ui=this.model.ui||this.ui||t.ui,this._super(),this.registerListeners()},createModel:function(t){this.model=this._modelMapping(t)},registerListeners:function(){this.on({readyOnce:this.readyOnce,ready:this.ready,domReady:this.domReady,resize:this.resize})},startPreload:function(){var t=[];return t.push(this.preload()),n.forEach(this.components,function(e){return t.push(e.startPreload())}),Promise.all(t)},preload:function(){return Promise.resolve()},afterPreload:function(){this.model&&this.model.afterPreload(),n.forEach(this.components,function(t){t.afterPreload()})},render:function(){this.prerender(),this.postrender()},prerender:function(){this.loadTemplate(),this.loadSubComponents()},postrender:function(){var t=this;n.forEach(this.components,function(e){e.render(),t.on("resize",function(){e.trigger("resize")})}),this.startLoading()},startLoading:function(){var t=this;this.model.on("ready",function(){t.loadingDone()}),this.model&&this.model.isLoading()||this.loadingDone()},loadingDone:function(){n.removeClass(this.placeholder,"vzb-loading-first"),n.removeClass(this.placeholder,"vzb-loading-data"),this.setReady()},renderError:function(t){var e=this;if(!t)return n.warn("renderError() was called without any specific error. Not rendering anything then.");if(n.hasClass(this.placeholder,"vzb-error"))return n.warn("The app is already showing error dialog. Not rendering again.");n.removeClass(this.placeholder,"vzb-loading-first"),n.removeClass(this.placeholder,"vzb-loading-data"),n.addClass(this.placeholder,"vzb-error");var i=this.model._root.locale.getTFunction(),r="mailto:angie@gapminder.org?subject=Gapminder Vizabi error report&body=Hi Angie! Please have a look at this! %0D%0A %0D%0A %0D%0A\n      These are the steps to reproduce the error: %0D%0A \n      1. Go to "+window.location.origin+" %0D%0A \n      2. %5Bplease write here what you did%5D %0D%0A %0D%0A %0D%0A"+encodeURIComponent(JSON.stringify(t,null,4));this.errorMessageEl.classed("vzb-hidden",!1);var o=this.errorMessageEl.select(".vzb-error-message-technical").html(JSON.stringify(t,null,2));this.errorMessageEl.select(".vzb-error-message-expand").on("click",function(){return o.classed("vzb-hidden",!o.classed("vzb-hidden"))}).html(i("crash/expand")),this.errorMessageEl.select(".vzb-error-message-close").on("click",function(){e.errorMessageEl.classed("vzb-hidden",!0),n.removeClass(e.placeholder,"vzb-error")}),this.errorMessageEl.select(".vzb-error-message-title").select("h1").html(t.icon||"");var a="crash/intro",s="crash/outro",l={};i(t.name)!==t.name&&(a="reader/error/generic",s=t.name,"reader/error/wrongTimeUnitsOrColumn"===t.name&&(l={expected:this.model._root.state.time.getFormatter()(new Date),found:t.details}),"reader/error/repeatedKeys"===t.name&&(l=t.details),"reader/error/undefinedDelimiter"===t.name&&(l={file:t.endpoint})),this.errorMessageEl.select(".vzb-error-message-intro").html(i(a,l).replace("mailto",r)),this.errorMessageEl.select(".vzb-error-message-outro").html(i(s,l).replace("mailto",r)),n.error(JSON.stringify(t,null,2))},setReady:function(t){this._readyOnce||(this.trigger("readyOnce"),this._readyOnce=!0),this._ready=!0,this.trigger("ready")},loadTemplate:function(){var t=this.template,e=this.template_data,i="";if(this.placeholder){if(e=n.extend(e,{t:this.getTranslationFunction(!0)}),this.template)try{i=function t(e,i){var n=/<[a-z][\s\S]*>/i.test(e)?function(t){return e.replace(/<%=([^%]*)%>/g,function(e){var i=e.match(/t\s*\(([^)]+)\)/g);return i.length?i=t.t(i[0].match(/"([^"]+)"/g)[0].split('"').join("")):(i=e.match(/([a-z\-A-Z]+([a-z\-A-Z0-9]?[a-zA-Z0-9]?)?)/g)[0],i=t[i]||i),i})}:u[e]=u[e]||t(a.default.templates[e]);return i?n(i):n}(t,e)}catch(t){var r=new Error;r.name="template",r.message="Templating error for component. Check if template name is unique and correct",r.details=this.name,this.renderError(r)}n.addClass(this.placeholder,"vzb-loading-data"),n.addClass(this.placeholder,"vzb-loading-first"),this.placeholder.innerHTML=i,this.element=this.placeholder.children[0],this.errorMessageEl=d3.select(this.element).append("div").attr("class","vzb-error-message vzb-hidden").html('\n        <div class="vzb-error-message-background"></div>\n        <div class="vzb-error-message-box">\n          <div class="vzb-error-message-close">'+s.close+'</div>\n          <div class="vzb-error-message-title"><h1></h1></div>\n          <div class="vzb-error-message-body">\n            <p class="vzb-error-message-intro"></p>\n            <br>\n            <p class="vzb-error-message-expand"></p>\n            <textarea class="vzb-error-message-technical vzb-hidden"></textarea>\n            <br>\n            <p class="vzb-error-message-outro"></p>\n          </div>\n        </div>\n      '),this.trigger("domReady")}},getActiveProfile:function(t,e){var i=this.getLayoutProfile(),r=this.getPresentationMode(),o=n.deepClone(t[i]);return r&&(e||{})[i]&&n.deepExtend(o,e[i]),o},loadSubComponents:function(){var t=this,e=void 0,i=void 0;this.components=[],n.forEach(this._components_config,function(r){if(r.model=r.model||{},r.component){if(i=n.isString(r.component)?c.get(r.component):r.component){e=n.extend(r,{name:r.component,ui:t._uiMapping(r.placeholder,r.ui)});var o=new i(e,t);t.components.push(o)}}else n.error("Error loading component: name not provided")})},findChildByName:function(t){return n.find(this.components,function(e){return e.name===t})},getLayoutProfile:function(){return this.model.ui?this.model.ui.currentProfile():this.parent.getLayoutProfile()},getPresentationMode:function(){return this.model.ui?this.model.ui.getPresentationMode():this.parent.getPresentationMode()},_uiMapping:function(t,e){if(e)return new o.default("ui",e);if(t&&this.ui){t=t.replace(".","");var i=this.ui[t];if(i)return i}return this.ui},_modelMapping:function(t){var e=this,i={};if(n.isArray(t)&&n.isArray(this.model_expects)){this.model_expects.length!==t.length&&(n.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),n.warn("Please, configure the 'model_expects' attribute accordingly in '"+this.name+"' or check the models passed in '"+e.parent.name+"'.\n\nComponent: '"+e.parent.name+"'\nSubcomponent: '"+this.name+"'\nNumber of Models Expected: "+this.model_expects.length+"\nNumber of Models Received: "+t.length),n.groupEnd()),n.forEach(t,function(r,o){if(r){var a=function(t){var i=t.split("."),n=e.parent.model,r="";for(;i.length;)r=i.shift(),n=n[r];return{name:t,model:n,type:n?n.getType():null}}(r),s=void 0;e.model_expects[o]?(s=e.model_expects[o].name,!e.model_expects[o].type||a.type===e.model_expects[o].type||n.isArray(e.model_expects[o].type)&&-1!==e.model_expects[o].type.indexOf(a.type)||(n.groupCollapsed("UNEXPECTED MODEL TYPE: '"+a.type+"' instead of '"+e.model_expects[o].type+"'"),n.warn("Please, configure the 'model_expects' attribute accordingly in '"+e.name+"' or check the models passed in '"+e.parent.name+"'.\n\nComponent: '"+e.parent.name+"'\nSubcomponent: '"+e.name+"'\nExpected Model: '"+e.model_expects[o].type+"'\nReceived Model: '"+a.type+"'\nModel order: "+o),n.groupEnd())):(n.groupCollapsed("UNEXPECTED MODEL: '"+t[o]+"'"),n.warn("Please, configure the 'model_expects' attribute accordingly in '"+e.name+"' or check the models passed in '"+e.parent.name+"'.\n\nComponent: '"+e.parent.name+"'\nSubcomponent: '"+e.name+"'\nNumber of Models Expected: "+e.model_expects.length+"\nNumber of Models Received: "+t.length),n.groupEnd(),s=a.name),i[s]=a.model}});var r=t.length,a=this.model_expects.length;return a>r&&(this.model_expects.splice(0,r),n.forEach(a,function(t){i[t.name]={}})),new o.default(this.name,i,null,this.model_binds)}},getTranslationFunction:function(t){var e=void 0;try{e=this.model.get("locale").getTFunction()}catch(t){this.parent&&this.parent!==this&&(e=this.parent.getTranslationFunction())}return e||(e=function(t){return t}),t?this._translatedStringFunction(e):e},_translatedStringFunction:function(t){return function(e){return'<span data-vzb-translate="'+e+'">'+t(e)+"</span>"}},translateStrings:function(){var t=this.getTranslationFunction(),e=this.placeholder.querySelectorAll("[data-vzb-translate]");0!==e.length&&n.forEach(e,function(e){e&&e.getAttribute&&(e.innerHTML=t(e.getAttribute("data-vzb-translate")))})},readyOnce:function(){},ready:function(){},resize:function(){},domReady:function(){},clear:function(){this.freeze(),this.model&&this.model.freeze(),n.forEach(this.components,function(t){t.clear()})}});c.isComponent=function(t){return t._id&&("t"===t._id[0]||"c"===t._id[0])},e.default=c},function(t,e,i){var n=i(61)("wks"),r=i(38),o=i(3).Symbol,a="function"==typeof o;(t.exports=function(t){return n[t]||(n[t]=a&&o[t]||(a?o:r)("Symbol."+t))}).store=n},function(t,e,i){t.exports=!i(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(2),r=i(113),o=i(26),a=Object.defineProperty;e.f=i(8)?Object.defineProperty:function(t,e,i){if(n(t),e=o(e,!0),n(i),r)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var n=i(28),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(27);t.exports=function(t){return Object(n(t))}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=a(i(6)),o=i(21);function a(t){return t&&t.__esModule?t:{default:t}}var s=(0,a(i(106)).default)(i(405)),l=r.default.extend({isDialog:!0,init:function(t,e){this.name=this.name||"",this.model_expects=this.model_expects||[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this.template=s[this.name],this._super(t,e),this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"]},readyOnce:function(){this.element=d3.select(this.element),this.titleEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-title"),this.buttonsEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-buttons"),this.contentEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-content")},ready:function(){var t=this;this.placeholderEl=d3.select(this.placeholder),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.dragHandler=this.placeholderEl.select("[data-click='dragDialog']"),this.dragHandler.html(o.drag),this.pinIcon=this.placeholderEl.select("[data-click='pinDialog']"),this.pinIcon.html(o.pin),this.topPos="";var e,i,r,a,s,l,u,c,h,d,f,p,m,v,g,y,_,b=this.getLayoutProfile(),x=(e=this.placeholderEl,i=this.rootEl,r=10,a=void 0,s=void 0,l=void 0,u=void 0,c=void 0,h=void 0,d=void 0,f=void 0,p=void 0,m=void 0,v=void 0,g=void 0,y=void 0,_=void 0,{move:function(t,i){e.style("right",t+"px"),e.style("top",i+"px")},dragStart:function(t){if(n.isTouchDevice()){var o=d3.touches(i.node());a=o[0][0],s=o[0][1]}else a=t.sourceEvent.clientX,s=t.sourceEvent.clientY;l=parseInt(e.style("top"))||0,u=parseInt(e.style("right"))||0,h=parseInt(e.style("margin-left"))||0,c=parseInt(e.style("margin-right"))||0,f=Math.min(r,h),d=Math.min(r,c),p=parseInt(e.style("width"),10)+h-f||0,m=parseInt(e.style("height"),10)||0,v=parseInt(i.style("width"),10)-c||0,g=parseInt(i.style("height"),10)||0,y=a+u,_=s-l},drag:function(t){if(n.isTouchDevice()){var e=d3.touches(i.node());a=e[0][0],s=e[0][1]}else a=t.sourceEvent.clientX,s=t.sourceEvent.clientY;var r=-a+y,o=s-_;r<-d&&(r=-d),o<0&&(o=0),r+p>v&&(r=v-p),o+m>g&&(o=g-m),this.move(r,o)}}),w=d3.drag().on("start",function(){var e=t.placeholderEl.node().offsetTop;t.placeholderEl.style("top",e+"px"),t.placeholderEl.style("bottom","auto"),t.trigger("dragstart"),x.dragStart(d3.event)}).on("drag",function(){t.trigger("drag"),x.drag(d3.event)}).on("end",function(){t.rightPos=t.placeholderEl.style("right"),t.topPos=t.placeholderEl.style("top"),t.trigger("dragend")});this.dragHandler.call(w),this.dragHandler.classed("vzb-hidden","small"===b),this.pinIcon.classed("vzb-hidden","small"===b),this.resize()},resize:function(){if(this.placeholderEl&&this.rootEl&&this.placeholderEl.classed("vzb-top-dialog")){this.placeholderEl.classed("notransition",!0);var t=this.getLayoutProfile();if("small"!==t){var e=parseInt(this.rootEl.style("width"),10)||0,i=parseInt(this.rootEl.style("height"),10)||0,r=parseInt(this.placeholderEl.style("width"),10)||0,o=parseInt(this.placeholderEl.style("height"),10)||0,a=parseInt(this.rightPos,10),s=parseInt(this.topPos,10),l=parseInt(this.placeholderEl.style("margin-right"),10)||0;n.isNumber(a)&&a>e-r-l&&this.rightPos&&(this.rightPos=e-r-l+"px",this.isOpen&&this.placeholderEl.style("right",this.rightPos)),n.isNumber(s)&&n.isNumber(o)&&s>=0&&s>i-o&&this.topPos&&(this.topPos=(i-o>0?i-o:0)+"px",this.isOpen&&this.placeholderEl.style("top",this.topPos)),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style("bottom","auto"),this.rootEl.classed("vzb-landscape"),this.element.style("max-height","")}else this.rightPos="",this.topPos="",this.placeholderEl.attr("style","");this.dragHandler.classed("vzb-hidden","small"===t),this.pinIcon.classed("vzb-hidden","small"===t),this._setMaxHeight()}},_setMaxHeight:function(){var t=this.root.element.offsetHeight;"small"!==this.getLayoutProfile()?!this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")?t-=parseInt(this.placeholderEl.style("bottom"),10):t-=this.topPos?parseInt(this.topPos,10):this.placeholderEl.node().offsetTop:t=this.rootEl.classed("vzb-portrait")?t-50:t-10;this.element.style("max-height",t+"px");var e=t-this.titleEl.node().offsetHeight-this.buttonsEl.node().offsetHeight;this.contentEl.style("max-height",e+"px")},beforeOpen:function(){var t=this;if(this.transitionEvents.forEach(function(e){t.placeholderEl.on(e,t.transitionEnd.bind(t,e))}),this.placeholderEl.classed("notransition",!0),this.placeholderEl.style("top",""),this.placeholderEl.style("bottom",""),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=this.placeholderEl.node().offsetTop;this.placeholderEl.style("top",e+"px"),this.placeholderEl.style("bottom","auto")}else this.getLayoutProfile();this.placeholderEl.node().offsetTop,this.placeholderEl.classed("notransition",!1),"small"===this.getLayoutProfile()?this.placeholderEl.style("top",""):this.rootEl.classed("vzb-landscape")},open:function(){this.isOpen=!0,"small"!==this.getLayoutProfile()&&this.topPos&&(this.placeholderEl.style("top",this.topPos),this.placeholderEl.style("right",this.rightPos))},beforeClose:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()&&this.placeholderEl.style("top","auto"),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.placeholderEl.node().parentNode.offsetHeight-this.placeholderEl.node().offsetHeight+"px":""),this.placeholderEl.classed("notransition",!1),this.placeholderEl.node().offsetHeight},close:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()||(this.placeholderEl.style("top",""),this.placeholderEl.style("right","")),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.placeholderEl.style("top",this.topPos0),this.placeholderEl.style("right","")),this.isOpen=!1,this.trigger("close")},transitionEnd:function(t){var e=this;this.transitionEvents.forEach(function(t){e.placeholderEl.on(t,null)}),this.isOpen&&this.placeholderEl.classed("notransition",!0)}});e.default=l},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var n=i(9),r=i(37);t.exports=i(8)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var n=i(3),r=i(14),o=i(17),a=i(38)("src"),s=Function.toString,l=(""+s).split("toString");i(25).inspectSource=function(t){return s.call(t)},(t.exports=function(t,e,i,s){var u="function"==typeof i;u&&(o(i,"name")||r(i,"name",e)),t[e]!==i&&(u&&(o(i,a)||r(i,a,t[e]?""+t[e]:l.join(String(e)))),t===n?t[e]=i:s?t[e]?t[e]=i:r(t,e,i):(delete t[e],r(t,e,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||s.call(this)})},function(t,e,i){var n=i(0),r=i(4),o=i(27),a=/"/g,s=function(t,e,i,n){var r=String(o(t)),s="<"+e;return""!==i&&(s+=" "+i+'="'+String(n).replace(a,"&quot;")+'"'),s+">"+r+"</"+e+">"};t.exports=function(t,e){var i={};i[t]=e(s),n(n.P+n.F*r(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",i)}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){var n=i(56),r=i(27);t.exports=function(t){return n(r(t))}},function(t,e,i){var n=i(57),r=i(37),o=i(18),a=i(26),s=i(17),l=i(113),u=Object.getOwnPropertyDescriptor;e.f=i(8)?u:function(t,e){if(t=o(t),e=a(e,!0),l)try{return u(t,e)}catch(t){}if(s(t,e))return r(!n.f.call(t,e),t[e])}},function(t,e,i){var n=i(17),r=i(11),o=i(81)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.paintbrush='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',e.search='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.circle='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',e.expand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',e.asterisk='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',e.trails='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',e.lock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',e.unlock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',e.unexpand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',e.axes='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',e.gear='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',e.stack='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',e.drag='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',e.warn='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',e.pin='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',e.question='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',e.close='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',e.presentation='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',e.about='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',e.cursorArrow='<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',e.cursorPlus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.cursorMinus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.hundredPercent='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',e.percent='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',e.side='<svg class="vzb-icon" viewBox="-120 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="rotate(-90) scale(1.2)" d="M1024 448q0 -26 -19 -45l-448 -448q-19 -19 -45 -19t-45 19l-448 448q-19 19 -19 45t19 45t45 19h896q26 0 45 -19t19 -45zM1024 832q0 -26 -19 -45t-45 -19h-896q-26 0 -45 19t-19 45t19 45l448 448q19 19 45 19t45 -19l448 -448q19 -19 19 -45z"/></svg>',e.cursorHand='<svg class="vzb-icon" viewBox="0 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="scale(1,-1)" d="M880 1408q-46 0 -79 -33t-33 -79v-656h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528v-256l-154 205q-38 51 -102 51q-53 0 -90.5 -37.5t-37.5 -90.5q0 -43 26 -77l384 -512q38 -51 102 -51h688q34 0 61 22t34 56l76 405q5 32 5 59v498q0 46 -33 79t-79 33t-79 -33t-33 -79v-272h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528h-32v656q0 46 -33 79t-79 33zM880 1536q68 0 125.5 -35.5t88.5 -96.5q19 4 42 4q99 0 169.5 -70.5t70.5 -169.5v-17q105 6 180.5 -64t75.5 -175v-498q0 -40 -8 -83l-76 -404q-14 -79 -76.5 -131t-143.5 -52h-688q-60 0 -114.5 27.5t-90.5 74.5l-384 512q-51 68 -51 154q0 106 75 181t181 75q78 0 128 -34v434q0 99 70.5 169.5t169.5 70.5q23 0 42 -4q31 61 88.5 96.5t125.5 35.5z"/></svg>'},function(t,e,i){var n=i(13);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){"use strict";var n=i(4);t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e){var i=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=i)},function(t,e,i){var n=i(5);t.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:i)(t)}},function(t,e,i){var n=i(0),r=i(25),o=i(4);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],a={};a[t]=e(i),n(n.S+n.F*o(function(){i(1)}),"Object",a)}},function(t,e,i){var n=i(22),r=i(56),o=i(11),a=i(10),s=i(98);t.exports=function(t,e){var i=1==t,l=2==t,u=3==t,c=4==t,h=6==t,d=5==t||h,f=e||s;return function(e,s,p){for(var m,v,g=o(e),y=r(g),_=n(s,p,3),b=a(y.length),x=0,w=i?f(e,b):l?f(e,0):void 0;b>x;x++)if((d||x in y)&&(v=_(m=y[x],x,g),t))if(i)w[x]=v;else if(v)switch(t){case 3:return!0;case 5:return m;case 6:return x;case 2:w.push(m)}else if(c)return!1;return h?-1:u||c?c:w}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=!1,o=/xyz/.test(function(){})?/\b_super\b/:/.*/;var a=function(){};a.extend=function t(e,i){i=1===arguments.length?e:i;var a=this.prototype;r=!0;var s=new this;function l(){this.trackInstances&&l.instances.push(this),!r&&this.init&&this.init.apply(this,arguments)}return r=!1,(0,n.forEach)(i,function(t,e){"function"==typeof i[e]&&"function"==typeof a[e]&&o.test(i[e])?s[e]=function(t,e){return function(){var i=this._super;this._super=a[t];var n=e.apply(this,arguments);return this._super=i,n}}(e,i[e]):s[e]=t}),l.prototype=s,l.prototype.constructor=l,l.extend=t,l._collection={},l.instances=[],l.register=function(t,e){void 0!==this._collection[t]&&(0,n.warn)('"'+t+'" is already registered. Overwriting...'),this._collection[t]=e},l.unregister=function(t){this._collection[t]=void 0},l.getCollection=function(){return this._collection},l.define=function(t,e){this.prototype[t]=e},l.get=function(t,e){return this._collection.hasOwnProperty(t)?this._collection[t]:(e||(0,n.warn)('"'+t+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(e,l),l},e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=a(i(55));a(i(49));function a(t){return t&&t.__esModule?t:{default:t}}var s=o.default.extend({_important:!1,objectLeafs:["autoconfig"],dataConnectedChildren:["use","which"],getClassDefaults:function(){return r.deepExtend(this._super(),{data:"data",which:null})},buildScale:function(){},setInterModelListeners:function(){var t=this,e=this._parent.getSpace(this);r.forEach(e,function(e){t._space[e]=t.getClosestModel(e),t._space[e].on("dataConnectedChange",t.handleDataConnectedChange.bind(t))}),this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},onSuccessfullLoad:function(){this.validate(),this.buildScale(),this._super()},setWhich:function(t){var e={which:t.concept};t.dataSource&&(e.data=t.dataSource);var i=this.getClosestModel(e.data||this.data).getConceptprops(t.concept);t.use&&(e.use=t.use),i&&i.scales&&(e.scaleType=i.scales[0]),"axis"!==this.getType()&&"size"!==this.getType()||(e.domainMin=null,e.domainMax=null,e.zoomedMin=null,e.zoomedMax=null),"property"===t.use&&t.key&&1===t.key.length&&(e.spaceRef=r.find(this._space,function(e){return e.dim===t.key[0].concept})._name),"constant"!==t.use&&"indicator"!==t.use||(e.spaceRef=null),this.set(e,void 0,void 0,void 0,this.setWhich),this._root.trigger("change_hook_which",{which:e.which,hook:this._name})},setScaleType:function(t){this.buildScale(t)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data),this._super()},afterPreload:function(){this.autoconfigureModel(),this.spaceRef||(this.spaceRef=this.updateSpaceReference())},autoconfigureModel:function(t){if(!this.which&&this.autoconfig){if(t||(t=this._parent.getAvailableConcept(this.autoconfig)),t){var e=t.value,i={which:e.concept,use:(t.key.size||t.key.length)>1||"time"===this.autoconfig.type?"indicator":"property",scaleType:e.scales[0]||"linear"};this.set(i)}else{this.set({which:"_default",use:"constant",scaleType:"ordinal"})}r.printAutoconfigResult(this)}},updateSpaceReference:function(){if("property"!==this.use)return null;var t="entities"+this._name.replace(this._type,"");return this._space[t]?t:this._parent.getSpace()[0]._name},loadData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.which||"constant"===this.use)return Promise.resolve();this.trigger("hook_change"),this.dataSource=this.getClosestModel(this.data);var e=this.getQuery(t.splashScreen);if(!0===e)return Promise.resolve();this._loadCall=!0,this.setReady(!1),r.timeStamp("Vizabi Model: Loading Data: "+this._id);var i=this._getAllParsers(),n=this.dataSource.load(e,i);return n.then(this.afterLoad.bind(this),function(t){return r.warn("Problem with query: ",t,JSON.stringify(e))}),n},handleDataConnectedChange:function(t){var e=this;r.defer(function(){e.startLoading().catch(r.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},afterLoad:function(t){this._dataId=t,r.timeStamp("Vizabi Model: Data loaded: "+this._id)},getQuery:function(t){var e=void 0;if(Object.keys(this._space).length<1)return r.error("Error:",this._id,"can't find the space"),!0;var i="property"===this.use||"constant"===this.use,n=i?{exceptType:"time"}:{},o=r.unique(this._getAllDimensions(n)),a="property"===this.use&&o.length>1?[-1!==o.indexOf(this.which)?this.which:this.getEntity().dim]:o;if(!a||!a.length)return r.warn("getQuery() produced no query because no keys are available"),!0;var s={key:a,value:-1!=a.indexOf(this.which)||"constant"===this.use?[]:[this.which]},l=this._getFirstDimension({type:"time"}),u=i?"entities":"datapoints";if(e=this._getAllFilters(n,{splash:t,entityTypeRequest:i}),i&&o.length>1){var c={};e[a]&&(c[a]=e[a]),e=c}var h={};if(Object.keys(e).length>0)for(var d in h.$and=[],e){var f={};f[d]=e[d],h.$and.push(f)}var p=this._getAllJoins(n,{splash:t,entityTypeRequest:i});if(i&&o.length>1){var m={};p["$"+a]&&(m["$"+a]=p["$"+a]),p=m}var v=this._parent._getGrouping();v&&(v=r.clone(v,a),r.isEmpty(v)&&(v=!1));var g={language:this.getClosestModel("locale").id,from:u,animatable:l,select:s,where:h,join:p,order_by:i?["rank"]:[this._space.time.dim]};return v&&(g.grouping=v),g},_getAllDimensions:function(t){return this._parent._getAllDimensions(t)},_getFirstDimension:function(t){return this._parent._getFirstDimension(t)},_getAllFilters:function(t,e){t=t||{};var i={},n=this;return r.forEach(this._space,function(o){if(t.exceptType&&o.getType()===t.exceptType)return!0;if(t.onlyType&&o.getType()!==t.onlyType)return!0;if(r.arrayEquals(n._getAllDimensions(t),[o.getDimension()]))i=r.extend(i,o.getFilter(e));else{var a=o.getFilter(e);if(null!=a&&!r.isEmpty(a)){var s={};s[o.getDimension()]="$"+o.getDimension(),i=r.extend(i,s)}}}),i},_getAllJoins:function(t,e){var i={},n=this;return r.forEach(this._space,function(o){if(t.exceptType&&o.getType()===t.exceptType)return!0;if(t.onlyType&&o.getType()!==t.onlyType)return!0;if(r.arrayEquals(n._getAllDimensions(t),[o.getDimension()]))return!0;var a=o.getFilter(e);null==a||r.isEmpty(a)||(i["$"+o.getDimension()]={key:o.getDimension(),where:o.getFilter(e)})}),i},_getAllParsers:function(){return Object.values(this._space).concat(this).reduce(function(t,e){var i=e.getParser(),n=e.getDimensionOrWhich();return i&&n&&!(n in t)&&(t[n]=i),t},{})},getTickFormatter:function(){var t=this;return function(e,i,n,o,a){if("share"===(a=t.getConceptprops().format)&&(e*=100),r.isDate(e))return t._space.time.formatDate(e);if("time"===t.scaleType&&!r.isDate(e))return t._space.time.formatDate(new Date(e));if(r.isString(e)||!e&&0!==e)return e;if(Math.abs(e)<1e-14)return"0";var s="";if(o)return d3.format(".3r")(e);switch(Math.floor(Math.log(Math.abs(e))/Math.LN10+1e-14)){case-13:e*=1e12,s="p";break;case-10:e*=1e9,s="n";break;case-7:case-6:case-5:e*=1e6,s="";break;case-4:case-3:case-2:case-1:case 0:case 1:case 2:case 3:break;case 4:case 5:e/=1e3,s="k";break;case 6:case 7:case 8:e/=1e6,s="M";break;case 9:case 10:case 11:e/=1e9,s="B";break;case 12:case 13:case 14:e/=1e12,s="TR";break;default:return d3.format(".3s")(e).replace("G","B")}var l=d3.format(".3r")(e);return l.indexOf(".")>-1&&(l=l.replace(/0+$/,"").replace(/\.$/,"")),l+s+("percent"===a||"share"===a?"%":"")}},getScale:function(){return null==this.scale&&console.warn("scale is null"),this.scale},getUnique:function(t){if(this.isHook())return t||(t=this._getFirstDimension({type:"time"})),this.dataSource.getData(this._dataId,"unique",t)},getData:function(){return this.dataSource.getData(this._dataId)},getValidItems:function(){return this.dataSource.getData(this._dataId,"valid",this.which)},getNestedItems:function(t){return t?this.dataSource.getData(this._dataId,"nested",t):r.warn("No keys provided to getNestedItems(<keys>)")},getHaveNoDataPointsPerKey:function(){return this.dataSource.getData(this._dataId,"haveNoDataPointsPerKey",this.which)},getLimits:function(t){return this.dataSource.getData(this._dataId,"limits",t)},getFrame:function(t,e,i){return this.dataSource.getFrame(this._dataId,t,e,i)},getFrames:function(t,e){return this.dataSource.getFrames(this._dataId,t,e)},getItems:function(t){var e=this,i=this.spaceRef&&this._space[this.spaceRef]?this._space[this.spaceRef].dim:e._getFirstDimension({exceptType:"time"}),n={},o=this.getValidItems(),a=t?this.getEntity().getFilteredEntities().map(function(t){return t[i]}):[],s=a.length;return r.isArray(o)&&o.forEach(function(t){s&&!a.includes(t[i])||(n[t[i]]=t[e.which])}),n},getLimitsByDimensions:function(t){var e=this.dataSource.getData(this._dataId,"nested",t),i={},n=this.which;return r.forEach(e,function(t,e){var o=i[JSON.parse(e).join(",")]={};r.forEach(t,function(t,e){!function(t,e,i){for(var o=t.reduce(function(t,e){var i=r.isDate(e[n])?e[n]:parseFloat(e[n]);return isNaN(i)||t.push(i),t},[]),a=void 0,s=void 0,l={},u=0;u<o.length;u+=1){var c=o[u];(void 0===a||c<a)&&(a=c),(void 0===s||c>s)&&(s=c)}l.min=a||0,l.max=s||100,e[i]=l}(t,o,e)})}),i},getConceptprops:function(){return"constant"!==this.use&&this.dataSource?this.dataSource.getConceptprops(this.which):{}},isDiscrete:function(){return"ordinal"===this.scaleType},validate:function(){var t=this;if(this._super(),this.which){var e=this.scaleType,i=(this.getConceptprops()||{}).scales,r=void 0===i?[]:i;this.allow&&this.allow.scales&&this.allow.scales.length>0&&(r=r.filter(function(e){return-1!=t.allow.scales.indexOf(e)}));var o=r.includes(e),a=r.includes("log")&&"genericLog"===e;if(!o&&!a&&r.length>0){var s=n(r,1)[0];this.set({scaleType:s},null,!1)}}},getEntity:function(){return this._space[this.spaceRef]||this._parent._space[this.spaceRef]||this._parent._space[this._parent.getSpace()[0]]},getDataKeys:function(){return this.spaceRef?[this.getEntity().dim]:this._getAllDimensions({exceptType:"time"})}});e.default=s},function(t,e,i){"use strict";if(i(8)){var n=i(39),r=i(3),o=i(4),a=i(0),s=i(71),l=i(104),u=i(22),c=i(45),h=i(37),d=i(14),f=i(47),p=i(28),m=i(10),v=i(139),g=i(41),y=i(26),_=i(17),b=i(58),x=i(5),w=i(11),S=i(95),M=i(42),E=i(20),z=i(43).f,k=i(97),T=i(38),O=i(7),C=i(30),P=i(62),A=i(69),I=i(100),L=i(53),D=i(66),R=i(44),j=i(99),F=i(129),B=i(9),N=i(19),q=B.f,V=N.f,H=r.RangeError,U=r.TypeError,W=r.Uint8Array,K=Array.prototype,G=l.ArrayBuffer,X=l.DataView,Y=C(0),Z=C(2),$=C(3),Q=C(4),J=C(5),tt=C(6),et=P(!0),it=P(!1),nt=I.values,rt=I.keys,ot=I.entries,at=K.lastIndexOf,st=K.reduce,lt=K.reduceRight,ut=K.join,ct=K.sort,ht=K.slice,dt=K.toString,ft=K.toLocaleString,pt=O("iterator"),mt=O("toStringTag"),vt=T("typed_constructor"),gt=T("def_constructor"),yt=s.CONSTR,_t=s.TYPED,bt=s.VIEW,xt=C(1,function(t,e){return zt(A(t,t[gt]),e)}),wt=o(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),St=!!W&&!!W.prototype.set&&o(function(){new W(1).set({})}),Mt=function(t,e){var i=p(t);if(i<0||i%e)throw H("Wrong offset!");return i},Et=function(t){if(x(t)&&_t in t)return t;throw U(t+" is not a typed array!")},zt=function(t,e){if(!(x(t)&&vt in t))throw U("It is not a typed array constructor!");return new t(e)},kt=function(t,e){return Tt(A(t,t[gt]),e)},Tt=function(t,e){for(var i=0,n=e.length,r=zt(t,n);n>i;)r[i]=e[i++];return r},Ot=function(t,e,i){q(t,e,{get:function(){return this._d[i]}})},Ct=function(t){var e,i,n,r,o,a,s=w(t),l=arguments.length,c=l>1?arguments[1]:void 0,h=void 0!==c,d=k(s);if(void 0!=d&&!S(d)){for(a=d.call(s),n=[],e=0;!(o=a.next()).done;e++)n.push(o.value);s=n}for(h&&l>2&&(c=u(c,arguments[2],2)),e=0,i=m(s.length),r=zt(this,i);i>e;e++)r[e]=h?c(s[e],e):s[e];return r},Pt=function(){for(var t=0,e=arguments.length,i=zt(this,e);e>t;)i[t]=arguments[t++];return i},At=!!W&&o(function(){ft.call(new W(1))}),It=function(){return ft.apply(At?ht.call(Et(this)):Et(this),arguments)},Lt={copyWithin:function(t,e){return F.call(Et(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return Q(Et(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return j.apply(Et(this),arguments)},filter:function(t){return kt(this,Z(Et(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return J(Et(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(Et(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Y(Et(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return it(Et(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return et(Et(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ut.apply(Et(this),arguments)},lastIndexOf:function(t){return at.apply(Et(this),arguments)},map:function(t){return xt(Et(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return st.apply(Et(this),arguments)},reduceRight:function(t){return lt.apply(Et(this),arguments)},reverse:function(){for(var t,e=Et(this).length,i=Math.floor(e/2),n=0;n<i;)t=this[n],this[n++]=this[--e],this[e]=t;return this},some:function(t){return $(Et(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return ct.call(Et(this),t)},subarray:function(t,e){var i=Et(this),n=i.length,r=g(t,n);return new(A(i,i[gt]))(i.buffer,i.byteOffset+r*i.BYTES_PER_ELEMENT,m((void 0===e?n:g(e,n))-r))}},Dt=function(t,e){return kt(this,ht.call(Et(this),t,e))},Rt=function(t){Et(this);var e=Mt(arguments[1],1),i=this.length,n=w(t),r=m(n.length),o=0;if(r+e>i)throw H("Wrong length!");for(;o<r;)this[e+o]=n[o++]},jt={entries:function(){return ot.call(Et(this))},keys:function(){return rt.call(Et(this))},values:function(){return nt.call(Et(this))}},Ft=function(t,e){return x(t)&&t[_t]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Bt=function(t,e){return Ft(t,e=y(e,!0))?h(2,t[e]):V(t,e)},Nt=function(t,e,i){return!(Ft(t,e=y(e,!0))&&x(i)&&_(i,"value"))||_(i,"get")||_(i,"set")||i.configurable||_(i,"writable")&&!i.writable||_(i,"enumerable")&&!i.enumerable?q(t,e,i):(t[e]=i.value,t)};yt||(N.f=Bt,B.f=Nt),a(a.S+a.F*!yt,"Object",{getOwnPropertyDescriptor:Bt,defineProperty:Nt}),o(function(){dt.call({})})&&(dt=ft=function(){return ut.call(this)});var qt=f({},Lt);f(qt,jt),d(qt,pt,jt.values),f(qt,{slice:Dt,set:Rt,constructor:function(){},toString:dt,toLocaleString:It}),Ot(qt,"buffer","b"),Ot(qt,"byteOffset","o"),Ot(qt,"byteLength","l"),Ot(qt,"length","e"),q(qt,mt,{get:function(){return this[_t]}}),t.exports=function(t,e,i,l){var u=t+((l=!!l)?"Clamped":"")+"Array",h="get"+t,f="set"+t,p=r[u],g=p||{},y=p&&E(p),_=!p||!s.ABV,w={},S=p&&p.prototype,k=function(t,i){q(t,i,{get:function(){return function(t,i){var n=t._d;return n.v[h](i*e+n.o,wt)}(this,i)},set:function(t){return function(t,i,n){var r=t._d;l&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),r.v[f](i*e+r.o,n,wt)}(this,i,t)},enumerable:!0})};_?(p=i(function(t,i,n,r){c(t,p,u,"_d");var o,a,s,l,h=0,f=0;if(x(i)){if(!(i instanceof G||"ArrayBuffer"==(l=b(i))||"SharedArrayBuffer"==l))return _t in i?Tt(p,i):Ct.call(p,i);o=i,f=Mt(n,e);var g=i.byteLength;if(void 0===r){if(g%e)throw H("Wrong length!");if((a=g-f)<0)throw H("Wrong length!")}else if((a=m(r)*e)+f>g)throw H("Wrong length!");s=a/e}else s=v(i),o=new G(a=s*e);for(d(t,"_d",{b:o,o:f,l:a,e:s,v:new X(o)});h<s;)k(t,h++)}),S=p.prototype=M(qt),d(S,"constructor",p)):o(function(){p(1)})&&o(function(){new p(-1)})&&D(function(t){new p,new p(null),new p(1.5),new p(t)},!0)||(p=i(function(t,i,n,r){var o;return c(t,p,u),x(i)?i instanceof G||"ArrayBuffer"==(o=b(i))||"SharedArrayBuffer"==o?void 0!==r?new g(i,Mt(n,e),r):void 0!==n?new g(i,Mt(n,e)):new g(i):_t in i?Tt(p,i):Ct.call(p,i):new g(v(i))}),Y(y!==Function.prototype?z(g).concat(z(y)):z(g),function(t){t in p||d(p,t,g[t])}),p.prototype=S,n||(S.constructor=p));var T=S[pt],O=!!T&&("values"==T.name||void 0==T.name),C=jt.values;d(p,vt,!0),d(S,_t,u),d(S,bt,!0),d(S,gt,p),(l?new p(1)[mt]==u:mt in S)||q(S,mt,{get:function(){return u}}),w[u]=p,a(a.G+a.W+a.F*(p!=g),w),a(a.S,u,{BYTES_PER_ELEMENT:e}),a(a.S+a.F*o(function(){g.of.call(p,1)}),u,{from:Ct,of:Pt}),"BYTES_PER_ELEMENT"in S||d(S,"BYTES_PER_ELEMENT",e),a(a.P,u,Lt),R(u),a(a.P+a.F*St,u,{set:Rt}),a(a.P+a.F*!O,u,jt),n||S.toString==dt||(S.toString=dt),a(a.P+a.F*o(function(){new p(1).slice()}),u,{slice:Dt}),a(a.P+a.F*(o(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!o(function(){S.toLocaleString.call([1,2])})),u,{toLocaleString:It}),L[u]=O?T:C,n||O||d(S,pt,C)}}else t.exports=function(){}},function(t,e,i){var n=i(134),r=i(0),o=i(61)("metadata"),a=o.store||(o.store=new(i(137))),s=function(t,e,i){var r=a.get(t);if(!r){if(!i)return;a.set(t,r=new n)}var o=r.get(e);if(!o){if(!i)return;r.set(e,o=new n)}return o};t.exports={store:a,map:s,has:function(t,e,i){var n=s(e,i,!1);return void 0!==n&&n.has(t)},get:function(t,e,i){var n=s(e,i,!1);return void 0===n?void 0:n.get(t)},set:function(t,e,i,n){s(i,n,!0).set(t,e)},keys:function(t,e){var i=s(t,e,!1),n=[];return i&&i.forEach(function(t,e){n.push(e)}),n},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){r(r.S,"Reflect",t)}}},function(t,e,i){var n=i(38)("meta"),r=i(5),o=i(17),a=i(9).f,s=0,l=Object.isExtensible||function(){return!0},u=!i(4)(function(){return l(Object.preventExtensions({}))}),c=function(t){a(t,n,{value:{i:"O"+ ++s,w:{}}})},h=t.exports={KEY:n,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,n)){if(!l(t))return"F";if(!e)return"E";c(t)}return t[n].i},getWeak:function(t,e){if(!o(t,n)){if(!l(t))return!0;if(!e)return!1;c(t)}return t[n].w},onFreeze:function(t){return u&&h.NEED&&l(t)&&!o(t,n)&&c(t),t}}},function(t,e,i){var n=i(7)("unscopables"),r=Array.prototype;void 0==r[n]&&i(14)(r,n,{}),t.exports=function(t){r[n][t]=!0}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e){t.exports=!1},function(t,e,i){var n=i(115),r=i(82);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var n=i(28),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=n(t))<0?r(t+e,0):o(t,e)}},function(t,e,i){var n=i(2),r=i(116),o=i(82),a=i(81)("IE_PROTO"),s=function(){},l=function(){var t,e=i(79)("iframe"),n=o.length;for(e.style.display="none",i(83).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),l=t.F;n--;)delete l.prototype[o[n]];return l()};t.exports=Object.create||function(t,e){var i;return null!==t?(s.prototype=n(t),i=new s,s.prototype=null,i[a]=t):i=l(),void 0===e?i:r(i,e)}},function(t,e,i){var n=i(115),r=i(82).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,r)}},function(t,e,i){"use strict";var n=i(3),r=i(9),o=i(8),a=i(7)("species");t.exports=function(t){var e=n[t];o&&e&&!e[a]&&r.f(e,a,{configurable:!0,get:function(){return this}})}},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e,i){var n=i(22),r=i(127),o=i(95),a=i(2),s=i(10),l=i(97),u={},c={};(e=t.exports=function(t,e,i,h,d){var f,p,m,v,g=d?function(){return t}:l(t),y=n(i,h,e?2:1),_=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(f=s(t.length);f>_;_++)if((v=e?y(a(p=t[_])[0],p[1]):y(t[_]))===u||v===c)return v}else for(m=g.call(t);!(p=m.next()).done;)if((v=r(m,y,p.value,e))===u||v===c)return v}).BREAK=u,e.RETURN=c},function(t,e,i){var n=i(15);t.exports=function(t,e,i){for(var r in e)n(t,r,e[r],i);return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=i(49),o=s(r),a=s(i(392));function s(t){return t&&t.__esModule?t:{default:t}}var l=o.default.extend({_name:"",_parent:null,_persistent:!0,init:function(t,e,i,n,r){Object.defineProperty(this,"value",{get:this.get,set:this.set}),Object.defineProperty(this,"persistent",{get:function(){return this._persistent}}),this._super(),this._name=t,this._parent=i,this._root=i._root,this.set(e,!1,r),this.on(n)},get:function(t){return t&&!this._persistent?this._persistentVal:this._val},set:function(t,e,i){return!!this.isSetAllowed(t,e)&&((i=void 0===i||i)&&(this._persistentVal=t),this._previousVal=n.deepClone(this._val),this._val=t,this._persistent=i,this.trigger(new r.ChangeEvent(this),this._name),!0)},isSetAllowed:function(t,e){return e||this._val!==t&&JSON.stringify(this._val)!==JSON.stringify(t)},setTreeFreezer:function(t){t?this.freeze(["hook_change"]):this.unfreeze()}}),u=o.default.extend({getClassDefaults:function(){return{}},objectLeafs:[],init:function(t,e,i,r){this._type=this._type||"model",this._id=this._id||n.uniqueId("m"),this._data={},this._parent=i,this._root=i?i._root:this,this._name=t,this._inError=!1,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._intervals=function t(e){return e._intervals||(e._parent?t(e._parent):new a.default)}(this),this._space={},this._dataId=!1,this._limits={},this._super();var o=n.deepExtend({},this.getClassDefaults(),e);this.set(o),r&&this.on(r)},get:function(t){if(t){var e=this._data[t];return u.isModel(e)?e:e.value}return this._data},set:function(t,e,i,r,o){var a=this._setting,s=void 0,d=!1;if(n.isPlainObject(t)?(s=t,r=i,i=e):(s={})[t]=e,0!==Object.keys(s).length){this._setting=!0,this._freeze||(d=!0,this.setTreeFreezer(!0));var f=[];for(var p in s){e=s[p];var m=n.isPlainObject(e)&&this._data[p]instanceof u,v=(!n.isPlainObject(e)||this.isObjectLeaf(p))&&this._data[p]instanceof l;if(this._data[p]&&(m||v)){var g=this._data[p].value,y=this._data[p].set(e,i,r);v&&y&&f.push(p);var _="set"+n.capitalize(p[0])+p.slice(1);this.isHook()&&n.isFunction(this[_])&&o!==this[_]&&e!==g&&this[_]("which"===p?{concept:e}:e)}else this._data[p]=h(p,e,this,r),c(this,p)}a||(this.checkDataChanges(f),this.validate&&this.validate()),a&&!i||(this._setting=!1,!d||this.isHook()&&this.isLoading()||this.setTreeFreezer(!1),this.isHook()||this.isLoading()||this.setReady())}},checkDataChanges:function(){},setTreeFreezer:function(t){n.forEach(this._data,function(e){e.setTreeFreezer(t)}),t?this.freeze(["hook_change"]):this.unfreeze()},getType:function(){return this._type},getSubmodels:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},i=t?{}:[];return n.forEach(this._data,function(n,r){n&&void 0!==n._id&&u.isModel(n)&&e(n)&&(t?i[r]=n:i.push(n))}),i},getPlainObject:function(t){var e={},i=this;return n.forEach(this._data,function(r,o){if(r instanceof u)e[o]=r.getPlainObject(t);else if(!t||r.persistent){var a=r.get(t);n.isDate(a)&&(a=i.formatDate(a)),e[o]=a}}),e},formatDate:function(t){return t.toString()},getModelObject:function(t){return t?this._data[t]:this},clear:function(){var t=this.getSubmodels();for(var e in t)t[e].clear();this.setReady(!1),this.off(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},_isLoading:function(){return!1},isLoading:function(){if(this._isLoading())return!0;var t=this.getSubmodels(),e=void 0;for(e=0;e<t.length;e+=1)if(t[e].isLoading())return!0;return!1},setReady:function(t){if(!1===t)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));var e=this._ready;this._ready=!this.isLoading()&&!this._setting,this._ready&&e!==this._ready&&(this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready"))},setInterModelListeners:function(){n.forEach(this.getSubmodels(),function(t){return t.setInterModelListeners()})},startPreload:function(){var t=[];return t.push(this.preloadData()),n.forEach(this.getSubmodels(),function(e){return t.push(e.startPreload())}),Promise.all(t)},preloadData:function(){return Promise.resolve()},startLoading:function(t){var e=this,i=[];return i.push(this.loadData(t)),n.forEach(this.getSubmodels(),function(e){return i.push(e.startLoading(t))}),Promise.all(i).then(this.onSuccessfullLoad.bind(this)).catch(function(t){n.error("error in model "+e._name),e.triggerLoadError(t)})},loadData:function(t){return this.isHook()&&n.warn("Hook "+this._name+" is not loading because it's not extending Hook prototype."),Promise.resolve()},loadSubmodels:function(t){var e=[],i=this.getSubmodels();return n.forEach(i,function(i){e.push(i.startLoading(t))}),e.length>0?Promise.all(e):Promise.resolve()},onSuccessfullLoad:function(){var t=this;this.validate(),n.timeStamp("Vizabi Model: Model loaded: "+this._name+"("+this._id+")"),this._loadedOnce=!0,this._loadCall=!1,this.setTreeFreezer(!1),n.defer(function(){return t.setReady()})},handleLoadError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getDefaultError();this.triggerLoadError(t)},getDefaultError:function(){var t=new Error;return t.message=this.getClosestModel("locale").getTFunction()("connection/error"),t},triggerLoadError:function(t){if(o.default.unfreezeAll(),this._inError)return n.error("Model "+this._name+" already in error");this._inError=!0,this._root.trigger("load_error",t),this._root.trigger("load_error1",t)},afterPreload:function(){var t=this.getSubmodels();n.forEach(t,function(t){t.afterPreload()})},isHook:function(){return Boolean(this.use)},getSubhooks:function(t){return this.getSubmodels(t,function(t){return t.isHook()})},getHookWhich:function(t){var e=[];return this.use&&this.use===t&&e.push(this.which),n.forEach(this.getSubmodels(),function(i){e=n.unique(e.concat(i.getHookWhich(t)))}),e},getIndicators:function(){return this.getHookWhich("indicator")},getProperties:function(){return this.getHookWhich("property")},getDimension:function(){return this.dim||!1},getDimensionOrWhich:function(){return this.dim||"constant"!=this.use&&this.which},getFilter:function(){return{}},mapValue:function(t){return t},getParser:function(){return null},getDefaults:function(){return n.deepExtend({},this.getClassDefaults(),this.getSubmodelDefaults())},getSubmodelDefaults:function(){var t={};return n.forEach(this.getSubmodels(!0),function(e,i){t[i]=e.getDefaults()}),t},isObjectLeaf:function(t){return-1!==this.objectLeafs.indexOf(t)},getClosestModel:function(t){var e=this.findSubmodel(t);return e||(this._parent?this._parent.getClosestModel(t):null)},findSubmodel:function(t){for(var e in this._data)if(e===t&&u.isModel(this._data[e]))return this._data[e];return null},isEntities:function(){return!1}});function c(t,e){var i;Object.defineProperty(t,e,{configurable:!0,get:(i=e,function(){return t.get(i)}),set:function(e){return function(i){return t.set(e,i)}}(e)})}function h(t,e,r,o){var a=void 0;if(!n.isPlainObject(e)||n.isArray(e)||r.isObjectLeaf(t)){a=new l(t,e,r,{change:d},o)}else{var s={change:d,hook_change:function(t,e){r.trigger(t,e)},load_error:function(){return r.trigger.apply(r,arguments)},dataLoaded:function(){return r.trigger.apply(r,arguments)},ready:function(t,e){r.setReady(!1),n.defer(function(){r.setReady()})}};if(u.isModel(e,!0))(a=e).on(s);else{var c=t.split("_")[0],h=u.get(c,!0);if(!h)try{h=i(393)("./"+c).default}catch(t){h=u}a=new h(t,e,r,s)}}return a;function d(t,e){r._ready&&(e=r._name+"."+e,r.trigger(t,e))}}u.isModel=function(t,e){return t&&(t.hasOwnProperty("_data")||e&&t.hasOwnProperty("_val"))},e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=e.DefaultEvent=void 0;var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),a=i(31),s=(n=a)&&n.__esModule?n:{default:n};var l=!1,u=[],c={},h=e.DefaultEvent=s.default.extend({source:"",type:"default",init:function(t,e){this.source=t,e&&(this.type=e)}}),d=(e.ChangeEvent=h.extend("change",{type:"change",init:function(t){this._super(t)}}),s.default.extend({init:function(){this._id=this._id||o.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(t,e,i){if(!this.splitEventParameters(t,e,i,this.on)){var n=this.traversePath(e);n&&(n._events[t]=n._events[t]||[],"function"==typeof i?n._events[t].push(i):o.warn("Can't bind event '"+t+"'. It must be a function."))}},off:function(t,e,i){if(0!=arguments.length){if(!this.splitEventParameters(t,e,i,this.off)){var n=this.traversePath(e);if(n&&n._events.hasOwnProperty(t)){if(void 0===i)return void(n._events[t]=[]);var r=n._events[t].indexOf(i);r>-1?n._events[t].splice(r,1):o.warn("Could not unbind function "+i.name+". Function not in bound function list.")}}}else this._events={}},splitEventParameters:function(t,e,i,n){var r=void 0;if(o.isArray(t)){for(r=0;r<t.length;r+=1)n.call(this,t[r],i);return!0}if(o.isObject(t)){for(r in t)n.call(this,r,t[r]);return!0}if("function"==typeof e){if(i=e,-1!==t.indexOf(":")){var a=t.split(":");t=a[0],e=a[1]}else e=void 0;return n.call(this,t,e,i),!0}if(o.isArray(e)){for(r=0;r<e.length;r+=1)n.call(this,t,e[r],i);return!0}if(i&&o.isArray(i)){for(r=0;r<i.length;r+=1)n.call(this,t,e,i[r]);return!0}return!1},traversePath:function(t){if(void 0===t||o.isArray(t)&&0==t.length)return this;if("string"==typeof t&&(t=t.split(".")),!o.isArray(t))return o.error("Path is wrong type. Path should be a string or array but is "+(void 0===t?"undefined":r(t))+"."),null;var e=t.shift();if(void 0!==this[e])return this.getModelObject(e).traversePath(t);o.warn("Can't find child \""+e+'" of the model '+this._name+".")},createEventFromType:function(t){if(t instanceof h)return t;var e=h.get(t,!0);return e?new e(this):new h(this,t)},trigger:function(t,e){var i=this,n=void 0,r=void 0;if(o.isArray(t))for(n=0,r=t.length;n<r;n+=1)this.trigger(t[n],e);else{var a=this.createEventFromType(t);if(this._events.hasOwnProperty(a.type)){var s=this;o.forEach(this._events[a.type],function(t){var n=function(){var i="Vizabi Event: "+a.type;o.timeStamp(i),t.apply(s,[a,e])};i.allowExecution(a)?n():(i._freezer.push(n),l&&!u[i._id]&&(i.freeze(),u[i._id]=i))})}}},allowExecution:function(t){return!this._freeze&&!l||l&&c.hasOwnProperty(t.type)||!l&&this._freeze&&this._freezeExceptions.hasOwnProperty(t.type)},freeze:function(t){if(this._freeze=!0,t){o.isArray(t)||(t=[t]);for(var e=0;e<t.length;e+=1)this._freezeExceptions[t[e]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){this._freezer.shift()()}},clearFrozen:function(){this._freeze=!1,this._freezeExceptions={},this._freezer=[]}}));d.freezeAll=function(t){if(l=!0,!t)return;o.isArray(t)||(t=[t]);o.forEach(t,function(t){c[t]=!0})},d.unfreezeAll=function(){l=!1,c={};for(var t=Object.keys(u),e=0;e<t.length;e++){var i=u[t[e]];i&&i.unfreeze()}u={}},e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=u(i(6)),o=u(i(109)),a=u(i(32)),s=u(i(76)),l=i(21);function u(t){return t&&t.__esModule?t:{default:t}}var c=r.default.extend({init:function(t,e){this.name="gapminder-indicatorpicker",this.template='<span class="vzb-ip-holder"><span class="vzb-ip-select"></span><span class="vzb-ip-info"></span></span>';var i=this;this.model_expects=[{name:"time",type:"time"},{name:"targetModel"},{name:"locale",type:"locale"}],this.showHoverValues=t.showHoverValues||!1,this.model_binds={"translate:locale":function(t){i.updateView()},ready:function(t){i.updateView()}},this.model_binds["change:targetModel"]=function(t,e){-1!=e.indexOf("."+i.targetProp)&&i.updateView()},this._super(t,e),this.model.targetModel.isHook()&&this.showHoverValues&&this.model.targetModel._parent.on("change:highlight",function(t,e){var r=i.model.targetModel;if(r.isHook()){var o=r._parent;if(i.showHoverValues&&"constant"!=r.use){var a=o.getHighlighted();a.length>1||(a.length?o.getFrame(i.model.time.value,function(t){if(!i._highlighted&&t){var e=o.getHighlighted();if(e.length){var a=r.getDataKeys(),s=t[r._name][n.getKey(e[0],a)];if(s&&"color"===r._type&&r.isDiscrete()){var l=r.getColorlegendMarker();l.label.getItems()[s]&&(s=l.label.getItems()[s])}i._highlightedValue=s,i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==r.use,i.updateView()}}}):(null!==e&&"highlight"!==e?e&&(i._highlightedValue=e[r._name],i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==r.use):i._highlighted=!1,i.updateView()))}}}),this.targetProp=t.targetProp||this.model.targetModel instanceof a.default?"which":this.model.targetModel instanceof o.default?"dim":this.model.targetModel instanceof s.default?"space":null},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.el_select=d3.select(this.element).select(".vzb-ip-select"),this.el_select.on("click",function(){var e=t.el_select.node().getBoundingClientRect(),i=(t.root.element instanceof Array?t.root.element:d3.select(t.root.element)).node().getBoundingClientRect(),n=t.root.findChildByName("gapminder-treemenu"),r=n.activeProfile.col_width,o=parseInt(n.wrapper.style("padding-left"),10)||0,a=parseInt(n.wrapper.style("padding-right"),10)||0,s=e.bottom-i.top,l=e.left-i.left-.5*(o+a+r-e.width);n.targetModel(t.model.targetModel).alignX("left").alignY("top").top(s).left(l).updateView().toggle()}),this.infoEl=d3.select(this.element).select(".vzb-ip-info"),t.model.targetModel.isHook()&&(n.setIcon(this.infoEl,l.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.root.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element.getBoundingClientRect(),n=e.bottom-i.top,r=e.left-i.left+e.width;t.root.findChildByName("gapminder-datanotes").setHook(t.model.targetModel._name).show().setPos(r,n)}),this.infoEl.on("mouseout",function(){t.root.findChildByName("gapminder-datanotes").hide()}))},updateView:function(){if(this._readyOnce){var t=this.model.locale.getTFunction(),e=this.model.targetModel,i=e[this.targetProp],n=e._type,r=void 0,o=void 0;if(e instanceof a.default)if(r=e.getConceptprops(),this.showHoverValues&&this._highlighted){var s=e.getTickFormatter();o=this._highlightedValue||0===this._highlightedValue?s(this._highlightedValue):t("hints/nodata")}else o="_default"===i?t("indicator/_default/"+n):r.name_short;else{var l=e._root.dataManager;o=e.space.map(function(t){return l.getConceptProperty(e._space[t].dim,"name")}).join(", ")}this.el_select.text(o).attr("title",function(t){return this.offsetWidth<this.scrollWidth?o:null});var u=r&&!r.description&&!r.sourceName&&!r.sourceLink;this.infoEl.classed("vzb-invisible",u)}}});e.default=c},function(t,e,i){var n=i(9).f,r=i(17),o=i(7)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,o)&&n(t,o,{configurable:!0,value:e})}},function(t,e,i){var n=i(0),r=i(27),o=i(4),a=i(85),s="["+a+"]",l=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),c=function(t,e,i){var r={},s=o(function(){return!!a[t]()||""!=""[t]()}),l=r[t]=s?e(h):a[t];i&&(r[i]=l),n(n.P+n.F*s,"String",r)},h=c.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=c},function(t,e){t.exports={}},function(t,e,i){var n=i(5);t.exports=function(t,e){if(!n(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=o(i(48));o(i(49));function o(t){return t&&t.__esModule?t:{default:t}}var a=r.default.extend({dataConnectedChildren:[],checkDataChanges:function(t){var e=this;t&&this.dataConnectedChildren&&(!n.isArray(t)&&n.isObject(t)&&(t=Object.keys(t)),0!=t.length&&0!=this.dataConnectedChildren.length&&t.filter(function(t){return-1!==e.dataConnectedChildren.indexOf(t)}).length>0&&(this.trigger("dataConnectedChange"),this.startLoading({dataConnectedChange:!0})))}});e.default=a},function(t,e,i){var n=i(23);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){var n=i(23),r=i(7)("toStringTag"),o="Arguments"==n(function(){return arguments}());t.exports=function(t){var e,i,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?i:o?n(e):"Object"==(a=n(e))&&"function"==typeof e.callee?"Arguments":a}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(77);var a={THUMB_HEIGHT:17,THUMB_STROKE_WIDTH:3},s={small:{},medium:{},large:{}},l=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){this.name="singlehandleslider";var i=r.extend({},a);this.options=r.extend(i,this.options||{});var n=r.extend({},s);this.profiles=r.extend(n,this.profiles||{}),this.slider_properties=t.properties||{};var o=this.slider_properties.roundDigits;(o||0==o)&&(this.options.ROUND_DIGITS=o),this.slider_properties.domain&&(this.options.EXTENT_MIN=this.slider_properties.domain[0],this.options.EXTENT_MAX=this.slider_properties.domain[1]),this._super(t,e)},readyOnce:function(){this._super();var t=this.options,e=t.BAR_WIDTH,i=t.THUMB_HEIGHT;this.padding.top=.5*(i+t.THUMB_STROKE_WIDTH),this.padding.bottom=.5*(i+t.THUMB_STROKE_WIDTH)-e;var n=this._getComponentWidth();n<0&&(n=0),this.rescaler.domain(this.slider_properties.domain||[this.options.EXTENT_MIN,this.options.EXTENT_MAX]),this.rescaler.range(d3.range(0,n,n/(this.rescaler.domain().length-1)).concat([n])),this.sliderEl.call(this.brush.handleSize(t.THUMB_HEIGHT+t.THUMB_STROKE_WIDTH)),this.sliderEl.selectAll(".w").classed("vzb-hidden",!0),this.sliderEl.select(".selection").classed("vzb-hidden",!0),this.sliderEl.select(".overlay").lower().style("stroke-opacity","0").style("stroke-width",.5*i+"px").attr("rx",.5*e).attr("ry",.5*e),this.sliderEl.selectAll(".vzb-slider-thumb-badge").style("stroke-width",this.options.THUMB_STROKE_WIDTH+"px")},_getBrushEventListeners:function(){var t=this,e=this,i=this._super();return{start:i.start,brush:function(){!e.nonBrushChange&&d3.event.sourceEvent&&(e.slider_properties.suppressInput?e._snap(d3.event.selection):i.brush.apply(i,arguments))},end:function(){!e.nonBrushChange&&d3.event.sourceEvent&&(e.slider_properties.snapValue&&t._snap(d3.event.selection),e._setFromExtent(!0,!0))}}},_snap:function(t){var e=this.rescaler.invert(this._extentToValue(t)),i=this.rescaler.domain(),n=i[i.length-1]>i[0],r=d3.bisector(d3[n?"ascending":"descending"]).left(i,e)||1;e=(n?1:-1)*(e-i[r-1]-(i[r]-e))>0?i[r]:i[r-1],this._moveBrush(this._valueToExtent(e))},_createThumbs:function(t){this.options.BAR_WIDTH;var e=.5*this.options.THUMB_HEIGHT,i=d3.arc().outerRadius(e).startAngle(0).endAngle(2*Math.PI);t.attr("transform","translate("+(e+.5*this.options.THUMB_STROKE_WIDTH)+","+(e+.5*this.options.THUMB_STROKE_WIDTH)+")").append("path").attr("d",i)},_resize:function(){this._super();var t=this._getComponentWidth();this.rescaler.range(d3.range(0,t||1,t/(this.rescaler.domain().length-1)||1).concat([t]))},_valueToExtent:function(t){return[this.rescaler.domain()[0],t]},_extentToValue:function(t){return t[1]},_setModel:function(t,e,i){if(this.slider_properties.suppressInput&&this._extentToValue(t).toFixed(this.options.ROUND_DIGITS)==this.model.submodel[this.arg])return;this._super(t,e,i)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(6),o=(n=r)&&n.__esModule?n:{default:n};e.default=o.default.extend({init:function(t,e){this.template='<span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>';var i=this;this.name="gapminder-simplecheckbox",this.checkbox=t.checkbox,this.submodel=t.submodel,this.model_expects=[{name:"mdl"},{name:"locale",type:"locale"}],this.model_binds={"change:mdl":function(t){i.updateView()},"translate:locale":function(t){i.updateView()}};var n=this.submodel?this.submodel+":":"";this.model_binds["change:mdl."+n+this.checkbox]=function(){i.updateView()},this._super(t,e)},ready:function(){this.parentModel=this.submodel?this.model.mdl[this.submodel]:this.model.mdl,this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element);var e="-check-"+t._id;this.labelEl=this.element.select("label").attr("for",e),this.checkEl=this.element.select("input").attr("id",e).on("change",function(){t._setModel(d3.select(this).property("checked"))})},updateView:function(){this.translator=this.model.locale.getTFunction();var t=this.parentModel&&(this.parentModel[this.checkbox]||!1===this.parentModel[this.checkbox]);this.labelEl.classed("vzb-hidden",!t),t&&(this.labelEl.text(this.translator("check/"+this.checkbox)),this.checkEl.property("checked",!!this.parentModel[this.checkbox]))},_setModel:function(t){this.parentModel[this.checkbox]=t}})},function(t,e,i){var n=i(3),r=n["__core-js_shared__"]||(n["__core-js_shared__"]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e,i){var n=i(18),r=i(10),o=i(41);t.exports=function(t){return function(e,i,a){var s,l=n(e),u=r(l.length),c=o(a,u);if(t&&i!=i){for(;u>c;)if((s=l[c++])!=s)return!0}else for(;u>c;c++)if((t||c in l)&&l[c]===i)return t||c||0;return!t&&-1}}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var n=i(23);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,i){var n=i(5),r=i(23),o=i(7)("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==r(t))}},function(t,e,i){var n=i(7)("iterator"),r=!1;try{var o=[7][n]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var o=[7],a=o[n]();a.next=function(){return{done:i=!0}},o[n]=function(){return a},t(o)}catch(t){}return i}},function(t,e,i){"use strict";var n=i(2);t.exports=function(){var t=n(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,i){"use strict";var n=i(14),r=i(15),o=i(4),a=i(27),s=i(7);t.exports=function(t,e,i){var l=s(t),u=i(a,l,""[t]),c=u[0],h=u[1];o(function(){var e={};return e[l]=function(){return 7},7!=""[t](e)})&&(r(String.prototype,t,c),n(RegExp.prototype,l,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)}))}},function(t,e,i){var n=i(2),r=i(13),o=i(7)("species");t.exports=function(t,e){var i,a=n(t).constructor;return void 0===a||void 0==(i=n(a)[o])?e:r(i)}},function(t,e,i){"use strict";var n=i(3),r=i(0),o=i(15),a=i(47),s=i(35),l=i(46),u=i(45),c=i(5),h=i(4),d=i(66),f=i(51),p=i(86);t.exports=function(t,e,i,m,v,g){var y=n[t],_=y,b=v?"set":"add",x=_&&_.prototype,w={},S=function(t){var e=x[t];o(x,t,"delete"==t?function(t){return!(g&&!c(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!c(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!c(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof _&&(g||x.forEach&&!h(function(){(new _).entries().next()}))){var M=new _,E=M[b](g?{}:-0,1)!=M,z=h(function(){M.has(1)}),k=d(function(t){new _(t)}),T=!g&&h(function(){for(var t=new _,e=5;e--;)t[b](e,e);return!t.has(-0)});k||((_=e(function(e,i){u(e,_,t);var n=p(new y,e,_);return void 0!=i&&l(i,v,n[b],n),n})).prototype=x,x.constructor=_),(z||T)&&(S("delete"),S("has"),v&&S("get")),(T||E)&&S(b),g&&x.clear&&delete x.clear}else _=m.getConstructor(e,t,v,b),a(_.prototype,i),s.NEED=!0;return f(_,t),w[t]=_,r(r.G+r.W+r.F*(_!=y),w),g||m.setStrong(_,t,v),_}},function(t,e,i){for(var n,r=i(3),o=i(14),a=i(38),s=a("typed_array"),l=a("view"),u=!(!r.ArrayBuffer||!r.DataView),c=u,h=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<9;)(n=r[d[h++]])?(o(n.prototype,s,!0),o(n.prototype,l,!0)):c=!1;t.exports={ABV:u,CONSTR:c,TYPED:s,VIEW:l}},function(t,e,i){"use strict";t.exports=i(39)||!i(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete i(3)[t]})},function(t,e,i){"use strict";var n=i(0);t.exports=function(t){n(n.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},function(t,e,i){"use strict";var n=i(0),r=i(13),o=i(22),a=i(46);t.exports=function(t){n(n.S,t,{from:function(t){var e,i,n,s,l=arguments[1];return r(this),(e=void 0!==l)&&r(l),void 0==t?new this:(i=[],e?(n=0,s=o(l,arguments[2],2),a(t,!1,function(t){i.push(s(t,n++))})):a(t,!1,i.push,i),new this(i))}})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),s=i(31);function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var u=((n=s)&&n.__esModule?n:{default:n}).default.extend({QUERY_FROM_CONCEPTS:"concepts",QUERY_FROM_DATAPOINTS:"datapoints",QUERY_FROM_ENTITIES:"entities",SCHEMA_QUERY_FROM_CONCEPTS:"concepts.schema",SCHEMA_QUERY_FROM_DATAPOINTS:"datapoints.schema",SCHEMA_QUERY_FROM_ENTITIES:"entities.schema",CONDITION_CALLBACKS:{$gt:function(t,e){return e>t},$gte:function(t,e){return e>=t},$lt:function(t,e){return e<t},$lte:function(t,e){return e<=t},$in:function(t,e){return t.includes(e)}},LOGICAL_TEST:{$and:"every",$or:"some"},ERRORS:{GENERIC_ERROR:"reader/error/generic"},_name:"reader",load:function(){return Promise.resolve({rows:[],columns:[]})},read:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t,r=t=this._normalizeQuery(t,i),o=r.select,s=r.from;return this.load(i).then(function(n){var r=n.rows,a=n.columns;switch(e._checkTimeParser(a,i),e.ensureDataIsCorrect(n,i),!0){case s===e.SCHEMA_QUERY_FROM_CONCEPTS:return[{key:["concept"],value:"concept_type"}];case s===e.SCHEMA_QUERY_FROM_ENTITIES:return a.slice(0,e.keySize).map(function(t){return{key:[t],value:t}});case s===e.SCHEMA_QUERY_FROM_DATAPOINTS:var l=a.slice(0,e.keySize+1);return a.slice(e.keySize+1).map(function(t){return{key:l,value:t}});case s===e.QUERY_FROM_CONCEPTS:return e._getConcepts(a,e._mapRows(r,t,i));case e._isDataQuery(s)&&o.key.length>0:return e._getData(r,t,i);default:return[]}}).catch(function(t){throw a.find(e.ERRORS,function(e){return e===t.name})||(t=e.error(e.ERRORS.GENERIC_ERROR,t)),t.endpoint||(t.endpoint=e._basepath),t.ddfql||(t.ddfql=n),t.details||(t.details=e._name),t})},ensureDataIsCorrect:function(){},_checkTimeParser:function(t,e){var i=t[this.keySize];e[i]||(e[i]=function(t){return t})},_normalizeQuery:function(t,e){var i=Object.assign({},t),n=i.where,r=void 0===n?{}:n,a=i.join,s=void 0===a?{}:a;return r.$and&&(r.$and=r.$and.reduce(function(t,i){return Object.keys(i).forEach(function(n){var r=i[n];if("string"==typeof r&&r.startsWith("$")){var a=s[r].where;Object.keys(a).forEach(function(i){var n=a[i],r=e[i];t.push(l({},i,r?"object"===(void 0===n?"undefined":o(n))?Object.keys(n).reduce(function(t,e){return t[e]=r(n[e]),t},{}):r(n):n))})}else{var u=e[n];t.push(l({},n,u?u(r):r))}}),t},[])),i},_getConcepts:function(t,e){var i=this;return t.map(function(n,o){var s={concept:n};if(o<i.keySize)s.concept_type="entity_domain";else if(o===i.keySize)s.concept_type="time";else{s.concept_type="measure";for(var l=e.length-1;l>-1;--l)if(a.isString(e[l][n])&&""!==e[l][n]){s.concept_type="string";var u=r(t,1);s.domain=u[0];break}}return s})},_getData:function(t,e,i){var n=e.order_by,o=r(void 0===n?[]:n,1)[0];return this._mapRows(t,e,i).reduce(this._applyQuery(e),[]).sort(function(t,e){return t[o]-e[o]})},_isDataQuery:function(t){return[this.QUERY_FROM_DATAPOINTS,this.QUERY_FROM_ENTITIES].includes(t)},_mapRows:function(t,e,i){return t.map(this._getRowMapper(e,i))},_getRowMapper:function(t,e){var i=this;return function(n){var r=!0,o=Object.keys(n).reduce(function(o,s){if(r){var l=n[s],u=String(l).trim(),c=e[s],h=a.isString(l)?c?c(u):i._parse(u):l;h||0===h?o[s]=h:t.select.key.includes(s)&&(r=!1)}return o},{});return r&&o}},_parse:function(t){return t},_applyQuery:function(t){var e=this,i=t.select,n=t.from,o=r(i.key,1)[0],a=[];return function(r,s){if(s){var l=s[o],u=n!==e.QUERY_FROM_ENTITIES||!a.includes(l);if(e._isSuitableRow(t,s)&&u){n===e.QUERY_FROM_ENTITIES&&a.push(l);var c=Object.keys(s).reduce(function(t,e){return(i.key.includes(e)||i.value.includes(e))&&(t[e]=s[e]),t},{});r.push(c)}}return r}},_isSuitableRow:function(t,e){var i=this,n=t.where;return!n||Object.keys(n).every(function(t){return i._testCondition(n[t],t,e)})},_testCondition:function(t,e,i){var n=this,r=this.LOGICAL_TEST[e],s=r?e:i[e];return void 0===s||(t instanceof Date?!(+t-+s):"object"!==(void 0===t?"undefined":o(t))?s===t||!0===t&&a.isString(s)&&"true"===s.toLowerCase().trim()||!1===t&&a.isString(s)&&"false"===s.toLowerCase().trim():r?t[r](function(t){return Object.keys(t).every(function(e){return n._testCondition(t[e],e,i)})}):Object.keys(t).every(function(e){return n.CONDITION_CALLBACKS[e](t[e],s,i)}))},error:function(t,e,i,n,r){var o=new Error;return o.name=t,o.message=e,o.details=i,o.ddfql=n,o.endpoint=r,o}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(48);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{select:[],highlight:[],superHighlight:[],opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:1,limit:1e3,allowSelectMultiple:!0})},init:function(t,e,i,n,r){this._type="marker",this._visible=[],this._super(t,e,i,n,r),this.on("change","space",this.updateSpaceReferences.bind(this))},setInterModelListeners:function(){this._super(),this.updateSpaceReferences()},updateSpaceReferences:function(){var t=this;r.forEach(this.getSpace(),function(e){t._space[e]=t.getClosestModel(e)})},setSpace:function(t){var e=this,i=Object.keys(this.getSubhooks(!0)),n={},o={};(n.space=this._root.dimensionManager.getDimensionModelsForSpace(this._space,t)).filter(function(t){return!e.space.includes(t)}).forEach(function(t){var r=e.getClosestModel(t),a="label"+t.replace(r._type,""),s={which:r.dim,use:"property"},l=e._root.dataManager.getAvailableDataForKey(r.dim,"name","entities")[0];l&&(s.which=l.value,s.data=l.data),i.includes(a)?(s.spaceRef=t,n[a]=s):(s.key=[{concept:r.dim}],s.dataSource=s.data,s.concept=s.which,o[a]=s,n[a]={})}),this.set(n),r.forEach(o,function(t,i){e[i].setInterModelListeners(),e[i].setWhich(t)}),this._dataCube=this.getSubhooks(!0)},getAvailableSpaces:function(){var t=new Map;return r.forEach(this._root._data,function(e){if("data"===e._type){var i=e.getConceptprops();e.keyAvailability.forEach(function(e,n){e.length>1&&t.set(n,e.map(function(t){return i[t]}))})}}),t},getAvailableData:function(){var t=this,e=[];if(0===d3.keys(this._space).length)return r.warn("getAvailableData() is trying to access missing _space items of marker '"+this._name+"' which likely haven't been resoled in time");var i=r.unique(this.space.map(function(e){return t._space[e].dim}));r.forEach(this._root._data,function(t){if("data"===t._type){var n=t.getConceptprops();t.dataAvailability.datapoints.forEach(function(r){i.length==r.key.size&&i.every(function(t){return r.key.has(t)})&&e.push({key:r.key,value:n[r.value],dataSource:t})});t.dataAvailability.entities.forEach(function(r){null!=r.value&&i.forEach(function(i){r.key.has(i)&&-1===r.value.indexOf("is--")&&e.push({key:Array.from(r.key).map(function(t){return n[t]}),value:n[r.value],dataSource:t})})})}});var n=this._root.dataManager.getDataModels().values().next().value;return i.filter(function(t){return null!=t}).forEach(function(t){return e.push({key:[n.getConceptprops(t)],value:n.getConceptprops(t),dataSource:n})}),e.push({key:[n.getConceptprops("_default")],value:n.getConceptprops("_default"),dataSource:n}),e},getAvailableConcept:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index,i=void 0===e?0:e,n=t.type,r=void 0===n?null:n,o=t.includeOnlyIDs,a=void 0===o?[]:o,s=t.excludeIDs,l=void 0===s?[]:s;if(!r&&0==a.length&&0==l.length)return null;var u=this.getAvailableData().filter(function(t){return!(r&&t.value.concept_type&&t.value.concept_type!==r||0!=a.length&&-1===a.indexOf(t.value.concept)||0!=l.length&&-1!=l.indexOf(t.value.concept))});return u[i]||u[u.length-1]},setDataSourceForAllSubhooks:function(t){var e={};this.getSubhooks().forEach(function(i){e[i._name]={data:t}}),this.set(e,null,!1)},validate:function(){var t=this.getDimension(),e=this._visible.map(function(e){return e[t]});e.length&&(this.select=this.select.filter(function(i){return-1!==e.indexOf(i[t])}),this.setHighlight(this.highlight.filter(function(i){return-1!==e.indexOf(i[t])})))},setVisible:function(t){this._visible=t},getVisible:function(t){return this._visible},getSelected:function(t){return t?this.select.map(function(e){return e[t]}):this.select},selectMarker:function(t){var e=this,i=this._createValue(t);this.isSelected(t)?this.select=this.select.filter(function(t){return JSON.stringify(e._createValue(t))!==JSON.stringify(i)}):this.select=this.allowSelectMultiple?this.select.concat(i):[i]},selectAll:function(t,e){if(this.allowSelectMultiple){var i=void 0,n=r.unique(this._getAllDimensions({exceptType:"time"}));this.select=this._visible.map(function(t){return i={},n.forEach(function(e){return i[e]=t[e]}),i})}},isSelected:function(t){var e=this,i=JSON.stringify(this._createValue(t));return-1!==this.select.map(function(t){return JSON.stringify(e._createValue(t))===i}).indexOf(!0)},_createValue:function(t){return this._getAllDimensions({exceptType:"time"}).reduce(function(e,i){return e[i]=t[i],e},{})},getHighlighted:function(t){return t?this.highlight.map(function(e){return e[t]}):this.highlight},setHighlight:function(t){r.isArray(t)?this.getModelObject("highlight").set(t,!1,!1):this.setHighlight([].concat(t))},setSuperHighlight:function(t){this.getModelObject("superHighlight").set(r.isArray(t)?t:[t],!1,!1)},clearSuperHighlighted:function(){this.setSuperHighlight([])},isSuperHighlighted:function(t){var e=JSON.stringify(this._createValue(t));return~this.superHighlight.findIndex(function(t){return JSON.stringify(t)===e})},setSelect:function(t){r.isArray(t)?this.getModelObject("select").set(t):this.setSelect([].concat(t))},highlightMarker:function(t){var e=this._createValue(t);this.isHighlighted(t)||this.setHighlight(this.highlight.concat(e))},unhighlightEntity:function(t){var e=this._createValue(t);this.isHighlighted(t)&&this.setHighlight(this.highlight.filter(function(t){return t[dimension]!==e}))},isHighlighted:function(t){var e=this,i=JSON.stringify(this._createValue(t));return-1!==this.highlight.map(function(t){return JSON.stringify(e._createValue(t))===i}).indexOf(!0)},clearHighlighted:function(){this.setHighlight([])},clearSelected:function(){this.select=[]},setLabelOffset:function(t,e){if(0!==e[0]||1!==e[1]){var i=r.unique(this._getAllDimensions({exceptType:"time"})),n=i.join(",");this.select.find(function(e){return r.getKey(e,i)==t[n]}).labelOffset=[Math.round(1e3*e[0])/1e3,Math.round(1e3*e[1])/1e3],this.set("select",this.select,!0)}},getTimeLimits:function(){var t=this,e=this._parent.time,i=[],n=[],o=void 0,a=void 0,s={};this.cachedTimeLimits||(this.cachedTimeLimits={}),r.forEach(this.getSubhooks(),function(l){if("indicator"===l.use&&l.which!=e.dim&&l._important&&l._dataId){var u=t.cachedTimeLimits[l._dataId+l.which];u?(o=u.min,a=u.max):(0==(s=l.getValidItems().map(function(t){return t[e.getDimension()]})).length&&r.warn("getTimeLimits() was unable to work with an empty array of valid datapoints"),o=d3.min(s),a=d3.max(s)),t.cachedTimeLimits[l._dataId+l.which]={min:o,max:a},i.push(o),n.push(a)}});var l=d3.max(i),u=d3.min(n);return l>u&&(r.warn("getTimeLimits(): Availability of the indicator's data has no intersection. I give up and just return some valid time range where you'll find no data points. Enjoy!"),l=d3.min(i),u=d3.max(n)),!(!o&&!a)&&{min:l,max:u}},getImportantHooks:function(){var t=[];return r.forEach(this._dataCube||this.getSubhooks(!0),function(e,i){e._important&&t.push(i)}),t},getLabelHookNames:function(){var t=this;return r.unique(this._getAllDimensions({exceptType:"time"})).reduce(function(e,i){var n={};r.forEach(t._dataCube||t.getSubhooks(!0),function(t,e){if("property"===t.use)return"label"===t._type&&t.getEntity().dim===i&&(n.label=e),"label"!==t._type&&t.getEntity().dim===i&&(n.key=e),!n.label||!n.key});var o=n.label||n.key;return o&&(e[i]=o),e},{})},getDataKeysPerHook:function(){var t={};return r.forEach(this._dataCube||this.getSubhooks(!0),function(e,i){t[i]=e.getDataKeys()}),t},getKeys:function(t){var e=void 0;t=t||r.unique(this._getAllDimensions({exceptType:"time"})),t=Array.isArray(t)?t:[t];var i=this._getFirstDimension({type:"time"}),n=this._dataCube||this.getSubhooks(!0),o=t.map(function(t){return[]}),a=t.map(function(t){return[]});return r.forEach(n,function(e,i){if("property"===e.use){var n=t.indexOf(e.getEntity().dim);-1===n||a[n].includes(e.dataSource)||(o[n].push(e),a[n].push(e.dataSource))}}),r.forEach(n,function(e,i){"indicator"===e.use&&e.getDataKeys().forEach(function(i){var n=t.indexOf(i);-1===n||a[n].includes(e.dataSource)||o[n].push(e)})}),o.forEach(function(n,o){var a=[];n.forEach(function(e){var n=e.getDataKeys(),r=n.indexOf(t[o]);a=a.concat(Object.keys(e.getNestedItems(n.concat(i))).map(function(t){return[JSON.parse(t)[r]]}))}),a=r.unique(a),e=e?d3.cross(e,a,function(t,e){return t.concat(e)}):a}),r.forEach(n,function(n,r){if(n._important&&"constant"!==n.use){var o=n.getDataKeys(),a=o.map(function(e){return t.indexOf(e)}).reduce(function(t,e,i){return-1!==e&&(t[i]=e),t},[]);if(a.length){var s=n.getNestedItems(o.concat(i)),l=n.getHaveNoDataPointsPerKey(),u=Object.keys(s),c=Object.keys(l||[]),h=(t.every(function(t,e){return t===o[e]}),u.reduce(function(t,e){return-1==c.indexOf(e)&&(t[JSON.stringify(a.map(function(t,i){return JSON.parse(e)[i]}))]=!0),t},{})),d=e.map(function(t){return JSON.stringify(a.map(function(e){return t[e]}))});e=e.filter(function(t,e){return h[d[e]]})}}}),e.length>this.limit&&(r.warn("MARKER getKeys(): only showing the first "+this.limit+" markerElements of "+this._name+". The rest are not displayed because chart may become slow and crash. Set a higher number in marker.limit or apply entity filters"),e=e.slice(0,this.limit)),e.map(function(e){var i={};return t.map(function(t,n){return i[t]=e[n]}),i})},_getCachePath:function(t){var e=this._parent.time.getAllSteps(),i=this.getClosestModel("locale").id+" - "+e[0]+" - "+e[e.length-1]+" - step:"+this._parent.time.step;this._dataCube=this._dataCube||this.getSubhooks(!0);var n=!1;return r.forEach(this._dataCube,function(t,e){t._loadCall&&(n=!0),i=i+"_"+t._dataId+t.which}),n?null:(t&&(i=i+"_"+t.join(",")),i)},_getGrouping:function(){var t=this._dataCube||this.getSubhooks(!0),e=t[Object.keys(t)[0]]._space,i={};return r.forEach(e,function(t){t.grouping&&(i[t.dim]={grouping:t.grouping})}),!r.isEmpty(i)&&i},_getAllDimensions:function(t){var e=[],i=this;r.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=[],o=void 0;return r.forEach(e,function(e){return!(!t.exceptType||e.getType()!==t.exceptType)||(!(!t.onlyType||e.getType()===t.onlyType)||void((o=e.getDimension())&&n.push(o)))}),n},_getFirstDimension:function(t){var e=[],i=this;r.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=!1;return r.forEach(e,function(e){return t.exceptType&&e.getType()!==t.exceptType?(n=e.getDimension(),!1):t.type&&e.getType()===t.type?(n=e.getDimension(),!1):t.exceptType||t.type?void 0:(n=e.getDimension(),!1)}),n},framesAreReady:function(){var t=this._getCachePath();return!!this.cachedFrames&&Object.keys(this.cachedFrames[t]).length==this._parent.time.getAllSteps().length},getFrame:function(t,e,i){var n=this;this.cachedFrames||(this.cachedFrames={});var o=this._parent.time.getAllSteps(),a=this._getCachePath();if(!a)return e(null,t);if(t&&n.cachedFrames[a]&&n.cachedFrames[a][t])return e(n.cachedFrames[a][t],t);if(!(a=this._getCachePath(i)))return e(null,t);if(t&&n.cachedFrames[a]&&n.cachedFrames[a][t])return e(n.cachedFrames[a][t],t);if(t&&o.length>1){var s=d3.bisectLeft(o,t);if(!o[s])return r.warn("The requested frame is out of range: "+t),e(null,t),null;if(o[s].toString()!=t.toString())return this._interpolateBetweenFrames(t,s,o,function(i){e(i,t)},i),null}n.getFrames(t,i).then(function(){return!t&&n.cachedFrames[a]?e(n.cachedFrames[a],t):n.cachedFrames[a]&&n.cachedFrames[a][t]?e(n.cachedFrames[a][t],t):(r.warn("marker.js getFrame: Data is not available for frame: "+t),e(null,t))})},_interpolateBetweenFrames:function(t,e,i,n,o){var a=this;if(0==e)this.getFrame(i[e],function(t){return n(t)},o);else{var s=i[e-1],l=i[e];this.getFrame(s,function(e){a.getFrame(l,function(i){var o=(t-s)/(l-s),a={};r.forEach(e,function(e,n){a[n]={},r.forEach(e,function(e,s){var l=i[n][s];r.isDate(e)?a[n][s]=t:r.isNumber(e)?a[n][s]=null==e||null==l?null:e+(l-e)*o:a[n][s]=e})}),n(a)},o)},o)}},getFrames:function(t,e){var i=this;this.cachedFrames||(this.cachedFrames={});var n=r.unique(this._getAllDimensions({exceptType:"time"})),o=this._getFirstDimension({type:"time"});this.frameQueues||(this.frameQueues={}),this.partialResult||(this.partialResult={});var a=this._parent.time.getAllSteps(),s=this._getCachePath(e);return s?(this.frameQueues[s]&&this.frameQueues[s]instanceof Promise||(this.frameQueues[s]=new Promise(function(t,u){i.partialResult[s]={},i.partialResult[s].timeOrConstantHooks=[],a.forEach(function(t){i.partialResult[s][t]={}});var c=[];if(r.forEach(i._dataCube,function(t,e){if("constant"===t.use||t.which===o)i.partialResult[s].timeOrConstantHooks.push({name:e,which:t.which});else if(n.includes(t.which)){var r=t.getValidItems();a.forEach(function(n){i.partialResult[s][n][e]={},r.forEach(function(r){i.partialResult[s][n][e][r[t.which]]=r[t.which]})})}else c.push(t)}),c.length>0){var h=[];r.forEach(c,function(t){h.push(new Promise(function(n,o){var l=t._name,u=t.which;t.getFrames(a,e).then(function(t){r.forEach(t,function(t,e){i.partialResult[s][e][l]=t[u]}),n()})}))}),Promise.all(h).then(function(){l(),i.cachedFrames[s]=i.partialResult[s],t()})}else l(),i.cachedFrames[s]=i.partialResult[s],t()})),new Promise(function(u,c){if(a.length<2||!t)i.frameQueues[s].then(function(){u()});else{var h=[];r.forEach(i._dataCube,function(r,l){var u,c;"constant"===r.use||n.includes(r.which)||r.which===o||(u=r,c=l,h.push(new Promise(function(n,r){u.getFrame(a,t,e).then(function(e){i.partialResult[s][t][c]=e[t][u.which],n()})})))}),h.length>0?Promise.all(h).then(function(){l(),i.cachedFrames[s]||(i.cachedFrames[s]={}),i.cachedFrames[s][t]=i.partialResult[s][t],u()}):u()}})):new Promise(function(t,e){t()});function l(){if(i.partialResult[s].timeOrConstantHooks){var t=i.partialResult[s].timeOrConstantHooks,e=i.getKeys();t.forEach(function(t){var l=t.which,u=t.name,c=l===o;a.forEach(function(t){i.partialResult[s][t][u]={},e.forEach(function(e){i.partialResult[s][t][u][r.getKey(e,n)]=c?new Date(t):l})})}),delete i.partialResult[s].timeOrConstantHooks}}},listenFramesQueue:function(t,e){var i=this,n=r.unique(this._getAllDimensions({exceptType:"time"})),o=this._getFirstDimension({type:"time"}),a=this._parent.time.getAllSteps(),s={};this.getFrames();var l=[],u=a.length,c=!1;r.forEach(i._dataCube,function(r,h){"constant"===r.use||n.includes(r.which)||r.which===o||l.includes(r._dataId)||(l.push(r._dataId),r.dataSource.listenFrame(r._dataId,a,t,function(t,n){var r=n.toString();void 0===s[r]&&(s[r]=[]),s[r].includes(t)||s[r].push(t),s[r].length===l.length&&(c||u!==Object.keys(s).length||(c=!0,i.trigger("dataLoaded")),e(n))}))})},getEntityLimits:function(t){var e=this,i=this._parent.time.getAllSteps(),n=[],o=[];r.forEach(e.getSubhooks(),function(t){"constant"!=t.use&&t._important&&o.push(t._name)});var a=function n(r,a){var s=r();null!=s&&e.getFrame(i[s],function(e){!function(e){if(!e)return!1;for(var i=0,n=o.length;i<n;i++)if(!e[o[i]][t]&&0!==e[o[i]][t])return!1;return!0}(e)?n(r,a):a(s)})},s=[];return s.push(new Promise(function(t,e){var r,o;a((r=i.length,o=0,function(){return o<r?o++:null}),function(e){n[0]=i[e],t()})})),s.push(new Promise(function(t,e){var r;a((r=i.length-1,function(){return r>=0?r--:null}),function(e){n[1]=i[e],t()})})),Promise.all(s).then(function(){return{min:n[0],max:n[1]}})},getCompoundLabelText:function(t,e){var i=this._root.dataManager,n=r.unique(this._getAllDimensions({exceptType:"time"})),o=this.getLabelHookNames(),a=n.filter(function(e){return t[e]!==i.getConceptProperty(e,"totals_among_entities")}).map(function(i){return e[o[i]]&&e[o[i]][t[i]]||t[i]}).join(", ");return""===a&&(a=this._root.locale.getTFunction()("hints/grandtotal")),a},getSpace:function(){if(r.isArray(this.space))return this.space;r.error('ERROR: space not found.\n You must specify the objects this hook will use under the "space" attribute in the state.\n Example:\n space: ["entities", "time"]')}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(6);var a={EXTENT_MIN:0,EXTENT_MAX:1,BAR_WIDTH:6,THUMB_HEIGHT:20,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,ROUND_DIGITS:2},s={small:{},medium:{},large:{}},l=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){this.name=this.name||"brushslider";var n=r.extend({},a);this.options=r.extend(n,this.options||{});var o=r.extend({},s);this.profiles=r.extend(o,this.profiles||{}),this.template=this.template||i(402),this.arg=t.arg||"extent",this.model_expects=this.model_expects||[{name:"submodel"},{name:"locale",type:"locale"}],this.model_binds=this.model_binds||{},this.model_binds.ready||(this.model_binds.ready=this.readyHandler.bind(this)),this.model_binds["change:submodel."+this.arg]||(this.model_binds["change:submodel."+this.arg]=this.changeHandler.bind(this)),this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var i=this._valueToExtent(this.model.submodel[this.arg])||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(i)},readyHandler:function(t){},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-slider-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-slider").classed("vzb-slider-"+this.name,!0);var e=this.options,i=e.BAR_WIDTH,n=.5*e.THUMB_HEIGHT,r=(this.padding={top:.5*i,left:n,right:n,bottom:n+e.THUMB_STROKE_WIDTH},this._getComponentWidth()||0);r<0&&(r=0),this.rescaler=d3.scaleLinear().domain([e.EXTENT_MIN,e.EXTENT_MAX]).range([0,r]).clamp(!0),this.brushEventListeners=this._getBrushEventListeners(),this.brush=d3.brushX().handleSize(2*n+2*i).on("start",this.brushEventListeners.start).on("brush",this.brushEventListeners.brush).on("end",this.brushEventListeners.end),this.sliderThumbs=this.sliderEl.selectAll(".handle").data([{type:"w"},{type:"e"}],function(t){return t.type}).enter().append("svg").attr("class",function(t){return"handle handle--"+t.type+" "+t.type}).classed("vzb-slider-thumb",!0),this._createThumbs(this.sliderThumbs.append("g").attr("class","vzb-slider-thumb-badge")),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".selection,.overlay").attr("height",i).attr("rx",.25*i).attr("ry",.25*i).attr("transform","translate(0,"+.5*-i+")"),this.on("resize",function(){t._resize(),t._updateView()})},ready:function(){this.isRTL=this.model.locale.isRTL(),this._resize(),this._updateView()},_getBrushEventListeners:function(){var t=this;return{start:function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1])t.sliderEl.node().__brush.selection[1][0]+=.01;t._setFromExtent(!1,!1,!1)}},brush:function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1])t.sliderEl.node().__brush.selection[1][0]+=.01;t._setFromExtent(!0,!1,!1)}},end:function(){!t.nonBrushChange&&d3.event.sourceEvent&&t._setFromExtent(!0,!0)}}},_createThumbs:function(t){var e=this.options.BAR_WIDTH,i=.5*this.options.THUMB_HEIGHT;t.append("path").attr("d","M"+(i+e)+" "+(i+1.5*e)+"l"+-i+" "+1.5*i+"h"+2*i+"Z")},_updateThumbs:function(t){},_updateSize:function(){var t=this._getComponentWidth()+this.padding.left+this.padding.right;this.sliderSvg.attr("height",this._getComponentHeight()+this.padding.top+this.padding.bottom).attr("width",t),this.sliderWrap.attr("transform",this.isRTL?"translate("+(t-this.padding.right)+","+this.padding.top+") scale(-1,1)":"translate("+this.padding.left+","+this.padding.top+")")},_resize:function(){this._updateSize();var t=this._getComponentWidth();this.rescaler.range([0,t])},_getComponentWidth:function(){var t=this.element.node().offsetWidth-this.padding.left-this.padding.right;return t<0?0:t},_getComponentHeight:function(){return this.options.BAR_WIDTH},_updateView:function(){this.sliderEl.call(this.brush.extent([[0,0],[this._getComponentWidth(),this._getComponentHeight()]]));var t=this._valueToExtent(this.model.submodel[this.arg])||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._moveBrush(t)},_moveBrush:function(t){var e=t.map(this.rescaler);this.nonBrushChange=!0,this.sliderEl.call(this.brush.move,[e[0],e[1]+.01]),this.nonBrushChange=!1,this._setFromExtent(!1,!1,!1)},_valueToExtent:function(t){return t},_extentToValue:function(t){return t},_setFromExtent:function(t,e,i){var n=d3.brushSelection(this.sliderEl.node());n&&(n=[this.rescaler.invert(n[0]),this.rescaler.invert(+n[1].toFixed(1))],this._updateThumbs(n),t&&this._setModel(n,e,i))},_setModel:function(t,e,i){var n=this.options.ROUND_DIGITS;t=[+t[0].toFixed(n),+t[1].toFixed(n)];var r={};r[this.arg]=this._extentToValue(t),this.model.submodel.set(r,e,i)}});e.default=l},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n=i(5),r=i(3).document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,i){var n=i(3),r=i(25),o=i(39),a=i(114),s=i(9).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=o?{}:n.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:a.f(t)})}},function(t,e,i){var n=i(61)("keys"),r=i(38);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var n=i(3).document;t.exports=n&&n.documentElement},function(t,e,i){var n=i(5),r=i(2),o=function(t,e){if(r(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{(n=i(22)(Function.call,i(19).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return o(t,i),e?t.__proto__=i:n(t,i),t}}({},!1):void 0),check:o}},function(t,e){t.exports="\t\n\v\f\r \u2028\u2029\ufeff"},function(t,e,i){var n=i(5),r=i(84).set;t.exports=function(t,e,i){var o,a=e.constructor;return a!==i&&"function"==typeof a&&(o=a.prototype)!==i.prototype&&n(o)&&r&&r(t,o),t}},function(t,e,i){"use strict";var n=i(28),r=i(27);t.exports=function(t){var e=String(r(this)),i="",o=n(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(i+=e);return i}},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e){var i=Math.expm1;t.exports=!i||i(10)>22025.465794806718||i(10)<22025.465794806718||-2e-17!=i(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:i},function(t,e,i){var n=i(28),r=i(27);t.exports=function(t){return function(e,i){var o,a,s=String(r(e)),l=n(i),u=s.length;return l<0||l>=u?t?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===u||(a=s.charCodeAt(l+1))<56320||a>57343?t?s.charAt(l):o:t?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}}},function(t,e,i){"use strict";var n=i(39),r=i(0),o=i(15),a=i(14),s=i(53),l=i(92),u=i(51),c=i(20),h=i(7)("iterator"),d=!([].keys&&"next"in[].keys()),f=function(){return this};t.exports=function(t,e,i,p,m,v,g){l(i,e,p);var y,_,b,x=function(t){if(!d&&t in E)return E[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},w=e+" Iterator",S="values"==m,M=!1,E=t.prototype,z=E[h]||E["@@iterator"]||m&&E[m],k=z||x(m),T=m?S?x("entries"):k:void 0,O="Array"==e&&E.entries||z;if(O&&(b=c(O.call(new t)))!==Object.prototype&&b.next&&(u(b,w,!0),n||"function"==typeof b[h]||a(b,h,f)),S&&z&&"values"!==z.name&&(M=!0,k=function(){return z.call(this)}),n&&!g||!d&&!M&&E[h]||a(E,h,k),s[e]=k,s[w]=f,m)if(y={values:S?k:x("values"),keys:v?k:x("keys"),entries:T},g)for(_ in y)_ in E||o(E,_,y[_]);else r(r.P+r.F*(d||M),e,y);return y}},function(t,e,i){"use strict";var n=i(42),r=i(37),o=i(51),a={};i(14)(a,i(7)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(a,{next:r(1,i)}),o(t,e+" Iterator")}},function(t,e,i){var n=i(65),r=i(27);t.exports=function(t,e,i){if(n(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(r(t))}},function(t,e,i){var n=i(7)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[n]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,i){var n=i(53),r=i(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||o[r]===t)}},function(t,e,i){"use strict";var n=i(9),r=i(37);t.exports=function(t,e,i){e in t?n.f(t,e,r(0,i)):t[e]=i}},function(t,e,i){var n=i(58),r=i(7)("iterator"),o=i(53);t.exports=i(25).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||o[n(t)]}},function(t,e,i){var n=i(280);t.exports=function(t,e){return new(n(t))(e)}},function(t,e,i){"use strict";var n=i(11),r=i(41),o=i(10);t.exports=function(t){for(var e=n(this),i=o(e.length),a=arguments.length,s=r(a>1?arguments[1]:void 0,i),l=a>2?arguments[2]:void 0,u=void 0===l?i:r(l,i);u>s;)e[s++]=t;return e}},function(t,e,i){"use strict";var n=i(36),r=i(130),o=i(53),a=i(18);t.exports=i(91)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(t,e,i){var n,r,o,a=i(22),s=i(120),l=i(83),u=i(79),c=i(3),h=c.process,d=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,m=c.Dispatch,v=0,g={},y=function(){var t=+this;if(g.hasOwnProperty(t)){var e=g[t];delete g[t],e()}},_=function(t){y.call(t.data)};d&&f||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return g[++v]=function(){s("function"==typeof t?t:Function(t),e)},n(v),v},f=function(t){delete g[t]},"process"==i(23)(h)?n=function(t){h.nextTick(a(y,t,1))}:m&&m.now?n=function(t){m.now(a(y,t,1))}:p?(o=(r=new p).port2,r.port1.onmessage=_,n=a(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(t){c.postMessage(t+"","*")},c.addEventListener("message",_,!1)):n="onreadystatechange"in u("script")?function(t){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),y.call(t)}}:function(t){setTimeout(a(y,t,1),0)}),t.exports={set:d,clear:f}},function(t,e,i){var n=i(3),r=i(101).set,o=n.MutationObserver||n.WebKitMutationObserver,a=n.process,s=n.Promise,l="process"==i(23)(a);t.exports=function(){var t,e,i,u=function(){var n,r;for(l&&(n=a.domain)&&n.exit();t;){r=t.fn,t=t.next;try{r()}catch(n){throw t?i():e=void 0,n}}e=void 0,n&&n.enter()};if(l)i=function(){a.nextTick(u)};else if(!o||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var c=s.resolve();i=function(){c.then(u)}}else i=function(){r.call(n,u)};else{var h=!0,d=document.createTextNode("");new o(u).observe(d,{characterData:!0}),i=function(){d.data=h=!h}}return function(n){var r={fn:n,next:void 0};e&&(e.next=r),t||(t=r,i()),e=r}}},function(t,e,i){"use strict";var n=i(13);t.exports.f=function(t){return new function(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=n}),this.resolve=n(e),this.reject=n(i)}(t)}},function(t,e,i){"use strict";var n=i(3),r=i(8),o=i(39),a=i(71),s=i(14),l=i(47),u=i(4),c=i(45),h=i(28),d=i(10),f=i(139),p=i(43).f,m=i(9).f,v=i(99),g=i(51),y="prototype",_="Wrong index!",b=n.ArrayBuffer,x=n.DataView,w=n.Math,S=n.RangeError,M=n.Infinity,E=b,z=w.abs,k=w.pow,T=w.floor,O=w.log,C=w.LN2,P=r?"_b":"buffer",A=r?"_l":"byteLength",I=r?"_o":"byteOffset";function L(t,e,i){var n,r,o,a=new Array(i),s=8*i-e-1,l=(1<<s)-1,u=l>>1,c=23===e?k(2,-24)-k(2,-77):0,h=0,d=t<0||0===t&&1/t<0?1:0;for((t=z(t))!=t||t===M?(r=t!=t?1:0,n=l):(n=T(O(t)/C),t*(o=k(2,-n))<1&&(n--,o*=2),(t+=n+u>=1?c/o:c*k(2,1-u))*o>=2&&(n++,o/=2),n+u>=l?(r=0,n=l):n+u>=1?(r=(t*o-1)*k(2,e),n+=u):(r=t*k(2,u-1)*k(2,e),n=0));e>=8;a[h++]=255&r,r/=256,e-=8);for(n=n<<e|r,s+=e;s>0;a[h++]=255&n,n/=256,s-=8);return a[--h]|=128*d,a}function D(t,e,i){var n,r=8*i-e-1,o=(1<<r)-1,a=o>>1,s=r-7,l=i-1,u=t[l--],c=127&u;for(u>>=7;s>0;c=256*c+t[l],l--,s-=8);for(n=c&(1<<-s)-1,c>>=-s,s+=e;s>0;n=256*n+t[l],l--,s-=8);if(0===c)c=1-a;else{if(c===o)return n?NaN:u?-M:M;n+=k(2,e),c-=a}return(u?-1:1)*n*k(2,c-e)}function R(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function j(t){return[255&t]}function F(t){return[255&t,t>>8&255]}function B(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function N(t){return L(t,52,8)}function q(t){return L(t,23,4)}function V(t,e,i){m(t[y],e,{get:function(){return this[i]}})}function H(t,e,i,n){var r=f(+i);if(r+e>t[A])throw S(_);var o=t[P]._b,a=r+t[I],s=o.slice(a,a+e);return n?s:s.reverse()}function U(t,e,i,n,r,o){var a=f(+i);if(a+e>t[A])throw S(_);for(var s=t[P]._b,l=a+t[I],u=n(+r),c=0;c<e;c++)s[l+c]=u[o?c:e-c-1]}if(a.ABV){if(!u(function(){b(1)})||!u(function(){new b(-1)})||u(function(){return new b,new b(1.5),new b(NaN),"ArrayBuffer"!=b.name})){for(var W,K=(b=function(t){return c(this,b),new E(f(t))})[y]=E[y],G=p(E),X=0;G.length>X;)(W=G[X++])in b||s(b,W,E[W]);o||(K.constructor=b)}var Y=new x(new b(2)),Z=x[y].setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||l(x[y],{setInt8:function(t,e){Z.call(this,t,e<<24>>24)},setUint8:function(t,e){Z.call(this,t,e<<24>>24)}},!0)}else b=function(t){c(this,b,"ArrayBuffer");var e=f(t);this._b=v.call(new Array(e),0),this[A]=e},x=function(t,e,i){c(this,x,"DataView"),c(t,b,"DataView");var n=t[A],r=h(e);if(r<0||r>n)throw S("Wrong offset!");if(r+(i=void 0===i?n-r:d(i))>n)throw S("Wrong length!");this[P]=t,this[I]=r,this[A]=i},r&&(V(b,"byteLength","_l"),V(x,"buffer","_b"),V(x,"byteLength","_l"),V(x,"byteOffset","_o")),l(x[y],{getInt8:function(t){return H(this,1,t)[0]<<24>>24},getUint8:function(t){return H(this,1,t)[0]},getInt16:function(t){var e=H(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=H(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return R(H(this,4,t,arguments[1]))},getUint32:function(t){return R(H(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return D(H(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return D(H(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){U(this,1,t,j,e)},setUint8:function(t,e){U(this,1,t,j,e)},setInt16:function(t,e){U(this,2,t,F,e,arguments[2])},setUint16:function(t,e){U(this,2,t,F,e,arguments[2])},setInt32:function(t,e){U(this,4,t,B,e,arguments[2])},setUint32:function(t,e){U(this,4,t,B,e,arguments[2])},setFloat32:function(t,e){U(this,4,t,q,e,arguments[2])},setFloat64:function(t,e){U(this,8,t,N,e,arguments[2])}});g(b,"ArrayBuffer"),g(x,"DataView"),s(x[y],a.VIEW,!0),e.ArrayBuffer=b,e.DataView=x},function(t,e,i){var n=i(3).navigator;t.exports=n&&n.userAgent||""},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t.match(/\//g).length};e.default=function(t,e){var i=t.keys();return e&&(i=i.filter("function"==typeof e?function(t){return e(n(t))}:function(t){return n(t)===e+1})),i.reduce(function(e,i){var n=/([^/]+)\..+$/.exec(i)[1];try{var r=t(i);e[n]=r.default||r}catch(t){console.warn("Import error",i,t)}return e},{})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(32);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({_important:!0,getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,fixBaseline:null,scaleType:"linear",allow:{scales:["linear","log","genericLog","time","pow"]}})},autoconfigureModel:function(t){!this.which&&this.autoconfig&&"axis"===this._type&&(t=this._parent.getAvailableConcept(this.autoconfig)||this._parent.getAvailableConcept({type:"time"})),this._super(t)},_type:"axis",validate:function(){if(this._super(),this.scale&&"time"==this.scaleType){var t={};null==this.zoomedMin||r.isDate(this.zoomedMin)||(t.zoomedMin=this._space.time.parse(this.zoomedMin.toString())),null==this.zoomedMax||r.isDate(this.zoomedMax)||(t.zoomedMax=this._space.time.parse(this.zoomedMax.toString())),this.set(t)}},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=void 0;if("time"==t){var i=this._space.time,n=i.splash?{min:i.parse(i.startOrigin),max:i.parse(i.endOrigin)}:{min:i.start,max:i.end};e=[n.min,n.max],this.scale=d3.scaleUtc().domain(e)}else{if(this.isDiscrete())e="constant"===this.use?[this.which]:this.getUnique(this.which);else{var o=this.getLimits(this.which);(e=[o.min,o.max])[0]=(this.fixBaseline||0===this.fixBaseline)&&o.min>0?+this.fixBaseline:e[0],e[0]=null!=this.domainMin?+this.domainMin:e[0],e[1]=null!=this.domainMax?+this.domainMax:e[1]}var a=("ordinal"===(t=d3.min(e)<=0&&d3.max(e)>=0&&"log"===t?"genericLog":t)?"point":t)||"linear";this.scale=d3["scale"+r.capitalize(a)]().domain(e)}this.scaleType=t},formatDate:function(t){return this._space.time.formatDate(t)},_getZoomed:function(t){var e=this["zoomed"+t];return null!==e?e:d3[t.toLowerCase()](this.getScale().domain())},getZoomedMin:function(){return this._getZoomed("Min")},getZoomedMax:function(){return this._getZoomed("Max")}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=l(i(48)),o=l(i(75)),a=l(i(49)),s=i(394);function l(t){return t&&t.__esModule?t:{default:t}}var u=r.default.extend({getClassDefaults:function(){return n.deepExtend(this._super(),{reader:"csv"})},trackInstances:!0,init:function(t,e,i,n){this._type="data",this.queryQueue={},this._collection={},this._collectionPromises={},this._super(t,e,i,n),this.readerObject=this.getReader()},preloadData:function(){return this.loadDataAvailability().then(this.loadConceptProps.bind(this))},load:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];this.dataset&&(t.dataset=this.dataset),this.version&&(t.version=this.version);var o=s.DataStorage.getDataId(t,this.readerObject,i);return o?t.grouping?s.DataStorage.aggregateData(o,t,this.readerObject,this.getConceptprops()):Promise.resolve(o):(n.timeStamp("Vizabi Data: Loading Data"),r||a.default.freezeAll(["hook_change","resize"]),s.DataStorage.loadFromReader(t,i,this.readerObject).then(function(i){return t.grouping?s.DataStorage.aggregateData(i,t,e.readerObject,e.getConceptprops()):i}).then(function(t){return r||a.default.unfreezeAll(),t}).catch(function(t){r||a.default.unfreezeAll(),e.handleLoadError(t)}))},getAsset:function(t,e){var i=this;return this.readerObject.getAsset(t).then(function(t){return e(t)}).catch(function(t){return i.handleLoadError(t)})},getReader:function(){var t=o.default.get(this.reader);if(!t)throw new Error("Unknown reader: "+this.reader);return new t(this.getPlainObject())},getData:function(t,e,i,r){return t?s.DataStorage.getData(t,e,i,r):n.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)},loadDataAvailability:function(){var t=this,e={select:{key:["key","value"],value:[]},from:"concepts.schema"},i=n.extend({},e,{from:"entities.schema"}),r=n.extend({},e,{from:"datapoints.schema"});return Promise.all([this.load(e),this.load(i),this.load(r)]).then(this.handleDataAvailabilityResponse.bind(this)).catch(function(e){return t.handleLoadError(e)})},handleDataAvailabilityResponse:function(t){var e=this;this.keyAvailability=new Map,this.dataAvailability=[],t.forEach(function(t){var i=e.getData(t,"query").from.split(".")[0];e.dataAvailability[i]=[],e.getData(t).forEach(function(t){var n=("string"==typeof t.key?JSON.parse(t.key):t.key).sort();e.dataAvailability[i].push({key:new Set(n),value:t.value}),e.keyAvailability.set(n.join(","),n)})})},loadConceptProps:function(){var t=this,e=this.dataAvailability.concepts.map(function(t){return t.value}),i={select:{key:["concept"],value:["concept_type","domain","totals_among_entities","indicator_url","color","scales","interpolation","tags","name","name_short","name_catalog","description","format"].filter(function(t){return e.includes(t)})},from:"concepts",where:{},language:this.getClosestModel("locale").id};return this.load(i).then(this.handleConceptPropsResponse.bind(this)).catch(function(e){return t.handleLoadError(e)})},handleConceptPropsResponse:function(t){var e=this;this.conceptDictionary={_default:{concept:"_default",concept_type:"string",use:"constant",scales:["ordinal"],tags:"_root"}},this.conceptArray=[],this.getData(t).forEach(function(t){var i={};i.concept=t.concept,i.concept_type=t.concept_type,i.sourceLink=t.indicator_url;try{i.color=t.color&&""!==t.color?"string"==typeof t.color?JSON.parse(t.color):t.color:null}catch(t){i.color=null}try{i.scales=t.scales&&""!==t.color?"string"==typeof t.scales?JSON.parse(t.scales):t.scales:null}catch(t){i.scales=null}if(!i.scales)switch(t.concept_type){case"measure":i.scales=["linear","log"];break;case"string":case"entity_domain":case"entity_set":case"boolean":i.scales=["ordinal"];break;case"time":i.scales=["time"];break;default:i.scales=["linear","log"]}t.interpolation?i.interpolation=t.interpolation:"measure"==t.concept_type?i.interpolation=i.scales&&"log"==i.scales[0]?"exp":"linear":"time"==t.concept_type?i.interpolation="linear":i.interpolation="stepMiddle",i.domain=t.domain,i.totals_among_entities=t.totals_among_entities,i.tags=t.tags,i.format=t.format,i.name=t.name||t.concept||"",i.name_catalog=t.name_catalog||"",i.name_short=t.name_short||t.name||t.concept||"",i.description=t.description,e.conceptDictionary[t.concept]=i,e.conceptArray.push(i)})},getConceptprops:function(t){return void 0!==t?this.conceptDictionary[t]?this.conceptDictionary[t]:(n.warn("The concept "+t+" is not found in the dictionary"),null):this.conceptDictionary},getConcept:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index,i=void 0===e?0:e,n=t.type,r=void 0===n?null:n,o=t.includeOnlyIDs,a=void 0===o?[]:o,s=t.excludeIDs,l=void 0===s?[]:s;if(!r&&0==a.length&&0==l.length)return null;var u=this.conceptArray.filter(function(t){return!(r&&t.concept_type&&t.concept_type!==r||0!=a.length&&-1===a.indexOf(t.concept)||0!=l.length&&-1!=l.indexOf(t.concept))});return u[i]||u[u.length-1]},getDatasetName:function(){if(this.readerObject.getDatasetInfo){var t=this.readerObject.getDatasetInfo();return t.name+(t.version?" "+t.version:"")}return this._name},setGrouping:function(t,e){s.DataStorage.setGrouping(t,e)},getFrames:function(t,e,i){return s.DataStorage.getFrames(t,e,i,this.getConceptprops())},getFrame:function(t,e,i,n){return s.DataStorage.getFrame(t,e,i,n)},listenFrame:function(t,e,i,n){s.DataStorage.listenFrame(t,e,i,n)},handleLoadError:function(t){t.browserDetails=n.getBrowserDetails(),t.osName=n.getOSname(),t.homepoint=window.location.href,t.time=(new Date).toString(),this._super(t)}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(55);function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{show:{},showFallback:{},showItemsMaxCount:null,filter:{},dim:null,skipFilter:!1})},objectLeafs:["show","showFallback","filter","autoconfig"],dataConnectedChildren:["show","dim","grouping"],init:function(t,e,i,n){this._type="entities",this._super(t,e,i,n)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data||"data"),this._super()},afterPreload:function(){this.autoconfigureModel()},autoconfigureModel:function(){if(!this.dim&&this.autoconfig){var t=this.dataSource.getConcept(this.autoconfig);t&&(this.dim=t.concept),r.printAutoconfigResult(this)}},setInterModelListeners:function(){this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},validate:function(){var t=this;if(this._super(),this.showFallback[this.dim]||this.showItemsMaxCount){var e=this.show[this.dim]||this.show.$and&&this.show.$and.filter(function(e){return e[t.dim]})[0];e?e.$in&&this.showItemsMaxCount&&e.$in.length>this.showItemsMaxCount&&(e.$in.splice(0,e.$in.length-this.showItemsMaxCount),this.show=r.deepClone(this.show)):this.showFallback[this.dim]&&(this.show=a({},this.dim,r.deepClone(this.showFallback[this.dim])))}},handleDataConnectedChange:function(t){var e=this;r.defer(function(){e.startLoading().catch(r.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},loadData:function(){var t=this;this.setReady(!1),this._loadCall=!0;var e=this;if(!this.dim)return this._entitySets={},this._entitySetsData={},this._entitySetsValues={},Promise.resolve();var i=this.dim;if(this._entitySets=a({},i,this._root.dataManager.getAvailableDataForKey(i,null,"entities").filter(function(e){return e.value!==i&&["entity_set","entity_domain"].includes(t._root.dataManager.getConceptProperty(e.value,"concept_type"))}).map(function(t){return t.value})),!this._entitySets[i].length)return this._entitySetsValues=a({},i,[]),this._entitySetsData=a({},i,{}),Promise.resolve();var n={language:this.getClosestModel("locale").id},r=[this._root.dataManager.getDimensionValues(i,this._entitySets[i],n)].concat(this._entitySets[i].map(function(e){return t._root.dataManager.getDimensionValues(e,["name"],n)}));return Promise.all(r).then(function(t){e._entitySetsValues=a({},i,t[0]),e._entitySetsData=a({},i,{}),e._entitySets[i].forEach(function(n,r){e._entitySetsData[i][n]=t[r+1]})})},getEntitySets:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this["_entitySets"+r.capitalize(t)][this.dim]},getDimension:function(){return this.dim},setDimension:function(t){if(this.dim!==t){var e={show:{}};e.dim=t,this.set(e)}},getFilter:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).entityTypeRequest,e=r.deepClone(this.filter[this.dim]||{});if(t||this.skipFilter)return e;var i=r.deepClone(this.show);i[this.dim]&&r.isEmpty(i[this.dim])&&delete i[this.dim];var n=[];return r.isEmpty(e)||n.push(e),r.isEmpty(i)||n.push(i),n.length>1?{$and:n}:n[0]||{}},showEntity:function(t){var e=this,i=r.deepClone(this.show),n=this.getDimension(),o=void 0;o=r.isArray(t)?t:[t];var s=i[n]||(i.$and||[]).filter(function(t){return t[n]})[0]||{$in:[]};r.forEach(o,function(t){var i=t[n];e.isShown(t)?s.$in=s.$in.filter(function(t){return t!==i}):s.$in=s.$in.concat(i)}),0===s.$in.length?i.$and?i.$and=i.$and.filter(function(t){return!t[n]}):delete i[n]:i.$and?i.$and.push(a({},n,s)):i[n]=s,this.show=i},isShown:function(t){var e=this.getDimension(),i=(this.show[e]||(this.show.$and||[]).filter(function(t){return t[e]})[0]||{}).$in;return(void 0===i?[]:i).includes(t[e])},isInShowFilter:function(t,e){t[this.getDimension()];var i=(this.show.$and||[this.show]).filter(function(t){return t[e]})[0]||{};return r.getProp(i,[e,"$in"],[]).includes(t[e])},clearShow:function(){var t=this.getDimension(),e=r.deepClone(this.show);delete e[t],this.show=e},getFilteredEntities:function(){var t=this.getDimension(),e=(this.show[t]||{}).$in;return(void 0===e?[]:e).map(function(e){return a({},t,e)})},isEntities:function(){return!0}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={build:1524665300706,version:"0.32.3"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function e(i){var r="vertical axis",o="horizontal axis",a="labels stack side by side",s="labels stack top to bottom",l="optimistic approximation: labels have different lengths",u="pessimistic approximation: all labels have the largest length";function c(t,e,i){return i.indexOf(t)===e}function h(t){var e=h.scale().domain(),l=h.scale().range();if(!e[0]&&0!==e[0]||!e[1]&&0!==e[1]||!l[0]&&0!==l[0]||!l[1]&&0!==l[1])return n.warn("d3.axisSmart() skips action because of invalid domain "+JSON.stringify(e)+" or range "+JSON.stringify(l)+" of the attached scale");if(null==f){var u=t.append("g").attr("class","tick widthSampling"),c=u.append("text").text("0");_.cssMargin||(_.cssMargin={}),_.cssMargin.top=c.style("margin-top"),_.cssMargin.bottom=c.style("margin-bottom"),_.cssMargin.left=c.style("margin-left"),_.cssMargin.right=c.style("margin-right"),_.widthOfOneDigit=c.node().getBBox().width,_.heightOfOneDigit=c.node().getBBox().height,u.remove(),h.labelFactory(_);var d=null;_.transitionDuration>0?i(d=t.transition().duration(_.transitionDuration)):i(t),t.attr("fill",null),t.attr("font-size",null),t.attr("font-family",null),t.attr("text-anchor",null);var p="top"==h.orient()||"bottom"==h.orient()?o:r,m=p==o&&h.pivot()||p==r&&!h.pivot()?s:a;t.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text");var v=h.tickPadding();if(t.selectAll("text").each(function(t,e){if(null!=h.pivot()){var i=d3.select(this);i.attr("transform","rotate("+(h.pivot()?-90:0)+")"),i.style("text-anchor",m==a?"middle":"end"),i.attr("x",m==a?p==r?-v:0:-v),i.attr("y",m==a?p==r?0:v:0),i.attr("dx",m==a&&p==r?v:0),i.attr("dy",m==a?p==r?-v:".72em":".32em")}}),null!=h.repositionLabels()){var y=function(){t.selectAll(".tick").each(function(t){var e=d3.select(this).select("text"),i=h.repositionLabels()[t]||{x:0,y:0};e.attr("x",+e.attr("x")+i.x),e.attr("y",+e.attr("y")+i.y)})};d?d.on("end",function(){return y()}):y()}var b=h.scale();_.viewportLength&&t.selectAll(".tick").classed("vzb-hidden",function(t){return b(t)<0||b(t)>_.viewportLength}),null==h.tickValuesMinor()&&h.tickValuesMinor([]);var x=t.selectAll(".tick-minor").data(g);x.exit().remove(),x=x.enter().append("line").attr("class","tick-minor").merge(x);var w=h.tickSizeMinor().outbound,S=h.tickSizeMinor().inbound;x.classed("vzb-hidden",function(t){return b(t)<0||b(t)>_.viewportLength}).attr("y1",p==o?("top"==h.orient()?1:-1)*S:b).attr("y2",p==o?("top"==h.orient()?-1:1)*w:b).attr("x1",p==r?("right"==h.orient()?-1:1)*S:b).attr("x2",p==r?("right"==h.orient()?1:-1)*w:b),t.selectAll("path").remove();var M=t.selectAll(".vzb-axis-line").data([0]);M.exit().remove(),M=M.enter().append("line").attr("class","vzb-axis-line").merge(M),_.viewportLength?M.attr("x1",p==r?0:-1).attr("x2",p==r?0:_.viewportLength).attr("y1",0).attr("y2",p==o?0:_.viewportLength):M.attr("x1",p==r?0:d3.min(b.range())-(_.bump||0)-1).attr("x2",p==r?0:d3.max(b.range())+(_.bump||0)).attr("y1",p==o?0:d3.min(b.range())-(_.bump||0)).attr("y2",p==o?0:d3.max(b.range())+(_.bump||0))}else h.highlightValueRun(t)}h.highlightValueRun=function(t){_.viewportLength&&"none"!=f&&(h.scale()(f)>_.viewportLength||h.scale()(f)<0)&&(f="none");var e="top"==h.orient()||"bottom"==h.orient()?o:r,i=e==o&&h.pivot()||e==r&&!h.pivot()?"y":"x",n=h.pivot()?-1:1;t.select(".vzb-axis-value").classed("vzb-hidden","none"==f);var a=void 0,s={};"none"!=f&&(a=t.select(".vzb-axis-value").node().getBBox(),s.bump=_.bump,s.formatter=_.formatter,s.viewportLength=_.viewportLength,s.toolMargin=_.toolMargin,s.cssMargin=_.cssMargin,s.widthOfOneDigit=a[h.pivot()?"height":"width"]/_.formatter(f).length,s.heightOfOneDigit=a[h.pivot()?"width":"height"]);var l=("none"==f?{x:0,y:0}:x([f],s,e,h.scale(),i)[f])[i],u=function(t){return"none"==f?"translate(0,0)":"translate("+(e==o?h.scale()(f)+l*n:0)+","+(e==r?h.scale()(f)+l*n:0)+")"},c=function(t,r,s){if("none"==f)return 1;var u=e==o?"width":"height",c=((h.repositionLabels()||{})[t]||{x:0,y:0})[i];return h.hlOpacityScale()(Math.abs(h.scale()(t)+c*n-h.scale()(f)-l*n)-s.getBBox()[u]/2-a[u]/2)};p?(t.select(".vzb-axis-value").transition().duration(p).ease(d3.easeLinear).attr("transform",u),t.select(".vzb-axis-value").select("text").transition("text").delay(p).text("none"==f?"":_.formatter(f)),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").transition().duration(p).ease(d3.easeLinear).style("opacity",c(t,e,this))})):(t.select(".vzb-axis-value").interrupt().attr("transform",u).transition(),t.select(".vzb-axis-value").select("text").interrupt("text").text("none"==f?"":_.formatter(f)).transition(),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").interrupt().style("opacity",c(t,e,this)).transition()})),f=null};var d=d3.scaleLinear().domain([0,5]).range([0,1]).clamp(!0);h.hlOpacityScale=function(t){return arguments.length?(d=t,h):d};var f=null;h.highlightValue=function(t){return arguments.length?(f=t,h):f};var p=0;h.highlightTransDuration=function(t){return arguments.length?(p=t,h):p};var m=null;h.repositionLabels=function(t){return arguments.length?(m=t,h):m};var v=!1;h.pivot=function(t){return arguments.length?(v=!!t,h):v};var g=[];h.tickValuesMinor=function(t){return arguments.length?(g=t,h):g};var y={outbound:0,inbound:0};h.tickSizeMinor=function(t,e){return arguments.length?(w("setting",y={outbound:t,inbound:e||0}),h):y};var _={};function b(t,e){null==e&&(e=!0);var i=[],n=[];-1!=t.indexOf(0)&&(i.push([0]),n.push(t.indexOf(0)));for(var r=function(r){i.push(t.filter(function(t,i){return!(i%Math.floor(r)!=0||-1!=n.indexOf(i)&&e)&&(n.push(i),!0)}))},o=t.length;o>=1;o=o<4?o-1:o/2)r(o);return i}function x(t,e,i,n,a){if(!t)return null;var s={},l=i==r?{head:e.toolMargin.top,tail:e.toolMargin.bottom}:{head:e.toolMargin.right,tail:e.toolMargin.left},u=n.range(),c=e.bump;return e.viewportLength&&(t=t.filter(function(t){return n(t)>=0&&n(t)<=e.viewportLength}),u=[0,e.viewportLength],c=0),t.forEach(function(h,d){if(0==d||d==t.length-1){var f=Math.min(l.head,.5*e.widthOfOneDigit)+c+(i==o?1:0)*d3.max(u)-(i==o?0:1)*d3.min(u)+(i==o?-1:1)*n(h)-("x"==a)*e.formatter(h).length*e.widthOfOneDigit/2-("y"==a)*e.heightOfOneDigit/2-("x"==a)*parseInt(e.cssMargin.right)-("y"==a)*parseInt(e.cssMargin.top),p=Math.min(l.tail,.5*e.widthOfOneDigit)+c+(i==r?1:0)*d3.max(u)-(i==r?0:1)*d3.min(u)+(i==r?-1:1)*n(h)-("x"==a)*e.formatter(h).length*e.widthOfOneDigit/2-("y"==a)*e.heightOfOneDigit/2-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom);f>0&&(f=0),p>0&&(p=0),s[h]={x:0,y:0},s[h][a]=("y"==a&&i==r?-1:1)*(f-p)}}),t.forEach(function(l,u){if(0!=u&&u!=t.length-1){var c=Math.abs(n(l)-n(t[t.length-1]))-("y"==a)*(i==o?-1:1)*s[t[t.length-1]][a]-("x"==a)*(i==o?1:-1)*s[t[t.length-1]][a]-("x"==a)*e.widthOfOneDigit/2*e.formatter(l).length-("x"==a)*e.widthOfOneDigit/2*e.formatter(t[t.length-1]).length-("y"==a)*e.heightOfOneDigit*.7-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom),h=Math.abs(n(l)-n(t[0]))-("y"==a)*(i==r?-1:1)*s[t[0]][a]-("x"==a)*(i==r?1:-1)*s[t[0]][a]-("x"==a)*e.widthOfOneDigit/2*e.formatter(l).length-("x"==a)*e.widthOfOneDigit/2*e.formatter(t[0]).length-("y"==a)*e.heightOfOneDigit*.7-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom);c>0&&(c=0),h>0&&(h=0),s[l]={x:0,y:0},s[l][a]=("y"==a&&i==r?-1:1)*(c-h)}}),s}return h.labelerOptions=function(t){return arguments.length?(_=t,h):_},h.METHOD_REPEATING="repeating specified powers",h.METHOD_DOUBLING="doubling the value",h.labelFactory=function(t){if(null==t&&(t={}),"linear"!=t.scaleType&&"time"!=t.scaleType&&"genericLog"!=t.scaleType&&"log"!=t.scaleType&&"ordinal"!=t.scaleType)return h.ticks(t.limitMaxTickNumber).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==t.scaleType)return h;null==t.logBase&&(t.logBase=10),null==t.stops&&(t.stops=[1,2,5,3,7,4,6,8,9]),null==t.removeAllLabels&&(t.removeAllLabels=!1),null==t.formatter&&(t.formatter=h.tickFormat()?h.tickFormat():function(t){return t+""}),t.cssLabelMarginLimit=5,null==t.cssMargin&&(t.cssMargin={}),(null==t.cssMargin.left||parseInt(t.cssMargin.left)<t.cssLabelMarginLimit)&&(t.cssMargin.left=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.right||parseInt(t.cssMargin.right)<t.cssLabelMarginLimit)&&(t.cssMargin.right=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.top||parseInt(t.cssMargin.top)<t.cssLabelMarginLimit)&&(t.cssMargin.top=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.bottom||parseInt(t.cssMargin.bottom)<t.cssLabelMarginLimit)&&(t.cssMargin.bottom=t.cssLabelMarginLimit+"px"),null==t.toolMargin&&(t.toolMargin={left:30,bottom:30,right:30,top:30}),null==t.bump&&(t.bump=0),null==t.viewportLength&&(t.viewportLength=0),null==t.pivotingLimit&&(t.pivotingLimit=t.toolMargin[this.orient()]),null==t.showOuter&&(t.showOuter=!1),null==t.limitMaxTickNumber&&(t.limitMaxTickNumber=0);var e="top"==this.orient()||"bottom"==this.orient()?o:r;null==t.isPivotAuto&&(t.isPivotAuto=e==r),null==t.cssFontSize&&(t.cssFontSize="13px"),null==t.widthToFontsizeRatio&&(t.widthToFontsizeRatio=.75),null==t.heightToFontsizeRatio&&(t.heightToFontsizeRatio=1.2),null==t.widthOfOneDigit&&(t.widthOfOneDigit=parseInt(t.cssFontSize)*t.widthToFontsizeRatio),null==t.heightOfOneDigit&&(t.heightOfOneDigit=parseInt(t.cssFontSize)*t.heightToFontsizeRatio),null!=t.fitIntoScale&&"pessimistic"!=t.fitIntoScale||(t.fitIntoScale=u),"optimistic"==t.fitIntoScale&&(t.fitIntoScale=l),w("********** "+e+" **********");var i=h.scale().domain(),n=h.scale().range(),a=(Math.abs(i[i.length-1]-i[0]),Math.abs(n[n.length-1]-n[0])),s=d3.min([i[0],i[i.length-1]]),d=d3.max([i[0],i[i.length-1]]),f=("linear"==t.scaleType?s<0:s<=0)&&d>=0&&"time"!=t.scaleType,p=t.showOuter?[s,d]:[],m=[],v=5;function g(e,i){return 0==e||0==i?0:(null==i&&(i=t.logBase),Math.log(e)/Math.log(i))}var y=d3.max(d3.range(s,d,(d-s)/17).concat(d).map(function(e){return t.formatter(e).replace(".","").length}))*t.widthOfOneDigit+parseInt(t.cssMargin.left),_=t.isPivotAuto&&(y>t.pivotingLimit&&e==r||!(y>t.pivotingLimit)&&!(e==r)),S=e==o&&_||e==r&&!_,M=!S&&t.heightOfOneDigit>t.pivotingLimit;if(t.removeAllLabels)return h.tickValues([]);if(s==d)return h.tickValues([s]).ticks(1).tickFormat(t.formatter);var E=function(e,i,n,r){if(null==e||e.length<=1)return!0;if(null==n&&(n=u),null==r&&(scaleType="none"),S)return i>e.length*(t.heightOfOneDigit+parseInt(t.cssMargin.top)+parseInt(t.cssMargin.bottom));var o=parseInt(t.cssMargin.left)+parseInt(t.cssMargin.right),a=d3.max(e.map(function(e){return t.formatter(e).length}));return"log"==r?(i=Math.abs(h.scale()(d3.max(e))-h.scale()(d3.min(e))))>d3.sum(e.map(function(e){return(t.widthOfOneDigit*(n==u?a:t.formatter(e).length)+o)*(1+Math.log(e.toString().replace(/([0.])/g,"")[0])/Math.LN10)})):i>e.length*o+(n==u?t.widthOfOneDigit*e.length*a:0)+(n==l?t.widthOfOneDigit*e.map(function(e){return t.formatter(e)}).join("").length:0)},z=function(e,i){if(null==i||0==i.length)return!1;i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++)if(e!=i[n]&&0!=e&&Math.abs(h.scale()(e)-h.scale()(i[n]))<(S?t.heightOfOneDigit:(t.formatter(e).length+t.formatter(i[n]).length)*t.widthOfOneDigit/2))return!0;return!1};if("genericLog"==t.scaleType||"log"==t.scaleType){var k=h.scale().eps?h.scale().eps():0,T=f?[0]:[],O=d<k?[]:d3.range(Math.floor(g(Math.max(k,s))),Math.ceil(g(d)),1).concat(Math.ceil(g(d))).map(function(e){return Math.pow(t.logBase,e)}),C=s>-k?[]:d3.range(Math.floor(g(Math.max(k,-d))),Math.ceil(g(-s)),1).concat(Math.ceil(g(-s))).map(function(e){return-Math.pow(t.logBase,e)});if(null==t.method){var P=f?Math.max(Math.abs(d),Math.abs(s))/k:Math.max(Math.abs(d),Math.abs(s))/Math.min(Math.abs(d),Math.abs(s));t.method=10<=P&&P<=1024?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(t.method==this.METHOD_DOUBLING&&function(){var t=[];f&&p.push(0);var e=[].concat(p),i=d<k?null:4*O[Math.floor(O.length/2)-1],n=s>-k?null:4*C[Math.floor(C.length/2)-1];if(i)for(var r=i;r<=d;r*=2)t.push(r);if(i)for(var o=i/2;o>=Math.max(s,k);o/=2)t.push(o);if(n)for(var l=n;l>=s;l*=2)t.push(l);if(n)for(var h=n/2;h<=Math.min(d,-k);h/=2)t.push(h);t=t.sort(d3.ascending).filter(function(t){return s<=t&&t<=d}),m=m.concat(t),t=b(t,!1);for(var v=p,g=0;g<t.length;g++){var y=v.concat(t[g]).filter(function(t){return!z(t,e)}).filter(c);if(!E(y,a,u,"none"))break;p=y}}(),t.method==this.METHOD_REPEATING){var A=T.concat(O).concat(C).sort(d3.ascending);t.stops.forEach(function(t,e){m=m.concat(A.map(function(e){return e*t}))}),A=b(A);var I=T.concat(p),L=!1;t.stops.forEach(function(e,i){if(0==i){for(var n,r=0;r<A.length;r++){var o=p.concat(A[r].map(function(t){return t*e})).filter(function(t){return!z(t,I)}).filter(function(t){return s<=t&&t<=d}).filter(c);if(!E(o,a,u,"none"))break;p=o}A=(n=[]).concat.apply(n,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(A))}else{if(L)return;var l=p.concat(A.map(function(t){return t*e})).filter(function(t){return s<=t&&t<=d}).filter(c);if(!E(l,a,u,"log"))return void(L=!0);if(p.length>t.limitMaxTickNumber&&0!=t.limitMaxTickNumber)return void(L=!0);p=l}})}}return"linear"!=t.scaleType&&"time"!=t.scaleType||function(){f&&p.push(0);var e=[].concat(p);v=S?Math.max(Math.floor(a/(t.heightOfOneDigit+parseInt(t.cssMargin.top))),2):Math.max(Math.floor(a/y),2),0!=t.limitMaxTickNumber&&v>t.limitMaxTickNumber&&(v=t.limitMaxTickNumber);var i=h.scale().ticks(v).sort(d3.ascending).filter(function(t){return s<=t&&t<=d});m=m.concat(i),i=b(i,!1);for(var n=p,r=0;r<i.length;r++){var o=n.concat(i[r]).filter(function(t){return!z(t,e)}).filter(c);if(!E(o,a,t.fitIntoScale,"none"))break;p=o}p=p.filter(function(t){return!z(t,e)}).filter(c)}(),null!=p&&p.length<=2&&!f&&(1!=(p=Math.abs(h.scale()(s)-h.scale()(d))<(S?t.heightOfOneDigit:(t.formatter(s).length+t.formatter(d).length)*t.widthOfOneDigit)?[d]:[s,d]).length||"linear"!=t.scaleType&&"time"!=t.scaleType||(m=[])),null!=p&&p.length<=3&&f&&(p=z(0,[s,d])?[s,d]:[s,0,d]),null!=p&&p.sort(function(t,i){return(e==o?-1:1)*(h.scale()(i)-h.scale()(t))}),M&&(p=[]),m=m.filter(function(t){return-1==p.indexOf(t)&&s<=t&&t<=d}),w("final result",p),h.ticks(v).tickFormat(t.formatter).tickValues(p).tickValuesMinor(m).pivot(_).repositionLabels(x(p,t,e,h.scale(),S?"y":"x"))},h.copy=function(){return e(d3["axis"+n.capitalize(t)]())},h.orient=function(){return arguments.length?h:t},d3.rebind(h,i,"scale","ticks","tickArguments","tickValues","tickFormat","tickSize","tickSizeInner","tickSizeOuter","tickPadding");function w(){var t;h.labelerOptions().isDevMode&&(t=console).log.apply(t,arguments)}}(d3["axis"+n.capitalize(t)]())};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(6);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){this.name="show";this.template=this.template||i(166),this.model_expects=this.model_expects||[{name:"state"},{name:"locale",type:"locale"}],this.tabsConfig=((t.ui.dialogs.dialog||{}).find||{}).showTabs||{},this._super(t,e)},readyOnce:function(){var t=this;this._super(),this.KEYS=r.unique(this.model.state.marker._getAllDimensions({exceptType:"time"})),this.resetFilter={};var e=this.model.state.marker._space;this.KEYS.forEach(function(i){t.resetFilter[i]=r.find(e,function(t){return t.dim===i}).show}),this.parentElement=d3.select(this.parent.element),this.contentEl=this.element=d3.select(this.element.parentNode),this.list=this.element.select(".vzb-show-list"),this.input_search=this.parentElement.select(".vzb-find-search"),this.deselect_all=this.parentElement.select(".vzb-show-deselect"),this.apply=this.parentElement.select(".vzb-show-apply");var i=this;this.deselect_all.on("click",function(){i.resetShow()}),this.apply.on("click",function(){i.applyShowChanges()}),this.root.on("ready",function(){i.ready()})},ready:function(){var t=this;this._super(),this.KEYS=r.unique(this.model.state.marker._getAllDimensions({exceptType:"time"})),this.labelNames=this.model.state.marker.getLabelHookNames();var e=this.model.state.marker.getSubhooks(!0);this.previewShow={},this.checkedDifference={},r.forEach(this.labelNames,function(i){var n=e[i].getEntity(),o=t.previewShow[n._name]={};r.forEach(n.show.$and||[n.show],function(t){r.forEach(t,function(t,e){o[e]=(t.$in||[]).slice(0)})})}),this.redraw(),this.showHideButtons(),r.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},redraw:function(){var t=this,e=this;this.translator=this.model.locale.getTFunction(),this.model.state.marker.getFrame(this.model.state.time.value,function(i){if(i){var n=t.model.state.marker.getSubhooks(!0);e.list.html("");var o=[];r.forEach(t.labelNames,function(e,i){var r=n[e].getEntity(),a=r._name;o.push({dim:i,entities:a,labelName:e,key:i,category:t.root.model.dataManager.getConceptProperty(i,"name")});var s=r.getEntitySets().map(function(e){return{entities:a,key:e,dim:i,isSet:!0,category:t.root.model.dataManager.getConceptProperty(e,"name")}});o.push.apply(o,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(s))}),r.forEach(o,function(n){n.dim;var o=n.key,a=n.category,s=n.labelName,l=n.entities,u=n.isSet,c=u?t.model.state[l].getEntitySets("data")[o][0].map(function(t){var i={entities:l,category:o};return i[o]=t[o],i.label=t.name,i.isShown=e.model.state[l].isInShowFilter(t,o),i}):r.keys(i[s]).map(function(t){var n={entities:l,category:o};return n[o]=t,n.label=i[s][t],n.isShown=e.model.state[l].isInShowFilter(n,o),n});c.sort(function(t,e){return t.label<e.label?-1:1});var h=e.list.append("div").attr("class","vzb-accordion-section").classed("vzb-accordion-active","open"===t.tabsConfig[o]).datum({key:o,isSet:u});h.append("div").attr("class","vzb-accordion-section-title").on("click",function(t){var e=d3.select(this.parentNode);e.classed("vzb-fullexpand",!1).classed("vzb-accordion-active",!e.classed("vzb-accordion-active"))}).call(function(t){return t.append("span").attr("class","vzb-show-category").classed("vzb-show-category-set",function(t){return t.isSet}).text(a).attr("title",function(t){return this.offsetWidth<this.scrollWidth?a:null})}).call(function(t){return t.append("span").attr("class","vzb-show-clear-cross").text("").on("click",function(){d3.event.stopPropagation(),h.selectAll(".vzb-checked input").property("checked",!1).dispatch("change")})}).call(function(t){return t.append("span").attr("class","vzb-show-more vzb-dialog-button").text(e.translator("buttons/moreellipsis")).on("click",function(){d3.event.stopPropagation(),h.classed("vzb-fullexpand",!0)})});var d=h.append("div").attr("class","vzb-show-category-list"),f=d.selectAll(".vzb-show-item").data(c).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox").classed("vzb-checked",function(t){return t.isShown});f.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",function(t){return"-show-"+t.category+"-"+t[o]+"-"+e._id}).property("checked",function(t){return t.isShown}).on("change",function(e,i,n){if(e.isShown!==n[i].checked?t.checkedDifference[e.category+e[o]]=!0:delete t.checkedDifference[e.category+e[o]],t.apply.classed("vzb-disabled",!Object.keys(t.checkedDifference).length),!t.previewShow[e.entities][e.category]){var r=t.model.state[e.entities].show;t.previewShow[e.entities][e.category]=((r[e.category]||(r.$and||{})[e.category]||{}).$in||[]).slice(0)}var a=t.previewShow[e.entities][e.category].indexOf(e[e.category]);-1===a?t.previewShow[e.entities][e.category].push(e[e.category]):t.previewShow[e.entities][e.category].splice(a,1)}),f.append("label").attr("for",function(t){return"-show-"+t.category+"-"+t[o]+"-"+e._id}).text(function(t){return t.label}).attr("title",function(t){return this.offsetWidth<this.scrollWidth?t.label:null});var p=d.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];if(p&&p.nextSibling){d3.select(p).classed("vzb-separator",!!p.nextSibling);var m=p.parentNode.offsetTop+p.offsetTop;d3.select(p.parentNode.parentNode).style("max-height",m+p.offsetHeight+25+"px").select(".vzb-show-more").style("transform","translate(0, "+m+"px)")}else h.select(".vzb-show-more").classed("vzb-hidden",!0);h.classed("vzb-filtered",!!p),h.classed("vzb-fullexpand",!!p&&"open"===t.tabsConfig[o])}),e.contentEl.node().scrollTop=0,e.input_search.attr("placeholder",e.translator("placeholder/search")+"...")}})},applyShowChanges:function(){var t=this;this.model.state.marker.clearSelected();var e={};r.forEach(this.previewShow,function(i,n){var o=[],a=[];r.forEach(i,function(t,e){var i,n,r;a.push(e),t.length&&o.push((i={},n=e,r={$in:t.slice(0)},n in i?Object.defineProperty(i,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[n]=r,i))}),r.forEach(t.model.state[n].show.$and||[t.model.state[n].show],function(t){r.forEach(t,function(t,e){a.includes(e)||o.push(r.deepClone(t))})}),e[n]={show:o.length>1?{$and:o}:o[0]||{}}}),this.model.state.set(e)},showHideSearch:function(){if("show"===this.parent.getPanelMode()){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-show-item").classed("vzb-hidden",function(e){return-1===(e.label||"").toString().toLowerCase().indexOf(t)}),""!==t&&this.list.selectAll(".vzb-accordion-section").classed("vzb-accordion-active",!0)}},showHideButtons:function(){"show"===this.parent.getPanelMode()&&(this.deselect_all.classed("vzb-hidden",this.hideResetButton()),this.apply.classed("vzb-hidden",!1).classed("vzb-disabled",!0))},hideResetButton:function(){var t=this,e=!0,i=this.model.state.marker._space;return r.forEach(this.KEYS,function(n){return e=r.comparePlainObjects(t.resetFilter[n]||{},r.find(i,function(t){return t.dim===n}).show)}),e},resetShow:function(){var t=this,e={},i=this.model.state.marker._space;this.KEYS.forEach(function(n){var o=r.find(i,function(t){return t.dim===n})._name;e[o]={show:t.resetFilter[n]||{}}}),this.model.state.set(e)},closeClick:function(){this.applyShowChanges()}});e.default=a},function(t,e,i){t.exports=!i(8)&&!i(4)(function(){return 7!=Object.defineProperty(i(79)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){e.f=i(7)},function(t,e,i){var n=i(17),r=i(18),o=i(62)(!1),a=i(81)("IE_PROTO");t.exports=function(t,e){var i,s=r(t),l=0,u=[];for(i in s)i!=a&&n(s,i)&&u.push(i);for(;e.length>l;)n(s,i=e[l++])&&(~o(u,i)||u.push(i));return u}},function(t,e,i){var n=i(9),r=i(2),o=i(40);t.exports=i(8)?Object.defineProperties:function(t,e){r(t);for(var i,a=o(e),s=a.length,l=0;s>l;)n.f(t,i=a[l++],e[i]);return t}},function(t,e,i){var n=i(18),r=i(43).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return a&&"[object Window]"==o.call(t)?function(t){try{return r(t)}catch(t){return a.slice()}}(t):r(n(t))}},function(t,e,i){"use strict";var n=i(40),r=i(63),o=i(57),a=i(11),s=i(56),l=Object.assign;t.exports=!l||i(4)(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=l({},t)[i]||Object.keys(l({},e)).join("")!=n})?function(t,e){for(var i=a(t),l=arguments.length,u=1,c=r.f,h=o.f;l>u;)for(var d,f=s(arguments[u++]),p=c?n(f).concat(c(f)):n(f),m=p.length,v=0;m>v;)h.call(f,d=p[v++])&&(i[d]=f[d]);return i}:l},function(t,e,i){"use strict";var n=i(13),r=i(5),o=i(120),a=[].slice,s={};t.exports=Function.bind||function(t){var e=n(this),i=a.call(arguments,1),l=function(){var n=i.concat(a.call(arguments));return this instanceof l?function(t,e,i){if(!(e in s)){for(var n=[],r=0;r<e;r++)n[r]="a["+r+"]";s[e]=Function("F,a","return new F("+n.join(",")+")")}return s[e](t,i)}(e,n.length,n):o(e,n,t)};return r(e.prototype)&&(l.prototype=e.prototype),l}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var n=i(3).parseInt,r=i(52).trim,o=i(85),a=/^[-+]?0[xX]/;t.exports=8!==n(o+"08")||22!==n(o+"0x16")?function(t,e){var i=r(String(t),3);return n(i,e>>>0||(a.test(i)?16:10))}:n},function(t,e,i){var n=i(3).parseFloat,r=i(52).trim;t.exports=1/n(i(85)+"-0")!=-1/0?function(t){var e=r(String(t),3),i=n(e);return 0===i&&"-"==e.charAt(0)?-0:i}:n},function(t,e,i){var n=i(23);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=n(t))throw TypeError(e);return+t}},function(t,e,i){var n=i(5),r=Math.floor;t.exports=function(t){return!n(t)&&isFinite(t)&&r(t)===t}},function(t,e){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,i){var n=i(88),r=Math.pow,o=r(2,-52),a=r(2,-23),s=r(2,127)*(2-a),l=r(2,-126);t.exports=Math.fround||function(t){var e,i,r=Math.abs(t),u=n(t);return r<l?u*(r/l/a+1/o-1/o)*l*a:(i=(e=(1+a/o)*r)-(e-r))>s||i!=i?u*(1/0):u*i}},function(t,e,i){var n=i(2);t.exports=function(t,e,i,r){try{return r?e(n(i)[0],i[1]):e(i)}catch(e){var o=t.return;throw void 0!==o&&n(o.call(t)),e}}},function(t,e,i){var n=i(13),r=i(11),o=i(56),a=i(10);t.exports=function(t,e,i,s,l){n(e);var u=r(t),c=o(u),h=a(u.length),d=l?h-1:0,f=l?-1:1;if(i<2)for(;;){if(d in c){s=c[d],d+=f;break}if(d+=f,l?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;l?d>=0:h>d;d+=f)d in c&&(s=e(s,c[d],d,u));return s}},function(t,e,i){"use strict";var n=i(11),r=i(41),o=i(10);t.exports=[].copyWithin||function(t,e){var i=n(this),a=o(i.length),s=r(t,a),l=r(e,a),u=arguments.length>2?arguments[2]:void 0,c=Math.min((void 0===u?a:r(u,a))-l,a-s),h=1;for(l<s&&s<l+c&&(h=-1,l+=c-1,s+=c-1);c-- >0;)l in i?i[s]=i[l]:delete i[s],s+=h,l+=h;return i}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,i){i(8)&&"g"!=/./g.flags&&i(9).f(RegExp.prototype,"flags",{configurable:!0,get:i(67)})},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,i){var n=i(2),r=i(5),o=i(103);t.exports=function(t,e){if(n(t),r(e)&&e.constructor===t)return e;var i=o.f(t);return(0,i.resolve)(e),i.promise}},function(t,e,i){"use strict";var n=i(135),r=i(54);t.exports=i(70)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=n.getEntry(r(this,"Map"),t);return e&&e.v},set:function(t,e){return n.def(r(this,"Map"),0===t?0:t,e)}},n,!0)},function(t,e,i){"use strict";var n=i(9).f,r=i(42),o=i(47),a=i(22),s=i(45),l=i(46),u=i(91),c=i(130),h=i(44),d=i(8),f=i(35).fastKey,p=i(54),m=d?"_s":"size",v=function(t,e){var i,n=f(e);if("F"!==n)return t._i[n];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,u){var c=t(function(t,n){s(t,c,e,"_i"),t._t=e,t._i=r(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=n&&l(n,i,t[u],t)});return o(c.prototype,{clear:function(){for(var t=p(this,e),i=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete i[n.i];t._f=t._l=void 0,t[m]=0},delete:function(t){var i=p(this,e),n=v(i,t);if(n){var r=n.n,o=n.p;delete i._i[n.i],n.r=!0,o&&(o.n=r),r&&(r.p=o),i._f==n&&(i._f=r),i._l==n&&(i._l=o),i[m]--}return!!n},forEach:function(t){p(this,e);for(var i,n=a(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(n(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!v(p(this,e),t)}}),d&&n(c.prototype,"size",{get:function(){return p(this,e)[m]}}),c},def:function(t,e,i){var n,r,o=v(t,e);return o?o.v=i:(t._l=o={i:r=f(e,!0),k:e,v:i,p:n=t._l,n:void 0,r:!1},t._f||(t._f=o),n&&(n.n=o),t[m]++,"F"!==r&&(t._i[r]=o)),t},getEntry:v,setStrong:function(t,e,i){u(t,e,function(t,i){this._t=p(t,e),this._k=i,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?c(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,c(1))},i?"entries":"values",!i,!0),h(e)}}},function(t,e,i){"use strict";var n=i(135),r=i(54);t.exports=i(70)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(r(this,"Set"),t=0===t?0:t,t)}},n)},function(t,e,i){"use strict";var n,r=i(30)(0),o=i(15),a=i(35),s=i(118),l=i(138),u=i(5),c=i(4),h=i(54),d=a.getWeak,f=Object.isExtensible,p=l.ufstore,m={},v=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},g={get:function(t){if(u(t)){var e=d(t);return!0===e?p(h(this,"WeakMap")).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(h(this,"WeakMap"),t,e)}},y=t.exports=i(70)("WeakMap",v,g,l,!0,!0);c(function(){return 7!=(new y).set((Object.freeze||Object)(m),7).get(m)})&&(s((n=l.getConstructor(v,"WeakMap")).prototype,g),a.NEED=!0,r(["delete","has","get","set"],function(t){var e=y.prototype,i=e[t];o(e,t,function(e,r){if(u(e)&&!f(e)){this._f||(this._f=new n);var o=this._f[t](e,r);return"set"==t?this:o}return i.call(this,e,r)})}))},function(t,e,i){"use strict";var n=i(47),r=i(35).getWeak,o=i(2),a=i(5),s=i(45),l=i(46),u=i(30),c=i(17),h=i(54),d=u(5),f=u(6),p=0,m=function(t){return t._l||(t._l=new v)},v=function(){this.a=[]},g=function(t,e){return d(t.a,function(t){return t[0]===e})};v.prototype={get:function(t){var e=g(this,t);if(e)return e[1]},has:function(t){return!!g(this,t)},set:function(t,e){var i=g(this,t);i?i[1]=e:this.a.push([t,e])},delete:function(t){var e=f(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,i,o){var u=t(function(t,n){s(t,u,e,"_i"),t._t=e,t._i=p++,t._l=void 0,void 0!=n&&l(n,i,t[o],t)});return n(u.prototype,{delete:function(t){if(!a(t))return!1;var i=r(t);return!0===i?m(h(this,e)).delete(t):i&&c(i,this._i)&&delete i[this._i]},has:function(t){if(!a(t))return!1;var i=r(t);return!0===i?m(h(this,e)).has(t):i&&c(i,this._i)}}),u},def:function(t,e,i){var n=r(o(e),!0);return!0===n?m(t).set(e,i):n[t._i]=i,t},ufstore:m}},function(t,e,i){var n=i(28),r=i(10);t.exports=function(t){if(void 0===t)return 0;var e=n(t),i=r(e);if(e!==i)throw RangeError("Wrong length!");return i}},function(t,e,i){var n=i(43),r=i(63),o=i(2),a=i(3).Reflect;t.exports=a&&a.ownKeys||function(t){var e=n.f(o(t)),i=r.f;return i?e.concat(i(t)):e}},function(t,e,i){"use strict";var n=i(64),r=i(5),o=i(10),a=i(22),s=i(7)("isConcatSpreadable");t.exports=function t(e,i,l,u,c,h,d,f){for(var p,m,v=c,g=0,y=!!d&&a(d,f,3);g<u;){if(g in l){if(p=y?y(l[g],g,i):l[g],m=!1,r(p)&&(m=void 0!==(m=p[s])?!!m:n(p)),m&&h>0)v=t(e,i,p,o(p.length),v,h-1)-1;else{if(v>=9007199254740991)throw TypeError();e[v]=p}v++}g++}return v}},function(t,e,i){var n=i(10),r=i(87),o=i(27);t.exports=function(t,e,i,a){var s=String(o(t)),l=s.length,u=void 0===i?" ":String(i),c=n(e);if(c<=l||""==u)return s;var h=c-l,d=r.call(u,Math.ceil(h/u.length));return d.length>h&&(d=d.slice(0,h)),a?d+s:s+d}},function(t,e,i){var n=i(40),r=i(18),o=i(57).f;t.exports=function(t){return function(e){for(var i,a=r(e),s=n(a),l=s.length,u=0,c=[];l>u;)o.call(a,i=s[u++])&&c.push(t?[i,a[i]]:a[i]);return c}}},function(t,e,i){var n=i(58),r=i(145);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){var n=i(46);t.exports=function(t,e){var i=[];return n(t,!1,i.push,i,e),i}},function(t,e){t.exports=Math.scale||function(t,e,i,n,r){return 0===arguments.length||t!=t||e!=e||i!=i||n!=n||r!=r?NaN:t===1/0||t===-1/0?t:(t-e)*(r-n)/(i-e)+n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=c(i(48)),a=c(i(6)),s=i(49),l=(c(s),c(i(395))),u=c(i(396));function c(t){return t&&t.__esModule?t:{default:t}}var h=o.default.extend({init:function(t,e){this._id=r.uniqueId("tm"),this._type="tool",this._component=t,this.dimensionManager=(0,l.default)(this),this.dataManager=(0,u.default)(this),this.getClassDefaults=function(){return t.default_model};var i=r.extend(t.getToolListeners(),e.bind);delete e.bind,this._super(t.name,e,null,i)},getDefaults:function(){return r.deepExtend({},this.getSubmodelDefaults(),this.getClassDefaults())},validate:function(){var t=10,e=this;!function i(n){var o=JSON.stringify(e.getPlainObject());e._component.validate(e);var a=JSON.stringify(e.getPlainObject());n>=t?r.error("Max validation loop."):o!==a&&i(n++)}(0)},setReady:function(t){!1!==t&&this.checkTimeLimits(),this._super(t)},checkTimeLimits:function(){var t=this.state.time,e=this.state.getSubmodels(!1,function(t){return"marker"==t._type&&t.space.includes("time")});if(t&&e.length){var i={};if(e.forEach(function(t){var e=t.getTimeLimits();i.min=d3.max([i.min,e.min]),i.max=d3.min([i.max,e.max])}),!r.isDate(i.min)||!r.isDate(i.max))return r.warn("checkTimeLimits(): min-max look wrong: "+i.min+" "+i.max+". Expecting Date objects. Ensure that time is properly parsed in the data from reader");var n={};t.start-i.min==0&&(t.start||t.startOrigin)||(n.start=d3.max([i.min,t.parse(t.startOrigin)])),t.end-i.max==0&&(t.end||t.endOrigin)||(n.end=d3.min([i.max,t.parse(t.endOrigin)])),t.setTreeFreezer(!0),t.set(n,!1,!1),(n.start||n.end)&&e.forEach(function(e){r.forEach(e.getSubhooks(),function(e){e.which==t.dim&&e.buildScale()})}),t.setTreeFreezer(!1)}}}),d=a.default.extend({init:function(t,e){this._id=r.uniqueId("t"),this.template=this.getToolTemplate(),this._super({placeholder:t,model:e}),this.prerender(),this.setCSSClasses(),this.setResizeHandler(),this.postrender()},createModel:function(t){(t=t||{}).bind=t.bind||{},this.model=new h(this,t),this.model.setInterModelListeners()},getToolTemplate:function(){return this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>'},getToolListeners:function(){var t=this,e=this;return r.extend(this.model_binds,{readyOnce:function(){return t.setResizeHandler()},change:function(t,i){e._ready&&(e.model.validate(),t.source.persistent&&e.model.trigger(new s.DefaultEvent(t.source,"persistentChange")))},hook_change:function(){e.model.state.time.splash||e.beforeLoading()},"resize:ui":function(){e._ready&&e.triggerResize()},"translate:locale":function(){e.translateStrings(),e.model.ui.setRTL(e.model.locale.isRTL())},load_error1:function(e,i){t.renderError(i)}})},setResizeHandler:function(){this.model.ui.setContainer(this.element)},getVizWidthHeight:function(){var t=0,e=0;return this.element?(t=d3.select(this.element).select(".vzb-tool-viz").node().clientWidth,e=d3.select(this.element).select(".vzb-tool-viz").node().clientHeight):r.warn("Tool getVizWidthHeight(): missing this.element"),{width:t,height:e}},triggerResize:r.throttle(function(){this.trigger("resize")},100),startLoading:function(){var t=this;this._super(),Promise.all([this.model.startPreload(),this.startPreload()]).then(this.afterPreload.bind(this)).then(this.loadSplashScreen.bind(this)).then(function(){return r.delay(300)}).then(this.model.startLoading.bind(this.model)).then(this.finishLoading.bind(this)).catch(function(e){r.error("error in tool promise chain"),t.model.triggerLoadError(e)})},loadSplashScreen:function(){return this.model.ui.splash?(this.model.state.time.splash=!0,this.model.startLoading({splashScreen:!0})):Promise.resolve()},finishLoading:function(){this.model.state.time.splash=!1},getPersistentModel:function(){var t=this.model.getPlainObject(!0);return function t(e){for(var i in e)"function"==typeof e[i]?(delete e[i],r.warn("minModel validation. Function found in enumerable properties of "+i+". This key is deleted from minModel")):"object"===n(e[i])&&t(e[i])}(t),t},getPersistentMinimalModel:function(t){var e=this.model.getDefaults(),i=this.getPersistentModel(),n=r.deepExtend(e,t);return r.diffObject(i,n)},clear:function(){this.model.ui.clear(),this.setModel=this.getModel=function(){},this._super()},setModel:function(t,e){e?this.model.reset(t):this.model.set(t),this.setCSSClasses()},getModel:function(){return this.model.getPlainObject()||{}},beforeLoading:function(){r.addClass(this.placeholder,"vzb-loading-data")},validate:function(t){if(!(t=this.model||t)||!t.state)return r.warn("tool validation aborted: model.state looks wrong: "+t)},setCSSClasses:function(){r.addClass(this.placeholder,"vzb-placeholder"),this.model.ui&&this.model.ui.buttons&&this.model.ui.buttons.length?r.removeClass(this.element,"vzb-buttonlist-off"):r.addClass(this.element,"vzb-buttonlist-off")}});e.default=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(32);var a={_continuous:{_default:"#ffb600",0:"hsl(270, 80%, 55%)",25:"hsl(202.5, 80%, 55%)",50:"hsl(135, 80%, 55%)",75:"hsl(48, 70%, 62%)",100:"hsl(0, 80%, 55%)"},_discrete:{_default:"#ffb600",0:"#4cd843",1:"#e83739",2:"#ff7f00",3:"#c027d4",4:"#d66425",5:"#0ab8d8",6:"#bcfa83",7:"#ff8684",8:"#ffb04b",9:"#f599f5",10:"#f4f459",11:"#7fb5ed"},_default:{_default:"#ffb600"}},s=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,scaleType:null,syncModels:[],palette:{},paletteLabels:null,allow:{scales:["linear","log","genericLog","time","pow","ordinal"]}})},init:function(t,e,i,n){var r=this;this._type="color",this._super(t,e,i,n),this._syncModelReferences={},this._hasDefaultColor=!1,this.on("hook_change",function(){if(!r._readyOnce&&!r._loadCall&&(r._setSyncModels(),r.palette&&0!==Object.keys(r.palette._data).length)){var t=r.getDefaultPalette(),e=r.getPalette(),i={};Object.keys(t).forEach(function(n){e[n]&&t[n]!=e[n]||(i[n]=t[n])}),r.set("palette",i,!1,!1)}})},setInterModelListeners:function(){this._super(),this._setSyncModels()},getColorShade:function(t){var e=this.getPalette();if(!t)return r.warn("getColorShade() is missing arguments");if(!r.isArray(e[t.colorID]))return"shade"==t.shadeID?d3.rgb(e[t.colorID]||this.scale(t.colorID)).darker(.5).toString():e[t.colorID];var i=this.getConceptprops().color,n=t.shadeID&&i&&i.shades&&i.shades[t.shadeID]?i.shades[t.shadeID]:0;return e[t.colorID][n]},isUserSelectable:function(){var t=this.getConceptprops().color;return null==t||null==t.selectable||t.selectable},setWhich:function(t){this.palette&&(this.palette._data={}),this._super(t),this._setSyncModels()},_setSyncModels:function(){var t=this;this.syncModels.forEach(function(e){var i=t.getClosestModel(e),n=i.isHook()?i._parent:i,r=n.getClosestModel(n.space[0]);t._syncModelReferences[e]={model:i,marker:n,entities:r},t.isDiscrete()&&"constant"!==t.use&&t._setSyncModel(i,n,r)})},_setSyncModel:function(t,e,i){if(t==e){var n={dim:this.which,show:{}};e.setDataSourceForAllSubhooks(this.data),i.set(n,!1,!1)}else t.isDiscrete()&&t.set({which:this.which,data:this.data,spaceRef:this.spaceRef},!1,!1)},getColorlegendMarker:function(){return(this._syncModelReferences.marker_colorlegend||{}).marker},getColorlegendEntities:function(){return(this._syncModelReferences.marker_colorlegend||{}).entities},setColor:function(t,e,i){var n=void 0,o=this.getPalette();this.isDiscrete()?(n=this.scale.range())[this.scale.domain().indexOf(e)]=t:(o[e]=t,n=r.values(o)),this.scale.range(n),this.palette.set(e,t,i,i)},mapValue:function(t){return null!=this.scale&&this.isDiscrete()&&this._hasDefaultColor&&-1==this.scale.domain().indexOf(t)&&(t="_default"),this._super(t)},getDefaultPalette:function(){var t=this.getConceptprops().color,e=void 0;return this.discreteDefaultPalette=!1,t&&t.palette?e=r.clone(t.palette):a[this.which]?e=r.clone(a[this.which]):"constant"===this.use?e=/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.which)?{_default:this.which}:r.clone(a._default):(e=r.clone(a[this.isDiscrete()?"_discrete":"_continuous"]),this.discreteDefaultPalette=!0),e},_getPaletteLabels:function(){var t=this.getConceptprops().color,e=null;return t&&t.paletteLabels&&(e=r.clone(t.paletteLabels)),e},getPaletteLabels:function(){return this.paletteLabels.getPlainObject()},getPalette:function(){if(!this.palette||0===Object.keys(this.palette._data).length){var t=this.getDefaultPalette();this.set("palette",t,!1,!1);var e=this._getPaletteLabels();this.set("paletteLabels",e,!1,!1)}var i=this.palette.getPlainObject();return"ordinal"!==this.scaleType&&delete i._default,i},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=this.getPalette(),i=Object.keys(e),n=r.values(e);if(this._hasDefaultColor=i.indexOf("_default")>-1,"time"==t){var o=this._space.time,s=o.splash?{min:o.parse(o.startOrigin),max:o.parse(o.endOrigin)}:{min:o.start,max:o.end},l=s.max-s.min==0;n=(i=i.sort(function(t,e){return t-e})).map(function(t){return l?e[i[0]]:e[t]}),i=i.map(function(t){return s.min.valueOf()+t/100*(s.max.valueOf()-s.min.valueOf())}),this.scale=d3.scaleUtc().domain(i).range(n).interpolate(d3.interpolateCubehelix)}else if(this.isDiscrete()){if(n=n.map(function(t){return r.isArray(t)?t[0]:t}),t="ordinal",this.discreteDefaultPalette){var u=r.extend({},a._discrete);delete u._default;var c=Object.keys(u);n=(i=[].concat(this.getUnique(this.which))).map(function(t,i){return e[t]||u[c[i%c.length]]}),i.push("_default"),n.push(e._default)}this.scale=d3["scale"+r.capitalize(t)]().domain(i).range(n)}else{var h=this.getLimits(this.which),d=(h=[h.min,h.max])[1]-h[0]==0;if(n=(i=i.sort(function(t,e){return t-e})).map(function(t){return d?e[i[0]]:e[t]}),i=i.map(function(t){return h[0]+t/100*(h[1]-h[0])}),d3.min(i)<=0&&d3.max(i)>=0&&"log"===t&&(t="genericLog"),"log"===t||"genericLog"===t){var f=d3.scaleGenericlog().domain(h).range(h);i=i.map(function(t){return f.invert(t)})}this.scale=d3["scale"+r.capitalize(t)]().domain(i).range(n).interpolate(d3.interpolateCubehelix)}this.scaleType=t}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(32);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,merge:!1,manualSorting:null,spaceRef:null,scaleType:"ordinal"})},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"property"!=this.use&&"constant"!=this.use&&(r.warn("group model: use must be 'property' or 'constant'. Resetting to property..."),this.use="property")}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(32);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null})},init:function(t,e,i,n){this._type="label",this._super(t,e,i,n)},autoconfigureModel:function(t){!this.which&&this.autoconfig&&(t=this._parent.getAvailableConcept(this.autoconfig)||this._parent.getAvailableConcept({type:"entity_domain"})),this._super(t)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(55);var a=["ar","ar-SA"],s=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{id:"en",filePath:"assets/translation/"})},dataConnectedChildren:["id"],strings:{},init:function(t,e,i,n){this._type="locale",this._super(t,e,i,n)},_isLoading:function(){return!this._loadedOnce||this._loadCall},preloadData:function(){return this.loadData()},loadData:function(t){var e=this;this.setReady(!1),this._loadCall=!0;var i=[];return t&&t.dataConnectedChange&&r.forEach(this._root._data,function(t){"data"===t._type&&i.push(t.loadConceptProps())}),this.strings[this.id]||i.push(new Promise(function(t,i){r.d3json(e.filePath+e.id+".json",function(n,r){if(n)return i(n);e._handleNewStrings(r),t()})})),Promise.all(i).then(function(){return e.trigger("translate")}).catch(function(t){return e.handleLoadError(t)})},_handleNewStrings:function(t){this.strings[this.id]=this.strings[this.id]?r.extend(this.strings[this.id],t):t},getUIString:function(t){return this.strings&&this.strings[this.id]&&(this.strings[this.id][t]||""===this.strings[this.id][t])?this.strings[this.id][t]:(this.strings&&this.strings[this.id]||r.warn("Strings are not loaded for the "+this.id+" locale. Check if translation JSON is valid"),t)},getTFunction:function(){var t=this;return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(i).reduce(function(t,e){var n=new RegExp("{{"+e+"}}","g");return t.replace(n,i[e])},t.getUIString(e))}},isRTL:function(){return-1!==a.indexOf(this.id)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(32);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null})},init:function(t,e,i,n){this._type="side",n.readyOnce=this.readyOnce,this.state={left:{},right:{}},this._super(t,e,i,n)},readyOnce:function(){if(this.spaceRef){var t=this._space[this.spaceRef].dataConnectedChildren.slice(0);t.splice(t.indexOf("show"),1),this._space[this.spaceRef].dataConnectedChildren=t}},switchSideState:function(){var t=this.state.left;this.state.left=this.state.right,this.state.right=t},clearSideState:function(){this.state={left:{},right:{}}}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(107),o=(n=r)&&n.__esModule?n:{default:n},a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1));var s=o.default.extend({getClassDefaults:function(){return a.deepExtend(this._super(),{use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,fixBaseline:0,extent:[0,.85],scaleType:null,allow:{scales:["ordinal","linear","log","genericLog","pow"]}})},_type:"size",buildScale:function(){this._super(),"ordinal"!==this.scaleType&&this.scale.clamp(!0)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(32);var a={ALL:"all",_default:"none"},s=((n=o)&&n.__esModule?n:{default:n}).default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{use:null,which:null,merge:!1,spaceRef:null})},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"indicator"===this.use&&(r.warn("stack model: use must not be 'indicator'. Resetting use to 'constant' and which to '"+a._default),this.use="constant",this.which=a._default),"constant"===this.use&&-1==r.values(a).indexOf(this.which)&&(r.warn("stack model: the requested value '"+this.which+"' is not allowed. resetting to '"+a._default),this.which=a._default,this.spaceRef=null)},getPalettes:function(){return a},buildScale:function(){}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(55),a=(n=o)&&n.__esModule?n:{default:n};Date.prototype.utc=Date.prototype.toUTCString;var s={year:{data:d3.time.format.utc("%Y"),ui:d3.time.format.utc("%Y")},month:{data:d3.time.format.utc("%Y-%m"),ui:d3.time.format.utc("%b %Y")},day:{data:d3.time.format.utc("%Y%m%d"),ui:d3.time.format.utc("%c")},hour:{data:d3.time.format.utc("%Y%m%dT%H"),ui:d3.time.format.utc("%b %d %Y, %H")},minute:{data:d3.time.format.utc("%Y%m%dT%H%M"),ui:d3.time.format.utc("%b %d %Y, %H:%M")},second:{data:d3.time.format.utc("%Y%m%dT%H%M%S"),ui:d3.time.format.utc("%b %d %Y, %H:%M:%S")},week:{data:u(),ui:u()},quarter:{data:c(),ui:c()}},l=a.default.extend({getClassDefaults:function(){return r.deepExtend(this._super(),{dim:null,value:null,start:null,end:null,startOrigin:null,endOrigin:null,startSelected:null,endSelected:null,playable:!0,playing:!1,loop:!1,round:"round",delay:150,delayThresholdX2:90,delayThresholdX4:45,unit:"year",format:{data:null,ui:null},step:1,immediatePlay:!0,record:!1,offset:0})},objectLeafs:["autoconfig"],dataConnectedChildren:["startOrigin","endOrigin","dim"],init:function(t,e,i,n){this._type="time",this._super(t,e,i,n);var r=this;this.initFormatters(),this.dragging=!1,this.postponePause=!1,this.allSteps={},this.delayAnimations=this.delay,this.on({"change:playing":function(){!0===r.playing?r._startPlaying():r._stopPlaying()},"change:format":function(){r.initFormatters()}})},initFormatters:function(){s[this.unit]&&(this.formatters=s[this.unit]),"string"==typeof this.format?this.formatters.data=this.formatters.ui=d3.time.format.utc(this.format):(this.format.data&&(this.formatters.data=d3.time.format.utc(this.format.data)),this.format.ui&&(this.formatters.ui=d3.time.format.utc(this.format.ui))),this.validateFormatting()},preloadData:function(){return this.dataSource=this.getClosestModel(this.data||"data"),this._super()},afterPreload:function(){this.autoconfigureModel()},autoconfigureModel:function(){if(!this.dim&&this.autoconfig){var t=this.dataSource.getConcept(this.autoconfig);t&&(this.dim=t.concept),r.printAutoconfigResult(this)}},_formatToDates:function(){for(var t=["value"],e=["value","start","end","startSelected","endSelected"],i=0;i<e.length;i++){var n=e[i];if(!r.isDate(this[n])){var o=this.parse(this[n]);this.set(n,o,null,-1!==t.indexOf(n))}}},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return-1===["data","ui"].indexOf(e)&&(r.warn("Time.formatDate type parameter ("+e+') invalid. Using "data".'),e=data),null==t?null:this.formatters[e](t)},parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return null==t?null:this.formatters[e].parse(t.toString())},findFormat:function(t){for(var e=Object.keys(s),i=0;i<e.length;i++){var n=s[e[i]].data.parse(t);if(n)return{unit:e[i],time:n,type:"data"};if(n=s[e[i]].ui.parse(t))return{unit:e[i],time:n,type:"ui"}}return null},validate:function(){null==this.start&&this.startOrigin&&this.set("start",this.startOrigin,null,!1),null==this.end&&this.endOrigin&&this.set("end",this.endOrigin,null,!1),this.formatters&&this.validateFormatting(),s[this.unit]||(r.warn(this.unit+' is not a valid time unit, using "year" instead.'),this.unit="year"),this.step<1&&(this.step=1),this.end<this.start&&null!=this.start&&this.set("end",new Date(this.start),null,!1),this.value<this.startSelected&&null!=this.startSelected&&(this.value=new Date(this.startSelected)),this.value>this.endSelected&&null!=this.endSelected&&(this.value=new Date(this.endSelected)),!1===this.splash&&((!this.startSelected||this.startSelected<this.start)&&null!=this.start&&this.set({startSelected:new Date(this.start)},null,!1),(!this.endSelected||this.endSelected>this.end)&&null!=this.end&&this.set({endSelected:new Date(this.end)},null,!1)),this.value<this.start&&null!=this.start?this.value=new Date(this.start):this.value>this.end&&null!=this.end&&(this.value=new Date(this.end)),!1===this.playable&&!0===this.playing&&this.set("playing",!1,null,!1)},validateFormatting:function(){null==this.value&&this.set("value",this.parse(this.formatDate(new Date)),null,!1),r.isDate(this.start)&&r.isDate(this.end)&&r.isDate(this.value)&&r.isDate(this.startSelected)&&r.isDate(this.endSelected)||this._formatToDates()},play:function(){this._startPlaying()},pause:function(t){t?this.postponePause=!0:this.playing&&(this.set("playing",!1,null,!1),this.set("value",this.value,!0,!0))},dragStart:function(){this.dragging=!0},dragStop:function(){this.dragging=!1},getRange:function(){var t=this.getIntervalAndStep();return d3["utc"+t.interval].range(this.start,this.end,t.step)},getIntervalAndStep:function(){var t=void 0,e=void 0;switch(this.unit){case"week":t="monday",e=this.step;break;case"quarter":t="month",e=3*this.step;break;default:t=this.unit,e=this.step}return{interval:r.capitalize(t),step:e}},getFilter:function(t){var e=t.splash,i=this.parse(this.startOrigin),n=this.parse(this.endOrigin),r=this.getDimension(),o=null;if(e)null!=this.value&&((o={})[r]=this.formatters.data(this.value));else{var a=void 0,s=void 0;null!=i&&(a=this.formatters.data(i)),null!=n&&(s=this.formatters.data(n)),(a||s)&&((o={})[r]={},a&&(o[r].$gte=a),s&&(o[r].$lte=s))}return o},getParser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t].parse},getFormatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t]},getAllSteps:function(){if(!this.start||!this.end)return r.warn("getAllSteps(): invalid start/end time is detected: "+this.start+", "+this.end),[];var t=""+this.offset+this.start+this.end+this.step;if(this.allSteps[t])return this.allSteps[t];this.allSteps[t]=[];for(var e=this.getIntervalAndStep(),i=d3["utc"+e.interval].count(this.start,this.end)<this.offset?new Date(this.start):d3["utc"+e.interval].offset(this.start,this.offset);+i<=+this.end;){var n=this.getIntervalAndStep();this.allSteps[t].push(i),i=d3["utc"+n.interval].offset(i,n.step)}return this.allSteps[t]},snap:function(t){if(this.round){null==t&&(t="value");var e="round";"ceil"===this.round&&(e="ceil"),"floor"===this.round&&(e="floor");var i=this.getIntervalAndStep(),n=d3["utc"+i.interval][e](this[t]);this.value-n==0&&this.value-this.start!=0&&this.value-this.end!=0||this.set(t,n,!0)}},_startPlaying:function(){if(this.playable){this.value>=this.endSelected&&this.getModelObject("value").set(this.startSelected,null,!1),this.set("playing",!0,null,!1),this.playInterval(this.immediatePlay),this.trigger("play")}},playInterval:function(t){if(this.playing){var e=this;this.delayAnimations=this.delay,this.delay<this.delayThresholdX2&&(this.delayAnimations*=2),this.delay<this.delayThresholdX4&&(this.delayAnimations*=2);var i=t?1:this.delayAnimations;this._intervals.setInterval("playInterval_"+this._id,function(){if(e.value>=e.endSelected)e.loop?e.getModelObject("value").set(e.startSelected,null,!1):e.set("playing",!1,null,!1);else if(e._intervals.clearInterval("playInterval_"+e._id),e.postponePause||!e.playing)e.set("playing",!1,null,!1),e.postponePause=!1,e.getModelObject("value").set(e.value,!0,!0);else{var t=e.getIntervalAndStep();e.delay<e.delayThresholdX2&&(t.step*=2),e.delay<e.delayThresholdX4&&(t.step*=2);var i=d3["utc"+t.interval].offset(e.value,t.step);i>=e.endSelected?e.getModelObject("value").set(e.endSelected,null,!0):e.getModelObject("value").set(i,null,!1),e.playInterval()}},i)}},incrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,e.step)},decrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,-e.step)},_stopPlaying:function(){this._intervals.clearInterval("playInterval_"+this._id),this.trigger("pause")}});function u(){var t=function(t){return e(t)+"w"+i(t)};t.parse=function(t){var e=t.match(/^(\d{4})w(\d{2})$/);return e?n(e[1],e[2]):null};var e=function(t){return t instanceof Date||(t=new Date(+t)),new Date(+t+864e5*(4-(t.getUTCDay()||7))).getUTCFullYear()},i=function(t){t instanceof Date||(t=new Date(+t));var e=new Date(+t+864e5*(4-(t.getUTCDay()||7))),i=Math.ceil(((e.getTime()-e.setUTCMonth(0,1))/864e5+1)/7);return i<10?"0"+i:i},n=function(t,e){var i=parseInt(e),n=t,r=new Date;r.setUTCFullYear(n),r.setUTCMonth(0),r.setUTCDate(4);var o=7*i+1-((r.getUTCDay()||7)+4),a=s.year.data.parse(n);return a=new Date(a.getTime()+24*o*60*60*1e3)};return t}function c(){var t=function(t){return s.year.data(t)+"q"+e(t)};t.parse=function(t){var e=t.match(/^(\d{4})q(\d)$/);return e?i(e[1],e[2]):null};var e=function(t){return t instanceof Date||(t=new Date(+t)),1+(t.getUTCMonth()/3|0)},i=function(t,e){var i=3*parseInt(e)-2,n=t;return s.month.data.parse([n,(i<9?"0":"")+i].join("-"))};return t}e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(48);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({screen_profiles:{small:{min_width:0,min_height:0},medium:{min_width:600,min_height:400},large:{min_width:900,min_height:520}},getClassDefaults:function(){return r.deepExtend(this._super(),{presentation:!1,buttons:[],dialogs:{popup:[],sidebar:[],moreoptions:[]},splash:!1})},init:function(t,e,i,n){this._type="ui",this._container=null,this._curr_profile="small",this._prev_size={},this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),n["change:presentation"]=this.updatePresentation.bind(this),this._super(t,e,i,n);var o;(o=/(?:iPad|iPhone|iPod).+OS\s+(\d+)_(\d+)/.exec(navigator.userAgent))&&+o[1]>=10&&+o[2]>2&&!window.MSStream&&(this.setSize=r.debounce(this.setSize,500))},resizeHandler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._container&&this.setSize(t.force||!1)},setSize:function(t){var e=this,i=this._container.clientWidth,n=this._container.clientHeight;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this._container.style.top=0,this._container.clientWidth>this._container.clientHeight&&this._container.clientWidth<700)){var o=this._container.clientHeight,a=window.innerHeight;2<o-a&&o-a<=45&&(this._container.style.top="44px",document.body.scrollTop=44)}(t||!this._prev_size||this._prev_size.width!==i||this._prev_size.height!==n)&&i&&n&&(r.forEach(this.screen_profiles,function(t,o){r.removeClass(e._container,"vzb-"+o),i>=t.min_width&&n>=t.min_height&&(e._curr_profile=o)}),r.addClass(this._container,"vzb-"+this._curr_profile),r.classed(this._container,"vzb-portrait",i<n),r.classed(this._container,"vzb-landscape",!(i<n)),this._prev_size.width=i,this._prev_size.height=n,this.trigger("resize"))},setContainer:function(t){t.clientWidth&&t.clientHeight||r.warn("Vizabi is being initialised with a container of incorrect width or height. While this may be handled without a crash, it's not considered a healthy behavior. You should call Vizabi(placeholder,...) function when placeholder is not display:none and has some >0 !=auto width and height"),this._container=t,this.setSize(),this.updatePresentation()},updatePresentation:function(){r.classed(this._container,"vzb-presentation",this.presentation),this.trigger("resize")},getPresentationMode:function(){return this.presentation},setRTL:function(t){r.classed(this._container,"vzb-rtl",t)},currentProfile:function(){return this._curr_profile},clear:function(){window.removeEventListener("resize",this.resizeHandler)}});e.default=a},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return function t(e){var i=[],r=[],o=.1,a=5,s=e.domain(),l=e.range(),u=null,c=void 0,h=void 0,d=function(t){return t instanceof Array?t.map(function(t){return Math.abs(t)}):Math.abs(t)},f=function(t,e){return{domain:t,sign:1,range:e,scale:d3.scaleLinear().domain(t).range(e)}},p=function(t,e,i){var n=t;return i&&(n=d(t)),{domain:t,sign:i?-1:1,range:e,scale:d3.scaleLog().domain(n).range(e)}},m=function(){var t=(c=l[0]<l[l.length-1])?1:-1;if(i=[],1==r.length)i=r[0][0]<=0&&r[0][1]>=0?[f(r[0],l)]:[p(r[0],l,r[0][0]<=0)];else{var n=d3.max(d(s)),u=d(d3.max(l)-d3.min(l)),m=1,v=0,g=0,y=0,_=0;e.domain([o,n]).range([0,u]);var b=a;0!=s[0]&&d(s[0])>o&&(v=e(d(s[0]))),0!=s[s.length-1]&&d(s.length-1)>o&&(g=e(d(s[s.length-1]))),d(s[0])>o&&(y=b),d(s[s.length-1])>o&&(_=b),u=u-y-_,0!=g&&(m=d(v/g));var x=void 0,w=void 0;2==r.length?0==s[0]||d(s[0])<=o?(x=l[0]+v*m*t+_*t,i=[f(r[0],[l[0],x]),p(r[1],[x,l[l.length-1]],!h)]):(0==s[s.length-1]||d(s[s.length-1])<=o)&&(x=l[l.length-1]-(y+_)*m*t,i=[p(r[0],[l[0],x],h),f(r[1],[x,l[l.length-1]])]):(x=l[0]+u/(1/m+1)*t,w=l[0]+(u/(1/m+1)+y+_)*t,i=[p(r[0],[l[0],x],h),f(r[1],[x,w]),p(r[2],[w,l[l.length-1]],!h)])}},v=function(t){if(h){if(t<s[0])return i[0];if(t>s[s.length-1])return i[i.length-1];for(var e=0;e<i.length;e++)if(t>=i[e].domain[0]&&t<=i[e].domain[i[e].domain.length-1])return i[e]}else{if(t>s[0])return i[0];if(t<s[s.length-1])return i[i.length-1];for(var n=0;n<i.length;n++)if(t<=i[n].domain[0]&&t>=i[n].domain[i[n].domain.length-1])return i[n]}};function g(t){var e=v(t);return u?u(e.scale(t*e.sign)):e.scale(t*e.sign)}return Math.sign=Math.sign||function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},g.eps=function(t){return arguments.length?(o=t,g.domain(s),g):o},g.delta=function(t){return arguments.length?(a=t,g.range(l),g):a},g.domain=function(t){if(!arguments.length)return s;switch(t.length){case 0:t=s;break;case 1:t=[t[0]/2,2*t[0]]}t[0]==t[t.length-1]&&(t[0]/=2,t[t.length-1]=2*t[t.length-1]),s=t;var e=d3.min(d(s).filter(function(t){return!!t}));return e&&(o=Math.min(o,e/100)),function(){if(h=s[0]<s[s.length-1],r=[],d3.min(s)>0&&d3.max(s)>0||d3.min(s)<0&&d3.max(s)<0)r=[s];else{var t=void 0,e=void 0;h?(t=s[0],e=s[s.length-1]):(t=s[s.length-1],e=s[0]);for(var i=function(t,e){h?r.push([t,e]):r.unshift([e,t])};t!=e;)e<=-o||t>=-o&&e<=o||t>=o?(i(t,e),t=e):t<-o&&e>=-o?(i(t,-o),t=-o):t>=-o&&e>=o?(i(t,o),t=o):(console.warn("Something wrong while build subdomains: "+t+" "+e),t=e)}m()}(),g},g.range=function(t,e){if(!arguments.length)return u?u.range():l;switch(t.length){case 0:t=l;break;case 1:t=[t[0]-100,t[0]+100]}if(u&&!e)u.range(t);else{l=t;var i=d3.min(d(l).filter(function(t){return!!t}));i&&(a=Math.min(a,i/100)),m()}return g},g.interpolate=function(t){var e=s;if(r.length>1){var i=s,n=l,o=[s[0],s[s.length-1]];g.domain(o).range(o),e=i.map(function(t){return g(t)}),g.domain(i).range(n)}return u=d3.scaleLinear().domain(e).range(l).interpolate(t),g.range(u.domain(),!0),g},g.invert=function(t){var e=function(t){if(c){if(t<l[0])return i[0];if(t>l[l.length-1])return i[i.length-1];for(var e=0;e<i.length;e++)if(t>=i[e].range[0]&&t<=i[e].range[i[e].range.length-1])return i[e]}else{if(t>l[0])return i[0];if(t<l[l.length-1])return i[i.length-1];for(var n=0;n<i.length;n++)if(t<=i[n].range[0]&&t>=i[n].range[1])return i[n]}}(t);return e.scale.invert(t)*e.sign},g.ticks=function(t){for(var e=void 0,r=[],o=0;o<i.length;o++)e=-1==i[o].sign?i[o].scale.ticks().reverse().map(function(t){return-1*t}):i[o].scale.ticks(),r.length>0&&e.length>0&&r[r.length-1]==e[0]&&e.splice(0,1),r.push.apply(r,n(e));return r},g.copy=function(){return t(e).domain(s).range(l).delta(a).eps(o)},d3.rebind(g,e,"base","rangeRound","clamp","nice","tickFormat")}(d3.scaleLog().domain([.1,200]).range([0,1e3]))}},function(t,e,i){"use strict";function n(t,e,i){var n,r,o,a=e?".onTap":".onLongTap";d3.select(t).on("touchstart"+a,function(t,e){n=d3.event.timeStamp,r=d3.event.changedTouches[0].screenX,o=d3.event.changedTouches[0].screenY}).on("touchend"+a,function(t,a){return r=Math.abs(r-d3.event.changedTouches[0].screenX),o=Math.abs(o-d3.event.changedTouches[0].screenY),r<5&&o<5?d3.event.timeStamp-n<500?e?e(t,a):void 0:i?i(t,a):void 0:void 0})}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return this.each(function(){n(this,t)})},o=function(t){return this.each(function(){n(this,null,t)})};e.default={onTap:r,onLongTap:o},e.onTap=r,e.onLongTap=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=s(i(399)),o=s(i(75)),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1));function s(t){return t&&t.__esModule?t:{default:t}}var l={},u=o.default.extend({_name:"csv",init:function(t){var e=this;this._data=[],this._lastModified=t.lastModified||"",this._basepath=t.path,this.delimiter=t.delimiter,this.keySize=t.keySize||1,this.assetsPath=t.assetsPath||"",this._parseStrategies=[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}([",.",".,"].map(function(t){return e._createParseStrategy(t)})),[function(t){return t}]),Object.assign(this.ERRORS,{WRONG_TIME_COLUMN_OR_UNITS:"reader/error/wrongTimeUnitsOrColumn",NOT_ENOUGH_ROWS_IN_FILE:"reader/error/notEnoughRows",UNDEFINED_DELIMITER:"reader/error/undefinedDelimiter",EMPTY_HEADERS:"reader/error/emptyHeaders",DIFFERENT_SEPARATORS:"reader/error/differentSeparators",FILE_NOT_FOUND:"reader/error/fileNotFoundOrPermissionsOrEmpty"})},ensureDataIsCorrect:function(t,e){var i=t.columns,r=t.rows,o=i[this.keySize],a=n(r,1)[0],s=e[o],l=a[o].trim();if(s&&!s(l))throw this.error(this.ERRORS.WRONG_TIME_COLUMN_OR_UNITS,void 0,l);if(!i.filter(Boolean).length)throw this.error(this.ERRORS.EMPTY_HEADERS)},getDatasetInfo:function(){return{name:this._basepath.split("/").pop()}},load:function(){var t=this,e=this._basepath,i=this._lastModified;return new Promise(function(n,r){var o=l[e+i];o?n(o):a.d3text(e,function(o,a){if(o)return o.name=t.ERRORS.FILE_NOT_FOUND,o.message="No permissions, missing or empty file: "+e,o.endpoint=e,r(o);try{var s=t.delimiter,u=void 0===s?t._guessDelimiter(a):s,c=d3.dsvFormat(u).parse(a,function(t){return Object.keys(t).every(function(e){return!t[e]})?null:t}),h={columns:c.columns,rows:c};l[e+i]=h,n(h)}catch(t){return r(t)}})})},getAsset:function(t){var e=this,i=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.assetsPath+t);return new Promise(function(t,n){a.d3json(i,function(r,o){if(r)return r.name=e.ERRORS.FILE_NOT_FOUND,r.message="No permissions, missing or empty file: "+i,r.endpoint=i,n(r);t(o)})})},_guessDelimiter:function(t){var e=this._getRows(t.replace(/"[^\r]*?"/g,""),2);if(2!==e.length)throw this.error(this.ERRORS.NOT_ENOUGH_ROWS_IN_FILE);var i=n(e,2),r=i[0],o=i[1],a=this._countCharsInLine(r,","),s=this._countCharsInLine(r,";"),l=this._countCharsInLine(o,","),u=this._countCharsInLine(o,";");if(this._checkDelimiters(a,l,s,u))return",";if(this._checkDelimiters(s,u,a,l))return";";throw this.error(this.ERRORS.UNDEFINED_DELIMITER)},_checkDelimiters:function(t,e,i,n){return t===e&&t>1&&(i!==n||!i&&!n||t>i&&e>n)},_getRows:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=/([^\r\n]+)/g,n=[],r=0,o=!0;o&&r!==e;)(o=i.exec(t))&&o.length>1&&(++r,n.push(o[1]));return n},_countCharsInLine:function(t,e){var i=new RegExp(e,"g"),n=t.match(i);return n?n.length:0},_createParseStrategy:function(t){var e=this;return function(i){if(!new RegExp("[^-\\d"+t+"]").test(i)&&i){var n=(0,r.default)(i,t);return isFinite(n)&&!isNaN(n)||(e._isParseSuccessful=!1),n}return i}},_mapRows:function(t,e,i){var n=this._getRowMapper(e,i);this._failedParseStrategies=0;var r=!0,o=!1,a=void 0;try{for(var s,l=this._parseStrategies[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value;this._parse=u,this._isParseSuccessful=!0;var c=[],h=!0,d=!1,f=void 0;try{for(var p,m=t[Symbol.iterator]();!(h=(p=m.next()).done);h=!0){var v=n(p.value);if(!this._isParseSuccessful){this._failedParseStrategies++;break}c.push(v)}}catch(t){d=!0,f=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw f}}if(this._isParseSuccessful){if(this._failedParseStrategies===this._parseStrategies.length-1)throw this.error(this.ERRORS.DIFFERENT_SEPARATORS);return c}}}catch(t){o=!0,a=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}},versionInfo:{version:"0.32.3",build:1524665300706}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(77);var a={TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},THUMB_STROKE_WIDTH:4},s={small:{minRadiusPx:.5,maxRadiusEm:.05},medium:{minRadiusPx:1,maxRadiusEm:.05},large:{minRadiusPx:1,maxRadiusEm:.05}},l=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){this.name="bubblesize";var i=r.extend({},a);this.options=r.extend(i,this.options||{});var n=r.extend({},s);this.profiles=r.extend(n,this.profiles||{}),this.model_expects=[{name:"submodel",type:"size"},{name:"locale",type:"locale"}];this.changeHandler=this.changeHandler.bind(this),this.readyHandler=this.readyHandler.bind(this),this.model_binds={"change:submodel.domainMin":this.changeHandler,"change:submodel.domainMax":this.changeHandler},this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var i=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._updateLabels(i),this._super(t,e)},readyHandler:function(t){this._super(t),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this._setLabelsText()},readyOnce:function(){this._super(),this.showArcs=!1!==this.model.submodel.showArcs,this.padding.bottom=this.options.BAR_WIDTH+this.options.TEXT_PARAMS.MAX_HEIGHT,this.showArcs&&this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc").data([0,0]).enter().append("path").attr("class","vzb-bs-slider-thumb-arc"),this.sliderArcsEl=this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc"),this.sliderLabelsWrapperEl=this.sliderEl.append("g"),this.sliderLabelsWrapperEl.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("text-anchor",function(t,e){return e?"start":"end"}).attr("dy",function(t,e){return e?"-0.7em":"1.4em"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-bs-slider-thumb-label"),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText()},ready:function(){this._super(),this._updateLabels()},getMinMaxBubbleRadius:function(){var t=this.root.getVizWidthHeight(),e=r.hypotenuse(t.width,t.height),i=this.profiles[this.getLayoutProfile()].minRadiusPx,n=this.profiles[this.getLayoutProfile()].maxRadiusEm*e;return i>n&&(n=i),{min:i,max:n}},_updateSize:function(){var t=this;this._super(),this.sliderLabelsWrapperEl.attr("transform",this.isRTL?"scale(-1,1)":null),this.sliderLabelsEl.attr("text-anchor",function(e,i){return(t.isRTL?!i:i)?"start":"end"})},_resize:function(){var t=this.getMinMaxBubbleRadius(),e=this.element.node().offsetWidth-2*t.max;this.padding.top=t.max+this.options.BAR_WIDTH,this.padding.left=.5*e,this.padding.right=.5*e,this.rescaler.range([2*t.min,2*t.max]),this._super()},_getComponentWidth:function(){return 2*this.getMinMaxBubbleRadius().max},_updateThumbs:function(t){this._updateArcs(t),this._updateLabels(t)},_updateArcs:function(t){if(this.showArcs){var e=this,i=d3.arc().outerRadius(function(t){return.5*e.rescaler(t)}).innerRadius(function(t){return.5*e.rescaler(t)}).startAngle(.5*-Math.PI).endAngle(.5*Math.PI);this.sliderArcsEl.data(t).attr("d",i).attr("transform",function(t){return"translate("+.5*e.rescaler(t)+",0)"})}},_updateLabels:function(t){var e=this,i=this;t&&this.sliderLabelsEl.data(t),this.sliderLabelsEl.attr("transform",function(t,n){e.options.TEXT_PARAMS.TOP;var r=e.options.TEXT_PARAMS.LEFT*(n?.5:-1)+i.rescaler(t);return"translate("+(i.isRTL?-1:1)*r+",0)"})},_setLabelsText:function(){var t=[this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[0]),this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[1])];this.sliderLabelsEl.text(function(e,i){return t[i]})}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(77);var a={},s={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}},l=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){this.name="sizeslider";var i=r.extend({},a);this.options=r.extend(i,this.options||{});var n=r.extend({},s);this.profiles=r.extend(n,this.profiles||{}),this.propertyName=t.propertyname,this.model_expects=[{name:"submodel",type:"size"},{name:"locale",type:"locale"}];this.changeHandler=this.changeHandler.bind(this),this.readyHandler=this.readyHandler.bind(this),this.model_binds={"change:submodel.domainMin":this.changeHandler,"change:submodel.domainMax":this.changeHandler},this._setModel=r.throttle(this._setModel,50),this._super(t,e)},changeHandler:function(t,e){var i=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];this._updateLabels(i),this._super(t,e)},readyHandler:function(t){this.modelUse=this.model.submodel.use;var e=this.model.submodel.extent||[this.options.EXTENT_MIN,this.options.EXTENT_MAX];if("constant"!=this.modelUse)this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sliderEl.selectAll(".w").classed("vzb-hidden",!1),this.sliderEl.select(".selection").classed("vzb-hidden",!1),this.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!1),this._setLabelsText();else if(this.sliderEl.selectAll(".w").classed("vzb-hidden",!0),this.sliderEl.select(".selection").classed("vzb-hidden",!0),this.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!0),!this.model.submodel.which){var i=this.propertyActiveProfile;e[1]=(i.default-i.min)/(i.max-i.min),this.model.submodel.which="_default"}this._moveBrush(e)},readyOnce:function(){this._super();var t=this.options,e=t.BAR_WIDTH;this.propertyActiveProfile=this.getPropertyActiveProfile(),this.propertyScale=d3.scaleLinear().domain([t.EXTENT_MIN,t.EXTENT_MAX]).range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]).clamp(!0),this.padding.top=this.propertyActiveProfile.max+1.25*e,this.translator=this.model.locale.getTFunction(),this.sliderLabelsWrapperEl=this.sliderEl.append("g"),this.sliderLabelsWrapperEl.selectAll("text").data([0,0]).enter().append("text").attr("class",function(t,e){return"vzb-szs-slider-thumb-label "+(e?"e":"w")}).attr("dy",1.25*-e+"px"),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-szs-slider-thumb-label"),this.sizeScaleMinMax=this.model.submodel.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText(),this.model._ready&&this.readyHandler()},ready:function(){this._super(),this._updateLabels()},getPropertyActiveProfile:function(){var t=this.profiles[this.getLayoutProfile()];return{min:t["min"+this.propertyName],max:t["max"+this.propertyName],default:t["default"+this.propertyName]}},_updateSize:function(){var t=this;this._super(),this.sliderLabelsWrapperEl.attr("transform",this.isRTL?"scale(-1,1)":null),this.sliderLabelsEl.attr("text-anchor",function(e,i){return(t.isRTL?i:!i)?"start":"end"})},_resize:function(){this.propertyActiveProfile=this.getPropertyActiveProfile(),this.propertyScale.range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]),this.padding.top=this.propertyActiveProfile.max+1.25*this.options.BAR_WIDTH,this._super()},_updateThumbs:function(t){this._updateLabels(t)},_updateLabels:function(t){var e=this;t&&this.sliderLabelsEl.data(t),this.sliderLabelsEl.attr("transform",function(t,i){var n=e.rescaler(i);return"translate("+(e.isRTL?-1:1)*n+",0)"}).attr("font-size",function(t,i){return e.propertyScale(t)}),"constant"===e.model.submodel.use&&this.sliderLabelsEl.text(function(t){return~~e.propertyScale(t)+(e.translator(e.ui.constantUnit)||"")})},_setLabelsText:function(){var t=[this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[0]),this.model.submodel.getTickFormatter()(this.sizeScaleMinMax[1])];this.sliderLabelsEl.text(function(e,i){return t[i]})}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=l(i(1)),o=i(6),a=(n=o)&&n.__esModule?n:{default:n},s=l(i(21));function l(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var u=a.default.extend({init:function(t,e){var i=this;this.name=this.name||"gapminder-buttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},mapcolors:{title:"buttons/mapcolors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},zoom:{title:"buttons/zoom",icon:"cursorPlus",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"ui.chart.trails",statebindfunc:this.setBubbleTrails.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},about:{title:"buttons/about",icon:"about",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},side:{title:"buttons/side",icon:"side",required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.model_binds={"change:state.marker.select":function(t){i._readyOnce&&(i.setBubbleTrails(),i.setBubbleLock(),i._toggleButtons())},"change:ui.chart":function(t,e){i._readyOnce&&(e.indexOf("lockActive")>-1||e.indexOf("lockUnavailable")>-1)&&i.setBubbleLock()}},t.ui.buttons.forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(n){i._readyOnce&&e.statebindfunc(t,n.source.value)})}),this._super(t,e),this.validatePopupButtons(this.model.ui.buttons,this.model.ui.dialogs)},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.root.findChildByName("gapminder-dialogs").on("close",function(e,i){t.setButtonActive(i.id,!1)});var e=(this.model.ui.dialogs||{}).sidebar||[],i=[].concat(this.model.ui.buttons);this.model.ui.buttons=i,this._addButtons(i,e),this._prev_body_overflow=document.body.style.overflow,this.setBubbleTrails(),this.setBubbleLock(),this.setInpercent(),this.setPresentationMode(),this._toggleButtons()},proceedClick:function(t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),i=e.attr("class"),n=this._available_buttons[t];if(n&&n.func)n.func(t);else{var r=-1===i.indexOf("vzb-active");e.classed("vzb-active",r);var o={};o.id=t,o.active=r,this.trigger("click",o)}},validatePopupButtons:function(t,e){for(var i=this,n=e.popup,o=t.filter(function(t){return i._available_buttons[t]&&!i._available_buttons[t].func}),a=0,s=o.length;a<s;a++)if(-1==n.indexOf(o[a]))return r.error('Buttonlist: bad buttons config: "'+o[a]+'" is missing in popups list');return!1},_showAllButtons:function(){this.element.selectAll(".vzb-buttonlist-btn").each(function(t,e){d3.select(this).style("display","")})},_toggleButtons:function(){var t=this,e=this.parent.element.node?this.parent.element:d3.select(this.parent.element),i=(this.model.ui.dialogs||{}).sidebar||[];t._showAllButtons();var n=this.element.selectAll(".vzb-buttonlist-btn"),r=(this.element.node().getBoundingClientRect(),[]),o=[],a=80,s=80,l=this.element.node().getBoundingClientRect().width,u=this.element.node().getBoundingClientRect().height,c=0,h=0;n.each(function(e,n){var l=e,u=d3.select(this),d=-1!==i.indexOf(l.id),f=parseInt(u.style("margin-top")),p=parseInt(u.style("margin-right")),m=parseInt(u.style("margin-left")),v=parseInt(u.style("margin-bottom"));a=u.node().getBoundingClientRect().width+p+m,s=u.node().getBoundingClientRect().height+f+v,u.classed("vzb-hidden")||(d&&"large"===t.getLayoutProfile()?u.style("display","none"):(c+=a,h+=s,l.required?o.push(u):r.push(u)))});var d=c-l,f=h-u,p=1;e.classed("vzb-large")&&e.classed("vzb-dialog-expand-true")||e.classed("vzb-small")&&e.classed("vzb-portrait")?(d>0&&d<=10&&(l+=d),(p=Math.floor(l/a)-o.length)<0&&(p=0)):(f>0&&f<=10&&(u+=f),(p=Math.floor(u/s)-o.length)<0&&(p=0)),r.reverse();for(var m=[],v=0,g=r.length-p;v<g;v++)r[v].style("display","none"),m.push(r[v].attr("data-btn"));var y={};y.hiddenButtons=m,t.trigger("toggle",y)},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var o=0;o<t.length;o++){var a=t[o],l=this._available_buttons[a]?a:"_default",u=r.clone(this._available_buttons[l]);"_default"==l&&(u.title="buttons/"+a),u.id=a,u.icon=s[u.icon],n.push(u)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"}),this.element.selectAll(".vzb-buttonlist-btn").on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},scrollToEnd:function(){var t=0,e=d3.select(".vzb-tool");e.classed("vzb-portrait")&&e.classed("vzb-small")?(this.model.state.marker.select.length>0&&(t=this.element.node().scrollWidth),this.element.node().scrollLeft=t):(this.model.state.marker.select.length>0&&(t=this.element.node().scrollHeight),this.element.node().scrollTop=t)},resize:function(){if(!this.element.selectAll)return r.warn("buttonlist resize() aborted because element is not yet defined");"small"===this.getLayoutProfile()&&this.model.ui.presentation&&this.togglePresentationMode(),this._toggleButtons()},setButtonActive:function(t,e){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").classed("vzb-active",e)},toggleBubbleTrails:function(){this.model.ui.chart.trails=!this.model.ui.chart.trails,this.setBubbleTrails()},setBubbleTrails:function(){var t=(this.model.ui.chart||{}).trails;if(t||!1===t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='trails']");if(!e.node())return r.warn("setBubbleTrails: no button 'trails' found in DOM. doing nothing");e.classed("vzb-active-locked",t),e.classed("vzb-hidden",0==this.model.state.marker.select.length)}},toggleBubbleLock:function(t){var e=(this.model.ui.chart||{}).lockActive;if(0!=this.model.state.marker.select.length||e){var i=this.model.ui.chart.lockNonSelected,n=this.model.state.time;i=i?0:n.formatDate(n.value),this.model.ui.chart.lockNonSelected=i,this.setBubbleLock()}},setBubbleLock:function(){var t=(this.model.ui.chart||{}).lockNonSelected,e=(this.model.ui.chart||{}).lockActive,i=(this.model.ui.chart||{}).lockUnavailable||!1;if(t||0===t){0===t||0!==this.model.state.marker.select.length||e||(t=this.model.ui.chart.lockNonSelected=0);var n=this.element.selectAll(".vzb-buttonlist-btn[data-btn='lock']");if(!n.node())return r.warn("setBubbleLock: no button 'lock' found in DOM. doing nothing");var o=this.model.locale.getTFunction();n.classed("vzb-unavailable",i),void 0===e?n.classed("vzb-hidden",0==this.model.state.marker.select.length):n.classed("vzb-hidden",!e),n.classed("vzb-active-locked",t),n.select(".vzb-buttonlist-btn-icon").html(s[t?"lock":"unlock"]),n.select(".vzb-buttonlist-btn-title>span").text(t||o("buttons/lock")).attr("data-vzb-translate",t?null:"buttons/lock")}},toggleInpercent:function(){this.model.ui.chart.inpercent=!this.model.ui.chart.inpercent,this.setInpercent()},setInpercent:function(){if(void 0!==(this.model.ui.chart||{}).inpercent){this.model.locale.getTFunction();this.element.selectAll(".vzb-buttonlist-btn[data-btn='inpercent']").classed("vzb-active-locked",this.model.ui.chart.inpercent)}},togglePresentationMode:function(){this.model.ui.presentation=!this.model.ui.presentation,this.setPresentationMode()},setPresentationMode:function(){this.model.locale.getTFunction();this.element.selectAll(".vzb-buttonlist-btn[data-btn='presentation']").classed("vzb-active-locked",this.model.ui.presentation)},toggleFullScreen:function(t,e){if(window){for(var i,n=this,o=n.placeholder,a=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),l=!this.model.ui.fullscreen,u=l?"hidden":this._prev_body_overflow;!r.hasClass(o,"vzb-placeholder");)o=(n=n.parent).placeholder;l?(this.resizeInExitHandler=!1,(i=o).requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&h()&&i.webkitRequestFullscreen(),function(t){if(!window)return;var e=window.document;this.exitFullscreenHandler=function(t){window&&(void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement&&window.document.msFullscreenElement)||(c.call(this),this.resizeInExitHandler?this.root.ui.resizeHandler():t())}.bind(this,t),e.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}.call(this,this.toggleFullScreen.bind(this,t,!0))):(this.resizeInExitHandler=!e,function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&h()?document.webkitExitFullscreen():(c.call(this),this.resizeInExitHandler=!1)}.call(this)),r.classed(o,"vzb-force-fullscreen",l),"undefined"!=typeof container&&r.classed(container,"vzb-container-fullscreen",l),this.model.ui.fullscreen=l;var d=this.model.locale.getTFunction();a.classed("vzb-active-locked",l),a.select(".vzb-buttonlist-btn-icon").html(s[l?"unexpand":"expand"]),a.select(".vzb-buttonlist-btn-title>span").text(d("buttons/"+(l?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(l?"unexpand":"expand")),document.body.style.overflow=u,this.resizeInExitHandler||this.root.ui.resizeHandler()}}});function c(){var t=window.document;t.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("fullscreenchange",this.exitFullscreenHandler),t.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function h(){return!(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"))}e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a(i(1));var n,r=i(162),o=(n=r)&&n.__esModule?n:{default:n};a(i(21));function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var s=o.default.extend({init:function(t,e){this.name="gapminder-optionsbuttonlist",this._super(t,e)},readyOnce:function(){var t=this;Object.keys(this._available_buttons).forEach(function(e){var i=t._available_buttons[e];i.required=!i.required}),this.buttonListComp=this.root.findChildByName("gapminder-buttonlist"),this.buttonListComp.on("click",function(e,i){t.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i.id+"']").classed("vzb-active",i.active)}),this.buttonListComp.on("toggle",function(e,i){t.element.selectAll(".vzb-buttonlist-btn").each(function(t){var e=d3.select(this),n=-1==i.hiddenButtons.indexOf(t.id);e.style("display",n?"none":""),n||0})}),this._super()},proceedClick:function(t){var e=this;this.buttonListComp.proceedClick(t),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").datum().func&&setTimeout(function(){e.root.findChildByName("gapminder-dialogs").closeAllDialogs()},200)},_toggleButtons:function(){}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=u(i(6)),a=u(i(165)),s=u(i(111)),l=i(21);function u(t){return t&&t.__esModule?t:{default:t}}function c(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var h=o.default.extend({init:function(t,e){var i=this;this.template='<div class="vzb-cl-outer"></div>',this.name="colorlegend",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"marker"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:color.scaleType":function(t,e){i._readyOnce&&!i.colorModel.isDiscrete()&&i.updateView()},"change:color.palette":function(t,e){!i._readyOnce||i.colorModel.isDiscrete()&&!i.frame||i.updateView()},"change:marker.highlight":function(t,e){i.colorModel.isDiscrete()&&i.model.marker.getFrame(i.model.time.value,function(t){if(t){var e=i.model.marker.getHighlighted(i.KEY);i.updateGroupsOpacity(e.map(function(e){return t[i.colorModel._name][e]}))}else i.updateGroupsOpacity()})},"change:time.start":function(t,e){i._readyOnce&&!i.model.time.splash&&i.colorModel.which==i.model.time.dim&&i.ready()},"change:time.end":function(t,e){i._readyOnce&&!i.model.time.splash&&i.colorModel.which==i.model.time.dim&&i.ready()},"translate:locale":function(){i._translateSelectDialog(i.model.locale.getTFunction()),i.colorPicker.translate(i.model.locale.getTFunction())}},this._super(t,e)},readyOnce:function(){var t=this;this.element=d3.select(this.element),d3.select(this.placeholder.parentNode).classed("vzb-dialog-scrollable",!0),this.colorModel=this.model.color,this.colorlegendMarker=this.colorModel.getColorlegendMarker(),this.colorlegendMarker&&this.colorlegendMarker.on("ready",function(){t.ready()}),this.listColorsEl=this.element.append("div").attr("class","vzb-cl-holder").append("div").attr("class","vzb-cl-colorlist"),this.rainbowEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow"),this.rainbowCanvasEl=this.rainbowEl.append("canvas"),this.minimapEl=this.listColorsEl.append("div").attr("class","vzb-cl-minimap"),this.rainbowLegendEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow-legend"),this.rainbowLegendSVG=this.rainbowLegendEl.append("svg"),this.rainbowLegendG=this.rainbowLegendSVG.append("g"),this.rainbowLegend=null,this.labelScaleEl=this.listColorsEl.append("div").attr("class","vzb-cl-labelscale"),this.labelScaleSVG=this.labelScaleEl.append("svg"),this.labelScaleG=this.labelScaleSVG.append("g"),this.subtitleDiv=this.listColorsEl.append("div").attr("class","vzb-cl-subtitle"),this.subtitleText=this.subtitleDiv.append("span").attr("class","vzb-cl-subtitle-text"),this.minimapSVG=this.minimapEl.append("svg"),this.minimapG=this.minimapSVG.append("g"),this.colorPicker=new a.default(r.isArray(this.root.element)?this.root.element:d3.select(this.root.element)),this.colorPicker.translate(this.model.locale.getTFunction()),this._initSelectDialog()},_initSelectDialog:function(){this.moreOptionsHint=this.listColorsEl.append("span").classed("vzb-cl-more-hint vzb-hidden",!0),this.selectDialog=this.listColorsEl.append("div").classed("vzb-cl-select-dialog vzb-hidden",!0),this._initSelectDialogItems(),this._translateSelectDialog(this.model.locale.getTFunction())},_initSelectDialogItems:function(){var t=this;this.selectDialogTitle=this.selectDialog.append("div").classed("vzb-cl-select-dialog-title",!0),this.selectDialog.append("div").classed("vzb-cl-select-dialog-close",!0).html(l.close).on("click",function(){return t._closeSelectDialog()}),this.selectAllButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item",!0),this.removeElseButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item",!0),this.editColorButton=this.selectDialog.append("div").classed("vzb-cl-select-dialog-item vzb-cl-select-dialog-item-moreoptions",!0),this.editColorButtonTooltip=this.editColorButton.append("div").classed("vzb-cl-select-dialog-item-tooltip",!0)},_translateSelectDialog:function(t){this.moreOptionsHint.text(t("hints/color/more")),this.selectAllButton.text(" "+t("dialogs/color/select-all")),this.removeElseButton.text(" "+t("dialogs/color/remove-else")),this.editColorButton.text(" "+t("dialogs/color/edit-color")),this.editColorButtonTooltip.text("Dataset author doesn't want you to change this")},_closeSelectDialog:function(){this.selectDialog.classed("vzb-hidden",!0)},_bindSelectDialogItems:function(){for(var t=this,e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];var o=n(i,3),a=o[1],s=o[2];this.selectDialogTitle.text(s[a].textContent),this.selectAllButton.on("click",function(){var e;(e=t._interact()).clickToSelect.apply(e,c(i)),t._closeSelectDialog()}),this.removeElseButton.on("click",function(){var e;(e=t._interact()).clickToShow.apply(e,c(i)),t._closeSelectDialog()}),this.editColorButton.on("click",function(){var e;(e=t._interact()).clickToChangeColor.apply(e,c(i)),t._closeSelectDialog()})},ready:function(){var t=this;if(this.KEYS=r.unique(this.model.marker._getAllDimensions({exceptType:"time"})),this.KEY=this.KEYS.join(","),this.colorlegendDim=this.KEY,this.canShowMap=!1,this.colorModel.isDiscrete()&&"constant"!==this.colorModel.use&&this.colorlegendMarker){if(!this.colorlegendMarker._ready)return;return this.markerKeys=t.model.marker.getKeys(),this.KEY=t.colorModel.getDataKeys()[0],this.colorlegendDim=this.colorModel.getColorlegendEntities().getDimension(),void this.colorlegendMarker.getFrame(this.model.time.value,function(e){if(!e)return r.warn("colorlegend received empty frame in ready()");t.frame=e,t.canShowMap=r.keys((t.frame||{}).hook_geoshape||{}).length,t.colorlegendKeys=t.colorlegendMarker.getKeys(t.colorlegendDim),t.colorlegendKeys.forEach(function(e){((t.frame||{}).hook_geoshape||{})[e[t.colorlegendDim]]||(t.canShowMap=!1)}),t.updateView(),t.updateGroupsOpacity()})}t.updateView(),t.updateGroupsOpacity()},updateView:function(){var t=this;if(!this.element.selectAll)return r.warn("colorlegend resize() aborted because element is not yet defined");var e=this,i=this.KEY,n=this.colorModel.getPalette(),o=this.canShowMap,a=this.colorlegendKeys||[],l=this.listColorsEl.selectAll(".vzb-cl-option"),u=o||"_default"==this.colorModel.which||this.colorlegendMarker&&this.colorlegendDim==this.KEY&&a.length>10&&r.comparePlainObjects(this.colorModel.getColorlegendEntities().getFilter(),this.model.entities.getFilter());l.classed("vzb-hidden",u),this._updateSelectDialog(),this.rainbowEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.labelScaleEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.rainbowLegendEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.minimapEl.classed("vzb-hidden",!o||!this.colorModel.isDiscrete()),this.subtitleDiv.classed("vzb-hidden",!0);var c=this.colorModel.getScale();if(this.colorModel.isDiscrete())if(o){var h=this.minimapEl.append("div").attr("class","vzb-temp");this.minimapSVG.attr("viewBox",null),this.minimapSVG.selectAll("g").remove(),this.minimapG=this.minimapSVG.append("g"),this.minimapG.selectAll("path").data(a,function(t){return t[e.colorlegendDim]}).enter().append("path").on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}).each(function(t){var i=e.frame.hook_geoshape[t[e.colorlegendDim]].trim();"<svg"==i.slice(0,4)&&(h.html(i),i=h.select("svg").select("path").attr("d")),d3.select(this).attr("d",i).style("fill",c(t[e.colorlegendDim])).append("title").text(e.frame.label[t[e.colorlegendDim]]),h.html("")});var d=this.minimapG.node().getBBox();this.minimapSVG.attr("viewBox","0 0 "+1.05*d.width+" "+1.05*d.height),h.remove()}else(l="_default"==this.colorModel.which?l.data([]):l.data(u?[]:a.length?e.colorlegendDim==i?r.unique(e.markerKeys,function(t){return t[i]}):a:Object.keys(this.colorModel.getPalette()).map(function(t){var i={};return i[e.colorlegendDim]=t,i}),function(t){return t[e.colorlegendDim]})).exit().remove(),(l=l.enter().append("div").attr("class","vzb-cl-option").each(function(){var t=this;d3.select(this).append("div").attr("class","vzb-cl-color-sample").on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}),d3.select(this).append("div").attr("class","vzb-cl-color-legend")}).on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",function(){t._bindSelectDialogItems.apply(t,arguments),t.selectDialog.classed("vzb-hidden",!1)}).merge(l)).each(function(t,i){d3.select(this).select(".vzb-cl-color-sample").style("background-color",c(t[e.colorlegendDim])).style("border","1px solid "+c(t[e.colorlegendDim]));var n=e.colorlegendMarker?e.frame.label[t[e.colorlegendDim]]:null;n||0===n||(n=t[e.colorlegendDim]),d3.select(this).select(".vzb-cl-color-legend").text(n)});else{var f=this.rainbowEl.node().getBoundingClientRect().width,p=Object.keys(n).map(parseFloat),m=void 0,v=void 0,g=this.colorModel.getTickFormatter(),y=null,_=this.colorModel.paletteLabels;if(_){y="optimistic",m=_.map(function(t){return parseFloat(t)});var b=d3.max(m);v=m.map(function(t){return t/b*f})}else{m=c.domain();var x=d3.max(p);v=p.map(function(t){return t/x*f})}var w=d3.min(m)<=0&&d3.max(m)>=0&&"log"===this.colorModel.scaleType?"genericLog":this.colorModel.scaleType,S=d3["scale"+r.capitalize("time"===w?"linear":w)]().domain(m).range(v),M=parseInt(this.rainbowEl.style("left"),10)||0,E=parseInt(this.rainbowEl.style("right"),10)||M;this.labelScaleSVG.style("width",M+f+E+"px"),this.labelScaleG.attr("transform","translate("+M+",0)"),this.rainbowLegendSVG.style("width",M+f+E+"px"),this.rainbowLegendG.attr("transform","translate("+M+", 7)");var z=(0,s.default)("bottom");z.scale(S).tickSizeOuter(0).tickPadding(6).tickSizeMinor(3,0).labelerOptions({scaleType:this.colorModel.scaleType,toolMargin:{right:E,left:M},showOuter:!0,formatter:g,bump:M,cssFontSize:"11px",fitIntoScale:y}),this.labelScaleG.call(z);var k=c.range(),T=v.map(function(t,e){return{val:t,color:k[e],paletteKey:p[e]}});this.rainbowLegend=this.rainbowLegendG.selectAll("circle").data(T),this.rainbowLegend.exit().remove(),this.rainbowLegend=this.rainbowLegend.enter().append("circle").attr("r","6px").attr("stroke","#000").on("click",e._interact().clickToChangeColor).merge(this.rainbowLegend),this.rainbowLegend.each(function(t,e){d3.select(this).attr("fill",t.color),d3.select(this).attr("cx",t.val)}),this.rainbowCanvasEl.attr("width",f).attr("height",1).style("width",f+"px").style("height","100%");for(var O,C=this.rainbowCanvasEl.node().getContext("2d"),P=C.createImageData(f,1),A=0,I=-1;A<f;++A)O=d3.rgb(c(S.invert(A))),P.data[++I]=O.r,P.data[++I]=O.g,P.data[++I]=O.b,P.data[++I]=255;C.putImageData(P,0,0);var L=this.colorModel.getConceptprops(),D=r.getSubtitle(L.name,L.name_short);this.subtitleDiv.classed("vzb-hidden",""==D),this.subtitleText.text(D),l.classed("vzb-hidden",!0)}},_updateSelectDialog:function(){var t=this.colorModel.isUserSelectable();this.editColorButtonTooltip.classed("vzb-hidden",t),this.editColorButton.classed("vzb-cl-select-dialog-item-disabled",!t),this.selectDialog.classed("vzb-hidden",!0)},_highlight:function(t){r.getProp(this,["model","ui","chart","superhighlightOnMinimapHover"])?this.model.marker.setSuperHighlight(t):this.model.marker.setHighlight(t)},_unhighlight:function(){r.getProp(this,["model","ui","chart","superhighlightOnMinimapHover"])?this.model.marker.clearSuperHighlighted():this.model.marker.clearHighlighted()},_interact:function(){var t=this,e=this.KEYS,i=this.KEY,n=this.colorlegendDim;return{mouseover:function(e,r){if(t.moreOptionsHint.classed("vzb-hidden",!1),t.colorModel.isDiscrete()){d3.select(this);var o=e[n],a=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==o}).reduce(function(t,e){return t[e[i]]=!0,t},{});t._highlight(t.markerKeys.filter(function(t){return a[t[i]]}))}},mouseout:function(e,i){t.moreOptionsHint.classed("vzb-hidden",!0),t.colorModel.isDiscrete()&&t._unhighlight()},clickToChangeColor:function(e,i){if(t.colorModel.isUserSelectable()){var r=t.colorModel.getPalette(),o=t.colorModel.getDefaultPalette(),a=(d3.select(this),t.colorModel.isDiscrete()?e[n]:e.paletteKey);t.colorPicker.colorOld(r[a]).colorDef(o[a]).callback(function(e,i){return t.colorModel.setColor(e,a,i)}).fitToScreen([d3.event.pageX,d3.event.pageY]).show(!0)}},clickToShow:function(e,i){if(t.colorModel.isDiscrete()){d3.select(this),e[n];var o=t.model.entities.show[n]&&t.model.entities.show[n].$in?r.clone(t.model.entities.show[n].$in):[],a=o.indexOf(e[n]);-1!==a?o.splice(a,1):o.push(e[n]);var s={};o.length>0&&(s[n]={$in:o}),t.model.entities.set({show:s})}},clickToSelect:function(o,a){if(t.colorModel.isDiscrete()){d3.select(this);var s=o[n],l=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==s}).reduce(function(t,e){return t[e[i]]=!0,t},{}),u=t.markerKeys.filter(function(t){return l[t[i]]}).map(function(t){return r.clone(t,e)});u.filter(function(e){return t.model.marker.isSelected(e)}).length==u.length?t.model.marker.clearSelected():t.model.marker.setSelect(u)}}}},resize:function(){this.frame&&this.updateView(),this.colorPicker.resize(d3.select(".vzb-colorpicker-svg"))},updateGroupsOpacity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this,i=this.colorModel.getColorlegendMarker()||{},n=i.opacityRegular||.8,r=i.opacityHighlightDim||.5,o=e.canShowMap?".vzb-cl-minimap path":".vzb-cl-option .vzb-cl-color-sample";this.listColorsEl.selectAll(o).style("opacity",function(i){return t.length?t.indexOf(i[e.colorlegendDim])>-1?1:r:n})}});e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(1);var o={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorpicker-pointer",COLOR_BUTTON:"vzb-colorpicker-cell",COLOR_DEFAULT:"vzb-colorpicker-default",COLOR_SAMPLE:"vzb-colorpicker-sample",COLOR_PICKER:"vzb-colorpicker-svg",COLOR_CIRCLE:"vzb-colorpicker-circle",COLOR_CIRCLES:"vzb-colorpicker-circles",COLOR_SEGMENT:"vzb-colorpicker-segment",COLOR_BACKGR:"vzb-colorpicker-background"},a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e,this._wrapper=this._container.select("."+o.COLOR_PICKER),this._init()}return n(t,[{key:"_init",value:function(){this._initVariables(),this._initCircles(),this._style(),this.resize(this._svg)}},{key:"_initVariables",value:function(){this._maxWidth=280,this._maxHeight=323,this._colorOld="#000",this._colorDef="#000",this._colorWhite="#f8f8f8",this._margin={top:.1,bottom:.1,left:.1,right:.1},this._initSvg();var t=getComputedStyle(this._svg.node()),e=t.width,i=t.height;this._width=this.constructor.px2num(e),this._height=this.constructor.px2num(i),this._maxRadius=this._width/2*(1-this._margin.left-this._margin.right),this._nCellsH=15,this._minH=0,this._nCellsL=4,this._minL=.5,this._satConstant=.7,this._outerL_display=.4,this._outerL_meaning=.3,this._firstAngleSat=0,this._minRadius=15,this._arc=d3.arc(),this._pie=d3.pie().sort(null).value(function(t){return 1}),this._colorPointer=null,this._showColorPicker=!1,this._sampleRect=null,this._sampleText=null,this._callback=function(t){return console.info("Color picker callback example. Setting color to "+t)},this._colorData=this._generateColorData()}},{key:"_generateColorData",value:function(){for(var t=this._minL,e=this._minH,i=this._nCellsL,n=this._nCellsH,r=this._firstAngleSat,o=this._satConstant,a=this._outerL_display,s=this._outerL_meaning,l=[],u=0;u<i;u++){var c=t+(1-t)/i*u;l.push([]);for(var h=0;h<=n;h++){var d=e+(1-e)/n*h;l[u].push({display:this.constructor.hsl2rgb(d,0===h?r:o,0===u?a:c),meaning:this.constructor.hsl2rgb(d,0===h?r:o,0===u?s:c)})}}return l}},{key:"_initSvg",value:function(){var t=this;this._wrapper=this._container.append("div").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("max-width",this._maxWidth+"px").style("height","100%").style("max-height",this._maxHeight+"px").style("z-index",9999).attr("class",o.COLOR_PICKER+" vzb-dialog-shadow").classed(o.INVISIBLE,!this._showColorPicker).on("mouseout",function(){return t._cellHover(t._colorOld)}),this._svg=this._wrapper.append("svg").style("width","100%").style("height","100%")}},{key:"_initCircles",value:function(){var t=this,e=this._svg,i=this._maxHeight,n=this._width,r=this._height,a=this._margin,s=this._colorData,l=this._nCellsL,u=this._minRadius,c=this._maxRadius,h=this._colorWhite;e.append("rect").attr("width",n).attr("height",i).attr("class",o.COLOR_BACKGR).on("mouseover",function(){return t._cellHover(t._colorOld)}).on("click",function(){d3.event.stopPropagation(),t._changeColor(t._colorOld),t.show(!1)});var d=c+n*a.left,f=c+r*a.top,p=e.append("g").attr("class",o.COLOR_CIRCLES).attr("transform","translate("+d+", "+f+")");e.append("rect").attr("class",o.COLOR_SAMPLE).attr("width",n/2).attr("height",r*a.top/2),this._sampleRect=e.append("rect").attr("class",o.COLOR_SAMPLE).attr("width",n/2).attr("x",n/2).attr("height",r*a.top/2),e.append("text").attr("x",n*a.left).attr("y",r*a.top/2).attr("dy","1.3em").attr("class",o.COLOR_SAMPLE).style("text-anchor","start"),this._sampleText=e.append("text").attr("x",n*(1-a.right)).attr("y",r*a.top/2).attr("dy","1.3em").attr("class",o.COLOR_SAMPLE).style("text-anchor","end"),e.append("text").attr("x",.1*n).attr("y",r*(1-a.bottom)).attr("dy","1.2em").attr("class","vzb-default-label").style("text-anchor","start").text("default"),e.append("circle").attr("class",o.COLOR_DEFAULT+" "+o.COLOR_BUTTON).attr("r",n*a.left/2).attr("cx",n*a.left*1.5).attr("cy",r*(1-1.5*a.bottom)).on("mouseover",function(){d3.select(this).style("stroke","#444"),m._cellHover(m._colorDef)}).on("mouseout",function(){d3.select(this).style("stroke","none")});var m=this;p.selectAll("."+o.COLOR_CIRCLE).data(s).enter().append("g").attr("class",o.COLOR_CIRCLE).each(function(t,e){m._arc.outerRadius(u+(c-u)/l*(l-e)).innerRadius(u+(c-u)/l*(l-e-1)),d3.select(this).selectAll("."+o.COLOR_SEGMENT).data(m._pie(t)).enter().append("g").attr("class",o.COLOR_SEGMENT).append("path").attr("class",o.COLOR_BUTTON).attr("d",m._arc).style("fill",function(t){return t.data.display}).style("stroke",function(t){return t.data.display}).on("mouseover",function(t){m._cellHover(t.data.meaning,this)}).on("mouseout",function(){return m._cellUnhover()})}),p.append("circle").attr("r",u).attr("fill",h).attr("class",o.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke","#555"),m._cellHover(h)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),this._colorPointer=p.append("path").attr("class",o.COLOR_POINTER+" "+o.INVISIBLE),e.selectAll("."+o.COLOR_BUTTON).on("click",function(e){d3.event.stopPropagation(),t._changeColor(e?e.data.meaning:t._colorDef,!0),t.show(!1)})}},{key:"_style",value:function(){var t=this._svg,e=this._colorWhite;t.select("."+o.COLOR_BACKGR).style("fill","white"),t.select("."+o.COLOR_POINTER).style("stroke-width",2).style("stroke",e).style("pointer-events","none").style("fill","none"),t.selectAll("."+o.COLOR_BUTTON).style("cursor","pointer"),t.selectAll("text").style("pointer-events","none").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),t.selectAll("circle."+o.COLOR_BUTTON).style("stroke-width",2),t.selectAll("rect."+o.COLOR_SAMPLE).style("pointer-events","none")}},{key:"_cellHover",value:function(t,e){null!=e&&this._colorPointer.classed(o.INVISIBLE,!1).attr("d",d3.select(e).attr("d")),this._sampleRect.style("fill",t),this._sampleText.text(t);var i=(0,r.isTouchDevice)();this._changeColor(t,i),i&&this.show(!1)}},{key:"_changeColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._callback(t,e)}},{key:"_cellUnhover",value:function(){this._colorPointer.classed(o.INVISIBLE,!0)}},{key:"resize",value:function(t){if(arguments.length){if(void 0!==t){var e=this._margin,i=t,n=getComputedStyle(i.node()),r=n.width,a=n.height,s=this.constructor.px2num(r),l=this.constructor.px2num(a),u=s/2*(1-e.left-e.right),c=i.select("."+o.COLOR_DEFAULT),h=i.select(".vzb-default-label"),d=i.select("."+o.COLOR_CIRCLES),f=u+l*e.top,p=(1+.5*e.top)*l*.5,m=u+s*e.left,v=f>p?p:f;d.attr("transform","translate("+m+", "+v+")"),c.attr("cx",s*e.left*1.5).attr("cy",l*(1-1.5*e.bottom)),h.attr("x",.1*s).attr("y",l*(1-e.bottom))}return this.fitToScreen()}}},{key:"fitToScreen",value:function(t){var e=this._container.node().getBoundingClientRect(),i=void 0,n=void 0,r=getComputedStyle(this._wrapper.node()),o=r.width,a=r.height,s=r.right,l=r.top,u=this.constructor.px2num(o),c=this.constructor.px2num(a);t?(i=t[0]-e.left,n=t[1]-e.top):(i=e.width-this.constructor.px2num(s)-u,n=this.constructor.px2num(l));var h={left:""};return.8*e.width<=u?h.right=.5*(e.width-u)+"px":i+u>e.width?h.right=Math.min(.1*e.width,20)+"px":h.right=e.width-i-u+"px",h.right&&this._wrapper.style("right",h.right),.8*e.height<=c?h.top=.5*(e.height-c)+"px":n+1.2*c>e.height?h.top=.9*e.height-c+"px":h.top=n+"px",h.top&&this._wrapper.style("top",h.top),this._wrapper.style("left",h.left),this}},{key:"show",value:function(t){if(!arguments.length)return this._showColorPicker;null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._showColorPicker="toggle"==t?!this._showColorPicker:t,this._showColorPicker||(this._callback=function(){}),this._wrapper.classed(o.INVISIBLE,!this._showColorPicker)}},{key:"_getOrSet",value:function(t,e){return t="_"+t,arguments.length>1?(this[t]=e,this):this[t]}},{key:"nCellsH",value:function(){return this._getOrSet.apply(this,["nCellsH"].concat(Array.prototype.slice.call(arguments)))}},{key:"minH",value:function(){return this._getOrSet.apply(this,["minH"].concat(Array.prototype.slice.call(arguments)))}},{key:"nCellsL",value:function(){return this._getOrSet.apply(this,["nCellsL"].concat(Array.prototype.slice.call(arguments)))}},{key:"minL",value:function(){return this._getOrSet.apply(this,["minL"].concat(Array.prototype.slice.call(arguments)))}},{key:"outerL_display",value:function(){return this._getOrSet.apply(this,["outerL_display"].concat(Array.prototype.slice.call(arguments)))}},{key:"outerL_meaning",value:function(){return this._getOrSet.apply(this,["outerL_meaning"].concat(Array.prototype.slice.call(arguments)))}},{key:"satConstant",value:function(){return this._getOrSet.apply(this,["satConstant"].concat(Array.prototype.slice.call(arguments)))}},{key:"firstAngleSat",value:function(){return this._getOrSet.apply(this,["firstAngleSat"].concat(Array.prototype.slice.call(arguments)))}},{key:"minRadius",value:function(){return this._getOrSet.apply(this,["minRadius"].concat(Array.prototype.slice.call(arguments)))}},{key:"margin",value:function(){return this._getOrSet.apply(this,["margin"].concat(Array.prototype.slice.call(arguments)))}},{key:"callback",value:function(){return this._getOrSet.apply(this,["callback"].concat(Array.prototype.slice.call(arguments)))}},{key:"colorDef",value:function(t){return arguments.length?(void 0!==t&&(this._colorDef=t),null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._svg.select("."+o.COLOR_DEFAULT).style("fill",this._colorDef),this):this._colorDef}},{key:"translate",value:function(t){return"function"==typeof t&&this._svg.select(".vzb-default-label").text(t("colorpicker/default")),this}},{key:"colorOld",value:function(t){return arguments.length?(this._colorOld=t,null==this._svg&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),this._svg.select("rect."+o.COLOR_SAMPLE).style("fill",this._colorOld),this._svg.select("text."+o.COLOR_SAMPLE).text(this._colorOld),this):this._colorOld}}],[{key:"hsl2rgb",value:function(t,e,i){var n=void 0,r=void 0,o=void 0;if(0==e)n=r=o=i;else{var a=i<.5?i*(1+e):i+e-i*e,s=2*i-a;n=this.hue2rgb(s,a,t+1/3),r=this.hue2rgb(s,a,t),o=this.hue2rgb(s,a,t-1/3)}return"#"+Math.round(255*n).toString(16)+Math.round(255*r).toString(16)+Math.round(255*o).toString(16)}},{key:"hue2rgb",value:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}},{key:"px2num",value:function(t){return parseFloat(t)||0}}]),t}();e.default=a},function(t,e){t.exports='<div class="vzb-show-list vzb-accordion">\n  \x3c!-- list will be placed here --\x3e\n</div>\n'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(i(1));var n=a(i(12)),r=a(i(110)),o=(a(i(147)),a(i(108)));function a(t){return t&&t.__esModule?t:{default:t}}var s=n.default.extend("about",{init:function(t,e){this.name="about",this._super(t,e)},readyOnce:function(){var t=r.default.version,e=new Date(parseInt(r.default.build));this.element=d3.select(this.element),this.element.select(".vzb-about-text0").html("This chart is made with Vizabi,"),this.element.select(".vzb-about-text1").html("a project by <a href='http://gapminder.org' target='_blank'>Gapminder Foundation</a>"),this.element.select(".vzb-about-version").html("<a href='https://github.com/Gapminder/vizabi/releases/tag/v"+t+"' target='_blank'>Version: "+t+"</a>"),this.element.select(".vzb-about-updated").html("Build: "+d3.time.format("%Y-%m-%d at %H:%M")(e)),this.element.select(".vzb-about-report").html("<a href='https://getsatisfaction.com/gapminder/' target='_blank'>Report a problem</a>"),this.element.select(".vzb-about-credits").html("<a href='https://github.com/Gapminder/vizabi/graphs/contributors' target='_blank'>Contributors</a>");var i=o.default,n={},a=this.root.versionInfo;n.version=a?a.version:"N/A",n.build=a?d3.time.format("%Y-%m-%d at %H:%M")(new Date(parseInt(a.build))):"N/A",n.name=this.root.name;var s=this.element.select(".vzb-about-tool");s.html(""),s.append("p").text("Tool: "+n.name),s.append("p").text("-version: "+n.version),s.append("p").text("-build: "+n.build);var l=i.instances.map(function(t){var e={},i=t.readerObject.versionInfo;return e.version=i?i.version:"N/A",e.build=i?d3.time.format("%Y-%m-%d at %H:%M")(new Date(parseInt(i.build))):"N/A",e.name=t.readerObject._name,e}),u=this.element.select(".vzb-about-readers").selectAll(".vzb-about-reader").data(l);u.exit().remove(),(u=u.enter().append("p").attr("class","vzb-about-reader")).append("p").text(function(t){return t.name}),u.append("p").text(function(t){return"-version: "+t.version}),u.append("p").text(function(t){return"-build: "+t.build});var c=i.instances.map(function(t){return t.getDatasetName()}),h=this.element.select(".vzb-about-datasets").selectAll(".vzb-about-dataset").data(c);h.exit().remove(),(h=h.enter().append("p").attr("class","vzb-about-dataset")).append("p").text(function(t){return t})}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),a(i(6));var n=a(i(12)),r=a(i(50)),o=a(i(169));function a(t){return t&&t.__esModule?t:{default:t}}var s=n.default.extend("axes",{init:function(t,e){this.name="axes";this.components=[{component:r.default,placeholder:".vzb-xaxis-selector",model:["state.time","state.marker.axis_x","locale"]},{component:o.default,placeholder:".vzb-xaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}},{component:r.default,placeholder:".vzb-yaxis-selector",model:["state.time","state.marker.axis_y","locale"]},{component:o.default,placeholder:".vzb-yaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_y",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(6);function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){var n,o=this;this.name="gapminder-minmaxinputs",this.template=i(421),this.model_expects=[{name:"marker",type:"marker"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.markerID=t.markerID,t.markerID||r.warn("minmaxinputs.js complains on 'markerID' property: "+t.markerID),this.model_binds=(a(n={"translate:locale":function(){o.updateView()}},"change:marker."+this.markerID,function(){o.updateView()}),a(n,"ready",function(){o.updateView()}),n),this._super(t,e),this.ui=r.extend({selectDomainMinMax:!1,selectZoomedMinMax:!1},this.ui.getPlainObject())},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.el_domain_labelMin=this.element.select(".vzb-mmi-domainmin-label"),this.el_domain_labelMax=this.element.select(".vzb-mmi-domainmax-label"),this.el_domain_fieldMin=this.element.select(".vzb-mmi-domainmin"),this.el_domain_fieldMax=this.element.select(".vzb-mmi-domainmax"),this.el_break=this.element.select(".vzb-mmi-break"),this.el_zoomed_labelMin=this.element.select(".vzb-mmi-zoomedmin-label"),this.el_zoomed_labelMax=this.element.select(".vzb-mmi-zoomedmax-label"),this.el_zoomed_fieldMin=this.element.select(".vzb-mmi-zoomedmin"),this.el_zoomed_fieldMax=this.element.select(".vzb-mmi-zoomedmax"),t.el_domain_fieldMin.on("change",function(){t._setModel("domainMin",this.value)}),t.el_domain_fieldMax.on("change",function(){t._setModel("domainMax",this.value)}),t.el_zoomed_fieldMin.on("change",function(){t._setModel("zoomedMin",this.value)}),t.el_zoomed_fieldMax.on("change",function(){t._setModel("zoomedMax",this.value)}),this.element.selectAll("input").on("keypress",function(){13==d3.event.which&&document.activeElement.blur()})},updateView:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.el_domain_labelMin.text(this.translator("hints/min")+":"),this.el_domain_labelMax.text(this.translator("hints/max")+":"),this.el_zoomed_labelMin.text(this.translator("hints/min")+":"),this.el_zoomed_labelMax.text(this.translator("hints/max")+":"),this.el_domain_labelMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_labelMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_break.classed("vzb-hidden",!(this.ui.selectDomainMinMax&&this.ui.selectZoomedMinMax)),this.el_zoomed_labelMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_labelMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax);var e=function(e){return e||0===e?r.isDate(e)?t.model.time.formatDate(e):d3.format(".2r")(e):e},i=this.model.marker[this.markerID],n=i.getScale().domain();this.el_domain_fieldMin.property("value",e(d3.min(n))),this.el_domain_fieldMax.property("value",e(d3.max(n))),this.el_zoomed_fieldMin.property("value",e(i.getZoomedMin())),this.el_zoomed_fieldMax.property("value",e(i.getZoomedMax()))},_setModel:function(t,e){this.model.marker[this.markerID][t]=r.strToFloat(e)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),a(i(6));var n=a(i(12)),r=a(i(164)),o=a(i(50));function a(t){return t&&t.__esModule?t:{default:t}}var s=n.default.extend("colors",{init:function(t,e){this.name="colors",this.components=[{component:o.default,placeholder:".vzb-caxis-selector",model:["state.time","state.marker.color","locale"],showHoverValues:!0},{component:r.default,placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","state.marker.color","locale","ui"]}],this._super(t,e)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(12)),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1));function o(t){return t&&t.__esModule?t:{default:t}}var a=o(i(6)).default.extend({init:function(t,e){this.name="gapminder-dialogs",this._curr_dialog_index=20,this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}];var i=n.default.getCollection();this._available_dialogs=Object.keys(i).reduce(function(t,e){var n=i[e];return n.prototype.isDialog&&!e.startsWith("_")&&(t[e]={dialog:n}),t},{}),this._super(t,e)},domReady:function(){var t=(this.model.ui.dialogs||{}).popup||[],e=(this.model.ui.dialogs||{}).sidebar||[];this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),!0===e&&(e=t,(this.model.ui.dialogs||{}).sidebar=e),0!==e.length&&this.rootEl.classed("vzb-dialog-expand-true",!0),this.dialog_popup=t,this.dialog_sidebar=e},readyOnce:function(){var t=this;if(this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),r.isTouchDevice()&&this.element.classed("vzb-no-hover",!0),this._addDialogs(this.dialog_popup,this.dialog_sidebar),r.defer(function(){t.trigger("resize")}),0!==this.dialog_popup.length){this.root.findChildByName("gapminder-buttonlist").on("click",function(e,i){t._available_dialogs[i.id]&&(i.active?t.openDialog(i.id):t.closeDialog(i.id))});var e=this.element.selectAll(".vzb-top-dialog").filter(function(e){return t.dialog_popup.indexOf(e.id)>-1});e.select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']").on("click",function(e,i){t.closeDialog(e.id)}),e.select(".vzb-top-dialog>.vzb-dialog-modal>[data-click='pinDialog']").on("click",function(e,i){t.pinDialog(e.id)}),this.rootEl.node().addEventListener("click",function(){t.closeAllDialogs()}),this.rootEl.on("mousedown",function(e){if(this._active_comp){for(var i=d3.event.target,n=!0;i;){if(i.classList.contains("vzb-dialog-modal")){n=!1;break}i=i.parentElement}n&&t.closeAllDialogs()}})}this.element.on("click",function(){d3.event.stopPropagation()})},resize:function(){if(!this.element.selectAll)return r.warn("dialogs resize() aborted because element is not yet defined");var t=this,e=this.getLayoutProfile();this.element.selectAll(".vzb-top-dialog").each(function(i){var n=d3.select(this),r=n.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"large"===e&&t.dialog_sidebar.indexOf(i.id)>-1?r+=" vzb-sidebar":t.dialog_popup.indexOf(i.id)>-1&&(r+=" vzb-popup"),n.attr("class",r)})},_addDialogs:function(t,e){this.getLayoutProfile();var i=[];i=t?i.concat(t):i,i=e?i.concat(e):i,i=r.unique(i),this._components_config=[];var n=[];if(i.length){for(var o=0;o<i.length;o++){var a=i[o],s=this._available_dialogs[a];if(s&&s.dialog){var l=this._components_config;l.push({component:s.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+a+'"]',model:["state","ui","locale"]}),s.component=l.length-1}s.id=a,n.push(s)}this.element.selectAll("div").data(n).enter().append("div").attr("data-dlg",function(t){return t.id}).attr("class","vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"),this.loadSubComponents();var u=this;r.forEach(this.components,function(t){t.render(),u.on("resize",function(){t.trigger("resize")}),t.on("dragstart",function(){u.bringForward(t.name)}),t.on("close",function(){this.placeholderEl.each(function(t){var e={};e.id=t.id,u.trigger("close",e)})})})}},bringForward:function(t){this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']").style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10},openDialog:function(t){var e="small"===this.getLayoutProfile();this.closeAllDialogs(e);var i=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp.beforeOpen(),i.classed("vzb-active",!0),this.bringForward(t),this._active_comp.open()},pinDialog:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._available_dialogs[t].ispin?(e.classed("pinned",!1),this._available_dialogs[t].ispin=!1):(e.classed("pinned",!0),this._available_dialogs[t].ispin=!0)},closeDialog:function(t){var e=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp&&!this._active_comp.isOpen||(this._available_dialogs[t].ispin&&this.pinDialog(t),this._active_comp&&this._active_comp.beforeClose(),e.classed("vzb-active",!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)},closeAllDialogs:function(t){var e=this,i=t?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)";this.element.selectAll(i).each(function(t){e.closeDialog(t.id)})}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=l(i(12)),o=l(i(112)),a=l(i(59)),s=l(i(50));function l(t){return t&&t.__esModule?t:{default:t}}var u=r.default.extend("find",{init:function(t,e){this.name="find";var i=this;this.components=[{component:o.default,placeholder:".vzb-dialog-panel-show",model:["state","locale"]},{component:a.default,placeholder:".vzb-dialog-bubbleopacity",model:["state.marker","locale"],arg:"opacitySelectDim"}],this.panelMode=((t.ui.dialogs.dialog||{}).find||{}).panelMode||"find",this.enablePicker=((t.ui.dialogs.dialog||{}).find||{}).enablePicker,this.enablePicker&&this.components.push({component:s.default,placeholder:".vzb-find-filter-selector",model:["state.time","state.marker","locale"]}),this.model_binds={"change:state.marker.select":function(t){i.items.order(),i.selectDataPoints(),i.showHideButtons()},"change:state.time.playing":function(t){i.model.state.time.playing||(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t,e){!t||i.time-e||i.redrawDataPoints(t)}))},"change:state.time.value":function(t){(i.placeholderEl.classed("vzb-active")||i.placeholderEl.classed("vzb-sidebar"))&&(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t){t&&i.redrawDataPoints(t)}))},"translate:locale":function(){i._readyOnce&&i.input_search.attr("placeholder",i.translator("placeholder/search")+"...")}},this._super(t,e)},readyOnce:function(){this._super(),this.panelComps={find:this,show:this.findChildByName("show")},this.titleSwitch=this.element.select(".vzb-dialog-title-switch input"),this.panelsEl=this.contentEl.selectAll(".vzb-dialog-content"),this.list=this.element.select(".vzb-find-list"),this.input_search=this.element.select(".vzb-find-search"),this.deselect_all=this.element.select(".vzb-find-deselect"),this.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.element.select(".vzb-find-filter-selector").classed("vzb-hidden",!this.enablePicker),this.element.select(".vzb-dialog-title").classed("vzb-title-two-rows",this.enablePicker),this.KEY=this.model.state.entities.getDimension();var t=this;this.titleSwitch.on("change",function(){t.panelMode=t.titleSwitch.property("checked")?"show":"find",t.panelsEl.classed("vzb-active",!1),t.contentEl.select(".vzb-dialog-panel-"+t.panelMode).classed("vzb-active",!0),t.panelComps[t.panelMode].showHideSearch(),t._buttonAdjust(),t.panelComps[t.panelMode].showHideButtons()}),this.titleSwitch.property("checked","find"!==this.panelMode),this.titleSwitch.dispatch("change"),this.input_search.on("keyup",function(){13==d3.event.keyCode&&"select all"==t.input_search.node().value&&(t.input_search.node().value="",n.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectAll())}),this.input_search.on("input",function(){t.panelComps[t.panelMode].showHideSearch()}),d3.select(this.input_search.node().parentNode).on("reset",function(){n.defer(function(){return t.panelComps[t.panelMode].showHideSearch()})}),this.deselect_all.on("click",function(){t.deselectMarkers()}),this.buttonsEl.select(".vzb-dialog-button[data-click='closeDialog']").on("click.panel",function(){return t.panelComps[t.panelMode].closeClick()}),this.translator=this.model.locale.getTFunction(),this.input_search.attr("placeholder",this.translator("placeholder/search")+"..."),this.root.on("ready",function(){t.ready()})},getPanelMode:function(){return this.panelMode},_buttonAdjust:function(){this.buttonsEl.selectAll(".vzb-dialog-buttons > :not([data-dialogtype])").classed("vzb-hidden",!0),this.buttonsEl.selectAll("[data-panel="+this.panelMode+"]").classed("vzb-hidden",!1)},open:function(){var t=this;this._super(),this.input_search.node().value="",this.showHideSearch(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){e&&t.redrawDataPoints(e)})},ready:function(){this._super();var t=this;this.KEYS=n.unique(this.model.state.marker._getAllDimensions({exceptType:"time"}));this.importantHooks=t.model.state.marker.getImportantHooks(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){if(e){var i=t.model.state.marker.getKeys().map(function(i){return i.brokenData=!1,i.name=t.model.state.marker.getCompoundLabelText(i,e),i});i.sort(function(t,e){return t.name<e.name?-1:1}),t.list.html(""),t.items=t.list.selectAll(".vzb-find-item").data(i).enter().append("div").attr("class","vzb-find-item vzb-dialog-checkbox"),t.items.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",function(e,i){return"-find-"+i+"-"+t._id}).on("change",function(e){n.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectMarker(e),n.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}),t.items.append("label").attr("for",function(e,i){return"-find-"+i+"-"+t._id}).text(function(t){return t.name}).attr("title",function(t){return this.offsetWidth<this.scrollWidth?t.name:null}).on("mouseover",function(e){n.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}).on("mouseout",function(e){n.isTouchDevice()||t.model.state.marker.clearHighlighted()}),n.preventAncestorScrolling(t.element.select(".vzb-dialog-scrollable")),t.redrawDataPoints(e),t.selectDataPoints(),t.showHideSearch(),t.showHideButtons()}})},redrawDataPoints:function(t){var e=this,i=this.KEYS;e.items.each(function(r){var o=d3.select(this).select("label");r.brokenData=!1,n.forEach(e.importantHooks,function(o){if("constant"!=e.model.state.marker[o].use){var a=t[o];if(a){var s=a[n.getKey(r,i)];return s||0===s?void 0:(r.brokenData=!0,!1)}}});var a=this.offsetWidth<this.scrollWidth?r.name:"";o.classed("vzb-find-item-brokendata",r.brokenData).attr("title",a+(r.brokenData?(a?" | ":"")+e.model.state.time.formatDate(e.time)+": "+e.translator("hints/nodata"):""))})},selectDataPoints:function(){this.KEY;var t=this.model.state.marker;this.items.selectAll("input").property("checked",function(e){var i=t.isSelected(e);return d3.select(this.parentNode).classed("vzb-checked",i),i});var e=this.list.selectAll(".vzb-checked").classed("vzb-separator",!1).lower().nodes()[0];d3.select(e).classed("vzb-separator",!0),this.contentEl.node().scrollTop=0},showHideSearch:function(){if("find"===this.getPanelMode()){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-find-item").classed("vzb-hidden",function(e){return-1===(e.name||"").toString().toLowerCase().indexOf(t)})}},showHideButtons:function(){if("find"===this.getPanelMode()){var t=!!this.model.state.marker.select.length;this.deselect_all.classed("vzb-hidden",!t),this.opacity_nonselected.classed("vzb-hidden",!t),t&&this.findChildByName("singlehandleslider").trigger("resize")}},deselectMarkers:function(){this.model.state.marker.clearSelected()},transitionEnd:function(t){this._super(t),n.isTouchDevice()||this.input_search.node().focus()},closeClick:function(){}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),o(i(6));var n=o(i(12)),r=o(i(59));function o(t){return t&&t.__esModule?t:{default:t}}var a=n.default.extend("grouping",{init:function(t,e){this.name="grouping",this.groupStops=[1,5,10,15],this.components=[{component:r.default,placeholder:".vzb-dialog-placeholder",model:["state.entities_age","locale"],arg:"grouping",properties:{snapValue:!0,suppressInput:!0,domain:this.groupStops}}],this._super(t,e)},readyOnce:function(){this._super(),this.element.select(".vzb-dialog-groups").selectAll(".vzb-dialog-groups-title").data(this.groupStops).enter().append("span").attr("class",".vzb-dialog-groups-title").text(function(t){return t})}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),s(i(6));var n=s(i(12)),r=s(i(161)),o=s(i(50)),a=s(i(60));function s(t){return t&&t.__esModule?t:{default:t}}var l=n.default.extend("label",{init:function(t,e){this.name="label",this.components=[{component:r.default,placeholder:".vzb-dialog-sizeslider",model:["state.marker.size_label","locale"],propertyname:"LabelTextSize",ui:{constantUnit:"unit/pixels"}},{component:o.default,placeholder:".vzb-saxis-selector",model:["state.time","state.marker.size_label","locale"],showHoverValues:!0},{component:a.default,placeholder:".vzb-removelabelbox-switch",model:["ui.chart","locale"],checkbox:"removeLabelBox",submodel:"labels"}],this._super(t,e)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=(a(i(6)),a(i(12))),o=a(i(163));function a(t){return t&&t.__esModule?t:{default:t}}var s=r.default.extend("moreoptions",{init:function(t,e){this.name="moreoptions",this.components=[{component:o.default,placeholder:".vzb-dialog-options-buttonlist",model:["state","ui","locale"]}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.accordionEl=this.contentEl.select(".vzb-accordion"),this.on("dragend",function(){t._setMaxHeight()});var e=(this.model.ui.dialogs||{}).popup||[],i=(this.model.ui.dialogs||{}).moreoptions||[];(!0===i&&(i=e,(this.model.ui.dialogs||{}).moreoptions=i),this._addDialogs(i),this.accordionEl)&&this.accordionEl.selectAll(".vzb-accordion-section").select(".vzb-dialog-title>span:first-child").on("click",function(e){t.components[e.component].element;var i=t.components[e.component].placeholderEl,n=t.accordionEl.select(".vzb-accordion-active");n&&n.classed("vzb-accordion-active",!1),i.node()!==n.node()&&(i.classed("vzb-accordion-active",!0),t.transitionEvents.forEach(function(n){i.on(n,function(){t.transitionEvents.forEach(function(t){i.on(t,null)}),t.components[e.component].trigger("resize")})}))})},_addDialogs:function(t){this._components_config=[];var e=[];if(t.length){for(var i=0;i<t.length;i++)if("moreoptions"!==t[i]){var r=t[i],o=n.deepClone(this.parent._available_dialogs[r]);if(o&&o.dialog){var a=this._components_config;a.push({component:o.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+r+'"]',model:["state","ui","locale"]}),o.component=a.length-1,o.id=r,e.push(o)}}this.accordionEl.selectAll("div").data(e).enter().append("div").attr("class",function(t){return"vzb-dialogs-dialog vzb-moreoptions vzb-accordion-section"}).attr("data-dlg",function(t){return t.id}),this.loadSubComponents();var s=this;n.forEach(this.components,function(t){t.render(),s.on("resize",function(){t.trigger("resize")})})}}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),o(i(6));var n=o(i(12)),r=o(i(59));function o(t){return t&&t.__esModule?t:{default:t}}var a=n.default.extend("opacity",{init:function(t,e){this.name="opacity",this.components=[{component:r.default,placeholder:".vzb-dialog-bubbleopacity-regular",model:["state.marker","locale"],arg:"opacityRegular"},{component:r.default,placeholder:".vzb-dialog-bubbleopacity-selectdim",model:["state.marker","locale"],arg:"opacitySelectDim"}],this._super(t,e)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),o(i(6));var n=o(i(12)),r=o(i(60));function o(t){return t&&t.__esModule?t:{default:t}}var a=n.default.extend("presentation",{init:function(t,e){this.name="presentation",this.components=[{component:r.default,placeholder:".vzb-presentationmode-switch",model:["ui","locale"],checkbox:"presentation"},{component:r.default,placeholder:".vzb-decorations-switch",model:["ui.chart.decorations","locale"],checkbox:"enabled"}],this._super(t,e)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=(a(i(6)),a(i(12))),o=a(i(50));a(i(60));function a(t){return t&&t.__esModule?t:{default:t}}var s=r.default.extend("side",{init:function(t,e){this.name="side";var i=this;this.model_binds={"change:ui.chart.flipSides":function(t){i._readyOnce&&(i.updateState(),i.redraw())}},this.components=[{component:o.default,placeholder:".vzb-side-selector",model:["state.time","state.marker.side","locale"],showHoverValues:!1}],this._super(t,e)},readyOnce:function(){this._super(),this.listLeft=this.element.select(".vzb-side-list-left"),this.listRight=this.element.select(".vzb-side-list-right"),this.switchSides=this.element.select(".vzb-side-switch-sides"),this.TIMEDIM=this.model.state.time.getDimension(),this.state={};var t=this;this.switchSides.on("click",function(){t.model.ui.chart.flipSides=!t.model.ui.chart.flipSides}),this.model.state.marker.side.getEntity().on("change:show",function(){t.updateState(),t.redraw()}),this.root.on("ready",function(){t.redraw()})},ready:function(){this._super();var t=this.model.state.marker.side.getEntity();if(this.KEY=t.getDimension(),this.labelNames=this.model.state.marker.getLabelHookNames(),"constant"!==this.model.state.marker.side.use&&!(t.show[this.KEY]||{}).$in){var e=this.model.state.marker.side.getUnique(this.model.state.marker.side.which).filter(function(t){return null!==t}).sort(d3.ascending).slice(0,2);if(e.length>0){var i=Object.assign({},t.show);i[this.KEY]={$in:e},t.set("show",i)}}this.updateState(),this.redraw(),n.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},updateState:function(){var t=this,e=this.model.state.marker.side.getEntity().getDimension(),i=this.model.state.marker.side;if(this.state.right={},this.state.left={},i.state.left[e]&&i.state.right[e])this.state.left[e]=i.state.left[e],this.state.right[e]=i.state.right[e];else{var n=this.model.state.marker.getKeys(e),r=[],o=!!this.model.state.marker.side.getEntity().show[e];if((r=n.filter(function(e){return!o||t.model.state.marker.side.getEntity().isShown(e)}).map(function(t){return t[e]})).length>2&&(r.length=2),r.length>1){var a=this.ui.chart.flipSides?d3.ascending:d3.descending;r.sort(a)}this.state.right={},this.state.right[e]=r[0],this.state.left={},this.state.left[e]=r[1]?r[1]:r[0]}var s="constant"==this.model.state.marker.side.use;this.listLeft.classed("vzb-hidden",s),this.listRight.classed("vzb-hidden",s),this.switchSides.classed("vzb-hidden",s||this.state.left[e]==this.state.right[e])},redraw:function(){var t=this,e=this.labelNames,i=this.KEY;this.translator=this.model.locale.getTFunction(),t.model.state.marker.side.getEntity().dim&&this.model.state.marker.getFrame(this.model.state.time.value,function(r){if(r){var o=[],a=t.model.state.marker.side.getConceptprops();"entity_set"==a.concept_type?o.push.apply(o,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(t.model.state.marker.side.getEntity().getEntitySets("data")[a.concept][0].map(function(t){var e={};return e[i]=t[a.concept],e.label=t.name,e}))):n.forEach(r[e[i]],function(t,e){var n={};n[i]=e,n.label=t,o.push(n)}),o.sort(function(t,e){return t.label<e.label?-1:1}),t.listLeft.html(""),t.listRight.html(""),t.createList(t.listLeft,"left",o),t.createList(t.listRight,"right",o)}})},createList:function(t,e,i){var n=this,r=this.model.state.marker.side.getEntity().getDimension(),o=t.selectAll(".vzb-side-item").data(i).enter().append("div").attr("class","vzb-side-item vzb-dialog-radio");o.append("input").attr("type","radio").attr("name",e+"-"+n._id).attr("class","vzb-side-item").attr("id",function(t){return"-side-"+e+"-"+t[r]+"-"+n._id}).property("checked",function(t){return n.state[e][r]===t[r]}).on("change",function(t,i){var r=n.model.state.marker.side.getEntity(),o=r.getDimension(),a="left"==e?"right":"left",s=n.model.state.marker.side;s.state[e][o]=t[o],s.state[a][o]=n.state[a][o];var l=[];if(r.isShown(t)||l.push(t),t[o]===n.state[a][o]||r.isShown(n.state[a])||l.push(n.state[a]),n.state[e][o]!==n.state[a][o]&&r.isShown(n.state[e])&&l.push(n.state[e]),t[o]!==n.state[a][o]){var u=[t[o],n.state[a][o]],c=n.ui.chart.flipSides?d3.ascending:d3.descending;u.sort(c),u["left"==e?0:1]==t[o]&&(n.model.state.marker.side.switchSideState(),n.ui.chart.flipSides=!n.ui.chart.flipSides)}l.length&&r.showEntity(l)}),o.append("label").attr("for",function(t){return"-side-"+e+"-"+t[n.KEY]+"-"+n._id}).text(function(t){return t.label})}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=(s(i(6)),s(i(12))),o=s(i(160)),a=s(i(50));function s(t){return t&&t.__esModule?t:{default:t}}var l=r.default.extend("size",{init:function(t,e){this.name="size";var i=this;this.model_binds={"change:state.marker.size.which":function(t){i._readyOnce&&i.updateSubtitle()},"translate:locale":function(){i._readyOnce&&i.updateSubtitle()}},this.components=[{component:a.default,placeholder:".vzb-saxis-selector",model:["state.time","state.marker.size","locale"],showHoverValues:!0}],t.ui.chart&&0===t.ui.chart.sizeSelectorActive||this.components.push({component:o.default,placeholder:".vzb-dialog-bubblesize",model:["state.marker.size","locale"],ui:{show_button:!1}}),this._super(t,e)},readyOnce:function(){this._super(),this.updateSubtitle()},updateSubtitle:function(){var t=this.model.state.marker.size.getConceptprops(),e=n.getSubtitle(t.name,t.name_short);this.element.select(".vzb-dialog-subtitle").text(e)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),o(i(6));var n=o(i(12)),r=o(i(59));function o(t){return t&&t.__esModule?t:{default:t}}var a=n.default.extend("speed",{init:function(t,e){this.name="speed",this.components=[{component:r.default,placeholder:".vzb-dialog-placeholder",model:["state.time","locale"],arg:"delay",properties:{domain:[1200,900,450,200,150,100],roundDigits:0}}],this._super(t,e)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),o(i(6));var n=o(i(12)),r=o(i(182));function o(t){return t&&t.__esModule?t:{default:t}}var a=n.default.extend("stack",{init:function(t,e){this.name="stack";var i=this;this.components=[{component:r.default,placeholder:".vzb-dialog-draggablelist",model:["state.marker.group","state.marker.color","locale","ui.chart"],groupID:"manualSorting",isEnabled:"manualSortingEnabled",dataArrFn:i.manualSorting.bind(i),lang:""}],this.model_binds={"change:state.marker.group":function(t){i._ready&&i.updateView()}},this._super(t,e)},readyOnce:function(){this._super();var t=this;this.group=this.model.state.marker.group,this.stack=this.model.state.marker.stack,this.howToStackEl=this.element.select(".vzb-howtostack").selectAll("input").on("change",function(){t.setModel("stack",d3.select(this).node().value)}),this.howToMergeEl=this.element.select(".vzb-howtomerge").selectAll("input").on("change",function(){t.setModel("merge",d3.select(this).node().value)}),this.updateView()},ready:function(){if(this._super(),!this.model.state.marker.color.isDiscrete()){if("property"==this.stack.use)return void this.setModel("stack","none");if(this.group.merge)return void this.setModel("merge","none")}this.updateView()},updateView:function(){var t=this;this.howToStackEl.property("checked",function(){return"none"===d3.select(this).node().value?"none"===t.stack.which:"bycolor"===d3.select(this).node().value?t.stack.which===t.model.state.marker.color.which:"all"===d3.select(this).node().value?"all"===t.stack.which:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"all"===d3.select(this).node().value?null:"bycolor"===d3.select(this).node().value?"property"!==t.model.state.marker.color.use||null:void 0}),t.model.ui.chart.manualSortingEnabled="all"==t.stack.which,this.howToMergeEl.property("checked",function(){return"none"===d3.select(this).node().value?!t.group.merge&&!t.stack.merge:"grouped"===d3.select(this).node().value?t.group.merge:"stacked"===d3.select(this).node().value?t.stack.merge:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"grouped"===d3.select(this).node().value?"none"===t.stack.which||"property"!==t.model.state.marker.color.use||null:"stacked"===d3.select(this).node().value?"all"!==t.stack.which||null:void 0})},manualSorting:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===arguments.length)return this.model.state.marker.group.manualSorting;this.model.state.marker.group.set({manualSorting:t},!1,e)},setModel:function(t,e){var i={stack:{},group:{}};if("merge"===t)switch(e){case"none":i.group.merge=!1,i.stack.merge=!1;break;case"grouped":i.group.merge=!0,i.stack.merge=!1;break;case"stacked":i.group.merge=!1,i.stack.merge=!0}if("stack"===t){switch(e){case"all":i.stack.use="constant",i.stack.which="all";break;case"none":i.stack.use="constant",i.stack.which="none";break;case"bycolor":i.stack.use="property",i.stack.which=this.model.state.marker.color.which,i.stack.spaceRef=this.model.state.marker.color.spaceRef}"none"===e&&this.group.merge&&(i.group.merge=!1),"all"!==e&&this.stack.merge&&(i.stack.merge=!1)}this.model.state.marker.set(i)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(6);var a=((n=o)&&n.__esModule?n:{default:n}).default.extend({init:function(t,e){this.template='<span class="vzb-dl-holder"><ul class="vzb-draggable list vzb-dialog-scrollable"></ul></span>';var i=this;this.name="draggableList",this.dataArrFn=t.dataArrFn,this.lang=t.lang,this.model_expects=[{name:"group",type:"model"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"chart",type:"model"}],this.groupID=t.groupID,this.isEnabled=t.isEnabled,this.draggable=!0,t.groupID||r.warn("draggablelist.js complains on 'groupID' property: "+t.groupID),this.model_binds={"translate:locale":function(t){i.updateView()},"change:group.which":function(t){i.updateView()}},this.model_binds["change:group."+this.groupID]=function(t){i.updateView()},this.model_binds["change:chart."+this.isEnabled]=function(t){i.draggable=i.model.chart[i.isEnabled],i.updateView()},this._super(t,e),this.updateData=r.debounce(this.updateData,1e3),this.itemDragger=d3.drag().on("start",function(t,e){!i.dataUpdateFlag&&i.draggable&&(d3.event.sourceEvent.stopPropagation(),i.parentBoundRect=i.element.node().getBoundingClientRect(),i.element.selectAll("div").each(function(e,n){var r=this.getBoundingClientRect();e._y=r.top,e._top=0,t.data===e.data&&(e._height=r.height,i.selectedNode=this)}),d3.select(i.selectedNode).classed("dragged",!0))}).on("drag",function(t,e){if(!i.dataUpdateFlag&&i.draggable){t._top+=d3.event.dy;var n=t._y+t._top;n>i.parentBoundRect.top&&n+t._height<i.parentBoundRect.top+i.parentBoundRect.height&&i.itemsEl.style("top",function(i,r){var o=0;return r<e&&i._y+.5*t._height>n?o=t._height:r>e&&i._y-.5*t._height<n&&(o=-t._height),r!=e&&(i._top=o),i._top+"px"})}}).on("end",function(t,e){!i.dataUpdateFlag&&i.draggable&&i.getData()})},ready:function(){this.updateView(),this.itemsEl=this.element.selectAll("div"),this.itemsEl.call(this.itemDragger);this.itemsEl.select("li").on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1)}).on("touchstart",function(){d3.event.preventDefault()})},updateView:function(){var t=this,e=t.model.color.getColorlegendMarker().label.getItems(),i=r.keys(e),n=i.slice().sort(),o=(this.dataArrFn()||[]).slice().sort();!1===r.arrayEquals(n,o)&&this.dataArrFn(i),this.items=this.element.selectAll("div").data(function(){return(t.dataArrFn()||[]).map(function(t){return{data:t}})}),this.items.exit().remove(),this.items=this.items.enter().append("div").each(function(){var t=d3.select(this).append("li");t.append("span").classed("label-circle",!0),t.append("span").classed("label-text",!0)}).merge(this.items);var a=this.model.color.getScale();this.items.select("li").each(function(t){var i=t.data,n=d3.select(this);n.classed("hover",!1).attr("data",i),n.select(".label-circle").style("background",a(i)),n.select(".label-text").text(e[i])});var s=!!t.draggable||null;this.element.selectAll("div").style("top","").attr("draggable",s).classed("dragged",!1),this.dataUpdateFlag=!1},getData:function(){var t;t=this.element.selectAll("div").data().sort(function(t,e){return t._y+t._top-(e._y+e._top)}).map(function(t){return t.data}),r.arrayEquals(this.dataArrFn(),t)?this.updateView():(this.dataUpdateFlag=!0,this.updateData(t,!0))},updateData:function(t,e){this.dataArrFn(t,e)},readyOnce:function(){this.element=d3.select(this.element).select(".list")}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(i(12)),r=o(i(184));function o(t){return t&&t.__esModule?t:{default:t}}var a=n.default.extend("timedisplay",{init:function(t,e){var i=this;this.name="timedisplay",this.model_binds={"change:state.time.value":function(){i.updateTime()}},this._super(t,e)},ready:function(){this.updateTime()},readyOnce:function(){this._super(),this.timeLabel=new r.default(this.element.select(".vzb-timedisplay")),this.timeLabel.setConditions({widthRatio:1,heightRatio:1}),this.resize()},resize:function(){this.timeLabel&&this.timeLabel.resize(this.contentEl.style("width"),this.contentEl.style("height"))},updateTime:function(){var t=this.model.state.time;this.time_1=null==this.time?t.value:this.time,this.time=t.value;var e=t.playing&&this.time-this.time_1>0?t.delayAnimations:0;this.timeLabel.setText(t.formatDate(this.time,"ui"),e)}});e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(31),o=(n=r)&&n.__esModule?n:{default:n};e.default=o.default.extend({init:function(t,e){this.context=t,this.context.classed("vzb-dynamic-background",!0),this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.textWidth=0,this.textHeight=0,this.widthRatio=.9,this.heightRatio=.9,this.xAlign="center",this.yAlign="center",this.element=this.context.append("text").style("font-size","20px"),this._sample=this.context.append("text").style("font-size","20px").style("opacity",0),e&&this.setConditions(e)},setConditions:function(t){return!isNaN(parseFloat(t.rightOffset))&&isFinite(t.rightOffset)&&(this.rightOffset=t.rightOffset),!isNaN(parseFloat(t.leftOffset))&&isFinite(t.leftOffset)&&(this.leftOffset=t.leftOffset),!isNaN(parseFloat(t.topOffset))&&isFinite(t.topOffset)&&(this.topOffset=t.topOffset),!isNaN(parseFloat(t.bottomOffset))&&isFinite(t.bottomOffset)&&(this.bottomOffset=t.bottomOffset),t.xAlign&&(this.xAlign=t.xAlign),t.yAlign&&(this.yAlign=t.yAlign),!isNaN(parseFloat(t.widthRatio))&&t.widthRatio>0&&t.widthRatio<=1&&(this.widthRatio=t.widthRatio),!isNaN(parseFloat(t.heightRatio))&&t.heightRatio>0&&t.heightRatio<=1&&(this.heightRatio=t.heightRatio),this},resize:function(t,e,i,n){this.width=parseInt(t,10)||0,this.height=parseInt(e,10)||0,i&&(this.topOffset=i),n&&(this.leftOffset=n),this._resizeText()},setText:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=function(){e._sample.text(t),e._resizeText(),e.element.text(t)},r=function(){clearTimeout(e._text.timeout),delete e._text};return i?(this._text&&(this._text.callback(),r()),this._text={callback:n,timeout:setTimeout(function(){n(),r()},i)}):(this._text&&r(),n()),this},_resizeText:function(){var t=this._sample.node().getBBox();if(!(t.width&&t.height&&this.width&&this.height))return this;var e=this.width*this.widthRatio/t.width,i=this.height*this.heightRatio/t.height;switch(this.scalar=Math.min(e,i),this.element.attr("transform","scale("+this.scalar+")"),this.textHeight=t.height*this.scalar,this.textWidth=t.width*this.scalar,this.yAlign){case"bottom":case"center":this.context.select("text").attr("dy",".325em");break;case"top":this.context.select("text").attr("dy","0")}return this.context.attr("transform","translate("+this._getLeftOffset()+","+this._getTopOffset()+")"),this},_getLeftOffset:function(){switch(this.xAlign){case"right":return this.width-this.textWidth/2-this.rightOffset;case"left":return this.textWidth/2+this.leftOffset;default:return this.width/2}},_getTopOffset:function(){switch(this.yAlign){case"top":return this.textHeight/2+this.topOffset;case"bottom":return this.height-this.textHeight/2-this.bottomOffset;default:return this.height/2}}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});(function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t})(i(1)),a(i(6));var n=a(i(12)),r=a(i(186)),o=a(i(60));function a(t){return t&&t.__esModule?t:{default:t}}var s=n.default.extend("zoom",{init:function(t,e){this.name="zoom",this.components=[{component:r.default,placeholder:".vzb-dialog-zoom-buttonlist",model:["state","ui","locale"]},{component:o.default,placeholder:".vzb-panwitharrow-switch",model:["ui","locale"],checkbox:"panWithArrow"},{component:o.default,placeholder:".vzb-zoomonscrolling-switch",model:["ui","locale"],checkbox:"zoomOnScrolling"},{component:o.default,placeholder:".vzb-adaptminmaxzoom-switch",model:["ui","locale"],checkbox:"adaptMinMaxZoom"}],this._super(t,e)}});e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=l(i(1)),o=i(6),a=(n=o)&&n.__esModule?n:{default:n},s=l(i(21));function l(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var u=a.default.extend({init:function(t,e){var i=this;this.name="gapminder-zoombuttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hand:{title:"buttons/cursorhand",icon:"cursorHand",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}},this.model_binds={},Object.keys(this._available_buttons).forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e)},readyOnce:function(){this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addButtons(Object.keys(this._available_buttons),[]),this.setCursorMode("arrow")},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var o=0;o<t.length;o++){var a=t[o],l=this._available_buttons[a]?a:"_default",u=r.clone(this._available_buttons[l]);u.id=a,u.icon=s[u.icon],n.push(u)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"}),this.element.selectAll(".vzb-buttonlist-btn").on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},proceedClick:function(t){var e=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),i=e.attr("class"),n=this._available_buttons[t];if(n&&n.func)n.func(t);else{var r=-1===i.indexOf("vzb-active");e.classed("vzb-active",r);var o={};o.id=t,o.active=r,this.trigger("click",o)}},setButtonActive:function(t,e){this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").classed("vzb-active",e)},toggleCursorMode:function(t){var e=t;this.model.ui.set("cursorMode",e,!1,!1)},setCursorMode:function(t){var e=this.model.ui.cursorMode?this.model.ui.cursorMode:"arrow";this.element.selectAll(".vzb-buttonlist-btn").classed("vzb-active",function(t){return t.id==e})},toggleHundredPercent:function(t){this.root.trigger("resetZoom")}});e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(188);var n,r=i(390),o=(n=r)&&n.__esModule?n:{default:n};i(436),e.default=o.default,t.exports=o.default},function(t,e,i){"use strict";(function(t){if(i(189),i(386),i(387),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";function n(t,i,n){t[i]||Object[e](t,i,{writable:!0,configurable:!0,value:n})}n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(e,i(78))},function(t,e,i){i(190),i(192),i(193),i(194),i(195),i(196),i(197),i(198),i(199),i(200),i(201),i(202),i(203),i(204),i(205),i(206),i(208),i(209),i(210),i(211),i(212),i(213),i(214),i(215),i(216),i(217),i(218),i(219),i(220),i(221),i(222),i(223),i(224),i(225),i(226),i(227),i(228),i(229),i(230),i(231),i(232),i(233),i(234),i(235),i(236),i(237),i(238),i(239),i(240),i(241),i(242),i(243),i(244),i(245),i(246),i(247),i(248),i(249),i(250),i(251),i(252),i(253),i(254),i(255),i(256),i(257),i(258),i(259),i(260),i(261),i(262),i(263),i(264),i(265),i(266),i(267),i(268),i(270),i(271),i(273),i(274),i(275),i(276),i(277),i(278),i(279),i(281),i(282),i(283),i(284),i(285),i(286),i(287),i(288),i(289),i(290),i(291),i(292),i(293),i(100),i(294),i(295),i(131),i(296),i(297),i(298),i(299),i(300),i(134),i(136),i(137),i(301),i(302),i(303),i(304),i(305),i(306),i(307),i(308),i(309),i(310),i(311),i(312),i(313),i(314),i(315),i(316),i(317),i(318),i(319),i(320),i(321),i(322),i(323),i(324),i(325),i(326),i(327),i(328),i(329),i(330),i(331),i(332),i(333),i(334),i(335),i(336),i(337),i(338),i(339),i(340),i(341),i(342),i(343),i(344),i(345),i(346),i(347),i(348),i(349),i(350),i(351),i(352),i(353),i(354),i(355),i(356),i(357),i(358),i(359),i(360),i(361),i(362),i(363),i(364),i(365),i(366),i(367),i(368),i(369),i(370),i(371),i(372),i(373),i(374),i(375),i(376),i(377),i(378),i(379),i(380),i(381),i(382),i(383),i(384),i(385),t.exports=i(25)},function(t,e,i){"use strict";var n=i(3),r=i(17),o=i(8),a=i(0),s=i(15),l=i(35).KEY,u=i(4),c=i(61),h=i(51),d=i(38),f=i(7),p=i(114),m=i(80),v=i(191),g=i(64),y=i(2),_=i(5),b=i(18),x=i(26),w=i(37),S=i(42),M=i(117),E=i(19),z=i(9),k=i(40),T=E.f,O=z.f,C=M.f,P=n.Symbol,A=n.JSON,I=A&&A.stringify,L=f("_hidden"),D=f("toPrimitive"),R={}.propertyIsEnumerable,j=c("symbol-registry"),F=c("symbols"),B=c("op-symbols"),N=Object.prototype,q="function"==typeof P,V=n.QObject,H=!V||!V.prototype||!V.prototype.findChild,U=o&&u(function(){return 7!=S(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=T(N,e);n&&delete N[e],O(t,e,i),n&&t!==N&&O(N,e,n)}:O,W=function(t){var e=F[t]=S(P.prototype);return e._k=t,e},K=q&&"symbol"==typeof P.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof P},G=function(t,e,i){return t===N&&G(B,e,i),y(t),e=x(e,!0),y(i),r(F,e)?(i.enumerable?(r(t,L)&&t[L][e]&&(t[L][e]=!1),i=S(i,{enumerable:w(0,!1)})):(r(t,L)||O(t,L,w(1,{})),t[L][e]=!0),U(t,e,i)):O(t,e,i)},X=function(t,e){y(t);for(var i,n=v(e=b(e)),r=0,o=n.length;o>r;)G(t,i=n[r++],e[i]);return t},Y=function(t){var e=R.call(this,t=x(t,!0));return!(this===N&&r(F,t)&&!r(B,t))&&(!(e||!r(this,t)||!r(F,t)||r(this,L)&&this[L][t])||e)},Z=function(t,e){if(t=b(t),e=x(e,!0),t!==N||!r(F,e)||r(B,e)){var i=T(t,e);return!i||!r(F,e)||r(t,L)&&t[L][e]||(i.enumerable=!0),i}},$=function(t){for(var e,i=C(b(t)),n=[],o=0;i.length>o;)r(F,e=i[o++])||e==L||e==l||n.push(e);return n},Q=function(t){for(var e,i=t===N,n=C(i?B:b(t)),o=[],a=0;n.length>a;)!r(F,e=n[a++])||i&&!r(N,e)||o.push(F[e]);return o};q||(s((P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),e=function(i){this===N&&e.call(B,i),r(this,L)&&r(this[L],t)&&(this[L][t]=!1),U(this,t,w(1,i))};return o&&H&&U(N,t,{configurable:!0,set:e}),W(t)}).prototype,"toString",function(){return this._k}),E.f=Z,z.f=G,i(43).f=M.f=$,i(57).f=Y,i(63).f=Q,o&&!i(39)&&s(N,"propertyIsEnumerable",Y,!0),p.f=function(t){return W(f(t))}),a(a.G+a.W+a.F*!q,{Symbol:P});for(var J="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),tt=0;J.length>tt;)f(J[tt++]);for(var et=k(f.store),it=0;et.length>it;)m(et[it++]);a(a.S+a.F*!q,"Symbol",{for:function(t){return r(j,t+="")?j[t]:j[t]=P(t)},keyFor:function(t){if(!K(t))throw TypeError(t+" is not a symbol!");for(var e in j)if(j[e]===t)return e},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!q,"Object",{create:function(t,e){return void 0===e?S(t):X(S(t),e)},defineProperty:G,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:$,getOwnPropertySymbols:Q}),A&&a(a.S+a.F*(!q||u(function(){var t=P();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){for(var e,i,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);if(i=e=n[1],(_(e)||void 0!==t)&&!K(t))return g(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!K(e))return e}),n[1]=e,I.apply(A,n)}}),P.prototype[D]||i(14)(P.prototype,D,P.prototype.valueOf),h(P,"Symbol"),h(Math,"Math",!0),h(n.JSON,"JSON",!0)},function(t,e,i){var n=i(40),r=i(63),o=i(57);t.exports=function(t){var e=n(t),i=r.f;if(i)for(var a,s=i(t),l=o.f,u=0;s.length>u;)l.call(t,a=s[u++])&&e.push(a);return e}},function(t,e,i){var n=i(0);n(n.S,"Object",{create:i(42)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperty:i(9).f})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperties:i(116)})},function(t,e,i){var n=i(18),r=i(19).f;i(29)("getOwnPropertyDescriptor",function(){return function(t,e){return r(n(t),e)}})},function(t,e,i){var n=i(11),r=i(20);i(29)("getPrototypeOf",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(11),r=i(40);i(29)("keys",function(){return function(t){return r(n(t))}})},function(t,e,i){i(29)("getOwnPropertyNames",function(){return i(117).f})},function(t,e,i){var n=i(5),r=i(35).onFreeze;i(29)("freeze",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(5),r=i(35).onFreeze;i(29)("seal",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(5),r=i(35).onFreeze;i(29)("preventExtensions",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(5);i(29)("isFrozen",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(5);i(29)("isSealed",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(5);i(29)("isExtensible",function(t){return function(e){return!!n(e)&&(!t||t(e))}})},function(t,e,i){var n=i(0);n(n.S+n.F,"Object",{assign:i(118)})},function(t,e,i){var n=i(0);n(n.S,"Object",{is:i(207)})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,i){var n=i(0);n(n.S,"Object",{setPrototypeOf:i(84).set})},function(t,e,i){"use strict";var n=i(58),r={};r[i(7)("toStringTag")]="z",r+""!="[object z]"&&i(15)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(t,e,i){var n=i(0);n(n.P,"Function",{bind:i(119)})},function(t,e,i){var n=i(9).f,r=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in r||i(8)&&n(r,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,e,i){"use strict";var n=i(5),r=i(20),o=i(7)("hasInstance"),a=Function.prototype;o in a||i(9).f(a,o,{value:function(t){if("function"!=typeof this||!n(t))return!1;if(!n(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,i){var n=i(0),r=i(121);n(n.G+n.F*(parseInt!=r),{parseInt:r})},function(t,e,i){var n=i(0),r=i(122);n(n.G+n.F*(parseFloat!=r),{parseFloat:r})},function(t,e,i){"use strict";var n=i(3),r=i(17),o=i(23),a=i(86),s=i(26),l=i(4),u=i(43).f,c=i(19).f,h=i(9).f,d=i(52).trim,f=n.Number,p=f,m=f.prototype,v="Number"==o(i(42)(m)),g="trim"in String.prototype,y=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){var i,n,r,o=(e=g?e.trim():d(e,3)).charCodeAt(0);if(43===o||45===o){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var a,l=e.slice(2),u=0,c=l.length;u<c;u++)if((a=l.charCodeAt(u))<48||a>r)return NaN;return parseInt(l,n)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof f&&(v?l(function(){m.valueOf.call(i)}):"Number"!=o(i))?a(new p(y(e)),i,f):y(e)};for(var _,b=i(8)?u(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;b.length>x;x++)r(p,_=b[x])&&!r(f,_)&&h(f,_,c(p,_));f.prototype=m,m.constructor=f,i(15)(n,"Number",f)}},function(t,e,i){"use strict";var n=i(0),r=i(28),o=i(123),a=i(87),s=1..toFixed,l=Math.floor,u=[0,0,0,0,0,0],c="Number.toFixed: incorrect invocation!",h=function(t,e){for(var i=-1,n=e;++i<6;)n+=t*u[i],u[i]=n%1e7,n=l(n/1e7)},d=function(t){for(var e=6,i=0;--e>=0;)i+=u[e],u[e]=l(i/t),i=i%t*1e7},f=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==u[t]){var i=String(u[t]);e=""===e?i:e+a.call("0",7-i.length)+i}return e},p=function(t,e,i){return 0===e?i:e%2==1?p(t,e-1,i*t):p(t*t,e/2,i)};n(n.P+n.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(4)(function(){s.call({})})),"Number",{toFixed:function(t){var e,i,n,s,l=o(this,c),u=r(t),m="",v="0";if(u<0||u>20)throw RangeError(c);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(m="-",l=-l),l>1e-21)if(i=(e=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e}(l*p(2,69,1))-69)<0?l*p(2,-e,1):l/p(2,e,1),i*=4503599627370496,(e=52-e)>0){for(h(0,i),n=u;n>=7;)h(1e7,0),n-=7;for(h(p(10,n,1),0),n=e-1;n>=23;)d(1<<23),n-=23;d(1<<n),h(1,1),d(2),v=f()}else h(0,i),h(1<<-e,0),v=f()+a.call("0",u);return v=u>0?m+((s=v.length)<=u?"0."+a.call("0",u-s)+v:v.slice(0,s-u)+"."+v.slice(s-u)):m+v}})},function(t,e,i){"use strict";var n=i(0),r=i(4),o=i(123),a=1..toPrecision;n(n.P+n.F*(r(function(){return"1"!==a.call(1,void 0)})||!r(function(){a.call({})})),"Number",{toPrecision:function(t){var e=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?a.call(e):a.call(e,t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,i){var n=i(0),r=i(3).isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{isInteger:i(124)})},function(t,e,i){var n=i(0);n(n.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,i){var n=i(0),r=i(124),o=Math.abs;n(n.S,"Number",{isSafeInteger:function(t){return r(t)&&o(t)<=9007199254740991}})},function(t,e,i){var n=i(0);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,i){var n=i(0);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,i){var n=i(0),r=i(122);n(n.S+n.F*(Number.parseFloat!=r),"Number",{parseFloat:r})},function(t,e,i){var n=i(0),r=i(121);n(n.S+n.F*(Number.parseInt!=r),"Number",{parseInt:r})},function(t,e,i){var n=i(0),r=i(125),o=Math.sqrt,a=Math.acosh;n(n.S+n.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:r(t-1+o(t-1)*o(t+1))}})},function(t,e,i){var n=i(0),r=Math.asinh;n(n.S+n.F*!(r&&1/r(0)>0),"Math",{asinh:function t(e){return isFinite(e=+e)&&0!=e?e<0?-t(-e):Math.log(e+Math.sqrt(e*e+1)):e}})},function(t,e,i){var n=i(0),r=Math.atanh;n(n.S+n.F*!(r&&1/r(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,i){var n=i(0),r=i(88);n(n.S,"Math",{cbrt:function(t){return r(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,i){var n=i(0),r=Math.exp;n(n.S,"Math",{cosh:function(t){return(r(t=+t)+r(-t))/2}})},function(t,e,i){var n=i(0),r=i(89);n(n.S+n.F*(r!=Math.expm1),"Math",{expm1:r})},function(t,e,i){var n=i(0);n(n.S,"Math",{fround:i(126)})},function(t,e,i){var n=i(0),r=Math.abs;n(n.S,"Math",{hypot:function(t,e){for(var i,n,o=0,a=0,s=arguments.length,l=0;a<s;)l<(i=r(arguments[a++]))?(o=o*(n=l/i)*n+1,l=i):o+=i>0?(n=i/l)*n:i;return l===1/0?1/0:l*Math.sqrt(o)}})},function(t,e,i){var n=i(0),r=Math.imul;n(n.S+n.F*i(4)(function(){return-5!=r(4294967295,5)||2!=r.length}),"Math",{imul:function(t,e){var i=+t,n=+e,r=65535&i,o=65535&n;return 0|r*o+((65535&i>>>16)*o+r*(65535&n>>>16)<<16>>>0)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log1p:i(125)})},function(t,e,i){var n=i(0);n(n.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,i){var n=i(0);n(n.S,"Math",{sign:i(88)})},function(t,e,i){var n=i(0),r=i(89),o=Math.exp;n(n.S+n.F*i(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(r(t)-r(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,e,i){var n=i(0),r=i(89),o=Math.exp;n(n.S,"Math",{tanh:function(t){var e=r(t=+t),i=r(-t);return e==1/0?1:i==1/0?-1:(e-i)/(o(t)+o(-t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,e,i){var n=i(0),r=i(41),o=String.fromCharCode,a=String.fromCodePoint;n(n.S+n.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(t){for(var e,i=[],n=arguments.length,a=0;n>a;){if(e=+arguments[a++],r(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?o(e):o(55296+((e-=65536)>>10),e%1024+56320))}return i.join("")}})},function(t,e,i){var n=i(0),r=i(18),o=i(10);n(n.S,"String",{raw:function(t){for(var e=r(t.raw),i=o(e.length),n=arguments.length,a=[],s=0;i>s;)a.push(String(e[s++])),s<n&&a.push(String(arguments[s]));return a.join("")}})},function(t,e,i){"use strict";i(52)("trim",function(t){return function(){return t(this,3)}})},function(t,e,i){"use strict";var n=i(90)(!0);i(91)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){"use strict";var n=i(0),r=i(90)(!1);n(n.P,"String",{codePointAt:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(10),o=i(93),a="".endsWith;n(n.P+n.F*i(94)("endsWith"),"String",{endsWith:function(t){var e=o(this,t,"endsWith"),i=arguments.length>1?arguments[1]:void 0,n=r(e.length),s=void 0===i?n:Math.min(r(i),n),l=String(t);return a?a.call(e,l,s):e.slice(s-l.length,s)===l}})},function(t,e,i){"use strict";var n=i(0),r=i(93);n(n.P+n.F*i(94)("includes"),"String",{includes:function(t){return!!~r(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){var n=i(0);n(n.P,"String",{repeat:i(87)})},function(t,e,i){"use strict";var n=i(0),r=i(10),o=i(93),a="".startsWith;n(n.P+n.F*i(94)("startsWith"),"String",{startsWith:function(t){var e=o(this,t,"startsWith"),i=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),n=String(t);return a?a.call(e,n,i):e.slice(i,i+n.length)===n}})},function(t,e,i){"use strict";i(16)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},function(t,e,i){"use strict";i(16)("big",function(t){return function(){return t(this,"big","","")}})},function(t,e,i){"use strict";i(16)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,e,i){"use strict";i(16)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,e,i){"use strict";i(16)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,e,i){"use strict";i(16)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},function(t,e,i){"use strict";i(16)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},function(t,e,i){"use strict";i(16)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,e,i){"use strict";i(16)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(t,e,i){"use strict";i(16)("small",function(t){return function(){return t(this,"small","","")}})},function(t,e,i){"use strict";i(16)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,e,i){"use strict";i(16)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,e,i){"use strict";i(16)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,e,i){var n=i(0);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,i){"use strict";var n=i(0),r=i(11),o=i(26);n(n.P+n.F*i(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=r(this),i=o(e);return"number"!=typeof i||isFinite(i)?e.toISOString():null}})},function(t,e,i){var n=i(0),r=i(269);n(n.P+n.F*(Date.prototype.toISOString!==r),"Date",{toISOString:r})},function(t,e,i){"use strict";var n=i(4),r=Date.prototype.getTime,o=Date.prototype.toISOString,a=function(t){return t>9?t:"0"+t};t.exports=n(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!n(function(){o.call(new Date(NaN))})?function(){if(!isFinite(r.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+("00000"+Math.abs(e)).slice(n?-6:-4)+"-"+a(t.getUTCMonth()+1)+"-"+a(t.getUTCDate())+"T"+a(t.getUTCHours())+":"+a(t.getUTCMinutes())+":"+a(t.getUTCSeconds())+"."+(i>99?i:"0"+a(i))+"Z"}:o},function(t,e,i){var n=Date.prototype,r=n.toString,o=n.getTime;new Date(NaN)+""!="Invalid Date"&&i(15)(n,"toString",function(){var t=o.call(this);return t==t?r.call(this):"Invalid Date"})},function(t,e,i){var n=i(7)("toPrimitive"),r=Date.prototype;n in r||i(14)(r,n,i(272))},function(t,e,i){"use strict";var n=i(2),r=i(26);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return r(n(this),"number"!=t)}},function(t,e,i){var n=i(0);n(n.S,"Array",{isArray:i(64)})},function(t,e,i){"use strict";var n=i(22),r=i(0),o=i(11),a=i(127),s=i(95),l=i(10),u=i(96),c=i(97);r(r.S+r.F*!i(66)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,r,h,d=o(t),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,v=void 0!==m,g=0,y=c(d);if(v&&(m=n(m,p>2?arguments[2]:void 0,2)),void 0==y||f==Array&&s(y))for(i=new f(e=l(d.length));e>g;g++)u(i,g,v?m(d[g],g):d[g]);else for(h=y.call(d),i=new f;!(r=h.next()).done;g++)u(i,g,v?a(h,m,[r.value,g],!0):r.value);return i.length=g,i}})},function(t,e,i){"use strict";var n=i(0),r=i(96);n(n.S+n.F*i(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)r(i,t,arguments[t++]);return i.length=e,i}})},function(t,e,i){"use strict";var n=i(0),r=i(18),o=[].join;n(n.P+n.F*(i(56)!=Object||!i(24)(o)),"Array",{join:function(t){return o.call(r(this),void 0===t?",":t)}})},function(t,e,i){"use strict";var n=i(0),r=i(83),o=i(23),a=i(41),s=i(10),l=[].slice;n(n.P+n.F*i(4)(function(){r&&l.call(r)}),"Array",{slice:function(t,e){var i=s(this.length),n=o(this);if(e=void 0===e?i:e,"Array"==n)return l.call(this,t,e);for(var r=a(t,i),u=a(e,i),c=s(u-r),h=new Array(c),d=0;d<c;d++)h[d]="String"==n?this.charAt(r+d):this[r+d];return h}})},function(t,e,i){"use strict";var n=i(0),r=i(13),o=i(11),a=i(4),s=[].sort,l=[1,2,3];n(n.P+n.F*(a(function(){l.sort(void 0)})||!a(function(){l.sort(null)})||!i(24)(s)),"Array",{sort:function(t){return void 0===t?s.call(o(this)):s.call(o(this),r(t))}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(0),o=i(24)([].forEach,!0);n(n.P+n.F*!o,"Array",{forEach:function(t){return r(this,t,arguments[1])}})},function(t,e,i){var n=i(5),r=i(64),o=i(7)("species");t.exports=function(t){var e;return r(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!r(e.prototype)||(e=void 0),n(e)&&null===(e=e[o])&&(e=void 0)),void 0===e?Array:e}},function(t,e,i){"use strict";var n=i(0),r=i(30)(1);n(n.P+n.F*!i(24)([].map,!0),"Array",{map:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(2);n(n.P+n.F*!i(24)([].filter,!0),"Array",{filter:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(3);n(n.P+n.F*!i(24)([].some,!0),"Array",{some:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(30)(4);n(n.P+n.F*!i(24)([].every,!0),"Array",{every:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(128);n(n.P+n.F*!i(24)([].reduce,!0),"Array",{reduce:function(t){return r(this,t,arguments.length,arguments[1],!1)}})},function(t,e,i){"use strict";var n=i(0),r=i(128);n(n.P+n.F*!i(24)([].reduceRight,!0),"Array",{reduceRight:function(t){return r(this,t,arguments.length,arguments[1],!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(62)(!1),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(a||!i(24)(o)),"Array",{indexOf:function(t){return a?o.apply(this,arguments)||0:r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(18),o=i(28),a=i(10),s=[].lastIndexOf,l=!!s&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(l||!i(24)(s)),"Array",{lastIndexOf:function(t){if(l)return s.apply(this,arguments)||0;var e=r(this),i=a(e.length),n=i-1;for(arguments.length>1&&(n=Math.min(n,o(arguments[1]))),n<0&&(n=i+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}})},function(t,e,i){var n=i(0);n(n.P,"Array",{copyWithin:i(129)}),i(36)("copyWithin")},function(t,e,i){var n=i(0);n(n.P,"Array",{fill:i(99)}),i(36)("fill")},function(t,e,i){"use strict";var n=i(0),r=i(30)(5),o=!0;"find"in[]&&Array(1).find(function(){o=!1}),n(n.P+n.F*o,"Array",{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(36)("find")},function(t,e,i){"use strict";var n=i(0),r=i(30)(6),o="findIndex",a=!0;o in[]&&Array(1)[o](function(){a=!1}),n(n.P+n.F*a,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(36)(o)},function(t,e,i){i(44)("Array")},function(t,e,i){var n=i(3),r=i(86),o=i(9).f,a=i(43).f,s=i(65),l=i(67),u=n.RegExp,c=u,h=u.prototype,d=/a/g,f=/a/g,p=new u(d)!==d;if(i(8)&&(!p||i(4)(function(){return f[i(7)("match")]=!1,u(d)!=d||u(f)==f||"/a/i"!=u(d,"i")}))){u=function(t,e){var i=this instanceof u,n=s(t),o=void 0===e;return!i&&n&&t.constructor===u&&o?t:r(p?new c(n&&!o?t.source:t,e):c((n=t instanceof u)?t.source:t,n&&o?l.call(t):e),i?this:h,u)};for(var m=function(t){t in u||o(u,t,{configurable:!0,get:function(){return c[t]},set:function(e){c[t]=e}})},v=a(c),g=0;v.length>g;)m(v[g++]);h.constructor=u,u.prototype=h,i(15)(n,"RegExp",u)}i(44)("RegExp")},function(t,e,i){"use strict";i(131);var n=i(2),r=i(67),o=i(8),a=/./.toString,s=function(t){i(15)(RegExp.prototype,"toString",t,!0)};i(4)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?s(function(){var t=n(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?r.call(t):void 0)}):"toString"!=a.name&&s(function(){return a.call(this)})},function(t,e,i){i(68)("match",1,function(t,e,i){return[function(i){"use strict";var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(68)("replace",2,function(t,e,i){return[function(n,r){"use strict";var o=t(this),a=void 0==n?void 0:n[e];return void 0!==a?a.call(n,o,r):i.call(String(o),n,r)},i]})},function(t,e,i){i(68)("search",1,function(t,e,i){return[function(i){"use strict";var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(68)("split",2,function(t,e,n){"use strict";var r=i(65),o=n,a=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var s=void 0===/()??/.exec("")[1];n=function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!r(t))return o.call(i,t,e);var n,l,u,c,h,d=[],f=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,m=void 0===e?4294967295:e>>>0,v=new RegExp(t.source,f+"g");for(s||(n=new RegExp("^"+v.source+"$(?!\\s)",f));(l=v.exec(i))&&!((u=l.index+l[0].length)>p&&(d.push(i.slice(p,l.index)),!s&&l.length>1&&l[0].replace(n,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(l[h]=void 0)}),l.length>1&&l.index<i.length&&a.apply(d,l.slice(1)),c=l[0].length,p=u,d.length>=m));)v.lastIndex===l.index&&v.lastIndex++;return p===i.length?!c&&v.test("")||d.push(""):d.push(i.slice(p)),d.length>m?d.slice(0,m):d}}else"0".split(void 0,0).length&&(n=function(t,e){return void 0===t&&0===e?[]:o.call(this,t,e)});return[function(i,r){var o=t(this),a=void 0==i?void 0:i[e];return void 0!==a?a.call(i,o,r):n.call(String(o),i,r)},n]})},function(t,e,i){"use strict";var n,r,o,a,s=i(39),l=i(3),u=i(22),c=i(58),h=i(0),d=i(5),f=i(13),p=i(45),m=i(46),v=i(69),g=i(101).set,y=i(102)(),_=i(103),b=i(132),x=i(133),w=l.TypeError,S=l.process,M=l.Promise,E="process"==c(S),z=function(){},k=r=_.f,T=!!function(){try{var t=M.resolve(1),e=(t.constructor={})[i(7)("species")]=function(t){t(z,z)};return(E||"function"==typeof PromiseRejectionEvent)&&t.then(z)instanceof e}catch(t){}}(),O=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},C=function(t,e){if(!t._n){t._n=!0;var i=t._c;y(function(){for(var n=t._v,r=1==t._s,o=0,a=function(e){var i,o,a,s=r?e.ok:e.fail,l=e.resolve,u=e.reject,c=e.domain;try{s?(r||(2==t._h&&I(t),t._h=1),!0===s?i=n:(c&&c.enter(),i=s(n),c&&(c.exit(),a=!0)),i===e.promise?u(w("Promise-chain cycle")):(o=O(i))?o.call(i,l,u):l(i)):u(n)}catch(t){c&&!a&&c.exit(),u(t)}};i.length>o;)a(i[o++]);t._c=[],t._n=!1,e&&!t._h&&P(t)})}},P=function(t){g.call(l,function(){var e,i,n,r=t._v,o=A(t);if(o&&(e=b(function(){E?S.emit("unhandledRejection",r,t):(i=l.onunhandledrejection)?i({promise:t,reason:r}):(n=l.console)&&n.error&&n.error("Unhandled promise rejection",r)}),t._h=E||A(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},A=function(t){return 1!==t._h&&0===(t._a||t._c).length},I=function(t){g.call(l,function(){var e;E?S.emit("rejectionHandled",t):(e=l.onrejectionhandled)&&e({promise:t,reason:t._v})})},L=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),C(e,!0))},D=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw w("Promise can't be resolved itself");(e=O(t))?y(function(){var n={_w:i,_d:!1};try{e.call(t,u(D,n,1),u(L,n,1))}catch(t){L.call(n,t)}}):(i._v=t,i._s=1,C(i,!1))}catch(t){L.call({_w:i,_d:!1},t)}}};T||(M=function(t){p(this,M,"Promise","_h"),f(t),n.call(this);try{t(u(D,this,1),u(L,this,1))}catch(t){L.call(this,t)}},(n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(47)(M.prototype,{then:function(t,e){var i=k(v(this,M));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=E?S.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&C(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new n;this.promise=t,this.resolve=u(D,t,1),this.reject=u(L,t,1)},_.f=k=function(t){return t===M||t===a?new o(t):r(t)}),h(h.G+h.W+h.F*!T,{Promise:M}),i(51)(M,"Promise"),i(44)("Promise"),a=i(25).Promise,h(h.S+h.F*!T,"Promise",{reject:function(t){var e=k(this);return(0,e.reject)(t),e.promise}}),h(h.S+h.F*(s||!T),"Promise",{resolve:function(t){return x(s&&this===a?M:this,t)}}),h(h.S+h.F*!(T&&i(66)(function(t){M.all(t).catch(z)})),"Promise",{all:function(t){var e=this,i=k(e),n=i.resolve,r=i.reject,o=b(function(){var i=[],o=0,a=1;m(t,!1,function(t){var s=o++,l=!1;i.push(void 0),a++,e.resolve(t).then(function(t){l||(l=!0,i[s]=t,--a||n(i))},r)}),--a||n(i)});return o.e&&r(o.v),i.promise},race:function(t){var e=this,i=k(e),n=i.reject,r=b(function(){m(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r.e&&n(r.v),i.promise}})},function(t,e,i){"use strict";var n=i(138),r=i(54);i(70)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(r(this,"WeakSet"),t,!0)}},n,!1,!0)},function(t,e,i){"use strict";var n=i(0),r=i(71),o=i(104),a=i(2),s=i(41),l=i(10),u=i(5),c=i(3).ArrayBuffer,h=i(69),d=o.ArrayBuffer,f=o.DataView,p=r.ABV&&c.isView,m=d.prototype.slice,v=r.VIEW;n(n.G+n.W+n.F*(c!==d),{ArrayBuffer:d}),n(n.S+n.F*!r.CONSTR,"ArrayBuffer",{isView:function(t){return p&&p(t)||u(t)&&v in t}}),n(n.P+n.U+n.F*i(4)(function(){return!new d(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(t,e){if(void 0!==m&&void 0===e)return m.call(a(this),t);for(var i=a(this).byteLength,n=s(t,i),r=s(void 0===e?i:e,i),o=new(h(this,d))(l(r-n)),u=new f(this),c=new f(o),p=0;n<r;)c.setUint8(p++,u.getUint8(n++));return o}}),i(44)("ArrayBuffer")},function(t,e,i){var n=i(0);n(n.G+n.W+n.F*!i(71).ABV,{DataView:i(104).DataView})},function(t,e,i){i(33)("Int8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}},!0)},function(t,e,i){i(33)("Int16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Int32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Uint32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Float32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(33)("Float64",8,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){var n=i(0),r=i(13),o=i(2),a=(i(3).Reflect||{}).apply,s=Function.apply;n(n.S+n.F*!i(4)(function(){a(function(){})}),"Reflect",{apply:function(t,e,i){var n=r(t),l=o(i);return a?a(n,e,l):s.call(n,e,l)}})},function(t,e,i){var n=i(0),r=i(42),o=i(13),a=i(2),s=i(5),l=i(4),u=i(119),c=(i(3).Reflect||{}).construct,h=l(function(){function t(){}return!(c(function(){},[],t)instanceof t)}),d=!l(function(){c(function(){})});n(n.S+n.F*(h||d),"Reflect",{construct:function(t,e){o(t),a(e);var i=arguments.length<3?t:o(arguments[2]);if(d&&!h)return c(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var n=[null];return n.push.apply(n,e),new(u.apply(t,n))}var l=i.prototype,f=r(s(l)?l:Object.prototype),p=Function.apply.call(t,f,e);return s(p)?p:f}})},function(t,e,i){var n=i(9),r=i(0),o=i(2),a=i(26);r(r.S+r.F*i(4)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,i){o(t),e=a(e,!0),o(i);try{return n.f(t,e,i),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),r=i(19).f,o=i(2);n(n.S,"Reflect",{deleteProperty:function(t,e){var i=r(o(t),e);return!(i&&!i.configurable)&&delete t[e]}})},function(t,e,i){"use strict";var n=i(0),r=i(2),o=function(t){this._t=r(t),this._i=0;var e,i=this._k=[];for(e in t)i.push(e)};i(92)(o,"Object",function(){var t,e=this._k;do{if(this._i>=e.length)return{value:void 0,done:!0}}while(!((t=e[this._i++])in this._t));return{value:t,done:!1}}),n(n.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,e,i){var n=i(19),r=i(20),o=i(17),a=i(0),s=i(5),l=i(2);a(a.S,"Reflect",{get:function t(e,i){var a,u,c=arguments.length<3?e:arguments[2];return l(e)===c?e[i]:(a=n.f(e,i))?o(a,"value")?a.value:void 0!==a.get?a.get.call(c):void 0:s(u=r(e))?t(u,i,c):void 0}})},function(t,e,i){var n=i(19),r=i(0),o=i(2);r(r.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return n.f(o(t),e)}})},function(t,e,i){var n=i(0),r=i(20),o=i(2);n(n.S,"Reflect",{getPrototypeOf:function(t){return r(o(t))}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,i){var n=i(0),r=i(2),o=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(t){return r(t),!o||o(t)}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{ownKeys:i(140)})},function(t,e,i){var n=i(0),r=i(2),o=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(t){r(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,e,i){var n=i(9),r=i(19),o=i(20),a=i(17),s=i(0),l=i(37),u=i(2),c=i(5);s(s.S,"Reflect",{set:function t(e,i,s){var h,d,f=arguments.length<4?e:arguments[3],p=r.f(u(e),i);if(!p){if(c(d=o(e)))return t(d,i,s,f);p=l(0)}if(a(p,"value")){if(!1===p.writable||!c(f))return!1;if(h=r.f(f,i)){if(h.get||h.set||!1===h.writable)return!1;h.value=s,n.f(f,i,h)}else n.f(f,i,l(0,s));return!0}return void 0!==p.set&&(p.set.call(f,s),!0)}})},function(t,e,i){var n=i(0),r=i(84);r&&n(n.S,"Reflect",{setPrototypeOf:function(t,e){r.check(t,e);try{return r.set(t,e),!0}catch(t){return!1}}})},function(t,e,i){"use strict";var n=i(0),r=i(62)(!0);n(n.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(36)("includes")},function(t,e,i){"use strict";var n=i(0),r=i(141),o=i(11),a=i(10),s=i(13),l=i(98);n(n.P,"Array",{flatMap:function(t){var e,i,n=o(this);return s(t),e=a(n.length),i=l(n,0),r(i,n,n,e,0,1,t,arguments[1]),i}}),i(36)("flatMap")},function(t,e,i){"use strict";var n=i(0),r=i(141),o=i(11),a=i(10),s=i(28),l=i(98);n(n.P,"Array",{flatten:function(){var t=arguments[0],e=o(this),i=a(e.length),n=l(e,0);return r(n,e,e,i,0,void 0===t?1:s(t)),n}}),i(36)("flatten")},function(t,e,i){"use strict";var n=i(0),r=i(90)(!0);n(n.P,"String",{at:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(142),o=i(105);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(o),"String",{padStart:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(142),o=i(105);n(n.P+n.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(o),"String",{padEnd:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,e,i){"use strict";i(52)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,e,i){"use strict";i(52)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,e,i){"use strict";var n=i(0),r=i(27),o=i(10),a=i(65),s=i(67),l=RegExp.prototype,u=function(t,e){this._r=t,this._s=e};i(92)(u,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),n(n.P,"String",{matchAll:function(t){if(r(this),!a(t))throw TypeError(t+" is not a regexp!");var e=String(this),i="flags"in l?String(t.flags):s.call(t),n=new RegExp(t.source,~i.indexOf("g")?i:"g"+i);return n.lastIndex=o(t.lastIndex),new u(n,e)}})},function(t,e,i){i(80)("asyncIterator")},function(t,e,i){i(80)("observable")},function(t,e,i){var n=i(0),r=i(140),o=i(18),a=i(19),s=i(96);n(n.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,i,n=o(t),l=a.f,u=r(n),c={},h=0;u.length>h;)void 0!==(i=l(n,e=u[h++]))&&s(c,e,i);return c}})},function(t,e,i){var n=i(0),r=i(143)(!1);n(n.S,"Object",{values:function(t){return r(t)}})},function(t,e,i){var n=i(0),r=i(143)(!0);n(n.S,"Object",{entries:function(t){return r(t)}})},function(t,e,i){"use strict";var n=i(0),r=i(11),o=i(13),a=i(9);i(8)&&n(n.P+i(72),"Object",{__defineGetter__:function(t,e){a.f(r(this),t,{get:o(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(11),o=i(13),a=i(9);i(8)&&n(n.P+i(72),"Object",{__defineSetter__:function(t,e){a.f(r(this),t,{set:o(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(11),o=i(26),a=i(20),s=i(19).f;i(8)&&n(n.P+i(72),"Object",{__lookupGetter__:function(t){var e,i=r(this),n=o(t,!0);do{if(e=s(i,n))return e.get}while(i=a(i))}})},function(t,e,i){"use strict";var n=i(0),r=i(11),o=i(26),a=i(20),s=i(19).f;i(8)&&n(n.P+i(72),"Object",{__lookupSetter__:function(t){var e,i=r(this),n=o(t,!0);do{if(e=s(i,n))return e.set}while(i=a(i))}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Map",{toJSON:i(144)("Map")})},function(t,e,i){var n=i(0);n(n.P+n.R,"Set",{toJSON:i(144)("Set")})},function(t,e,i){i(73)("Map")},function(t,e,i){i(73)("Set")},function(t,e,i){i(73)("WeakMap")},function(t,e,i){i(73)("WeakSet")},function(t,e,i){i(74)("Map")},function(t,e,i){i(74)("Set")},function(t,e,i){i(74)("WeakMap")},function(t,e,i){i(74)("WeakSet")},function(t,e,i){var n=i(0);n(n.G,{global:i(3)})},function(t,e,i){var n=i(0);n(n.S,"System",{global:i(3)})},function(t,e,i){var n=i(0),r=i(23);n(n.S,"Error",{isError:function(t){return"Error"===r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clamp:function(t,e,i){return Math.min(i,Math.max(e,t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,e,i){var n=i(0),r=180/Math.PI;n(n.S,"Math",{degrees:function(t){return t*r}})},function(t,e,i){var n=i(0),r=i(146),o=i(126);n(n.S,"Math",{fscale:function(t,e,i,n,a){return o(r(t,e,i,n,a))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{iaddh:function(t,e,i,n){var r=t>>>0,o=i>>>0;return(e>>>0)+(n>>>0)+((r&o|(r|o)&~(r+o>>>0))>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{isubh:function(t,e,i,n){var r=t>>>0,o=i>>>0;return(e>>>0)-(n>>>0)-((~r&o|~(r^o)&r-o>>>0)>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{imulh:function(t,e){var i=+t,n=+e,r=65535&i,o=65535&n,a=i>>16,s=n>>16,l=(a*o>>>0)+(r*o>>>16);return a*s+(l>>16)+((r*s>>>0)+(65535&l)>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,e,i){var n=i(0),r=Math.PI/180;n(n.S,"Math",{radians:function(t){return t*r}})},function(t,e,i){var n=i(0);n(n.S,"Math",{scale:i(146)})},function(t,e,i){var n=i(0);n(n.S,"Math",{umulh:function(t,e){var i=+t,n=+e,r=65535&i,o=65535&n,a=i>>>16,s=n>>>16,l=(a*o>>>0)+(r*o>>>16);return a*s+(l>>>16)+((r*s>>>0)+(65535&l)>>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:t>0}})},function(t,e,i){"use strict";var n=i(0),r=i(25),o=i(3),a=i(69),s=i(133);n(n.P+n.R,"Promise",{finally:function(t){var e=a(this,r.Promise||o.Promise),i="function"==typeof t;return this.then(i?function(i){return s(e,t()).then(function(){return i})}:t,i?function(i){return s(e,t()).then(function(){throw i})}:t)}})},function(t,e,i){"use strict";var n=i(0),r=i(103),o=i(132);n(n.S,"Promise",{try:function(t){var e=r.f(this),i=o(t);return(i.e?e.reject:e.resolve)(i.v),e.promise}})},function(t,e,i){var n=i(34),r=i(2),o=n.key,a=n.set;n.exp({defineMetadata:function(t,e,i,n){a(t,e,r(i),o(n))}})},function(t,e,i){var n=i(34),r=i(2),o=n.key,a=n.map,s=n.store;n.exp({deleteMetadata:function(t,e){var i=arguments.length<3?void 0:o(arguments[2]),n=a(r(e),i,!1);if(void 0===n||!n.delete(t))return!1;if(n.size)return!0;var l=s.get(e);return l.delete(i),!!l.size||s.delete(e)}})},function(t,e,i){var n=i(34),r=i(2),o=i(20),a=n.has,s=n.get,l=n.key,u=function(t,e,i){if(a(t,e,i))return s(t,e,i);var n=o(e);return null!==n?u(t,n,i):void 0};n.exp({getMetadata:function(t,e){return u(t,r(e),arguments.length<3?void 0:l(arguments[2]))}})},function(t,e,i){var n=i(136),r=i(145),o=i(34),a=i(2),s=i(20),l=o.keys,u=o.key,c=function(t,e){var i=l(t,e),o=s(t);if(null===o)return i;var a=c(o,e);return a.length?i.length?r(new n(i.concat(a))):a:i};o.exp({getMetadataKeys:function(t){return c(a(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,e,i){var n=i(34),r=i(2),o=n.get,a=n.key;n.exp({getOwnMetadata:function(t,e){return o(t,r(e),arguments.length<3?void 0:a(arguments[2]))}})},function(t,e,i){var n=i(34),r=i(2),o=n.keys,a=n.key;n.exp({getOwnMetadataKeys:function(t){return o(r(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,e,i){var n=i(34),r=i(2),o=i(20),a=n.has,s=n.key,l=function(t,e,i){if(a(t,e,i))return!0;var n=o(e);return null!==n&&l(t,n,i)};n.exp({hasMetadata:function(t,e){return l(t,r(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(34),r=i(2),o=n.has,a=n.key;n.exp({hasOwnMetadata:function(t,e){return o(t,r(e),arguments.length<3?void 0:a(arguments[2]))}})},function(t,e,i){var n=i(34),r=i(2),o=i(13),a=n.key,s=n.set;n.exp({metadata:function(t,e){return function(i,n){s(t,e,(void 0!==n?r:o)(i),a(n))}}})},function(t,e,i){var n=i(0),r=i(102)(),o=i(3).process,a="process"==i(23)(o);n(n.G,{asap:function(t){var e=a&&o.domain;r(e?e.bind(t):t)}})},function(t,e,i){"use strict";var n=i(0),r=i(3),o=i(25),a=i(102)(),s=i(7)("observable"),l=i(13),u=i(2),c=i(45),h=i(47),d=i(14),f=i(46),p=f.RETURN,m=function(t){return null==t?void 0:l(t)},v=function(t){var e=t._c;e&&(t._c=void 0,e())},g=function(t){return void 0===t._o},y=function(t){g(t)||(t._o=void 0,v(t))},_=function(t,e){u(t),this._c=void 0,this._o=t,t=new b(this);try{var i=e(t),n=i;null!=i&&("function"==typeof i.unsubscribe?i=function(){n.unsubscribe()}:l(i),this._c=i)}catch(e){return void t.error(e)}g(this)&&v(this)};_.prototype=h({},{unsubscribe:function(){y(this)}});var b=function(t){this._s=t};b.prototype=h({},{next:function(t){var e=this._s;if(!g(e)){var i=e._o;try{var n=m(i.next);if(n)return n.call(i,t)}catch(t){try{y(e)}finally{throw t}}}},error:function(t){var e=this._s;if(g(e))throw t;var i=e._o;e._o=void 0;try{var n=m(i.error);if(!n)throw t;t=n.call(i,t)}catch(t){try{v(e)}finally{throw t}}return v(e),t},complete:function(t){var e=this._s;if(!g(e)){var i=e._o;e._o=void 0;try{var n=m(i.complete);t=n?n.call(i,t):void 0}catch(t){try{v(e)}finally{throw t}}return v(e),t}}});var x=function(t){c(this,x,"Observable","_f")._f=l(t)};h(x.prototype,{subscribe:function(t){return new _(t,this._f)},forEach:function(t){var e=this;return new(o.Promise||r.Promise)(function(i,n){l(t);var r=e.subscribe({next:function(e){try{return t(e)}catch(t){n(t),r.unsubscribe()}},error:n,complete:i})})}}),h(x,{from:function(t){var e="function"==typeof this?this:x,i=m(u(t)[s]);if(i){var n=u(i.call(t));return n.constructor===e?n:new e(function(t){return n.subscribe(t)})}return new e(function(e){var i=!1;return a(function(){if(!i){try{if(f(t,!1,function(t){if(e.next(t),i)return p})===p)return}catch(t){if(i)throw t;return void e.error(t)}e.complete()}}),function(){i=!0}})},of:function(){for(var t=0,e=arguments.length,i=new Array(e);t<e;)i[t]=arguments[t++];return new("function"==typeof this?this:x)(function(t){var e=!1;return a(function(){if(!e){for(var n=0;n<i.length;++n)if(t.next(i[n]),e)return;t.complete()}}),function(){e=!0}})}}),d(x.prototype,s,function(){return this}),n(n.G,{Observable:x}),i(44)("Observable")},function(t,e,i){var n=i(3),r=i(0),o=i(105),a=[].slice,s=/MSIE .\./.test(o),l=function(t){return function(e,i){var n=arguments.length>2,r=!!n&&a.call(arguments,2);return t(n?function(){("function"==typeof e?e:Function(e)).apply(this,r)}:e,i)}};r(r.G+r.B+r.F*s,{setTimeout:l(n.setTimeout),setInterval:l(n.setInterval)})},function(t,e,i){var n=i(0),r=i(101);n(n.G+n.B,{setImmediate:r.set,clearImmediate:r.clear})},function(t,e,i){for(var n=i(100),r=i(40),o=i(15),a=i(3),s=i(14),l=i(53),u=i(7),c=u("iterator"),h=u("toStringTag"),d=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),m=0;m<p.length;m++){var v,g=p[m],y=f[g],_=a[g],b=_&&_.prototype;if(b&&(b[c]||s(b,c,d),b[h]||s(b,h,g),l[g]=d,y))for(v in n)b[v]||o(b,v,n[v],!0)}},function(t,e,i){(function(e){!function(e){"use strict";var i,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag",u="object"==typeof t,c=e.regeneratorRuntime;if(c)u&&(t.exports=c);else{(c=e.regeneratorRuntime=u?t.exports:{}).wrap=b;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",m={},v={};v[a]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(P([])));y&&y!==n&&r.call(y,a)&&(v=y);var _=M.prototype=w.prototype=Object.create(v);S.prototype=_.constructor=M,M.constructor=S,M[l]=S.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===S||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,M):(t.__proto__=M,l in t||(t[l]="GeneratorFunction")),t.prototype=Object.create(_),t},c.awrap=function(t){return{__await:t}},E(z.prototype),z.prototype[s]=function(){return this},c.AsyncIterator=z,c.async=function(t,e,i,n){var r=new z(b(t,e,i,n));return c.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},E(_),_[l]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},c.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},c.values=P,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=i)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return s.type="throw",s.arg=t,e.next=n,r&&(e.method="next",e.arg=i),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),O(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;O(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=i),m}}}function b(t,e,i,n){var r=e&&e.prototype instanceof w?e:w,o=Object.create(r.prototype),a=new C(n||[]);return o._invoke=function(t,e,i){var n=h;return function(r,o){if(n===f)throw new Error("Generator is already running");if(n===p){if("throw"===r)throw o;return A()}for(i.method=r,i.arg=o;;){var a=i.delegate;if(a){var s=k(a,i);if(s){if(s===m)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===h)throw n=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=f;var l=x(t,e,i);if("normal"===l.type){if(n=i.done?p:d,l.arg===m)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n=p,i.method="throw",i.arg=l.arg)}}}(t,i,a),o}function x(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function w(){}function S(){}function M(){}function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function z(t){function i(e,n,o,a){var s=x(t[e],t,n);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?Promise.resolve(u.__await).then(function(t){i("next",t,o,a)},function(t){i("throw",t,o,a)}):Promise.resolve(u).then(function(t){l.value=t,o(l)},a)}a(s.arg)}var n;"object"==typeof e.process&&e.process.domain&&(i=e.process.domain.bind(i)),this._invoke=function(t,e){function r(){return new Promise(function(n,r){i(t,e,n,r)})}return n=n?n.then(r,r):r()}}function k(t,e){var n=t.iterator[e.method];if(n===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=i,k(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=x(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,m;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=i),e.delegate=null,m):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=i,e.done=!0,e};return o.next=o}}return{next:A}}function A(){return{value:i,done:!0}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,i(78))},function(t,e,i){i(388),t.exports=i(25).RegExp.escape},function(t,e,i){var n=i(0),r=i(389)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(t){return r(t)}})},function(t,e){t.exports=function(t,e){var i=e===Object(e)?function(t){return e[t]}:e;return function(e){return String(e).replace(t,i)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=v(i(106)),r=m(i(1)),o=v(i(147)),a=v(i(31)),s=v(i(6)),l=v(i(48)),u=v(i(75)),c=v(i(49)),h=v(i(110)),d=m(i(21)),f=v(i(157)),p=i(158);function m(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function v(t){return t&&t.__esModule?t:{default:t}}var g=function t(e,i,n){var a=o.default.get(e);if(a){var s=new a(i,n);return t._instances[s._id]=s,s}r.error('Tool "'+e+'" was not found.')};g._instances={},g._globals=h.default,g.clearInstances=function(t){if(t)g._instances[t]=void 0;else{for(var e in g._instances)g._instances[e].clear();g._instances={}}};var y=(0,n.default)(i(397));r.forEach(y,function(t,e){u.default.register(e,t)});var _=(0,n.default)(i(401),1);function b(t,e,i){return function(){var n=i.apply(e,arguments);return n===e?t:n}}r.forEach(_,function(t,e){s.default.register(e,t)}),(0,n.default)(i(427)),g.helpers=(0,n.default)(i(428)),g.iconset=d,d3.rebind=function(t,e){for(var i=1,n=void 0,r=arguments.length;++i<r;)t[n=arguments[i]]=b(t,e,e[n]);return t},d3.time={},d3.time.scale=d3.scaleTime,d3.time.scale.utc=d3.scaleUtc,d3.time.format=function(t){var e=d3.timeFormat(t);return e.parse=d3.timeParse(t),e},d3.time.format.utc=function(t){var e=d3.utcFormat(t);return e.parse=d3.utcParse(t),e},d3.time.format.iso=function(t){var e=d3.isoFormat(t);return e.parse=d3.isoParse(t),e},d3.scaleGenericlog=f.default,d3.selection.prototype.onTap=p.onTap,d3.selection.prototype.onLongTap=p.onLongTap,g.Class=a.default,g.Tool=o.default,g.Component=s.default,g.Model=l.default,g.Reader=u.default,g.Events=c.default,g.utils=r,e.default=g},function(t,e){t.exports={linear:function(t,e,i,n,r){return+i+(r-t)/(e-t)*(n-i)},exp:function(t,e,i,n,r){return Math.exp((Math.log(i)*(e-r)-Math.log(n)*(t-r))/(e-t))},stepBefore:function(t,e,i,n,r){return n},stepAfter:function(t,e,i,n,r){return i},stepMiddle:function(t,e,i,n,r){return r<(t+e)/2?i:n}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(31);var o=((n=r)&&n.__esModule?n:{default:n}).default.extend({init:function(){this.intervals={}},setInterval:function(t){function e(e,i,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e,i){this.clearInterval(t),this.intervals[t]=setInterval(e,i)}),clearInterval:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){t?this.intervals[t]&&(clearInterval(this.intervals[t]),delete this.intervals[t]):this.clearAllIntervals()}),clearAllIntervals:function(){for(var t in this.intervals)this.clearInterval(t)}});e.default=o},function(t,e,i){var n={"./axis":107,"./axis.js":107,"./color":148,"./color.js":148,"./data":108,"./data.js":108,"./dataconnected":55,"./dataconnected.js":55,"./entities":109,"./entities.js":109,"./group":149,"./group.js":149,"./hook":32,"./hook.js":32,"./label":150,"./label.js":150,"./locale":151,"./locale.js":151,"./marker":76,"./marker.js":76,"./side":152,"./side.js":152,"./size":153,"./size.js":153,"./stack":154,"./stack.js":154,"./time":155,"./time.js":155,"./ui":156,"./ui.js":156};function r(t){return i(o(t))}function o(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(n)},r.resolve=o,t.exports=r,r.id=393},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataStorage=e.Storage=void 0;var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),s=i(31);(n=s)&&n.__esModule;function l(t,e,i,n){return a.hashCode([t.select.key,t.where,t.from,t.join,t.dataset,t.version,t.language,e,i,n])}function u(t,e,i){var n=e[0]+" - "+e[e.length-1]+" ("+e.length+")";return i&&(n=n+"_"+i.join()),n}var c=e.Storage=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.queryIds={},this.queries={},this._collection={},this._collectionPromises={}}return o(t,[{key:"loadFromReader",value:function(t,e,i){var n=l(t,i._basepath,i._lastModified,i._name);return this.queries[n]||(this.queries[n]=this.queryQueue(i,n)),this.queries[n].getPromise(t,e)}},{key:"getDataId",value:function(t,e,i){var n=l(t,e._basepath,e._lastModified,e._name);return!!this.queries[n]&&this.queries[n].getDataId(t,i)}},{key:"queryQueue",value:function(t,e){var i=this,n=function(t,e){return 0==Object.keys(e).filter(function(i){return e[i]!==t[i]}).length&&(0==Object.keys(t).length||0!=Object.keys(e).length)};return new function(){this.readerObject=t,this.queries=[],this.query=null,this.parsers=null,this.defer={},this.getPromise=function(t,e){var i=this,o=function(i){if(0==t.select.value.filter(function(t){return-1==i.query.select.value.indexOf(t)}).length&&n(i.parsers,e))return{v:i.defer.promise}},s=!0,l=!1,u=void 0;try{for(var c,h=this.queries[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=o(c.value);if("object"===(void 0===d?"undefined":r(d)))return d.v}}catch(t){l=!0,u=t}finally{try{!s&&h.return&&h.return()}finally{if(l)throw u}}return this.query?(this.query.select.value=this.query.select.value?a.unique(this.query.select.value.concat(t.select.value)):[],a.extend(this.parsers,e)):(this.query=t,this.parsers=e),a.debounce(function(){i.runQuery()},10)(),this.defer.promise&&this.defer.promise instanceof Promise||(this.defer.promise=new Promise(function(t,e){i.defer.resolve=t,i.defer.reject=e})),this.defer.promise},this.runQuery=function(){this.query&&(this.queries.push(this.reader(this.query,this.parsers,this.defer)),this.query=null,this.parsers=null,this.defer={})},this.getDataId=function(t,e){var i=function(i){if((!t.select.value||0==t.select.value.filter(function(t){return-1==i.query.select.value.indexOf(t)}).length)&&n(i.parsers,e)&&i.dataId)return{v:i.dataId}},o=!0,a=!1,s=void 0;try{for(var l,u=this.queries[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=i(l.value);if("object"===(void 0===c?"undefined":r(c)))return c.v}}catch(t){a=!0,s=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}return!1},this.reader=function(t,e,n){var r=this,o=t.grouping?a.clone(t,null,["grouping"]):t;return new function(){var s=this;this.defer=n,this.query=t,this.parsers=e,this.dataId=null,r.readerObject.read(o,this.parsers).then(function(e){s.checkQueryResponse(t,e),s.dataId=a.hashCode([o,r.readerObject._basepath]),i._collection[s.dataId]={},i._collectionPromises[s.dataId]={};var n=i._collection[s.dataId];n.data=e,n.valid={},n.nested={},n.unique={},n.limits={},n.frames={},n.haveNoDataPointsPerKey={},n.query=t,s.defer.resolve(s.dataId)}).catch(function(t){s.defer.reject(t)}),this.checkQueryResponse=function(t,e){var i=this;if(0==e.length&&a.warn("Reader for data source '"+this._name+"' returned empty array for query:",JSON.stringify(t,null,2)),e.length>0){for(var n=(t.select.key||[]).concat(t.select.value||[]),r=e.length-1;r>=0;r--){for(var o=n.length-1;o>=0;o--)(e[r][n[o]]||0===e[r][n[o]])&&n.splice(o,1);if(!n.length)break}n.forEach(function(n){if(-1==t.select.key.indexOf(n))a.warn("Reader result: Column '"+n+"' is missing from '"+t.from+"' data, but it might be ok");else{a.error("Reader result: Key column '"+n+"' is missing from '"+t.from+"' response",JSON.stringify(t));var r=new Error;r.name="reader/error/keyColumnMissingInReaderResult",r.message="Reader result: Key column '"+n+"' is missing from '"+t.from+"' response",r.details=n,r.ddfql=t,i.defer.reject(r),console.log(e)}})}}}}}}},{key:"aggregateData",value:function(t,e,i,n){if(Object.keys(e.grouping).every(function(t){return 1===e.grouping[t].grouping}))return Promise.resolve(t);var r=l(e,i._basepath,i._lastModified,i._name),o=a.hashCode([e,i._basepath]);if(!this._collection[o]||this._collection[o]._queryMergeId!==r){for(var s=e.grouping=e.grouping,u=e.select.key,c=e.select.value.filter(function(t){return"measure"===n[t].concept_type}),h="datapoints"===e.from?u.concat(e.animatable):u.slice(0),d=Object.keys(s||{}).filter(function(t){return-1!==h.indexOf(t)&&-1!==u.indexOf(t)&&s[t].grouping>1}),f=d.reduce(function(t,e){return i=s[e].grouping,t[e]=function(t){return~~(+t/i)*i},t;var i},{}),p=d3.nest(),m=0;m<h.length;m++)p=p.key(function(t,e){return e?function(i){return e(i[t])}:function(e){return e[t]}}(h[m],f[h[m]]));d.length&&(p=p.rollup(function(t){var e=Object.assign({},t[0]);return d.forEach(function(t){return e[t]=f[t](e[t])}),c.forEach(function(i){return e[i]=d3.sum(t,function(t){return+t[i]})}),[e]})),this._collection[o]={},this._collectionPromises[o]={};var v=this._collection[o];v.data=a.nestArrayToValues(p.entries(this._collection[t].data)),v.valid={},v.nested={},v.unique={},v.limits={},v.frames={},v.haveNoDataPointsPerKey={},v.query=e,v._queryMergeId=r}return Promise.resolve(o)}},{key:"getData",value:function(t,e,i,n){if(!e||"data"==e)return this._collection[t].data;if("query"==e)return this._collection[t].query;if(!i)return this._collection[t][e];var r="string"==typeof i?i:JSON.stringify(i);if(this._collection[t][e][r])return this._collection[t][e][r];switch(e){case"unique":this._collection[t][e][r]=this._getUnique(t,i);break;case"valid":this._collection[t][e][r]=this._getValid(t,i);break;case"limits":this._collection[t][e][r]=this._getLimits(t,i);break;case"nested":this._collection[t][e][r]=this._getNested(t,i)}return this._collection[t][e][r]}},{key:"_getValid",value:function(t,e){return this._collection[t].data.filter(function(t){return t[e]||0===t[e]})}},{key:"_getLimits",value:function(t,e){for(var i=this._collection[t].data.reduce(function(t,i){var n=a.isDate(i[e])?i[e]:parseFloat(i[e]);return isNaN(n)||t.push(n),t},[]),n=void 0,r=void 0,o={},s=0;s<i.length;s+=1){var l=i[s];(void 0===n||l<n)&&(n=l),(void 0===r||l>r)&&(r=l)}return o.min=n||0,o.max=r||100,o}},{key:"_getUnique",value:function(t,e){var i=void 0,n=this._collection[t].data;if(a.isArray(e)){var r=n.map(function(t){return a.clone(t,e)});i=a.unique(r,function(t){return JSON.stringify(t)})}else{var o=n.map(function(t){return t[e]});i=a.unique(o)}return i}},{key:"_getNested",value:function(t,e){for(var i=d3.nest(),n=0;n<e.length;n++)i=i.key(function(t){return function(e){return e[t]}}(e[n]));return a.nestArrayToObjWithFlatKeys(i.entries(this._collection[t].data))}},{key:"getFrames",value:function(t,e,i,n){var r=this,o=u(0,e,i);return this._collectionPromises[t][o]||(this._collectionPromises[t][o]={queue:this.framesQueue(e,o),promise:null}),this._collectionPromises[t][o]&&this._collectionPromises[t][o].promise instanceof Promise?this._collectionPromises[t][o].promise:(this._collectionPromises[t][o].promise=new Promise(function(s,l){t||l(a.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)),r._getFrames(t,o,e,i,n).then(function(e){r._collection[t].frames[o]=e,s(r._collection[t].frames[o])})}),this._collectionPromises[t][o].promise)}},{key:"getFrame",value:function(t,e,i,n){var r=this,o=u(0,e,n);return new Promise(function(e,n){r._collection[t].frames[o]&&r._collection[t].frames[o][i]?e(r._collection[t].frames[o]):r._collectionPromises[t][o].queue.forceFrame(i,function(){e(r._collection[t].frames[o])})})}},{key:"listenFrame",value:function(t,e,i,n){var r=u(0,e,i);this._collectionPromises[t][r].queue.defaultCallbacks.push(function(e){n(t,e)}),this._collection[t].frames[r]&&a.forEach(this._collection[t].frames[r],function(e,i){n(t,new Date(i))})}},{key:"_muteAllQueues",value:function(t){a.forEach(this._collectionPromises,function(e,i){a.forEach(e,function(e,i){1==e.queue.isActive&&e.queue.whatId!=t&&e.queue.mute()})})}},{key:"_checkForcedQueuesExists",value:function(){a.forEach(this._collectionPromises,function(t,e){a.forEach(t,function(t,e){t.queue.forcedQueue.length>0&&t.queue.unMute()})})}},{key:"_unmuteQueue",value:function(){a.forEach(this._collectionPromises,function(t,e){a.forEach(t,function(t,e){0==t.queue.isActive&&t.queue.unMute()})})}},{key:"framesQueue",value:function(t,e){var i=this;return new function(){this.defaultCallbacks=[],this.callbacks={},this.forcedQueue=[],this.isActive=!0,this.delayedAction=null,this.whatId=e,this.queue=t.slice(0);var n=this;this.queue.splice(0,0,this.queue.splice(this.queue.length-1,1)[0]),this.key=0,this.mute=function(){this.isActive=!1,this.delayedAction=Promise.resolve.bind(Promise)},this.unMute=function(){this.isActive=!0,"function"==typeof this.delayedAction&&this.delayedAction(),this.delayedAction=null,0==this.forcedQueue.length&&0==this.queue.length&&i._unmuteQueue()},this.frameComplete=function(t){var e=void 0;if(n.defaultCallbacks.length>0)for(e=0;e<n.defaultCallbacks.length;e++)n.defaultCallbacks[e](t);if(n.callbacks[t]&&n.callbacks[t].length>0)for(e=0;e<n.callbacks[t].length;e++)n.callbacks[t][e]()},this._waitingForActivation=function(){var t=this;return new Promise(function(e,i){if(t.isActive)return e();t.delayedAction=e})},this._getNextFrameName=function(){var t=null;return this.forcedQueue.length>0||this.queue.length>0?this.forcedQueue.length>0?t=this.forcedQueue.shift():(0==this.forcedQueue.length&&this.key>=this.queue.length-1&&(this.key=0),t=this.queue.splice(this.key,1).pop()):i._unmuteQueue(),t},this.checkForcedFrames=function(){this.forcedQueue.length>0||i._checkForcedQueuesExists()},this.getNext=function(){var t=this;return new Promise(function(e,i){t.checkForcedFrames(),t.isActive?e(t._getNextFrameName()):t._waitingForActivation().then(function(){e(t._getNextFrameName())})})},this.forceFrame=function(t,e){if(this.callbacks[t])this.callbacks[t].push(e);else{var n=function(t,e){for(var i=e.toString(),n=-1,r=0,o=t.length;r<o;r++)if(t[r].toString()==i){n=r;break}return n}(this.queue,t);-1!==n?(this.forcedQueue.unshift(this.queue.splice(n,1).pop()),i._muteAllQueues(this.whatId),this.unMute(),"function"==typeof e&&("object"!==r(this.callbacks[t])&&(this.callbacks[t]=[]),this.callbacks[t].push(e)),this.key=n):"object"===r(this.callbacks[t])?this.callbacks[t].push(e):this.callbacks[t]=[e]}}}}},{key:"_getFrames",value:function(t,e,i,n,r){var o=this;return o._collection[t].frames[e]||(o._collection[t].frames[e]={}),new Promise(function(s,l){r||a.warn("_getFrames in data.js is missing indicatorsDB, it's needed for gap filling"),i||a.warn("_getFrames in data.js is missing framesArray, it's needed so much");var u=o._collection[t].query.animatable,c=o._collection[t].query.select.key.slice(0);u&&-1!=c.indexOf(u)&&c.splice(c.indexOf(u),1);var h={},d=void 0,f=void 0,p=void 0,m=void 0,v=void 0,g=o.getData(t,"nested",c.concat([u]),r),y=Object.keys(g);n=n||y.map(function(t){return JSON.parse(t).join(",")});var _=o._collection[t].query,b=_.select.value.filter(function(t){return"_default"!==t}),x=b.length,w=void 0,S=void 0,M=void 0,E=void 0,z=void 0;for(M=0;M<n.length;M++)for(h[n[M]]={},z=0;z<x;z++)h[n[M]][b[z]]=null;for(z=0;z<x;z++)o._collection[t].haveNoDataPointsPerKey[b[z]]={};o._collectionPromises[t][e].queue.getNext().then(function(i){i&&function t(i,n,l,k){var T={};if("datapoints"!==_.from){var O=o._collection[l].data;for(z=0;z<x;z++)T[b[z]]={};for(var C=0;C<O.length;C++){var P=O[C];for(z=0;z<x;z++)T[b[z]][P[c[0]]]=P[b[z]],null==P[b[z]]&&(o._collection[l].haveNoDataPointsPerKey[b[z]][JSON.stringify([P[c[0]]])]=O.length)}}else{for(z=0;z<x;z++)T[b[z]]={};for(M=0;M<n.length;M++)for(w=n[M],S=y[M],z=0;z<x;z++)if(E=b[z],m=r[E]?r[E].interpolation:null,g[S]&&g[S][i]&&(g[S][i][0][E]||0===g[S][i][0][E]))T[E][w]=g[S][i][0][E];else if("none"===m)T[E][w]=null;else{if(null===(d=h[w][E])){var A=Object.keys(g[S]);d=new Array(A.length),f=0;for(var I=0,L=A.length;I<L;I++)((p=g[S][A[I]])[0][E]||0===p[0][E])&&(d[f++]=p[0]);d.length=f,h[w][E]=0===f?[]:d,0==d.length&&(o._collection[l].haveNoDataPointsPerKey[E][S]=d.length)}d&&d.length>0&&(v=null,T[E][w]=a.interpolatePoint(d,void 0,E,v,u,i,m))}}o._collection[l].frames[e][i]=T,"function"==typeof k&&k(i),o._collectionPromises[l][e].queue.getNext().then(function(i){i?a.defer(function(){t(i,n,l,o._collectionPromises[l][e].queue.frameComplete)}):s(o._collection[l].frames[e])})}(i,n,t,o._collectionPromises[t][e].queue.frameComplete)})})}}]),t}();e.DataStorage=new c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1));function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var o={model:null,dimensionModels:new Map,updateDimensionModels:function(){var t=this;this.dimensionModels.clear(),n.forEach(this.model.state._data,function(e,i){void 0!==e.dim&&t.dimensionModels.set(i,e)})},getDimensionModelsForSpace:function(t,e){var i=this;this.updateDimensionModels();var n=[],o=Object.keys(t).reduce(function(i,r){return"entities"==t[r]._type&&(e.includes(t[r].dim)?i[t[r].dim]=r:n.push(r)),i},{});return e.map(function(e,a){var s=void 0;if(i.model.dataManager.isConceptType(e,"time"))t[s="time"].dim=e;else{if(o[e])return o[e];if(void 0!==(s=n.shift()))t[s].setDimension(e);else{var l=r({},s="entities_"+e,{dim:e});i.model.state.set(l)}}return s})}};e.default=function(t){var e=Object.create(o);return e.model=t,e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1));var r={model:null,dataModels:new Map,getDataModels:function(){return this.updateDataModels(),this.dataModels},updateDataModels:function(){var t=this;this.dataModels.clear(),n.forEach(this.model._data,function(e,i){"data"==e._type&&t.dataModels.set(i,e)})},isConceptType:function(t,e){this.updateDataModels();var i=!0,n=!1,r=void 0;try{for(var o,a=this.dataModels.values()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;if(s.conceptDictionary[t]&&s.conceptDictionary[t].concept_type==e)return!0}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return!1},getConceptProperty:function(t,e){this.updateDataModels();var i=!0,n=!1,r=void 0;try{for(var o,a=this.dataModels.values()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value.getConceptprops(t);if(s&&s[e])return s[e]}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return"Concept not found"},getAvailableDataForKey:function(t,e,i){this.updateDataModels();var n=[],r=!0,o=!1,a=void 0;try{for(var s,l=this.dataModels.values()[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value,c=!0,h=!1,d=void 0;try{for(var f,p=((u.dataAvailability||{})[i]||[])[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var m=f.value,v=m.key,g=m.value;!v.has(t)||e&&g!==e||n.push({data:u._name,key:t,value:g})}}catch(t){h=!0,d=t}finally{try{!c&&p.return&&p.return()}finally{if(h)throw d}}}}catch(t){o=!0,a=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}return n},getDimensionValues:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({select:{key:[t],value:e},from:"entities"},i);return Promise.all([].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(this.getDataModels().values())).filter(function(e){return e.getConceptprops(t)}).map(function(t){return t.load(n,void 0,!0).then(function(e){return t.getData(e)})}))}};e.default=function(t){var e=Object.create(r);return e.model=t,e}},function(t,e,i){var n={"./csv-time_in_columns/csv-time_in_columns.js":398,"./csv/csv.js":159,"./inline/inline.js":400};function r(t){return i(o(t))}function o(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(n)},r.resolve=o,t.exports=r,r.id=397},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(159),a=(n=o)&&n.__esModule?n:{default:n},s=i(1);function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var u=a.default.extend({MISSED_INDICATOR_NAME:"indicator",_name:"csv-time_in_columns",init:function(t){this._super(t),this.timeKey="time",Object.assign(this.ERRORS,{REPEATED_KEYS:"reader/error/repeatedKeys"})},load:function(t){var e=this;return this._super().then(function(i){var n=i.rows,o=i.columns,a=t[e.timeKey]&&!!t[e.timeKey](o[e.keySize]);a&&(0,s.warn)("Indicator column is missed.");var u=a?e.MISSED_INDICATOR_NAME:o[e.keySize],c=o.slice(0,e.keySize).concat(a?(0,s.capitalize)(e.MISSED_INDICATOR_NAME):n.reduce(function(t,e){var i=e[u];return!t.includes(i)&&i&&t.push(i),t},[]));c.splice(e.keySize,0,e.timeKey);var h=c.slice(e.keySize+1),d=r(c,1)[0];return{columns:c,rows:n.reduce(function(t,i){var n=t.filter(function(t){return t[d]===i[d]});if(n.length){if(null!==n[0][i[u]])throw e.error(e.ERRORS.REPEATED_KEYS,void 0,{indicator:i[u],key:i[d]});n.forEach(function(t){t[i[u]]=i[t[e.timeKey]]})}else Object.keys(i).forEach(function(n){if(![d,u].includes(n)){var r,o=(l(r={},d,i[d]),l(r,e.timeKey,n),r),s=h.reduce(function(t,e){return t[e]=a||i[u]===e?i[n]:null,t},{});t.push(Object.assign(o,s))}});return t},[])}})},versionInfo:{version:"0.32.3",build:1524665300706}});e.default=u},function(t,e){(function(){var e,i,n;n=[],e={},t.exports=i=function(t,i,r){var o,a,s,l,u,c,h,d;if(null==r&&(r=!0),"string"==typeof i){if(2!==i.length)throw{name:"ArgumentException",message:"The format for string options is '<thousands><decimal>' (exactly two characters)"};d=i[0],o=i[1]}else if(Array.isArray(i)){if(2!==i.length)throw{name:"ArgumentException",message:"The format for array options is ['<thousands>','[<decimal>'] (exactly two elements)"};d=i[0],o=i[1]}else d=(null!=i?i.thousands:void 0)||(null!=i?i.group:void 0)||e.thousands,o=(null!=i?i.decimal:void 0)||e.decimal;return null==(u=n[c=""+d+o+r])&&(s=r?3:1,u=n[c]=new RegExp("^\\s*([+-]?(?:(?:\\d{1,3}(?:\\"+d+"\\d{"+s+",3})+)|\\d*))(?:\\"+o+"(\\d*))?\\s*$")),null==(h=t.match(u))||3!==h.length?NaN:(l=h[1].replace(new RegExp("\\"+d,"g"),""),a=h[2],parseFloat(l+"."+a))},t.exports.setOptions=function(t){var i,n;for(i in t)n=t[i],e[i]=n},t.exports.factoryReset=function(){e={thousands:",",decimal:"."}},t.exports.withOptions=function(t,e){return null==e&&(e=!0),function(n){return i(n,t,e)}},t.exports.factoryReset()}).call(this)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(75);var o=((n=r)&&n.__esModule?n:{default:n}).default.extend({_name:"inline",init:function(t){this._data=t.data||[{}]},load:function(){return Promise.resolve({columns:Object.keys(this._data[0]),rows:this._data})},versionInfo:{version:"0.32.3",build:1524665300706}});e.default=o},function(t,e,i){var n={"./brushslider/brushslider.js":77,"./brushslider/bubblesize/bubblesize.js":160,"./brushslider/singlehandleslider/singlehandleslider.js":59,"./brushslider/sizeslider/sizeslider.js":161,"./buttonlist/buttonlist.js":162,"./buttonlist/optionsbuttonlist/optionsbuttonlist.js":163,"./colorlegend/colorlegend.js":164,"./datanotes/datanotes.js":403,"./datawarning/datawarning.js":404,"./dialogs/_dialog.js":12,"./dialogs/about/about.js":167,"./dialogs/axes/axes.js":168,"./dialogs/colors/colors.js":170,"./dialogs/dialogs.js":171,"./dialogs/find/find.js":172,"./dialogs/find/show.js":112,"./dialogs/grouping/grouping.js":173,"./dialogs/label/label.js":174,"./dialogs/moreoptions/moreoptions.js":175,"./dialogs/opacity/opacity.js":176,"./dialogs/presentation/presentation.js":177,"./dialogs/side/side.js":178,"./dialogs/size/size.js":179,"./dialogs/speed/speed.js":180,"./dialogs/stack/stack.js":181,"./dialogs/timedisplay/timedisplay.js":183,"./dialogs/zoom/zoom.js":185,"./draggablelist/draggablelist.js":182,"./indicatorpicker/indicatorpicker.js":50,"./minmaxinputs/minmaxinputs.js":169,"./simplecheckbox/simplecheckbox.js":60,"./steppedspeedslider/steppedspeedslider.js":422,"./timeslider/timeslider.js":424,"./treemenu/treemenu.js":426,"./zoombuttonlist/zoombuttonlist.js":186};function r(t){return i(o(t))}function o(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(n)},r.resolve=o,t.exports=r,r.id=401},function(t,e){t.exports='<div class="vzb-slider-holder">\n\t<svg class="vzb-slider-svg">\n\t\t<g class="vzb-slider-wrap">\n\t\t\t<g class="vzb-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),o=i(6),a=(n=o)&&n.__esModule?n:{default:n},s=i(21);var l=a.default.extend({init:function(t,e){var i=this;this.name="gapminder-datanotes",this.model_expects=[{name:"marker",type:"marker"},{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i._readyOnce&&i.ready()}},this._super(t,e),this.close=this.close.bind(this),this.hidden=!0,this.showNotes=!1,this.pinned=!1,this.left=0,this.top=0,this.hookName=null,this.newHookName=null},ready:function(){this.setValues()},readyOnce:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.element=d3.select(this.placeholder),this.element.selectAll("div").remove();var e=this.element;e.append("div").html(s.close).on("click",function(){d3.event.stopPropagation(),t.close()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),e.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),e.append("div").attr("class","vzb-data-notes-link")},resize:function(){this.close()},close:function(){this.hidden||this.pin(!1).hide()},setHook:function(t){return this._readyOnce?this.pinned?(this.newHookName=t,this):(this.hookName&&this.model.marker[this.hookName].off("change:which",this.close),this.hookName=this.newHookName=t,this.model.marker[this.hookName].on("change:which",this.close),this.setValues(),this):this},setValues:function(){if(this.hookName){var t=this.model.marker[this.hookName].getConceptprops();if(this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!t.description).text(r.replaceNumberSpacesToNonBreak(t.description)||""),this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!t.sourceLink),t.sourceLink){var e=this.translator("hints/source"),i=t.sourceName||"";this.element.select(".vzb-data-notes-link").html("<span>"+(i?e+":":"")+'<a href="'+t.sourceLink+'" target="_blank">'+(i||e)+"</a></span>")}this.showNotes=t.sourceLink||t.description}},setPos:function(t,e,i){if(this.left=t,this.top=e,this.pinned&&!i)return this;var n=this.parent.element.offsetHeight,r=this.element.node().offsetWidth,o=this.element.node().offsetHeight,a=void 0,s=void 0,l=this.left-r,u=this.top;return l<10&&(l=10,a=!0),u+o+10>n&&(u=n-o-10,s=!0),a&&s&&(u=this.top-o-30),this.element.style("top",u+"px"),this.element.style("left",l+"px"),this},pin:function(t){return this.hidden?this:(this.pinned=!this.pinned,null!=t&&(this.pinned=t),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!this.pinned),this.element.classed("vzb-data-notes-pinned",this.pinned),this.hookName!=this.newHookName&&this.setHook(this.newHookName),this.element.select(".vzb-data-notes-body").node().scrollTop=0,this.showNotes?this.setPos(this.left,this.top,!0):this.hide())},toggle:function(t){return this.pinned||!this.hookName?this:(null==t&&(t=!this.hidden),this.hidden=t,this.element.classed("vzb-hidden",this.hidden||!this.showNotes),this)},show:function(){return this.toggle(!1)},hide:function(){return this.toggle(!0)}});e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);e.default=t}(i(1));var n,r=i(6),o=(n=r)&&n.__esModule?n:{default:n},a=i(21);var s=!0,l=o.default.extend({init:function(t,e){var i=this;this.name="gapminder-datawarning",this.model_expects=[{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i.redraw()}},this._super(t,e)},ready:function(){this.redraw()},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.element.append("div").attr("class","vzb-data-warning-background").on("click",function(){t.toggle(!0)}),this.container=this.element.append("div").attr("class","vzb-data-warning-box"),this.container.append("div").html(a.close).on("click",function(){t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close"),this.container.append("div").attr("class","vzb-data-warning-link").html(a.warn).append("div"),this.container.append("div").attr("class","vzb-data-warning-title"),this.container.append("div").attr("class","vzb-data-warning-body vzb-dialog-scrollable")},redraw:function(){this.translator=this.model.locale.getTFunction(),this.container.select(".vzb-data-warning-link div").text(this.translator("hints/dataWarning"));var t=this.translator("datawarning/title/"+this.parent.name);this.container.select(".vzb-data-warning-title").html(t).classed("vzb-hidden",!t||t=="datawarning/title/"+this.parent.name),this.container.select(".vzb-data-warning-body").html(this.translator("datawarning/body/"+this.parent.name))},toggle:function(t){null==t&&(t=!s),s=t,this.element.classed("vzb-hidden",s);var e=this;this.parent.components.forEach(function(t){t.element.classed("vzb-blur",t!=e&&!s)})}});e.default=l},function(t,e,i){var n={"./about/about.html":406,"./axes/axes.html":407,"./colors/colors.html":408,"./find/find.html":409,"./find/show.html":166,"./grouping/grouping.html":410,"./label/label.html":411,"./moreoptions/moreoptions.html":412,"./opacity/opacity.html":413,"./presentation/presentation.html":414,"./side/side.html":415,"./size/size.html":416,"./speed/speed.html":417,"./stack/stack.html":418,"./timedisplay/timedisplay.html":419,"./zoom/zoom.html":420};function r(t){return i(o(t))}function o(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(n)},r.resolve=o,t.exports=r,r.id=405},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/about") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-about-text0"></p>\n      <p class="vzb-about-text1"></p>\n      <br/>\n      <p class="vzb-about-version"></p>\n      <p class="vzb-about-updated"></p>\n      <br/>\n      <p class="vzb-about-report"></p>\n      <br/>\n      <p class="vzb-about-credits"></p>\n      <br/>\n      <p class="vzb-about-tool"></p>\n      <br/>\n      <p class="vzb-about-datasets"><span>Datasets:</span></p>\n      <br/>\n      <p class="vzb-about-readers"><span>Readers:</span></p>\n  </div>\n      \n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n      \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/axes") %></div>\n    <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_x") %> <span class="vzb-xaxis-selector"></span> </p>\n      <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div>\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_y") %> <span class="vzb-yaxis-selector"></span> </p>\n      <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div>\n    </div>\n    <div class="vzb-dialog-buttons">\n      <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ( "buttons/ok") %></div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n  \n  <div class="vzb-dialog-title">\n      <%=t ("buttons/colors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n  \n  \n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <label class="vzb-dialog-title-switch">\n      <input type="checkbox">\n      <span class="vzb-switch-slider round"></span>\n      <span class="vzb-switch-off"><%=t ("dialogs/find") %></span>\n      <span class="vzb-switch-on"><%=t ("buttons/show") %></span>\n    </label>\n    <span class="vzb-dialog-content vzb-find-filter">\n      <form>\n        <input class="vzb-find-search" type="search" required/>\n        <button class="vzb-cancel-button" type="reset"></button>\n      </form>\n    </span>\n    <span class="vzb-find-filter-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n      <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-find vzb-active">\n        <div class="vzb-find-list">\n          \x3c!-- list will be placed here --\x3e\n        </div>\n      </div>\n\n      <div class="vzb-dialog-content vzb-dialog-scrollable vzb-dialog-panel vzb-dialog-panel-show">\n      </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-bubbleopacity vzb-dialog-control" data-panel="find"></div>\n    <div class="vzb-dialog-button vzb-find-deselect" data-panel="find">\n      <%=t ("buttons/deselect") %>\n    </div>\n    <div class="vzb-dialog-button vzb-show-deselect" data-panel="show">\n      <%=t ("buttons/reset") %>\n    </div>\n    <div class="vzb-dialog-button vzb-show-apply" data-panel="show">\n      <%=t ("buttons/apply") %>\n    </div>\n      \n    <div data-dialogtype="find" data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>  \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/grouping") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-groups"></div>\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/label") %>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <span class="vzb-saxis-selector"></span>\n    <div class="vzb-dialog-sizeslider"></div>\n    <div class="vzb-removelabelbox-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span>\n\n\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/more_options") %>\n  </div>\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class=\'vzb-dialog-options-buttonlist\'>\n    </div>\n    <div class="vzb-accordion">\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/opacity") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityRegular") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-regular"></div>\n\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityNonselect") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-selectdim"></div>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("dialogs/presentation") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <div class="vzb-presentationmode-switch"></div>\n      <div class="vzb-decorations-switch"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="side" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="side" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/side") %>\n    <span class="vzb-side-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-side-list vzb-side-list-left">\n      \x3c!-- list will be placed here --\x3e\n    </div>\n    <div class="vzb-side-list vzb-side-list-right">\n      \x3c!-- list will be placed here --\x3e\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-label-primary vzb-side-switch-sides">\n      <%=t ("buttons/leftright") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/size") %>\n      <span class="vzb-saxis-selector"></span>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-bubblesize"></div>\n    <span class="vzb-dialog-subtitle">teststs</span>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/speed") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="stack" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="stack" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/stack") %></div>\n        \n    <div class="vzb-dialog-content vzb-dialog-scrollable">\n        \n        \x3c!--p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/howtostack") %></p--\x3e\n        <form class="vzb-howtostack vzb-dialog-paragraph">\n            <label> <input type="radio" name="stack" value="none"> <%=t ("mount/stacking/none") %> </label>\n            <label> <input type="radio" name="stack" value="bycolor"> <%=t ("mount/stacking/color") %> </label>\n            <label> <input type="radio" name="stack" value="all"> <%=t ("mount/stacking/world") %> </label>\n        </form>\n        \n        <form class="vzb-howtomerge vzb-dialog-paragraph">\n            <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/howtomerge") %> </p>\n            <label> <input type="radio" name="merge" value="none"> <%=t ("mount/merging/none") %> </label>\n            <label> <input type="radio" name="merge" value="grouped"> <%=t ("mount/merging/color") %> </label>\n            <label> <input type="radio" name="merge" value="stacked"> <%=t ("mount/merging/world") %> </label>\n        </form>\n        \n        <form class="vzb-manual-sorting">\n            <p class="vzb-dialog-sublabel"> <%=t ("mount/manualSorting") %> </p>\n            <div class="vzb-dialog-draggablelist vzb-dialog-control"></div>\n        </form>\n                \n    </div>\n\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ("buttons/ok") %></div>\n    </div>\n\n</div>'},function(t,e){t.exports='<div class="vzb-dialog-modal">\n  <div class="vzb-dialog-content vzb-dialog-content-fixed">\n    <svg>\n      <g class="vzb-timedisplay"></g>\n    </svg>\n  </div>\n  <div class="vzb-dialog-buttons"></div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n    <%=t ("buttons/zoom") %>\n    <div class="vzb-dialog-zoom-buttonlist"></div>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-panwitharrow-switch"></div>\n    <div class="vzb-zoomonscrolling-switch"></div>\n    <div class="vzb-adaptminmaxzoom-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class="vzb-mmi-holder">\n\n    <span class="vzb-mmi-domainmin-label"></span>\n    <input type="text" class="vzb-mmi-domainmin" name="min">\n    <span class="vzb-mmi-domainmax-label"></span>\n    <input type="text" class="vzb-mmi-domainmax" name="max">\n\n    <br class="vzb-mmi-break"/>\n\n    <span class="vzb-mmi-zoomedmin-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmin" name="min">\n    <span class="vzb-mmi-zoomedmax-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmax" name="max">\n    \n</div>'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(6),o=(n=r)&&n.__esModule?n:{default:n},a=i(1);var s=o.default.extend({init:function(t,e){var n=this;this.name="steppedSpeedSlider",this.template=i(423),this.config=Object.assign({triangleWidth:10,triangleHeight:10,height:31,lineWidth:10,domain:[1,2,3,4,5,6],range:[1200,900,450,200,150,100]},t),this.config.height-=this.config.triangleHeight/2,this.model_expects=[{name:"time",type:"time"},{name:"locale",type:"locale"}],this.model_binds={"change:time.delay":function(){n.redraw()}},this.setDelay=(0,a.throttle)(this.setDelay,50),this._super(t,e)},readyOnce:function(){var t=this.config,e=t.domain,i=t.range,n=t.height;this.element=d3.select(this.element),this.svg=this.element.select("svg"),this.axisScale=d3.scaleLog().domain(d3.extent(e)).range([n,0]),this.delayScale=d3.scaleLinear().domain(e).range(i),this.initTriangle(),this.initAxis(),this.redraw()},initAxis:function(){var t=this,e=this.config,i=e.lineWidth,n=e.triangleWidth,r=e.triangleHeight,o=e.height,s=d3.axisLeft().scale(this.axisScale).tickFormat(function(){return""}).tickSizeInner(i).tickSizeOuter(0),l=n+i/2,u=r/2;this.svg.on("mousedown",function(){var e=d3.event.offsetY,i=Math.max(0,Math.min(e-u,o));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(i))),!0,!0)}).select(".vzb-stepped-speed-slider-axis").attr("transform","translate("+l+", "+u+")").call(s),this.drag=d3.drag().on("drag",function(){var e=d3.event.dy,i=(0,a.transform)(t.slide.node()).translateY,n=Math.max(0,Math.min(e+i,o));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(n)))),t.redraw(n)}).on("end",function(){t.setDelay(t.model.time.delay,!0,!0)}),this.svg.call(this.drag)},initTriangle:function(){var t=this.config;t.triangleWidth,t.triangleHeight,t.lineWidth;this.slide=this.svg.select(".vzb-stepped-speed-slider-triangle"),this.slide.append("g").append("path").attr("d",this.getTrianglePath())},getTrianglePath:function(){var t=this.config,e=t.triangleHeight;return"M "+t.triangleWidth+","+e/2+" 0,"+e+" 0,0 z"},setDelay:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.model.time.set("delay",t,e,i)},redraw:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.axisScale(this.delayScale.invert(this.model.time.delay));this.slide.attr("transform","translate(0, "+t+")")}});e.default=s},function(t,e){t.exports='<div class="vzb-stepped-speed-slider">\n  <svg>\n    <g class="vzb-stepped-speed-slider-triangle"></g>\n    <g class="vzb-stepped-speed-slider-axis"></g>\n  </svg>\n</div>\n'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=a(i(6)),o=a(i(111));function a(t){return t&&t.__esModule?t:{default:t}}var s={small:{margin:{top:7,right:15,bottom:10,left:60},radius:8,label_spacing:5},medium:{margin:{top:0,right:15,bottom:10,left:50},radius:9,label_spacing:5},large:{margin:{top:-5,right:15,bottom:10,left:75},radius:11,label_spacing:8}},l={medium:{margin:{top:9}},large:{margin:{}}},u=r.default.extend({init:function(t,e){this.name="gapminder-timeslider",this.template=this.template||i(425),this.prevPosition=null,this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"marker"},{name:"ui",type:"ui"}];var r=this;this.model_binds={"change:time":function(t,e){if(r.slide){if(-1!==["time.start","time.end"].indexOf(e)){if(!r.xScale)return;r.changeLimits()}r._optionClasses(),r.model.time.dragging||r._setHandle(r.model.time.playing)}},"change:time.start":function(t,e){r.slide&&(r.model.time.dragging||r._setHandle(r.model.time.playing),r.ready())},"change:time.end":function(t,e){r.slide&&(r.model.time.dragging||r._setHandle(r.model.time.playing),r.ready())},"change:time.offset":function(t,e){r.slide&&(r._updateProgressBar(),r.model.marker.listenFramesQueue(null,function(t){r._updateProgressBar(t)}))},"change:time.startSelected":function(t,e){r.slide&&r.updateSelectedStartLimiter()},"change:time.endSelected":function(t,e){r.slide&&r.updateSelectedEndLimiter()},"change:marker.select":function(t,e){r.setSelectedLimits()},"dataLoaded:marker":function(){r.availableTimeFrames=[[r.model.time.startSelected||r.model.time.start,r.model.time.endSelected||r.model.time.end]],r._updateProgressBar(!0)}},this._super(t,e),this.profiles=n.deepClone(s),this.presentationProfileChanges=n.deepClone(l),(this.model.ui.chart||{}).margin&&this.model.on("change:ui.chart.margin",function(t,e){var i=r.getLayoutProfile();"small"!==i&&(r.profiles[i].margin.left=r.model.ui.chart.margin.left);r.slide&&r.updateSize()}),this.ui=n.extend({show_ticks:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,axis_aligned:!1},t.ui.getPlainObject(),this.ui),this.width=0,this.height=0,this.availableTimeFrames=[],this.completedTimeFrames=[],this.getValueWidth=n.memoize(this.getValueWidth),this._setTime=n.throttle(this._setTime,50)},readyOnce:function(){var t=this;this.element=n.isArray(this.element)?this.element:d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.select=this.element.select(".vzb-ts-slider-select"),this.progressBar=this.element.select(".vzb-ts-slider-progress"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.element.select(".vzb-ts-slider-handle"),this.valueText=this.element.select(".vzb-ts-slider-value"),this.playButtons=this.element.select(".vzb-ts-btns"),this.element.select(".vzb-ts-btn-play").on("click",function(){t.model.time.play()}),this.element.select(".vzb-ts-btn-pause").on("click",function(){t.model.time.pause("soft")}),this.xScale=d3.scaleUtc().clamp(!0),this.xAxis=(0,o.default)("bottom"),this.valueText.classed("stroke",!0),this.slider.style("paint-order").length||(this.slider.insert("text",".vzb-ts-slider-value").attr("class","vzb-ts-slider-value stroke"),this.valueText.classed("stroke",!1)),this.valueText=this.element.selectAll(".vzb-ts-slider-value"),this.valueText.attr("text-anchor","middle").attr("dy","-0.7em");var e=t._getBrushed(),i=t._getBrushedEnd();this.brush=d3.drag().on("start drag",function(){e.call(this)}).on("end",function(){i.call(this)}),this.slide.call(this.brush),this.slider_outer.on("mousewheel",function(){if(t.model.time.dragging)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}),this._setSelectedLimitsId=0,this.model.time.startSelected>this.model.time.start&&t.updateSelectedStartLimiter(),this.model.time.endSelected<this.model.time.end&&t.updateSelectedEndLimiter(),this.parent.on("myEvent",function(e,i){var n=t.getLayoutProfile(),r=t.profiles[n];i.profile&&i.profile.margin&&(r.margin=i.profile.margin),t.element.select(".vzb-ts-slider-wrapper").style("right",i.mRight-r.margin.right+"px"),t.updateSize([0,i.rangeMax])}),this.on("resize",function(){t.updateSize()})},ready:function(){if(!this.model.time.splash){var t=this;this.element.classed("vzb-ts-loading",!1),this.changeLimits(),this.changeTime(),this.updateSize(),t._updateProgressBar(),t.model.marker.listenFramesQueue(null,function(e){t._updateProgressBar(e)}),t.setSelectedLimits(!0)}},changeLimits:function(){var t=this.model.time.start,e=this.model.time.end;this.xScale.domain([t,e]),this.xAxis.tickValues([t,e]).tickFormat(this.model.time.getFormatter())},changeTime:function(){this.model.time.value;this._optionClasses()},updateSize:function(t){if(!this.model.time.splash){this.model.time.pause(),this.profile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=parseInt(this.slider_outer.style("width"),10)||0,i=parseInt(this.slider_outer.style("height"),10)||0;if(!i||!e)return n.warn("time slider resize() aborted because element is too small or has display:none");this.width=e-this.profile.margin.left-this.profile.margin.right,this.height=i-this.profile.margin.bottom-this.profile.margin.top;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),this.xScale.range(t||[0,this.width]),this.slide.attr("transform","translate(0,"+this.height/2+")").attr("x1",this.xScale.range()[0]).attr("x2",this.xScale.range()[1]).style("stroke-width",2*this.profile.radius+"px"),this.xAxis=this.xAxis.scale(this.xScale).tickSizeInner(0).tickSizeOuter(0).tickPadding(this.profile.label_spacing).tickSizeMinor(0,0),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.select.attr("transform","translate(0,"+this.height/2+")"),this.progressBar.attr("transform","translate(0,"+this.height/2+")"),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius),this.sliderWidth=this.slider.node().getBoundingClientRect().width,this.resizeSelectedLimiters(),this._resizeProgressBar(),this._setHandle(),this.playButtons.style("width",this.profile.margin.left+"px")}},setSelectedLimits:function(t){var e=this;this._setSelectedLimitsId++;var i=this._setSelectedLimitsId,r=e.model.marker.select;if(0!=r.length){var o=n.unique(this.model.marker._getAllDimensions({exceptType:"time"})),a=[];n.forEach(r,function(t){a.push(e.model.marker.getEntityLimits(n.getKey(t,o)))}),Promise.all(a).then(function(r){if(i==e._setSelectedLimitsId){var o=r.shift(),a=o.min,s=o.max;n.forEach(r,function(t){a-t.min>0&&(a=t.min),s-t.max<0&&(s=t.max)}),e.model.time.set({startSelected:d3.max([a,new Date(e.model.time.start)]),endSelected:d3.min([s,new Date(e.model.time.end)])},t,!1)}})}else e.model.time.set({startSelected:new Date(e.model.time.start),endSelected:new Date(e.model.time.end)},null,!1)},updateSelectedStartLimiter:function(){this.select.select("#clip-start-"+this._id).remove(),this.select.select(".selected-start").remove(),this.model.time.startSelected&&this.model.time.startSelected>this.model.time.start&&(this.select.append("clipPath").attr("id","clip-start-"+this._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-start-"+this._id+")").classed("selected-start",!0),this.resizeSelectedLimiters())},updateSelectedEndLimiter:function(){this.select.select("#clip-end-"+this._id).remove(),this.select.select(".selected-end").remove(),this.model.time.endSelected&&this.model.time.endSelected<this.model.time.end&&(this.select.append("clipPath").attr("id","clip-end-"+this._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-end-"+this._id+")").classed("selected-end",!0),this.resizeSelectedLimiters())},resizeSelectedLimiters:function(){this.select.select(".selected-start").attr("d","M0,0H"+this.xScale(this.model.time.startSelected)),this.select.select("#clip-start-"+this._id).select("rect").attr("x",-this.height/2).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.startSelected)+this.height/2),this.select.select(".selected-end").attr("d","M"+this.xScale(this.model.time.endSelected)+",0H"+this.xScale(this.model.time.end)),this.select.select("#clip-end-"+this._id).select("rect").attr("x",this.xScale(this.model.time.endSelected)).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.end)-this.xScale(this.model.time.endSelected)+this.height/2)},_resizeProgressBar:function(){var t=this;this.progressBar.selectAll("path").each(function(e){d3.select(this).attr("d","M"+t.xScale(e[0])+",0H"+t.xScale(e[1]))})},_updateProgressBar:function(t){var e=this;if(t){if(-1!=e.completedTimeFrames.indexOf(t))return;e.completedTimeFrames.push(t);var i=e.model.time.incrementTime(t),n=e.model.time.decrementTime(t);if(i>e.model.time.end){if(t-e.model.time.end!=0)return;i=t,t=n}if(0==e.availableTimeFrames.length||e.availableTimeFrames[e.availableTimeFrames.length-1][1]<t)e.availableTimeFrames.push([t,i]);else if(i<e.availableTimeFrames[0][0])e.availableTimeFrames.unshift([t,i]);else for(var r=0;r<e.availableTimeFrames.length;r++){if(t-e.availableTimeFrames[r][1]==0){r+1<e.availableTimeFrames.length&&i-e.availableTimeFrames[r+1][0]==0?(e.availableTimeFrames[r][1]=e.availableTimeFrames[r+1][1],e.availableTimeFrames.splice(r+1,1)):e.availableTimeFrames[r][1]=i;break}if(i-e.availableTimeFrames[r][0]==0){e.availableTimeFrames[r][0]=t;break}if(t-e.availableTimeFrames[r][1]>0&&i-e.availableTimeFrames[r+1][0]<0){e.availableTimeFrames.splice(r+1,0,[t,i]);break}}}else e.availableTimeFrames=[],e.completedTimeFrames=[];var o=this.progressBar.selectAll("path").data(e.availableTimeFrames);o.exit().remove(),o.enter().append("path").attr("class","domain").merge(o).each(function(t){d3.select(this).attr("d","M"+e.xScale(t[0])+",0H"+e.xScale(t[1])).classed("rounded",1==e.availableTimeFrames.length)})},getValueWidth:function(t,e){return this.valueText.node().getBoundingClientRect().width},_getBrushed:function(){var t=this;return function(){t.model.time.playing&&t.model.time.set("playing",!1,null,!1),t._optionClasses(),t.element.classed("vzb-ts-dragging",!0);var e=void 0;if(d3.event.sourceEvent){d3.event.sourceEvent.preventDefault(),t.model.time.dragStart();var i=n.roundStep(Math.round(d3.mouse(this)[0]),1);e=t.xScale.invert(i);var r=t.width;i>r?i=r:i<0&&(i=0),t.handle.attr("cx",i),t.valueText.attr("transform","translate("+i+","+t.height/2+")"),t.valueText.text(t.model.time.formatDate(e,"ui"))}e-t.model.time.value!=0&&t._setTime(e)}},_getBrushedEnd:function(){var t=this;return function(){t._setTime.recallLast(),t.element.classed("vzb-ts-dragging",!1),t.model.time.dragStop(),t.model.time.snap()}},_setHandle:function(t){var e=this.model.time.value,i=this.xScale(e);this.element.classed("vzb-ts-disabled",this.model.time.end<=this.model.time.start),null==this.prevPosition&&(this.prevPosition=i);var n=i>this.prevPosition?this.model.time.delayAnimations:0;t?(this.handle.attr("cx",this.prevPosition).transition().duration(n).ease(d3.easeLinear).attr("cx",i),this.valueText.attr("transform","translate("+this.prevPosition+","+this.height/2+")").transition("text").delay(n).text(this.model.time.formatDate(e,"ui")),this.valueText.transition().duration(n).ease(d3.easeLinear).attr("transform","translate("+i+","+this.height/2+")")):(this.handle.interrupt().attr("cx",i),this.valueText.interrupt().interrupt("text").transition("text"),this.valueText.attr("transform","translate("+i+","+this.height/2+")").text(this.model.time.formatDate(e,"ui"))),this.prevPosition=i},_setTime:function(t){var e=!this.model.time.dragging&&!this.model.time.playing;this.model.time.getModelObject("value").set(t,!1,e)},_optionClasses:function(){var t=this.ui.show_ticks,e=this.ui.show_value,i=this.ui.show_value_when_drag_play,n=this.ui.axis_aligned,r=this.ui.show_button&&this.model.time.playable;this.xAxis.labelerOptions({scaleType:"time",removeAllLabels:!t,limitMaxTickNumber:3,showOuter:!1,toolMargin:{left:10,right:10,top:0,bottom:30},fitIntoScale:"optimistic"}),this.element.classed("vzb-ts-hide-play-button",!r),this.element.classed("vzb-playing",this.model.time.playing),this.element.classed("vzb-ts-show-value",e),this.element.classed("vzb-ts-show-value-when-drag-play",i),this.element.classed("vzb-ts-axis-aligned",n)}});e.default=u},function(t,e){t.exports='<div class="vzb-timeslider vzb-ts-loading">\n  <div class="vzb-ts-slider-wrapper">\n    <svg class="vzb-ts-slider">\n      <g>\n        <g class="vzb-ts-slider-axis"></g>\n        <g class="vzb-ts-slider-progress"></g>\n        <g class="vzb-ts-slider-select"></g>\n        <circle class="vzb-ts-slider-handle"></circle>\n        <text class="vzb-ts-slider-value"></text>\n        <line class="vzb-ts-slider-slide"></line>\n      </g>\n      </svg>\n  </div>\n\n  \x3c!-- SVG VIZABI ICONS\n       source: https://github.com/encharm/Font-Awesome-SVG-PNG/ --\x3e\n  <div class="vzb-ts-btns">\n    <button class="vzb-ts-btn-loading vzb-ts-btn">\n      <div class=\'vzb-loader\'></div>\n    </button>\n    <button class="vzb-ts-btn-play vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/>\n      </svg>\n    </button>\n    <button class="vzb-ts-btn-pause vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/>\n      </svg>\n    </button>\n  </div>\n</div>\n'},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=l(i(6)),o=l(i(31)),a=(l(i(32)),l(i(76))),s=i(21);function l(t){return t&&t.__esModule?t:{default:t}}var u={wrapper:"vzb-treemenu-wrap",wrapper_outer:"vzb-treemenu-wrap-outer",background:"vzb-treemenu-background",close:"vzb-treemenu-close",search:"vzb-treemenu-search",list:"vzb-treemenu-list",list_outer:"vzb-treemenu-list-outer",list_item:"vzb-treemenu-list-item",list_item_leaf:"vzb-treemenu-list-item-leaf",leaf:"vzb-treemenu-leaf",leaf_content:"vzb-treemenu-leaf-content",leaf_content_item:"vzb-treemenu-leaf-content-item",leaf_content_item_title:"vzb-treemenu-leaf-content-item-title",leaf_content_item_descr:"vzb-treemenu-leaf-content-item-descr",hasChild:"vzb-treemenu-list-item-children",list_item_label:"vzb-treemenu-list-item-label",list_top_level:"vzb-treemenu-list-top",search_wrap:"vzb-treemenu-search-wrap",isSpecial:"vzb-treemenu-list-item-special",hidden:"vzb-hidden",title:"vzb-treemenu-title",scaletypes:"vzb-treemenu-scaletypes",scaletypesDisabled:"vzb-treemenu-scaletypes-disabled",scaletypesActive:"vzb-treemenu-scaletypes-active",alignYt:"vzb-align-y-top",alignYb:"vzb-align-y-bottom",alignXl:"vzb-align-x-left",alignXr:"vzb-align-x-right",alignXc:"vzb-align-x-center",menuHorizontal:"vzb-treemenu-horizontal",menuVertical:"vzb-treemenu-vertical",absPosVert:"vzb-treemenu-abs-pos-vert",absPosHoriz:"vzb-treemenu-abs-pos-horiz",menuOpenLeftSide:"vzb-treemenu-open-left-side",noTransition:"notransition"},c={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:1,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1},h=o.default.extend({init:function(t,e,i){var n=this;this.parent=t,this.entity=e,this.OPTIONS=i,this.width=this.OPTIONS.MIN_COL_WIDTH,this.direction=this.OPTIONS.MENU_DIRECTION,this._setDirectionClass(),this.menuItems=[];var r=void 0;return this.entity.empty()?this:(this.entity.each(function(){r=d3.selectAll(this.childNodes).filter(function(){return d3.select(this).classed(u.list)})}),r.empty()&&(r=this.entity),e.selectAll("."+u.list_item).filter(function(){return this.parentNode==r.node()}).each(function(){n.addSubmenu(d3.select(this))}),!this.menuItems.length&&this.isActive()&&this.buildLeaf(),this)},setWidth:function(t,e,i){if(this.width!=t&&this.entity.node()){if(this.width=t,(this.entity.classed(u.list_top_level)||this.entity.classed("active"))&&1==this.direction&&(i?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(u.list_top_level)&&this.entity.selectAll("."+u.leaf).style("width",this.width-1+"px"),e)for(var n=0;n<this.menuItems.length;n++)this.menuItems[n].setWidth(this.width,e,i);return this}},setDirection:function(t,e){if(this.direction=t,this.entity.style("width","").style("height",""),e)for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].setDirection(this.direction,e);return this._setDirectionClass(),this},_setDirectionClass:function(){1==this.direction?(this.entity.classed(u.menuVertical,!1),this.entity.classed(u.menuHorizontal,!0)):(this.entity.classed(u.menuHorizontal,!1),this.entity.classed(u.menuVertical,!0))},addSubmenu:function(t){this.menuItems.push(new d(this,t,this.OPTIONS))},open:function(){var t=this,e=this;return this.isActive()||(e.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors(function(){1==e.direction?(t.menuItems.length||e.buildLeaf(),e._openHorizontal(),e.calculateMissingWidth(0)):e._openVertical()}),e.parent.parentMenu.openSubmenuNow=!1),this},calculateMissingWidth:function(t,e){var i=this;this.entity.classed(u.list_top_level)?t>this.OPTIONS.MAX_MENU_WIDTH&&"function"==typeof e&&e(t-this.OPTIONS.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(t+this.width,function(t){t>0?i.reduceWidth(t,function(t){"function"==typeof e&&e(t)}):"function"==typeof e&&e(t)})},restoreWidth:function(t,e,i){if(e)this.parent.parentMenu.restoreWidth(t,!1,i);else if(t<=0)"function"==typeof i&&i();else if(this.entity.classed(u.list_top_level))"function"==typeof i&&i();else{var n=this.entity.node().offsetWidth,r=Math.min(t,this.width);if(n<r){var o=n/r*250;this.entity.transition().delay(0).duration(o).style("width",r+"px").on("end",function(){}),this.parent.parentMenu.restoreWidth(t-r,!1,i)}else this.parent.parentMenu.restoreWidth(t,!1,i)}},reduceWidth:function(t,e){var i=this,n=this.entity.node().offsetWidth;if(n<=this.OPTIONS.MIN_COL_WIDTH)e(t-i.width+n);else{var r=Math.max(this.OPTIONS.MIN_COL_WIDTH,i.width-t),o=250/(i.width/r);this.entity.transition().delay(0).duration(o).style("width",r+"px").on("end",function(){e(t-i.width+r)})}},_openHorizontal:function(){var t=this;t.entity.classed("active",!0).transition().delay(0).duration(250).style("width",t.width+"px").on("end",function(){t.marqueeToggle(!0)})},_openVertical:function(){var t=this;t.entity.style("height","0px"),t.entity.transition().delay(0).duration(250).style("height",36*t.menuItems.length+"px").on("end",function(){t.entity.style("height","auto"),t.marqueeToggle(!0),t.scrollToFitView()}),t.entity.classed("active",!0)},closeAllChildren:function(t){for(var e=0,i=0;i<this.menuItems.length;i++)this.menuItems[i].isActive()&&(++e,this.menuItems[i].submenu.close(function(){0==--e&&"function"==typeof t&&t()}));0==e&&"function"==typeof t&&t()},closeNeighbors:function(t){this.parent?this.parent.closeNeighbors(t):t()},close:function(t){var e=this;this.closeAllChildren(function(){1==e.direction?e._closeHorizontal(t):e._closeVertical(t)})},_closeHorizontal:function(t){this.entity.node().offsetWidth;var e=this,i=e.parent.parentMenu.openSubmenuNow;e.entity.transition().delay(0).duration(20).style("width","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),i?"function"==typeof t&&t():e.restoreWidth(e.OPTIONS.MAX_MENU_WIDTH,!0,function(){"function"==typeof t&&t()})})},_closeVertical:function(t){var e=this;e.entity.transition().delay(0).duration(100).style("height","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),"function"==typeof t&&t()})},isActive:function(){return this.entity.classed("active")},hasActiveParentNeighbour:function(){return this.menuItems.filter(function(t){return t.isActive()}).some(function(t){return!!d3.select(t.entity).node().classed(u.hasChild)})},marqueeToggle:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggle(t)},marqueeToggleAll:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggleAll(t)},findItemById:function(t){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].entity.data().id==t)return this.menuItems[e];if(this.menuItems[e].submenu){var i=this.menuItems[e].submenu.findItemById(t);if(i)return i}}return null},getTopMenu:function(){return this.parent?this.parent.parentMenu.getTopMenu():this},scrollToFitView:function(){var t,e=this.getTopMenu().entity.node().parentNode,i=this.entity.node().parentNode,n=e.getBoundingClientRect(),r=i.getBoundingClientRect(),o=r.top-n.top;if(o+r.height>n.height){var a=r.height>n.height?n.height-10:r.height+10,s=e.scrollTop+a-n.height+o;d3.select(e).transition().duration(100).tween("scrolltoptween",(t=s,function(){var i=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=i(t)}}))}},buildLeaf:function(){var t=this.entity.datum();this.entity.selectAll("div").data([t]).enter().append("div").classed(u.leaf+" "+u.leaf_content+" vzb-dialog-scrollable",!0).style("width",this.width+"px").each(function(t){var e=d3.select(this);e.append("span").classed(u.leaf_content_item+" "+u.leaf_content_item_title,!0).text(n.replaceNumberSpacesToNonBreak(t.name)||""),e.append("span").classed(u.leaf_content_item+" "+u.leaf_content_item_descr,!0).text(n.replaceNumberSpacesToNonBreak(t.description)||"")})}}),d=o.default.extend({init:function(t,e,i){var r=this;this.parentMenu=t,this.entity=e;var o=e.select("."+u.list_outer);return o.node()&&(this.submenu=new h(this,o,i)),this.entity.select("."+u.list_item_label).on("mouseenter",function(){n.isTouchDevice()||(1!=r.parentMenu.direction||d3.select(this).attr("children")?r.parentMenu.hasActiveParentNeighbour()||r.closeNeighbors():r.openSubmenu(),r.marqueeToggle(!0))}).on("click.item",function(){if(!n.isTouchDevice())if(d3.event.stopPropagation(),1==r.parentMenu.direction)r.openSubmenu();else{if(!d3.select(this).attr("children"))return;r.toggleSubmenu()}}).onTap(function(t){if((d3.event.stopPropagation(),2==r.parentMenu.direction)&&!r.entity.select("."+u.list_item_label).attr("children"))return;r.toggleSubmenu()}),this},setWidth:function(t,e,i){return this.submenu&&e&&this.submenu.setWidth(t,e,i),this},setDirection:function(t,e){return this.submenu&&e&&this.submenu.setDirection(t,e),this},toggleSubmenu:function(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())},openSubmenu:function(){this.submenu?this.submenu.open():this.closeNeighbors()},closeNeighbors:function(t){this.parentMenu.closeAllChildren(t)},isActive:function(){return this.submenu&&this.submenu.isActive()},marqueeToggleAll:function(t){this.entity.selectAll("."+u.list_item_label).each(function(){var e=d3.select(this).select("span"),i=d3.select(this.parentNode);if(i.classed("marquee",!1),e.style("width",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var n=30+e.node().scrollWidth;e.style("width",n+"px"),i.classed("marquee",!0)}})},marqueeToggle:function(t){var e=this.entity.select("."+u.list_item_label).select("span");if(this.entity.classed("marquee",!1),e.style("width",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var i=30+e.node().scrollWidth;e.style("width",i+"px"),this.entity.classed("marquee",!0)}}}),f=r.default.extend({tree:function(t){return arguments.length?(this._tree=t,this):this._tree},callback:function(t){return arguments.length?(this._callback=t,this):this._callback},markerID:function(t){return arguments.length?(this._markerID=t,this.targetModel(this.model.marker[this._markerID]),this):this._markerID},targetModel:function(t){return arguments.length?(this._targetModel&&this._targetModel.off("change",this.change),this._targetModel=t,this._targetModel.on("change",this.change),this._targetModel.isHook()&&(this._targetProp="which"),this._targetModel instanceof a.default&&(this._targetProp="space"),this):this._targetModel},targetProp:function(t){return arguments.length?(this._targetProp=t,this):this._targetProp},alignX:function(t){return arguments.length?(this._alignX=t,this):this._alignX},alignY:function(t){return arguments.length?(this._alignY=t,this):this._alignY},top:function(t){return arguments.length?(this._top=t,this):this._top},left:function(t){return arguments.length?(this._left=t,this):this._left},init:function(t,e){this.name="gapminder-treemenu",this.model_expects=[{name:"marker",type:"marker"},{name:"marker_tags",type:"marker"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.context=e,this.menuEntity=null,this._super(t,e),this._callback=function(t){console.log("Indicator selector: stub callback fired. New indicator is ",t)},this._alignX="center",this._alignY="center",this.OPTIONS=n.deepClone(c),this.change=this.change.bind(this)},change:function(t,e){(-1!=e.indexOf("."+this._targetProp)||this._targetModel.isHook()&&-1!=e.indexOf(".scaleType"))&&this.updateView()},ready:function(){this.updateView();var t=void 0;this.model.marker_tags&&(t=this.model.marker_tags.label.getData()),this._buildIndicatorsTree(t)},readyOnce:function(){this.element=d3.select(this.placeholder);var t=this;this.element.selectAll("div").remove(),this.element.append("div").attr("class",u.background).on("click",function(){d3.event.stopPropagation(),t.toggle()}),this.wrapperOuter=this.element.append("div").classed(u.wrapper_outer,!0).classed(u.noTransition,!0),this.wrapper=this.wrapperOuter.append("div").classed(u.wrapper,!0).classed(u.noTransition,!0).classed("vzb-dialog-scrollable",!0),this.wrapper.on("click",function(){d3.event.stopPropagation()}),this.wrapper.append("div").attr("class",u.close).html(s.close).on("click",function(){d3.event.stopPropagation(),t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class",u.close+"-icon"),this.wrapper.append("div").classed(u.scaletypes,!0).append("span"),this.wrapper.append("div").classed(u.title,!0).append("span"),this.wrapper.append("div").classed(u.search_wrap,!0).append("input").classed(u.search,!0).attr("type","search").attr("id",u.search),d3.select("body").on("mousemove",t._mousemoveDocument),this.wrapper.on("mouseleave",function(){}),this.translator=this.model.locale.getTFunction(),t._enableSearch(),t.resize()},_buildIndicatorsTree:function(t){!0!==t&&t||(t=[]);var e=this,i="_root",r=e.model.marker._root.dataManager.getDataModels(),o={};o._root={id:i,children:[]},r.size>1&&r.forEach(function(t){var e=t.getDatasetName();o[e]={id:e,type:"dataset",children:[]},o._root.children.push(o[e])}),t.forEach(function(t){o[t.tag]={id:t.tag,name:t.name,type:"folder",children:[]}});var a=o._root;t.forEach(function(t){t.parent&&o[t.parent]?o[t.parent].children.push(o[t.tag]):a.children.push(o[t.tag])});var s=this.model.marker.space.length>1;this.model.marker.getAvailableData().forEach(function(t){var r=t.value;if(r&&"_none"!=r.tags){r.tags||(r.tags=t.dataSource.getDatasetName()||i);var a="_default"==r.concept?"constant":t.key.size>1?"indicator":"property",l={id:r.concept,key:t.key,name:r.name,name_catalog:r.name_catalog,description:r.description,dataSource:t.dataSource._name,use:a};if(s&&1==t.key.length&&"_default"!=r.concept&&"time"!=r.concept_type){var u=t.key[0].concept+"_properties";if(!o[u]){var c=t.key[0];o[u]={id:u,name:c.name+" properties",type:"folder",children:[]},o._root.children.push(o[u])}o[u].children.push(l)}else r.tags.split(",").forEach(function(t){t=t.trim(),o[t]?o[t].children.push(l):(e.consoleGroupOpen||(console.groupCollapsed("Some tags were not found, so indicators went under menu root"),e.consoleGroupOpen=!0),n.warn("tag '"+t+"' for indicator '"+l.id+"'"),o._root.children.push(l))})}}),this.model.marker.getAvailableSpaces().forEach(function(t,e){a.children.push({id:e,name:t.map(function(t){return t.name}).join(", "),name_catalog:t.map(function(t){return t.name}).join(", "),description:"no description",dataSource:"All data sources",type:"space"})}),e.consoleGroupOpen&&(console.groupEnd(),delete e.consoleGroupOpen),this._sortChildren(a),this.indicatorsTree=a},_sortChildren:function(t,e){var i=this;t.children&&(t.children.sort(n.firstBy()(function(t,e){return t="dataset"===t.type?1:0,(e="dataset"===e.type?1:0)-t}).thenBy(function(t,e){return(t=t.children?1:0)-(e=e.children?1:0)}).thenBy(function(t,i){if(!e){if("time"==t.id)return-1;if("time"==i.id)return 1;if("advanced"==t.id)return 1;if("advanced"==i.id)return-1;if("_default"==t.id)return 1;if("_default"==i.id)return-1}return(t.name_catalog||t.name)>(i.name_catalog||i.name)?1:-1})),t.children.forEach(function(t){i._sortChildren(t,!0)}))},resize:function(){this.profiles={small:{col_width:200},medium:{col_width:200},large:{col_width:200}};var t=this._top,e=this._left;if(!this.wrapper)return n.warn("treemenu resize() abort because container is undefined");this.wrapper.classed(u.noTransition,!0),this.wrapper.node().scrollTop=0,this.activeProfile=this.profiles[this.getLayoutProfile()],this.OPTIONS.IS_MOBILE="small"===this.getLayoutProfile(),this.menuEntity&&(this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.OPTIONS.IS_MOBILE?2!=this.menuEntity.direction&&(this.menuEntity.setDirection(2,!0),this.OPTIONS.MENU_DIRECTION=2):1!=this.menuEntity.direction&&(this.menuEntity.setDirection(1,!0),this.OPTIONS.MENU_DIRECTION=1)),this.width=this.element.node().offsetWidth,this.height=this.element.node().offsetHeight;var i=this.wrapperOuter.node().getBoundingClientRect(),r=i.width,o=i.height;if(r)if(this.OPTIONS.IS_MOBILE)this.clearPos();else{(t||e)&&(this.wrapperOuter.node().offsetTop<10&&this.wrapperOuter.style("top","10px"),this.height-this.wrapperOuter.node().offsetTop-o<0&&(o>this.height&&(o=this.height-20),this.wrapperOuter.style("top",this.height-o-10+"px"),this.wrapperOuter.style("bottom","auto")),t&&(t=this.wrapperOuter.node().offsetTop));var a=void 0;a=this.wrapperOuter.classed(u.alignYb)?this.wrapperOuter.node().offsetTop+this.wrapperOuter.node().offsetHeight:this.height-this.wrapperOuter.node().offsetTop,this.wrapper.style("max-height",a-10+"px"),this.wrapperOuter.classed(u.alignXc,"center"===this._alignX),this.wrapperOuter.style("margin-left","center"===this._alignX?"-"+r/2+"px":null),"center"===this._alignX?this.OPTIONS.MAX_MENU_WIDTH=this.width/2-.5*r-10:this.OPTIONS.MAX_MENU_WIDTH=this.width-this.wrapperOuter.node().offsetLeft-r-10;var s=this.activeProfile.col_width+2*this.OPTIONS.MIN_COL_WIDTH,l=this.wrapperOuter.node().offsetLeft;this.OPTIONS.MENU_OPEN_LEFTSIDE=this.OPTIONS.MAX_MENU_WIDTH<s&&l>this.OPTIONS.MAX_MENU_WIDTH+10,this.OPTIONS.MENU_OPEN_LEFTSIDE?(l<s+10&&(l=s+10),this.OPTIONS.MAX_MENU_WIDTH=l-10):this.OPTIONS.MAX_MENU_WIDTH<s&&(l-=s-this.OPTIONS.MAX_MENU_WIDTH,this.OPTIONS.MAX_MENU_WIDTH=s),e?e=l:l!=this.wrapperOuter.node().offsetLeft&&(this.wrapperOuter.style("left","auto"),this.wrapperOuter.style("right",this.width-l-i.width+"px")),this._top=t,this._left=e,(e||t)&&this.setPos(),this.wrapperOuter.classed("vzb-treemenu-open-left-side",!this.OPTIONS.IS_MOBILE&&this.OPTIONS.MENU_OPEN_LEFTSIDE)}return this.wrapper.node().offsetHeight,this.wrapper.classed(u.noTransition,!1),this.setHorizontalMenuHeight(),this},toggle:function(){var t=this,e=!this.element.classed(u.hidden);this.element.classed(u.hidden,e),e?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):(this.setPos(),!n.isTouchDevice()&&this.focusSearch(),this.resize(),this.scrollToSelected()),this.wrapper.classed(u.noTransition,e),this.parent.components.forEach(function(i){"gapminder-dialogs"==i.name?d3.select(i.placeholder.parentNode).classed("vzb-blur",!e):i.element.classed?i.element.classed("vzb-blur",i!=t&&!e):d3.select(i.element).classed("vzb-blur",i!=t&&!e)}),this.width=t.element.node().offsetWidth},scrollToSelected:function(){if(this.selectedNode){var t=this,e=function(t,e){t.scrollTop=0;var i=t.getBoundingClientRect(),n=e.getBoundingClientRect().bottom-i.top-t.offsetHeight+10;t.scrollTop=n};if(2==this.menuEntity.direction)e(this.wrapper.node(),this.selectedNode),t.menuEntity.marqueeToggleAll(!0);else{this.menuEntity.findItemById(d3.select(this.selectedNode).data().id).submenu.calculateMissingWidth(0,function(){t.menuEntity.marqueeToggleAll(!0)});for(var i=this.selectedNode;!n.hasClass(i,u.list_top_level);)"LI"==i.tagName&&e(n.hasClass(i.parentNode,u.list_top_level)?i.parentNode.parentNode:i.parentNode,i),i=i.parentNode}}},setPos:function(){var t=this._top,e=this._left,i=this.wrapperOuter.node().getBoundingClientRect();if(t&&(this.wrapperOuter.style("top",t+"px"),this.wrapperOuter.style("bottom","auto"),this.wrapperOuter.classed(u.absPosVert,t)),e){var n=this.element.node().offsetWidth-e-i.width;n=n<10?10:n,this.wrapperOuter.style("right",n+"px"),this.wrapperOuter.style("left","auto"),this.wrapperOuter.classed(u.absPosHoriz,n)}},clearPos:function(){this._top="",this._left="",this.wrapperOuter.attr("style",""),this.wrapperOuter.classed(u.absPosVert,""),this.wrapperOuter.classed(u.absPosHoriz,""),this.wrapperOuter.classed(u.menuOpenLeftSide,""),this.wrapper.style("max-height","")},setHorizontalMenuHeight:function(){var t=null;if(this.menuEntity&&1==this.OPTIONS.MENU_DIRECTION&&this.menuEntity.menuItems.length){var e=parseInt(this.menuEntity.menuItems[0].entity.style("height"),10)||0,i=e*this._maxChildCount,n=Math.max(this.menuEntity.menuItems.length,3)*e+this.menuEntity.entity.node().offsetTop+parseInt(this.wrapper.style("padding-bottom"),10);t=Math.max(i,n)+"px"}this.wrapper.classed(u.noTransition,!0),this.wrapper.node().offsetHeight,this.wrapper.style("height",t),this.wrapper.node().offsetHeight,this.wrapper.classed(u.noTransition,!1)},_enableSearch:function(){var t=this,e=this.wrapper.select("."+u.search),i=!1,r=n.debounce(function(){var r=e.node().value;(i||""!=r)&&(i=""!=r,r.length>=t.OPTIONS.SEARCH_MIN_STR?t.redraw(function(e){var i={_id:"root",children:[]},r=function(e,i,n){var r=i[n].name;return!r&&t.translator&&(r=t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY]+"/"+t._targetModel._type)||t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY])),r&&r.toLowerCase().indexOf(e.toLowerCase())>=0};return function n(o){for(var a=t.OPTIONS.SUBMENUS,s=0;s<o.length;s++){var l;(l=r(e,o,s))&&i.children.push(o[s]),!l&&o[s][a]&&n(o[s][a])}}(t.dataFiltered.children),i.children=n.unique(i.children,function(t){return t.id}),i}(r),!0):t.redraw())},250);e.on("input",r)},_selectIndicator:function(t){this._callback(this._targetProp,t),this.toggle()},redraw:function(t,e){var i=this,r=i._targetModel.isHook(),o=void 0,s=void 0,l={};n.forEach(this.model.marker._root._data,function(t){"data"===t._type&&n.deepExtend(l,t.getConceptprops())});var c=i._targetModel._type;e?o=t:(null==t&&(t=this._tree),r?(s=n.keys(l).filter(function(t){if(i._targetModel.allow&&i._targetModel.allow.names){if(-1!=i._targetModel.allow.names.indexOf("!"+t))return!1;if(-1!=i._targetModel.allow.names.indexOf(t))return!0;if(i._targetModel.allow.namesOnlyThese)return!1}if(!i._targetModel.allow||!i._targetModel.allow.scales)return!0;if("*"==i._targetModel.allow.scales[0])return!0;if(!l[t].scales)return!0;for(var e=l[t].scales.length-1;e>=0;e--)if(i._targetModel.allow.scales.indexOf(l[t].scales[e])>-1)return!0;return!1}),o=n.pruneTree(t,function(t){return s.indexOf(t.id)>-1})):i._targetModel instanceof a.default?(s=t.children.map(function(t){return t.id}),o=n.pruneTree(t,function(t){return"space"==t.type})):(s=n.keys(l),o=n.pruneTree(t,function(t){return s.indexOf(t.id)>-1})),this.dataFiltered=o),this.wrapper.select("ul").remove(),this.element.select("."+u.title).select("span").text(this.translator(i._targetModel instanceof a.default?i._targetModel._root._name+"/"+i._targetModel._name:"buttons/"+(r?i._targetModel._name:c+"/"+i._targetProp))),this.element.select("."+u.search).attr("placeholder",this.translator("placeholder/search")+"..."),this._maxChildCount=0;var d=i.translator("hints/nodescr");if(this.OPTIONS.IS_MOBILE?this.OPTIONS.MENU_DIRECTION=2:this.OPTIONS.MENU_DIRECTION=1,this.selectedNode=null,function t(e,r,o){if(r.children){i._maxChildCount=Math.max(i._maxChildCount,r.children.length);var a=(o?e:e.append("div").classed(u.list_outer,!0)).append("ul").classed(u.list,!o).classed(u.list_top_level,o).classed("vzb-dialog-scrollable",!0).selectAll("li").data(r.children,function(t){return t.id}).enter().append("li");a.append("span").classed(u.list_item_label,!0).attr("children",function(t){return t.children?"true":null}).attr("type",function(t){return t.type?t.type:null}).on("click",function(t){d3.select(this).attr("children")||(d3.event.stopPropagation(),i._selectIndicator({concept:t.id,key:t.key,dataSource:t.dataSource,use:t.use}))}).append("span").text(function(t){var e="_default"===t.id?i.translator("indicator/_default/"+c):t.name_catalog||t.name||t.id;return e||""===e||n.warn("translation missing: NAME of "+t.id),e||""}),a.classed(u.list_item,!0).classed(u.hasChild,function(t){return t.children}).classed(u.isSpecial,function(t){return t.special}).each(function(e){var r=d3.select(this);if(e.children||("_default"===e.id&&(e.name=i.translator("indicator/_default/"+c),e.description=i.translator("description/_default/"+c)),e.description||(e.description=d),r.append("div").attr("class",u.menuHorizontal+" "+u.list_outer+" "+u.list_item_leaf).on("click",function(t){i._selectIndicator({concept:t.id,key:t.key,dataSource:t.dataSource,use:t.use})})),e.id==i._targetModel[i._targetProp]){var a=void 0;if(i.selectedNode&&o)for(a=i.selectedNode.parentNode,d3.select(i.selectedNode).select("."+u.list_item_leaf).classed("active",!1);!n.hasClass(a,u.list_top_level);)"UL"==a.tagName&&d3.select(a.parentNode).classed("active",!1),a=a.parentNode;if(!i.selectedNode||o){for(a=this.parentNode,d3.select(this).classed("item-active",!0).select("."+u.list_item_leaf).classed("active",!0);!n.hasClass(a,u.list_top_level);)"UL"==a.tagName&&d3.select(a.parentNode).classed("active",!0),"LI"==a.tagName&&d3.select(a).classed("item-active",!0),a=a.parentNode;i.selectedNode=this}}t(r,e)})}}(this.wrapper,o,!0),this.menuEntity=new h(null,this.wrapper.selectAll("."+u.list_top_level),this.OPTIONS),this.menuEntity&&this.menuEntity.setDirection(this.OPTIONS.MENU_DIRECTION),this.menuEntity&&this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.setHorizontalMenuHeight(),!e){var f="_default";if(s.indexOf(this._targetModel[i._targetProp])>-1&&(f=this._targetModel[i._targetProp]),l[f]||n.error("Concept properties of "+f+" are missing from the set, or the set is empty. Put a breakpoint here and check what you have in indicatorsDB"),!l[f].scales)return this.element.select("."+u.scaletypes).classed(u.hidden,!0),!0;var p=r?l[f].scales.filter(function(t){return!i._targetModel.allow||!i._targetModel.allow.scales||("*"==i._targetModel.allow.scales[0]||i._targetModel.allow.scales.indexOf(t)>-1)}):[];if(0==p.length)this.element.select("."+u.scaletypes).classed(u.hidden,!0);else{var m=this.element.select("."+u.scaletypes).classed(u.hidden,!1).selectAll("span").data(p,function(t){return t});m.exit().remove(),m=m.enter().append("span").on("click",function(t){d3.event.stopPropagation(),i._setModel("scaleType",t)}).merge(m);var v=i._targetModel.scaleType;m.classed(u.scaletypesDisabled,p.length<2).classed(u.scaletypesActive,function(t){return(t==v||"log"===t&&"genericLog"===v)&&p.length>1}).text(function(t){return i.translator("scaletype/"+t)})}}return this},updateView:function(){if(this._targetModel){this.wrapperOuter.classed(u.absPosVert,this._top),this.wrapperOuter.classed(u.alignYt,"top"===this._alignY),this.wrapperOuter.classed(u.alignYb,"bottom"===this._alignY),this.wrapperOuter.classed(u.absPosHoriz,this._left),this.wrapperOuter.classed(u.alignXl,"left"===this._alignX),this.wrapperOuter.classed(u.alignXr,"right"===this._alignX);var t=this._setModel.bind(this);return this.callback(t).tree(this.indicatorsTree).redraw(),this.wrapper.select("."+u.search).node().value="",this}},focusSearch:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.wrapper.select("."+u.search).node();t?e.focus():e.blur()},_setModel:function(t,e){var i=this._targetModel;"which"==t&&i.setWhich(e),"scaleType"==t&&i.setScaleType(e),"space"==t&&i.setSpace(e.concept.split(","))}});e.default=f},function(t,e,i){var n={"./_dialog.js":12,"./about/about.js":167,"./axes/axes.js":168,"./colors/colors.js":170,"./dialogs.js":171,"./find/find.js":172,"./find/show.js":112,"./grouping/grouping.js":173,"./label/label.js":174,"./moreoptions/moreoptions.js":175,"./opacity/opacity.js":176,"./presentation/presentation.js":177,"./side/side.js":178,"./size/size.js":179,"./speed/speed.js":180,"./stack/stack.js":181,"./timedisplay/timedisplay.js":183,"./zoom/zoom.js":185};function r(t){return i(o(t))}function o(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(n)},r.resolve=o,t.exports=r,r.id=427},function(t,e,i){var n={"./d3.axisWithLabelPicker.js":111,"./d3.collisionResolver.js":429,"./d3.colorPicker.js":165,"./d3.dynamicBackground.js":184,"./d3.genericLogScale.js":157,"./d3.geoProjection.js":430,"./d3.touchEvents.js":158,"./labels.js":431,"./requireAll.js":106,"./svgexport.js":433,"./textEllipsis.js":434,"./topojson.js":435};function r(t){return i(o(t))}function o(t){var e=n[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(n)},r.resolve=o,t.exports=r,r.id=428},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return function(){var t=300,e=0;function i(i){if(null!=n)if(null!=r)if(null!=a)if(null!=h){e=.8*i.node().getBBox().height;for(var o=i.filter(function(t){return l(t,s)}).sort(function(t,e){return d3.ascending(t.valueY,e.valueY)}).data(),u={},c=0;c<o.length-1;c++){var d=o[c],f=o[c+1];if(d.shiftY||(d.shiftY=0),f.shiftY=0,!(f.valueY-d.valueY-d.shiftY>=e)){var p=0;d.valueY>e&&(0==c?p=Math.min(e,d.valueY):d.valueY-o[c-1].valueY+o[c-1].shiftY>e&&(p=Math.min(e,d.valueY-o[c-1].valueY+o[c-1].shiftY))),d.upperAvailable=p;var m=0;f.valueY<r&&(c==o.length-2?m=Math.min(e,r-f.valueY):o[c+2].valueY-f.valueY>e&&(m=Math.min(e,o[c+2].valueY-f.valueY))),f.underAvailable=m;var v=e-(f.valueY-d.valueY-d.shiftY);u[d[h]]={},u[f[h]]={},p>=v/2&&m>=v/2?(d.shiftY=-v/2,f.shiftY=v/2):p>=v/2?(f.shiftY=m,d.shiftY=-Math.min(p,v-m)):m>=v/2?(d.shiftY-=p,f.shiftY=Math.min(m,v-p)):(d.shiftY=-p,f.shiftY=m),u[d[h]].valueY=d.valueY+d.shiftY,u[f[h]].valueY=f.valueY+f.shiftY}}i.each(function(e,i){u[e[h]]&&u[e[h]].valueY&&d3.select(this).selectAll(n).transition().duration(t).attr("transform","translate(0,"+u[e[h]].valueY+")")})}else console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' ");else console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' ");else console.warn("D3 collision resolver stopped: missing height of the canvas");else console.warn("D3 collision resolver stopped: missing a CSS slector")}var n=null;i.selector=function(t){return arguments.length?(n=t,i):n};var r=null;i.height=function(t){return arguments.length?(r=t,i):r};var o=d3.scaleLinear().domain([0,1]).range([0,1]);i.scale=function(t){return arguments.length?(o=t,i):o};var a=null;i.value=function(t){return arguments.length?(a=t,i):a};var s=null;i.time=function(t){return arguments.length?(s=t,i):s};var l=function(){return!0};i.filter=function(t){return arguments.length?(l=t,i):l};var u=null;i.fixed=function(t){return arguments.length?(u=t,i):u};var c=null;i.handleResult=function(t){return arguments.length?(c=t,i):c};var h=null;return i.KEY=function(t){return arguments.length?(h=t,i):h},i}()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,i){return{type:"Feature",id:t.id,properties:t.properties,geometry:e(t.geometry,i)}}function e(t,i){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return e(t,i)})};if(!l.hasOwnProperty(t.type))return null;var n=l[t.type];return d3.geoUstream(t,i(n)),n.result()}d3.geoProject=function(t,n){var r=n.stream;if(!r)throw new Error("not yet supported");return(t&&i.hasOwnProperty(t.type)?i[t.type]:e)(t,r)};var i={Feature:t,FeatureCollection:function(e,i){return{type:"FeatureCollection",features:e.features.map(function(e){return t(e,i)})}}},n=[],r=[],o={point:function(t,e){n.push([t,e])},result:function(){var t=n.length?n.length<2?{type:"Point",coordinates:n[0]}:{type:"MultiPoint",coordinates:n}:null;return n=[],t}},a={lineStart:u,point:function(t,e){n.push([t,e])},lineEnd:function(){n.length&&(r.push(n),n=[])},result:function(){var t=r.length?r.length<2?{type:"LineString",coordinates:r[0]}:{type:"MultiLineString",coordinates:r}:null;return r=[],t}},s={polygonStart:u,lineStart:u,point:function(t,e){n.push([t,e])},lineEnd:function(){var t=n.length;if(t){do{n.push(n[0].slice())}while(++t<4);r.push(n),n=[]}},polygonEnd:u,result:function(){if(!r.length)return null;var t=[],e=[];return r.forEach(function(i){!function(t){if((e=t.length)<4)return!1;var e,i=0,n=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];for(;++i<e;)n+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return n<=0}(i)?e.push(i):t.push([i])}),e.forEach(function(e){var i=e[0];t.some(function(t){return!!function(t,e){for(var i=e[0],n=e[1],r=!1,o=0,a=t.length,s=a-1;o<a;s=o++){var l=t[o],u=l[0],c=l[1],h=t[s],d=h[0],f=h[1];c>n^f>n&&i<(d-u)*(n-c)/(f-c)+u&&(r=!r)}return r}(t[0],i)&&(t.push(e),!0)})||t.push([e])}),r=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},l={Point:o,MultiPoint:o,LineString:a,MultiLineString:a,Polygon:s,MultiPolygon:s,Sphere:s};function u(){}var c=1e-6,h=c*c,d=Math.PI,f=d/2,p=Math.sqrt(d),m=d/180,v=180/d;function g(t){return t>0?1:t<0?-1:0}function y(t){return t>1?f:t<-1?-f:Math.asin(t)}function _(t){return t>1?0:t<-1?d:Math.acos(t)}function b(t){return t>0?Math.sqrt(t):0}var x=d3.geoProjection,w=d3.geoProjectionMutator;function S(t){var e=Math.tan(.5*t),i=2*Math.log(Math.cos(.5*t))/(e*e);function n(t,e){var n=Math.cos(t),r=Math.cos(e),o=Math.sin(e),a=r*n,s=-((1-a?Math.log(.5*(1+a))/(1-a):-.5)+i/(1+a));return[s*r*Math.sin(t),s*o]}return n.invert=function(e,n){var r,o=Math.sqrt(e*e+n*n),a=-.5*t,s=50;if(!o)return[0,0];do{var l=.5*a,u=Math.cos(l),h=Math.sin(l),d=Math.tan(l),f=Math.log(1/u);a-=r=(2/d*f-i*d-o)/(-f/(h*h)+1-i/(2*u*u))}while(Math.abs(r)>c&&--s>0);var p=Math.sin(a);return[Math.atan2(e*p,o*Math.cos(a)),y(n*p/o)]},n}function M(t,e){var i,n=Math.cos(e),r=(i=_(n*Math.cos(t/=2)))?i/Math.sin(i):1;return[2*n*Math.sin(t)*r,Math.sin(e)*r]}function E(t){var e=Math.sin(t),i=Math.cos(t),n=t>0?1:-1,r=Math.tan(n*t),o=(1+e-i)/2;function a(t,a){var s=Math.cos(a),l=Math.cos(t/=2);return[(1+s)*Math.sin(t),(n*a>-Math.atan2(l,r)-.001?0:10*-n)+o+Math.sin(a)*i-(1+s)*e*l]}return a.invert=function(t,a){var s=0,l=0,u=50;do{var h=Math.cos(s),d=Math.sin(s),f=Math.cos(l),p=Math.sin(l),m=1+f,v=m*d-t,g=o+p*i-m*e*h-a,y=.5*m*h,_=-d*p,b=.5*e*m*d,x=i*f+e*h*p,w=_*b-x*y,S=.5*(g*_-v*x)/w,M=(v*b-g*y)/w;s-=S,l-=M}while((Math.abs(S)>c||Math.abs(M)>c)&&--u>0);return n*l>-Math.atan2(Math.cos(s),r)-.001?[2*s,l]:null},a}function z(t){return.5*(Math.exp(t)-Math.exp(-t))}function k(t){return.5*(Math.exp(t)+Math.exp(-t))}function T(t,e){var i=Math.tan(e/2),n=b(1-i*i),r=1+n*Math.cos(t/=2),o=Math.sin(t)*n/r,a=i/r,s=o*o,l=a*a;return[4/3*o*(3+s-3*l),4/3*a*(3+3*s-l)]}d3.geoInterrupt=function(t){var e,i=[[[[-d,0],[0,f],[d,0]]],[[[-d,0],[0,-f],[d,0]]]];function n(e,n){for(var r=n<0?-1:1,o=i[+(n<0)],a=0,s=o.length-1;a<s&&e>o[a][2][0];++a);var l=t(e-o[a][1][0],n);return l[0]+=t(o[a][1][0],r*n>r*o[a][0][1]?o[a][0][1]:n)[0],l}t.invert&&(n.invert=function(r,o){for(var a=e[+(o<0)],l=i[+(o<0)],u=0,c=a.length;u<c;++u){var h=a[u];if(h[0][0]<=r&&r<h[1][0]&&h[0][1]<=o&&o<h[1][1]){var d=t.invert(r-t(l[u][1][0],0)[0],o);return d[0]+=l[u][1][0],s(n(d[0],d[1]),[r,o])?d:null}}});var r=d3.geoProjection(n),o=r.stream;function a(t,e){for(var i,n,r,o=-1,a=t.length,s=t[0],l=[];++o<a;){n=((i=t[o])[0]-s[0])/e,r=(i[1]-s[1])/e;for(var u=0;u<e;++u)l.push([s[0]+u*n,s[1]+u*r]);s=i}return l.push(i),l}function s(t,e){return Math.abs(t[0]-e[0])<c&&Math.abs(t[1]-e[1])<c}return r.stream=function(t){var e=r.rotate(),n=o(t),s=(r.rotate([0,0]),o(t));return r.rotate(e),n.sphere=function(){d3.geoStream(function(){for(var t=1e-6,e=[],n=0,r=i[0].length;n<r;++n){var o=i[0][n],s=180*o[0][0]/d,l=180*o[0][1]/d,u=180*o[1][1]/d,c=180*o[2][0]/d,h=180*o[2][1]/d;e.push(a([[s+t,l+t],[s+t,u-t],[c-t,u-t],[c-t,h+t]],30))}for(var n=i[1].length-1;n>=0;--n){var o=i[1][n],s=180*o[0][0]/d,l=180*o[0][1]/d,u=180*o[1][1]/d,c=180*o[2][0]/d,h=180*o[2][1]/d;e.push(a([[c-t,h-t],[c-t,u+t],[s+t,u+t],[s+t,l-t]],30))}return{type:"Polygon",coordinates:[d3.merge(e)]}}(),s)},n},r.lobes=function(n){return arguments.length?(i=n.map(function(t){return t.map(function(t){return[[t[0][0]*d/180,t[0][1]*d/180],[t[1][0]*d/180,t[1][1]*d/180],[t[2][0]*d/180,t[2][1]*d/180]]})}),e=i.map(function(e){return e.map(function(e){var i,n=t(e[0][0],e[0][1])[0],r=t(e[2][0],e[2][1])[0],o=t(e[1][0],e[0][1])[1],a=t(e[1][0],e[1][1])[1];return o>a&&(i=o,o=a,a=i),[[n,o],[r,a]]})}),r):i.map(function(t){return t.map(function(t){return[[180*t[0][0]/d,180*t[0][1]/d],[180*t[1][0]/d,180*t[1][1]/d],[180*t[2][0]/d,180*t[2][1]/d]]})})},r},(d3.geoAiry=function(){var t=f,e=w(S),i=e(t);return i.radius=function(i){return arguments.length?e(t=i*d/180):t/d*180},i}).raw=S,M.invert=function(t,e){if(!(t*t+4*e*e>d*d+c)){var i=t,n=e,r=25;do{var o,a=Math.sin(i),s=Math.sin(i/2),l=Math.cos(i/2),u=Math.sin(n),h=Math.cos(n),f=Math.sin(2*n),p=u*u,m=h*h,v=s*s,g=1-m*l*l,y=g?_(h*l)*Math.sqrt(o=1/g):o=0,b=2*y*h*s-t,x=y*u-e,w=o*(m*v+y*h*l*p),S=o*(.5*a*f-2*y*u*s),M=.25*o*(f*s-y*u*m*a),E=o*(p*l+y*v*h),z=S*M-E*w;if(!z)break;var k=(x*S-b*E)/z,T=(b*M-x*w)/z;i-=k,n-=T}while((Math.abs(k)>c||Math.abs(T)>c)&&--r>0);return[i,n]}},(d3.geoAitoff=function(){return x(M)}).raw=M,(d3.geoArmadillo=function(){var t=d/9,e=t>0?1:-1,i=Math.tan(e*t),n=w(E),r=n(t),o=r.stream;return r.parallel=function(r){return arguments.length?(i=Math.tan((e=(t=r*d/180)>0?1:-1)*t),n(t)):t/d*180},r.stream=function(n){var a=r.rotate(),s=o(n),l=(r.rotate([0,0]),o(n));return r.rotate(a),s.sphere=function(){l.polygonStart(),l.lineStart();for(var n=-180*e;e*n<180;n+=90*e)l.point(n,90*e);for(;e*(n-=t)>=-180;)l.point(n,e*-Math.atan2(Math.cos(n*m/2),i)*v);l.lineEnd(),l.polygonEnd()},s},r}).raw=E,T.invert=function(t,e){if(e*=3/8,!(t*=3/8)&&Math.abs(e)>1)return null;var i=1+t*t+e*e,n=Math.sqrt(.5*(i-Math.sqrt(i*i-4*e*e))),r=y(n)/3,o=n?function(t){return Math.log(t+b(t*t-1))}(Math.abs(e/n))/3:function(t){return Math.log(t+b(t*t+1))}(Math.abs(t))/3,a=Math.cos(r),s=k(o),l=s*s-a*a;return[2*g(t)*Math.atan2(z(o)*a,.25-l),2*g(e)*Math.atan2(s*Math.sin(r),.25+l)]},(d3.geoAugust=function(){return x(T)}).raw=T;var O=Math.log(1+Math.SQRT2);function C(t,e){var i=Math.abs(e);return i<d/4?[t,Math.log(Math.tan(d/4+e/2))]:[t*Math.cos(i)*(2*Math.SQRT2-1/Math.sin(i)),g(e)*(2*Math.SQRT2*(i-d/4)-Math.log(Math.tan(i/2)))]}C.invert=function(t,e){if((n=Math.abs(e))<O)return[t,2*Math.atan(Math.exp(e))-f];var i,n,r=Math.sqrt(8),o=d/4,a=25;do{var s=Math.cos(o/2),l=Math.tan(o/2);o-=i=(r*(o-d/4)-Math.log(l)-n)/(r-.5*s*s/l)}while(Math.abs(i)>h&&--a>0);return[t/(Math.cos(o)*(r-1/Math.sin(o))),g(e)*o]},(d3.geoBaker=function(){return x(C)}).raw=C;var P=d3.geoAzimuthalEquidistant.raw;function A(t){var e=2*d/t;function i(t,i){var n=P(t,i);if(Math.abs(t)>f){var r=Math.atan2(n[1],n[0]),o=Math.sqrt(n[0]*n[0]+n[1]*n[1]),a=e*Math.round((r-f)/e)+f,s=Math.atan2(Math.sin(r-=a),2-Math.cos(r));r=a+y(d/o*Math.sin(s))-s,n[0]=o*Math.cos(r),n[1]=o*Math.sin(r)}return n}return i.invert=function(t,i){var n=Math.sqrt(t*t+i*i);if(n>f){var r=Math.atan2(i,t),o=e*Math.round((r-f)/e)+f,a=r>o?-1:1,s=n*Math.cos(o-r),l=1/Math.tan(a*Math.acos((s-d)/Math.sqrt(d*(d-2*s)+n*n)));r=o+2*Math.atan((l+a*Math.sqrt(l*l-3))/3),t=n*Math.cos(r),i=n*Math.sin(r)}return P.invert(t,i)},i}function I(t){return function(e){var i,n=t*Math.sin(e),r=30;do{e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e))}while(Math.abs(i)>c&&--r>0);return e/2}}function L(t,e,i){var n=I(i);function r(i,r){return[t*i*Math.cos(r=n(r)),e*Math.sin(r)]}return r.invert=function(n,r){var o=y(r/e);return[n/(t*Math.cos(o)),y((2*o+Math.sin(2*o))/i)]},r}(d3.geoBerghaus=function(){var t=5,e=w(A),i=e(t),n=i.stream,r=.01,o=-Math.cos(r*m),a=Math.sin(r*m);return i.lobes=function(i){return arguments.length?e(t=+i):t},i.stream=function(e){var s=i.rotate(),l=n(e),u=(i.rotate([0,0]),n(e));return i.rotate(s),l.sphere=function(){u.polygonStart(),u.lineStart();for(var e=0,i=360/t,n=2*d/t,s=90-180/t,l=f;e<t;++e,s-=i,l-=n)u.point(Math.atan2(a*Math.cos(l),o)*v,y(a*Math.sin(l))*v),s<-90?(u.point(-90,-180-s-r),u.point(-90,-180-s+r)):(u.point(90,s+r),u.point(90,s-r));u.lineEnd(),u.polygonEnd()},l},i}).raw=A;var D=I(d),R=L(Math.SQRT2/f,Math.SQRT2,d);function j(t,e){var i=2.00276,n=D(e);return[i*t/(1/Math.cos(e)+1.11072/Math.cos(n)),(e+Math.SQRT2*Math.sin(n))/i]}function F(t){var e=0,i=w(t),n=i(e);return n.parallel=function(t){return arguments.length?i(e=t*d/180):e/d*180},n}function B(t,e){return[t*Math.cos(e),e]}function N(t){if(!t)return B;var e=1/Math.tan(t);function i(i,n){var r=e+t-n,o=r?i*Math.cos(n)/r:r;return[r*Math.sin(o),e-r*Math.cos(o)]}return i.invert=function(i,n){var r=Math.sqrt(i*i+(n=e-n)*n),o=e+t-r;return[r/Math.cos(o)*Math.atan2(i,n),o]},i}(d3.geoMollweide=function(){return x(R)}).raw=R,j.invert=function(t,e){var i,n,r=2.00276,o=r*e,a=e<0?-d/4:d/4,s=25;do{n=o-Math.SQRT2*Math.sin(a),a-=i=(Math.sin(2*a)+2*a-d*Math.sin(n))/(2*Math.cos(2*a)+2+d*Math.cos(n)*Math.SQRT2*Math.cos(a))}while(Math.abs(i)>c&&--s>0);return n=o-Math.SQRT2*Math.sin(a),[t*(1/Math.cos(n)+1.11072/Math.cos(a))/r,n]},(d3.geoBoggs=function(){return x(j)}).raw=j,B.invert=function(t,e){return[t/Math.cos(e),e]},(d3.geoSinusoidal=function(){return x(B)}).raw=B,(d3.geoBonne=function(){return F(N).parallel(45)}).raw=N;var q=L(1,4/d,d);function V(t){for(var e,i=(t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]}))[2],n=0;n<3;++n,i=e)e=t[n],i.v=H(e[1]-i[1],i[3],i[2],e[3],e[2],e[0]-i[0]),i.point=[0,0];var r=U(t[0].v[0],t[2].v[0],t[1].v[0]),o=U(t[0].v[0],t[1].v[0],t[2].v[0]),a=d-r;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var s=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(r),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(r))];return function(e,i){for(var n=Math.sin(i),r=Math.cos(i),l=new Array(3),u=0;u<3;++u){var c=t[u];if(l[u]=H(i-c[1],c[3],c[2],r,n,e-c[0]),!l[u][0])return c.point;l[u][1]=W(l[u][1]-c.v[1])}var h=s.slice();for(u=0;u<3;++u){var d=2==u?0:u+1,f=U(t[u].v[0],l[u][0],l[d][0]);l[u][1]<0&&(f=-f),u?1==u?(f=o-f,h[0]-=l[u][0]*Math.cos(f),h[1]-=l[u][0]*Math.sin(f)):(f=a-f,h[0]+=l[u][0]*Math.cos(f),h[1]+=l[u][0]*Math.sin(f)):(h[0]+=l[u][0]*Math.cos(f),h[1]-=l[u][0]*Math.sin(f))}return h[0]/=3,h[1]/=3,h}}function H(t,e,i,n,r,o){var a,s=Math.cos(o);if(Math.abs(t)>1||Math.abs(o)>1)a=_(i*r+e*n*s);else{var l=Math.sin(.5*t),u=Math.sin(.5*o);a=2*y(Math.sqrt(l*l+e*n*u*u))}return Math.abs(a)>c?[a,Math.atan2(n*Math.sin(o),e*r-i*n*s)]:[0,0]}function U(t,e,i){return _(.5*(t*t+e*e-i*i)/(t*e))}function W(t){return t-2*d*Math.floor((t+d)/(2*d))}function K(t){return[t[0]*m,t[1]*m]}function G(t,e){var i=b(1-Math.sin(e));return[2/p*t*i,p*(1-i)]}function X(t){var e=Math.tan(t);function i(t,i){return[t,(t?t/Math.sin(t):1)*(Math.sin(i)*Math.cos(t)-e*Math.cos(i))]}return i.invert=e?function(t,i){t&&(i*=Math.sin(t)/t);var n=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(n*n+e*e-i*i)-n,e-i)]}:function(t,e){return[t,y(t?e*Math.tan(t)/t:e)]},i}function Y(t,e){var i=Math.sqrt(3);return[i*t*(2*Math.cos(2*e/3)-1)/p,i*p*Math.sin(e/3)]}function Z(t){var e=Math.cos(t);function i(t,i){return[t*e,Math.sin(i)/e]}return i.invert=function(t,i){return[t/e,y(i*e)]},i}function $(t){var e=Math.cos(t);function i(t,i){return[t*e,(1+e)*Math.tan(.5*i)]}return i.invert=function(t,i){return[t/e,2*Math.atan(i/(1+e))]},i}function Q(t,e){var i=Math.sqrt(8/(3*d));return[i*t*(1-Math.abs(e)/d),i*e]}function J(t,e){var i=Math.sqrt(4-3*Math.sin(Math.abs(e)));return[2/Math.sqrt(6*d)*t*i,g(e)*Math.sqrt(2*d/3)*(2-i)]}function tt(t,e){var i=Math.sqrt(d*(4+d));return[2/i*t*(1+Math.sqrt(1-4*e*e/(d*d))),4/i*e]}function et(t,e){var i=(2+f)*Math.sin(e);e/=2;for(var n=0,r=1/0;n<10&&Math.abs(r)>c;n++){var o=Math.cos(e);e-=r=(e+Math.sin(e)*(o+2)-i)/(2*o*(1+o))}return[2/Math.sqrt(d*(4+d))*t*(1+Math.cos(e)),2*Math.sqrt(d/(4+d))*Math.sin(e)]}function it(t,e){return[t*(1+Math.cos(e))/Math.sqrt(2+d),2*e/Math.sqrt(2+d)]}function nt(t,e){for(var i=(1+f)*Math.sin(e),n=0,r=1/0;n<10&&Math.abs(r)>c;n++)e-=r=(e+Math.sin(e)-i)/(1+Math.cos(e));return i=Math.sqrt(2+d),[t*(1+Math.cos(e))/i,2*e/i]}function rt(t,e){var i=Math.sin(t/=2),n=Math.cos(t),r=Math.sqrt(Math.cos(e)),o=Math.cos(e/=2),a=Math.sin(e)/(o+Math.SQRT2*n*r),s=Math.sqrt(2/(1+a*a)),l=Math.sqrt((Math.SQRT2*o+(n+i)*r)/(Math.SQRT2*o+(n-i)*r));return[ot*(s*(l-1/l)-2*Math.log(l)),ot*(s*a*(l+1/l)-2*Math.atan(a))]}(d3.geoBromley=function(){return x(q)}).raw=q,(d3.geoChamberlin=function(){var t=[[0,0],[0,0],[0,0]],e=w(V),i=e(t),n=i.rotate;return delete i.rotate,i.points=function(r){if(!arguments.length)return t;t=r;var o=d3.geoCentroid({type:"MultiPoint",coordinates:t}),a=[-o[0],-o[1]];return n.call(i,a),e(t.map(d3.geoRotation(a)).map(K))},i.points([[-150,55],[-35,55],[-92.5,10]])}).raw=V,G.invert=function(t,e){var i=(i=e/p-1)*i;return[i>0?t*Math.sqrt(d/i)/2:0,y(1-i)]},(d3.geoCollignon=function(){return x(G)}).raw=G,(d3.geoCraig=function(){return F(X)}).raw=X,Y.invert=function(t,e){var i=Math.sqrt(3),n=3*y(e/(i*p));return[p*t/(i*(2*Math.cos(2*n/3)-1)),n]},(d3.geoCraster=function(){return x(Y)}).raw=Y,(d3.geoCylindricalEqualArea=function(){return F(Z)}).raw=Z,(d3.geoCylindricalStereographic=function(){return F($)}).raw=$,Q.invert=function(t,e){var i=Math.sqrt(8/(3*d)),n=e/i;return[t/(i*(1-Math.abs(n)/d)),n]},(d3.geoEckert1=function(){return x(Q)}).raw=Q,J.invert=function(t,e){var i=2-Math.abs(e)/Math.sqrt(2*d/3);return[t*Math.sqrt(6*d)/(2*i),g(e)*y((4-i*i)/3)]},(d3.geoEckert2=function(){return x(J)}).raw=J,tt.invert=function(t,e){var i=Math.sqrt(d*(4+d))/2;return[t*i/(1+b(1-e*e*(4+d)/(4*d))),e*i/2]},(d3.geoEckert3=function(){return x(tt)}).raw=tt,et.invert=function(t,e){var i=.5*e*Math.sqrt((4+d)/d),n=y(i),r=Math.cos(n);return[t/(2/Math.sqrt(d*(4+d))*(1+r)),y((n+i*(r+2))/(2+f))]},(d3.geoEckert4=function(){return x(et)}).raw=et,it.invert=function(t,e){var i=Math.sqrt(2+d),n=e*i/2;return[i*t/(1+Math.cos(n)),n]},(d3.geoEckert5=function(){return x(it)}).raw=it,nt.invert=function(t,e){var i=1+f,n=Math.sqrt(i/2);return[2*t*n/(1+Math.cos(e*=n)),y((e+Math.sin(e))/i)]},(d3.geoEckert6=function(){return x(nt)}).raw=nt,rt.invert=function(t,e){var i=d3.geoAugust.raw.invert(t/1.2,1.065*e);if(!i)return null;var n=i[0],r=i[1],o=20;t/=ot,e/=ot;do{var a=n/2,s=r/2,l=Math.sin(a),u=Math.cos(a),h=Math.sin(s),d=Math.cos(s),p=Math.cos(r),m=Math.sqrt(p),v=h/(d+Math.SQRT2*u*m),g=v*v,y=Math.sqrt(2/(1+g)),_=(Math.SQRT2*d+(u+l)*m)/(Math.SQRT2*d+(u-l)*m),b=Math.sqrt(_),x=b-1/b,w=b+1/b,S=y*x-2*Math.log(b)-t,M=y*v*w-2*Math.atan(v)-e,E=h&&Math.SQRT1_2*m*l*g/h,z=(Math.SQRT2*u*d+m)/(2*(d+Math.SQRT2*u*m)*(d+Math.SQRT2*u*m)*m),k=-.5*v*y*y*y,T=k*E,O=k*z,C=(C=2*d+Math.SQRT2*m*(u-l))*C*b,P=(Math.SQRT2*u*d*m+p)/C,A=-Math.SQRT2*l*h/(m*C),I=x*T-2*P/b+y*(P+P/_),L=x*O-2*A/b+y*(A+A/_),D=v*w*T-2*E/(1+g)+y*w*E+y*v*(P-P/_),R=v*w*O-2*z/(1+g)+y*w*z+y*v*(A-A/_),j=L*D-R*I;if(!j)break;var F=(M*L-S*R)/j,B=(S*D-M*I)/j;n-=F,r=Math.max(-f,Math.min(f,r-B))}while((Math.abs(F)>c||Math.abs(B)>c)&&--o>0);return Math.abs(Math.abs(r)-f)<c?[0,r]:o&&[n,r]};var ot=3+2*Math.SQRT2;function at(t,e){var i=Math.tan(e/2);return[t*st*b(1-i*i),(1+st)*i]}(d3.geoEisenlohr=function(){return x(rt)}).raw=rt,at.invert=function(t,e){var i=e/(1+st);return[t?t/(st*b(1-i*i)):0,2*Math.atan(i)]};var st=Math.cos(35*m);function lt(t,e){var i=e/2,n=Math.cos(i);return[2*t/p*Math.cos(e)*n*n,p*Math.tan(i)]}(d3.geoFahey=function(){return x(at)}).raw=at,lt.invert=function(t,e){var i=Math.atan(e/p),n=Math.cos(i),r=2*i;return[t*p*.5/(Math.cos(r)*n*n),r]},(d3.geoFoucaut=function(){return x(lt)}).raw=lt,d3.geoGilbert=function(t){var e=d3.geoEquirectangular().scale(v).translate([0,0]);function i(e){return t([.5*e[0],y(Math.tan(.5*e[1]*m))*v])}return t.invert&&(i.invert=function(e){return(e=t.invert(e))[0]*=2,e[1]=2*Math.atan(Math.sin(e[1]*m))*v,e}),i.stream=function(i){i=t.stream(i);var n=e.stream({point:function(t,e){i.point(.5*t,y(Math.tan(.5*-e*m))*v)},lineStart:function(){i.lineStart()},lineEnd:function(){i.lineEnd()},polygonStart:function(){i.polygonStart()},polygonEnd:function(){i.polygonEnd()}});return n.sphere=function(){i.sphere()},n.valid=!1,n},i};var ut=d3.geoAzimuthalEquidistant.raw;function ct(t,e){var i=2*d/e,n=t*t;function r(e,r){var o=ut(e,r),a=o[0],s=o[1],l=a*a+s*s;if(l>n){var u=Math.sqrt(l),h=Math.atan2(s,a),p=i*Math.round(h/i),m=h-p,v=t*Math.cos(m),g=(t*Math.sin(m)-m*Math.sin(v))/(f-v),y=ht(m,g),_=(d-t)/dt(y,v,d);a=u;var b,x=50;do{a-=b=(t+dt(y,v,a)*_-u)/(y(a)*_)}while(Math.abs(b)>c&&--x>0);s=m*Math.sin(a),a<f&&(s-=g*(a-f));var w=Math.sin(p),S=Math.cos(p);o[0]=a*S-s*w,o[1]=a*w+s*S}return o}return r.invert=function(e,r){var o=e*e+r*r;if(o>n){var a=Math.sqrt(o),s=Math.atan2(r,e),l=i*Math.round(s/i),u=s-l;e=a*Math.cos(u);r=a*Math.sin(u);for(var c=e-f,p=Math.sin(e),m=r/p,v=e<f?1/0:0,g=10;;){var y=t*Math.sin(m),_=t*Math.cos(m),b=Math.sin(_),x=f-_,w=(y-m*b)/x,S=ht(m,w);if(Math.abs(v)<h||!--g)break;m-=v=(m*p-w*c-r)/(p-2*c*(x*(_+m*y*Math.cos(_)-b)-y*(y-m*b))/(x*x))}s=l+m,e=(a=t+dt(S,_,e)*(d-t)/dt(S,_,d))*Math.cos(s),r=a*Math.sin(s)}return ut.invert(e,r)},r}function ht(t,e){return function(i){var n=t*Math.cos(i);return i<f&&(n-=e),Math.sqrt(1+n*n)}}function dt(t,e,i){for(var n=(i-e)/50,r=t(e)+t(i),o=1,a=e;o<50;++o)r+=2*t(a+=n);return.5*r*n}function ft(t,e,i,n,r,o,a,s){function l(l,u){if(!u)return[t*l/d,0];var c=u*u,h=t+c*(e+c*(i+c*n)),f=u*(r-1+c*(o-s+c*a)),p=(h*h+f*f)/(2*f),m=l*Math.asin(h/p)/d;return[p*Math.sin(m),u*(1+c*s)+p*(1-Math.cos(m))]}return arguments.length<8&&(s=0),l.invert=function(l,u){var h,f,p=d*l/t,m=u,v=50;do{var g=m*m,y=t+g*(e+g*(i+g*n)),_=m*(r-1+g*(o-s+g*a)),x=y*y+_*_,w=2*_,S=x/w,M=S*S,E=Math.asin(y/S)/d,z=p*E;if(xB2=y*y,dxBd=(2*e+g*(4*i+6*g*n))*m,dyBd=r+g*(3*o+5*g*a),dpd=2*(y*dxBd+_*(dyBd-1)),dqd=2*(dyBd-1),dmd=(dpd*w-x*dqd)/(w*w),cos=Math.cos(z),sin=Math.sin(z),mcos=S*cos,msin=S*sin,dd=p/d*(1/b(1-xB2/M))*(dxBd*S-y*dmd)/M,fx=msin-l,fy=m*(1+g*s)+S-mcos-u,x=dmd*sin+mcos*dd,x=mcos*E,y=1+dmd-(dmd*cos-msin*dd),y=msin*E,denominator=x*y-y*x,!denominator)break;p-=h=(fy*x-fx*y)/denominator,m-=f=(fx*y-fy*x)/denominator}while((Math.abs(h)>c||Math.abs(f)>c)&&--v>0);return[p,m]},l}(d3.geoGingery=function(){var t=6,e=30*m,i=Math.cos(e),n=Math.sin(e),r=w(ct),o=r(e,t),a=o.stream,s=-Math.cos(.01*m),l=Math.sin(.01*m);return o.radius=function(o){return arguments.length?(i=Math.cos(e=o*m),n=Math.sin(e),r(e,t)):e*v},o.lobes=function(i){return arguments.length?r(e,t=+i):t},o.stream=function(e){var r=o.rotate(),u=a(e),c=(o.rotate([0,0]),a(e));return o.rotate(r),u.sphere=function(){c.polygonStart(),c.lineStart();for(var e=0,r=2*d/t,o=0;e<t;++e,o-=r)c.point(Math.atan2(l*Math.cos(o),s)*v,Math.asin(l*Math.sin(o))*v),c.point(Math.atan2(n*Math.cos(o-r/2),i)*v,Math.asin(n*Math.sin(o-r/2))*v);c.lineEnd(),c.polygonEnd()},u},o}).raw=ct;var pt=ft(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geoGinzburg4=function(){return x(pt)}).raw=pt;var mt=ft(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geoGinzburg5=function(){return x(mt)}).raw=mt;var vt=ft(5/6*d,-.62636,-.0344,0,1.3493,-.05524,0,.045);function gt(t,e){var i=t*t,n=e*e;return[t*(1-.162388*n)*(.87-952426e-9*i*i),e*(1+n/12)]}(d3.geoGinzburg6=function(){return x(vt)}).raw=vt,gt.invert=function(t,e){var i,n=t,r=e,o=50;do{var a=r*r;r-=i=(r*(1+a/12)-e)/(1+a/4)}while(Math.abs(i)>c&&--o>0);o=50,t/=1-.162388*a;do{var s=(s=n*n)*s;n-=i=(n*(.87-952426e-9*s)-t)/(.87-.00476213*s)}while(Math.abs(i)>c&&--o>0);return[n,r]},(d3.geoGinzburg8=function(){return x(gt)}).raw=gt;var yt=ft(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);function _t(t){var e=t(f,0)[0]-t(-f,0)[0];function i(){var t=!1,e=w(n),i=e(t);return i.quincuncial=function(i){return arguments.length?e(t=!!i):t},i}function n(i){var n=i?function(i,n){var r=Math.abs(i)<f,o=t(r?i:i>0?i-d:i+d,n),a=(o[0]-o[1])*Math.SQRT1_2,s=(o[0]+o[1])*Math.SQRT1_2;if(r)return[a,s];var l=e*Math.SQRT1_2,u=a>0^s>0?-1:1;return[u*a-g(s)*l,u*s-g(a)*l]}:function(i,n){var r=i>0?-.5:.5,o=t(i+r*d,n);return o[0]-=r*e,o};return t.invert&&(n.invert=i?function(i,n){var r=(i+n)*Math.SQRT1_2,o=(n-i)*Math.SQRT1_2,a=Math.abs(r)<.5*e&&Math.abs(o)<.5*e;if(!a){var s=e*Math.SQRT1_2,l=r>0^o>0?-1:1,u=-l*(i+(o>0?1:-1)*s),c=-l*(n+(r>0?1:-1)*s);r=(-u-c)*Math.SQRT1_2,o=(u-c)*Math.SQRT1_2}var h=t.invert(r,o);return a||(h[0]+=r>0?d:-d),h}:function(i,n){var r=i>0?-.5:.5,o=t.invert(i+r*e,n),a=o[0]-r*d;return a<-d?a+=2*d:a>d&&(a-=2*d),o[0]=a,o}),n}return i.raw=n,i}function bt(t,e){var i=g(t),n=g(e),r=Math.cos(e),o=Math.cos(t)*r,a=Math.sin(t)*r,s=Math.sin(n*e);t=Math.abs(Math.atan2(a,s)),e=y(o),Math.abs(t-f)>c&&(t%=f);var l=function(t,e){if(e===f)return[0,0];var i=Math.sin(e),n=i*i,r=n*n,o=1+r,a=1+3*r,s=1-r,l=y(1/Math.sqrt(o)),u=s+n*o*l,h=(1-i)/u,p=Math.sqrt(h),m=h*o,v=Math.sqrt(m),g=p*s;if(0===t)return[0,-(g+n*v)];var _=Math.cos(e),x=1/_,w=2*i*_,S=(-u*_-(-3*n+l*a)*w*(1-i))/(u*u),M=-x*w,E=-x*(n*o*S+h*a*w),z=-2*x*(s*(.5*S/p)-2*n*p*w),k=4*t/d;if(t>.222*d||e<d/4&&t>.175*d){var T=(g+n*b(m*(1+r)-g*g))/(1+r);if(t>d/4)return[T,T];var O=T,C=.5*T,P=50;T=.5*(C+O);do{var A=Math.sqrt(m-T*T),I=T*(z+M*A)+E*y(T/v)-k;if(!I)break;I<0?C=T:O=T,T=.5*(C+O)}while(Math.abs(O-C)>c&&--P>0)}else{var L,T=c,P=25;do{var D=T*T,A=b(m-D),R=z+M*A,I=T*R+E*y(T/v)-k,j=R+(E-M*D)/A;T-=L=A?I/j:0}while(Math.abs(L)>c&&--P>0)}return[T,-g-n*b(m-T*T)]}(t>d/4?f-t:t,e);return t>d/4&&(s=l[0],l[0]=-l[1],l[1]=-s),l[0]*=i,l[1]*=-n,l}function xt(t,e){var i,n,r,o,a,s;if(e<c)return[(o=Math.sin(t))-(i=.25*e*(t-o*(n=Math.cos(t))))*n,n+i*o,1-.5*e*o*o,t-i];if(e>=1-c)return i=.25*(1-e),n=k(t),s=t,r=1/n,[(o=((s=Math.exp(2*s))-1)/(s+1))+i*((a=n*z(t))-t)/(n*n),r-i*o*r*(a-t),r+i*o*r*(a+t),2*Math.atan(Math.exp(t))-f+i*(a-t)/n];var l=[1,0,0,0,0,0,0,0,0],u=[Math.sqrt(e),0,0,0,0,0,0,0,0],h=0;for(n=Math.sqrt(1-e),a=1;Math.abs(u[h]/l[h])>c&&h<8;)i=l[h++],u[h]=.5*(i-n),l[h]=.5*(i+n),n=b(i*n),a*=2;r=a*l[h]*t;do{r=.5*(y(o=u[h]*Math.sin(n=r)/l[h])+r)}while(--h);return[Math.sin(r),o=Math.cos(r),o/Math.cos(r-n),r]}function wt(t,e){if(!e)return t;if(1===e)return Math.log(Math.tan(t/2+d/4));for(var i=1,n=Math.sqrt(1-e),r=Math.sqrt(e),o=0;Math.abs(r)>c;o++){if(t%d){var a=Math.atan(n*Math.tan(t)/i);a<0&&(a+=d),t+=a+~~(t/d)*d}else t+=t;r=(i+n)/2,n=Math.sqrt(i*n),r=((i=r)-n)/2}return t/(Math.pow(2,o)*i)}function St(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),r=wt(f,n*n),o=Math.log(Math.tan(d/4+Math.abs(e)/2)),a=Math.exp(-1*o)/Math.sqrt(i),s=function(t,e){var i=t*t,n=e+1,r=1-i-e*e;return[.5*((t>=0?f:-f)-Math.atan2(r,2*t)),-.25*Math.log(r*r+4*i)+.5*Math.log(n*n+i)]}(a*Math.cos(-1*t),a*Math.sin(-1*t)),l=function(t,e,i){var n=Math.abs(t),r=z(Math.abs(e));if(n){var o=1/Math.sin(n),a=1/(Math.tan(n)*Math.tan(n)),s=-(a+i*r*r*o*o-1+i),l=(i-1)*a,u=.5*(-s+Math.sqrt(s*s-4*l));return[wt(Math.atan(1/Math.sqrt(u)),i)*g(t),wt(Math.atan(b((u/a-1)/i)),1-i)*g(e)]}return[0,wt(Math.atan(r),1-i)*g(e)]}(s[0],s[1],n*n);return[-l[1],(e>=0?1:-1)*(.5*r-l[0])]}function Mt(t){var e=Math.sin(t),i=Math.cos(t),n=Et(t);function r(t,r){var o=n(t,r);t=o[0],r=o[1];var a=Math.sin(r),s=Math.cos(r),l=Math.cos(t),u=_(e*a+i*s*l),h=Math.sin(u),d=Math.abs(h)>c?u/h:1;return[d*i*Math.sin(t),(Math.abs(t)>f?d:-d)*(e*s-i*a*l)]}return n.invert=Et(-t),r.invert=function(t,i){var r=Math.sqrt(t*t+i*i),o=-Math.sin(r),a=Math.cos(r),s=r*a,l=-i*o,u=r*e,c=b(s*s+l*l-u*u),h=Math.atan2(s*u+l*c,l*u-s*c),d=(r>f?-1:1)*Math.atan2(t*o,r*Math.cos(h)*a+i*Math.sin(h)*o);return n.invert(d,h)},r}function Et(t){var e=Math.sin(t),i=Math.cos(t);return function(t,n){var r=Math.cos(n),o=Math.cos(t)*r,a=Math.sin(t)*r,s=Math.sin(n);return[Math.atan2(a,o*i-s*e),y(s*i+o*e)]}}(d3.geoGinzburg9=function(){return x(yt)}).raw=yt,bt.invert=function(t,e){var i=g(t),n=g(e),r=-i*t,o=-n*e,a=o/r<1,s=function(t,e){var i=0,n=1,r=.5,o=50;for(;;){var a=r*r,s=Math.sqrt(r),l=Math.asin(1/Math.sqrt(1+a)),u=1-a+r*(1+a)*l,c=(1-s)/u,f=Math.sqrt(c),p=c*(1+a),m=f*(1-a),v=p-t*t,g=Math.sqrt(v),y=e+m+r*g;if(Math.abs(n-i)<h||0==--o||0===y)break;y>0?i=r:n=r,r=.5*(i+n)}if(!o)return null;var _=Math.asin(s),b=Math.cos(_),x=1/b,w=2*s*b,S=(-u*b-(-3*r+l*(1+3*a))*w*(1-s))/(u*u);return[d/4*(t*(-2*x*(.5*S/f*(1-a)-2*r*f*w)+-x*w*g)+-x*(r*(1+a)*S+c*(1+3*a)*w)*Math.asin(t/Math.sqrt(p))),_]}(a?o:r,a?r:o),l=s[0],u=s[1];a&&(l=-f-l);var c=Math.cos(u),p=(t=Math.cos(l)*c,e=Math.sin(l)*c,Math.sin(u));return[i*(Math.atan2(e,-p)+d),n*y(t)]},d3.geoGringorten=_t(bt),St.invert=function(t,e){var i,n,r,o=(Math.SQRT2-1)/(Math.SQRT2+1),a=Math.sqrt(1-o*o),s=function(t,e,i){if(!t)return[[0,(r=xt(e,1-i))[0]/r[1]],[1/r[1],0],[r[2]/r[1],0]];var n=xt(t,i);if(!e)return[[n[0],0],[n[1],0],[n[2],0]];var r,o=(r=xt(e,1-i))[1]*r[1]+i*n[0]*n[0]*r[0]*r[0];return[[n[0]*r[2]/o,n[1]*n[2]*r[0]*r[1]/o],[n[1]*r[1]/o,-n[0]*n[2]*r[0]*r[2]/o],[n[2]*r[1]*r[2]/o,-i*n[0]*n[1]*r[0]/o]]}(.5*wt(f,a*a)-e,-t,a*a),l=(i=s[0],n=s[1],r=n[0]*n[0]+n[1]*n[1],[(i[0]*n[0]+i[1]*n[1])/r,(i[1]*n[0]-i[0]*n[1])/r]);return[Math.atan2(l[1],l[0])/-1,2*Math.atan(Math.exp(-.5*Math.log(o*l[0]*l[0]+o*l[1]*l[1])))-f]},d3.geoGuyou=_t(St),(d3.geoHammerRetroazimuthal=function(){var t=0,e=w(Mt),i=e(t),n=i.rotate,r=i.stream,o=d3.geoCircle();return i.parallel=function(n){if(!arguments.length)return t/d*180;var r=i.rotate();return e(t=n*d/180).rotate(r)},i.rotate=function(e){return arguments.length?(n.call(i,[e[0],e[1]-t/d*180]),o.center([-e[0],-e[1]]),i):((e=n.call(i))[1]+=t/d*180,e)},i.stream=function(t){return(t=r(t)).sphere=function(){t.polygonStart();var e,i=o.radius(89.99)().coordinates[0],n=i.length-1,r=-1;for(t.lineStart();++r<n;)t.point((e=i[r])[0],e[1]);for(t.lineEnd(),n=(i=o.radius(90.01)().coordinates[0]).length-1,t.lineStart();--r>=0;)t.point((e=i[r])[0],e[1]);t.lineEnd(),t.polygonEnd()},t},i}).raw=Mt;var zt=d3.geoAzimuthalEqualArea.raw;function kt(t,e){if(arguments.length<2&&(e=t),1===e)return zt;if(e===1/0)return Tt;function i(i,n){var r=zt(i/e,n);return r[0]*=t,r}return i.invert=function(i,n){var r=zt.invert(i/t,n);return r[0]*=e,r},i}function Tt(t,e){return[t*Math.cos(e)/Math.cos(e/=2),2*Math.sin(e)]}function Ot(t,e){for(var i,n=Math.sin(e)*(e<0?2.43763:2.67595),r=0;r<20&&(e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e)),!(Math.abs(i)<c));r++);return[.85*t*Math.cos(e*=.5),Math.sin(e)*(e<0?1.93052:1.75859)]}Tt.invert=function(t,e){var i=2*y(e/2);return[t*Math.cos(i/2)/Math.cos(i),i]},(d3.geoHammer=function(){var t=2,e=w(kt),i=e(t);return i.coefficient=function(i){return arguments.length?e(t=+i):t},i}).raw=kt,Ot.invert=function(t,e){var i=Math.abs(i=e*(e<0?.5179951515653813:.5686373742600607))>1-c?i>0?f:-f:y(i);return[1.1764705882352942*t/Math.cos(i),Math.abs(i=((i+=i)+Math.sin(i))*(e<0?.4102345310814193:.3736990601468637))>1-c?i>0?f:-f:y(i)]},(d3.geoHatano=function(){return x(Ot)}).raw=Ot;var Ct=41+48/36+37/3600;function Pt(t){var e=d3.geoCylindricalEqualArea.raw(0),i=Ct*d/180,n=2*d,r=d3.geoCollignon.raw(d,i)[0]-d3.geoCollignon.raw(-d,i)[0],o=e(0,i)[1],a=d3.geoCollignon.raw(0,i)[1],s=d3.geoCollignon.raw(0,f)[1]-a,l=2*d/t;function u(u,c){var h,f=Math.abs(c);if(f>i){var p=Math.min(t-1,Math.max(0,Math.floor((u+d)/l)));u+=d*(t-1)/t-p*l,(h=d3.geoCollignon.raw(u,f))[0]=h[0]*n/r-n*(t-1)/(2*t)+p*n/t,h[1]=o+4*(h[1]-a)*s/n,c<0&&(h[1]=-h[1])}else h=e(u,c);return h[0]/=2,h}return u.invert=function(i,u){i*=2;var c=Math.abs(u);if(c>o){var h=Math.min(t-1,Math.max(0,Math.floor((i+d)/l)));i=(i+d*(t-1)/t-h*l)*r/n;var f=d3.geoCollignon.raw.invert(i,.25*(c-o)*n/s+a);return f[0]-=d*(t-1)/t-h*l,u<0&&(f[1]=-f[1]),f}return e.invert(i,u)},u}function At(t){var e,i=1+t,n=y(Math.sin(1/i)),r=2*Math.sqrt(d/(e=d+4*n*i)),o=.5*r*(i+Math.sqrt(t*(2+t))),a=t*t,s=i*i;function l(l,u){var c,p,m=1-Math.sin(u);if(m&&m<2){var v,g=f-u,y=25;do{var _=Math.sin(g),b=Math.cos(g),x=n+Math.atan2(_,i-b),w=1+s-2*i*b;g-=v=(g-a*n-i*_+w*x-.5*m*e)/(2*i*_*x)}while(Math.abs(v)>h&&--y>0);c=r*Math.sqrt(w),p=l*x/d}else c=r*(t+m),p=l*n/d;return[c*Math.sin(p),o-c*Math.cos(p)]}return l.invert=function(t,l){var u=t*t+(l-=o)*l,c=(1+s-u/(r*r))/(2*i),h=_(c),f=Math.sin(h),p=n+Math.atan2(f,i-c);return[y(t/Math.sqrt(u))*d/p,y(1-2*(h-a*n-i*f+(1+s-2*i*c)*p)/e)]},l}(d3.geoHealpix=function(){var t=2,e=w(Pt),i=e(t),n=i.stream;return i.lobes=function(i){return arguments.length?e(t=+i):t},i.stream=function(e){var r=i.rotate(),o=n(e),a=(i.rotate([0,0]),n(e));return i.rotate(r),o.sphere=function(){var e;d3.geoStream((e=180/t,{type:"Polygon",coordinates:[d3.range(-180,180+e/2,e).map(function(t,e){return[t,1&e?90-1e-6:Ct]}).concat(d3.range(180,-180-e/2,-e).map(function(t,e){return[t,1&e?1e-6-90:-Ct]}))]}),a)},o},i}).raw=Pt,(d3.geoHill=function(){var t=1,e=w(At),i=e(t);return i.ratio=function(i){return arguments.length?e(t=+i):t},i}).raw=At;var It=.7109889596207567,Lt=.0528035274542;function Dt(t,e){return e>-It?((t=R(t,e))[1]+=Lt,t):B(t,e)}function Rt(t,e){return Math.abs(e)>It?((t=R(t,e))[1]-=e>0?Lt:-Lt,t):B(t,e)}function jt(t,e){return[3*t/(2*d)*Math.sqrt(d*d/3-e*e),e]}function Ft(t){function e(e,i){if(Math.abs(Math.abs(i)-f)<c)return[0,i<0?-2:2];var n=Math.sin(i),r=Math.pow((1+n)/(1-n),t/2),o=.5*(r+1/r)+Math.cos(e*=t);return[2*Math.sin(e)/o,(r-1/r)/o]}return e.invert=function(e,i){var n=Math.abs(i);if(Math.abs(n-2)<c)return e?null:[0,g(i)*f];if(n>2)return null;var r=(e/=2)*e,o=(i/=2)*i,a=2*i/(1+r+o);return a=Math.pow((1+a)/(1-a),1/t),[Math.atan2(2*e,1-r-o)/t,y((a-1)/(a+1))]},e}function Bt(t,e){return[t*(1+Math.sqrt(Math.cos(e)))/2,e/(Math.cos(e/2)*Math.cos(t/6))]}function Nt(t,e){var i=t*t,n=e*e;return[t*(.975534+n*(-.0143059*i-.119161+-.0547009*n)),e*(1.00384+i*(.0802894+-.02855*n+199025e-9*i)+n*(.0998909+-.0491032*n))]}function qt(t,e){return[Math.sin(t)/Math.cos(e),Math.tan(e)*Math.cos(t)]}function Vt(t){var e=Math.cos(t),i=Math.tan(d/4+t/2);function n(n,r){var o=r-t,a=Math.abs(o)<c?n*e:Math.abs(a=d/4+r/2)<c||Math.abs(Math.abs(a)-f)<c?0:n*o/Math.log(Math.tan(a)/i);return[a,o]}return n.invert=function(n,r){var o,a=r+t;return[Math.abs(r)<c?n/e:Math.abs(o=d/4+a/2)<c||Math.abs(Math.abs(o)-f)<c?0:n*Math.log(Math.tan(o)/i)/r,a]},n}function Ht(t,e){return[t,1.25*Math.log(Math.tan(d/4+.4*e))]}function Ut(t){var e=t.length-1;function i(i,n){for(var r,o=Math.cos(n),a=2/(1+o*Math.cos(i)),s=a*o*Math.sin(i),l=a*Math.sin(n),u=e,c=t[u],h=c[0],d=c[1];--u>=0;)h=(c=t[u])[0]+s*(r=h)-l*d,d=c[1]+s*d+l*r;return[h=s*(r=h)-l*d,d=s*d+l*r]}return i.invert=function(i,n){var r=20,o=i,a=n;do{for(var s,l=e,u=t[l],h=u[0],d=u[1],f=0,p=0;--l>=0;)u=t[l],f=h+o*(s=f)-a*p,p=d+o*p+a*s,h=u[0]+o*(s=h)-a*d,d=u[1]+o*d+a*s;var m,v,g=(f=h+o*(s=f)-a*p)*f+(p=d+o*p+a*s)*p;o-=m=((h=o*(s=h)-a*d-i)*f+(d=o*d+a*s-n)*p)/g,a-=v=(d*f-h*p)/g}while(Math.abs(m)+Math.abs(v)>c*c&&--r>0);if(r){var _=Math.sqrt(o*o+a*a),b=2*Math.atan(.5*_),x=Math.sin(b);return[Math.atan2(o*x,_*Math.cos(b)),_?y(a*x/_):0]}},i}Dt.invert=function(t,e){return e>-It?R.invert(t,e-Lt):B.invert(t,e)},(d3.geoSinuMollweide=function(){return x(Dt).rotate([-20,-55])}).raw=Dt,Rt.invert=function(t,e){return Math.abs(e)>It?R.invert(t,e+(e>0?Lt:-Lt)):B.invert(t,e)},(d3.geoHomolosine=function(){return x(Rt)}).raw=Rt,jt.invert=function(t,e){return[2/3*d*t/Math.sqrt(d*d/3-e*e),e]},(d3.geoKavrayskiy7=function(){return x(jt)}).raw=jt,(d3.geoLagrange=function(){var t=.5,e=w(Ft),i=e(t);return i.spacing=function(i){return arguments.length?e(t=+i):t},i}).raw=Ft,Bt.invert=function(t,e){var i=Math.abs(t),n=Math.abs(e),r=d/Math.SQRT2,o=c,a=f;n<r?a*=n/r:o+=6*_(r/n);for(var s=0;s<25;s++){var l=Math.sin(a),u=b(Math.cos(a)),h=Math.sin(a/2),p=Math.cos(a/2),m=Math.sin(o/6),v=Math.cos(o/6),g=.5*o*(1+u)-i,y=a/(p*v)-n,x=u?-.25*o*l/u:0,w=.5*(1+u),S=(1+.5*a*h/p)/(p*v),M=a/p*(m/6)/(v*v),E=x*M-S*w,z=(g*M-y*w)/E,k=(y*x-g*S)/E;if(a-=z,o-=k,Math.abs(z)<c&&Math.abs(k)<c)break}return[t<0?-o:o,e<0?-a:a]},(d3.geoLarrivee=function(){return x(Bt)}).raw=Bt,Nt.invert=function(t,e){var i=g(t)*d,n=e/2,r=50;do{var o=i*i,a=n*n,s=i*n,l=i*(.975534+a*(-.0143059*o-.119161+-.0547009*a))-t,u=n*(1.00384+o*(.0802894+-.02855*a+199025e-9*o)+a*(.0998909+-.0491032*a))-e,h=.975534-a*(.119161+3*o*.0143059+.0547009*a),f=-s*(.238322+.2188036*a+.0286118*o),p=s*(.1605788+7961e-7*o+-.0571*a),m=1.00384+o*(.0802894+199025e-9*o)+a*(3*(.0998909-.02855*o)-.245516*a),v=f*p-m*h,y=(u*f-l*m)/v,_=(l*p-u*h)/v;i-=y,n-=_}while((Math.abs(y)>c||Math.abs(_)>c)&&--r>0);return r&&[i,n]},(d3.geoLaskowski=function(){return x(Nt)}).raw=Nt,qt.invert=function(t,e){var i=t*t,n=e*e,r=n+1,o=t?Math.SQRT1_2*Math.sqrt((r-Math.sqrt(i*i+2*i*(n-1)+r*r))/i+1):1/Math.sqrt(r);return[y(t*o),g(e)*_(o)]},(d3.geoLittrow=function(){return x(qt)}).raw=qt,(d3.geoLoximuthal=function(){return F(Vt).parallel(40)}).raw=Vt,Ht.invert=function(t,e){return[t,2.5*Math.atan(Math.exp(.8*e))-.625*d]},(d3.geoMiller=function(){return x(Ht)}).raw=Ht;var Wt={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};function Kt(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),r=Math.asin(7*Math.sin(e)/(3*i));return[i*t*(2*Math.cos(2*r/3)-1)/n,9*Math.sin(r/3)/n]}function Gt(t,e){for(var i,n=(1+Math.SQRT1_2)*Math.sin(e),r=e,o=0;o<25&&(r-=i=(Math.sin(r/2)+Math.sin(r)-n)/(.5*Math.cos(r/2)+Math.cos(r)),!(Math.abs(i)<c));o++);return[t*(1+2*Math.cos(r)/Math.cos(r/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(r/2)/Math.sqrt(2+Math.SQRT2)]}function Xt(t,e){for(var i,n=Math.sqrt(6/(4+d)),r=(1+d/4)*Math.sin(e),o=e/2,a=0;a<25&&(o-=i=(o/2+Math.sin(o)-r)/(.5+Math.cos(o)),!(Math.abs(i)<c));a++);return[n*(.5+Math.cos(o))*t/1.5,n*o]}function Yt(t,e){var i=e*e,n=i*i;return[t*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791)),e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))]}function Zt(t,e){return[t*(1+Math.cos(e))/2,2*(e-Math.tan(e/2))]}(d3.geoModifiedStereographic=function(){var t=Wt.miller,e=w(Ut),i=e(t);return i.coefficients=function(i){return arguments.length?e(t="string"==typeof i?Wt[i]:i):t},i}).raw=Ut,Kt.invert=function(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),r=3*y(e*n/9);return[t*n/(i*(2*Math.cos(2*r/3)-1)),y(3*Math.sin(r)*i/7)]},(d3.geoMtFlatPolarParabolic=function(){return x(Kt)}).raw=Kt,Gt.invert=function(t,e){var i=e*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),n=2*y(i);return[3*Math.SQRT2*t/(1+2*Math.cos(n)/Math.cos(n/2)),y((i+Math.sin(n))/(1+Math.SQRT1_2))]},(d3.geoMtFlatPolarQuartic=function(){return x(Gt)}).raw=Gt,Xt.invert=function(t,e){var i=Math.sqrt(6/(4+d)),n=e/i;return Math.abs(Math.abs(n)-f)<c&&(n=n<0?-f:f),[1.5*t/(i*(.5+Math.cos(n))),y((n/2+Math.sin(n))/(1+d/4))]},(d3.geoMtFlatPolarSinusoidal=function(){return x(Xt)}).raw=Xt,Yt.invert=function(t,e){var i,n=e,r=25;do{var o=n*n,a=o*o;n-=i=(n*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(Math.abs(i)>c&&--r>0);return[t/(.8707+(o=n*n)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),n]},(d3.geoNaturalEarth=function(){return x(Yt)}).raw=Yt,Zt.invert=function(t,e){for(var i=e/2,n=0,r=1/0;n<10&&Math.abs(r)>c;n++){var o=Math.cos(e/2);e-=r=(e-Math.tan(e/2)-i)/(1-.5/(o*o))}return[2*t/(1+Math.cos(e)),e]},(d3.geoNellHammer=function(){return x(Zt)}).raw=Zt;var $t=1.0148,Qt=.23185,Jt=-.14499,te=.02406,ee=$t,ie=5*Qt,ne=7*Jt,re=9*te;function oe(t,e){var i=e*e;return[t,e*($t+i*i*(Qt+i*(Jt+te*i)))]}oe.invert=function(t,e){e>1.790857183?e=1.790857183:e<-1.790857183&&(e=-1.790857183);var i,n=e;do{var r=n*n;n-=i=(n*($t+r*r*(Qt+r*(Jt+te*r)))-e)/(ee+r*r*(ie+r*(ne+re*r)))}while(Math.abs(i)>c);return[t,n]},(d3.geoPatterson=function(){return x(oe)}).raw=oe;var ae=_t(St);function se(t,e){if(Math.abs(e)<c)return[t,0];var i=Math.tan(e),n=t*Math.sin(e);return[Math.sin(n)/i,e+(1-Math.cos(n))/i]}function le(t){var e=Math.sin(t);function i(i,n){var r=e?Math.tan(i*e/2)/e:i/2;if(!n)return[2*r,-t];var o=2*Math.atan(r*Math.sin(n)),a=1/Math.tan(n);return[Math.sin(o)*a,n+(1-Math.cos(o))*a-t]}return i.invert=function(i,n){if(Math.abs(n+=t)<c)return[e?2*Math.atan(e*i/2)/e:i,0];var r,o=i*i+n*n,a=0,s=10;do{var l=Math.tan(a),u=1/Math.cos(a),h=o-2*n*a+a*a;a-=r=(l*h+2*(a-n))/(2+h*u*u+2*(a-n)*l)}while(Math.abs(r)>c&&--s>0);var f=i*(l=Math.tan(a)),p=Math.tan(Math.abs(n)<Math.abs(a+1/l)?.5*y(f):.5*_(f)+d/4)/Math.sin(a);return[e?2*Math.atan(e*p)/e:2*p,a]},i}(d3.geoPeirceQuincuncial=function(){return ae().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=ae.raw,se.invert=function(t,e){if(Math.abs(e)<c)return[t,0];var i,n=t*t+e*e,r=.5*e,o=10;do{var a=Math.tan(r),s=1/Math.cos(r),l=n-2*e*r+r*r;r-=i=(a*l+2*(r-e))/(2+l*s*s+2*(r-e)*a)}while(Math.abs(i)>c&&--o>0);return a=Math.tan(r),[(Math.abs(e)<Math.abs(r+1/a)?y(t*a):g(t)*(_(Math.abs(t*a))+f))/Math.sin(r),r]},(d3.geoPolyconic=function(){return x(se)}).raw=se,(d3.geoRectangularPolyconic=function(){return F(le)}).raw=le;var ue=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];function ce(t,e){var i,n=Math.min(18,36*Math.abs(e)/d),r=Math.floor(n),o=n-r,a=(i=ue[r])[0],s=i[1],l=(i=ue[++r])[0],u=i[1],c=(i=ue[Math.min(19,++r)])[0],h=i[1];return[t*(l+o*(c-a)/2+o*o*(c-2*l+a)/2),(e>0?f:-f)*(u+o*(h-s)/2+o*o*(h-2*u+s)/2)]}function he(t,e){var i=function(t){function e(e,i){var n=Math.cos(i),r=(t-1)/(t-n*Math.cos(e));return[r*n*Math.sin(e),r*Math.sin(i)]}return e.invert=function(e,i){var n=e*e+i*i,r=Math.sqrt(n),o=(t-Math.sqrt(1-n*(t+1)/(t-1)))/((t-1)/r+r/(t-1));return[Math.atan2(e*o,r*Math.sqrt(1-o*o)),r?y(i*o/r):0]},e}(t);if(!e)return i;var n=Math.cos(e),r=Math.sin(e);function o(e,o){var a=i(e,o),s=a[1],l=s*r/(t-1)+n;return[a[0]*n/l,s/l]}return o.invert=function(e,o){var a=(t-1)/(t-1-o*r);return i.invert(a*e,a*o*n)},o}function de(t,e){var i=Math.tan(e/2),n=Math.sin(d/4*i);return[t*(.74482-.34588*n*n),1.70711*i]}function fe(t){if(!t)return d3.geoAzimuthalEquidistant.raw;var e=-t/2,i=-e,n=t*t,r=Math.tan(i),o=.5/Math.sin(i);function a(r,o){var a=_(Math.cos(o)*Math.cos(r-e)),s=_(Math.cos(o)*Math.cos(r-i));return[((a*=a)-(s*=s))/(2*t),(o<0?-1:1)*b(4*n*s-(n-a+s)*(n-a+s))/(2*t)]}return a.invert=function(t,n){var a,s,l=n*n,u=Math.cos(Math.sqrt(l+(a=t+e)*a)),c=Math.cos(Math.sqrt(l+(a=t+i)*a));return[Math.atan2(s=u-c,a=(u+c)*r),(n<0?-1:1)*_(Math.sqrt(a*a+s*s)*o)]},a}function pe(t){var e=Math.cos(t);function i(t,i){var n=d3.geoGnomonic.raw(t,i);return n[0]*=e,n}return i.invert=function(t,i){return d3.geoGnomonic.raw.invert(t/e,i)},i}function me(t,e){if(Math.abs(e)<c)return[t,0];var i=Math.abs(e/f),n=y(i);if(Math.abs(t)<c||Math.abs(Math.abs(e)-f)<c)return[0,g(e)*d*Math.tan(n/2)];var r=Math.cos(n),o=Math.abs(d/t-t/d)/2,a=o*o,s=r/(i+r-1),l=s*(2/i-1),u=l*l,h=u+a,p=s-u,m=a+s;return[g(t)*d*(o*p+Math.sqrt(a*p*p-h*(s*s-u)))/h,g(e)*d*(l*m-o*Math.sqrt((a+1)*h-m*m))/h]}function ve(t,e){if(Math.abs(e)<c)return[t,0];var i=Math.abs(e/f),n=y(i);if(Math.abs(t)<c||Math.abs(Math.abs(e)-f)<c)return[0,g(e)*d*Math.tan(n/2)];var r=Math.cos(n),o=Math.abs(d/t-t/d)/2,a=o*o,s=r*(Math.sqrt(1+a)-o*r)/(1+a*i*i);return[g(t)*d*s,g(e)*d*b(1-s*(2*o+s))]}function ge(t,e){if(Math.abs(e)<c)return[t,0];var i=e/f,n=y(i);if(Math.abs(t)<c||Math.abs(Math.abs(e)-f)<c)return[0,d*Math.tan(n/2)];var r=(d/t-t/d)/2,o=i/(1+Math.cos(n));return[d*(g(t)*b(r*r+1-o*o)-r),d*o]}function ye(t,e){if(!e)return[t,0];var i=Math.abs(e);if(!t||i===f)return[0,e];var n=i/f,r=n*n,o=(8*n-r*(r+2)-5)/(2*r*(n-1)),a=o*o,s=n*o,l=r+a+2*s,u=n+3*o,c=t/f,h=c+1/c,d=g(Math.abs(t)-f)*Math.sqrt(h*h-4),p=d*d,m=(d*(l+a-1)+2*b(l*(r+a*p-1)+(1-r)*(r*(u*u+4*a)+12*s*a+4*a*a)))/(4*l+p);return[g(t)*f*m,g(e)*f*b(1+d*Math.abs(m)-m*m)]}ue.forEach(function(t){t[1]*=1.0144}),ce.invert=function(t,e){var i=e/f,n=90*i,r=Math.min(18,Math.abs(n/5)),o=Math.max(0,Math.floor(r));do{var a=ue[o][1],s=ue[o+1][1],l=ue[Math.min(19,o+2)][1],u=l-a,c=l-2*s+a,d=2*(Math.abs(i)-s)/u,p=c/u,g=d*(1-p*d*(1-2*p*d));if(g>=0||1===o){n=(e>=0?5:-5)*(g+r);var y,_=50;do{g=(r=Math.min(18,Math.abs(n)/5))-(o=Math.floor(r)),a=ue[o][1],s=ue[o+1][1],l=ue[Math.min(19,o+2)][1],n-=(y=(e>=0?f:-f)*(s+g*(l-a)/2+g*g*(l-2*s+a)/2)-e)*v}while(Math.abs(y)>h&&--_>0);break}}while(--o>=0);var b=ue[o][0],x=ue[o+1][0],w=ue[Math.min(19,o+2)][0];return[t/(x+g*(w-b)/2+g*g*(w-2*x+b)/2),n*m]},(d3.geoRobinson=function(){return x(ce)}).raw=ce,(d3.geoSatellite=function(){var t=1.4,e=0,i=w(he),n=i(t,e);return n.distance=function(n){return arguments.length?i(t=+n,e):t},n.tilt=function(n){return arguments.length?i(t,e=n*d/180):180*e/d},n}).raw=he,de.invert=function(t,e){var i=e/1.70711,n=Math.sin(d/4*i);return[t/(.74482-.34588*n*n),2*Math.atan(i)]},(d3.geoTimes=function(){return x(de)}).raw=de,(d3.geoTwoPointEquidistant=function(){var t=[[0,0],[0,0]],e=w(fe),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var r=d3.geoInterpolate(i[0],i[1]),o=r(.5),a=d3.geoRotation([-o[0],-o[1]])(i[0]),s=.5*r.distance,l=-y(Math.sin(a[1]*m)/Math.sin(s));return a[0]>0&&(l=d-l),n.call(a,[-o[0],-o[1],-l*v]),e(2*s)},i}).raw=fe,(d3.geoTwoPointAzimuthal=function(){var t=[[0,0],[0,0]],e=w(pe),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var r=d3.geoInterpolate(i[0],i[1]),o=r(.5),a=d3.geoRotation([-o[0],-o[1]])(i[0]),s=.5*r.distance,l=-y(Math.sin(a[1]*m)/Math.sin(s));return a[0]>0&&(l=d-l),n.call(a,[-o[0],-o[1],-l*v]),e(s)},i}).raw=pe,me.invert=function(t,e){if(Math.abs(e)<c)return[t,0];if(Math.abs(t)<c)return[0,f*Math.sin(2*Math.atan(e/d))];var i=(t/=d)*t,n=(e/=d)*e,r=i+n,o=r*r,a=-Math.abs(e)*(1+r),s=a-2*n+i,l=-2*a+1+2*n+o,u=n/l+(2*s*s*s/(l*l*l)-9*a*s/(l*l))/27,h=(a-s*s/(3*l))/l,p=2*Math.sqrt(-h/3),m=_(3*u/(h*p))/3;return[d*(r-1+Math.sqrt(1+2*(i-n)+o))/(2*t),g(e)*d*(-p*Math.cos(m+d/3)-s/(3*l))]},(d3.geoVanDerGrinten=function(){return x(me)}).raw=me,ve.invert=function(t,e){if(!t)return[0,f*Math.sin(2*Math.atan(e/d))];var i=Math.abs(t/d),n=(1-i*i-(e/=d)*e)/(2*i),r=n*n,o=Math.sqrt(r+1);return[g(t)*d*(o-n),g(e)*f*Math.sin(2*Math.atan2(Math.sqrt((1-2*n*i)*(n+o)-i),Math.sqrt(o+n+i)))]},(d3.geoVanDerGrinten2=function(){return x(ve)}).raw=ve,ge.invert=function(t,e){if(!e)return[t,0];var i=e/d,n=(d*d*(1-i*i)-t*t)/(2*d*t);return[t?d*(g(t)*Math.sqrt(n*n+1)-n):0,f*Math.sin(2*Math.atan(i))]},(d3.geoVanDerGrinten3=function(){return x(ge)}).raw=ge,ye.invert=function(t,e){if(!t||!e)return[t,e];e/=d;var i=g(t)*t/f,n=(i*i-1+4*e*e)/Math.abs(i),r=n*n,o=2*e,a=50;do{var s=o*o,l=(8*o-s*(s+2)-5)/(2*s*(o-1)),u=(3*o-s*o-10)/(2*s*o),h=l*l,p=o*l,m=o+l,v=m*m,y=o+3*l,_=v*(s+h*r-1)+(1-s)*(s*(y*y+4*h)+h*(12*p+4*h)),b=-2*m*(4*p*h+(1-4*s+3*s*s)*(1+u)+h*(14*s-6-r+(8*s-8-2*r)*u)+p*(12*s-8+(10*s-10-r)*u)),x=Math.sqrt(_);o-==(n*(v+h-1)+2*x-i*(4*v+r))/(n*(2*l*u+2*m*(1+u))+b/x-8*m*(n*(-1+h+v)+2*x)*(1+u)/(r+4*v))}while(>c&&--a>0);return[g(t)*(Math.sqrt(n*n+4)+n)*d/4,f*o]},(d3.geoVanDerGrinten4=function(){return x(ye)}).raw=ye;var _e,be,xe=(_e=4*d+3*Math.sqrt(3),L((be=2*Math.sqrt(2*d*Math.sqrt(3)/_e))*Math.sqrt(3)/d,be,_e/6));function we(t,e){return[t*Math.sqrt(1-3*e*e/(d*d)),e]}function Se(t,e){var i=.90631*Math.sin(e),n=Math.sqrt(1-i*i),r=Math.sqrt(2/(1+n*Math.cos(t/=3)));return[2.66723*n*r*Math.sin(t),1.24104*i*r]}function Me(t,e){var i=Math.cos(e),n=Math.cos(t)*i,r=1-n,o=Math.cos(t=Math.atan2(Math.sin(t)*i,-Math.sin(e))),a=Math.sin(t);return[a*(i=b(1-n*n))-o*r,-o*i-a*r]}function Ee(t,e){var i=M(t,e);return[(i[0]+t/f)/2,(i[1]+e)/2]}(d3.geoWagner4=function(){return x(xe)}).raw=xe,we.invert=function(t,e){return[t/Math.sqrt(1-3*e*e/(d*d)),e]},(d3.geoWagner6=function(){return x(we)}).raw=we,Se.invert=function(t,e){var i=t/2.66723,n=e/1.24104,r=Math.sqrt(i*i+n*n),o=2*y(r/2);return[3*Math.atan2(t*Math.tan(o),2.66723*r),r&&y(e*Math.sin(o)/(1.24104*.90631*r))]},(d3.geoWagner7=function(){return x(Se)}).raw=Se,Me.invert=function(t,e){var i=-.5*(t*t+e*e),n=Math.sqrt(-i*(2+i)),r=e*i+t*n,o=t*i-e*n,a=Math.sqrt(o*o+r*r);return[Math.atan2(n*r,a*(1+i)),a?-y(n*o/a):0]},(d3.geoWiechel=function(){return x(Me)}).raw=Me,Ee.invert=function(t,e){var i=t,n=e,r=25;do{var o,a=Math.cos(n),s=Math.sin(n),l=Math.sin(2*n),u=s*s,h=a*a,d=Math.sin(i),p=Math.cos(i/2),m=Math.sin(i/2),v=m*m,g=1-h*p*p,y=g?_(a*p)*Math.sqrt(o=1/g):o=0,b=.5*(2*y*a*m+i/f)-t,x=.5*(y*s+n)-e,w=.5*o*(h*v+y*a*p*u)+.5/f,S=o*(d*l/4-y*s*m),M=.125*o*(l*m-y*s*h*d),E=.5*o*(u*p+y*v*a)+.5,z=S*M-E*w,k=(x*S-b*E)/z,T=(b*M-x*w)/z;i-=k,n-=T}while((Math.abs(k)>c||Math.abs(T)>c)&&--r>0);return[i,n]},(d3.geoWinkel3=function(){return x(Ee)}).raw=Ee}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(1)),r=s(i(31)),o=s(i(432)),a=i(21);function s(t){return t&&t.__esModule?t:{default:t}}var l=function(t){return function(){var e=t,i=void 0;o.setCssPrefix=function(t){return i=t,o};var r=d3.drag().on("start",function(t,i){d3.event.sourceEvent.stopPropagation();e.KEY}).on("drag",function(t,i){var n=e.KEY;if(e.model.ui.chart.labels.dragging){this.druging||(e.druging=t[n]);var r=e.cached[t[n]];r.labelFixed=!0;var a=e.context.width,s=e.context.height;r.labelX_+=d3.event.dx/a,r.labelY_+=d3.event.dy/s;var l=e.xScale(r.labelX0)+r.labelX_*a,u=e.yScale(r.labelY0)+r.labelY_*s,c=e.xScale(r.labelX0),h=e.yScale(r.labelY0),d=e.entityLines.filter(function(e){return e[n]==t[n]});o._repositionLabels(t,i,null,this,l,u,c,h,0,null,d)}}).on("end",function(t,i){var n=e.KEY;if(e.druging){var r=e.cached[t[n]];e.druging=null,r.labelOffset[0]=r.labelX_,r.labelOffset[1]=r.labelY_,e.model.marker.setLabelOffset(t,[r.labelX_,r.labelY_])}});function o(t,s){return t.each(function(t,r){var o=d3.select(this);o.append("rect").attr("class","vzb-label-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),o.append("rect").attr("class","vzb-label-fill vzb-tooltip-border");var l=o.append("text").attr("class",i+"-label-content stroke");if(o.style("paint-order").length||(o.insert("text","."+i+"-label-content").attr("class",i+"-label-content "+i+"-label-shadow vzb-noexport"),l.classed("stroke",!1)),!s){var u=o.append("g").attr("class",i+"-label-x vzb-transparent");n.setIcon(u,a.close),u.insert("circle","svg"),u.select("svg").attr("class",i+"-label-x-icon").attr("width","0px").attr("height","0px"),u.on("click",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t))})}}),s||t.call(r).on("mouseover",function(t){if(!n.isTouchDevice()){e.model.marker.highlightMarker(t);var r=e.KEY||e.context.KEY;e.entityLabels.sort(function(e,i){return e[r]!=t[r]?-1:1}),d3.select(this).selectAll("."+i+"-label-x").classed("vzb-transparent",!1)}}).on("mouseout",function(t){n.isTouchDevice()||(e.model.marker.clearHighlighted(),d3.select(this).selectAll("."+i+"-label-x").classed("vzb-transparent",!0))}).on("click",function(t){if(n.isTouchDevice()){var r=d3.select(this).selectAll("."+i+"-label-x"),o=e.KEY||e.context.KEY,a=r.classed("vzb-transparent");a&&(e.entityLabels.sort(function(e,i){return e[o]!=t[o]?-1:1}),e.showCloseCross(null,!1)),r.classed("vzb-transparent",!a),e.options.SUPPRESS_HIGHLIGHT_DURING_PLAY&&e.model.time.playing||(a?e.model.marker.setHighlight(t):e.model.marker.clearHighlighted())}}),o}return o.line=function(t){t.append("line").attr("class",i+"-label-line")},o._repositionLabels=function(t,i,n,r,o,a,s,l,u,c,h){var d=n||e.cached[t[e.KEY]],f=d3.select(r),p=!o&&0!==o||!a&&0!==a||!s&&0!==s||!l&&0!==l;if(p)return f.classed("vzb-invisible",p),void h.classed("vzb-invisible",p);var m=e.context.width,v=e.context.height,g=d.rectBBox,y=g.height,_=d.rectOffsetX,b=d.rectOffsetY;o+g.x<=0?(o=-g.x,d.labelX_=(o-e.xScale(d.labelX0))/m):o+_>m&&(o=m-_,d.labelX_=(o-e.xScale(d.labelX0))/m);a+g.y<=0?(a=-g.y,d.labelY_=(a-e.yScale(d.labelY0))/v):a+b>v&&(a=v-b,d.labelY_=(a-e.yScale(d.labelY0))/v);null==u&&(u=e.context.duration);d._new&&(u=0,delete d._new);u?c&&!t.hidden?(f.classed("vzb-invisible",t.hidden),f.attr("transform","translate("+o+","+a+")").style("opacity",0).transition().duration(u).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){f.style("opacity",1)}),h.classed("vzb-invisible",t.hidden),h.attr("transform","translate("+o+","+a+")").style("opacity",0).transition().duration(u).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){h.style("opacity",1)})):c&&t.hidden?(f.style("opacity",1).transition().duration(u).ease(d3.easeExp).style("opacity",0).on("end",function(){f.style("opacity",1).classed("vzb-invisible",t.hidden)}),h.style("opacity",1).transition().duration(u).ease(d3.easeExp).style("opacity",0).on("end",function(){h.style("opacity",1).classed("vzb-invisible",t.hidden)})):(f.transition().duration(u).ease(d3.easeLinear).attr("transform","translate("+o+","+a+")"),h.transition().duration(u).ease(d3.easeLinear).attr("transform","translate("+o+","+a+")")):(f.interrupt().attr("transform","translate("+o+","+a+")").transition(),h.interrupt().attr("transform","translate("+o+","+a+")").transition(),c&&f.classed("vzb-invisible",t.hidden),c&&h.classed("vzb-invisible",t.hidden));var x=s-o,w=l-a,S=f.select("text").node().getBBox(),M=.5*-S.width,E=.2*-y,z=e.model.ui.chart.labels,k=z.removeLabelBox?S:g,T=e.activeProfile.labelLeashCoeff||0,O=function(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),r=.5*e.width,o=.5*e.height;if(i>r+t.r)return!1;if(n>o+t.r)return!1;if(i<=r)return!0;if(n<=o)return!0;return Math.pow(i-r,2)+Math.pow(n-o,2)<=Math.pow(t.r,2)}({x:x,y:w,r:d.scaledS0},{x:M,y:E,width:2*k.height*T+k.width,height:k.height*(2*T+1)});if(h.select("line").classed("vzb-invisible",O),O)return;if(z.removeLabelBox){var C=180*Math.atan2(x-M,w-E)/Math.PI,P=C>=0&&C<=180?.5*k.width:.5*-k.width,A=Math.abs(C)<=90?.55*k.height:.45*-k.height;M+=Math.abs(x-M)>.5*S.width?P:0,E+=Math.abs(w-E)>.5*S.height?A:.05*S.height}var I=Math.abs(x)>Math.abs(w)?Math.abs(x):Math.abs(w);h.select("line").style("stroke-dasharray","0 "+d.scaledS0+" "+2*~~I),h.selectAll("line").attr("x1",x).attr("y1",w).attr("x2",M).attr("y2",E)},o}()},u={LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",LINES_CONTAINER_SELECTOR:"",CSS_PREFIX:"",SUPPRESS_HIGHLIGHT_DURING_PLAY:!0},c=r.default.extend({init:function(t,e){this.context=t,this.options=n.extend({},u),this.label=l(this),this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null},ready:function(){this.KEYS=this.context.KEYS,this.KEY=this.context.KEY,this.updateIndicators(),this.updateLabelSizeLimits()},readyOnce:function(){var t=this;this.model=this.context.model,this.model.on("change:marker.select",function(){t.context._readyOnce&&t.selectDataPoints()}),this.model.marker.size_label&&this.model.on("change:marker.size_label.extent",function(e,i){t.context._readyOnce&&(t.updateLabelSizeLimits(),t.model.time.splash||t.updateLabelsOnlyTextSize())}),this.model.ui.chart.labels.hasOwnProperty("removeLabelBox")&&this.model.on("change:ui.chart.labels.removeLabelBox",function(e,i){t.context._readyOnce&&t.updateLabelsOnlyTextSize()}),this.KEYS=this.context.KEYS,this.KEY=this.context.KEY,this.cached={},this.label.setCssPrefix(this.options.CSS_PREFIX),this.rootEl=this.context.root.element instanceof Array?this.context.root.element:d3.select(this.context.root.element),this.labelsContainer=this.rootEl.select("."+this.options.LABELS_CONTAINER_CLASS),this.linesContainer=this.rootEl.select("."+this.options.LINES_CONTAINER_CLASS),this.updateIndicators(),this.updateSize(),this.selectDataPoints(),this._initLabelTooltip()},config:function(t){n.extend(this.options,t)},updateLabelSizeLimits:function(){if(this.model.marker.size_label){var t=this.model.marker.size_label.extent||[0,1],e=this.activeProfile.minLabelTextSize,i=this.activeProfile.maxLabelTextSize-e;this.minLabelTextSize=Math.max(e+i*t[0],e),this.maxLabelTextSize=Math.max(e+i*t[1],e),"constant"==this.model.marker.size_label.use&&(this.minLabelTextSize=this.maxLabelTextSize),"ordinal"!==this.model.marker.size_label.scaleType||"constant"==this.model.marker.size_label.use?this.labelSizeTextScale.range([this.minLabelTextSize,this.maxLabelTextSize]):this.labelSizeTextScale.rangePoints([this.minLabelTextSize,this.maxLabelTextSize],0).range()}},updateIndicators:function(){this.model.marker.size_label&&(this.labelSizeTextScale=this.model.marker.size_label.getScale())},setScales:function(t,e){this._xScale=t,this._yScale=e},setCloseCrossHeight:function(t){this._closeCrossHeight!=t&&(this._closeCrossHeight=t,this.updateLabelCloseGroupSize(this.entityLabels.selectAll("."+this.options.CSS_PREFIX+"-label-x"),this._closeCrossHeight))},xScale:function(t){return this._xScale?this._xScale(t):t*this.context.width},yScale:function(t){return this._yScale?this._yScale(t):t*this.context.height},selectDataPoints:function(){var t=this,e=this.KEYS,i=this.KEY,r=this.options.CSS_PREFIX,a=t.model.marker.select.map(function(t){var r=n.clone(t,e);return r[i]=n.getKey(t,e),r});this.entityLabels=this.labelsContainer.selectAll("."+r+"-entity").data(a,function(t){return t[i]}),this.entityLines=this.linesContainer.selectAll("g.entity-line."+r+"-entity").data(a,function(t){return t[i]}),this.entityLabels.exit().each(function(e){null!=t.cached[e[i]]&&(t.cached[e[i]]=void 0)}).remove(),this.entityLines.exit().remove(),this.entityLines=this.entityLines.enter().insert("g",function(e){return this.querySelector("."+t.options.LINES_CONTAINER_SELECTOR_PREFIX+(0,o.default)(e[i]))}).attr("class",function(t,e){return r+"-entity entity-line line-"+t[i]}).each(function(e,i){t.label.line(d3.select(this))}).merge(this.entityLines),this.entityLabels=this.entityLabels.enter().append("g").attr("class",function(t,e){return r+"-entity label-"+t[i]}).each(function(e,n){t.cached[e[i]]={_new:!0},t.label(d3.select(this))}).merge(this.entityLabels)},showCloseCross:function(t,e){var i=this.KEY;this.entityLabels.filter(function(e){return!t||e[i]==t[i]}).select("."+this.options.CSS_PREFIX+"-label-x").classed("vzb-transparent",!e)},highlight:function(t,e){var i=this.KEY,n=this.entityLabels;t&&(n=n.filter(function(e){return!t||e[i]==t[i]})),n.classed("vzb-highlighted",e)},updateLabel:function(t,e,i,r,o,a,s,l,u,c,h){var d=this,f=this.KEYS,p=this.KEY;if(t[p]!=d.druging){var m=this.options.CSS_PREFIX;if(d.model.marker.isSelected(t)&&null!=d.entityLabels){null==d.cached[t[p]]&&this.selectDataPoints();var v=d.cached[t[p]];if(i&&n.extend(v,i),null!=v.scaledS0&&null!=v.labelX0&&null!=v.labelY0||this._initNewCache(v,r,o,a,s,u),null==v.labelX_||null==v.labelY_){var g=n.find(d.model.marker.select,function(e){return n.getKey(e,f)==t[p]});v.labelOffset=g.labelOffset||[0,0]}var y=!v.labelX0&&0!==v.labelX0||!v.labelY0&&0!==v.labelY0||!v.scaledS0&&0!==v.scaledS0,_=d.entityLines.filter(function(e){return e[p]==t[p]});d.entityLabels.filter(function(e){return e[p]==t[p]}).each(function(i){var n=d3.select(this);if(y)return n.classed("vzb-invisible",y),void _.classed("vzb-invisible",y);var r=n.selectAll("."+m+"-label-content").text(l);d._updateLabelSize(t,e,null,n,u,r),d.positionLabel(t,e,null,this,c,h,_)})}}},_initNewCache:function(t,e,i,r,o,a){(r||0===r)&&(t.scaledS0=n.areaToRadius(this.context.sScale(r))),t.labelX0=e,t.labelY0=i,t.valueLST=a,t.scaledC0=null!=o?this.context.cScale(o):this.context.COLOR_WHITEISH},_initLabelTooltip:function(){this.tooltipEl=this.labelsContainer.append("g").attr("class",this.options.CSS_PREFIX+"-tooltip")},setTooltip:function(t,e,i,n){if(e){var r=0,o=this.options.CSS_PREFIX;if(this.tooltipEl.raise().text(null),this.label(this.tooltipEl,!0),t){var a={};this._initNewCache(a,n.valueX,n.valueY,n.valueS,n.valueC,n.valueLST),this.tooltipEl.classed(this.options.CSS_PREFIX+"-tooltip",!1).classed(this.options.CSS_PREFIX+"-entity",!0).selectAll("."+o+"-label-content").text(n.labelText),this._updateLabelSize(t,null,a,this.tooltipEl,n.valueLST),r=this.positionLabel(t,null,a,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"))}this.tooltipEl.classed(this.options.CSS_PREFIX+"-entity",!1).classed(this.options.CSS_PREFIX+"-tooltip",!0).selectAll("."+o+"-label-content").text(e),this._updateLabelSize(t,null,i,this.tooltipEl,null),this.positionLabel(t,null,i,this.tooltipEl.node(),0,null,this.tooltipEl.select(".lineemptygroup"),r)}else this.tooltipEl.text(null)},setTooltipFontSize:function(t){this.tooltipEl.style("font-size",t)},_updateLabelSize:function(t,e,i,n,r,o){var a=this.KEY,s=i||this.cached[t[a]],l=this.options.CSS_PREFIX,u=this.model.ui.chart.labels||{};n.classed("vzb-label-boxremoved",u.removeLabelBox);var c=o||n.selectAll("."+l+"-label-content");if(this.labelSizeTextScale)if(null!=r){var h=this.labelSizeTextScale.range(),d=h[0]+Math.sqrt((this.labelSizeTextScale(r)-h[0])*(h[1]-h[0]));c.attr("font-size",d+"px")}else c.attr("font-size","");var f=c.node().getBBox(),p=n.selectAll("rect");if(!s.textWidth||s.textWidth!=f.width){s.textWidth=f.width;var m=this._closeCrossHeight||f.height,v=this.model.locale.isRTL(),g=n.select("."+l+"-label-x").attr("transform","translate("+(v?-f.width-4:4)+","+.85*-f.height+")");this.updateLabelCloseGroupSize(g,m),p.attr("width",f.width+8).attr("height",1.2*f.height).attr("x",-f.width-4).attr("y",.85*-f.height).attr("rx",.2*f.height).attr("ry",.2*f.height),s.rectBBox=p.node().getBBox(),s.rectOffsetX=s.rectBBox.width+s.rectBBox.x,s.rectOffsetY=s.rectBBox.height+s.rectBBox.y}var y=n.select(".vzb-label-glow");y.attr("stroke")!==s.scaledC0&&y.attr("stroke",s.scaledC0)},updateLabelCloseGroupSize:function(t,e){t.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*e),t.select("svg").attr("x",.5*-e).attr("y",-.5*e).attr("width",e).attr("height",e)},updateLabelsOnlyTextSize:function(){var t=this,e=this.KEYS,i=this.KEY;this.entityLabels.each(function(r,o){t.cached[r[i]];t._updateLabelSize(r,o,null,d3.select(this),t.context.frame.size_label[n.getKey(r,e)]);var a=t.entityLines.filter(function(t){return t[i]==r[i]});t.positionLabel(r,o,null,this,0,null,a)})},updateLabelOnlyPosition:function(t,e,i){var r=this,o=this.KEY,a=this.cached[t[o]];i&&n.extend(a,i);var s=r.entityLines.filter(function(e){return e[o]==t[o]});this.entityLabels.filter(function(e){return e[o]==t[o]}).each(function(i){r.positionLabel(t,e,null,this,0,null,s)})},updateLabelOnlyColor:function(t,e,i){var r=this.KEY,o=this.cached[t[r]];i&&n.extend(o,i);var a=this.entityLabels.filter(function(e){return e[r]==t[r]});this._updateLabelSize(t,e,null,a,null)},positionLabel:function(t,e,i,r,o,a,s,l){var u=this.KEY,c=i||this.cached[t[u]],h=l||0===l,d=1&(l||0),f=(2&(l||0))>>1,p=0,m=0,v=this.context.width,g=this.context.height,y=this.xScale(c.labelX0),_=this.yScale(c.labelY0),b=c.rectOffsetX,x=c.rectOffsetY;c.labelOffset||(c.labelOffset=[0,0]),c.labelX_=c.labelOffset[0]||(.75*-c.scaledS0-b)/v,c.labelY_=c.labelOffset[1]||(.75*-c.scaledS0-x)/g;var w=y+c.labelX_*v,S=_+c.labelY_*g;if(c.labelOffset[0]+c.labelOffset[1]==0&&((!h&&S-c.rectBBox.height+x<=0||f)&&(m=1,c.labelY_=(.75*c.scaledS0+c.rectBBox.height-x)/g,S=_+c.labelY_*g),(!h&&w-c.rectBBox.width+b<=0||d)&&(p=1,c.labelX_=(.75*c.scaledS0+c.rectBBox.width-b)/v,(w=y+c.labelX_*v)>v&&(p=0,m=0==m&&_-.5*x-c.scaledS0<c.rectBBox.height?1:m,c.labelY_=m?.5*-x+c.rectBBox.height+c.scaledS0:1.5*-x-c.scaledS0,c.labelY_/=g,S=_+c.labelY_*g,c.labelX_=(c.rectBBox.width-b-y)/v,w=y+c.labelX_*v))),h){var M=!1;if(w-c.rectBBox.width+b<=0){var E=y-c.rectBBox.width,z=E>0?n.cathetus(c.scaledS0,E):c.scaledS0;(S=m?_+c.rectBBox.height-.5*x+z:_-1.5*x-z)-c.rectBBox.height<0&&(M=!0)}if(S-c.rectBBox.height+x<=0){var k=_-c.rectBBox.height,T=k>0?n.cathetus(c.scaledS0,k):c.scaledS0;((w=p?y+c.rectBBox.width+T:y-2*b-T)-c.rectBBox.width<0||w>v)&&(M=!0)}if(M){m++;var O=y-c.rectBBox.width;S=_+c.rectBBox.height-.5*x+(O>0?n.cathetus(c.scaledS0,O):c.scaledS0)}}return this.label._repositionLabels(t,e,i,r,w,S,y,_,o,a,s),2*m+p},updateSize:function(){this.activeProfile=this.context.getActiveProfile({small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,labelLeashCoeff:.4},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,labelLeashCoeff:.2}},{medium:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,labelLeashCoeff:.2}}),this.updateLabelSizeLimits()}});e.default=c},function(t,e,i){(function(e){var i,n;i=void 0!==e?e:this,n=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,i=String(t),n=i.length,r=-1,o="",a=i.charCodeAt(0);++r<n;)0!=(e=i.charCodeAt(r))?o+=e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==a?"\\"+e.toString(16)+" ":(0!=r||1!=n||45!=e)&&(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?i.charAt(r):"\\"+i.charAt(r):o+="";return o};return t.CSS||(t.CSS={}),t.CSS.escape=e,e},t.exports=n(i)}).call(e,i(78))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(31),o=(n=r)&&n.__esModule?n:{default:n};var a="",s=[];e.default=o.default.extend({init:function(t){this.context=t,this.shapes=[],this.groups=[],this.counter=0,this.name="",this.label=""},reset:function(){this.container.remove(),this.context.element.selectAll(".vzb-export-redball").remove(),this.context.element.selectAll(".vzb-export-counter").remove(),this.counter=0},prefix:function(t){return arguments.length?(a=t,this):a},deleteClasses:function(t){return arguments.length?(s=t,this):s},open:function(t,e){var i=this;this.svg&&this.reset(),t||(t=this.context.element),e||(e=this.context.name),this.name=e;var n=parseInt(t.style("width"),10)||0,r=parseInt(t.style("height"),10)||0;this.container=t.append("div").attr("class","vzb-svg-export"),this.svg=this.container.node().appendChild(t.select("svg").node().cloneNode(!0)),this.svg=d3.select(this.svg),this.svg.attr("viewBox","0 0 "+n+" "+r).attr("version","1.1").attr("param1","http://www.w3.org/2000/svg").attr("param2","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("style","enable-background:new 0 0 "+n+" "+r).attr("xml:space","preserve"),this.redBall=t.append("div").attr("class","vzb-export-redball").style("position","absolute").style("top","20px").style("right","20px").style("width","20px").style("height","20px").style("background","red").style("color","white").style("text-align","center").style("border-radius","10px").style("font-size","14px").style("line-height","20px").style("opacity",.8).style("cursor","pointer").on("mouseover",function(){d3.select(this).style("opacity",1).text(""),i.counterEl.text("Download")}).on("mouseout",function(){d3.select(this).style("opacity",.8).text(""),i.counterEl.text(i.label)}).on("click",function(){i.close()}),this.counterEl=t.append("div").attr("class","vzb-export-counter").style("position","absolute").style("top","20px").style("right","45px").style("color","red").style("opacity",.8).style("line-height","20px").style("font-size","14px").style("text-align","center"),this.root=this.svg.select("."+a+"graph"),this.root.selectAll("g, text, svg, line, rect").filter(function(){var t=d3.select(this),e=!1;return s.forEach(function(i){e=e||t.classed(i)}),e}).remove(),this.svg.selectAll(".tick line").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+a+"axis-x path").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+a+"axis-y path").attr("fill","none").attr("stroke","#999")},write:function(t){if(this.root||this.open(),!(this.shapes.indexOf(t.id+"_"+t.time)>-1)){this.shapes.push(t.id+"_"+t.time),-1==this.groups.indexOf(t.time)&&(this.root.append("g").attr("id","g_"+t.time),this.groups.push(t.time)),null==t.opacity&&(t.opacity=.5),null==t.fill&&(t.fill="#ff80dd");var e=this.root.select("#g_"+t.time).append(t.type).attr("id",t.id+"_"+t.time).style("fill",t.fill).style("opacity",t.opacity);switch(t.type){case"path":e.attr("d",t.d);break;case"circle":e.attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}this.counter++,this.redBall.style("opacity",this.counter%10/12+.2),this.label=t.type+" shapes: "+this.counter,this.counterEl.text(this.label)}},close:function(){var t='<?xml version="1.0" encoding="utf-8"?> '+this.container.node().innerHTML.replace("param1","xmlns").replace("param2","xmlns:xlink").replace(/\d+(\.\d+)/g,function(t){return Math.round(100*+t)/100+""});if(t.length/1024/1024>2)alert("The file size is "+Math.round(t.length/1024)+"kB, which is too large to download. Will try to print it in the console instead..."),console.log(t);else{var e=document.createElement("a");e.download=this.name+" "+this.counter+" shapes.svg",e.href="data:,"+t,e.click()}}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(31);var o=((n=r)&&n.__esModule?n:{default:n}).default.extend({init:function(t){this.context=t,this.interact=this._createInteract()},setTooltip:function(t){this.tooltip=t},_createInteract:function(){var t=this;return{mouseOver:function(){var e=d3.event,i=d3.mouse(t.context.element.node());t._setTooltip(d3.select(e.target).attr("data-text"),i[0],i[1])},mouseOut:function(){t._setTooltip()},tap:function(){}}},_setTooltip:function(t,e,i){if(t){this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(t);var n=this.tooltip.select("text").node().getBBox();e-n.width<0?e+=n.width+5:e-=5,i-n.height<0?i+=n.height:i-=11,this.tooltip.attr("transform","translate("+e+","+i+")"),this.tooltip.selectAll("rect").attr("width",n.width+8).attr("height",1.2*n.height).attr("x",-n.width-4).attr("y",.85*-n.height).attr("rx",.2*n.height).attr("ry",.2*n.height)}else this.tooltip.classed("vzb-hidden",!0)},clear:function(t){t.attr("data-text",null)},wrap:function(t,e){var i=d3.select(t),n=Math.abs,r=i.attr("data-text");r||(r=i.text(),i.attr("data-text",r)),i.text(r);for(var o=r,a=o.length,s=i.node().getComputedTextLength();e-s<=0&&""!==o;)o=s>=e?o.slice(0,-n(.5*a)):r.slice(0,n(.5*a)),i.text(o+""),s=i.node().getComputedTextLength(),a=o.length;o!==r?(""===o&&i.text(r[0]),i.on("mouseover.tooltip",this.interact.mouseOver).on("mouseout.tooltip",this.interact.mouseOut).style("pointer-events","all")):i.on("mouseover.tooltip",null).on("mouseout.tooltip",null).style("pointer-events",null)}});e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,e){var i={},n={},r={},o=[],a=-1;function s(t,e){for(var n in t){var r=t[n];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){i[t<0?~t:t]=1}),o.push(r)}}return e.forEach(function(i,n){var r,o=t.arcs[i<0?~i:i];o.length<3&&!o[1][0]&&!o[1][1]&&(r=e[++a],e[a]=i,e[n]=r)}),e.forEach(function(e){var i,o,a=function(e){var i,n=t.arcs[e<0?~e:e],r=n[0];t.transform?(i=[0,0],n.forEach(function(t){i[0]+=t[0],i[1]+=t[1]})):i=n[n.length-1];return e<0?[i,r]:[r,i]}(e),s=a[0],l=a[1];if(i=r[s])if(delete r[i.end],i.push(e),i.end=l,o=n[l]){delete n[o.start];var u=o===i?i:i.concat(o);n[u.start=i.start]=r[u.end=o.end]=u}else n[i.start]=r[i.end]=i;else if(i=n[l])if(delete n[i.start],i.unshift(e),i.start=s,o=r[s]){delete r[o.end];var c=o===i?i:o.concat(i);n[c.start=o.start]=r[c.end=i.end]=c}else n[i.start]=r[i.end]=i;else n[(i=[e]).start=s]=r[i.end=l]=i}),s(r,n),s(n,r),e.forEach(function(t){i[t<0?~t:t]||o.push([t])}),o}function e(e,i,n){var r=[];function o(t){var e=t<0?~t:t;(u[e]||(u[e]=[])).push({i:t,g:l})}function a(t){t.forEach(o)}function s(t){t.forEach(a)}if(arguments.length>1){var l,u=[],c={LineString:a,MultiLineString:s,Polygon:s,MultiPolygon:function(t){t.forEach(s)}};!function t(e){"GeometryCollection"===e.type?e.geometries.forEach(t):e.type in c&&(l=e,c[e.type](e.arcs))}(i),u.forEach(arguments.length<3?function(t){r.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&r.push(t[0].i)})}else for(var h=0,d=e.arcs.length;h<d;++h)r.push(h);return{type:"MultiLineString",arcs:t(e,r)}}function i(e,i){var r={},a=[],s=[];function l(t){t.forEach(function(e){e.forEach(function(e){(r[e=e<0?~e:e]||(r[e]=[])).push(t)})}),a.push(t)}function u(t){return function(t){var e,i=-1,n=t.length,r=t[n-1],o=0;for(;++i<n;)e=r,r=t[i],o+=e[0]*r[1]-e[1]*r[0];return.5*o}(o(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}return i.forEach(function(t){"Polygon"===t.type?l(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(l)}),a.forEach(function(t){if(!t._){var e=[],i=[t];for(t._=1,s.push(e);t=i.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].forEach(function(t){t._||(t._=1,i.push(t))})})})}}),a.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:s.map(function(i){var o=[];if(i.forEach(function(t){t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].length<2&&o.push(t)})})}),o=t(e,o),(n=o.length)>1)for(var a,s=u(i[0][0]),l=0;l<n;++l)if(s===u(o[l])){a=o[0],o[0]=o[l],o[l]=a;break}return o})}}function r(t,e){var i={type:"Feature",id:e.id,properties:e.properties||{},geometry:o(t,e)};return null==e.id&&delete i.id,i}function o(t,e){var i=u(t.transform),n=t.arcs;function r(t,e){e.length&&e.pop();for(var r,o=n[t<0?~t:t],a=0,s=o.length;a<s;++a)e.push(r=o[a].slice()),i(r,a);t<0&&function(t,e){var i,n=t.length,r=n-e;for(;r<--n;)i=t[r],t[r++]=t[n],t[n]=i}(e,s)}function o(t){return t=t.slice(),i(t,0),t}function a(t){for(var e=[],i=0,n=t.length;i<n;++i)r(t[i],e);return e.length<2&&e.push(e[0].slice()),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0].slice());return e}function l(t){return t.map(s)}var c={Point:function(t){return o(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(o)},LineString:function(t){return a(t.arcs)},MultiLineString:function(t){return t.arcs.map(a)},Polygon:function(t){return l(t.arcs)},MultiPolygon:function(t){return t.arcs.map(l)}};return function t(e){var i=e.type;return"GeometryCollection"===i?{type:i,geometries:e.geometries.map(t)}:i in c?{type:i,coordinates:c[i](e)}:null}(e)}function a(t,e){for(var i=0,n=t.length;i<n;){var r=i+n>>>1;t[r]<e?i=r+1:n=r}return i}function s(t){var e=t[0],i=t[1],n=t[2];return Math.abs((e[0]-n[0])*(i[1]-e[1])-(e[0]-i[0])*(n[1]-e[1]))}function l(t,e){return t[1][2]-e[1][2]}function u(t){if(!t)return c;var e,i,n=t.scale[0],r=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=i=0),t[0]=(e+=t[0])*n+o,t[1]=(i+=t[1])*r+a}}function c(){}return{version:"1.6.19",mesh:function(t){return o(t,e.apply(this,arguments))},meshArcs:e,merge:function(t){return o(t,i.apply(this,arguments))},mergeArcs:i,feature:function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return r(t,e)})}:r(t,e)},neighbors:function(t){var e={},i=t.map(function(){return[]});function n(t,i){t.forEach(function(t){t<0&&(t=~t);var n=e[t];n?n.push(i):e[t]=[i]})}function r(t,e){t.forEach(function(t){n(t,e)})}var o={LineString:n,MultiLineString:r,Polygon:r,MultiPolygon:function(t,e){t.forEach(function(t){r(t,e)})}};for(var s in t.forEach(function t(e,i){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,i)}):e.type in o&&o[e.type](e.arcs,i)}),e)for(var l=e[s],u=l.length,c=0;c<u;++c)for(var h=c+1;h<u;++h){var d,f=l[c],p=l[h];(d=i[f])[s=a(d,p)]!==p&&d.splice(s,0,p),(d=i[p])[s=a(d,f)]!==f&&d.splice(s,0,f)}return i},presimplify:function(t,e){var i=u(t.transform),n=function(t){if(!t)return c;var e,i,n=t.scale[0],r=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=i=0);var l=(t[0]-o)/n|0,u=(t[1]-a)/r|0;t[0]=l-e,t[1]=u-i,e=l,i=u}}(t.transform),r=function(){var t={},e=[],i=0;function n(t,i){for(;i>0;){var n=(i+1>>1)-1,r=e[n];if(l(t,r)>=0)break;e[r._=i]=r,e[t._=i=n]=t}}function r(t,n){for(;;){var r=n+1<<1,o=r-1,a=n,s=e[a];if(o<i&&l(e[o],s)<0&&(s=e[a=o]),r<i&&l(e[r],s)<0&&(s=e[a=r]),a===n)break;e[s._=n]=s,e[t._=n=a]=t}}return t.push=function(t){return n(e[t._=i]=t,i++),i},t.pop=function(){if(!(i<=0)){var t,n=e[0];return--i>0&&(t=e[i],r(e[t._=0]=t,0)),n}},t.remove=function(t){var o,a=t._;if(e[a]===t)return a!==--i&&(l(o=e[i],t)<0?n:r)(e[o._=a]=o,a),a},t}();e||(e=s);function o(t){r.remove(t),t[1][2]=e(t),r.push(t)}return t.arcs.forEach(function(t){for(var a,s,l=[],u=0,c=0,h=t.length;c<h;++c)s=t[c],i(t[c]=[s[0],s[1],1/0],c);for(c=1,h=t.length-1;c<h;++c)(a=t.slice(c-1,c+2))[1][2]=e(a),l.push(a),r.push(a);for(c=0,h=l.length;c<h;++c)(a=l[c]).previous=l[c-1],a.next=l[c+1];for(;a=r.pop();){var d=a.previous,f=a.next;a[1][2]<u?a[1][2]=u:u=a[1][2],d&&(d.next=f,d[2]=a[2],o(d)),f&&(f.previous=d,f[0]=a[0],o(f))}t.forEach(n)}),t}}}()},function(t,e){}])},"object"==typeof e&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define("Vizabi",[],r):"object"==typeof e?e.Vizabi=r():i.Vizabi=r()}}]);
//# sourceMappingURL=tools.js.map